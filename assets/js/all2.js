/*! lazysizes lg.rias.min.js - v4.0.0-rc4 */ ! function(a, b) {
    var c = function() { b(a.lazySizes), a.removeEventListener("lazyunveilread", c, !0) };
    b = b.bind(null, a, a.document), "object" == typeof module && module.exports ? b(require("lazysizes")) : a.lazySizes ? c() : a.addEventListener("lazyunveilread", c, !0)
}(window, function(a, b, c) {
    "use strict";

    function d(b, c) {
        var d, e, f, g, h = a.getComputedStyle(b);
        e = b.parentNode, g = { isPicture: !(!e || !m.test(e.nodeName || "")) }, f = function(a, c) {
            var d = b.getAttribute("data-" + a);
            if (!d) {
                var e = h.getPropertyValue("--ls-" + a);
                e && (d = e.trim())
            }
            if (d) {
                if ("true" == d) d = !0;
                else if ("false" == d) d = !1;
                else if (l.test(d)) d = parseFloat(d);
                else if ("function" == typeof j[a]) d = j[a](b, d);
                else if (q.test(d)) try { d = JSON.parse(d) } catch (f) {}
                g[a] = d
            } else a in j && "function" != typeof j[a] ? g[a] = j[a] : c && "function" == typeof j[a] && (g[a] = j[a](b, d))
        };
        for (d in j) f(d);
        return c.replace(p, function(a, b) { b in g || f(b, !0) }), g
    }

    function e(a, b) {
        var c = [],
            d = function(a, c) { return k[typeof b[c]] ? b[c] : a };
        return c.srcset = [], b.absUrl && (s.setAttribute("href", a), a = s.href), a = ((b.prefix || "") + a + (b.postfix || "")).replace(p, d), b.widths.forEach(function(d) {
            var e = b.widthmap[d] || d,
                f = { u: a.replace(n, e).replace(o, b.ratio ? Math.round(d * b.ratio) : ""), w: d };
            c.push(f), c.srcset.push(f.c = f.u + " " + d + "w")
        }), c
    }

    function f(a, c, d) {
        var f = 0,
            g = 0,
            h = d;
        if (a) {
            if ("container" === c.ratio) {
                for (f = h.scrollWidth, g = h.scrollHeight; !(f && g || h === b);) h = h.parentNode, f = h.scrollWidth, g = h.scrollHeight;
                f && g && (c.ratio = g / f)
            }
            a = e(a, c), a.isPicture = c.isPicture, u && "IMG" == d.nodeName.toUpperCase() ? d.removeAttribute(i.srcsetAttr) : d.setAttribute(i.srcsetAttr, a.srcset.join(", ")), Object.defineProperty(d, "_lazyrias", { value: a, writable: !0 })
        }
    }

    function g(a, b) { var e = d(a, b); return j.modifyOptions.call(a, { target: a, details: e, detail: e }), c.fire(a, "lazyriasmodifyoptions", e), e }

    function h(a) { return a.getAttribute(a.getAttribute("data-srcattr") || j.srcAttr) || a.getAttribute(i.srcsetAttr) || a.getAttribute(i.srcAttr) || a.getAttribute("data-pfsrcset") || "" }
    var i, j, k = { string: 1, number: 1 },
        l = /^\-*\+*\d+\.*\d*$/,
        m = /^picture$/i,
        n = /\s*\{\s*width\s*\}\s*/i,
        o = /\s*\{\s*height\s*\}\s*/i,
        p = /\s*\{\s*([a-z0-9]+)\s*\}\s*/gi,
        q = /^\[.*\]|\{.*\}$/,
        r = /^(?:auto|\d+(px)?)$/,
        s = b.createElement("a"),
        t = b.createElement("img"),
        u = "srcset" in t && !("sizes" in t),
        v = !!a.HTMLPictureElement && !u;
    ! function() {
        var b, d = function() {},
            e = { prefix: "", postfix: "", srcAttr: "data-src", absUrl: !1, modifyOptions: d, widthmap: {}, ratio: !1 };
        i = c && c.cfg || a.lazySizesConfig, i || (i = {}, a.lazySizesConfig = i), i.supportsType || (i.supportsType = function(a) { return !a }), i.rias || (i.rias = {}), j = i.rias, "widths" in j || (j.widths = [], function(a) { for (var b, c = 0; !b || 3e3 > b;) c += 5, c > 30 && (c += 1), b = 36 * c, a.push(b) }(j.widths));
        for (b in e) b in j || (j[b] = e[b])
    }(), addEventListener("lazybeforesizes", function(a) {
        if (a.detail.instance == c) {
            var b, d, e, k, l, m, o, p, q, s, t, u, x;
            if (b = a.target, a.detail.dataAttr && !a.defaultPrevented && !j.disabled && (q = b.getAttribute(i.sizesAttr) || b.getAttribute("sizes")) && r.test(q)) {
                if (d = h(b), e = g(b, d), t = n.test(e.prefix) || n.test(e.postfix), e.isPicture && (k = b.parentNode))
                    for (l = k.getElementsByTagName("source"), m = 0, o = l.length; o > m; m++)(t || n.test(p = h(l[m]))) && (f(p, e, l[m]), u = !0);
                t || n.test(d) ? (f(d, e, b), u = !0) : u && (x = [], x.srcset = [], x.isPicture = !0, Object.defineProperty(b, "_lazyrias", { value: x, writable: !0 })), u && (v ? b.removeAttribute(i.srcAttr) : "auto" != q && (s = { width: parseInt(q, 10) }, w({ target: b, detail: s })))
            }
        }
    }, !0);
    var w = function() {
        var d = function(a, b) { return a.w - b.w },
            e = function(a) {
                var b, c, d = a.length,
                    e = a[d - 1],
                    f = 0;
                for (f; d > f; f++)
                    if (e = a[f], e.d = e.w / a.w, e.d >= a.d) {!e.cached && (b = a[f - 1]) && b.d > a.d - .13 * Math.pow(a.d, 2.2) && (c = Math.pow(b.d - .6, 1.6), b.cached && (b.d += .15 * c), b.d + (e.d - a.d) * c > a.d && (e = b)); break }
                return e
            },
            f = function(a, b) { var d; return !a._lazyrias && c.pWS && (d = c.pWS(a.getAttribute(i.srcsetAttr || ""))).length && (Object.defineProperty(a, "_lazyrias", { value: d, writable: !0 }), b && a.parentNode && (d.isPicture = "PICTURE" == a.parentNode.nodeName.toUpperCase())), a._lazyrias },
            g = function(b) {
                var d = a.devicePixelRatio || 1,
                    e = c.getX && c.getX(b);
                return Math.min(e || d, 2.4, d)
            },
            h = function(b, c) {
                var h, i, j, k, l, m;
                if (l = b._lazyrias, l.isPicture && a.matchMedia)
                    for (i = 0, h = b.parentNode.getElementsByTagName("source"), j = h.length; j > i; i++)
                        if (f(h[i]) && !h[i].getAttribute("type") && (!(k = h[i].getAttribute("media")) || (matchMedia(k) || {}).matches)) { l = h[i]._lazyrias; break }
                return (!l.w || l.w < c) && (l.w = c, l.d = g(b), m = e(l.sort(d))), m
            },
            j = function(d) { if (d.detail.instance == c) { var e, g = d.target; return !u && (a.respimage || a.picturefill || lazySizesConfig.pf) ? void b.removeEventListener("lazybeforesizes", j) : void(("_lazyrias" in g || d.detail.dataAttr && f(g, !0)) && (e = h(g, d.detail.width), e && e.u && g._lazyrias.cur != e.u && (g._lazyrias.cur = e.u, e.cached = !0, c.rAF(function() { g.setAttribute(i.srcAttr, e.u), g.setAttribute("src", e.u) })))) } };
        return v ? j = function() {} : addEventListener("lazybeforesizes", j), j
    }()
});
/*! ls.respimg.min.js - lazysizes - v4.0.0-rc4 */
! function(a, b) {
    var c = function() { b(a.lazySizes), a.removeEventListener("lazyunveilread", c, !0) };
    b = b.bind(null, a, a.document), "object" == typeof module && module.exports ? b(require("lazysizes"), require("../fix-ios-sizes/fix-ios-sizes")) : a.lazySizes ? c() : a.addEventListener("lazyunveilread", c, !0)
}(window, function(a, b, c) {
    "use strict";
    var d, e = c && c.cfg || a.lazySizesConfig,
        f = b.createElement("img"),
        g = "sizes" in f && "srcset" in f,
        h = /\s+\d+h/g,
        i = function() {
            var a = /\s+(\d+)(w|h)\s+(\d+)(w|h)/,
                c = Array.prototype.forEach;
            return function(d) {
                var e = b.createElement("img"),
                    f = function(b) {
                        var c, d = b.getAttribute(lazySizesConfig.srcsetAttr);
                        d && (d.match(a) && (c = "w" == RegExp.$2 ? RegExp.$1 / RegExp.$3 : RegExp.$3 / RegExp.$1, c && b.setAttribute("data-aspectratio", c)), b.setAttribute(lazySizesConfig.srcsetAttr, d.replace(h, "")))
                    },
                    g = function(a) {
                        var b = a.target.parentNode;
                        b && "PICTURE" == b.nodeName && c.call(b.getElementsByTagName("source"), f), f(a.target)
                    },
                    i = function() { e.currentSrc && b.removeEventListener("lazybeforeunveil", g) };
                d[1] && (b.addEventListener("lazybeforeunveil", g), e.onload = i, e.onerror = i, e.srcset = "data:,a 1w 1h", e.complete && i())
            }
        }();
    if (e || (e = {}, a.lazySizesConfig = e), e.supportsType || (e.supportsType = function(a) { return !a }), !a.picturefill && !e.pf) {
        if (a.HTMLPictureElement && g) return b.msElementsFromPoint && i(navigator.userAgent.match(/Edge\/(\d+)/)), void(e.pf = function() {});
        e.pf = function(b) {
            var c, e;
            if (!a.picturefill)
                for (c = 0, e = b.elements.length; e > c; c++) d(b.elements[c])
        }, d = function() {
            var f = function(a, b) { return a.w - b.w },
                i = /^\s*\d+\.*\d*px\s*$/,
                j = function(a) {
                    var b, c, d = a.length,
                        e = a[d - 1],
                        f = 0;
                    for (f; d > f; f++)
                        if (e = a[f], e.d = e.w / a.w, e.d >= a.d) {!e.cached && (b = a[f - 1]) && b.d > a.d - .13 * Math.pow(a.d, 2.2) && (c = Math.pow(b.d - .6, 1.6), b.cached && (b.d += .15 * c), b.d + (e.d - a.d) * c > a.d && (e = b)); break }
                    return e
                },
                k = function() {
                    var a, b = /(([^,\s].[^\s]+)\s+(\d+)w)/g,
                        c = /\s/,
                        d = function(b, c, d, e) { a.push({ c: c, u: d, w: 1 * e }) };
                    return function(e) { return a = [], e = e.trim(), e.replace(h, "").replace(b, d), a.length || !e || c.test(e) || a.push({ c: e, u: e, w: 99 }), a }
                }(),
                l = function() {
                    l.init || (l.init = !0, addEventListener("resize", function() {
                        var a, c = b.getElementsByClassName("lazymatchmedia"),
                            e = function() { var a, b; for (a = 0, b = c.length; b > a; a++) d(c[a]) };
                        return function() { clearTimeout(a), a = setTimeout(e, 66) }
                    }()))
                },
                m = function(b, d) { var f, g = b.getAttribute("srcset") || b.getAttribute(e.srcsetAttr);!g && d && (g = b._lazypolyfill ? b._lazypolyfill._set : b.getAttribute(e.srcAttr) || b.getAttribute("src")), b._lazypolyfill && b._lazypolyfill._set == g || (f = k(g || ""), d && b.parentNode && (f.isPicture = "PICTURE" == b.parentNode.nodeName.toUpperCase(), f.isPicture && a.matchMedia && (c.aC(b, "lazymatchmedia"), l())), f._set = g, Object.defineProperty(b, "_lazypolyfill", { value: f, writable: !0 })) },
                n = function(b) {
                    var d = a.devicePixelRatio || 1,
                        e = c.getX && c.getX(b);
                    return Math.min(e || d, 2.5, d)
                },
                o = function(b) { return a.matchMedia ? (o = function(a) { return !a || (matchMedia(a) || {}).matches })(b) : !b },
                p = function(a) {
                    var b, d, g, h, k, l, p;
                    if (h = a, m(h, !0), k = h._lazypolyfill, k.isPicture)
                        for (d = 0, b = a.parentNode.getElementsByTagName("source"), g = b.length; g > d; d++)
                            if (e.supportsType(b[d].getAttribute("type"), a) && o(b[d].getAttribute("media"))) { h = b[d], m(h), k = h._lazypolyfill; break }
                    return k.length > 1 ? (p = h.getAttribute("sizes") || "", p = i.test(p) && parseInt(p, 10) || c.gW(a, a.parentNode), k.d = n(a), !k.src || !k.w || k.w < p ? (k.w = p, l = j(k.sort(f)), k.src = l) : l = k.src) : l = k[0], l
                },
                q = function(a) {
                    if (!g || !a.parentNode || "PICTURE" == a.parentNode.nodeName.toUpperCase()) {
                        var b = p(a);
                        b && b.u && a._lazypolyfill.cur != b.u && (a._lazypolyfill.cur = b.u, b.cached = !0, a.setAttribute(e.srcAttr, b.u), a.setAttribute("src", b.u))
                    }
                };
            return q.parse = k, q
        }(), e.loadedClass && e.loadingClass && ! function() {
            var a = [];
            ['img[sizes$="px"][srcset].', "picture > img:not([srcset])."].forEach(function(b) { a.push(b + e.loadedClass), a.push(b + e.loadingClass) }), e.pf({ elements: b.querySelectorAll(a.join(", ")) })
        }()
    }
});
/*! lazysizes lg.object-fit.min.js - v4.0.1-beta1 */
! function(a, b) {
    var c = function(d) { b(a.lazySizes, d), a.removeEventListener("lazyunveilread", c, !0) };
    b = b.bind(null, a, a.document), "object" == typeof module && module.exports ? b(require("lazysizes")) : a.lazySizes ? c() : a.addEventListener("lazyunveilread", c, !0)
}(window, function(a, b, c, d) {
    "use strict";

    function e(a) {
        var b = getComputedStyle(a, null) || {},
            c = b.fontFamily || "",
            d = c.match(j) || "",
            e = d && c.match(k) || "";
        return e && (e = e[1]), { fit: d && d[1] || "", position: n[e] || e || "center" }
    }

    function f(a, b) {
        var d, e, f = c.cfg,
            g = a.cloneNode(!1),
            h = g.style,
            i = function() {
                var b = a.currentSrc || a.src;
                b && e !== b && (e = b, h.backgroundImage = "url(" + (m.test(b) ? JSON.stringify(b) : b) + ")", d || (d = !0, c.rC(g, f.loadingClass), c.aC(g, f.loadedClass)))
            },
            j = function() { c.rAF(i) };
        a._lazysizesParentFit = b.fit, a.addEventListener("lazyloaded", j, !0), a.addEventListener("load", j, !0), g.addEventListener("load", function() {
            var a = g.currentSrc || g.src;
            a && a != l && (g.src = l, g.srcset = "")
        }), c.rAF(function() {
            var d = a,
                e = a.parentNode;
            "PICTURE" == e.nodeName.toUpperCase() && (d = e, e = e.parentNode), c.rC(g, f.loadedClass), c.rC(g, f.lazyClass), c.aC(g, f.loadingClass), c.aC(g, f.objectFitClass || "lazysizes-display-clone"), g.getAttribute(f.srcsetAttr) && g.setAttribute(f.srcsetAttr, ""), g.getAttribute(f.srcAttr) && g.setAttribute(f.srcAttr, ""), g.src = l, g.srcset = "", h.backgroundRepeat = "no-repeat", h.backgroundPosition = b.position, h.backgroundSize = b.fit, d.style.display = "none", a.setAttribute("data-parent-fit", b.fit), a.setAttribute("data-parent-container", "prev"), e.insertBefore(g, d), a._lazysizesParentFit && delete a._lazysizesParentFit, a.complete && i()
        })
    }
    var g = b.createElement("a").style,
        h = "objectFit" in g,
        i = h && "objectPosition" in g,
        j = /object-fit["']*\s*:\s*["']*(contain|cover)/,
        k = /object-position["']*\s*:\s*["']*(.+?)(?=($|,|'|"|;))/,
        l = "data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==",
        m = /\(|\)|'/,
        n = { center: "center", "50% 50%": "center" };
    if (!h || !i) {
        var o = function(a) {
            if (a.detail.instance == c) {
                var b = a.target,
                    d = e(b);
                !d.fit || h && "center" == d.position || f(b, d)
            }
        };
        a.addEventListener("lazyunveilread", o, !0), d && d.detail && o(d)
    }
});
/*! lazysizes ls.bgset.min.js - v4.0.0-rc4 */
! function(a, b) {
    var c = function() { b(a.lazySizes), a.removeEventListener("lazyunveilread", c, !0) };
    b = b.bind(null, a, a.document), "object" == typeof module && module.exports ? b(require("lazysizes")) : a.lazySizes ? c() : a.addEventListener("lazyunveilread", c, !0)
}(window, function(a, b, c) {
    "use strict";
    if (a.addEventListener) {
        var d = /\s+/g,
            e = /\s*\|\s+|\s+\|\s*/g,
            f = /^(.+?)(?:\s+\[\s*(.+?)\s*\])?$/,
            g = /\(|\)|'/,
            h = { contain: 1, cover: 1 },
            i = function(a) { var b = c.gW(a, a.parentNode); return (!a._lazysizesWidth || b > a._lazysizesWidth) && (a._lazysizesWidth = b), a._lazysizesWidth },
            j = function(a) { var b; return b = (getComputedStyle(a) || { getPropertyValue: function() {} }).getPropertyValue("background-size"), !h[b] && h[a.style.backgroundSize] && (b = a.style.backgroundSize), b },
            k = function(a, c, g) {
                var h = b.createElement("picture"),
                    i = c.getAttribute(lazySizesConfig.sizesAttr),
                    j = c.getAttribute("data-ratio"),
                    k = c.getAttribute("data-optimumx");
                c._lazybgset && c._lazybgset.parentNode == c && c.removeChild(c._lazybgset), Object.defineProperty(g, "_lazybgset", { value: c, writable: !0 }), Object.defineProperty(c, "_lazybgset", { value: h, writable: !0 }), a = a.replace(d, " ").split(e), h.style.display = "none", g.className = lazySizesConfig.lazyClass, 1 != a.length || i || (i = "auto"), a.forEach(function(a) {
                    var c = b.createElement("source");
                    i && "auto" != i && c.setAttribute("sizes", i), a.match(f) && (c.setAttribute(lazySizesConfig.srcsetAttr, RegExp.$1), RegExp.$2 && c.setAttribute("media", lazySizesConfig.customMedia[RegExp.$2] || RegExp.$2)), h.appendChild(c)
                }), i && (g.setAttribute(lazySizesConfig.sizesAttr, i), c.removeAttribute(lazySizesConfig.sizesAttr), c.removeAttribute("sizes")), k && g.setAttribute("data-optimumx", k), j && g.setAttribute("data-ratio", j), h.appendChild(g), c.appendChild(h)
            },
            l = function(a) {
                if (a.target._lazybgset) {
                    var b = a.target,
                        d = b._lazybgset,
                        e = b.currentSrc || b.src;
                    e && (d.style.backgroundImage = "url(" + (g.test(e) ? JSON.stringify(e) : e) + ")"), b._lazybgsetLoading && (c.fire(d, "_lazyloaded", {}, !1, !0), delete b._lazybgsetLoading)
                }
            };
        addEventListener("lazybeforeunveil", function(a) { var d, e, f;!a.defaultPrevented && (d = a.target.getAttribute("data-bgset")) && (f = a.target, e = b.createElement("img"), e.alt = "", e._lazybgsetLoading = !0, a.detail.firesLoad = !0, k(d, f, e), setTimeout(function() { c.loader.unveil(e), c.rAF(function() { c.fire(e, "_lazyloaded", {}, !0, !0), e.complete && l({ target: e }) }) })) }), b.addEventListener("load", l, !0), a.addEventListener("lazybeforesizes", function(a) {
            if (a.detail.instance == c && a.target._lazybgset && a.detail.dataAttr) {
                var b = a.target._lazybgset,
                    d = j(b);
                h[d] && (a.target._lazysizesParentFit = d, c.rAF(function() { a.target.setAttribute("data-parent-fit", d), a.target._lazysizesParentFit && delete a.target._lazysizesParentFit }))
            }
        }, !0), b.documentElement.addEventListener("lazybeforesizes", function(a) {!a.defaultPrevented && a.target._lazybgset && a.detail.instance == c && (a.detail.width = i(a.target._lazybgset)) })
    }
});
/*! lazysizes - v4.0.0-rc4 */
! function(a, b) {
    var c = b(a, a.document);
    a.lazySizes = c, "object" == typeof module && module.exports && (module.exports = c)
}(window, function(a, b) {
    "use strict";
    if (b.getElementsByClassName) {
        var c, d, e = b.documentElement,
            f = a.Date,
            g = a.HTMLPictureElement,
            h = "addEventListener",
            i = "getAttribute",
            j = a[h],
            k = a.setTimeout,
            l = a.requestAnimationFrame || k,
            m = a.requestIdleCallback,
            n = /^picture$/i,
            o = ["load", "error", "lazyincluded", "_lazyloaded"],
            p = {},
            q = Array.prototype.forEach,
            r = function(a, b) { return p[b] || (p[b] = new RegExp("(\\s|^)" + b + "(\\s|$)")), p[b].test(a[i]("class") || "") && p[b] },
            s = function(a, b) { r(a, b) || a.setAttribute("class", (a[i]("class") || "").trim() + " " + b) },
            t = function(a, b) {
                var c;
                (c = r(a, b)) && a.setAttribute("class", (a[i]("class") || "").replace(c, " "))
            },
            u = function(a, b, c) {
                var d = c ? h : "removeEventListener";
                c && u(a, b), o.forEach(function(c) { a[d](c, b) })
            },
            v = function(a, d, e, f, g) { var h = b.createEvent("CustomEvent"); return e || (e = {}), e.instance = c, h.initCustomEvent(d, !f, !g, e), a.dispatchEvent(h), h },
            w = function(b, c) { var e;!g && (e = a.picturefill || d.pf) ? e({ reevaluate: !0, elements: [b] }) : c && c.src && (b.src = c.src) },
            x = function(a, b) { return (getComputedStyle(a, null) || {})[b] },
            y = function(a, b, c) { for (c = c || a.offsetWidth; c < d.minSize && b && !a._lazysizesWidth;) c = b.offsetWidth, b = b.parentNode; return c },
            z = function() {
                var a, c, d = [],
                    e = [],
                    f = d,
                    g = function() {
                        var b = f;
                        for (f = d.length ? e : d, a = !0, c = !1; b.length;) b.shift()();
                        a = !1
                    },
                    h = function(d, e) { a && !e ? d.apply(this, arguments) : (f.push(d), c || (c = !0, (b.hidden ? k : l)(g))) };
                return h._lsFlush = g, h
            }(),
            A = function(a, b) {
                return b ? function() { z(a) } : function() {
                    var b = this,
                        c = arguments;
                    z(function() { a.apply(b, c) })
                }
            },
            B = function(a) {
                var b, c = 0,
                    e = 125,
                    g = d.ricTimeout,
                    h = function() { b = !1, c = f.now(), a() },
                    i = m && d.ricTimeout ? function() { m(h, { timeout: g }), g !== d.ricTimeout && (g = d.ricTimeout) } : A(function() { k(h) }, !0);
                return function(a) {
                    var d;
                    (a = a === !0) && (g = 33), b || (b = !0, d = e - (f.now() - c), 0 > d && (d = 0), a || 9 > d && m ? i() : k(i, d))
                }
            },
            C = function(a) {
                var b, c, d = 99,
                    e = function() { b = null, a() },
                    g = function() {
                        var a = f.now() - c;
                        d > a ? k(g, d - a) : (m || e)(e)
                    };
                return function() { c = f.now(), b || (b = k(g, d)) }
            };
        ! function() {
            var b, c = { lazyClass: "lazyload", loadedClass: "lazyloaded", loadingClass: "lazyloading", preloadClass: "lazypreload", errorClass: "lazyerror", autosizesClass: "lazyautosizes", srcAttr: "data-src", srcsetAttr: "data-srcset", sizesAttr: "data-sizes", minSize: 40, customMedia: {}, init: !0, expFactor: 1.5, hFac: .8, loadMode: 2, loadHidden: !0, ricTimeout: 300 };
            d = a.lazySizesConfig || a.lazysizesConfig || {};
            for (b in c) b in d || (d[b] = c[b]);
            a.lazySizesConfig = d, k(function() { d.init && F() })
        }();
        var D = function() {
                var g, l, m, o, p, y, D, F, G, H, I, J, K, L, M = /^img$/i,
                    N = /^iframe$/i,
                    O = "onscroll" in a && !/glebot/.test(navigator.userAgent),
                    P = 0,
                    Q = 0,
                    R = 0,
                    S = -1,
                    T = function(a) { R--, a && a.target && u(a.target, T), (!a || 0 > R || !a.target) && (R = 0) },
                    U = function(a, c) {
                        var d, f = a,
                            g = "hidden" == x(b.body, "visibility") || "hidden" != x(a, "visibility");
                        for (F -= c, I += c, G -= c, H += c; g && (f = f.offsetParent) && f != b.body && f != e;) g = (x(f, "opacity") || 1) > 0, g && "visible" != x(f, "overflow") && (d = f.getBoundingClientRect(), g = H > d.left && G < d.right && I > d.top - 1 && F < d.bottom + 1);
                        return g
                    },
                    V = function() {
                        var a, f, h, j, k, m, n, p, q, r = c.elements;
                        if ((o = d.loadMode) && 8 > R && (a = r.length)) {
                            f = 0, S++, null == K && ("expand" in d || (d.expand = e.clientHeight > 500 && e.clientWidth > 500 ? 500 : 370), J = d.expand, K = J * d.expFactor), K > Q && 1 > R && S > 2 && o > 2 && !b.hidden ? (Q = K, S = 0) : Q = o > 1 && S > 1 && 6 > R ? J : P;
                            for (; a > f; f++)
                                if (r[f] && !r[f]._lazyRace)
                                    if (O)
                                        if ((p = r[f][i]("data-expand")) && (m = 1 * p) || (m = Q), q !== m && (y = innerWidth + m * L, D = innerHeight + m, n = -1 * m, q = m), h = r[f].getBoundingClientRect(), (I = h.bottom) >= n && (F = h.top) <= D && (H = h.right) >= n * L && (G = h.left) <= y && (I || H || G || F) && (d.loadHidden || "hidden" != x(r[f], "visibility")) && (l && 3 > R && !p && (3 > o || 4 > S) || U(r[f], m))) { if (ba(r[f]), k = !0, R > 9) break } else !k && l && !j && 4 > R && 4 > S && o > 2 && (g[0] || d.preloadAfterLoad) && (g[0] || !p && (I || H || G || F || "auto" != r[f][i](d.sizesAttr))) && (j = g[0] || r[f]);
                            else ba(r[f]);
                            j && !k && ba(j)
                        }
                    },
                    W = B(V),
                    X = function(a) { s(a.target, d.loadedClass), t(a.target, d.loadingClass), u(a.target, Z), v(a.target, "lazyloaded") },
                    Y = A(X),
                    Z = function(a) { Y({ target: a.target }) },
                    $ = function(a, b) { try { a.contentWindow.location.replace(b) } catch (c) { a.src = b } },
                    _ = function(a) {
                        var b, c = a[i](d.srcsetAttr);
                        (b = d.customMedia[a[i]("data-media") || a[i]("media")]) && a.setAttribute("media", b), c && a.setAttribute("srcset", c)
                    },
                    aa = A(function(a, b, c, e, f) {
                        var g, h, j, l, o, p;
                        (o = v(a, "lazybeforeunveil", b)).defaultPrevented || (e && (c ? s(a, d.autosizesClass) : a.setAttribute("sizes", e)), h = a[i](d.srcsetAttr), g = a[i](d.srcAttr), f && (j = a.parentNode, l = j && n.test(j.nodeName || "")), p = b.firesLoad || "src" in a && (h || g || l), o = { target: a }, p && (u(a, T, !0), clearTimeout(m), m = k(T, 2500), s(a, d.loadingClass), u(a, Z, !0)), l && q.call(j.getElementsByTagName("source"), _), h ? a.setAttribute("srcset", h) : g && !l && (N.test(a.nodeName) ? $(a, g) : a.src = g), f && (h || l) && w(a, { src: g })), a._lazyRace && delete a._lazyRace, t(a, d.lazyClass), z(function() {
                            (!p || a.complete && a.naturalWidth > 1) && (p ? T(o) : R--, X(o))
                        }, !0)
                    }),
                    ba = function(a) {
                        var b, c = M.test(a.nodeName),
                            e = c && (a[i](d.sizesAttr) || a[i]("sizes")),
                            f = "auto" == e;
                        (!f && l || !c || !a[i]("src") && !a.srcset || a.complete || r(a, d.errorClass) || !r(a, d.lazyClass)) && (b = v(a, "lazyunveilread").detail, f && E.updateElem(a, !0, a.offsetWidth), a._lazyRace = !0, R++, aa(a, b, f, e, c))
                    },
                    ca = function() {
                        if (!l) {
                            if (f.now() - p < 999) return void k(ca, 999);
                            var a = C(function() { d.loadMode = 3, W() });
                            l = !0, d.loadMode = 3, W(), j("scroll", function() { 3 == d.loadMode && (d.loadMode = 2), a() }, !0)
                        }
                    };
                return { _: function() { p = f.now(), c.elements = b.getElementsByClassName(d.lazyClass), g = b.getElementsByClassName(d.lazyClass + " " + d.preloadClass), L = d.hFac, j("scroll", W, !0), j("resize", W, !0), a.MutationObserver ? new MutationObserver(W).observe(e, { childList: !0, subtree: !0, attributes: !0 }) : (e[h]("DOMNodeInserted", W, !0), e[h]("DOMAttrModified", W, !0), setInterval(W, 999)), j("hashchange", W, !0), ["focus", "mouseover", "click", "load", "transitionend", "animationend", "webkitAnimationEnd"].forEach(function(a) { b[h](a, W, !0) }), /d$|^c/.test(b.readyState) ? ca() : (j("load", ca), b[h]("DOMContentLoaded", W), k(ca, 2e4)), c.elements.length ? (V(), z._lsFlush()) : W() }, checkElems: W, unveil: ba }
            }(),
            E = function() {
                var a, c = A(function(a, b, c, d) {
                        var e, f, g;
                        if (a._lazysizesWidth = d, d += "px", a.setAttribute("sizes", d), n.test(b.nodeName || ""))
                            for (e = b.getElementsByTagName("source"), f = 0, g = e.length; g > f; f++) e[f].setAttribute("sizes", d);
                        c.detail.dataAttr || w(a, c.detail)
                    }),
                    e = function(a, b, d) {
                        var e, f = a.parentNode;
                        f && (d = y(a, f, d), e = v(a, "lazybeforesizes", { width: d, dataAttr: !!b }), e.defaultPrevented || (d = e.detail.width, d && d !== a._lazysizesWidth && c(a, f, e, d)))
                    },
                    f = function() {
                        var b, c = a.length;
                        if (c)
                            for (b = 0; c > b; b++) e(a[b])
                    },
                    g = C(f);
                return { _: function() { a = b.getElementsByClassName(d.autosizesClass), j("resize", g) }, checkElems: g, updateElem: e }
            }(),
            F = function() { F.i || (F.i = !0, E._(), D._()) };
        return c = { cfg: d, autoSizer: E, loader: D, init: F, uP: w, aC: s, rC: t, hC: r, fire: v, gW: y, rAF: z }
    }
});
/*! ls.parent-fit.min.js - lazysizes - v4.0.0-rc4 */
! function(a, b) {
    var c = function() { b(a.lazySizes), a.removeEventListener("lazyunveilread", c, !0) };
    b = b.bind(null, a, a.document), "object" == typeof module && module.exports ? b(require("lazysizes")) : a.lazySizes ? c() : a.addEventListener("lazyunveilread", c, !0)
}(window, function(a, b, c) {
    "use strict";
    if (a.addEventListener) {
        var d = /\s+(\d+)(w|h)\s+(\d+)(w|h)/,
            e = /parent-fit["']*\s*:\s*["']*(contain|cover|width)/,
            f = /parent-container["']*\s*:\s*["']*(.+?)(?=(\s|$|,|'|"|;))/,
            g = /^picture$/i,
            h = function(a) { return getComputedStyle(a, null) || {} },
            i = {
                getParent: function(b, c) {
                    var d = b,
                        e = b.parentNode;
                    return c && "prev" != c || !e || !g.test(e.nodeName || "") || (e = e.parentNode), "self" != c && (d = "prev" == c ? b.previousElementSibling : c && (e.closest || a.jQuery) ? (e.closest ? e.closest(c) : jQuery(e).closest(c)[0]) || e : e), d
                },
                getFit: function(a) {
                    var b, c, d = h(a),
                        g = d.content || d.fontFamily,
                        j = { fit: a._lazysizesParentFit || a.getAttribute("data-parent-fit") };
                    return !j.fit && g && (b = g.match(e)) && (j.fit = b[1]), j.fit ? (c = a._lazysizesParentContainer || a.getAttribute("data-parent-container"), !c && g && (b = g.match(f)) && (c = b[1]), j.parent = i.getParent(a, c)) : j.fit = d.objectFit, j
                },
                getImageRatio: function(b) {
                    var c, e, f, h, i = b.parentNode,
                        j = i && g.test(i.nodeName || "") ? i.querySelectorAll("source, img") : [b];
                    for (c = 0; c < j.length; c++)
                        if (b = j[c], e = b.getAttribute(lazySizesConfig.srcsetAttr) || b.getAttribute("srcset") || b.getAttribute("data-pfsrcset") || b.getAttribute("data-risrcset") || "", f = b._lsMedia || b.getAttribute("media"), f = lazySizesConfig.customMedia[b.getAttribute("data-media") || f] || f, e && (!f || (a.matchMedia && matchMedia(f) || {}).matches)) { h = parseFloat(b.getAttribute("data-aspectratio")), !h && e.match(d) && (h = "w" == RegExp.$2 ? RegExp.$1 / RegExp.$3 : RegExp.$3 / RegExp.$1); break }
                    return h
                },
                calculateSize: function(a, b) {
                    var c, d, e, f, g = this.getFit(a),
                        h = g.fit,
                        i = g.parent;
                    return "width" == h || ("contain" == h || "cover" == h) && (e = this.getImageRatio(a)) ? (i ? b = i.clientWidth : i = a, f = b, "width" == h ? f = b : (d = i.clientHeight, d > 40 && (c = b / d) && ("cover" == h && e > c || "contain" == h && c > e) && (f = b * (e / c))), f) : b
                }
            };
        c.parentFit = i, b.addEventListener("lazybeforesizes", function(a) {
            if (!a.defaultPrevented && a.detail.instance == c) {
                var b = a.target;
                a.detail.width = i.calculateSize(b, a.detail.width)
            }
        })
    }
});
/*! lazysizes - unveilhooks - v5.1.0 */
! function(a, b) {
    var c = function() { b(a.lazySizes), a.removeEventListener("lazyunveilread", c, !0) };
    b = b.bind(null, a, a.document), "object" == typeof module && module.exports ? b(require("lazysizes")) : a.lazySizes ? c() : a.addEventListener("lazyunveilread", c, !0)
}(window, function(a, b, c) {
    "use strict";

    function d(a, c) {
        if (!g[a]) {
            var d = b.createElement(c ? "link" : "script"),
                e = b.getElementsByTagName("script")[0];
            c ? (d.rel = "stylesheet", d.href = a) : d.src = a, g[a] = !0, g[d.src || d.href] = !0, e.parentNode.insertBefore(d, e)
        }
    }
    var e, f, g = {};
    b.addEventListener && (f = /\(|\)|\s|'/, e = function(a, c) {
        var d = b.createElement("img");
        d.onload = function() { d.onload = null, d.onerror = null, d = null, c() }, d.onerror = d.onload, d.src = a, d && d.complete && d.onload && d.onload()
    }, addEventListener("lazybeforeunveil", function(a) {
        if (a.detail.instance == c) {
            var b, g, h, i;
            a.defaultPrevented || ("none" == a.target.preload && (a.target.preload = "auto"), b = a.target.getAttribute("data-link"), b && d(b, !0), b = a.target.getAttribute("data-script"), b && d(b), b = a.target.getAttribute("data-require"), b && (c.cfg.requireJs ? c.cfg.requireJs([b]) : d(b)), h = a.target.getAttribute("data-bg"), h && (a.detail.firesLoad = !0, g = function() { a.target.style.backgroundImage = "url(" + (f.test(h) ? JSON.stringify(h) : h) + ")", a.detail.firesLoad = !1, c.fire(a.target, "_lazyloaded", {}, !0, !0) }, e(h, g)), (i = a.target.getAttribute("data-poster")) && (a.detail.firesLoad = !0, g = function() { a.target.poster = i, a.detail.firesLoad = !1, c.fire(a.target, "_lazyloaded", {}, !0, !0) }, e(i, g)))
        }
    }, !1))
});




/*!
 * lodash.core.min.js
 */
/**
 * @license
 * lodash 4.5.1 (Custom Build) lodash.com/license | Underscore.js 1.8.3 underscorejs.org/LICENSE
 * Build: `lodash core -o ./dist/lodash.core.js`
 */
if (function() {
        function e(e, t) { for (var n = -1, i = t.length, r = e.length; ++n < i;) e[r + n] = t[n]; return e }

        function t(e, t, n) {
            for (var i = -1, r = e.length; ++i < r;) {
                var o = e[i],
                    s = t(o);
                if (null != s && (a === le ? s === s : n(s, a))) var a = s,
                    l = o
            }
            return l
        }

        function n(e, t, n) { var i; return n(e, function(e, n, r) { return t(e, n, r) ? (i = e, !1) : void 0 }), i }

        function i(e, t, n, i, r) { return r(e, function(e, r, o) { n = i ? (i = !1, e) : t(n, e, r, o) }), n }

        function r(e, t) { return S(t, function(t) { return e[t] }) }

        function o(e) { return e && e.Object === Object ? e : null }

        function s(e) { return he[e] }

        function a(e) {
            var t = !1;
            if (null != e && "function" != typeof e.toString) try { t = !!(e + "") } catch (e) {}
            return t
        }

        function l(e, t) { return e = "number" == typeof e || de.test(e) ? +e : -1, e > -1 && 0 == e % 1 && (null == t ? 9007199254740991 : t) > e }

        function c(e) { if (Q(e) && !Fe(e)) { if (e instanceof u) return e; if (Te.call(e, "__wrapped__")) { var t = new u(e.__wrapped__, e.__chain__); return t.__actions__ = $(e.__actions__), t } } return new u(e) }

        function u(e, t) { this.__wrapped__ = e, this.__actions__ = [], this.__chain__ = !!t }

        function p(e, t, n, i) { var r; return (r = e === le) || (r = Se[n], r = (e === r || e !== e && r !== r) && !Te.call(i, n)), r ? t : e }

        function d(e) { return J(e) ? Ae(e) : {} }

        function h(e, t, n) { if ("function" != typeof e) throw new TypeError("Expected a function"); return setTimeout(function() { e.apply(le, n) }, t) }

        function f(e, t) { var n = !0; return je(e, function(e, i, r) { return n = !!t(e, i, r) }), n }

        function v(e, t) { var n = []; return je(e, function(e, i, r) { t(e, i, r) && n.push(e) }), n }

        function g(t, n, i, r) {
            r || (r = []);
            for (var o = -1, s = t.length; ++o < s;) {
                var a = t[o];
                n > 0 && Q(a) && K(a) && (i || Fe(a) || X(a)) ? n > 1 ? g(a, n - 1, i, r) : e(r, a) : i || (r[r.length] = a)
            }
            return r
        }

        function m(e, t) { return e && He(e, t, ie) }

        function y(e, t) { return v(t, function(t) { return Y(e[t]) }) }

        function b(e, t, n, i, r) { return e === t || (null == e || null == t || !J(e) && !Q(t) ? e !== e && t !== t : k(e, t, b, n, i, r)) }

        function k(e, t, n, i, r, o) {
            var s = Fe(e),
                l = Fe(t),
                c = "[object Array]",
                u = "[object Array]";
            s || (c = Ee.call(e), "[object Arguments]" == c && (c = "[object Object]")), l || (u = Ee.call(t), "[object Arguments]" == u && (u = "[object Object]"));
            var p = "[object Object]" == c && !a(e),
                l = "[object Object]" == u && !a(t);
            return !(u = c == u) || s || p ? 2 & r || (c = p && Te.call(e, "__wrapped__"), l = l && Te.call(t, "__wrapped__"), !c && !l) ? !!u && (o || (o = []), (c = B(o, function(t) { return t[0] === e })) && c[1] ? c[1] == t : (o.push([e, t]), t = (s ? j : I)(e, t, n, i, r, o), o.pop(), t)) : n(c ? e.value() : e, l ? t.value() : t, i, r, o) : H(e, t, c)
        }

        function w(e) { var t = typeof e; return "function" == t ? e : null == e ? se : ("object" == t ? T : E)(e) }

        function x(e) { e = null == e ? e : Object(e); var t, n = []; for (t in e) n.push(t); return n }

        function S(e, t) {
            var n = -1,
                i = K(e) ? Array(e.length) : [];
            return je(e, function(e, r, o) { i[++n] = t(e, r, o) }), i
        }

        function T(e) { var t = ie(e); return function(n) { var i = t.length; if (null == n) return !i; for (n = Object(n); i--;) { var r = t[i]; if (!(r in n && b(e[r], n[r], le, 3))) return !1 } return !0 } }

        function C(e, t) { return e = Object(e), z(t, function(t, n) { return n in e && (t[n] = e[n]), t }, {}) }

        function E(e) { return function(t) { return null == t ? le : t[e] } }

        function P(e, t, n) {
            var i = -1,
                r = e.length;
            for (0 > t && (t = -t > r ? 0 : r + t), n = n > r ? r : n, 0 > n && (n += r), r = t > n ? 0 : n - t >>> 0, t >>>= 0, n = Array(r); ++i < r;) n[i] = e[i + t];
            return n
        }

        function $(e) { return P(e, 0, e.length) }

        function _(e, t) { var n; return je(e, function(e, i, r) { return n = t(e, i, r), !n }), !!n }

        function A(t, n) { return z(n, function(t, n) { return n.func.apply(n.thisArg, e([t], n.args)) }, t) }

        function N(e, t, n, i) {
            n || (n = {});
            for (var r = -1, o = t.length; ++r < o;) {
                var s = t[r],
                    a = i ? i(n[s], e[s], s, n, e) : e[s],
                    l = n,
                    c = l[s];
                Te.call(l, s) && (c === a || c !== c && a !== a) && (a !== le || s in l) || (l[s] = a)
            }
            return n
        }

        function L(e) {
            return U(function(t, n) {
                var i = -1,
                    r = n.length,
                    o = r > 1 ? n[r - 1] : le,
                    o = "function" == typeof o ? (r--, o) : le;
                for (t = Object(t); ++i < r;) {
                    var s = n[i];
                    s && e(t, s, i, o)
                }
                return t
            })
        }

        function O(e) {
            return function() {
                var t = arguments,
                    n = d(e.prototype),
                    t = e.apply(n, t);
                return J(t) ? t : n
            }
        }

        function D(e, t, n) {
            function i() { for (var o = -1, s = arguments.length, a = -1, l = n.length, c = Array(l + s), u = this && this !== we && this instanceof i ? r : e; ++a < l;) c[a] = n[a]; for (; s--;) c[a++] = arguments[++o]; return u.apply(t, c) }
            if ("function" != typeof e) throw new TypeError("Expected a function");
            var r = O(e);
            return i
        }

        function j(e, t, n, i, r, o) {
            var s = -1,
                a = 1 & r,
                l = e.length,
                c = t.length;
            if (l != c && !(2 & r && c > l)) return !1;
            for (c = !0; ++s < l;) {
                var u = e[s],
                    p = t[s];
                if (void 0 !== le) { c = !1; break }
                if (a) { if (!_(t, function(e) { return u === e || n(u, e, i, r, o) })) { c = !1; break } } else if (u !== p && !n(u, p, i, r, o)) { c = !1; break }
            }
            return c
        }

        function H(e, t, n) {
            switch (n) {
                case "[object Boolean]":
                case "[object Date]":
                    return +e == +t;
                case "[object Error]":
                    return e.name == t.name && e.message == t.message;
                case "[object Number]":
                    return e != +e ? t != +t : e == +t;
                case "[object RegExp]":
                case "[object String]":
                    return e == t + ""
            }
            return !1
        }

        function I(e, t, n, i, r, o) {
            var s = 2 & r,
                a = ie(e),
                l = a.length,
                c = ie(t).length;
            if (l != c && !s) return !1;
            for (var u = l; u--;) { var p = a[u]; if (!(s ? p in t : Te.call(t, p))) return !1 }
            for (c = !0; ++u < l;) {
                var p = a[u],
                    d = e[p],
                    h = t[p];
                if (void 0 !== le || d !== h && !n(d, h, i, r, o)) { c = !1; break }
                s || (s = "constructor" == p)
            }
            return c && !s && (n = e.constructor, i = t.constructor, n != i && "constructor" in e && "constructor" in t && !("function" == typeof n && n instanceof n && "function" == typeof i && i instanceof i) && (c = !1)), c
        }

        function M(e) {
            var t = e ? e.length : le;
            if (G(t) && (Fe(e) || ee(e) || X(e))) {
                e = String;
                for (var n = -1, i = Array(t); ++n < t;) i[n] = e(n);
                t = i
            } else t = null;
            return t
        }

        function R(e) {
            var t = e && e.constructor,
                t = Y(t) && t.prototype || Se;
            return e === t
        }

        function q(e) { return e ? e[0] : le }

        function B(e, t) { return n(e, w(t), je) }

        function F(e, t) { return je(e, "function" == typeof t ? t : se) }

        function z(e, t, n) { return i(e, w(t), n, 3 > arguments.length, je) }

        function W(e, t) {
            var n;
            if ("function" != typeof t) throw new TypeError("Expected a function");
            return e = ze(e),
                function() { return 0 < --e && (n = t.apply(this, arguments)), 1 >= e && (t = le), n }
        }

        function U(e) {
            var t;
            if ("function" != typeof e) throw new TypeError("Expected a function");
            return t = De(t === le ? e.length - 1 : ze(t), 0),
                function() { for (var n = arguments, i = -1, r = De(n.length - t, 0), o = Array(r); ++i < r;) o[i] = n[t + i]; for (r = Array(t + 1), i = -1; ++i < t;) r[i] = n[i]; return r[t] = o, e.apply(this, r) }
        }

        function V(e, t) { return e > t }

        function X(e) { return Q(e) && K(e) && Te.call(e, "callee") && (!Ne.call(e, "callee") || "[object Arguments]" == Ee.call(e)) }

        function K(e) { return null != e && !("function" == typeof e && Y(e)) && G(Ie(e)) }

        function Y(e) { return e = J(e) ? Ee.call(e) : "", "[object Function]" == e || "[object GeneratorFunction]" == e }

        function G(e) { return "number" == typeof e && e > -1 && 0 == e % 1 && 9007199254740991 >= e }

        function J(e) { var t = typeof e; return !!e && ("object" == t || "function" == t) }

        function Q(e) { return !!e && "object" == typeof e }

        function Z(e) { return "number" == typeof e || Q(e) && "[object Number]" == Ee.call(e) }

        function ee(e) { return "string" == typeof e || !Fe(e) && Q(e) && "[object String]" == Ee.call(e) }

        function te(e, t) { return t > e }

        function ne(e) { return "string" == typeof e ? e : null == e ? "" : e + "" }

        function ie(e) {
            var t = R(e);
            if (!t && !K(e)) return Oe(Object(e));
            var n, i = M(e),
                r = !!i,
                i = i || [],
                o = i.length;
            for (n in e) !Te.call(e, n) || r && ("length" == n || l(n, o)) || t && "constructor" == n || i.push(n);
            return i
        }

        function re(e) {
            for (var t = -1, n = R(e), i = x(e), r = i.length, o = M(e), s = !!o, o = o || [], a = o.length; ++t < r;) {
                var c = i[t];
                s && ("length" == c || l(c, a)) || "constructor" == c && (n || !Te.call(e, c)) || o.push(c)
            }
            return o
        }

        function oe(e) { return e ? r(e, ie(e)) : [] }

        function se(e) { return e }

        function ae(t, n, i) {
            var r = ie(n),
                o = y(n, r);
            null != i || J(n) && (o.length || !r.length) || (i = n, n = t, t = this, o = y(n, ie(n)));
            var s = !(J(i) && "chain" in i) || i.chain,
                a = Y(t);
            return je(o, function(i) {
                var r = n[i];
                t[i] = r, a && (t.prototype[i] = function() { var n = this.__chain__; if (s || n) { var i = t(this.__wrapped__); return (i.__actions__ = $(this.__actions__)).push({ func: r, args: arguments, thisArg: t }), i.__chain__ = n, i } return r.apply(t, e([this.value()], arguments)) })
            }), t
        }
        var le, ce = 1 / 0,
            ue = /[&<>"'`]/g,
            pe = RegExp(ue.source),
            de = /^(?:0|[1-9]\d*)$/,
            he = { "&": "&amp;", "<": "&lt;", ">": "&gt;", '"': "&quot;", "'": "&#39;", "`": "&#96;" },
            fe = { function: !0, object: !0 },
            ve = fe[typeof exports] && exports && !exports.nodeType ? exports : le,
            ge = fe[typeof module] && module && !module.nodeType ? module : le,
            me = ge && ge.exports === ve ? ve : le,
            ye = o(fe[typeof self] && self),
            be = o(fe[typeof window] && window),
            ke = o(fe[typeof this] && this),
            we = o(ve && ge && "object" == typeof global && global) || be !== (ke && ke.window) && be || ye || ke || Function("return this")(),
            xe = Array.prototype,
            Se = Object.prototype,
            Te = Se.hasOwnProperty,
            Ce = 0,
            Ee = Se.toString,
            Pe = we._,
            $e = we.Reflect,
            _e = $e ? $e.f : le,
            Ae = Object.create,
            Ne = Se.propertyIsEnumerable,
            Le = we.isFinite,
            Oe = Object.keys,
            De = Math.max,
            je = function(e, t) {
                return function(n, i) {
                    if (null == n) return n;
                    if (!K(n)) return e(n, i);
                    for (var r = n.length, o = t ? r : -1, s = Object(n);
                        (t ? o-- : ++o < r) && !1 !== i(s[o], o, s););
                    return n
                }
            }(m),
            He = function(e) {
                return function(t, n, i) {
                    var r = -1,
                        o = Object(t);
                    i = i(t);
                    for (var s = i.length; s--;) { var a = i[e ? s : ++r]; if (!1 === n(o[a], a, o)) break }
                    return t
                }
            }();
        _e && !Ne.call({ valueOf: 1 }, "valueOf") && (x = function(e) { e = _e(e); for (var t, n = []; !(t = e.next()).done;) n.push(t.value); return n });
        var Ie = E("length"),
            Me = U(function(t, n) { return Fe(t) || (t = null == t ? [] : [Object(t)]), g(n, 1), e($(t), oe) }),
            Re = U(function(e, t, n) { return D(e, t, n) }),
            qe = U(function(e, t) { return h(e, 1, t) }),
            Be = U(function(e, t, n) { return h(e, We(t) || 0, n) }),
            Fe = Array.isArray,
            ze = Number,
            We = Number,
            Ue = L(function(e, t) { N(t, ie(t), e) }),
            Ve = L(function(e, t) { N(t, re(t), e) }),
            Xe = L(function(e, t, n, i) { N(t, re(t), e, i) }),
            Ke = U(function(e) { return e.push(le, p), Xe.apply(le, e) }),
            Ye = U(function(e, t) { return null == e ? {} : C(e, g(t, 1)) }),
            Ge = w;
        u.prototype = d(c.prototype), u.prototype.constructor = u, c.assignIn = Ve, c.before = W, c.bind = Re, c.chain = function(e) { return e = c(e), e.__chain__ = !0, e }, c.compact = function(e) { return v(e, Boolean) }, c.concat = Me, c.create = function(e, t) { var n = d(e); return t ? Ue(n, t) : n }, c.defaults = Ke, c.defer = qe, c.delay = Be, c.filter = function(e, t) { return v(e, w(t)) }, c.flatten = function(e) { return e && e.length ? g(e, 1) : [] }, c.flattenDeep = function(e) { return e && e.length ? g(e, ce) : [] }, c.iteratee = Ge, c.keys = ie, c.map = function(e, t) { return S(e, w(t)) }, c.matches = function(e) { return T(Ue({}, e)) }, c.mixin = ae, c.negate = function(e) { if ("function" != typeof e) throw new TypeError("Expected a function"); return function() { return !e.apply(this, arguments) } }, c.once = function(e) { return W(2, e) }, c.pick = Ye, c.slice = function(e, t, n) { var i = e ? e.length : 0; return n = n === le ? i : +n, i ? P(e, null == t ? 0 : +t, n) : [] }, c.sortBy = function(e, t) {
            var n = 0;
            return t = w(t), S(S(e, function(e, i, r) { return { c: e, b: n++, a: t(e, i, r) } }).sort(function(e, t) {
                var n;
                e: {
                    n = e.a;
                    var i = t.a;
                    if (n !== i) {
                        var r = null === n,
                            o = n === le,
                            s = n === n,
                            a = null === i,
                            l = i === le,
                            c = i === i;
                        if (n > i && !a || !s || r && !l && c || o && c) { n = 1; break e }
                        if (i > n && !r || !c || a && !o && s || l && s) { n = -1; break e }
                    }
                    n = 0
                }
                return n || e.b - t.b
            }), E("c"))
        }, c.tap = function(e, t) { return t(e), e }, c.thru = function(e, t) { return t(e) }, c.toArray = function(e) { return K(e) ? e.length ? $(e) : [] : oe(e) }, c.values = oe, c.extend = Ve, ae(c, c), c.clone = function(e) { return J(e) ? Fe(e) ? $(e) : N(e, ie(e)) : e }, c.escape = function(e) { return (e = ne(e)) && pe.test(e) ? e.replace(ue, s) : e }, c.every = function(e, t, n) { return t = n ? le : t, f(e, w(t)) }, c.find = B, c.forEach = F, c.has = function(e, t) { return null != e && Te.call(e, t) }, c.head = q, c.identity = se, c.indexOf = function(e, t, n) {
            var i = e ? e.length : 0;
            n = "number" == typeof n ? 0 > n ? De(i + n, 0) : n : 0, n = (n || 0) - 1;
            for (var r = t === t; ++n < i;) { var o = e[n]; if (r ? o === t : o !== o) return n }
            return -1
        }, c.isArguments = X, c.isArray = Fe, c.isBoolean = function(e) { return !0 === e || !1 === e || Q(e) && "[object Boolean]" == Ee.call(e) }, c.isDate = function(e) { return Q(e) && "[object Date]" == Ee.call(e) }, c.isEmpty = function(e) {
            if (K(e) && (Fe(e) || ee(e) || Y(e.splice) || X(e))) return !e.length;
            for (var t in e)
                if (Te.call(e, t)) return !1;
            return !0
        }, c.isEqual = function(e, t) { return b(e, t) }, c.isFinite = function(e) { return "number" == typeof e && Le(e) }, c.isFunction = Y, c.isNaN = function(e) { return Z(e) && e != +e }, c.isNull = function(e) { return null === e }, c.isNumber = Z, c.isObject = J, c.isRegExp = function(e) { return J(e) && "[object RegExp]" == Ee.call(e) }, c.isString = ee, c.isUndefined = function(e) { return e === le }, c.last = function(e) { var t = e ? e.length : 0; return t ? e[t - 1] : le }, c.max = function(e) { return e && e.length ? t(e, se, V) : le }, c.min = function(e) { return e && e.length ? t(e, se, te) : le }, c.noConflict = function() { return we._ === this && (we._ = Pe), this }, c.noop = function() {}, c.reduce = z, c.result = function(e, t, n) { return t = null == e ? le : e[t], t === le && (t = n), Y(t) ? t.call(e) : t }, c.size = function(e) { return null == e ? 0 : (e = K(e) ? e : ie(e), e.length) }, c.some = function(e, t, n) { return t = n ? le : t, _(e, w(t)) }, c.uniqueId = function(e) { var t = ++Ce; return ne(e) + t }, c.each = F, c.first = q, ae(c, function() { var e = {}; return m(c, function(t, n) { Te.call(c.prototype, n) || (e[n] = t) }), e }(), { chain: !1 }), c.VERSION = "4.5.1", je("pop join replace reverse split push shift sort splice unshift".split(" "), function(e) {
            var t = (/^(?:replace|split)$/.test(e) ? String.prototype : xe)[e],
                n = /^(?:push|sort|unshift)$/.test(e) ? "tap" : "thru",
                i = /^(?:pop|join|replace|shift)$/.test(e);
            c.prototype[e] = function() { var e = arguments; return i && !this.__chain__ ? t.apply(this.value(), e) : this[n](function(n) { return t.apply(n, e) }) }
        }), c.prototype.toJSON = c.prototype.valueOf = c.prototype.value = function() { return A(this.__wrapped__, this.__actions__) }, (be || ye || {})._ = c, "function" == typeof define && "object" == typeof define.amd && define.amd ? define(function() { return c }) : ve && ge ? (me && ((ge.exports = c)._ = c), ve._ = c) : we._ = c
    }.call(this),
    /*!
     * jquery.min.js
     */
    /*! jQuery v2.2.3 | (c) jQuery Foundation | jquery.org/license */
    ! function(e, t) { "object" == typeof module && "object" == typeof module.exports ? module.exports = e.document ? t(e, !0) : function(e) { if (!e.document) throw new Error("jQuery requires a window with a document"); return t(e) } : t(e) }("undefined" != typeof window ? window : this, function(e, t) {
        function n(e) {
            var t = !!e && "length" in e && e.length,
                n = oe.type(e);
            return "function" !== n && !oe.isWindow(e) && ("array" === n || 0 === t || "number" == typeof t && t > 0 && t - 1 in e)
        }

        function i(e, t, n) {
            if (oe.isFunction(t)) return oe.grep(e, function(e, i) { return !!t.call(e, i, e) !== n });
            if (t.nodeType) return oe.grep(e, function(e) { return e === t !== n });
            if ("string" == typeof t) {
                if (ve.test(t)) return oe.filter(t, e, n);
                t = oe.filter(t, e)
            }
            return oe.grep(e, function(e) { return Z.call(t, e) > -1 !== n })
        }

        function r(e, t) {
            for (;
                (e = e[t]) && 1 !== e.nodeType;);
            return e
        }

        function o(e) { var t = {}; return oe.each(e.match(we) || [], function(e, n) { t[n] = !0 }), t }

        function s() { Y.removeEventListener("DOMContentLoaded", s), e.removeEventListener("load", s), oe.ready() }

        function a() { this.expando = oe.expando + a.uid++ }

        function l(e, t, n) {
            var i;
            if (void 0 === n && 1 === e.nodeType)
                if (i = "data-" + t.replace($e, "-$&").toLowerCase(), n = e.getAttribute(i), "string" == typeof n) {
                    try { n = "true" === n || "false" !== n && ("null" === n ? null : +n + "" === n ? +n : Pe.test(n) ? oe.parseJSON(n) : n) } catch (e) {}
                    Ee.set(e, t, n)
                } else n = void 0;
            return n
        }

        function c(e, t, n, i) {
            var r, o = 1,
                s = 20,
                a = i ? function() { return i.cur() } : function() { return oe.css(e, t, "") },
                l = a(),
                c = n && n[3] || (oe.cssNumber[t] ? "" : "px"),
                u = (oe.cssNumber[t] || "px" !== c && +l) && Ae.exec(oe.css(e, t));
            if (u && u[3] !== c) {
                c = c || u[3], n = n || [], u = +l || 1;
                do o = o || ".5", u /= o, oe.style(e, t, u + c); while (o !== (o = a() / l) && 1 !== o && --s)
            }
            return n && (u = +u || +l || 0, r = n[1] ? u + (n[1] + 1) * n[2] : +n[2], i && (i.unit = c, i.start = u, i.end = r)), r
        }

        function u(e, t) { var n = "undefined" != typeof e.getElementsByTagName ? e.getElementsByTagName(t || "*") : "undefined" != typeof e.querySelectorAll ? e.querySelectorAll(t || "*") : []; return void 0 === t || t && oe.nodeName(e, t) ? oe.merge([e], n) : n }

        function p(e, t) { for (var n = 0, i = e.length; i > n; n++) Ce.set(e[n], "globalEval", !t || Ce.get(t[n], "globalEval")) }

        function d(e, t, n, i, r) {
            for (var o, s, a, l, c, d, h = t.createDocumentFragment(), f = [], v = 0, g = e.length; g > v; v++)
                if (o = e[v], o || 0 === o)
                    if ("object" === oe.type(o)) oe.merge(f, o.nodeType ? [o] : o);
                    else if (Ie.test(o)) {
                for (s = s || h.appendChild(t.createElement("div")), a = (De.exec(o) || ["", ""])[1].toLowerCase(), l = He[a] || He._default, s.innerHTML = l[1] + oe.htmlPrefilter(o) + l[2], d = l[0]; d--;) s = s.lastChild;
                oe.merge(f, s.childNodes), s = h.firstChild, s.textContent = ""
            } else f.push(t.createTextNode(o));
            for (h.textContent = "", v = 0; o = f[v++];)
                if (i && oe.inArray(o, i) > -1) r && r.push(o);
                else if (c = oe.contains(o.ownerDocument, o), s = u(h.appendChild(o), "script"), c && p(s), n)
                for (d = 0; o = s[d++];) je.test(o.type || "") && n.push(o);
            return h
        }

        function h() { return !0 }

        function f() { return !1 }

        function v() { try { return Y.activeElement } catch (e) {} }

        function g(e, t, n, i, r, o) {
            var s, a;
            if ("object" == typeof t) { "string" != typeof n && (i = i || n, n = void 0); for (a in t) g(e, a, n, i, t[a], o); return e }
            if (null == i && null == r ? (r = n, i = n = void 0) : null == r && ("string" == typeof n ? (r = i, i = void 0) : (r = i, i = n, n = void 0)), r === !1) r = f;
            else if (!r) return e;
            return 1 === o && (s = r, r = function(e) { return oe().off(e), s.apply(this, arguments) }, r.guid = s.guid || (s.guid = oe.guid++)), e.each(function() { oe.event.add(this, t, r, i, n) })
        }

        function m(e, t) { return oe.nodeName(e, "table") && oe.nodeName(11 !== t.nodeType ? t : t.firstChild, "tr") ? e.getElementsByTagName("tbody")[0] || e.appendChild(e.ownerDocument.createElement("tbody")) : e }

        function y(e) { return e.type = (null !== e.getAttribute("type")) + "/" + e.type, e }

        function b(e) { var t = We.exec(e.type); return t ? e.type = t[1] : e.removeAttribute("type"), e }

        function k(e, t) {
            var n, i, r, o, s, a, l, c;
            if (1 === t.nodeType) {
                if (Ce.hasData(e) && (o = Ce.access(e), s = Ce.set(t, o), c = o.events)) {
                    delete s.handle, s.events = {};
                    for (r in c)
                        for (n = 0, i = c[r].length; i > n; n++) oe.event.add(t, r, c[r][n])
                }
                Ee.hasData(e) && (a = Ee.access(e), l = oe.extend({}, a), Ee.set(t, l))
            }
        }

        function w(e, t) { var n = t.nodeName.toLowerCase(); "input" === n && Oe.test(e.type) ? t.checked = e.checked : "input" !== n && "textarea" !== n || (t.defaultValue = e.defaultValue) }

        function x(e, t, n, i) {
            t = J.apply([], t);
            var r, o, s, a, l, c, p = 0,
                h = e.length,
                f = h - 1,
                v = t[0],
                g = oe.isFunction(v);
            if (g || h > 1 && "string" == typeof v && !ie.checkClone && ze.test(v)) return e.each(function(r) {
                var o = e.eq(r);
                g && (t[0] = v.call(this, r, o.html())), x(o, t, n, i)
            });
            if (h && (r = d(t, e[0].ownerDocument, !1, e, i), o = r.firstChild, 1 === r.childNodes.length && (r = o), o || i)) {
                for (s = oe.map(u(r, "script"), y), a = s.length; h > p; p++) l = r, p !== f && (l = oe.clone(l, !0, !0), a && oe.merge(s, u(l, "script"))), n.call(e[p], l, p);
                if (a)
                    for (c = s[s.length - 1].ownerDocument, oe.map(s, b), p = 0; a > p; p++) l = s[p], je.test(l.type || "") && !Ce.access(l, "globalEval") && oe.contains(c, l) && (l.src ? oe._evalUrl && oe._evalUrl(l.src) : oe.globalEval(l.textContent.replace(Ue, "")))
            }
            return e
        }

        function S(e, t, n) { for (var i, r = t ? oe.filter(t, e) : e, o = 0; null != (i = r[o]); o++) n || 1 !== i.nodeType || oe.cleanData(u(i)), i.parentNode && (n && oe.contains(i.ownerDocument, i) && p(u(i, "script")), i.parentNode.removeChild(i)); return e }

        function T(e, t) {
            var n = oe(t.createElement(e)).appendTo(t.body),
                i = oe.css(n[0], "display");
            return n.detach(), i
        }

        function C(e) {
            var t = Y,
                n = Xe[e];
            return n || (n = T(e, t), "none" !== n && n || (Ve = (Ve || oe("<iframe frameborder='0' width='0' height='0'/>")).appendTo(t.documentElement), t = Ve[0].contentDocument, t.write(), t.close(), n = T(e, t), Ve.detach()), Xe[e] = n), n
        }

        function E(e, t, n) { var i, r, o, s, a = e.style; return n = n || Ge(e), s = n ? n.getPropertyValue(t) || n[t] : void 0, "" !== s && void 0 !== s || oe.contains(e.ownerDocument, e) || (s = oe.style(e, t)), n && !ie.pixelMarginRight() && Ye.test(s) && Ke.test(t) && (i = a.width, r = a.minWidth, o = a.maxWidth, a.minWidth = a.maxWidth = a.width = s, s = n.width, a.width = i, a.minWidth = r, a.maxWidth = o), void 0 !== s ? s + "" : s }

        function P(e, t) { return { get: function() { return e() ? void delete this.get : (this.get = t).apply(this, arguments) } } }

        function $(e) {
            if (e in it) return e;
            for (var t = e[0].toUpperCase() + e.slice(1), n = nt.length; n--;)
                if (e = nt[n] + t, e in it) return e
        }

        function _(e, t, n) { var i = Ae.exec(t); return i ? Math.max(0, i[2] - (n || 0)) + (i[3] || "px") : t }

        function A(e, t, n, i, r) { for (var o = n === (i ? "border" : "content") ? 4 : "width" === t ? 1 : 0, s = 0; 4 > o; o += 2) "margin" === n && (s += oe.css(e, n + Ne[o], !0, r)), i ? ("content" === n && (s -= oe.css(e, "padding" + Ne[o], !0, r)), "margin" !== n && (s -= oe.css(e, "border" + Ne[o] + "Width", !0, r))) : (s += oe.css(e, "padding" + Ne[o], !0, r), "padding" !== n && (s += oe.css(e, "border" + Ne[o] + "Width", !0, r))); return s }

        function N(t, n, i) {
            var r = !0,
                o = "width" === n ? t.offsetWidth : t.offsetHeight,
                s = Ge(t),
                a = "border-box" === oe.css(t, "boxSizing", !1, s);
            if (Y.msFullscreenElement && e.top !== e && t.getClientRects().length && (o = Math.round(100 * t.getBoundingClientRect()[n])), 0 >= o || null == o) {
                if (o = E(t, n, s), (0 > o || null == o) && (o = t.style[n]), Ye.test(o)) return o;
                r = a && (ie.boxSizingReliable() || o === t.style[n]), o = parseFloat(o) || 0
            }
            return o + A(t, n, i || (a ? "border" : "content"), r, s) + "px"
        }

        function L(e, t) { for (var n, i, r, o = [], s = 0, a = e.length; a > s; s++) i = e[s], i.style && (o[s] = Ce.get(i, "olddisplay"), n = i.style.display, t ? (o[s] || "none" !== n || (i.style.display = ""), "" === i.style.display && Le(i) && (o[s] = Ce.access(i, "olddisplay", C(i.nodeName)))) : (r = Le(i), "none" === n && r || Ce.set(i, "olddisplay", r ? n : oe.css(i, "display")))); for (s = 0; a > s; s++) i = e[s], i.style && (t && "none" !== i.style.display && "" !== i.style.display || (i.style.display = t ? o[s] || "" : "none")); return e }

        function O(e, t, n, i, r) { return new O.prototype.init(e, t, n, i, r) }

        function D() { return e.setTimeout(function() { rt = void 0 }), rt = oe.now() }

        function j(e, t) {
            var n, i = 0,
                r = { height: e };
            for (t = t ? 1 : 0; 4 > i; i += 2 - t) n = Ne[i], r["margin" + n] = r["padding" + n] = e;
            return t && (r.opacity = r.width = e), r
        }

        function H(e, t, n) {
            for (var i, r = (R.tweeners[t] || []).concat(R.tweeners["*"]), o = 0, s = r.length; s > o; o++)
                if (i = r[o].call(n, t, e)) return i
        }

        function I(e, t, n) {
            var i, r, o, s, a, l, c, u, p = this,
                d = {},
                h = e.style,
                f = e.nodeType && Le(e),
                v = Ce.get(e, "fxshow");
            n.queue || (a = oe._queueHooks(e, "fx"), null == a.unqueued && (a.unqueued = 0, l = a.empty.fire, a.empty.fire = function() { a.unqueued || l() }), a.unqueued++, p.always(function() { p.always(function() { a.unqueued--, oe.queue(e, "fx").length || a.empty.fire() }) })), 1 === e.nodeType && ("height" in t || "width" in t) && (n.overflow = [h.overflow, h.overflowX, h.overflowY], c = oe.css(e, "display"), u = "none" === c ? Ce.get(e, "olddisplay") || C(e.nodeName) : c, "inline" === u && "none" === oe.css(e, "float") && (h.display = "inline-block")), n.overflow && (h.overflow = "hidden", p.always(function() { h.overflow = n.overflow[0], h.overflowX = n.overflow[1], h.overflowY = n.overflow[2] }));
            for (i in t)
                if (r = t[i], st.exec(r)) {
                    if (delete t[i], o = o || "toggle" === r, r === (f ? "hide" : "show")) {
                        if ("show" !== r || !v || void 0 === v[i]) continue;
                        f = !0
                    }
                    d[i] = v && v[i] || oe.style(e, i)
                } else c = void 0;
            if (oe.isEmptyObject(d)) "inline" === ("none" === c ? C(e.nodeName) : c) && (h.display = c);
            else {
                v ? "hidden" in v && (f = v.hidden) : v = Ce.access(e, "fxshow", {}), o && (v.hidden = !f), f ? oe(e).show() : p.done(function() { oe(e).hide() }), p.done(function() {
                    var t;
                    Ce.remove(e, "fxshow");
                    for (t in d) oe.style(e, t, d[t])
                });
                for (i in d) s = H(f ? v[i] : 0, i, p), i in v || (v[i] = s.start, f && (s.end = s.start, s.start = "width" === i || "height" === i ? 1 : 0))
            }
        }

        function M(e, t) {
            var n, i, r, o, s;
            for (n in e)
                if (i = oe.camelCase(n), r = t[i], o = e[n], oe.isArray(o) && (r = o[1], o = e[n] = o[0]), n !== i && (e[i] = o, delete e[n]), s = oe.cssHooks[i], s && "expand" in s) { o = s.expand(o), delete e[i]; for (n in o) n in e || (e[n] = o[n], t[n] = r) } else t[i] = r
        }

        function R(e, t, n) {
            var i, r, o = 0,
                s = R.prefilters.length,
                a = oe.Deferred().always(function() { delete l.elem }),
                l = function() { if (r) return !1; for (var t = rt || D(), n = Math.max(0, c.startTime + c.duration - t), i = n / c.duration || 0, o = 1 - i, s = 0, l = c.tweens.length; l > s; s++) c.tweens[s].run(o); return a.notifyWith(e, [c, o, n]), 1 > o && l ? n : (a.resolveWith(e, [c]), !1) },
                c = a.promise({
                    elem: e,
                    props: oe.extend({}, t),
                    opts: oe.extend(!0, { specialEasing: {}, easing: oe.easing._default }, n),
                    originalProperties: t,
                    originalOptions: n,
                    startTime: rt || D(),
                    duration: n.duration,
                    tweens: [],
                    createTween: function(t, n) { var i = oe.Tween(e, c.opts, t, n, c.opts.specialEasing[t] || c.opts.easing); return c.tweens.push(i), i },
                    stop: function(t) {
                        var n = 0,
                            i = t ? c.tweens.length : 0;
                        if (r) return this;
                        for (r = !0; i > n; n++) c.tweens[n].run(1);
                        return t ? (a.notifyWith(e, [c, 1, 0]), a.resolveWith(e, [c, t])) : a.rejectWith(e, [c, t]), this
                    }
                }),
                u = c.props;
            for (M(u, c.opts.specialEasing); s > o; o++)
                if (i = R.prefilters[o].call(c, e, u, c.opts)) return oe.isFunction(i.stop) && (oe._queueHooks(c.elem, c.opts.queue).stop = oe.proxy(i.stop, i)), i;
            return oe.map(u, H, c), oe.isFunction(c.opts.start) && c.opts.start.call(e, c), oe.fx.timer(oe.extend(l, { elem: e, anim: c, queue: c.opts.queue })), c.progress(c.opts.progress).done(c.opts.done, c.opts.complete).fail(c.opts.fail).always(c.opts.always)
        }

        function q(e) { return e.getAttribute && e.getAttribute("class") || "" }

        function B(e) {
            return function(t, n) {
                "string" != typeof t && (n = t, t = "*");
                var i, r = 0,
                    o = t.toLowerCase().match(we) || [];
                if (oe.isFunction(n))
                    for (; i = o[r++];) "+" === i[0] ? (i = i.slice(1) || "*", (e[i] = e[i] || []).unshift(n)) : (e[i] = e[i] || []).push(n)
            }
        }

        function F(e, t, n, i) {
            function r(a) { var l; return o[a] = !0, oe.each(e[a] || [], function(e, a) { var c = a(t, n, i); return "string" != typeof c || s || o[c] ? s ? !(l = c) : void 0 : (t.dataTypes.unshift(c), r(c), !1) }), l }
            var o = {},
                s = e === Et;
            return r(t.dataTypes[0]) || !o["*"] && r("*")
        }

        function z(e, t) { var n, i, r = oe.ajaxSettings.flatOptions || {}; for (n in t) void 0 !== t[n] && ((r[n] ? e : i || (i = {}))[n] = t[n]); return i && oe.extend(!0, e, i), e }

        function W(e, t, n) {
            for (var i, r, o, s, a = e.contents, l = e.dataTypes;
                "*" === l[0];) l.shift(), void 0 === i && (i = e.mimeType || t.getResponseHeader("Content-Type"));
            if (i)
                for (r in a)
                    if (a[r] && a[r].test(i)) { l.unshift(r); break }
            if (l[0] in n) o = l[0];
            else {
                for (r in n) {
                    if (!l[0] || e.converters[r + " " + l[0]]) { o = r; break }
                    s || (s = r)
                }
                o = o || s
            }
            return o ? (o !== l[0] && l.unshift(o), n[o]) : void 0
        }

        function U(e, t, n, i) {
            var r, o, s, a, l, c = {},
                u = e.dataTypes.slice();
            if (u[1])
                for (s in e.converters) c[s.toLowerCase()] = e.converters[s];
            for (o = u.shift(); o;)
                if (e.responseFields[o] && (n[e.responseFields[o]] = t), !l && i && e.dataFilter && (t = e.dataFilter(t, e.dataType)), l = o, o = u.shift())
                    if ("*" === o) o = l;
                    else if ("*" !== l && l !== o) {
                if (s = c[l + " " + o] || c["* " + o], !s)
                    for (r in c)
                        if (a = r.split(" "), a[1] === o && (s = c[l + " " + a[0]] || c["* " + a[0]])) { s === !0 ? s = c[r] : c[r] !== !0 && (o = a[0], u.unshift(a[1])); break }
                if (s !== !0)
                    if (s && e.throws) t = s(t);
                    else try { t = s(t) } catch (e) { return { state: "parsererror", error: s ? e : "No conversion from " + l + " to " + o } }
            }
            return { state: "success", data: t }
        }

        function V(e, t, n, i) {
            var r;
            if (oe.isArray(t)) oe.each(t, function(t, r) { n || At.test(e) ? i(e, r) : V(e + "[" + ("object" == typeof r && null != r ? t : "") + "]", r, n, i) });
            else if (n || "object" !== oe.type(t)) i(e, t);
            else
                for (r in t) V(e + "[" + r + "]", t[r], n, i)
        }

        function X(e) { return oe.isWindow(e) ? e : 9 === e.nodeType && e.defaultView }
        var K = [],
            Y = e.document,
            G = K.slice,
            J = K.concat,
            Q = K.push,
            Z = K.indexOf,
            ee = {},
            te = ee.toString,
            ne = ee.hasOwnProperty,
            ie = {},
            re = "2.2.3",
            oe = function(e, t) { return new oe.fn.init(e, t) },
            se = /^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,
            ae = /^-ms-/,
            le = /-([\da-z])/gi,
            ce = function(e, t) { return t.toUpperCase() };
        oe.fn = oe.prototype = {
            jquery: re,
            constructor: oe,
            selector: "",
            length: 0,
            toArray: function() { return G.call(this) },
            get: function(e) { return null != e ? 0 > e ? this[e + this.length] : this[e] : G.call(this) },
            pushStack: function(e) { var t = oe.merge(this.constructor(), e); return t.prevObject = this, t.context = this.context, t },
            each: function(e) { return oe.each(this, e) },
            map: function(e) { return this.pushStack(oe.map(this, function(t, n) { return e.call(t, n, t) })) },
            slice: function() { return this.pushStack(G.apply(this, arguments)) },
            first: function() { return this.eq(0) },
            last: function() { return this.eq(-1) },
            eq: function(e) {
                var t = this.length,
                    n = +e + (0 > e ? t : 0);
                return this.pushStack(n >= 0 && t > n ? [this[n]] : [])
            },
            end: function() { return this.prevObject || this.constructor() },
            push: Q,
            sort: K.sort,
            splice: K.splice
        }, oe.extend = oe.fn.extend = function() {
            var e, t, n, i, r, o, s = arguments[0] || {},
                a = 1,
                l = arguments.length,
                c = !1;
            for ("boolean" == typeof s && (c = s, s = arguments[a] || {}, a++), "object" == typeof s || oe.isFunction(s) || (s = {}), a === l && (s = this, a--); l > a; a++)
                if (null != (e = arguments[a]))
                    for (t in e) n = s[t], i = e[t], s !== i && (c && i && (oe.isPlainObject(i) || (r = oe.isArray(i))) ? (r ? (r = !1, o = n && oe.isArray(n) ? n : []) : o = n && oe.isPlainObject(n) ? n : {}, s[t] = oe.extend(c, o, i)) : void 0 !== i && (s[t] = i));
            return s
        }, oe.extend({
            expando: "jQuery" + (re + Math.random()).replace(/\D/g, ""),
            isReady: !0,
            error: function(e) { throw new Error(e) },
            noop: function() {},
            isFunction: function(e) { return "function" === oe.type(e) },
            isArray: Array.isArray,
            isWindow: function(e) { return null != e && e === e.window },
            isNumeric: function(e) { var t = e && e.toString(); return !oe.isArray(e) && t - parseFloat(t) + 1 >= 0 },
            isPlainObject: function(e) { var t; if ("object" !== oe.type(e) || e.nodeType || oe.isWindow(e)) return !1; if (e.constructor && !ne.call(e, "constructor") && !ne.call(e.constructor.prototype || {}, "isPrototypeOf")) return !1; for (t in e); return void 0 === t || ne.call(e, t) },
            isEmptyObject: function(e) { var t; for (t in e) return !1; return !0 },
            type: function(e) { return null == e ? e + "" : "object" == typeof e || "function" == typeof e ? ee[te.call(e)] || "object" : typeof e },
            globalEval: function(e) {
                var t, n = eval;
                e = oe.trim(e), e && (1 === e.indexOf("use strict") ? (t = Y.createElement("script"), t.text = e, Y.head.appendChild(t).parentNode.removeChild(t)) : n(e))
            },
            camelCase: function(e) { return e.replace(ae, "ms-").replace(le, ce) },
            nodeName: function(e, t) { return e.nodeName && e.nodeName.toLowerCase() === t.toLowerCase() },
            each: function(e, t) {
                var i, r = 0;
                if (n(e))
                    for (i = e.length; i > r && t.call(e[r], r, e[r]) !== !1; r++);
                else
                    for (r in e)
                        if (t.call(e[r], r, e[r]) === !1) break; return e
            },
            trim: function(e) { return null == e ? "" : (e + "").replace(se, "") },
            makeArray: function(e, t) { var i = t || []; return null != e && (n(Object(e)) ? oe.merge(i, "string" == typeof e ? [e] : e) : Q.call(i, e)), i },
            inArray: function(e, t, n) { return null == t ? -1 : Z.call(t, e, n) },
            merge: function(e, t) { for (var n = +t.length, i = 0, r = e.length; n > i; i++) e[r++] = t[i]; return e.length = r, e },
            grep: function(e, t, n) { for (var i, r = [], o = 0, s = e.length, a = !n; s > o; o++) i = !t(e[o], o), i !== a && r.push(e[o]); return r },
            map: function(e, t, i) {
                var r, o, s = 0,
                    a = [];
                if (n(e))
                    for (r = e.length; r > s; s++) o = t(e[s], s, i), null != o && a.push(o);
                else
                    for (s in e) o = t(e[s], s, i), null != o && a.push(o);
                return J.apply([], a)
            },
            guid: 1,
            proxy: function(e, t) { var n, i, r; return "string" == typeof t && (n = e[t], t = e, e = n), oe.isFunction(e) ? (i = G.call(arguments, 2), r = function() { return e.apply(t || this, i.concat(G.call(arguments))) }, r.guid = e.guid = e.guid || oe.guid++, r) : void 0 },
            now: Date.now,
            support: ie
        }), "function" == typeof Symbol && (oe.fn[Symbol.iterator] = K[Symbol.iterator]), oe.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "), function(e, t) { ee["[object " + t + "]"] = t.toLowerCase() });
        var ue = function(e) {
            function t(e, t, n, i) {
                var r, o, s, a, l, c, p, h, f = t && t.ownerDocument,
                    v = t ? t.nodeType : 9;
                if (n = n || [], "string" != typeof e || !e || 1 !== v && 9 !== v && 11 !== v) return n;
                if (!i && ((t ? t.ownerDocument || t : q) !== L && N(t), t = t || L, D)) {
                    if (11 !== v && (c = me.exec(e)))
                        if (r = c[1]) { if (9 === v) { if (!(s = t.getElementById(r))) return n; if (s.id === r) return n.push(s), n } else if (f && (s = f.getElementById(r)) && M(t, s) && s.id === r) return n.push(s), n } else { if (c[2]) return Q.apply(n, t.getElementsByTagName(e)), n; if ((r = c[3]) && w.getElementsByClassName && t.getElementsByClassName) return Q.apply(n, t.getElementsByClassName(r)), n }
                    if (w.qsa && !U[e + " "] && (!j || !j.test(e))) {
                        if (1 !== v) f = t, h = e;
                        else if ("object" !== t.nodeName.toLowerCase()) {
                            for ((a = t.getAttribute("id")) ? a = a.replace(be, "\\$&") : t.setAttribute("id", a = R), p = C(e), o = p.length, l = de.test(a) ? "#" + a : "[id='" + a + "']"; o--;) p[o] = l + " " + d(p[o]);
                            h = p.join(","), f = ye.test(e) && u(t.parentNode) || t
                        }
                        if (h) try { return Q.apply(n, f.querySelectorAll(h)), n } catch (e) {} finally { a === R && t.removeAttribute("id") }
                    }
                }
                return P(e.replace(ae, "$1"), t, n, i)
            }

            function n() {
                function e(n, i) { return t.push(n + " ") > x.cacheLength && delete e[t.shift()], e[n + " "] = i }
                var t = [];
                return e
            }

            function i(e) { return e[R] = !0, e }

            function r(e) { var t = L.createElement("div"); try { return !!e(t) } catch (e) { return !1 } finally { t.parentNode && t.parentNode.removeChild(t), t = null } }

            function o(e, t) { for (var n = e.split("|"), i = n.length; i--;) x.attrHandle[n[i]] = t }

            function s(e, t) {
                var n = t && e,
                    i = n && 1 === e.nodeType && 1 === t.nodeType && (~t.sourceIndex || X) - (~e.sourceIndex || X);
                if (i) return i;
                if (n)
                    for (; n = n.nextSibling;)
                        if (n === t) return -1;
                return e ? 1 : -1
            }

            function a(e) { return function(t) { var n = t.nodeName.toLowerCase(); return "input" === n && t.type === e } }

            function l(e) { return function(t) { var n = t.nodeName.toLowerCase(); return ("input" === n || "button" === n) && t.type === e } }

            function c(e) { return i(function(t) { return t = +t, i(function(n, i) { for (var r, o = e([], n.length, t), s = o.length; s--;) n[r = o[s]] && (n[r] = !(i[r] = n[r])) }) }) }

            function u(e) { return e && "undefined" != typeof e.getElementsByTagName && e }

            function p() {}

            function d(e) { for (var t = 0, n = e.length, i = ""; n > t; t++) i += e[t].value; return i }

            function h(e, t, n) {
                var i = t.dir,
                    r = n && "parentNode" === i,
                    o = F++;
                return t.first ? function(t, n, o) {
                    for (; t = t[i];)
                        if (1 === t.nodeType || r) return e(t, n, o)
                } : function(t, n, s) {
                    var a, l, c, u = [B, o];
                    if (s) {
                        for (; t = t[i];)
                            if ((1 === t.nodeType || r) && e(t, n, s)) return !0
                    } else
                        for (; t = t[i];)
                            if (1 === t.nodeType || r) { if (c = t[R] || (t[R] = {}), l = c[t.uniqueID] || (c[t.uniqueID] = {}), (a = l[i]) && a[0] === B && a[1] === o) return u[2] = a[2]; if (l[i] = u, u[2] = e(t, n, s)) return !0 }
                }
            }

            function f(e) {
                return e.length > 1 ? function(t, n, i) {
                    for (var r = e.length; r--;)
                        if (!e[r](t, n, i)) return !1;
                    return !0
                } : e[0]
            }

            function v(e, n, i) { for (var r = 0, o = n.length; o > r; r++) t(e, n[r], i); return i }

            function g(e, t, n, i, r) { for (var o, s = [], a = 0, l = e.length, c = null != t; l > a; a++)(o = e[a]) && (n && !n(o, i, r) || (s.push(o), c && t.push(a))); return s }

            function m(e, t, n, r, o, s) {
                return r && !r[R] && (r = m(r)), o && !o[R] && (o = m(o, s)), i(function(i, s, a, l) {
                    var c, u, p, d = [],
                        h = [],
                        f = s.length,
                        m = i || v(t || "*", a.nodeType ? [a] : a, []),
                        y = !e || !i && t ? m : g(m, d, e, a, l),
                        b = n ? o || (i ? e : f || r) ? [] : s : y;
                    if (n && n(y, b, a, l), r)
                        for (c = g(b, h), r(c, [], a, l), u = c.length; u--;)(p = c[u]) && (b[h[u]] = !(y[h[u]] = p));
                    if (i) {
                        if (o || e) {
                            if (o) {
                                for (c = [], u = b.length; u--;)(p = b[u]) && c.push(y[u] = p);
                                o(null, b = [], c, l)
                            }
                            for (u = b.length; u--;)(p = b[u]) && (c = o ? ee(i, p) : d[u]) > -1 && (i[c] = !(s[c] = p))
                        }
                    } else b = g(b === s ? b.splice(f, b.length) : b), o ? o(null, s, b, l) : Q.apply(s, b)
                })
            }

            function y(e) {
                for (var t, n, i, r = e.length, o = x.relative[e[0].type], s = o || x.relative[" "], a = o ? 1 : 0, l = h(function(e) { return e === t }, s, !0), c = h(function(e) { return ee(t, e) > -1 }, s, !0), u = [function(e, n, i) { var r = !o && (i || n !== $) || ((t = n).nodeType ? l(e, n, i) : c(e, n, i)); return t = null, r }]; r > a; a++)
                    if (n = x.relative[e[a].type]) u = [h(f(u), n)];
                    else {
                        if (n = x.filter[e[a].type].apply(null, e[a].matches), n[R]) { for (i = ++a; r > i && !x.relative[e[i].type]; i++); return m(a > 1 && f(u), a > 1 && d(e.slice(0, a - 1).concat({ value: " " === e[a - 2].type ? "*" : "" })).replace(ae, "$1"), n, i > a && y(e.slice(a, i)), r > i && y(e = e.slice(i)), r > i && d(e)) }
                        u.push(n)
                    }
                return f(u)
            }

            function b(e, n) {
                var r = n.length > 0,
                    o = e.length > 0,
                    s = function(i, s, a, l, c) {
                        var u, p, d, h = 0,
                            f = "0",
                            v = i && [],
                            m = [],
                            y = $,
                            b = i || o && x.find.TAG("*", c),
                            k = B += null == y ? 1 : Math.random() || .1,
                            w = b.length;
                        for (c && ($ = s === L || s || c); f !== w && null != (u = b[f]); f++) {
                            if (o && u) {
                                for (p = 0, s || u.ownerDocument === L || (N(u), a = !D); d = e[p++];)
                                    if (d(u, s || L, a)) { l.push(u); break }
                                c && (B = k)
                            }
                            r && ((u = !d && u) && h--, i && v.push(u))
                        }
                        if (h += f, r && f !== h) {
                            for (p = 0; d = n[p++];) d(v, m, s, a);
                            if (i) {
                                if (h > 0)
                                    for (; f--;) v[f] || m[f] || (m[f] = G.call(l));
                                m = g(m)
                            }
                            Q.apply(l, m), c && !i && m.length > 0 && h + n.length > 1 && t.uniqueSort(l)
                        }
                        return c && (B = k, $ = y), v
                    };
                return r ? i(s) : s
            }
            var k, w, x, S, T, C, E, P, $, _, A, N, L, O, D, j, H, I, M, R = "sizzle" + 1 * new Date,
                q = e.document,
                B = 0,
                F = 0,
                z = n(),
                W = n(),
                U = n(),
                V = function(e, t) { return e === t && (A = !0), 0 },
                X = 1 << 31,
                K = {}.hasOwnProperty,
                Y = [],
                G = Y.pop,
                J = Y.push,
                Q = Y.push,
                Z = Y.slice,
                ee = function(e, t) {
                    for (var n = 0, i = e.length; i > n; n++)
                        if (e[n] === t) return n;
                    return -1
                },
                te = "checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",
                ne = "[\\x20\\t\\r\\n\\f]",
                ie = "(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",
                re = "\\[" + ne + "*(" + ie + ")(?:" + ne + "*([*^$|!~]?=)" + ne + "*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|(" + ie + "))|)" + ne + "*\\]",
                oe = ":(" + ie + ")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|" + re + ")*)|.*)\\)|)",
                se = new RegExp(ne + "+", "g"),
                ae = new RegExp("^" + ne + "+|((?:^|[^\\\\])(?:\\\\.)*)" + ne + "+$", "g"),
                le = new RegExp("^" + ne + "*," + ne + "*"),
                ce = new RegExp("^" + ne + "*([>+~]|" + ne + ")" + ne + "*"),
                ue = new RegExp("=" + ne + "*([^\\]'\"]*?)" + ne + "*\\]", "g"),
                pe = new RegExp(oe),
                de = new RegExp("^" + ie + "$"),
                he = { ID: new RegExp("^#(" + ie + ")"), CLASS: new RegExp("^\\.(" + ie + ")"), TAG: new RegExp("^(" + ie + "|[*])"), ATTR: new RegExp("^" + re), PSEUDO: new RegExp("^" + oe), CHILD: new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\(" + ne + "*(even|odd|(([+-]|)(\\d*)n|)" + ne + "*(?:([+-]|)" + ne + "*(\\d+)|))" + ne + "*\\)|)", "i"), bool: new RegExp("^(?:" + te + ")$", "i"), needsContext: new RegExp("^" + ne + "*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\(" + ne + "*((?:-\\d)?\\d*)" + ne + "*\\)|)(?=[^-]|$)", "i") },
                fe = /^(?:input|select|textarea|button)$/i,
                ve = /^h\d$/i,
                ge = /^[^{]+\{\s*\[native \w/,
                me = /^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,
                ye = /[+~]/,
                be = /'|\\/g,
                ke = new RegExp("\\\\([\\da-f]{1,6}" + ne + "?|(" + ne + ")|.)", "ig"),
                we = function(e, t, n) { var i = "0x" + t - 65536; return i !== i || n ? t : 0 > i ? String.fromCharCode(i + 65536) : String.fromCharCode(i >> 10 | 55296, 1023 & i | 56320) },
                xe = function() { N() };
            try { Q.apply(Y = Z.call(q.childNodes), q.childNodes), Y[q.childNodes.length].nodeType } catch (e) {
                Q = {
                    apply: Y.length ? function(e, t) { J.apply(e, Z.call(t)) } : function(e, t) {
                        for (var n = e.length, i = 0; e[n++] = t[i++];);
                        e.length = n - 1
                    }
                }
            }
            w = t.support = {}, T = t.isXML = function(e) { var t = e && (e.ownerDocument || e).documentElement; return !!t && "HTML" !== t.nodeName }, N = t.setDocument = function(e) {
                var t, n, i = e ? e.ownerDocument || e : q;
                return i !== L && 9 === i.nodeType && i.documentElement ? (L = i, O = L.documentElement, D = !T(L), (n = L.defaultView) && n.top !== n && (n.addEventListener ? n.addEventListener("unload", xe, !1) : n.attachEvent && n.attachEvent("onunload", xe)), w.attributes = r(function(e) { return e.className = "i", !e.getAttribute("className") }), w.getElementsByTagName = r(function(e) { return e.appendChild(L.createComment("")), !e.getElementsByTagName("*").length }), w.getElementsByClassName = ge.test(L.getElementsByClassName), w.getById = r(function(e) { return O.appendChild(e).id = R, !L.getElementsByName || !L.getElementsByName(R).length }), w.getById ? (x.find.ID = function(e, t) { if ("undefined" != typeof t.getElementById && D) { var n = t.getElementById(e); return n ? [n] : [] } }, x.filter.ID = function(e) { var t = e.replace(ke, we); return function(e) { return e.getAttribute("id") === t } }) : (delete x.find.ID, x.filter.ID = function(e) { var t = e.replace(ke, we); return function(e) { var n = "undefined" != typeof e.getAttributeNode && e.getAttributeNode("id"); return n && n.value === t } }), x.find.TAG = w.getElementsByTagName ? function(e, t) { return "undefined" != typeof t.getElementsByTagName ? t.getElementsByTagName(e) : w.qsa ? t.querySelectorAll(e) : void 0 } : function(e, t) {
                    var n, i = [],
                        r = 0,
                        o = t.getElementsByTagName(e);
                    if ("*" === e) { for (; n = o[r++];) 1 === n.nodeType && i.push(n); return i }
                    return o
                }, x.find.CLASS = w.getElementsByClassName && function(e, t) { return "undefined" != typeof t.getElementsByClassName && D ? t.getElementsByClassName(e) : void 0 }, H = [], j = [], (w.qsa = ge.test(L.querySelectorAll)) && (r(function(e) { O.appendChild(e).innerHTML = "<a id='" + R + "'></a><select id='" + R + "-\r\\' msallowcapture=''><option selected=''></option></select>", e.querySelectorAll("[msallowcapture^='']").length && j.push("[*^$]=" + ne + "*(?:''|\"\")"), e.querySelectorAll("[selected]").length || j.push("\\[" + ne + "*(?:value|" + te + ")"), e.querySelectorAll("[id~=" + R + "-]").length || j.push("~="), e.querySelectorAll(":checked").length || j.push(":checked"), e.querySelectorAll("a#" + R + "+*").length || j.push(".#.+[+~]") }), r(function(e) {
                    var t = L.createElement("input");
                    t.setAttribute("type", "hidden"), e.appendChild(t).setAttribute("name", "D"), e.querySelectorAll("[name=d]").length && j.push("name" + ne + "*[*^$|!~]?="), e.querySelectorAll(":enabled").length || j.push(":enabled", ":disabled"), e.querySelectorAll("*,:x"), j.push(",.*:")
                })), (w.matchesSelector = ge.test(I = O.matches || O.webkitMatchesSelector || O.mozMatchesSelector || O.oMatchesSelector || O.msMatchesSelector)) && r(function(e) { w.disconnectedMatch = I.call(e, "div"), I.call(e, "[s!='']:x"), H.push("!=", oe) }), j = j.length && new RegExp(j.join("|")), H = H.length && new RegExp(H.join("|")), t = ge.test(O.compareDocumentPosition), M = t || ge.test(O.contains) ? function(e, t) {
                    var n = 9 === e.nodeType ? e.documentElement : e,
                        i = t && t.parentNode;
                    return e === i || !(!i || 1 !== i.nodeType || !(n.contains ? n.contains(i) : e.compareDocumentPosition && 16 & e.compareDocumentPosition(i)))
                } : function(e, t) {
                    if (t)
                        for (; t = t.parentNode;)
                            if (t === e) return !0;
                    return !1
                }, V = t ? function(e, t) { if (e === t) return A = !0, 0; var n = !e.compareDocumentPosition - !t.compareDocumentPosition; return n ? n : (n = (e.ownerDocument || e) === (t.ownerDocument || t) ? e.compareDocumentPosition(t) : 1, 1 & n || !w.sortDetached && t.compareDocumentPosition(e) === n ? e === L || e.ownerDocument === q && M(q, e) ? -1 : t === L || t.ownerDocument === q && M(q, t) ? 1 : _ ? ee(_, e) - ee(_, t) : 0 : 4 & n ? -1 : 1) } : function(e, t) {
                    if (e === t) return A = !0, 0;
                    var n, i = 0,
                        r = e.parentNode,
                        o = t.parentNode,
                        a = [e],
                        l = [t];
                    if (!r || !o) return e === L ? -1 : t === L ? 1 : r ? -1 : o ? 1 : _ ? ee(_, e) - ee(_, t) : 0;
                    if (r === o) return s(e, t);
                    for (n = e; n = n.parentNode;) a.unshift(n);
                    for (n = t; n = n.parentNode;) l.unshift(n);
                    for (; a[i] === l[i];) i++;
                    return i ? s(a[i], l[i]) : a[i] === q ? -1 : l[i] === q ? 1 : 0
                }, L) : L
            }, t.matches = function(e, n) { return t(e, null, null, n) }, t.matchesSelector = function(e, n) {
                if ((e.ownerDocument || e) !== L && N(e), n = n.replace(ue, "='$1']"), w.matchesSelector && D && !U[n + " "] && (!H || !H.test(n)) && (!j || !j.test(n))) try { var i = I.call(e, n); if (i || w.disconnectedMatch || e.document && 11 !== e.document.nodeType) return i } catch (e) {}
                return t(n, L, null, [e]).length > 0
            }, t.contains = function(e, t) { return (e.ownerDocument || e) !== L && N(e), M(e, t) }, t.attr = function(e, t) {
                (e.ownerDocument || e) !== L && N(e);
                var n = x.attrHandle[t.toLowerCase()],
                    i = n && K.call(x.attrHandle, t.toLowerCase()) ? n(e, t, !D) : void 0;
                return void 0 !== i ? i : w.attributes || !D ? e.getAttribute(t) : (i = e.getAttributeNode(t)) && i.specified ? i.value : null
            }, t.error = function(e) { throw new Error("Syntax error, unrecognized expression: " + e) }, t.uniqueSort = function(e) {
                var t, n = [],
                    i = 0,
                    r = 0;
                if (A = !w.detectDuplicates, _ = !w.sortStable && e.slice(0), e.sort(V), A) { for (; t = e[r++];) t === e[r] && (i = n.push(r)); for (; i--;) e.splice(n[i], 1) }
                return _ = null, e
            }, S = t.getText = function(e) {
                var t, n = "",
                    i = 0,
                    r = e.nodeType;
                if (r) { if (1 === r || 9 === r || 11 === r) { if ("string" == typeof e.textContent) return e.textContent; for (e = e.firstChild; e; e = e.nextSibling) n += S(e) } else if (3 === r || 4 === r) return e.nodeValue } else
                    for (; t = e[i++];) n += S(t);
                return n
            }, x = t.selectors = {
                cacheLength: 50,
                createPseudo: i,
                match: he,
                attrHandle: {},
                find: {},
                relative: { ">": { dir: "parentNode", first: !0 }, " ": { dir: "parentNode" }, "+": { dir: "previousSibling", first: !0 }, "~": { dir: "previousSibling" } },
                preFilter: { ATTR: function(e) { return e[1] = e[1].replace(ke, we), e[3] = (e[3] || e[4] || e[5] || "").replace(ke, we), "~=" === e[2] && (e[3] = " " + e[3] + " "), e.slice(0, 4) }, CHILD: function(e) { return e[1] = e[1].toLowerCase(), "nth" === e[1].slice(0, 3) ? (e[3] || t.error(e[0]), e[4] = +(e[4] ? e[5] + (e[6] || 1) : 2 * ("even" === e[3] || "odd" === e[3])), e[5] = +(e[7] + e[8] || "odd" === e[3])) : e[3] && t.error(e[0]), e }, PSEUDO: function(e) { var t, n = !e[6] && e[2]; return he.CHILD.test(e[0]) ? null : (e[3] ? e[2] = e[4] || e[5] || "" : n && pe.test(n) && (t = C(n, !0)) && (t = n.indexOf(")", n.length - t) - n.length) && (e[0] = e[0].slice(0, t), e[2] = n.slice(0, t)), e.slice(0, 3)) } },
                filter: {
                    TAG: function(e) { var t = e.replace(ke, we).toLowerCase(); return "*" === e ? function() { return !0 } : function(e) { return e.nodeName && e.nodeName.toLowerCase() === t } },
                    CLASS: function(e) { var t = z[e + " "]; return t || (t = new RegExp("(^|" + ne + ")" + e + "(" + ne + "|$)")) && z(e, function(e) { return t.test("string" == typeof e.className && e.className || "undefined" != typeof e.getAttribute && e.getAttribute("class") || "") }) },
                    ATTR: function(e, n, i) { return function(r) { var o = t.attr(r, e); return null == o ? "!=" === n : !n || (o += "", "=" === n ? o === i : "!=" === n ? o !== i : "^=" === n ? i && 0 === o.indexOf(i) : "*=" === n ? i && o.indexOf(i) > -1 : "$=" === n ? i && o.slice(-i.length) === i : "~=" === n ? (" " + o.replace(se, " ") + " ").indexOf(i) > -1 : "|=" === n && (o === i || o.slice(0, i.length + 1) === i + "-")) } },
                    CHILD: function(e, t, n, i, r) {
                        var o = "nth" !== e.slice(0, 3),
                            s = "last" !== e.slice(-4),
                            a = "of-type" === t;
                        return 1 === i && 0 === r ? function(e) { return !!e.parentNode } : function(t, n, l) {
                            var c, u, p, d, h, f, v = o !== s ? "nextSibling" : "previousSibling",
                                g = t.parentNode,
                                m = a && t.nodeName.toLowerCase(),
                                y = !l && !a,
                                b = !1;
                            if (g) {
                                if (o) {
                                    for (; v;) {
                                        for (d = t; d = d[v];)
                                            if (a ? d.nodeName.toLowerCase() === m : 1 === d.nodeType) return !1;
                                        f = v = "only" === e && !f && "nextSibling"
                                    }
                                    return !0
                                }
                                if (f = [s ? g.firstChild : g.lastChild], s && y) {
                                    for (d = g, p = d[R] || (d[R] = {}), u = p[d.uniqueID] || (p[d.uniqueID] = {}), c = u[e] || [], h = c[0] === B && c[1], b = h && c[2], d = h && g.childNodes[h]; d = ++h && d && d[v] || (b = h = 0) || f.pop();)
                                        if (1 === d.nodeType && ++b && d === t) { u[e] = [B, h, b]; break }
                                } else if (y && (d = t, p = d[R] || (d[R] = {}), u = p[d.uniqueID] || (p[d.uniqueID] = {}), c = u[e] || [], h = c[0] === B && c[1], b = h), b === !1)
                                    for (;
                                        (d = ++h && d && d[v] || (b = h = 0) || f.pop()) && ((a ? d.nodeName.toLowerCase() !== m : 1 !== d.nodeType) || !++b || (y && (p = d[R] || (d[R] = {}), u = p[d.uniqueID] || (p[d.uniqueID] = {}), u[e] = [B, b]), d !== t)););
                                return b -= r, b === i || b % i === 0 && b / i >= 0
                            }
                        }
                    },
                    PSEUDO: function(e, n) { var r, o = x.pseudos[e] || x.setFilters[e.toLowerCase()] || t.error("unsupported pseudo: " + e); return o[R] ? o(n) : o.length > 1 ? (r = [e, e, "", n], x.setFilters.hasOwnProperty(e.toLowerCase()) ? i(function(e, t) { for (var i, r = o(e, n), s = r.length; s--;) i = ee(e, r[s]), e[i] = !(t[i] = r[s]) }) : function(e) { return o(e, 0, r) }) : o }
                },
                pseudos: {
                    not: i(function(e) {
                        var t = [],
                            n = [],
                            r = E(e.replace(ae, "$1"));
                        return r[R] ? i(function(e, t, n, i) { for (var o, s = r(e, null, i, []), a = e.length; a--;)(o = s[a]) && (e[a] = !(t[a] = o)) }) : function(e, i, o) { return t[0] = e, r(t, null, o, n), t[0] = null, !n.pop() }
                    }),
                    has: i(function(e) { return function(n) { return t(e, n).length > 0 } }),
                    contains: i(function(e) {
                        return e = e.replace(ke, we),
                            function(t) { return (t.textContent || t.innerText || S(t)).indexOf(e) > -1 }
                    }),
                    lang: i(function(e) {
                        return de.test(e || "") || t.error("unsupported lang: " + e), e = e.replace(ke, we).toLowerCase(),
                            function(t) {
                                var n;
                                do
                                    if (n = D ? t.lang : t.getAttribute("xml:lang") || t.getAttribute("lang")) return n = n.toLowerCase(), n === e || 0 === n.indexOf(e + "-");
                                while ((t = t.parentNode) && 1 === t.nodeType);
                                return !1
                            }
                    }),
                    target: function(t) { var n = e.location && e.location.hash; return n && n.slice(1) === t.id },
                    root: function(e) { return e === O },
                    focus: function(e) { return e === L.activeElement && (!L.hasFocus || L.hasFocus()) && !!(e.type || e.href || ~e.tabIndex) },
                    enabled: function(e) { return e.disabled === !1 },
                    disabled: function(e) { return e.disabled === !0 },
                    checked: function(e) { var t = e.nodeName.toLowerCase(); return "input" === t && !!e.checked || "option" === t && !!e.selected },
                    selected: function(e) { return e.parentNode && e.parentNode.selectedIndex, e.selected === !0 },
                    empty: function(e) {
                        for (e = e.firstChild; e; e = e.nextSibling)
                            if (e.nodeType < 6) return !1;
                        return !0
                    },
                    parent: function(e) { return !x.pseudos.empty(e) },
                    header: function(e) { return ve.test(e.nodeName) },
                    input: function(e) { return fe.test(e.nodeName) },
                    button: function(e) { var t = e.nodeName.toLowerCase(); return "input" === t && "button" === e.type || "button" === t },
                    text: function(e) { var t; return "input" === e.nodeName.toLowerCase() && "text" === e.type && (null == (t = e.getAttribute("type")) || "text" === t.toLowerCase()) },
                    first: c(function() { return [0] }),
                    last: c(function(e, t) { return [t - 1] }),
                    eq: c(function(e, t, n) {
                        return [0 > n ? n + t : n]
                    }),
                    even: c(function(e, t) { for (var n = 0; t > n; n += 2) e.push(n); return e }),
                    odd: c(function(e, t) { for (var n = 1; t > n; n += 2) e.push(n); return e }),
                    lt: c(function(e, t, n) { for (var i = 0 > n ? n + t : n; --i >= 0;) e.push(i); return e }),
                    gt: c(function(e, t, n) { for (var i = 0 > n ? n + t : n; ++i < t;) e.push(i); return e })
                }
            }, x.pseudos.nth = x.pseudos.eq;
            for (k in { radio: !0, checkbox: !0, file: !0, password: !0, image: !0 }) x.pseudos[k] = a(k);
            for (k in { submit: !0, reset: !0 }) x.pseudos[k] = l(k);
            return p.prototype = x.filters = x.pseudos, x.setFilters = new p, C = t.tokenize = function(e, n) { var i, r, o, s, a, l, c, u = W[e + " "]; if (u) return n ? 0 : u.slice(0); for (a = e, l = [], c = x.preFilter; a;) { i && !(r = le.exec(a)) || (r && (a = a.slice(r[0].length) || a), l.push(o = [])), i = !1, (r = ce.exec(a)) && (i = r.shift(), o.push({ value: i, type: r[0].replace(ae, " ") }), a = a.slice(i.length)); for (s in x.filter) !(r = he[s].exec(a)) || c[s] && !(r = c[s](r)) || (i = r.shift(), o.push({ value: i, type: s, matches: r }), a = a.slice(i.length)); if (!i) break } return n ? a.length : a ? t.error(e) : W(e, l).slice(0) }, E = t.compile = function(e, t) {
                var n, i = [],
                    r = [],
                    o = U[e + " "];
                if (!o) {
                    for (t || (t = C(e)), n = t.length; n--;) o = y(t[n]), o[R] ? i.push(o) : r.push(o);
                    o = U(e, b(r, i)), o.selector = e
                }
                return o
            }, P = t.select = function(e, t, n, i) {
                var r, o, s, a, l, c = "function" == typeof e && e,
                    p = !i && C(e = c.selector || e);
                if (n = n || [], 1 === p.length) {
                    if (o = p[0] = p[0].slice(0), o.length > 2 && "ID" === (s = o[0]).type && w.getById && 9 === t.nodeType && D && x.relative[o[1].type]) {
                        if (t = (x.find.ID(s.matches[0].replace(ke, we), t) || [])[0], !t) return n;
                        c && (t = t.parentNode), e = e.slice(o.shift().value.length)
                    }
                    for (r = he.needsContext.test(e) ? 0 : o.length; r-- && (s = o[r], !x.relative[a = s.type]);)
                        if ((l = x.find[a]) && (i = l(s.matches[0].replace(ke, we), ye.test(o[0].type) && u(t.parentNode) || t))) { if (o.splice(r, 1), e = i.length && d(o), !e) return Q.apply(n, i), n; break }
                }
                return (c || E(e, p))(i, t, !D, n, !t || ye.test(e) && u(t.parentNode) || t), n
            }, w.sortStable = R.split("").sort(V).join("") === R, w.detectDuplicates = !!A, N(), w.sortDetached = r(function(e) { return 1 & e.compareDocumentPosition(L.createElement("div")) }), r(function(e) { return e.innerHTML = "<a href='#'></a>", "#" === e.firstChild.getAttribute("href") }) || o("type|href|height|width", function(e, t, n) { return n ? void 0 : e.getAttribute(t, "type" === t.toLowerCase() ? 1 : 2) }), w.attributes && r(function(e) { return e.innerHTML = "<input/>", e.firstChild.setAttribute("value", ""), "" === e.firstChild.getAttribute("value") }) || o("value", function(e, t, n) { return n || "input" !== e.nodeName.toLowerCase() ? void 0 : e.defaultValue }), r(function(e) { return null == e.getAttribute("disabled") }) || o(te, function(e, t, n) { var i; return n ? void 0 : e[t] === !0 ? t.toLowerCase() : (i = e.getAttributeNode(t)) && i.specified ? i.value : null }), t
        }(e);
        oe.find = ue, oe.expr = ue.selectors, oe.expr[":"] = oe.expr.pseudos, oe.uniqueSort = oe.unique = ue.uniqueSort, oe.text = ue.getText, oe.isXMLDoc = ue.isXML, oe.contains = ue.contains;
        var pe = function(e, t, n) {
                for (var i = [], r = void 0 !== n;
                    (e = e[t]) && 9 !== e.nodeType;)
                    if (1 === e.nodeType) {
                        if (r && oe(e).is(n)) break;
                        i.push(e)
                    }
                return i
            },
            de = function(e, t) { for (var n = []; e; e = e.nextSibling) 1 === e.nodeType && e !== t && n.push(e); return n },
            he = oe.expr.match.needsContext,
            fe = /^<([\w-]+)\s*\/?>(?:<\/\1>|)$/,
            ve = /^.[^:#\[\.,]*$/;
        oe.filter = function(e, t, n) { var i = t[0]; return n && (e = ":not(" + e + ")"), 1 === t.length && 1 === i.nodeType ? oe.find.matchesSelector(i, e) ? [i] : [] : oe.find.matches(e, oe.grep(t, function(e) { return 1 === e.nodeType })) }, oe.fn.extend({
            find: function(e) {
                var t, n = this.length,
                    i = [],
                    r = this;
                if ("string" != typeof e) return this.pushStack(oe(e).filter(function() {
                    for (t = 0; n > t; t++)
                        if (oe.contains(r[t], this)) return !0
                }));
                for (t = 0; n > t; t++) oe.find(e, r[t], i);
                return i = this.pushStack(n > 1 ? oe.unique(i) : i), i.selector = this.selector ? this.selector + " " + e : e, i
            },
            filter: function(e) { return this.pushStack(i(this, e || [], !1)) },
            not: function(e) { return this.pushStack(i(this, e || [], !0)) },
            is: function(e) { return !!i(this, "string" == typeof e && he.test(e) ? oe(e) : e || [], !1).length }
        });
        var ge, me = /^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,
            ye = oe.fn.init = function(e, t, n) {
                var i, r;
                if (!e) return this;
                if (n = n || ge, "string" == typeof e) {
                    if (i = "<" === e[0] && ">" === e[e.length - 1] && e.length >= 3 ? [null, e, null] : me.exec(e), !i || !i[1] && t) return !t || t.jquery ? (t || n).find(e) : this.constructor(t).find(e);
                    if (i[1]) {
                        if (t = t instanceof oe ? t[0] : t, oe.merge(this, oe.parseHTML(i[1], t && t.nodeType ? t.ownerDocument || t : Y, !0)), fe.test(i[1]) && oe.isPlainObject(t))
                            for (i in t) oe.isFunction(this[i]) ? this[i](t[i]) : this.attr(i, t[i]);
                        return this
                    }
                    return r = Y.getElementById(i[2]), r && r.parentNode && (this.length = 1, this[0] = r), this.context = Y, this.selector = e, this
                }
                return e.nodeType ? (this.context = this[0] = e, this.length = 1, this) : oe.isFunction(e) ? void 0 !== n.ready ? n.ready(e) : e(oe) : (void 0 !== e.selector && (this.selector = e.selector, this.context = e.context), oe.makeArray(e, this))
            };
        ye.prototype = oe.fn, ge = oe(Y);
        var be = /^(?:parents|prev(?:Until|All))/,
            ke = { children: !0, contents: !0, next: !0, prev: !0 };
        oe.fn.extend({
            has: function(e) {
                var t = oe(e, this),
                    n = t.length;
                return this.filter(function() {
                    for (var e = 0; n > e; e++)
                        if (oe.contains(this, t[e])) return !0
                })
            },
            closest: function(e, t) {
                for (var n, i = 0, r = this.length, o = [], s = he.test(e) || "string" != typeof e ? oe(e, t || this.context) : 0; r > i; i++)
                    for (n = this[i]; n && n !== t; n = n.parentNode)
                        if (n.nodeType < 11 && (s ? s.index(n) > -1 : 1 === n.nodeType && oe.find.matchesSelector(n, e))) { o.push(n); break }
                return this.pushStack(o.length > 1 ? oe.uniqueSort(o) : o)
            },
            index: function(e) { return e ? "string" == typeof e ? Z.call(oe(e), this[0]) : Z.call(this, e.jquery ? e[0] : e) : this[0] && this[0].parentNode ? this.first().prevAll().length : -1 },
            add: function(e, t) { return this.pushStack(oe.uniqueSort(oe.merge(this.get(), oe(e, t)))) },
            addBack: function(e) { return this.add(null == e ? this.prevObject : this.prevObject.filter(e)) }
        }), oe.each({ parent: function(e) { var t = e.parentNode; return t && 11 !== t.nodeType ? t : null }, parents: function(e) { return pe(e, "parentNode") }, parentsUntil: function(e, t, n) { return pe(e, "parentNode", n) }, next: function(e) { return r(e, "nextSibling") }, prev: function(e) { return r(e, "previousSibling") }, nextAll: function(e) { return pe(e, "nextSibling") }, prevAll: function(e) { return pe(e, "previousSibling") }, nextUntil: function(e, t, n) { return pe(e, "nextSibling", n) }, prevUntil: function(e, t, n) { return pe(e, "previousSibling", n) }, siblings: function(e) { return de((e.parentNode || {}).firstChild, e) }, children: function(e) { return de(e.firstChild) }, contents: function(e) { return e.contentDocument || oe.merge([], e.childNodes) } }, function(e, t) { oe.fn[e] = function(n, i) { var r = oe.map(this, t, n); return "Until" !== e.slice(-5) && (i = n), i && "string" == typeof i && (r = oe.filter(i, r)), this.length > 1 && (ke[e] || oe.uniqueSort(r), be.test(e) && r.reverse()), this.pushStack(r) } });
        var we = /\S+/g;
        oe.Callbacks = function(e) {
            e = "string" == typeof e ? o(e) : oe.extend({}, e);
            var t, n, i, r, s = [],
                a = [],
                l = -1,
                c = function() {
                    for (r = e.once, i = t = !0; a.length; l = -1)
                        for (n = a.shift(); ++l < s.length;) s[l].apply(n[0], n[1]) === !1 && e.stopOnFalse && (l = s.length, n = !1);
                    e.memory || (n = !1), t = !1, r && (s = n ? [] : "")
                },
                u = {
                    add: function() { return s && (n && !t && (l = s.length - 1, a.push(n)), function t(n) { oe.each(n, function(n, i) { oe.isFunction(i) ? e.unique && u.has(i) || s.push(i) : i && i.length && "string" !== oe.type(i) && t(i) }) }(arguments), n && !t && c()), this },
                    remove: function() {
                        return oe.each(arguments, function(e, t) {
                            for (var n;
                                (n = oe.inArray(t, s, n)) > -1;) s.splice(n, 1), l >= n && l--
                        }), this
                    },
                    has: function(e) { return e ? oe.inArray(e, s) > -1 : s.length > 0 },
                    empty: function() { return s && (s = []), this },
                    disable: function() { return r = a = [], s = n = "", this },
                    disabled: function() { return !s },
                    lock: function() { return r = a = [], n || (s = n = ""), this },
                    locked: function() { return !!r },
                    fireWith: function(e, n) { return r || (n = n || [], n = [e, n.slice ? n.slice() : n], a.push(n), t || c()), this },
                    fire: function() { return u.fireWith(this, arguments), this },
                    fired: function() { return !!i }
                };
            return u
        }, oe.extend({
            Deferred: function(e) {
                var t = [
                        ["resolve", "done", oe.Callbacks("once memory"), "resolved"],
                        ["reject", "fail", oe.Callbacks("once memory"), "rejected"],
                        ["notify", "progress", oe.Callbacks("memory")]
                    ],
                    n = "pending",
                    i = {
                        state: function() { return n },
                        always: function() { return r.done(arguments).fail(arguments), this },
                        then: function() {
                            var e = arguments;
                            return oe.Deferred(function(n) {
                                oe.each(t, function(t, o) {
                                    var s = oe.isFunction(e[t]) && e[t];
                                    r[o[1]](function() {
                                        var e = s && s.apply(this, arguments);
                                        e && oe.isFunction(e.promise) ? e.promise().progress(n.notify).done(n.resolve).fail(n.reject) : n[o[0] + "With"](this === i ? n.promise() : this, s ? [e] : arguments)
                                    })
                                }), e = null
                            }).promise()
                        },
                        promise: function(e) { return null != e ? oe.extend(e, i) : i }
                    },
                    r = {};
                return i.pipe = i.then, oe.each(t, function(e, o) {
                    var s = o[2],
                        a = o[3];
                    i[o[1]] = s.add, a && s.add(function() { n = a }, t[1 ^ e][2].disable, t[2][2].lock), r[o[0]] = function() { return r[o[0] + "With"](this === r ? i : this, arguments), this }, r[o[0] + "With"] = s.fireWith
                }), i.promise(r), e && e.call(r, r), r
            },
            when: function(e) {
                var t, n, i, r = 0,
                    o = G.call(arguments),
                    s = o.length,
                    a = 1 !== s || e && oe.isFunction(e.promise) ? s : 0,
                    l = 1 === a ? e : oe.Deferred(),
                    c = function(e, n, i) { return function(r) { n[e] = this, i[e] = arguments.length > 1 ? G.call(arguments) : r, i === t ? l.notifyWith(n, i) : --a || l.resolveWith(n, i) } };
                if (s > 1)
                    for (t = new Array(s), n = new Array(s), i = new Array(s); s > r; r++) o[r] && oe.isFunction(o[r].promise) ? o[r].promise().progress(c(r, n, t)).done(c(r, i, o)).fail(l.reject) : --a;
                return a || l.resolveWith(i, o), l.promise()
            }
        });
        var xe;
        oe.fn.ready = function(e) { return oe.ready.promise().done(e), this }, oe.extend({
            isReady: !1,
            readyWait: 1,
            holdReady: function(e) { e ? oe.readyWait++ : oe.ready(!0) },
            ready: function(e) {
                (e === !0 ? --oe.readyWait : oe.isReady) || (oe.isReady = !0, e !== !0 && --oe.readyWait > 0 || (xe.resolveWith(Y, [oe]), oe.fn.triggerHandler && (oe(Y).triggerHandler("ready"), oe(Y).off("ready"))))
            }
        }), oe.ready.promise = function(t) { return xe || (xe = oe.Deferred(), "complete" === Y.readyState || "loading" !== Y.readyState && !Y.documentElement.doScroll ? e.setTimeout(oe.ready) : (Y.addEventListener("DOMContentLoaded", s), e.addEventListener("load", s))), xe.promise(t) }, oe.ready.promise();
        var Se = function(e, t, n, i, r, o, s) {
                var a = 0,
                    l = e.length,
                    c = null == n;
                if ("object" === oe.type(n)) { r = !0; for (a in n) Se(e, t, a, n[a], !0, o, s) } else if (void 0 !== i && (r = !0, oe.isFunction(i) || (s = !0), c && (s ? (t.call(e, i), t = null) : (c = t, t = function(e, t, n) { return c.call(oe(e), n) })), t))
                    for (; l > a; a++) t(e[a], n, s ? i : i.call(e[a], a, t(e[a], n)));
                return r ? e : c ? t.call(e) : l ? t(e[0], n) : o
            },
            Te = function(e) { return 1 === e.nodeType || 9 === e.nodeType || !+e.nodeType };
        a.uid = 1, a.prototype = {
            register: function(e, t) { var n = t || {}; return e.nodeType ? e[this.expando] = n : Object.defineProperty(e, this.expando, { value: n, writable: !0, configurable: !0 }), e[this.expando] },
            cache: function(e) { if (!Te(e)) return {}; var t = e[this.expando]; return t || (t = {}, Te(e) && (e.nodeType ? e[this.expando] = t : Object.defineProperty(e, this.expando, { value: t, configurable: !0 }))), t },
            set: function(e, t, n) {
                var i, r = this.cache(e);
                if ("string" == typeof t) r[t] = n;
                else
                    for (i in t) r[i] = t[i];
                return r
            },
            get: function(e, t) { return void 0 === t ? this.cache(e) : e[this.expando] && e[this.expando][t] },
            access: function(e, t, n) { var i; return void 0 === t || t && "string" == typeof t && void 0 === n ? (i = this.get(e, t), void 0 !== i ? i : this.get(e, oe.camelCase(t))) : (this.set(e, t, n), void 0 !== n ? n : t) },
            remove: function(e, t) {
                var n, i, r, o = e[this.expando];
                if (void 0 !== o) {
                    if (void 0 === t) this.register(e);
                    else { oe.isArray(t) ? i = t.concat(t.map(oe.camelCase)) : (r = oe.camelCase(t), t in o ? i = [t, r] : (i = r, i = i in o ? [i] : i.match(we) || [])), n = i.length; for (; n--;) delete o[i[n]] }(void 0 === t || oe.isEmptyObject(o)) && (e.nodeType ? e[this.expando] = void 0 : delete e[this.expando])
                }
            },
            hasData: function(e) { var t = e[this.expando]; return void 0 !== t && !oe.isEmptyObject(t) }
        };
        var Ce = new a,
            Ee = new a,
            Pe = /^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,
            $e = /[A-Z]/g;
        oe.extend({ hasData: function(e) { return Ee.hasData(e) || Ce.hasData(e) }, data: function(e, t, n) { return Ee.access(e, t, n) }, removeData: function(e, t) { Ee.remove(e, t) }, _data: function(e, t, n) { return Ce.access(e, t, n) }, _removeData: function(e, t) { Ce.remove(e, t) } }), oe.fn.extend({
            data: function(e, t) {
                var n, i, r, o = this[0],
                    s = o && o.attributes;
                if (void 0 === e) {
                    if (this.length && (r = Ee.get(o), 1 === o.nodeType && !Ce.get(o, "hasDataAttrs"))) {
                        for (n = s.length; n--;) s[n] && (i = s[n].name, 0 === i.indexOf("data-") && (i = oe.camelCase(i.slice(5)), l(o, i, r[i])));
                        Ce.set(o, "hasDataAttrs", !0)
                    }
                    return r
                }
                return "object" == typeof e ? this.each(function() { Ee.set(this, e) }) : Se(this, function(t) {
                    var n, i;
                    if (o && void 0 === t) { if (n = Ee.get(o, e) || Ee.get(o, e.replace($e, "-$&").toLowerCase()), void 0 !== n) return n; if (i = oe.camelCase(e), n = Ee.get(o, i), void 0 !== n) return n; if (n = l(o, i, void 0), void 0 !== n) return n } else i = oe.camelCase(e), this.each(function() {
                        var n = Ee.get(this, i);
                        Ee.set(this, i, t), e.indexOf("-") > -1 && void 0 !== n && Ee.set(this, e, t)
                    })
                }, null, t, arguments.length > 1, null, !0)
            },
            removeData: function(e) { return this.each(function() { Ee.remove(this, e) }) }
        }), oe.extend({
            queue: function(e, t, n) { var i; return e ? (t = (t || "fx") + "queue", i = Ce.get(e, t), n && (!i || oe.isArray(n) ? i = Ce.access(e, t, oe.makeArray(n)) : i.push(n)), i || []) : void 0 },
            dequeue: function(e, t) {
                t = t || "fx";
                var n = oe.queue(e, t),
                    i = n.length,
                    r = n.shift(),
                    o = oe._queueHooks(e, t),
                    s = function() { oe.dequeue(e, t) };
                "inprogress" === r && (r = n.shift(), i--), r && ("fx" === t && n.unshift("inprogress"), delete o.stop, r.call(e, s, o)), !i && o && o.empty.fire()
            },
            _queueHooks: function(e, t) { var n = t + "queueHooks"; return Ce.get(e, n) || Ce.access(e, n, { empty: oe.Callbacks("once memory").add(function() { Ce.remove(e, [t + "queue", n]) }) }) }
        }), oe.fn.extend({
            queue: function(e, t) {
                var n = 2;
                return "string" != typeof e && (t = e, e = "fx", n--), arguments.length < n ? oe.queue(this[0], e) : void 0 === t ? this : this.each(function() {
                    var n = oe.queue(this, e, t);
                    oe._queueHooks(this, e), "fx" === e && "inprogress" !== n[0] && oe.dequeue(this, e)
                })
            },
            dequeue: function(e) { return this.each(function() { oe.dequeue(this, e) }) },
            clearQueue: function(e) { return this.queue(e || "fx", []) },
            promise: function(e, t) {
                var n, i = 1,
                    r = oe.Deferred(),
                    o = this,
                    s = this.length,
                    a = function() {--i || r.resolveWith(o, [o]) };
                for ("string" != typeof e && (t = e, e = void 0), e = e || "fx"; s--;) n = Ce.get(o[s], e + "queueHooks"), n && n.empty && (i++, n.empty.add(a));
                return a(), r.promise(t)
            }
        });
        var _e = /[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,
            Ae = new RegExp("^(?:([+-])=|)(" + _e + ")([a-z%]*)$", "i"),
            Ne = ["Top", "Right", "Bottom", "Left"],
            Le = function(e, t) { return e = t || e, "none" === oe.css(e, "display") || !oe.contains(e.ownerDocument, e) },
            Oe = /^(?:checkbox|radio)$/i,
            De = /<([\w:-]+)/,
            je = /^$|\/(?:java|ecma)script/i,
            He = { option: [1, "<select multiple='multiple'>", "</select>"], thead: [1, "<table>", "</table>"], col: [2, "<table><colgroup>", "</colgroup></table>"], tr: [2, "<table><tbody>", "</tbody></table>"], td: [3, "<table><tbody><tr>", "</tr></tbody></table>"], _default: [0, "", ""] };
        He.optgroup = He.option, He.tbody = He.tfoot = He.colgroup = He.caption = He.thead, He.th = He.td;
        var Ie = /<|&#?\w+;/;
        ! function() {
            var e = Y.createDocumentFragment(),
                t = e.appendChild(Y.createElement("div")),
                n = Y.createElement("input");
            n.setAttribute("type", "radio"), n.setAttribute("checked", "checked"), n.setAttribute("name", "t"), t.appendChild(n), ie.checkClone = t.cloneNode(!0).cloneNode(!0).lastChild.checked, t.innerHTML = "<textarea>x</textarea>", ie.noCloneChecked = !!t.cloneNode(!0).lastChild.defaultValue
        }();
        var Me = /^key/,
            Re = /^(?:mouse|pointer|contextmenu|drag|drop)|click/,
            qe = /^([^.]*)(?:\.(.+)|)/;
        oe.event = {
            global: {},
            add: function(e, t, n, i, r) {
                var o, s, a, l, c, u, p, d, h, f, v, g = Ce.get(e);
                if (g)
                    for (n.handler && (o = n, n = o.handler, r = o.selector), n.guid || (n.guid = oe.guid++), (l = g.events) || (l = g.events = {}), (s = g.handle) || (s = g.handle = function(t) { return "undefined" != typeof oe && oe.event.triggered !== t.type ? oe.event.dispatch.apply(e, arguments) : void 0 }), t = (t || "").match(we) || [""], c = t.length; c--;) a = qe.exec(t[c]) || [], h = v = a[1], f = (a[2] || "").split(".").sort(), h && (p = oe.event.special[h] || {}, h = (r ? p.delegateType : p.bindType) || h, p = oe.event.special[h] || {}, u = oe.extend({ type: h, origType: v, data: i, handler: n, guid: n.guid, selector: r, needsContext: r && oe.expr.match.needsContext.test(r), namespace: f.join(".") }, o), (d = l[h]) || (d = l[h] = [], d.delegateCount = 0, p.setup && p.setup.call(e, i, f, s) !== !1 || e.addEventListener && e.addEventListener(h, s)), p.add && (p.add.call(e, u), u.handler.guid || (u.handler.guid = n.guid)), r ? d.splice(d.delegateCount++, 0, u) : d.push(u), oe.event.global[h] = !0)
            },
            remove: function(e, t, n, i, r) {
                var o, s, a, l, c, u, p, d, h, f, v, g = Ce.hasData(e) && Ce.get(e);
                if (g && (l = g.events)) {
                    for (t = (t || "").match(we) || [""], c = t.length; c--;)
                        if (a = qe.exec(t[c]) || [], h = v = a[1], f = (a[2] || "").split(".").sort(), h) {
                            for (p = oe.event.special[h] || {}, h = (i ? p.delegateType : p.bindType) || h, d = l[h] || [], a = a[2] && new RegExp("(^|\\.)" + f.join("\\.(?:.*\\.|)") + "(\\.|$)"), s = o = d.length; o--;) u = d[o], !r && v !== u.origType || n && n.guid !== u.guid || a && !a.test(u.namespace) || i && i !== u.selector && ("**" !== i || !u.selector) || (d.splice(o, 1), u.selector && d.delegateCount--, p.remove && p.remove.call(e, u));
                            s && !d.length && (p.teardown && p.teardown.call(e, f, g.handle) !== !1 || oe.removeEvent(e, h, g.handle), delete l[h])
                        } else
                            for (h in l) oe.event.remove(e, h + t[c], n, i, !0);
                    oe.isEmptyObject(l) && Ce.remove(e, "handle events")
                }
            },
            dispatch: function(e) {
                e = oe.event.fix(e);
                var t, n, i, r, o, s = [],
                    a = G.call(arguments),
                    l = (Ce.get(this, "events") || {})[e.type] || [],
                    c = oe.event.special[e.type] || {};
                if (a[0] = e, e.delegateTarget = this, !c.preDispatch || c.preDispatch.call(this, e) !== !1) {
                    for (s = oe.event.handlers.call(this, e, l), t = 0;
                        (r = s[t++]) && !e.isPropagationStopped();)
                        for (e.currentTarget = r.elem, n = 0;
                            (o = r.handlers[n++]) && !e.isImmediatePropagationStopped();) e.rnamespace && !e.rnamespace.test(o.namespace) || (e.handleObj = o, e.data = o.data, i = ((oe.event.special[o.origType] || {}).handle || o.handler).apply(r.elem, a), void 0 !== i && (e.result = i) === !1 && (e.preventDefault(), e.stopPropagation()));
                    return c.postDispatch && c.postDispatch.call(this, e), e.result
                }
            },
            handlers: function(e, t) {
                var n, i, r, o, s = [],
                    a = t.delegateCount,
                    l = e.target;
                if (a && l.nodeType && ("click" !== e.type || isNaN(e.button) || e.button < 1))
                    for (; l !== this; l = l.parentNode || this)
                        if (1 === l.nodeType && (l.disabled !== !0 || "click" !== e.type)) {
                            for (i = [], n = 0; a > n; n++) o = t[n], r = o.selector + " ", void 0 === i[r] && (i[r] = o.needsContext ? oe(r, this).index(l) > -1 : oe.find(r, this, null, [l]).length), i[r] && i.push(o);
                            i.length && s.push({ elem: l, handlers: i })
                        }
                return a < t.length && s.push({ elem: this, handlers: t.slice(a) }), s
            },
            props: "altKey bubbles cancelable ctrlKey currentTarget detail eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),
            fixHooks: {},
            keyHooks: { props: "char charCode key keyCode".split(" "), filter: function(e, t) { return null == e.which && (e.which = null != t.charCode ? t.charCode : t.keyCode), e } },
            mouseHooks: { props: "button buttons clientX clientY offsetX offsetY pageX pageY screenX screenY toElement".split(" "), filter: function(e, t) { var n, i, r, o = t.button; return null == e.pageX && null != t.clientX && (n = e.target.ownerDocument || Y, i = n.documentElement, r = n.body, e.pageX = t.clientX + (i && i.scrollLeft || r && r.scrollLeft || 0) - (i && i.clientLeft || r && r.clientLeft || 0), e.pageY = t.clientY + (i && i.scrollTop || r && r.scrollTop || 0) - (i && i.clientTop || r && r.clientTop || 0)), e.which || void 0 === o || (e.which = 1 & o ? 1 : 2 & o ? 3 : 4 & o ? 2 : 0), e } },
            fix: function(e) {
                if (e[oe.expando]) return e;
                var t, n, i, r = e.type,
                    o = e,
                    s = this.fixHooks[r];
                for (s || (this.fixHooks[r] = s = Re.test(r) ? this.mouseHooks : Me.test(r) ? this.keyHooks : {}), i = s.props ? this.props.concat(s.props) : this.props, e = new oe.Event(o), t = i.length; t--;) n = i[t], e[n] = o[n];
                return e.target || (e.target = Y), 3 === e.target.nodeType && (e.target = e.target.parentNode), s.filter ? s.filter(e, o) : e
            },
            special: { load: { noBubble: !0 }, focus: { trigger: function() { return this !== v() && this.focus ? (this.focus(), !1) : void 0 }, delegateType: "focusin" }, blur: { trigger: function() { return this === v() && this.blur ? (this.blur(), !1) : void 0 }, delegateType: "focusout" }, click: { trigger: function() { return "checkbox" === this.type && this.click && oe.nodeName(this, "input") ? (this.click(), !1) : void 0 }, _default: function(e) { return oe.nodeName(e.target, "a") } }, beforeunload: { postDispatch: function(e) { void 0 !== e.result && e.originalEvent && (e.originalEvent.returnValue = e.result) } } }
        }, oe.removeEvent = function(e, t, n) { e.removeEventListener && e.removeEventListener(t, n) }, oe.Event = function(e, t) { return this instanceof oe.Event ? (e && e.type ? (this.originalEvent = e, this.type = e.type, this.isDefaultPrevented = e.defaultPrevented || void 0 === e.defaultPrevented && e.returnValue === !1 ? h : f) : this.type = e, t && oe.extend(this, t), this.timeStamp = e && e.timeStamp || oe.now(), void(this[oe.expando] = !0)) : new oe.Event(e, t) }, oe.Event.prototype = {
            constructor: oe.Event,
            isDefaultPrevented: f,
            isPropagationStopped: f,
            isImmediatePropagationStopped: f,
            preventDefault: function() {
                var e = this.originalEvent;
                this.isDefaultPrevented = h, e && e.preventDefault()
            },
            stopPropagation: function() {
                var e = this.originalEvent;
                this.isPropagationStopped = h, e && e.stopPropagation()
            },
            stopImmediatePropagation: function() {
                var e = this.originalEvent;
                this.isImmediatePropagationStopped = h, e && e.stopImmediatePropagation(), this.stopPropagation()
            }
        }, oe.each({ mouseenter: "mouseover", mouseleave: "mouseout", pointerenter: "pointerover", pointerleave: "pointerout" }, function(e, t) {
            oe.event.special[e] = {
                delegateType: t,
                bindType: t,
                handle: function(e) {
                    var n, i = this,
                        r = e.relatedTarget,
                        o = e.handleObj;
                    return r && (r === i || oe.contains(i, r)) || (e.type = o.origType, n = o.handler.apply(this, arguments), e.type = t), n
                }
            }
        }), oe.fn.extend({ on: function(e, t, n, i) { return g(this, e, t, n, i) }, one: function(e, t, n, i) { return g(this, e, t, n, i, 1) }, off: function(e, t, n) { var i, r; if (e && e.preventDefault && e.handleObj) return i = e.handleObj, oe(e.delegateTarget).off(i.namespace ? i.origType + "." + i.namespace : i.origType, i.selector, i.handler), this; if ("object" == typeof e) { for (r in e) this.off(r, t, e[r]); return this } return t !== !1 && "function" != typeof t || (n = t, t = void 0), n === !1 && (n = f), this.each(function() { oe.event.remove(this, e, n, t) }) } });
        var Be = /<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:-]+)[^>]*)\/>/gi,
            Fe = /<script|<style|<link/i,
            ze = /checked\s*(?:[^=]|=\s*.checked.)/i,
            We = /^true\/(.*)/,
            Ue = /^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g;
        oe.extend({
            htmlPrefilter: function(e) { return e.replace(Be, "<$1></$2>") },
            clone: function(e, t, n) {
                var i, r, o, s, a = e.cloneNode(!0),
                    l = oe.contains(e.ownerDocument, e);
                if (!(ie.noCloneChecked || 1 !== e.nodeType && 11 !== e.nodeType || oe.isXMLDoc(e)))
                    for (s = u(a), o = u(e), i = 0, r = o.length; r > i; i++) w(o[i], s[i]);
                if (t)
                    if (n)
                        for (o = o || u(e), s = s || u(a), i = 0, r = o.length; r > i; i++) k(o[i], s[i]);
                    else k(e, a);
                return s = u(a, "script"), s.length > 0 && p(s, !l && u(e, "script")), a
            },
            cleanData: function(e) {
                for (var t, n, i, r = oe.event.special, o = 0; void 0 !== (n = e[o]); o++)
                    if (Te(n)) {
                        if (t = n[Ce.expando]) {
                            if (t.events)
                                for (i in t.events) r[i] ? oe.event.remove(n, i) : oe.removeEvent(n, i, t.handle);
                            n[Ce.expando] = void 0
                        }
                        n[Ee.expando] && (n[Ee.expando] = void 0)
                    }
            }
        }), oe.fn.extend({
            domManip: x,
            detach: function(e) { return S(this, e, !0) },
            remove: function(e) { return S(this, e) },
            text: function(e) { return Se(this, function(e) { return void 0 === e ? oe.text(this) : this.empty().each(function() { 1 !== this.nodeType && 11 !== this.nodeType && 9 !== this.nodeType || (this.textContent = e) }) }, null, e, arguments.length) },
            append: function() {
                return x(this, arguments, function(e) {
                    if (1 === this.nodeType || 11 === this.nodeType || 9 === this.nodeType) {
                        var t = m(this, e);
                        t.appendChild(e)
                    }
                })
            },
            prepend: function() {
                return x(this, arguments, function(e) {
                    if (1 === this.nodeType || 11 === this.nodeType || 9 === this.nodeType) {
                        var t = m(this, e);
                        t.insertBefore(e, t.firstChild)
                    }
                })
            },
            before: function() { return x(this, arguments, function(e) { this.parentNode && this.parentNode.insertBefore(e, this) }) },
            after: function() { return x(this, arguments, function(e) { this.parentNode && this.parentNode.insertBefore(e, this.nextSibling) }) },
            empty: function() { for (var e, t = 0; null != (e = this[t]); t++) 1 === e.nodeType && (oe.cleanData(u(e, !1)), e.textContent = ""); return this },
            clone: function(e, t) { return e = null != e && e, t = null == t ? e : t, this.map(function() { return oe.clone(this, e, t) }) },
            html: function(e) {
                return Se(this, function(e) {
                    var t = this[0] || {},
                        n = 0,
                        i = this.length;
                    if (void 0 === e && 1 === t.nodeType) return t.innerHTML;
                    if ("string" == typeof e && !Fe.test(e) && !He[(De.exec(e) || ["", ""])[1].toLowerCase()]) {
                        e = oe.htmlPrefilter(e);
                        try {
                            for (; i > n; n++) t = this[n] || {}, 1 === t.nodeType && (oe.cleanData(u(t, !1)), t.innerHTML = e);
                            t = 0
                        } catch (e) {}
                    }
                    t && this.empty().append(e)
                }, null, e, arguments.length)
            },
            replaceWith: function() {
                var e = [];
                return x(this, arguments, function(t) {
                    var n = this.parentNode;
                    oe.inArray(this, e) < 0 && (oe.cleanData(u(this)), n && n.replaceChild(t, this))
                }, e)
            }
        }), oe.each({ appendTo: "append", prependTo: "prepend", insertBefore: "before", insertAfter: "after", replaceAll: "replaceWith" }, function(e, t) { oe.fn[e] = function(e) { for (var n, i = [], r = oe(e), o = r.length - 1, s = 0; o >= s; s++) n = s === o ? this : this.clone(!0), oe(r[s])[t](n), Q.apply(i, n.get()); return this.pushStack(i) } });
        var Ve, Xe = { HTML: "block", BODY: "block" },
            Ke = /^margin/,
            Ye = new RegExp("^(" + _e + ")(?!px)[a-z%]+$", "i"),
            Ge = function(t) { var n = t.ownerDocument.defaultView; return n && n.opener || (n = e), n.getComputedStyle(t) },
            Je = function(e, t, n, i) {
                var r, o, s = {};
                for (o in t) s[o] = e.style[o], e.style[o] = t[o];
                r = n.apply(e, i || []);
                for (o in t) e.style[o] = s[o];
                return r
            },
            Qe = Y.documentElement;
        ! function() {
            function t() {
                a.style.cssText = "-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;position:relative;display:block;margin:auto;border:1px;padding:1px;top:1%;width:50%", a.innerHTML = "", Qe.appendChild(s);
                var t = e.getComputedStyle(a);
                n = "1%" !== t.top, o = "2px" === t.marginLeft, i = "4px" === t.width, a.style.marginRight = "50%", r = "4px" === t.marginRight, Qe.removeChild(s)
            }
            var n, i, r, o, s = Y.createElement("div"),
                a = Y.createElement("div");
            a.style && (a.style.backgroundClip = "content-box", a.cloneNode(!0).style.backgroundClip = "", ie.clearCloneStyle = "content-box" === a.style.backgroundClip, s.style.cssText = "border:0;width:8px;height:0;top:0;left:-9999px;padding:0;margin-top:1px;position:absolute", s.appendChild(a), oe.extend(ie, { pixelPosition: function() { return t(), n }, boxSizingReliable: function() { return null == i && t(), i }, pixelMarginRight: function() { return null == i && t(), r }, reliableMarginLeft: function() { return null == i && t(), o }, reliableMarginRight: function() { var t, n = a.appendChild(Y.createElement("div")); return n.style.cssText = a.style.cssText = "-webkit-box-sizing:content-box;box-sizing:content-box;display:block;margin:0;border:0;padding:0", n.style.marginRight = n.style.width = "0", a.style.width = "1px", Qe.appendChild(s), t = !parseFloat(e.getComputedStyle(n).marginRight), Qe.removeChild(s), a.removeChild(n), t } }))
        }();
        var Ze = /^(none|table(?!-c[ea]).+)/,
            et = { position: "absolute", visibility: "hidden", display: "block" },
            tt = { letterSpacing: "0", fontWeight: "400" },
            nt = ["Webkit", "O", "Moz", "ms"],
            it = Y.createElement("div").style;
        oe.extend({
            cssHooks: { opacity: { get: function(e, t) { if (t) { var n = E(e, "opacity"); return "" === n ? "1" : n } } } },
            cssNumber: { animationIterationCount: !0, columnCount: !0, fillOpacity: !0, flexGrow: !0, flexShrink: !0, fontWeight: !0, lineHeight: !0, opacity: !0, order: !0, orphans: !0, widows: !0, zIndex: !0, zoom: !0 },
            cssProps: { float: "cssFloat" },
            style: function(e, t, n, i) {
                if (e && 3 !== e.nodeType && 8 !== e.nodeType && e.style) {
                    var r, o, s, a = oe.camelCase(t),
                        l = e.style;
                    return t = oe.cssProps[a] || (oe.cssProps[a] = $(a) || a), s = oe.cssHooks[t] || oe.cssHooks[a], void 0 === n ? s && "get" in s && void 0 !== (r = s.get(e, !1, i)) ? r : l[t] : (o = typeof n, "string" === o && (r = Ae.exec(n)) && r[1] && (n = c(e, t, r), o = "number"), void(null != n && n === n && ("number" === o && (n += r && r[3] || (oe.cssNumber[a] ? "" : "px")), ie.clearCloneStyle || "" !== n || 0 !== t.indexOf("background") || (l[t] = "inherit"), s && "set" in s && void 0 === (n = s.set(e, n, i)) || (l[t] = n))))
                }
            },
            css: function(e, t, n, i) { var r, o, s, a = oe.camelCase(t); return t = oe.cssProps[a] || (oe.cssProps[a] = $(a) || a), s = oe.cssHooks[t] || oe.cssHooks[a], s && "get" in s && (r = s.get(e, !0, n)), void 0 === r && (r = E(e, t, i)), "normal" === r && t in tt && (r = tt[t]), "" === n || n ? (o = parseFloat(r), n === !0 || isFinite(o) ? o || 0 : r) : r }
        }), oe.each(["height", "width"], function(e, t) {
            oe.cssHooks[t] = {
                get: function(e, n, i) { return n ? Ze.test(oe.css(e, "display")) && 0 === e.offsetWidth ? Je(e, et, function() { return N(e, t, i) }) : N(e, t, i) : void 0 },
                set: function(e, n, i) {
                    var r, o = i && Ge(e),
                        s = i && A(e, t, i, "border-box" === oe.css(e, "boxSizing", !1, o), o);
                    return s && (r = Ae.exec(n)) && "px" !== (r[3] || "px") && (e.style[t] = n, n = oe.css(e, t)), _(e, n, s)
                }
            }
        }), oe.cssHooks.marginLeft = P(ie.reliableMarginLeft, function(e, t) { return t ? (parseFloat(E(e, "marginLeft")) || e.getBoundingClientRect().left - Je(e, { marginLeft: 0 }, function() { return e.getBoundingClientRect().left })) + "px" : void 0 }), oe.cssHooks.marginRight = P(ie.reliableMarginRight, function(e, t) { return t ? Je(e, { display: "inline-block" }, E, [e, "marginRight"]) : void 0 }), oe.each({ margin: "", padding: "", border: "Width" }, function(e, t) { oe.cssHooks[e + t] = { expand: function(n) { for (var i = 0, r = {}, o = "string" == typeof n ? n.split(" ") : [n]; 4 > i; i++) r[e + Ne[i] + t] = o[i] || o[i - 2] || o[0]; return r } }, Ke.test(e) || (oe.cssHooks[e + t].set = _) }), oe.fn.extend({
            css: function(e, t) {
                return Se(this, function(e, t, n) {
                    var i, r, o = {},
                        s = 0;
                    if (oe.isArray(t)) { for (i = Ge(e), r = t.length; r > s; s++) o[t[s]] = oe.css(e, t[s], !1, i); return o }
                    return void 0 !== n ? oe.style(e, t, n) : oe.css(e, t)
                }, e, t, arguments.length > 1)
            },
            show: function() { return L(this, !0) },
            hide: function() { return L(this) },
            toggle: function(e) { return "boolean" == typeof e ? e ? this.show() : this.hide() : this.each(function() { Le(this) ? oe(this).show() : oe(this).hide() }) }
        }), oe.Tween = O, O.prototype = { constructor: O, init: function(e, t, n, i, r, o) { this.elem = e, this.prop = n, this.easing = r || oe.easing._default, this.options = t, this.start = this.now = this.cur(), this.end = i, this.unit = o || (oe.cssNumber[n] ? "" : "px") }, cur: function() { var e = O.propHooks[this.prop]; return e && e.get ? e.get(this) : O.propHooks._default.get(this) }, run: function(e) { var t, n = O.propHooks[this.prop]; return this.options.duration ? this.pos = t = oe.easing[this.easing](e, this.options.duration * e, 0, 1, this.options.duration) : this.pos = t = e, this.now = (this.end - this.start) * t + this.start, this.options.step && this.options.step.call(this.elem, this.now, this), n && n.set ? n.set(this) : O.propHooks._default.set(this), this } }, O.prototype.init.prototype = O.prototype, O.propHooks = { _default: { get: function(e) { var t; return 1 !== e.elem.nodeType || null != e.elem[e.prop] && null == e.elem.style[e.prop] ? e.elem[e.prop] : (t = oe.css(e.elem, e.prop, ""), t && "auto" !== t ? t : 0) }, set: function(e) { oe.fx.step[e.prop] ? oe.fx.step[e.prop](e) : 1 !== e.elem.nodeType || null == e.elem.style[oe.cssProps[e.prop]] && !oe.cssHooks[e.prop] ? e.elem[e.prop] = e.now : oe.style(e.elem, e.prop, e.now + e.unit) } } }, O.propHooks.scrollTop = O.propHooks.scrollLeft = { set: function(e) { e.elem.nodeType && e.elem.parentNode && (e.elem[e.prop] = e.now) } }, oe.easing = { linear: function(e) { return e }, swing: function(e) { return .5 - Math.cos(e * Math.PI) / 2 }, _default: "swing" }, oe.fx = O.prototype.init, oe.fx.step = {};
        var rt, ot, st = /^(?:toggle|show|hide)$/,
            at = /queueHooks$/;
        oe.Animation = oe.extend(R, { tweeners: { "*": [function(e, t) { var n = this.createTween(e, t); return c(n.elem, e, Ae.exec(t), n), n }] }, tweener: function(e, t) { oe.isFunction(e) ? (t = e, e = ["*"]) : e = e.match(we); for (var n, i = 0, r = e.length; r > i; i++) n = e[i], R.tweeners[n] = R.tweeners[n] || [], R.tweeners[n].unshift(t) }, prefilters: [I], prefilter: function(e, t) { t ? R.prefilters.unshift(e) : R.prefilters.push(e) } }), oe.speed = function(e, t, n) { var i = e && "object" == typeof e ? oe.extend({}, e) : { complete: n || !n && t || oe.isFunction(e) && e, duration: e, easing: n && t || t && !oe.isFunction(t) && t }; return i.duration = oe.fx.off ? 0 : "number" == typeof i.duration ? i.duration : i.duration in oe.fx.speeds ? oe.fx.speeds[i.duration] : oe.fx.speeds._default, null != i.queue && i.queue !== !0 || (i.queue = "fx"), i.old = i.complete, i.complete = function() { oe.isFunction(i.old) && i.old.call(this), i.queue && oe.dequeue(this, i.queue) }, i }, oe.fn.extend({
                fadeTo: function(e, t, n, i) { return this.filter(Le).css("opacity", 0).show().end().animate({ opacity: t }, e, n, i) },
                animate: function(e, t, n, i) {
                    var r = oe.isEmptyObject(e),
                        o = oe.speed(t, n, i),
                        s = function() {
                            var t = R(this, oe.extend({}, e), o);
                            (r || Ce.get(this, "finish")) && t.stop(!0)
                        };
                    return s.finish = s, r || o.queue === !1 ? this.each(s) : this.queue(o.queue, s)
                },
                stop: function(e, t, n) {
                    var i = function(e) {
                        var t = e.stop;
                        delete e.stop, t(n)
                    };
                    return "string" != typeof e && (n = t, t = e, e = void 0), t && e !== !1 && this.queue(e || "fx", []), this.each(function() {
                        var t = !0,
                            r = null != e && e + "queueHooks",
                            o = oe.timers,
                            s = Ce.get(this);
                        if (r) s[r] && s[r].stop && i(s[r]);
                        else
                            for (r in s) s[r] && s[r].stop && at.test(r) && i(s[r]);
                        for (r = o.length; r--;) o[r].elem !== this || null != e && o[r].queue !== e || (o[r].anim.stop(n), t = !1, o.splice(r, 1));
                        !t && n || oe.dequeue(this, e)
                    })
                },
                finish: function(e) {
                    return e !== !1 && (e = e || "fx"), this.each(function() {
                        var t, n = Ce.get(this),
                            i = n[e + "queue"],
                            r = n[e + "queueHooks"],
                            o = oe.timers,
                            s = i ? i.length : 0;
                        for (n.finish = !0, oe.queue(this, e, []), r && r.stop && r.stop.call(this, !0), t = o.length; t--;) o[t].elem === this && o[t].queue === e && (o[t].anim.stop(!0), o.splice(t, 1));
                        for (t = 0; s > t; t++) i[t] && i[t].finish && i[t].finish.call(this);
                        delete n.finish
                    })
                }
            }), oe.each(["toggle", "show", "hide"], function(e, t) {
                var n = oe.fn[t];
                oe.fn[t] = function(e, i, r) { return null == e || "boolean" == typeof e ? n.apply(this, arguments) : this.animate(j(t, !0), e, i, r) }
            }), oe.each({ slideDown: j("show"), slideUp: j("hide"), slideToggle: j("toggle"), fadeIn: { opacity: "show" }, fadeOut: { opacity: "hide" }, fadeToggle: { opacity: "toggle" } }, function(e, t) { oe.fn[e] = function(e, n, i) { return this.animate(t, e, n, i) } }), oe.timers = [], oe.fx.tick = function() {
                var e, t = 0,
                    n = oe.timers;
                for (rt = oe.now(); t < n.length; t++) e = n[t],
                    e() || n[t] !== e || n.splice(t--, 1);
                n.length || oe.fx.stop(), rt = void 0
            }, oe.fx.timer = function(e) { oe.timers.push(e), e() ? oe.fx.start() : oe.timers.pop() }, oe.fx.interval = 13, oe.fx.start = function() { ot || (ot = e.setInterval(oe.fx.tick, oe.fx.interval)) }, oe.fx.stop = function() { e.clearInterval(ot), ot = null }, oe.fx.speeds = { slow: 600, fast: 200, _default: 400 }, oe.fn.delay = function(t, n) {
                return t = oe.fx ? oe.fx.speeds[t] || t : t, n = n || "fx", this.queue(n, function(n, i) {
                    var r = e.setTimeout(n, t);
                    i.stop = function() { e.clearTimeout(r) }
                })
            },
            function() {
                var e = Y.createElement("input"),
                    t = Y.createElement("select"),
                    n = t.appendChild(Y.createElement("option"));
                e.type = "checkbox", ie.checkOn = "" !== e.value, ie.optSelected = n.selected, t.disabled = !0, ie.optDisabled = !n.disabled, e = Y.createElement("input"), e.value = "t", e.type = "radio", ie.radioValue = "t" === e.value
            }();
        var lt, ct = oe.expr.attrHandle;
        oe.fn.extend({ attr: function(e, t) { return Se(this, oe.attr, e, t, arguments.length > 1) }, removeAttr: function(e) { return this.each(function() { oe.removeAttr(this, e) }) } }), oe.extend({
            attr: function(e, t, n) { var i, r, o = e.nodeType; if (3 !== o && 8 !== o && 2 !== o) return "undefined" == typeof e.getAttribute ? oe.prop(e, t, n) : (1 === o && oe.isXMLDoc(e) || (t = t.toLowerCase(), r = oe.attrHooks[t] || (oe.expr.match.bool.test(t) ? lt : void 0)), void 0 !== n ? null === n ? void oe.removeAttr(e, t) : r && "set" in r && void 0 !== (i = r.set(e, n, t)) ? i : (e.setAttribute(t, n + ""), n) : r && "get" in r && null !== (i = r.get(e, t)) ? i : (i = oe.find.attr(e, t), null == i ? void 0 : i)) },
            attrHooks: { type: { set: function(e, t) { if (!ie.radioValue && "radio" === t && oe.nodeName(e, "input")) { var n = e.value; return e.setAttribute("type", t), n && (e.value = n), t } } } },
            removeAttr: function(e, t) {
                var n, i, r = 0,
                    o = t && t.match(we);
                if (o && 1 === e.nodeType)
                    for (; n = o[r++];) i = oe.propFix[n] || n, oe.expr.match.bool.test(n) && (e[i] = !1), e.removeAttribute(n)
            }
        }), lt = { set: function(e, t, n) { return t === !1 ? oe.removeAttr(e, n) : e.setAttribute(n, n), n } }, oe.each(oe.expr.match.bool.source.match(/\w+/g), function(e, t) {
            var n = ct[t] || oe.find.attr;
            ct[t] = function(e, t, i) { var r, o; return i || (o = ct[t], ct[t] = r, r = null != n(e, t, i) ? t.toLowerCase() : null, ct[t] = o), r }
        });
        var ut = /^(?:input|select|textarea|button)$/i,
            pt = /^(?:a|area)$/i;
        oe.fn.extend({ prop: function(e, t) { return Se(this, oe.prop, e, t, arguments.length > 1) }, removeProp: function(e) { return this.each(function() { delete this[oe.propFix[e] || e] }) } }), oe.extend({ prop: function(e, t, n) { var i, r, o = e.nodeType; if (3 !== o && 8 !== o && 2 !== o) return 1 === o && oe.isXMLDoc(e) || (t = oe.propFix[t] || t, r = oe.propHooks[t]), void 0 !== n ? r && "set" in r && void 0 !== (i = r.set(e, n, t)) ? i : e[t] = n : r && "get" in r && null !== (i = r.get(e, t)) ? i : e[t] }, propHooks: { tabIndex: { get: function(e) { var t = oe.find.attr(e, "tabindex"); return t ? parseInt(t, 10) : ut.test(e.nodeName) || pt.test(e.nodeName) && e.href ? 0 : -1 } } }, propFix: { for: "htmlFor", class: "className" } }), ie.optSelected || (oe.propHooks.selected = {
            get: function(e) { var t = e.parentNode; return t && t.parentNode && t.parentNode.selectedIndex, null },
            set: function(e) {
                var t = e.parentNode;
                t && (t.selectedIndex, t.parentNode && t.parentNode.selectedIndex)
            }
        }), oe.each(["tabIndex", "readOnly", "maxLength", "cellSpacing", "cellPadding", "rowSpan", "colSpan", "useMap", "frameBorder", "contentEditable"], function() { oe.propFix[this.toLowerCase()] = this });
        var dt = /[\t\r\n\f]/g;
        oe.fn.extend({
            addClass: function(e) {
                var t, n, i, r, o, s, a, l = 0;
                if (oe.isFunction(e)) return this.each(function(t) { oe(this).addClass(e.call(this, t, q(this))) });
                if ("string" == typeof e && e)
                    for (t = e.match(we) || []; n = this[l++];)
                        if (r = q(n), i = 1 === n.nodeType && (" " + r + " ").replace(dt, " ")) {
                            for (s = 0; o = t[s++];) i.indexOf(" " + o + " ") < 0 && (i += o + " ");
                            a = oe.trim(i), r !== a && n.setAttribute("class", a)
                        }
                return this
            },
            removeClass: function(e) {
                var t, n, i, r, o, s, a, l = 0;
                if (oe.isFunction(e)) return this.each(function(t) { oe(this).removeClass(e.call(this, t, q(this))) });
                if (!arguments.length) return this.attr("class", "");
                if ("string" == typeof e && e)
                    for (t = e.match(we) || []; n = this[l++];)
                        if (r = q(n), i = 1 === n.nodeType && (" " + r + " ").replace(dt, " ")) {
                            for (s = 0; o = t[s++];)
                                for (; i.indexOf(" " + o + " ") > -1;) i = i.replace(" " + o + " ", " ");
                            a = oe.trim(i), r !== a && n.setAttribute("class", a)
                        }
                return this
            },
            toggleClass: function(e, t) {
                var n = typeof e;
                return "boolean" == typeof t && "string" === n ? t ? this.addClass(e) : this.removeClass(e) : oe.isFunction(e) ? this.each(function(n) { oe(this).toggleClass(e.call(this, n, q(this), t), t) }) : this.each(function() {
                    var t, i, r, o;
                    if ("string" === n)
                        for (i = 0, r = oe(this), o = e.match(we) || []; t = o[i++];) r.hasClass(t) ? r.removeClass(t) : r.addClass(t);
                    else void 0 !== e && "boolean" !== n || (t = q(this), t && Ce.set(this, "__className__", t), this.setAttribute && this.setAttribute("class", t || e === !1 ? "" : Ce.get(this, "__className__") || ""))
                })
            },
            hasClass: function(e) {
                var t, n, i = 0;
                for (t = " " + e + " "; n = this[i++];)
                    if (1 === n.nodeType && (" " + q(n) + " ").replace(dt, " ").indexOf(t) > -1) return !0;
                return !1
            }
        });
        var ht = /\r/g,
            ft = /[\x20\t\r\n\f]+/g;
        oe.fn.extend({
            val: function(e) {
                var t, n, i, r = this[0];
                return arguments.length ? (i = oe.isFunction(e), this.each(function(n) {
                    var r;
                    1 === this.nodeType && (r = i ? e.call(this, n, oe(this).val()) : e, null == r ? r = "" : "number" == typeof r ? r += "" : oe.isArray(r) && (r = oe.map(r, function(e) { return null == e ? "" : e + "" })), t = oe.valHooks[this.type] || oe.valHooks[this.nodeName.toLowerCase()], t && "set" in t && void 0 !== t.set(this, r, "value") || (this.value = r))
                })) : r ? (t = oe.valHooks[r.type] || oe.valHooks[r.nodeName.toLowerCase()], t && "get" in t && void 0 !== (n = t.get(r, "value")) ? n : (n = r.value, "string" == typeof n ? n.replace(ht, "") : null == n ? "" : n)) : void 0
            }
        }), oe.extend({
            valHooks: {
                option: { get: function(e) { var t = oe.find.attr(e, "value"); return null != t ? t : oe.trim(oe.text(e)).replace(ft, " ") } },
                select: {
                    get: function(e) {
                        for (var t, n, i = e.options, r = e.selectedIndex, o = "select-one" === e.type || 0 > r, s = o ? null : [], a = o ? r + 1 : i.length, l = 0 > r ? a : o ? r : 0; a > l; l++)
                            if (n = i[l], (n.selected || l === r) && (ie.optDisabled ? !n.disabled : null === n.getAttribute("disabled")) && (!n.parentNode.disabled || !oe.nodeName(n.parentNode, "optgroup"))) {
                                if (t = oe(n).val(), o) return t;
                                s.push(t)
                            }
                        return s
                    },
                    set: function(e, t) { for (var n, i, r = e.options, o = oe.makeArray(t), s = r.length; s--;) i = r[s], (i.selected = oe.inArray(oe.valHooks.option.get(i), o) > -1) && (n = !0); return n || (e.selectedIndex = -1), o }
                }
            }
        }), oe.each(["radio", "checkbox"], function() { oe.valHooks[this] = { set: function(e, t) { return oe.isArray(t) ? e.checked = oe.inArray(oe(e).val(), t) > -1 : void 0 } }, ie.checkOn || (oe.valHooks[this].get = function(e) { return null === e.getAttribute("value") ? "on" : e.value }) });
        var vt = /^(?:focusinfocus|focusoutblur)$/;
        oe.extend(oe.event, {
            trigger: function(t, n, i, r) {
                var o, s, a, l, c, u, p, d = [i || Y],
                    h = ne.call(t, "type") ? t.type : t,
                    f = ne.call(t, "namespace") ? t.namespace.split(".") : [];
                if (s = a = i = i || Y, 3 !== i.nodeType && 8 !== i.nodeType && !vt.test(h + oe.event.triggered) && (h.indexOf(".") > -1 && (f = h.split("."), h = f.shift(), f.sort()), c = h.indexOf(":") < 0 && "on" + h, t = t[oe.expando] ? t : new oe.Event(h, "object" == typeof t && t), t.isTrigger = r ? 2 : 3, t.namespace = f.join("."), t.rnamespace = t.namespace ? new RegExp("(^|\\.)" + f.join("\\.(?:.*\\.|)") + "(\\.|$)") : null, t.result = void 0, t.target || (t.target = i), n = null == n ? [t] : oe.makeArray(n, [t]), p = oe.event.special[h] || {}, r || !p.trigger || p.trigger.apply(i, n) !== !1)) {
                    if (!r && !p.noBubble && !oe.isWindow(i)) {
                        for (l = p.delegateType || h, vt.test(l + h) || (s = s.parentNode); s; s = s.parentNode) d.push(s), a = s;
                        a === (i.ownerDocument || Y) && d.push(a.defaultView || a.parentWindow || e)
                    }
                    for (o = 0;
                        (s = d[o++]) && !t.isPropagationStopped();) t.type = o > 1 ? l : p.bindType || h, u = (Ce.get(s, "events") || {})[t.type] && Ce.get(s, "handle"), u && u.apply(s, n), u = c && s[c], u && u.apply && Te(s) && (t.result = u.apply(s, n), t.result === !1 && t.preventDefault());
                    return t.type = h, r || t.isDefaultPrevented() || p._default && p._default.apply(d.pop(), n) !== !1 || !Te(i) || c && oe.isFunction(i[h]) && !oe.isWindow(i) && (a = i[c], a && (i[c] = null), oe.event.triggered = h, i[h](), oe.event.triggered = void 0, a && (i[c] = a)), t.result
                }
            },
            simulate: function(e, t, n) {
                var i = oe.extend(new oe.Event, n, { type: e, isSimulated: !0 });
                oe.event.trigger(i, null, t), i.isDefaultPrevented() && n.preventDefault()
            }
        }), oe.fn.extend({ trigger: function(e, t) { return this.each(function() { oe.event.trigger(e, t, this) }) }, triggerHandler: function(e, t) { var n = this[0]; return n ? oe.event.trigger(e, t, n, !0) : void 0 } }), oe.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "), function(e, t) { oe.fn[t] = function(e, n) { return arguments.length > 0 ? this.on(t, null, e, n) : this.trigger(t) } }), oe.fn.extend({ hover: function(e, t) { return this.mouseenter(e).mouseleave(t || e) } }), ie.focusin = "onfocusin" in e, ie.focusin || oe.each({ focus: "focusin", blur: "focusout" }, function(e, t) {
            var n = function(e) { oe.event.simulate(t, e.target, oe.event.fix(e)) };
            oe.event.special[t] = {
                setup: function() {
                    var i = this.ownerDocument || this,
                        r = Ce.access(i, t);
                    r || i.addEventListener(e, n, !0), Ce.access(i, t, (r || 0) + 1)
                },
                teardown: function() {
                    var i = this.ownerDocument || this,
                        r = Ce.access(i, t) - 1;
                    r ? Ce.access(i, t, r) : (i.removeEventListener(e, n, !0), Ce.remove(i, t))
                }
            }
        });
        var gt = e.location,
            mt = oe.now(),
            yt = /\?/;
        oe.parseJSON = function(e) { return JSON.parse(e + "") }, oe.parseXML = function(t) { var n; if (!t || "string" != typeof t) return null; try { n = (new e.DOMParser).parseFromString(t, "text/xml") } catch (e) { n = void 0 } return n && !n.getElementsByTagName("parsererror").length || oe.error("Invalid XML: " + t), n };
        var bt = /#.*$/,
            kt = /([?&])_=[^&]*/,
            wt = /^(.*?):[ \t]*([^\r\n]*)$/gm,
            xt = /^(?:about|app|app-storage|.+-extension|file|res|widget):$/,
            St = /^(?:GET|HEAD)$/,
            Tt = /^\/\//,
            Ct = {},
            Et = {},
            Pt = "*/".concat("*"),
            $t = Y.createElement("a");
        $t.href = gt.href, oe.extend({
            active: 0,
            lastModified: {},
            etag: {},
            ajaxSettings: { url: gt.href, type: "GET", isLocal: xt.test(gt.protocol), global: !0, processData: !0, async: !0, contentType: "application/x-www-form-urlencoded; charset=UTF-8", accepts: { "*": Pt, text: "text/plain", html: "text/html", xml: "application/xml, text/xml", json: "application/json, text/javascript" }, contents: { xml: /\bxml\b/, html: /\bhtml/, json: /\bjson\b/ }, responseFields: { xml: "responseXML", text: "responseText", json: "responseJSON" }, converters: { "* text": String, "text html": !0, "text json": oe.parseJSON, "text xml": oe.parseXML }, flatOptions: { url: !0, context: !0 } },
            ajaxSetup: function(e, t) { return t ? z(z(e, oe.ajaxSettings), t) : z(oe.ajaxSettings, e) },
            ajaxPrefilter: B(Ct),
            ajaxTransport: B(Et),
            ajax: function(t, n) {
                function i(t, n, i, a) {
                    var c, p, y, b, w, S = n;
                    2 !== k && (k = 2, l && e.clearTimeout(l), r = void 0, s = a || "", x.readyState = t > 0 ? 4 : 0, c = t >= 200 && 300 > t || 304 === t, i && (b = W(d, x, i)), b = U(d, b, x, c), c ? (d.ifModified && (w = x.getResponseHeader("Last-Modified"), w && (oe.lastModified[o] = w), w = x.getResponseHeader("etag"), w && (oe.etag[o] = w)), 204 === t || "HEAD" === d.type ? S = "nocontent" : 304 === t ? S = "notmodified" : (S = b.state, p = b.data, y = b.error, c = !y)) : (y = S, !t && S || (S = "error", 0 > t && (t = 0))), x.status = t, x.statusText = (n || S) + "", c ? v.resolveWith(h, [p, S, x]) : v.rejectWith(h, [x, S, y]), x.statusCode(m), m = void 0, u && f.trigger(c ? "ajaxSuccess" : "ajaxError", [x, d, c ? p : y]), g.fireWith(h, [x, S]), u && (f.trigger("ajaxComplete", [x, d]), --oe.active || oe.event.trigger("ajaxStop")))
                }
                "object" == typeof t && (n = t, t = void 0), n = n || {};
                var r, o, s, a, l, c, u, p, d = oe.ajaxSetup({}, n),
                    h = d.context || d,
                    f = d.context && (h.nodeType || h.jquery) ? oe(h) : oe.event,
                    v = oe.Deferred(),
                    g = oe.Callbacks("once memory"),
                    m = d.statusCode || {},
                    y = {},
                    b = {},
                    k = 0,
                    w = "canceled",
                    x = {
                        readyState: 0,
                        getResponseHeader: function(e) {
                            var t;
                            if (2 === k) {
                                if (!a)
                                    for (a = {}; t = wt.exec(s);) a[t[1].toLowerCase()] = t[2];
                                t = a[e.toLowerCase()]
                            }
                            return null == t ? null : t
                        },
                        getAllResponseHeaders: function() { return 2 === k ? s : null },
                        setRequestHeader: function(e, t) { var n = e.toLowerCase(); return k || (e = b[n] = b[n] || e, y[e] = t), this },
                        overrideMimeType: function(e) { return k || (d.mimeType = e), this },
                        statusCode: function(e) {
                            var t;
                            if (e)
                                if (2 > k)
                                    for (t in e) m[t] = [m[t], e[t]];
                                else x.always(e[x.status]);
                            return this
                        },
                        abort: function(e) { var t = e || w; return r && r.abort(t), i(0, t), this }
                    };
                if (v.promise(x).complete = g.add, x.success = x.done, x.error = x.fail, d.url = ((t || d.url || gt.href) + "").replace(bt, "").replace(Tt, gt.protocol + "//"), d.type = n.method || n.type || d.method || d.type, d.dataTypes = oe.trim(d.dataType || "*").toLowerCase().match(we) || [""], null == d.crossDomain) { c = Y.createElement("a"); try { c.href = d.url, c.href = c.href, d.crossDomain = $t.protocol + "//" + $t.host != c.protocol + "//" + c.host } catch (e) { d.crossDomain = !0 } }
                if (d.data && d.processData && "string" != typeof d.data && (d.data = oe.param(d.data, d.traditional)), F(Ct, d, n, x), 2 === k) return x;
                u = oe.event && d.global, u && 0 === oe.active++ && oe.event.trigger("ajaxStart"), d.type = d.type.toUpperCase(), d.hasContent = !St.test(d.type), o = d.url, d.hasContent || (d.data && (o = d.url += (yt.test(o) ? "&" : "?") + d.data, delete d.data), d.cache === !1 && (d.url = kt.test(o) ? o.replace(kt, "$1_=" + mt++) : o + (yt.test(o) ? "&" : "?") + "_=" + mt++)), d.ifModified && (oe.lastModified[o] && x.setRequestHeader("If-Modified-Since", oe.lastModified[o]), oe.etag[o] && x.setRequestHeader("If-None-Match", oe.etag[o])), (d.data && d.hasContent && d.contentType !== !1 || n.contentType) && x.setRequestHeader("Content-Type", d.contentType), x.setRequestHeader("Accept", d.dataTypes[0] && d.accepts[d.dataTypes[0]] ? d.accepts[d.dataTypes[0]] + ("*" !== d.dataTypes[0] ? ", " + Pt + "; q=0.01" : "") : d.accepts["*"]);
                for (p in d.headers) x.setRequestHeader(p, d.headers[p]);
                if (d.beforeSend && (d.beforeSend.call(h, x, d) === !1 || 2 === k)) return x.abort();
                w = "abort";
                for (p in { success: 1, error: 1, complete: 1 }) x[p](d[p]);
                if (r = F(Et, d, n, x)) {
                    if (x.readyState = 1, u && f.trigger("ajaxSend", [x, d]), 2 === k) return x;
                    d.async && d.timeout > 0 && (l = e.setTimeout(function() { x.abort("timeout") }, d.timeout));
                    try { k = 1, r.send(y, i) } catch (e) {
                        if (!(2 > k)) throw e;
                        i(-1, e)
                    }
                } else i(-1, "No Transport");
                return x
            },
            getJSON: function(e, t, n) { return oe.get(e, t, n, "json") },
            getScript: function(e, t) { return oe.get(e, void 0, t, "script") }
        }), oe.each(["get", "post"], function(e, t) { oe[t] = function(e, n, i, r) { return oe.isFunction(n) && (r = r || i, i = n, n = void 0), oe.ajax(oe.extend({ url: e, type: t, dataType: r, data: n, success: i }, oe.isPlainObject(e) && e)) } }), oe._evalUrl = function(e) { return oe.ajax({ url: e, type: "GET", dataType: "script", async: !1, global: !1, throws: !0 }) }, oe.fn.extend({
            wrapAll: function(e) { var t; return oe.isFunction(e) ? this.each(function(t) { oe(this).wrapAll(e.call(this, t)) }) : (this[0] && (t = oe(e, this[0].ownerDocument).eq(0).clone(!0), this[0].parentNode && t.insertBefore(this[0]), t.map(function() { for (var e = this; e.firstElementChild;) e = e.firstElementChild; return e }).append(this)), this) },
            wrapInner: function(e) {
                return oe.isFunction(e) ? this.each(function(t) { oe(this).wrapInner(e.call(this, t)) }) : this.each(function() {
                    var t = oe(this),
                        n = t.contents();
                    n.length ? n.wrapAll(e) : t.append(e)
                })
            },
            wrap: function(e) { var t = oe.isFunction(e); return this.each(function(n) { oe(this).wrapAll(t ? e.call(this, n) : e) }) },
            unwrap: function() { return this.parent().each(function() { oe.nodeName(this, "body") || oe(this).replaceWith(this.childNodes) }).end() }
        }), oe.expr.filters.hidden = function(e) { return !oe.expr.filters.visible(e) }, oe.expr.filters.visible = function(e) { return e.offsetWidth > 0 || e.offsetHeight > 0 || e.getClientRects().length > 0 };
        var _t = /%20/g,
            At = /\[\]$/,
            Nt = /\r?\n/g,
            Lt = /^(?:submit|button|image|reset|file)$/i,
            Ot = /^(?:input|select|textarea|keygen)/i;
        oe.param = function(e, t) {
            var n, i = [],
                r = function(e, t) { t = oe.isFunction(t) ? t() : null == t ? "" : t, i[i.length] = encodeURIComponent(e) + "=" + encodeURIComponent(t) };
            if (void 0 === t && (t = oe.ajaxSettings && oe.ajaxSettings.traditional), oe.isArray(e) || e.jquery && !oe.isPlainObject(e)) oe.each(e, function() { r(this.name, this.value) });
            else
                for (n in e) V(n, e[n], t, r);
            return i.join("&").replace(_t, "+")
        }, oe.fn.extend({ serialize: function() { return oe.param(this.serializeArray()) }, serializeArray: function() { return this.map(function() { var e = oe.prop(this, "elements"); return e ? oe.makeArray(e) : this }).filter(function() { var e = this.type; return this.name && !oe(this).is(":disabled") && Ot.test(this.nodeName) && !Lt.test(e) && (this.checked || !Oe.test(e)) }).map(function(e, t) { var n = oe(this).val(); return null == n ? null : oe.isArray(n) ? oe.map(n, function(e) { return { name: t.name, value: e.replace(Nt, "\r\n") } }) : { name: t.name, value: n.replace(Nt, "\r\n") } }).get() } }), oe.ajaxSettings.xhr = function() { try { return new e.XMLHttpRequest } catch (e) {} };
        var Dt = { 0: 200, 1223: 204 },
            jt = oe.ajaxSettings.xhr();
        ie.cors = !!jt && "withCredentials" in jt, ie.ajax = jt = !!jt, oe.ajaxTransport(function(t) {
            var n, i;
            return ie.cors || jt && !t.crossDomain ? {
                send: function(r, o) {
                    var s, a = t.xhr();
                    if (a.open(t.type, t.url, t.async, t.username, t.password), t.xhrFields)
                        for (s in t.xhrFields) a[s] = t.xhrFields[s];
                    t.mimeType && a.overrideMimeType && a.overrideMimeType(t.mimeType), t.crossDomain || r["X-Requested-With"] || (r["X-Requested-With"] = "XMLHttpRequest");
                    for (s in r) a.setRequestHeader(s, r[s]);
                    n = function(e) { return function() { n && (n = i = a.onload = a.onerror = a.onabort = a.onreadystatechange = null, "abort" === e ? a.abort() : "error" === e ? "number" != typeof a.status ? o(0, "error") : o(a.status, a.statusText) : o(Dt[a.status] || a.status, a.statusText, "text" !== (a.responseType || "text") || "string" != typeof a.responseText ? { binary: a.response } : { text: a.responseText }, a.getAllResponseHeaders())) } }, a.onload = n(), i = a.onerror = n("error"), void 0 !== a.onabort ? a.onabort = i : a.onreadystatechange = function() { 4 === a.readyState && e.setTimeout(function() { n && i() }) }, n = n("abort");
                    try { a.send(t.hasContent && t.data || null) } catch (e) { if (n) throw e }
                },
                abort: function() { n && n() }
            } : void 0
        }), oe.ajaxSetup({ accepts: { script: "text/javascript, application/javascript, application/ecmascript, application/x-ecmascript" }, contents: { script: /\b(?:java|ecma)script\b/ }, converters: { "text script": function(e) { return oe.globalEval(e), e } } }), oe.ajaxPrefilter("script", function(e) { void 0 === e.cache && (e.cache = !1), e.crossDomain && (e.type = "GET") }), oe.ajaxTransport("script", function(e) { if (e.crossDomain) { var t, n; return { send: function(i, r) { t = oe("<script>").prop({ charset: e.scriptCharset, src: e.url }).on("load error", n = function(e) { t.remove(), n = null, e && r("error" === e.type ? 404 : 200, e.type) }), Y.head.appendChild(t[0]) }, abort: function() { n && n() } } } });
        var Ht = [],
            It = /(=)\?(?=&|$)|\?\?/;
        oe.ajaxSetup({ jsonp: "callback", jsonpCallback: function() { var e = Ht.pop() || oe.expando + "_" + mt++; return this[e] = !0, e } }), oe.ajaxPrefilter("json jsonp", function(t, n, i) { var r, o, s, a = t.jsonp !== !1 && (It.test(t.url) ? "url" : "string" == typeof t.data && 0 === (t.contentType || "").indexOf("application/x-www-form-urlencoded") && It.test(t.data) && "data"); return a || "jsonp" === t.dataTypes[0] ? (r = t.jsonpCallback = oe.isFunction(t.jsonpCallback) ? t.jsonpCallback() : t.jsonpCallback, a ? t[a] = t[a].replace(It, "$1" + r) : t.jsonp !== !1 && (t.url += (yt.test(t.url) ? "&" : "?") + t.jsonp + "=" + r), t.converters["script json"] = function() { return s || oe.error(r + " was not called"), s[0] }, t.dataTypes[0] = "json", o = e[r], e[r] = function() { s = arguments }, i.always(function() { void 0 === o ? oe(e).removeProp(r) : e[r] = o, t[r] && (t.jsonpCallback = n.jsonpCallback, Ht.push(r)), s && oe.isFunction(o) && o(s[0]), s = o = void 0 }), "script") : void 0 }), oe.parseHTML = function(e, t, n) {
            if (!e || "string" != typeof e) return null;
            "boolean" == typeof t && (n = t, t = !1), t = t || Y;
            var i = fe.exec(e),
                r = !n && [];
            return i ? [t.createElement(i[1])] : (i = d([e], t, r), r && r.length && oe(r).remove(), oe.merge([], i.childNodes))
        };
        var Mt = oe.fn.load;
        oe.fn.load = function(e, t, n) {
            if ("string" != typeof e && Mt) return Mt.apply(this, arguments);
            var i, r, o, s = this,
                a = e.indexOf(" ");
            return a > -1 && (i = oe.trim(e.slice(a)), e = e.slice(0, a)), oe.isFunction(t) ? (n = t, t = void 0) : t && "object" == typeof t && (r = "POST"), s.length > 0 && oe.ajax({ url: e, type: r || "GET", dataType: "html", data: t }).done(function(e) { o = arguments, s.html(i ? oe("<div>").append(oe.parseHTML(e)).find(i) : e) }).always(n && function(e, t) { s.each(function() { n.apply(this, o || [e.responseText, t, e]) }) }), this
        }, oe.each(["ajaxStart", "ajaxStop", "ajaxComplete", "ajaxError", "ajaxSuccess", "ajaxSend"], function(e, t) { oe.fn[t] = function(e) { return this.on(t, e) } }), oe.expr.filters.animated = function(e) { return oe.grep(oe.timers, function(t) { return e === t.elem }).length }, oe.offset = {
            setOffset: function(e, t, n) {
                var i, r, o, s, a, l, c, u = oe.css(e, "position"),
                    p = oe(e),
                    d = {};
                "static" === u && (e.style.position = "relative"), a = p.offset(), o = oe.css(e, "top"), l = oe.css(e, "left"), c = ("absolute" === u || "fixed" === u) && (o + l).indexOf("auto") > -1, c ? (i = p.position(), s = i.top, r = i.left) : (s = parseFloat(o) || 0, r = parseFloat(l) || 0), oe.isFunction(t) && (t = t.call(e, n, oe.extend({}, a))), null != t.top && (d.top = t.top - a.top + s), null != t.left && (d.left = t.left - a.left + r), "using" in t ? t.using.call(e, d) : p.css(d)
            }
        }, oe.fn.extend({
            offset: function(e) {
                if (arguments.length) return void 0 === e ? this : this.each(function(t) { oe.offset.setOffset(this, e, t) });
                var t, n, i = this[0],
                    r = { top: 0, left: 0 },
                    o = i && i.ownerDocument;
                return o ? (t = o.documentElement, oe.contains(t, i) ? (r = i.getBoundingClientRect(), n = X(o), { top: r.top + n.pageYOffset - t.clientTop, left: r.left + n.pageXOffset - t.clientLeft }) : r) : void 0
            },
            position: function() {
                if (this[0]) {
                    var e, t, n = this[0],
                        i = { top: 0, left: 0 };
                    return "fixed" === oe.css(n, "position") ? t = n.getBoundingClientRect() : (e = this.offsetParent(), t = this.offset(), oe.nodeName(e[0], "html") || (i = e.offset()), i.top += oe.css(e[0], "borderTopWidth", !0), i.left += oe.css(e[0], "borderLeftWidth", !0)), { top: t.top - i.top - oe.css(n, "marginTop", !0), left: t.left - i.left - oe.css(n, "marginLeft", !0) }
                }
            },
            offsetParent: function() { return this.map(function() { for (var e = this.offsetParent; e && "static" === oe.css(e, "position");) e = e.offsetParent; return e || Qe }) }
        }), oe.each({ scrollLeft: "pageXOffset", scrollTop: "pageYOffset" }, function(e, t) {
            var n = "pageYOffset" === t;
            oe.fn[e] = function(i) { return Se(this, function(e, i, r) { var o = X(e); return void 0 === r ? o ? o[t] : e[i] : void(o ? o.scrollTo(n ? o.pageXOffset : r, n ? r : o.pageYOffset) : e[i] = r) }, e, i, arguments.length) }
        }), oe.each(["top", "left"], function(e, t) { oe.cssHooks[t] = P(ie.pixelPosition, function(e, n) { return n ? (n = E(e, t), Ye.test(n) ? oe(e).position()[t] + "px" : n) : void 0 }) }), oe.each({ Height: "height", Width: "width" }, function(e, t) {
            oe.each({ padding: "inner" + e, content: t, "": "outer" + e }, function(n, i) {
                oe.fn[i] = function(i, r) {
                    var o = arguments.length && (n || "boolean" != typeof i),
                        s = n || (i === !0 || r === !0 ? "margin" : "border");
                    return Se(this, function(t, n, i) { var r; return oe.isWindow(t) ? t.document.documentElement["client" + e] : 9 === t.nodeType ? (r = t.documentElement, Math.max(t.body["scroll" + e], r["scroll" + e], t.body["offset" + e], r["offset" + e], r["client" + e])) : void 0 === i ? oe.css(t, n, s) : oe.style(t, n, i, s) }, t, o ? i : void 0, o, null)
                }
            })
        }), oe.fn.extend({ bind: function(e, t, n) { return this.on(e, null, t, n) }, unbind: function(e, t) { return this.off(e, null, t) }, delegate: function(e, t, n, i) { return this.on(t, e, n, i) }, undelegate: function(e, t, n) { return 1 === arguments.length ? this.off(e, "**") : this.off(t, e || "**", n) }, size: function() { return this.length } }), oe.fn.andSelf = oe.fn.addBack, "function" == typeof define && define.amd && define("jquery", [], function() { return oe });
        var Rt = e.jQuery,
            qt = e.$;
        return oe.noConflict = function(t) { return e.$ === oe && (e.$ = qt), t && e.jQuery === oe && (e.jQuery = Rt), oe }, t || (e.jQuery = e.$ = oe), oe
    }),
    /*!
     * modernizr.min.js
     */
    /*! modernizr 3.3.1 (Custom Build) | MIT *
     * https://modernizr.com/download/?-csstransforms-csstransforms3d-csstransitions-svg-domprefixes-prefixes-setclasses-testallprops-testprop-teststyles !*/
    ! function(e, t, n) {
        function i(e, t) { return typeof e === t }

        function r() {
            var e, t, n, r, o, s, a;
            for (var l in b)
                if (b.hasOwnProperty(l)) {
                    if (e = [], t = b[l], t.name && (e.push(t.name.toLowerCase()), t.options && t.options.aliases && t.options.aliases.length))
                        for (n = 0; n < t.options.aliases.length; n++) e.push(t.options.aliases[n].toLowerCase());
                    for (r = i(t.fn, "function") ? t.fn() : t.fn, o = 0; o < e.length; o++) s = e[o], a = s.split("."), 1 === a.length ? w[a[0]] = r : (!w[a[0]] || w[a[0]] instanceof Boolean || (w[a[0]] = new Boolean(w[a[0]])), w[a[0]][a[1]] = r), y.push((r ? "" : "no-") + a.join("-"))
                }
        }

        function o(e) {
            var t = S.className,
                n = w._config.classPrefix || "";
            if (T && (t = t.baseVal), w._config.enableJSClass) {
                var i = new RegExp("(^|\\s)" + n + "no-js(\\s|$)");
                t = t.replace(i, "$1" + n + "js$2")
            }
            w._config.enableClasses && (t += " " + n + e.join(" " + n), T ? S.className.baseVal = t : S.className = t)
        }

        function s(e, t) { return !!~("" + e).indexOf(t) }

        function a() { return "function" != typeof t.createElement ? t.createElement(arguments[0]) : T ? t.createElementNS.call(t, "http://www.w3.org/2000/svg", arguments[0]) : t.createElement.apply(t, arguments) }

        function l(e) { return e.replace(/([a-z])-([a-z])/g, function(e, t, n) { return t + n.toUpperCase() }).replace(/^-/, "") }

        function c() { var e = t.body; return e || (e = a(T ? "svg" : "body"), e.fake = !0), e }

        function u(e, n, i, r) {
            var o, s, l, u, p = "modernizr",
                d = a("div"),
                h = c();
            if (parseInt(i, 10))
                for (; i--;) l = a("div"), l.id = r ? r[i] : p + (i + 1), d.appendChild(l);
            return o = a("style"), o.type = "text/css", o.id = "s" + p, (h.fake ? h : d).appendChild(o), h.appendChild(d), o.styleSheet ? o.styleSheet.cssText = e : o.appendChild(t.createTextNode(e)), d.id = p, h.fake && (h.style.background = "", h.style.overflow = "hidden", u = S.style.overflow, S.style.overflow = "hidden", S.appendChild(h)), s = n(d, e), h.fake ? (h.parentNode.removeChild(h), S.style.overflow = u, S.offsetHeight) : d.parentNode.removeChild(d), !!s
        }

        function p(e) { return e.replace(/([A-Z])/g, function(e, t) { return "-" + t.toLowerCase() }).replace(/^ms-/, "-ms-") }

        function d(t, i) {
            var r = t.length;
            if ("CSS" in e && "supports" in e.CSS) {
                for (; r--;)
                    if (e.CSS.supports(p(t[r]), i)) return !0;
                return !1
            }
            if ("CSSSupportsRule" in e) { for (var o = []; r--;) o.push("(" + p(t[r]) + ":" + i + ")"); return o = o.join(" or "), u("@supports (" + o + ") { #modernizr { position: absolute; } }", function(e) { return "absolute" == getComputedStyle(e, null).position }) }
            return n
        }

        function h(e, t, r, o) {
            function c() { p && (delete L.style, delete L.modElem) }
            if (o = !i(o, "undefined") && o, !i(r, "undefined")) { var u = d(e, r); if (!i(u, "undefined")) return u }
            for (var p, h, f, v, g, m = ["modernizr", "tspan", "samp"]; !L.style && m.length;) p = !0, L.modElem = a(m.shift()), L.style = L.modElem.style;
            for (f = e.length, h = 0; f > h; h++)
                if (v = e[h], g = L.style[v], s(v, "-") && (v = l(v)), L.style[v] !== n) { if (o || i(r, "undefined")) return c(), "pfx" != t || v; try { L.style[v] = r } catch (e) {} if (L.style[v] != g) return c(), "pfx" != t || v }
            return c(), !1
        }

        function f(e, t) { return function() { return e.apply(t, arguments) } }

        function v(e, t, n) {
            var r;
            for (var o in e)
                if (e[o] in t) return n === !1 ? e[o] : (r = t[e[o]], i(r, "function") ? f(r, n || t) : r);
            return !1
        }

        function g(e, t, n, r, o) {
            var s = e.charAt(0).toUpperCase() + e.slice(1),
                a = (e + " " + _.join(s + " ") + s).split(" ");
            return i(t, "string") || i(t, "undefined") ? h(a, t, r, o) : (a = (e + " " + E.join(s + " ") + s).split(" "), v(a, t, n))
        }

        function m(e, t, i) { return g(e, n, n, t, i) }
        var y = [],
            b = [],
            k = {
                _version: "3.3.1",
                _config: { classPrefix: "", enableClasses: !0, enableJSClass: !0, usePrefixes: !0 },
                _q: [],
                on: function(e, t) {
                    var n = this;
                    setTimeout(function() { t(n[e]) }, 0)
                },
                addTest: function(e, t, n) { b.push({ name: e, fn: t, options: n }) },
                addAsyncTest: function(e) { b.push({ name: null, fn: e }) }
            },
            w = function() {};
        w.prototype = k, w = new w, w.addTest("svg", !!t.createElementNS && !!t.createElementNS("http://www.w3.org/2000/svg", "svg").createSVGRect);
        var x = k._config.usePrefixes ? " -webkit- -moz- -o- -ms- ".split(" ") : ["", ""];
        k._prefixes = x;
        var S = t.documentElement,
            T = "svg" === S.nodeName.toLowerCase(),
            C = "Moz O ms Webkit",
            E = k._config.usePrefixes ? C.toLowerCase().split(" ") : [];
        k._domPrefixes = E;
        var P = "CSS" in e && "supports" in e.CSS,
            $ = "supportsCSS" in e;
        w.addTest("supports", P || $);
        var _ = k._config.usePrefixes ? C.split(" ") : [];
        k._cssomPrefixes = _;
        var A = k.testStyles = u,
            N = { elem: a("modernizr") };
        w._q.push(function() { delete N.elem });
        var L = { style: N.elem.style };
        w._q.unshift(function() { delete L.style }), k.testProp = function(e, t, i) { return h([e], n, t, i) }, k.testAllProps = g, k.testAllProps = m, w.addTest("csstransforms", function() { return -1 === navigator.userAgent.indexOf("Android 2.") && m("transform", "scale(1)", !0) }), w.addTest("csstransforms3d", function() {
            var e = !!m("perspective", "1px", !0),
                t = w._config.usePrefixes;
            if (e && (!t || "webkitPerspective" in S.style)) {
                var n, i = "#modernizr{width:0;height:0}";
                w.supports ? n = "@supports (perspective: 1px)" : (n = "@media (transform-3d)", t && (n += ",(-webkit-transform-3d)")), n += "{#modernizr{width:7px;height:18px;margin:0;padding:0;border:0}}", A(i + n, function(t) { e = 7 === t.offsetWidth && 18 === t.offsetHeight })
            }
            return e
        }), w.addTest("csstransitions", m("transition", "all", !0)), r(), o(y), delete k.addTest, delete k.addAsyncTest;
        for (var O = 0; O < w._q.length; O++) w._q[O]();
        e.Modernizr = w
    }(window, document),
    /*!
     * prepare-transition.min.js
     */
    /* Jonathan Snook - MIT License - https://github.com/snookca/prepareTransition */
    function(e) {
        e.fn.prepareTransition = function() {
            return this.each(function() {
                var t = e(this);
                t.one("TransitionEnd webkitTransitionEnd transitionend oTransitionEnd", function() { t.removeClass("is-transitioning") });
                var n = ["transition-duration", "-moz-transition-duration", "-webkit-transition-duration", "-o-transition-duration"],
                    i = 0;
                e.each(n, function(e, n) { i = parseFloat(t.css(n)) || i }), 0 != i && (t.addClass("is-transitioning"), t[0].offsetWidth)
            })
        }
    }(jQuery),
    /*!
     * slick.min.js
     */
    ! function(e) { "use strict"; "function" == typeof define && define.amd ? define(["jquery"], e) : "undefined" != typeof exports ? module.exports = e(require("jquery")) : e(jQuery) }(function(e) {
        "use strict";
        var t = window.Slick || {};
        t = function() {
            function t(t, i) {
                var r, o = this;
                o.defaults = { accessibility: !0, adaptiveHeight: !1, appendArrows: e(t), appendDots: e(t), arrows: !0, asNavFor: null, prevArrow: '<button type="button" data-role="none" class="slick-prev" aria-label="Previous" tabindex="0" role="button">Previous</button>', nextArrow: '<button type="button" data-role="none" class="slick-next" aria-label="Next" tabindex="0" role="button">Next</button>', autoplay: !1, autoplaySpeed: 3e3, centerMode: !1, centerPadding: "50px", cssEase: "ease", customPaging: function(t, n) { return e('<button type="button" data-role="none" role="button" tabindex="0" />').text(n + 1) }, dots: !1, dotsClass: "slick-dots", draggable: !0, easing: "linear", edgeFriction: .35, fade: !1, focusOnSelect: !1, infinite: !0, initialSlide: 0, lazyLoad: "ondemand", mobileFirst: !1, pauseOnHover: !0, pauseOnFocus: !0, pauseOnDotsHover: !1, respondTo: "window", responsive: null, rows: 1, rtl: !1, slide: "", slidesPerRow: 1, slidesToShow: 1, slidesToScroll: 1, speed: 500, swipe: !0, swipeToSlide: !1, touchMove: !0, touchThreshold: 5, useCSS: !0, useTransform: !0, variableWidth: !1, vertical: !1, verticalSwiping: !1, waitForAnimate: !0, zIndex: 1e3 }, o.initials = { animating: !1, dragging: !1, autoPlayTimer: null, currentDirection: 0, currentLeft: null, currentSlide: 0, direction: 1, $dots: null, listWidth: null, listHeight: null, loadIndex: 0, $nextArrow: null, $prevArrow: null, slideCount: null, slideWidth: null, $slideTrack: null, $slides: null, sliding: !1, slideOffset: 0, swipeLeft: null, $list: null, touchObject: {}, transformsEnabled: !1, unslicked: !1 }, e.extend(o, o.initials), o.activeBreakpoint = null, o.animType = null, o.animProp = null, o.breakpoints = [], o.breakpointSettings = [], o.cssTransitions = !1, o.focussed = !1, o.interrupted = !1, o.hidden = "hidden", o.paused = !0, o.positionProp = null, o.respondTo = null, o.rowCount = 1, o.shouldClick = !0, o.$slider = e(t), o.$slidesCache = null, o.transformType = null, o.transitionType = null, o.visibilityChange = "visibilitychange", o.windowWidth = 0, o.windowTimer = null, r = e(t).data("slick") || {}, o.options = e.extend({}, o.defaults, i, r), o.currentSlide = o.options.initialSlide, o.originalSettings = o.options, "undefined" != typeof document.mozHidden ? (o.hidden = "mozHidden", o.visibilityChange = "mozvisibilitychange") : "undefined" != typeof document.webkitHidden && (o.hidden = "webkitHidden", o.visibilityChange = "webkitvisibilitychange"), o.autoPlay = e.proxy(o.autoPlay, o), o.autoPlayClear = e.proxy(o.autoPlayClear, o), o.autoPlayIterator = e.proxy(o.autoPlayIterator, o), o.changeSlide = e.proxy(o.changeSlide, o), o.clickHandler = e.proxy(o.clickHandler, o), o.selectHandler = e.proxy(o.selectHandler, o), o.setPosition = e.proxy(o.setPosition, o), o.swipeHandler = e.proxy(o.swipeHandler, o), o.dragHandler = e.proxy(o.dragHandler, o), o.keyHandler = e.proxy(o.keyHandler, o), o.instanceUid = n++, o.htmlExpr = /^(?:\s*(<[\w\W]+>)[^>]*)$/, o.registerBreakpoints(), o.init(!0)
            }
            var n = 0;
            return t
        }(), t.prototype.activateADA = function() {
            var e = this;
            e.$slideTrack.find(".slick-active").attr({ "aria-hidden": "false" }).find("a, input, button, select").attr({ tabindex: "0" })
        }, t.prototype.addSlide = t.prototype.slickAdd = function(t, n, i) {
            var r = this;
            if ("boolean" == typeof n) i = n, n = null;
            else if (0 > n || n >= r.slideCount) return !1;
            r.unload(), "number" == typeof n ? 0 === n && 0 === r.$slides.length ? e(t).appendTo(r.$slideTrack) : i ? e(t).insertBefore(r.$slides.eq(n)) : e(t).insertAfter(r.$slides.eq(n)) : i === !0 ? e(t).prependTo(r.$slideTrack) : e(t).appendTo(r.$slideTrack), r.$slides = r.$slideTrack.children(this.options.slide), r.$slideTrack.children(this.options.slide).detach(), r.$slideTrack.append(r.$slides), r.$slides.each(function(t, n) { e(n).attr("data-slick-index", t) }), r.$slidesCache = r.$slides, r.reinit()
        }, t.prototype.animateHeight = function() {
            var e = this;
            if (1 === e.options.slidesToShow && e.options.adaptiveHeight === !0 && e.options.vertical === !1) {
                var t = e.$slides.eq(e.currentSlide).outerHeight(!0);
                e.$list.animate({ height: t }, e.options.speed)
            }
        }, t.prototype.animateSlide = function(t, n) {
            var i = {},
                r = this;
            r.animateHeight(), r.options.rtl === !0 && r.options.vertical === !1 && (t = -t), r.transformsEnabled === !1 ? r.options.vertical === !1 ? r.$slideTrack.animate({ left: t }, r.options.speed, r.options.easing, n) : r.$slideTrack.animate({ top: t }, r.options.speed, r.options.easing, n) : r.cssTransitions === !1 ? (r.options.rtl === !0 && (r.currentLeft = -r.currentLeft), e({ animStart: r.currentLeft }).animate({ animStart: t }, { duration: r.options.speed, easing: r.options.easing, step: function(e) { e = Math.ceil(e), r.options.vertical === !1 ? (i[r.animType] = "translate(" + e + "px, 0px)", r.$slideTrack.css(i)) : (i[r.animType] = "translate(0px," + e + "px)", r.$slideTrack.css(i)) }, complete: function() { n && n.call() } })) : (r.applyTransition(), t = Math.ceil(t), r.options.vertical === !1 ? i[r.animType] = "translate3d(" + t + "px, 0px, 0px)" : i[r.animType] = "translate3d(0px," + t + "px, 0px)", r.$slideTrack.css(i), n && setTimeout(function() { r.disableTransition(), n.call() }, r.options.speed))
        }, t.prototype.getNavTarget = function() {
            var t = this,
                n = t.options.asNavFor;
            return n && null !== n && (n = e(n).not(t.$slider)), n
        }, t.prototype.asNavFor = function(t) {
            var n = this,
                i = n.getNavTarget();
            null !== i && "object" == typeof i && i.each(function() {
                var n = e(this).slick("getSlick");
                n.unslicked || n.slideHandler(t, !0)
            })
        }, t.prototype.applyTransition = function(e) {
            var t = this,
                n = {};
            t.options.fade === !1 ? n[t.transitionType] = t.transformType + " " + t.options.speed + "ms " + t.options.cssEase : n[t.transitionType] = "opacity " + t.options.speed + "ms " + t.options.cssEase, t.options.fade === !1 ? t.$slideTrack.css(n) : t.$slides.eq(e).css(n)
        }, t.prototype.autoPlay = function() {
            var e = this;
            e.autoPlayClear(), e.slideCount > e.options.slidesToShow && (e.autoPlayTimer = setInterval(e.autoPlayIterator, e.options.autoplaySpeed))
        }, t.prototype.autoPlayClear = function() {
            var e = this;
            e.autoPlayTimer && clearInterval(e.autoPlayTimer)
        }, t.prototype.autoPlayIterator = function() {
            var e = this,
                t = e.currentSlide + e.options.slidesToScroll;
            e.paused || e.interrupted || e.focussed || (e.options.infinite === !1 && (1 === e.direction && e.currentSlide + 1 === e.slideCount - 1 ? e.direction = 0 : 0 === e.direction && (t = e.currentSlide - e.options.slidesToScroll, e.currentSlide - 1 === 0 && (e.direction = 1))), e.slideHandler(t))
        }, t.prototype.buildArrows = function() {
            var t = this;
            t.options.arrows === !0 && (t.$prevArrow = e(t.options.prevArrow).addClass("slick-arrow"), t.$nextArrow = e(t.options.nextArrow).addClass("slick-arrow"), t.slideCount > t.options.slidesToShow ? (t.$prevArrow.removeClass("slick-hidden").removeAttr("aria-hidden tabindex"), t.$nextArrow.removeClass("slick-hidden").removeAttr("aria-hidden tabindex"), t.htmlExpr.test(t.options.prevArrow) && t.$prevArrow.prependTo(t.options.appendArrows), t.htmlExpr.test(t.options.nextArrow) && t.$nextArrow.appendTo(t.options.appendArrows), t.options.infinite !== !0 && t.$prevArrow.addClass("slick-disabled").attr("aria-disabled", "true")) : t.$prevArrow.add(t.$nextArrow).addClass("slick-hidden").attr({ "aria-disabled": "true", tabindex: "-1" }))
        }, t.prototype.buildDots = function() {
            var t, n, i = this;
            if (i.options.dots === !0 && i.slideCount > i.options.slidesToShow) {
                for (i.$slider.addClass("slick-dotted"), n = e("<ul />").addClass(i.options.dotsClass), t = 0; t <= i.getDotCount(); t += 1) n.append(e("<li />").append(i.options.customPaging.call(this, i, t)));
                i.$dots = n.appendTo(i.options.appendDots), i.$dots.find("li").first().addClass("slick-active").attr("aria-hidden", "false")
            }
        }, t.prototype.buildOut = function() {
            var t = this;
            t.$slides = t.$slider.children(t.options.slide + ":not(.slick-cloned)").addClass("slick-slide"), t.slideCount = t.$slides.length, t.$slides.each(function(t, n) { e(n).attr("data-slick-index", t).data("originalStyling", e(n).attr("style") || "") }), t.$slider.addClass("slick-slider"), t.$slideTrack = 0 === t.slideCount ? e('<div class="slick-track"/>').appendTo(t.$slider) : t.$slides.wrapAll('<div class="slick-track"/>').parent(), t.$list = t.$slideTrack.wrap('<div aria-live="polite" class="slick-list"/>').parent(), t.$slideTrack.css("opacity", 0), (t.options.centerMode === !0 || t.options.swipeToSlide === !0) && (t.options.slidesToScroll = 1), e("img[data-lazy]", t.$slider).not("[src]").addClass("slick-loading"), t.setupInfinite(), t.buildArrows(), t.buildDots(), t.updateDots(), t.setSlideClasses("number" == typeof t.currentSlide ? t.currentSlide : 0), t.options.draggable === !0 && t.$list.addClass("draggable")
        }, t.prototype.buildRows = function() {
            var e, t, n, i, r, o, s, a = this;
            if (i = document.createDocumentFragment(), o = a.$slider.children(), a.options.rows > 1) {
                for (s = a.options.slidesPerRow * a.options.rows, r = Math.ceil(o.length / s), e = 0; r > e; e++) {
                    var l = document.createElement("div");
                    for (t = 0; t < a.options.rows; t++) {
                        var c = document.createElement("div");
                        for (n = 0; n < a.options.slidesPerRow; n++) {
                            var u = e * s + (t * a.options.slidesPerRow + n);
                            o.get(u) && c.appendChild(o.get(u))
                        }
                        l.appendChild(c)
                    }
                    i.appendChild(l)
                }
                a.$slider.empty().append(i), a.$slider.children().children().children().css({ width: 100 / a.options.slidesPerRow + "%", display: "inline-block" })
            }
        }, t.prototype.checkResponsive = function(t, n) {
            var i, r, o, s = this,
                a = !1,
                l = s.$slider.width(),
                c = window.innerWidth || e(window).width();
            if ("window" === s.respondTo ? o = c : "slider" === s.respondTo ? o = l : "min" === s.respondTo && (o = Math.min(c, l)), s.options.responsive && s.options.responsive.length && null !== s.options.responsive) {
                r = null;
                for (i in s.breakpoints) s.breakpoints.hasOwnProperty(i) && (s.originalSettings.mobileFirst === !1 ? o < s.breakpoints[i] && (r = s.breakpoints[i]) : o > s.breakpoints[i] && (r = s.breakpoints[i]));
                null !== r ? null !== s.activeBreakpoint ? (r !== s.activeBreakpoint || n) && (s.activeBreakpoint = r, "unslick" === s.breakpointSettings[r] ? s.unslick(r) : (s.options = e.extend({}, s.originalSettings, s.breakpointSettings[r]), t === !0 && (s.currentSlide = s.options.initialSlide), s.refresh(t)), a = r) : (s.activeBreakpoint = r, "unslick" === s.breakpointSettings[r] ? s.unslick(r) : (s.options = e.extend({}, s.originalSettings, s.breakpointSettings[r]), t === !0 && (s.currentSlide = s.options.initialSlide), s.refresh(t)), a = r) : null !== s.activeBreakpoint && (s.activeBreakpoint = null, s.options = s.originalSettings, t === !0 && (s.currentSlide = s.options.initialSlide), s.refresh(t), a = r), t || a === !1 || s.$slider.trigger("breakpoint", [s, a])
            }
        }, t.prototype.changeSlide = function(t, n) {
            var i, r, o, s = this,
                a = e(t.currentTarget);
            switch (a.is("a") && t.preventDefault(), a.is("li") || (a = a.closest("li")), o = s.slideCount % s.options.slidesToScroll !== 0, i = o ? 0 : (s.slideCount - s.currentSlide) % s.options.slidesToScroll, t.data.message) {
                case "previous":
                    r = 0 === i ? s.options.slidesToScroll : s.options.slidesToShow - i, s.slideCount > s.options.slidesToShow && s.slideHandler(s.currentSlide - r, !1, n);
                    break;
                case "next":
                    r = 0 === i ? s.options.slidesToScroll : i, s.slideCount > s.options.slidesToShow && s.slideHandler(s.currentSlide + r, !1, n);
                    break;
                case "index":
                    var l = 0 === t.data.index ? 0 : t.data.index || a.index() * s.options.slidesToScroll;
                    s.slideHandler(s.checkNavigable(l), !1, n), a.children().trigger("focus");
                    break;
                default:
                    return
            }
        }, t.prototype.checkNavigable = function(e) {
            var t, n, i = this;
            if (t = i.getNavigableIndexes(), n = 0, e > t[t.length - 1]) e = t[t.length - 1];
            else
                for (var r in t) {
                    if (e < t[r]) { e = n; break }
                    n = t[r]
                }
            return e
        }, t.prototype.cleanUpEvents = function() {
            var t = this;
            t.options.dots && null !== t.$dots && e("li", t.$dots).off("click.slick", t.changeSlide).off("mouseenter.slick", e.proxy(t.interrupt, t, !0)).off("mouseleave.slick", e.proxy(t.interrupt, t, !1)), t.$slider.off("focus.slick blur.slick"), t.options.arrows === !0 && t.slideCount > t.options.slidesToShow && (t.$prevArrow && t.$prevArrow.off("click.slick", t.changeSlide), t.$nextArrow && t.$nextArrow.off("click.slick", t.changeSlide)), t.$list.off("touchstart.slick mousedown.slick", t.swipeHandler), t.$list.off("touchmove.slick mousemove.slick", t.swipeHandler), t.$list.off("touchend.slick mouseup.slick", t.swipeHandler), t.$list.off("touchcancel.slick mouseleave.slick", t.swipeHandler), t.$list.off("click.slick", t.clickHandler), e(document).off(t.visibilityChange, t.visibility), t.cleanUpSlideEvents(), t.options.accessibility === !0 && t.$list.off("keydown.slick", t.keyHandler), t.options.focusOnSelect === !0 && e(t.$slideTrack).children().off("click.slick", t.selectHandler), e(window).off("orientationchange.slick.slick-" + t.instanceUid, t.orientationChange), e(window).off("resize.slick.slick-" + t.instanceUid, t.resize), e("[draggable!=true]", t.$slideTrack).off("dragstart", t.preventDefault), e(window).off("load.slick.slick-" + t.instanceUid, t.setPosition), e(document).off("ready.slick.slick-" + t.instanceUid, t.setPosition)
        }, t.prototype.cleanUpSlideEvents = function() {
            var t = this;
            t.$list.off("mouseenter.slick", e.proxy(t.interrupt, t, !0)), t.$list.off("mouseleave.slick", e.proxy(t.interrupt, t, !1))
        }, t.prototype.cleanUpRows = function() {
            var e, t = this;
            t.options.rows > 1 && (e = t.$slides.children().children(), e.removeAttr("style"), t.$slider.empty().append(e))
        }, t.prototype.clickHandler = function(e) {
            var t = this;
            t.shouldClick === !1 && (e.stopImmediatePropagation(), e.stopPropagation(), e.preventDefault())
        }, t.prototype.destroy = function(t) {
            var n = this;
            n.autoPlayClear(), n.touchObject = {}, n.cleanUpEvents(), e(".slick-cloned", n.$slider).detach(), n.$dots && n.$dots.remove(), n.$prevArrow && n.$prevArrow.length && (n.$prevArrow.removeClass("slick-disabled slick-arrow slick-hidden").removeAttr("aria-hidden aria-disabled tabindex").css("display", ""), n.htmlExpr.test(n.options.prevArrow) && n.$prevArrow.remove()), n.$nextArrow && n.$nextArrow.length && (n.$nextArrow.removeClass("slick-disabled slick-arrow slick-hidden").removeAttr("aria-hidden aria-disabled tabindex").css("display", ""), n.htmlExpr.test(n.options.nextArrow) && n.$nextArrow.remove()), n.$slides && (n.$slides.removeClass("slick-slide slick-active slick-center slick-visible slick-current").removeAttr("aria-hidden").removeAttr("data-slick-index").each(function() { e(this).attr("style", e(this).data("originalStyling")) }), n.$slideTrack.children(this.options.slide).detach(), n.$slideTrack.detach(), n.$list.detach(), n.$slider.append(n.$slides)), n.cleanUpRows(), n.$slider.removeClass("slick-slider"), n.$slider.removeClass("slick-initialized"), n.$slider.removeClass("slick-dotted"), n.unslicked = !0, t || n.$slider.trigger("destroy", [n])
        }, t.prototype.disableTransition = function(e) {
            var t = this,
                n = {};
            n[t.transitionType] = "", t.options.fade === !1 ? t.$slideTrack.css(n) : t.$slides.eq(e).css(n)
        }, t.prototype.fadeSlide = function(e, t) {
            var n = this;
            n.cssTransitions === !1 ? (n.$slides.eq(e).css({ zIndex: n.options.zIndex }), n.$slides.eq(e).animate({ opacity: 1 }, n.options.speed, n.options.easing, t)) : (n.applyTransition(e), n.$slides.eq(e).css({ opacity: 1, zIndex: n.options.zIndex }), t && setTimeout(function() { n.disableTransition(e), t.call() }, n.options.speed))
        }, t.prototype.fadeSlideOut = function(e) {
            var t = this;
            t.cssTransitions === !1 ? t.$slides.eq(e).animate({ opacity: 0, zIndex: t.options.zIndex - 2 }, t.options.speed, t.options.easing) : (t.applyTransition(e), t.$slides.eq(e).css({ opacity: 0, zIndex: t.options.zIndex - 2 }))
        }, t.prototype.filterSlides = t.prototype.slickFilter = function(e) {
            var t = this;
            null !== e && (t.$slidesCache = t.$slides, t.unload(), t.$slideTrack.children(this.options.slide).detach(), t.$slidesCache.filter(e).appendTo(t.$slideTrack), t.reinit())
        }, t.prototype.focusHandler = function() {
            var t = this;
            t.$slider.off("focus.slick blur.slick").on("focus.slick blur.slick", "*:not(.slick-arrow)", function(n) {
                n.stopImmediatePropagation();
                var i = e(this);
                setTimeout(function() { t.options.pauseOnFocus && (t.focussed = i.is(":focus"), t.autoPlay()) }, 0)
            })
        }, t.prototype.getCurrent = t.prototype.slickCurrentSlide = function() { var e = this; return e.currentSlide }, t.prototype.getDotCount = function() {
            var e = this,
                t = 0,
                n = 0,
                i = 0;
            if (e.options.infinite === !0)
                for (; t < e.slideCount;) ++i, t = n + e.options.slidesToScroll, n += e.options.slidesToScroll <= e.options.slidesToShow ? e.options.slidesToScroll : e.options.slidesToShow;
            else if (e.options.centerMode === !0) i = e.slideCount;
            else if (e.options.asNavFor)
                for (; t < e.slideCount;) ++i, t = n + e.options.slidesToScroll, n += e.options.slidesToScroll <= e.options.slidesToShow ? e.options.slidesToScroll : e.options.slidesToShow;
            else i = 1 + Math.ceil((e.slideCount - e.options.slidesToShow) / e.options.slidesToScroll);
            return i - 1
        }, t.prototype.getLeft = function(e) {
            var t, n, i, r = this,
                o = 0;
            return r.slideOffset = 0, n = r.$slides.first().outerHeight(!0), r.options.infinite === !0 ? (r.slideCount > r.options.slidesToShow && (r.slideOffset = r.slideWidth * r.options.slidesToShow * -1, o = n * r.options.slidesToShow * -1), r.slideCount % r.options.slidesToScroll !== 0 && e + r.options.slidesToScroll > r.slideCount && r.slideCount > r.options.slidesToShow && (e > r.slideCount ? (r.slideOffset = (r.options.slidesToShow - (e - r.slideCount)) * r.slideWidth * -1, o = (r.options.slidesToShow - (e - r.slideCount)) * n * -1) : (r.slideOffset = r.slideCount % r.options.slidesToScroll * r.slideWidth * -1, o = r.slideCount % r.options.slidesToScroll * n * -1))) : e + r.options.slidesToShow > r.slideCount && (r.slideOffset = (e + r.options.slidesToShow - r.slideCount) * r.slideWidth, o = (e + r.options.slidesToShow - r.slideCount) * n), r.slideCount <= r.options.slidesToShow && (r.slideOffset = 0, o = 0), r.options.centerMode === !0 && r.options.infinite === !0 ? r.slideOffset += r.slideWidth * Math.floor(r.options.slidesToShow / 2) - r.slideWidth : r.options.centerMode === !0 && (r.slideOffset = 0, r.slideOffset += r.slideWidth * Math.floor(r.options.slidesToShow / 2)), t = r.options.vertical === !1 ? e * r.slideWidth * -1 + r.slideOffset : e * n * -1 + o, r.options.variableWidth === !0 && (i = r.slideCount <= r.options.slidesToShow || r.options.infinite === !1 ? r.$slideTrack.children(".slick-slide").eq(e) : r.$slideTrack.children(".slick-slide").eq(e + r.options.slidesToShow), t = r.options.rtl === !0 ? i[0] ? -1 * (r.$slideTrack.width() - i[0].offsetLeft - i.width()) : 0 : i[0] ? -1 * i[0].offsetLeft : 0, r.options.centerMode === !0 && (i = r.slideCount <= r.options.slidesToShow || r.options.infinite === !1 ? r.$slideTrack.children(".slick-slide").eq(e) : r.$slideTrack.children(".slick-slide").eq(e + r.options.slidesToShow + 1), t = r.options.rtl === !0 ? i[0] ? -1 * (r.$slideTrack.width() - i[0].offsetLeft - i.width()) : 0 : i[0] ? -1 * i[0].offsetLeft : 0, t += (r.$list.width() - i.outerWidth()) / 2)), t
        }, t.prototype.getOption = t.prototype.slickGetOption = function(e) { var t = this; return t.options[e] }, t.prototype.getNavigableIndexes = function() {
            var e, t = this,
                n = 0,
                i = 0,
                r = [];
            for (t.options.infinite === !1 ? e = t.slideCount : (n = -1 * t.options.slidesToScroll, i = -1 * t.options.slidesToScroll, e = 2 * t.slideCount); e > n;) r.push(n), n = i + t.options.slidesToScroll, i += t.options.slidesToScroll <= t.options.slidesToShow ? t.options.slidesToScroll : t.options.slidesToShow;
            return r
        }, t.prototype.getSlick = function() { return this }, t.prototype.getSlideCount = function() { var t, n, i, r = this; return i = r.options.centerMode === !0 ? r.slideWidth * Math.floor(r.options.slidesToShow / 2) : 0, r.options.swipeToSlide === !0 ? (r.$slideTrack.find(".slick-slide").each(function(t, o) { return o.offsetLeft - i + e(o).outerWidth() / 2 > -1 * r.swipeLeft ? (n = o, !1) : void 0 }), t = Math.abs(e(n).attr("data-slick-index") - r.currentSlide) || 1) : r.options.slidesToScroll }, t.prototype.goTo = t.prototype.slickGoTo = function(e, t) {
            var n = this;
            n.changeSlide({ data: { message: "index", index: parseInt(e) } }, t)
        }, t.prototype.init = function(t) {
            var n = this;
            e(n.$slider).hasClass("slick-initialized") || (e(n.$slider).addClass("slick-initialized"), n.buildRows(), n.buildOut(), n.setProps(), n.startLoad(), n.loadSlider(), n.initializeEvents(), n.updateArrows(), n.updateDots(), n.checkResponsive(!0), n.focusHandler()), t && n.$slider.trigger("init", [n]), n.options.accessibility === !0 && n.initADA(), n.options.autoplay && (n.paused = !1, n.autoPlay())
        }, t.prototype.initADA = function() {
            var t = this;
            t.$slides.add(t.$slideTrack.find(".slick-cloned")).attr({ "aria-hidden": "true", tabindex: "-1" }).find("a, input, button, select").attr({ tabindex: "-1" }), t.$slideTrack.attr("role", "listbox"), t.$slides.not(t.$slideTrack.find(".slick-cloned")).each(function(n) { e(this).attr({ role: "option", "aria-describedby": "slick-slide" + t.instanceUid + n }) }), null !== t.$dots && t.$dots.attr("role", "tablist").find("li").each(function(n) { e(this).attr({ role: "presentation", "aria-selected": "false", "aria-controls": "navigation" + t.instanceUid + n, id: "slick-slide" + t.instanceUid + n }) }).first().attr("aria-selected", "true").end().find("button").attr("role", "button").end().closest("div").attr("role", "toolbar"), t.activateADA()
        }, t.prototype.initArrowEvents = function() {
            var e = this;
            e.options.arrows === !0 && e.slideCount > e.options.slidesToShow && (e.$prevArrow.off("click.slick").on("click.slick", { message: "previous" }, e.changeSlide), e.$nextArrow.off("click.slick").on("click.slick", { message: "next" }, e.changeSlide))
        }, t.prototype.initDotEvents = function() {
            var t = this;
            t.options.dots === !0 && t.slideCount > t.options.slidesToShow && e("li", t.$dots).on("click.slick", { message: "index" }, t.changeSlide), t.options.dots === !0 && t.options.pauseOnDotsHover === !0 && e("li", t.$dots).on("mouseenter.slick", e.proxy(t.interrupt, t, !0)).on("mouseleave.slick", e.proxy(t.interrupt, t, !1))
        }, t.prototype.initSlideEvents = function() {
            var t = this;
            t.options.pauseOnHover && (t.$list.on("mouseenter.slick", e.proxy(t.interrupt, t, !0)), t.$list.on("mouseleave.slick", e.proxy(t.interrupt, t, !1)))
        }, t.prototype.initializeEvents = function() {
            var t = this;
            t.initArrowEvents(), t.initDotEvents(), t.initSlideEvents(), t.$list.on("touchstart.slick mousedown.slick", { action: "start" }, t.swipeHandler), t.$list.on("touchmove.slick mousemove.slick", { action: "move" }, t.swipeHandler), t.$list.on("touchend.slick mouseup.slick", { action: "end" }, t.swipeHandler), t.$list.on("touchcancel.slick mouseleave.slick", { action: "end" }, t.swipeHandler), t.$list.on("click.slick", t.clickHandler), e(document).on(t.visibilityChange, e.proxy(t.visibility, t)), t.options.accessibility === !0 && t.$list.on("keydown.slick", t.keyHandler), t.options.focusOnSelect === !0 && e(t.$slideTrack).children().on("click.slick", t.selectHandler), e(window).on("orientationchange.slick.slick-" + t.instanceUid, e.proxy(t.orientationChange, t)), e(window).on("resize.slick.slick-" + t.instanceUid, e.proxy(t.resize, t)), e("[draggable!=true]", t.$slideTrack).on("dragstart", t.preventDefault), e(window).on("load.slick.slick-" + t.instanceUid, t.setPosition), e(document).on("ready.slick.slick-" + t.instanceUid, t.setPosition)
        }, t.prototype.initUI = function() {
            var e = this;
            e.options.arrows === !0 && e.slideCount > e.options.slidesToShow && (e.$prevArrow.show(), e.$nextArrow.show()), e.options.dots === !0 && e.slideCount > e.options.slidesToShow && e.$dots.show()
        }, t.prototype.keyHandler = function(e) {
            var t = this;
            e.target.tagName.match("TEXTAREA|INPUT|SELECT") || (37 === e.keyCode && t.options.accessibility === !0 ? t.changeSlide({ data: { message: t.options.rtl === !0 ? "next" : "previous" } }) : 39 === e.keyCode && t.options.accessibility === !0 && t.changeSlide({ data: { message: t.options.rtl === !0 ? "previous" : "next" } }))
        }, t.prototype.lazyLoad = function() {
            function t(t) {
                e("img[data-lazy]", t).each(function() {
                    var t = e(this),
                        n = e(this).attr("data-lazy"),
                        i = document.createElement("img");
                    i.onload = function() { t.animate({ opacity: 0 }, 100, function() { t.attr("src", n).animate({ opacity: 1 }, 200, function() { t.removeAttr("data-lazy").removeClass("slick-loading") }), s.$slider.trigger("lazyLoaded", [s, t, n]) }) }, i.onerror = function() { t.removeAttr("data-lazy").removeClass("slick-loading").addClass("slick-lazyload-error"), s.$slider.trigger("lazyLoadError", [s, t, n]) }, i.src = n
                })
            }
            var n, i, r, o, s = this;
            s.options.centerMode === !0 ? s.options.infinite === !0 ? (r = s.currentSlide + (s.options.slidesToShow / 2 + 1), o = r + s.options.slidesToShow + 2) : (r = Math.max(0, s.currentSlide - (s.options.slidesToShow / 2 + 1)), o = 2 + (s.options.slidesToShow / 2 + 1) + s.currentSlide) : (r = s.options.infinite ? s.options.slidesToShow + s.currentSlide : s.currentSlide, o = Math.ceil(r + s.options.slidesToShow), s.options.fade === !0 && (r > 0 && r--, o <= s.slideCount && o++)), n = s.$slider.find(".slick-slide").slice(r, o), t(n), s.slideCount <= s.options.slidesToShow ? (i = s.$slider.find(".slick-slide"), t(i)) : s.currentSlide >= s.slideCount - s.options.slidesToShow ? (i = s.$slider.find(".slick-cloned").slice(0, s.options.slidesToShow), t(i)) : 0 === s.currentSlide && (i = s.$slider.find(".slick-cloned").slice(-1 * s.options.slidesToShow), t(i))
        }, t.prototype.loadSlider = function() {
            var e = this;
            e.setPosition(), e.$slideTrack.css({ opacity: 1 }), e.$slider.removeClass("slick-loading"), e.initUI(), "progressive" === e.options.lazyLoad && e.progressiveLazyLoad()
        }, t.prototype.next = t.prototype.slickNext = function() {
            var e = this;
            e.changeSlide({ data: { message: "next" } })
        }, t.prototype.orientationChange = function() {
            var e = this;
            e.checkResponsive(), e.setPosition()
        }, t.prototype.pause = t.prototype.slickPause = function() {
            var e = this;
            e.autoPlayClear(), e.paused = !0
        }, t.prototype.play = t.prototype.slickPlay = function() {
            var e = this;
            e.autoPlay(), e.options.autoplay = !0, e.paused = !1, e.focussed = !1, e.interrupted = !1
        }, t.prototype.postSlide = function(e) {
            var t = this;
            t.unslicked || (t.$slider.trigger("afterChange", [t, e]), t.animating = !1, t.setPosition(), t.swipeLeft = null, t.options.autoplay && t.autoPlay(), t.options.accessibility === !0 && t.initADA())
        }, t.prototype.prev = t.prototype.slickPrev = function() {
            var e = this;
            e.changeSlide({ data: { message: "previous" } })
        }, t.prototype.preventDefault = function(e) { e.preventDefault() }, t.prototype.progressiveLazyLoad = function(t) {
            t = t || 1;
            var n, i, r, o = this,
                s = e("img[data-lazy]", o.$slider);
            s.length ? (n = s.first(), i = n.attr("data-lazy"), r = document.createElement("img"), r.onload = function() { n.attr("src", i).removeAttr("data-lazy").removeClass("slick-loading"), o.options.adaptiveHeight === !0 && o.setPosition(), o.$slider.trigger("lazyLoaded", [o, n, i]), o.progressiveLazyLoad() }, r.onerror = function() { 3 > t ? setTimeout(function() { o.progressiveLazyLoad(t + 1) }, 500) : (n.removeAttr("data-lazy").removeClass("slick-loading").addClass("slick-lazyload-error"), o.$slider.trigger("lazyLoadError", [o, n, i]), o.progressiveLazyLoad()) }, r.src = i) : o.$slider.trigger("allImagesLoaded", [o])
        }, t.prototype.refresh = function(t) {
            var n, i, r = this;
            i = r.slideCount - r.options.slidesToShow, !r.options.infinite && r.currentSlide > i && (r.currentSlide = i), r.slideCount <= r.options.slidesToShow && (r.currentSlide = 0), n = r.currentSlide, r.destroy(!0), e.extend(r, r.initials, { currentSlide: n }), r.init(), t || r.changeSlide({ data: { message: "index", index: n } }, !1)
        }, t.prototype.registerBreakpoints = function() {
            var t, n, i, r = this,
                o = r.options.responsive || null;
            if ("array" === e.type(o) && o.length) {
                r.respondTo = r.options.respondTo || "window";
                for (t in o)
                    if (i = r.breakpoints.length - 1, n = o[t].breakpoint, o.hasOwnProperty(t)) {
                        for (; i >= 0;) r.breakpoints[i] && r.breakpoints[i] === n && r.breakpoints.splice(i, 1), i--;
                        r.breakpoints.push(n), r.breakpointSettings[n] = o[t].settings
                    }
                r.breakpoints.sort(function(e, t) { return r.options.mobileFirst ? e - t : t - e })
            }
        }, t.prototype.reinit = function() {
            var t = this;
            t.$slides = t.$slideTrack.children(t.options.slide).addClass("slick-slide"), t.slideCount = t.$slides.length, t.currentSlide >= t.slideCount && 0 !== t.currentSlide && (t.currentSlide = t.currentSlide - t.options.slidesToScroll), t.slideCount <= t.options.slidesToShow && (t.currentSlide = 0), t.registerBreakpoints(), t.setProps(), t.setupInfinite(), t.buildArrows(), t.updateArrows(), t.initArrowEvents(), t.buildDots(), t.updateDots(), t.initDotEvents(), t.cleanUpSlideEvents(), t.initSlideEvents(), t.checkResponsive(!1, !0), t.options.focusOnSelect === !0 && e(t.$slideTrack).children().on("click.slick", t.selectHandler), t.setSlideClasses("number" == typeof t.currentSlide ? t.currentSlide : 0), t.setPosition(), t.focusHandler(), t.paused = !t.options.autoplay, t.autoPlay(), t.$slider.trigger("reInit", [t])
        }, t.prototype.resize = function() {
            var t = this;
            e(window).width() !== t.windowWidth && (clearTimeout(t.windowDelay), t.windowDelay = window.setTimeout(function() { t.windowWidth = e(window).width(), t.checkResponsive(), t.unslicked || t.setPosition() }, 50))
        }, t.prototype.removeSlide = t.prototype.slickRemove = function(e, t, n) { var i = this; return "boolean" == typeof e ? (t = e, e = t === !0 ? 0 : i.slideCount - 1) : e = t === !0 ? --e : e, !(i.slideCount < 1 || 0 > e || e > i.slideCount - 1) && (i.unload(), n === !0 ? i.$slideTrack.children().remove() : i.$slideTrack.children(this.options.slide).eq(e).remove(), i.$slides = i.$slideTrack.children(this.options.slide), i.$slideTrack.children(this.options.slide).detach(), i.$slideTrack.append(i.$slides), i.$slidesCache = i.$slides, void i.reinit()) }, t.prototype.setCSS = function(e) {
            var t, n, i = this,
                r = {};
            i.options.rtl === !0 && (e = -e), t = "left" == i.positionProp ? Math.ceil(e) + "px" : "0px", n = "top" == i.positionProp ? Math.ceil(e) + "px" : "0px", r[i.positionProp] = e, i.transformsEnabled === !1 ? i.$slideTrack.css(r) : (r = {}, i.cssTransitions === !1 ? (r[i.animType] = "translate(" + t + ", " + n + ")", i.$slideTrack.css(r)) : (r[i.animType] = "translate3d(" + t + ", " + n + ", 0px)", i.$slideTrack.css(r)))
        }, t.prototype.setDimensions = function() {
            var e = this;
            e.options.vertical === !1 ? e.options.centerMode === !0 && e.$list.css({ padding: "0px " + e.options.centerPadding }) : (e.$list.height(e.$slides.first().outerHeight(!0) * e.options.slidesToShow), e.options.centerMode === !0 && e.$list.css({ padding: e.options.centerPadding + " 0px" })), e.listWidth = e.$list.width(), e.listHeight = e.$list.height(), e.options.vertical === !1 && e.options.variableWidth === !1 ? (e.slideWidth = Math.ceil(e.listWidth / e.options.slidesToShow), e.$slideTrack.width(Math.ceil(e.slideWidth * e.$slideTrack.children(".slick-slide").length))) : e.options.variableWidth === !0 ? e.$slideTrack.width(5e3 * e.slideCount) : (e.slideWidth = Math.ceil(e.listWidth), e.$slideTrack.height(Math.ceil(e.$slides.first().outerHeight(!0) * e.$slideTrack.children(".slick-slide").length)));
            var t = e.$slides.first().outerWidth(!0) - e.$slides.first().width();
            e.options.variableWidth === !1 && e.$slideTrack.children(".slick-slide").width(e.slideWidth - t)
        }, t.prototype.setFade = function() {
            var t, n = this;
            n.$slides.each(function(i, r) { t = n.slideWidth * i * -1, n.options.rtl === !0 ? e(r).css({ position: "relative", right: t, top: 0, zIndex: n.options.zIndex - 2, opacity: 0 }) : e(r).css({ position: "relative", left: t, top: 0, zIndex: n.options.zIndex - 2, opacity: 0 }) }), n.$slides.eq(n.currentSlide).css({ zIndex: n.options.zIndex - 1, opacity: 1 })
        }, t.prototype.setHeight = function() {
            var e = this;
            if (1 === e.options.slidesToShow && e.options.adaptiveHeight === !0 && e.options.vertical === !1) {
                var t = e.$slides.eq(e.currentSlide).outerHeight(!0);
                e.$list.css("height", t)
            }
        }, t.prototype.setOption = t.prototype.slickSetOption = function() {
            var t, n, i, r, o, s = this,
                a = !1;
            if ("object" === e.type(arguments[0]) ? (i = arguments[0], a = arguments[1], o = "multiple") : "string" === e.type(arguments[0]) && (i = arguments[0], r = arguments[1], a = arguments[2], "responsive" === arguments[0] && "array" === e.type(arguments[1]) ? o = "responsive" : "undefined" != typeof arguments[1] && (o = "single")), "single" === o) s.options[i] = r;
            else if ("multiple" === o) e.each(i, function(e, t) { s.options[e] = t });
            else if ("responsive" === o)
                for (n in r)
                    if ("array" !== e.type(s.options.responsive)) s.options.responsive = [r[n]];
                    else {
                        for (t = s.options.responsive.length - 1; t >= 0;) s.options.responsive[t].breakpoint === r[n].breakpoint && s.options.responsive.splice(t, 1), t--;
                        s.options.responsive.push(r[n])
                    }
            a && (s.unload(), s.reinit())
        }, t.prototype.setPosition = function() {
            var e = this;
            e.setDimensions(), e.setHeight(), e.options.fade === !1 ? e.setCSS(e.getLeft(e.currentSlide)) : e.setFade(), e.$slider.trigger("setPosition", [e])
        }, t.prototype.setProps = function() {
            var e = this,
                t = document.body.style;
            e.positionProp = e.options.vertical === !0 ? "top" : "left", "top" === e.positionProp ? e.$slider.addClass("slick-vertical") : e.$slider.removeClass("slick-vertical"), (void 0 !== t.WebkitTransition || void 0 !== t.MozTransition || void 0 !== t.msTransition) && e.options.useCSS === !0 && (e.cssTransitions = !0), e.options.fade && ("number" == typeof e.options.zIndex ? e.options.zIndex < 3 && (e.options.zIndex = 3) : e.options.zIndex = e.defaults.zIndex), void 0 !== t.OTransform && (e.animType = "OTransform", e.transformType = "-o-transform", e.transitionType = "OTransition", void 0 === t.perspectiveProperty && void 0 === t.webkitPerspective && (e.animType = !1)), void 0 !== t.MozTransform && (e.animType = "MozTransform", e.transformType = "-moz-transform", e.transitionType = "MozTransition", void 0 === t.perspectiveProperty && void 0 === t.MozPerspective && (e.animType = !1)), void 0 !== t.webkitTransform && (e.animType = "webkitTransform", e.transformType = "-webkit-transform", e.transitionType = "webkitTransition", void 0 === t.perspectiveProperty && void 0 === t.webkitPerspective && (e.animType = !1)), void 0 !== t.msTransform && (e.animType = "msTransform", e.transformType = "-ms-transform", e.transitionType = "msTransition", void 0 === t.msTransform && (e.animType = !1)), void 0 !== t.transform && e.animType !== !1 && (e.animType = "transform", e.transformType = "transform", e.transitionType = "transition"), e.transformsEnabled = e.options.useTransform && null !== e.animType && e.animType !== !1
        }, t.prototype.setSlideClasses = function(e) {
            var t, n, i, r, o = this;
            n = o.$slider.find(".slick-slide").removeClass("slick-active slick-center slick-current").attr("aria-hidden", "true"), o.$slides.eq(e).addClass("slick-current"), o.options.centerMode === !0 ? (t = Math.floor(o.options.slidesToShow / 2), o.options.infinite === !0 && (e >= t && e <= o.slideCount - 1 - t ? o.$slides.slice(e - t, e + t + 1).addClass("slick-active").attr("aria-hidden", "false") : (i = o.options.slidesToShow + e,
                n.slice(i - t + 1, i + t + 2).addClass("slick-active").attr("aria-hidden", "false")), 0 === e ? n.eq(n.length - 1 - o.options.slidesToShow).addClass("slick-center") : e === o.slideCount - 1 && n.eq(o.options.slidesToShow).addClass("slick-center")), o.$slides.eq(e).addClass("slick-center")) : e >= 0 && e <= o.slideCount - o.options.slidesToShow ? o.$slides.slice(e, e + o.options.slidesToShow).addClass("slick-active").attr("aria-hidden", "false") : n.length <= o.options.slidesToShow ? n.addClass("slick-active").attr("aria-hidden", "false") : (r = o.slideCount % o.options.slidesToShow, i = o.options.infinite === !0 ? o.options.slidesToShow + e : e, o.options.slidesToShow == o.options.slidesToScroll && o.slideCount - e < o.options.slidesToShow ? n.slice(i - (o.options.slidesToShow - r), i + r).addClass("slick-active").attr("aria-hidden", "false") : n.slice(i, i + o.options.slidesToShow).addClass("slick-active").attr("aria-hidden", "false")), "ondemand" === o.options.lazyLoad && o.lazyLoad()
        }, t.prototype.setupInfinite = function() {
            var t, n, i, r = this;
            if (r.options.fade === !0 && (r.options.centerMode = !1), r.options.infinite === !0 && r.options.fade === !1 && (n = null, r.slideCount > r.options.slidesToShow)) {
                for (i = r.options.centerMode === !0 ? r.options.slidesToShow + 1 : r.options.slidesToShow, t = r.slideCount; t > r.slideCount - i; t -= 1) n = t - 1, e(r.$slides[n]).clone(!0).attr("id", "").attr("data-slick-index", n - r.slideCount).prependTo(r.$slideTrack).addClass("slick-cloned");
                for (t = 0; i > t; t += 1) n = t, e(r.$slides[n]).clone(!0).attr("id", "").attr("data-slick-index", n + r.slideCount).appendTo(r.$slideTrack).addClass("slick-cloned");
                r.$slideTrack.find(".slick-cloned").find("[id]").each(function() { e(this).attr("id", "") })
            }
        }, t.prototype.interrupt = function(e) {
            var t = this;
            e || t.autoPlay(), t.interrupted = e
        }, t.prototype.selectHandler = function(t) {
            var n = this,
                i = e(t.target).is(".slick-slide") ? e(t.target) : e(t.target).parents(".slick-slide"),
                r = parseInt(i.attr("data-slick-index"));
            return r || (r = 0), n.slideCount <= n.options.slidesToShow ? (n.setSlideClasses(r), void n.asNavFor(r)) : void n.slideHandler(r)
        }, t.prototype.slideHandler = function(e, t, n) {
            var i, r, o, s, a, l = null,
                c = this;
            return t = t || !1, c.animating === !0 && c.options.waitForAnimate === !0 || c.options.fade === !0 && c.currentSlide === e || c.slideCount <= c.options.slidesToShow ? void 0 : (t === !1 && c.asNavFor(e), i = e, l = c.getLeft(i), s = c.getLeft(c.currentSlide), c.currentLeft = null === c.swipeLeft ? s : c.swipeLeft, c.options.infinite === !1 && c.options.centerMode === !1 && (0 > e || e > c.getDotCount() * c.options.slidesToScroll) ? void(c.options.fade === !1 && (i = c.currentSlide, n !== !0 ? c.animateSlide(s, function() { c.postSlide(i) }) : c.postSlide(i))) : c.options.infinite === !1 && c.options.centerMode === !0 && (0 > e || e > c.slideCount - c.options.slidesToScroll) ? void(c.options.fade === !1 && (i = c.currentSlide, n !== !0 ? c.animateSlide(s, function() { c.postSlide(i) }) : c.postSlide(i))) : (c.options.autoplay && clearInterval(c.autoPlayTimer), r = 0 > i ? c.slideCount % c.options.slidesToScroll !== 0 ? c.slideCount - c.slideCount % c.options.slidesToScroll : c.slideCount + i : i >= c.slideCount ? c.slideCount % c.options.slidesToScroll !== 0 ? 0 : i - c.slideCount : i, c.animating = !0, c.$slider.trigger("beforeChange", [c, c.currentSlide, r]), o = c.currentSlide, c.currentSlide = r, c.setSlideClasses(c.currentSlide), c.options.asNavFor && (a = c.getNavTarget(), a = a.slick("getSlick"), a.slideCount <= a.options.slidesToShow && a.setSlideClasses(c.currentSlide)), c.updateDots(), c.updateArrows(), c.options.fade === !0 ? (n !== !0 ? (c.fadeSlideOut(o), c.fadeSlide(r, function() { c.postSlide(r) })) : c.postSlide(r), void c.animateHeight()) : void(n !== !0 ? c.animateSlide(l, function() { c.postSlide(r) }) : c.postSlide(r))))
        }, t.prototype.startLoad = function() {
            var e = this;
            e.options.arrows === !0 && e.slideCount > e.options.slidesToShow && (e.$prevArrow.hide(), e.$nextArrow.hide()), e.options.dots === !0 && e.slideCount > e.options.slidesToShow && e.$dots.hide(), e.$slider.addClass("slick-loading")
        }, t.prototype.swipeDirection = function() { var e, t, n, i, r = this; return e = r.touchObject.startX - r.touchObject.curX, t = r.touchObject.startY - r.touchObject.curY, n = Math.atan2(t, e), i = Math.round(180 * n / Math.PI), 0 > i && (i = 360 - Math.abs(i)), 45 >= i && i >= 0 ? r.options.rtl === !1 ? "left" : "right" : 360 >= i && i >= 315 ? r.options.rtl === !1 ? "left" : "right" : i >= 135 && 225 >= i ? r.options.rtl === !1 ? "right" : "left" : r.options.verticalSwiping === !0 ? i >= 35 && 135 >= i ? "down" : "up" : "vertical" }, t.prototype.swipeEnd = function(e) {
            var t, n, i = this;
            if (i.dragging = !1, i.interrupted = !1, i.shouldClick = !(i.touchObject.swipeLength > 10), void 0 === i.touchObject.curX) return !1;
            if (i.touchObject.edgeHit === !0 && i.$slider.trigger("edge", [i, i.swipeDirection()]), i.touchObject.swipeLength >= i.touchObject.minSwipe) {
                switch (n = i.swipeDirection()) {
                    case "left":
                    case "down":
                        t = i.options.swipeToSlide ? i.checkNavigable(i.currentSlide + i.getSlideCount()) : i.currentSlide + i.getSlideCount(), i.currentDirection = 0;
                        break;
                    case "right":
                    case "up":
                        t = i.options.swipeToSlide ? i.checkNavigable(i.currentSlide - i.getSlideCount()) : i.currentSlide - i.getSlideCount(), i.currentDirection = 1
                }
                "vertical" != n && (i.slideHandler(t), i.touchObject = {}, i.$slider.trigger("swipe", [i, n]))
            } else i.touchObject.startX !== i.touchObject.curX && (i.slideHandler(i.currentSlide), i.touchObject = {})
        }, t.prototype.swipeHandler = function(e) {
            var t = this;
            if (!(t.options.swipe === !1 || "ontouchend" in document && t.options.swipe === !1 || t.options.draggable === !1 && -1 !== e.type.indexOf("mouse"))) switch (t.touchObject.fingerCount = e.originalEvent && void 0 !== e.originalEvent.touches ? e.originalEvent.touches.length : 1, t.touchObject.minSwipe = t.listWidth / t.options.touchThreshold, t.options.verticalSwiping === !0 && (t.touchObject.minSwipe = t.listHeight / t.options.touchThreshold), e.data.action) {
                case "start":
                    t.swipeStart(e);
                    break;
                case "move":
                    t.swipeMove(e);
                    break;
                case "end":
                    t.swipeEnd(e)
            }
        }, t.prototype.swipeMove = function(e) { var t, n, i, r, o, s = this; return o = void 0 !== e.originalEvent ? e.originalEvent.touches : null, !(!s.dragging || o && 1 !== o.length) && (t = s.getLeft(s.currentSlide), s.touchObject.curX = void 0 !== o ? o[0].pageX : e.clientX, s.touchObject.curY = void 0 !== o ? o[0].pageY : e.clientY, s.touchObject.swipeLength = Math.round(Math.sqrt(Math.pow(s.touchObject.curX - s.touchObject.startX, 2))), s.options.verticalSwiping === !0 && (s.touchObject.swipeLength = Math.round(Math.sqrt(Math.pow(s.touchObject.curY - s.touchObject.startY, 2)))), n = s.swipeDirection(), "vertical" !== n ? (void 0 !== e.originalEvent && s.touchObject.swipeLength > 4 && e.preventDefault(), r = (s.options.rtl === !1 ? 1 : -1) * (s.touchObject.curX > s.touchObject.startX ? 1 : -1), s.options.verticalSwiping === !0 && (r = s.touchObject.curY > s.touchObject.startY ? 1 : -1), i = s.touchObject.swipeLength, s.touchObject.edgeHit = !1, s.options.infinite === !1 && (0 === s.currentSlide && "right" === n || s.currentSlide >= s.getDotCount() && "left" === n) && (i = s.touchObject.swipeLength * s.options.edgeFriction, s.touchObject.edgeHit = !0), s.options.vertical === !1 ? s.swipeLeft = t + i * r : s.swipeLeft = t + i * (s.$list.height() / s.listWidth) * r, s.options.verticalSwiping === !0 && (s.swipeLeft = t + i * r), s.options.fade !== !0 && s.options.touchMove !== !1 && (s.animating === !0 ? (s.swipeLeft = null, !1) : void s.setCSS(s.swipeLeft))) : void 0) }, t.prototype.swipeStart = function(e) { var t, n = this; return n.interrupted = !0, 1 !== n.touchObject.fingerCount || n.slideCount <= n.options.slidesToShow ? (n.touchObject = {}, !1) : (void 0 !== e.originalEvent && void 0 !== e.originalEvent.touches && (t = e.originalEvent.touches[0]), n.touchObject.startX = n.touchObject.curX = void 0 !== t ? t.pageX : e.clientX, n.touchObject.startY = n.touchObject.curY = void 0 !== t ? t.pageY : e.clientY, void(n.dragging = !0)) }, t.prototype.unfilterSlides = t.prototype.slickUnfilter = function() {
            var e = this;
            null !== e.$slidesCache && (e.unload(), e.$slideTrack.children(this.options.slide).detach(), e.$slidesCache.appendTo(e.$slideTrack), e.reinit())
        }, t.prototype.unload = function() {
            var t = this;
            e(".slick-cloned", t.$slider).remove(), t.$dots && t.$dots.remove(), t.$prevArrow && t.htmlExpr.test(t.options.prevArrow) && t.$prevArrow.remove(), t.$nextArrow && t.htmlExpr.test(t.options.nextArrow) && t.$nextArrow.remove(), t.$slides.removeClass("slick-slide slick-active slick-visible slick-current").attr("aria-hidden", "true").css("width", "")
        }, t.prototype.unslick = function(e) {
            var t = this;
            t.$slider.trigger("unslick", [t, e]), t.destroy()
        }, t.prototype.updateArrows = function() {
            var e, t = this;
            e = Math.floor(t.options.slidesToShow / 2), t.options.arrows === !0 && t.slideCount > t.options.slidesToShow && !t.options.infinite && (t.$prevArrow.removeClass("slick-disabled").attr("aria-disabled", "false"), t.$nextArrow.removeClass("slick-disabled").attr("aria-disabled", "false"), 0 === t.currentSlide ? (t.$prevArrow.addClass("slick-disabled").attr("aria-disabled", "true"), t.$nextArrow.removeClass("slick-disabled").attr("aria-disabled", "false")) : t.currentSlide >= t.slideCount - t.options.slidesToShow && t.options.centerMode === !1 ? (t.$nextArrow.addClass("slick-disabled").attr("aria-disabled", "true"), t.$prevArrow.removeClass("slick-disabled").attr("aria-disabled", "false")) : t.currentSlide >= t.slideCount - 1 && t.options.centerMode === !0 && (t.$nextArrow.addClass("slick-disabled").attr("aria-disabled", "true"), t.$prevArrow.removeClass("slick-disabled").attr("aria-disabled", "false")))
        }, t.prototype.updateDots = function() {
            var e = this;
            null !== e.$dots && (e.$dots.find("li").removeClass("slick-active").attr("aria-hidden", "true"), e.$dots.find("li").eq(Math.floor(e.currentSlide / e.options.slidesToScroll)).addClass("slick-active").attr("aria-hidden", "false"))
        }, t.prototype.visibility = function() {
            var e = this;
            e.options.autoplay && (document[e.hidden] ? e.interrupted = !0 : e.interrupted = !1)
        }, e.fn.slick = function() {
            var e, n, i = this,
                r = arguments[0],
                o = Array.prototype.slice.call(arguments, 1),
                s = i.length;
            for (e = 0; s > e; e++)
                if ("object" == typeof r || "undefined" == typeof r ? i[e].slick = new t(i[e], r) : n = i[e].slick[r].apply(i[e].slick, o), "undefined" != typeof n) return n;
            return i
        }
    }),
    /*!
     * handlebars.min.js
     */
    /*!

     handlebars v4.0.3

    Copyright (C) 2011-2015 by Yehuda Katz

    Permission is hereby granted, free of charge, to any person obtaining a copy
    of this software and associated documentation files (the "Software"), to deal
    in the Software without restriction, including without limitation the rights
    to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
    copies of the Software, and to permit persons to whom the Software is
    furnished to do so, subject to the following conditions:

    The above copyright notice and this permission notice shall be included in
    all copies or substantial portions of the Software.

    THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
    IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
    FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
    AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
    LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
    OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
    THE SOFTWARE.

    @license
    */
    ! function(e, t) { "object" == typeof exports && "object" == typeof module ? module.exports = t() : "function" == typeof define && define.amd ? define(t) : "object" == typeof exports ? exports.Handlebars = t() : e.Handlebars = t() }(this, function() {
        return function(e) {
            function t(i) { if (n[i]) return n[i].exports; var r = n[i] = { exports: {}, id: i, loaded: !1 }; return e[i].call(r.exports, r, r.exports, t), r.loaded = !0, r.exports }
            var n = {};
            return t.m = e, t.c = n, t.p = "", t(0)
        }([function(e, t, n) {
            "use strict";

            function i() { var e = m(); return e.compile = function(t, n) { return u.compile(t, n, e) }, e.precompile = function(t, n) { return u.precompile(t, n, e) }, e.AST = l.default, e.Compiler = u.Compiler, e.JavaScriptCompiler = d.default, e.Parser = c.parser, e.parse = c.parse, e }
            var r = n(8).default;
            t.__esModule = !0;
            var o = n(1),
                s = r(o),
                a = n(2),
                l = r(a),
                c = n(3),
                u = n(4),
                p = n(5),
                d = r(p),
                h = n(6),
                f = r(h),
                v = n(7),
                g = r(v),
                m = s.default.create,
                y = i();
            y.create = i, g.default(y), y.Visitor = f.default, y.default = y, t.default = y, e.exports = t.default
        }, function(e, t, n) {
            "use strict";

            function i() { var e = new a.HandlebarsEnvironment; return h.extend(e, a), e.SafeString = c.default, e.Exception = p.default, e.Utils = h, e.escapeExpression = h.escapeExpression, e.VM = v, e.template = function(t) { return v.template(t, e) }, e }
            var r = n(9).default,
                o = n(8).default;
            t.__esModule = !0;
            var s = n(10),
                a = r(s),
                l = n(11),
                c = o(l),
                u = n(12),
                p = o(u),
                d = n(13),
                h = r(d),
                f = n(14),
                v = r(f),
                g = n(7),
                m = o(g),
                y = i();
            y.create = i, m.default(y), y.default = y, t.default = y, e.exports = t.default
        }, function(e, t, n) {
            "use strict";
            t.__esModule = !0;
            var i = { helpers: { helperExpression: function(e) { return "SubExpression" === e.type || ("MustacheStatement" === e.type || "BlockStatement" === e.type) && !!(e.params && e.params.length || e.hash) }, scopedId: function(e) { return /^\.|this\b/.test(e.original) }, simpleId: function(e) { return 1 === e.parts.length && !i.helpers.scopedId(e) && !e.depth } } };
            t.default = i, e.exports = t.default
        }, function(e, t, n) {
            "use strict";

            function i(e, t) {
                if ("Program" === e.type) return e;
                a.default.yy = h, h.locInfo = function(e) { return new h.SourceLocation(t && t.srcName, e) };
                var n = new c.default(t);
                return n.accept(a.default.parse(e))
            }
            var r = n(8).default,
                o = n(9).default;
            t.__esModule = !0, t.parse = i;
            var s = n(15),
                a = r(s),
                l = n(16),
                c = r(l),
                u = n(17),
                p = o(u),
                d = n(13);
            t.parser = a.default;
            var h = {};
            d.extend(h, p)
        }, function(e, t, n) {
            "use strict";

            function i() {}

            function r(e, t, n) {
                if (null == e || "string" != typeof e && "Program" !== e.type) throw new u.default("You must pass a string or Handlebars AST to Handlebars.precompile. You passed " + e);
                t = t || {}, "data" in t || (t.data = !0), t.compat && (t.useDepths = !0);
                var i = n.parse(e, t),
                    r = (new n.Compiler).compile(i, t);
                return (new n.JavaScriptCompiler).compile(r, t)
            }

            function o(e, t, n) {
                function i() {
                    var i = n.parse(e, t),
                        r = (new n.Compiler).compile(i, t),
                        o = (new n.JavaScriptCompiler).compile(r, t, void 0, !0);
                    return n.template(o)
                }

                function r(e, t) { return o || (o = i()), o.call(this, e, t) }
                if (void 0 === t && (t = {}), null == e || "string" != typeof e && "Program" !== e.type) throw new u.default("You must pass a string or Handlebars AST to Handlebars.compile. You passed " + e);
                "data" in t || (t.data = !0), t.compat && (t.useDepths = !0);
                var o = void 0;
                return r._setup = function(e) { return o || (o = i()), o._setup(e) }, r._child = function(e, t, n, r) { return o || (o = i()), o._child(e, t, n, r) }, r
            }

            function s(e, t) {
                if (e === t) return !0;
                if (p.isArray(e) && p.isArray(t) && e.length === t.length) {
                    for (var n = 0; n < e.length; n++)
                        if (!s(e[n], t[n])) return !1;
                    return !0
                }
            }

            function a(e) {
                if (!e.path.parts) {
                    var t = e.path;
                    e.path = { type: "PathExpression", data: !1, depth: 0, parts: [t.original + ""], original: t.original + "", loc: t.loc }
                }
            }
            var l = n(8).default;
            t.__esModule = !0, t.Compiler = i, t.precompile = r, t.compile = o;
            var c = n(12),
                u = l(c),
                p = n(13),
                d = n(2),
                h = l(d),
                f = [].slice;
            i.prototype = {
                compiler: i,
                equals: function(e) {
                    var t = this.opcodes.length;
                    if (e.opcodes.length !== t) return !1;
                    for (var n = 0; t > n; n++) {
                        var i = this.opcodes[n],
                            r = e.opcodes[n];
                        if (i.opcode !== r.opcode || !s(i.args, r.args)) return !1
                    }
                    t = this.children.length;
                    for (var n = 0; t > n; n++)
                        if (!this.children[n].equals(e.children[n])) return !1;
                    return !0
                },
                guid: 0,
                compile: function(e, t) {
                    this.sourceNode = [], this.opcodes = [], this.children = [], this.options = t, this.stringParams = t.stringParams, this.trackIds = t.trackIds, t.blockParams = t.blockParams || [];
                    var n = t.knownHelpers;
                    if (t.knownHelpers = { helperMissing: !0, blockHelperMissing: !0, each: !0, if: !0, unless: !0, with: !0, log: !0, lookup: !0 }, n)
                        for (var i in n) i in n && (t.knownHelpers[i] = n[i]);
                    return this.accept(e)
                },
                compileProgram: function(e) {
                    var t = new this.compiler,
                        n = t.compile(e, this.options),
                        i = this.guid++;
                    return this.usePartial = this.usePartial || n.usePartial, this.children[i] = n, this.useDepths = this.useDepths || n.useDepths, i
                },
                accept: function(e) {
                    if (!this[e.type]) throw new u.default("Unknown type: " + e.type, e);
                    this.sourceNode.unshift(e);
                    var t = this[e.type](e);
                    return this.sourceNode.shift(), t
                },
                Program: function(e) { this.options.blockParams.unshift(e.blockParams); for (var t = e.body, n = t.length, i = 0; n > i; i++) this.accept(t[i]); return this.options.blockParams.shift(), this.isSimple = 1 === n, this.blockParams = e.blockParams ? e.blockParams.length : 0, this },
                BlockStatement: function(e) {
                    a(e);
                    var t = e.program,
                        n = e.inverse;
                    t = t && this.compileProgram(t), n = n && this.compileProgram(n);
                    var i = this.classifySexpr(e);
                    "helper" === i ? this.helperSexpr(e, t, n) : "simple" === i ? (this.simpleSexpr(e), this.opcode("pushProgram", t), this.opcode("pushProgram", n), this.opcode("emptyHash"), this.opcode("blockValue", e.path.original)) : (this.ambiguousSexpr(e, t, n), this.opcode("pushProgram", t), this.opcode("pushProgram", n), this.opcode("emptyHash"), this.opcode("ambiguousBlockValue")), this.opcode("append")
                },
                DecoratorBlock: function(e) {
                    var t = e.program && this.compileProgram(e.program),
                        n = this.setupFullMustacheParams(e, t, void 0),
                        i = e.path;
                    this.useDecorators = !0, this.opcode("registerDecorator", n.length, i.original)
                },
                PartialStatement: function(e) {
                    this.usePartial = !0;
                    var t = e.program;
                    t && (t = this.compileProgram(e.program));
                    var n = e.params;
                    if (n.length > 1) throw new u.default("Unsupported number of partial arguments: " + n.length, e);
                    n.length || (this.options.explicitPartialContext ? this.opcode("pushLiteral", "undefined") : n.push({ type: "PathExpression", parts: [], depth: 0 }));
                    var i = e.name.original,
                        r = "SubExpression" === e.name.type;
                    r && this.accept(e.name), this.setupFullMustacheParams(e, t, void 0, !0);
                    var o = e.indent || "";
                    this.options.preventIndent && o && (this.opcode("appendContent", o), o = ""), this.opcode("invokePartial", r, i, o), this.opcode("append")
                },
                PartialBlockStatement: function(e) { this.PartialStatement(e) },
                MustacheStatement: function(e) { this.SubExpression(e), e.escaped && !this.options.noEscape ? this.opcode("appendEscaped") : this.opcode("append") },
                Decorator: function(e) { this.DecoratorBlock(e) },
                ContentStatement: function(e) { e.value && this.opcode("appendContent", e.value) },
                CommentStatement: function() {},
                SubExpression: function(e) { a(e); var t = this.classifySexpr(e); "simple" === t ? this.simpleSexpr(e) : "helper" === t ? this.helperSexpr(e) : this.ambiguousSexpr(e) },
                ambiguousSexpr: function(e, t, n) {
                    var i = e.path,
                        r = i.parts[0],
                        o = null != t || null != n;
                    this.opcode("getContext", i.depth), this.opcode("pushProgram", t), this.opcode("pushProgram", n), i.strict = !0, this.accept(i), this.opcode("invokeAmbiguous", r, o)
                },
                simpleSexpr: function(e) {
                    var t = e.path;
                    t.strict = !0, this.accept(t), this.opcode("resolvePossibleLambda")
                },
                helperSexpr: function(e, t, n) {
                    var i = this.setupFullMustacheParams(e, t, n),
                        r = e.path,
                        o = r.parts[0];
                    if (this.options.knownHelpers[o]) this.opcode("invokeKnownHelper", i.length, o);
                    else {
                        if (this.options.knownHelpersOnly) throw new u.default("You specified knownHelpersOnly, but used the unknown helper " + o, e);
                        r.strict = !0, r.falsy = !0, this.accept(r), this.opcode("invokeHelper", i.length, r.original, h.default.helpers.simpleId(r))
                    }
                },
                PathExpression: function(e) {
                    this.addDepth(e.depth), this.opcode("getContext", e.depth);
                    var t = e.parts[0],
                        n = h.default.helpers.scopedId(e),
                        i = !e.depth && !n && this.blockParamIndex(t);
                    i ? this.opcode("lookupBlockParam", i, e.parts) : t ? e.data ? (this.options.data = !0, this.opcode("lookupData", e.depth, e.parts, e.strict)) : this.opcode("lookupOnContext", e.parts, e.falsy, e.strict, n) : this.opcode("pushContext")
                },
                StringLiteral: function(e) { this.opcode("pushString", e.value) },
                NumberLiteral: function(e) { this.opcode("pushLiteral", e.value) },
                BooleanLiteral: function(e) { this.opcode("pushLiteral", e.value) },
                UndefinedLiteral: function() { this.opcode("pushLiteral", "undefined") },
                NullLiteral: function() { this.opcode("pushLiteral", "null") },
                Hash: function(e) {
                    var t = e.pairs,
                        n = 0,
                        i = t.length;
                    for (this.opcode("pushHash"); i > n; n++) this.pushParam(t[n].value);
                    for (; n--;) this.opcode("assignToHash", t[n].key);
                    this.opcode("popHash")
                },
                opcode: function(e) { this.opcodes.push({ opcode: e, args: f.call(arguments, 1), loc: this.sourceNode[0].loc }) },
                addDepth: function(e) { e && (this.useDepths = !0) },
                classifySexpr: function(e) {
                    var t = h.default.helpers.simpleId(e.path),
                        n = t && !!this.blockParamIndex(e.path.parts[0]),
                        i = !n && h.default.helpers.helperExpression(e),
                        r = !n && (i || t);
                    if (r && !i) {
                        var o = e.path.parts[0],
                            s = this.options;
                        s.knownHelpers[o] ? i = !0 : s.knownHelpersOnly && (r = !1)
                    }
                    return i ? "helper" : r ? "ambiguous" : "simple"
                },
                pushParams: function(e) { for (var t = 0, n = e.length; n > t; t++) this.pushParam(e[t]) },
                pushParam: function(e) {
                    var t = null != e.value ? e.value : e.original || "";
                    if (this.stringParams) t.replace && (t = t.replace(/^(\.?\.\/)*/g, "").replace(/\//g, ".")), e.depth && this.addDepth(e.depth), this.opcode("getContext", e.depth || 0), this.opcode("pushStringParam", t, e.type), "SubExpression" === e.type && this.accept(e);
                    else {
                        if (this.trackIds) {
                            var n = void 0;
                            if (!e.parts || h.default.helpers.scopedId(e) || e.depth || (n = this.blockParamIndex(e.parts[0])), n) {
                                var i = e.parts.slice(1).join(".");
                                this.opcode("pushId", "BlockParam", n, i)
                            } else t = e.original || t, t.replace && (t = t.replace(/^this(?:\.|$)/, "").replace(/^\.\//, "").replace(/^\.$/, "")), this.opcode("pushId", e.type, t)
                        }
                        this.accept(e)
                    }
                },
                setupFullMustacheParams: function(e, t, n, i) { var r = e.params; return this.pushParams(r), this.opcode("pushProgram", t), this.opcode("pushProgram", n), e.hash ? this.accept(e.hash) : this.opcode("emptyHash", i), r },
                blockParamIndex: function(e) {
                    for (var t = 0, n = this.options.blockParams.length; n > t; t++) {
                        var i = this.options.blockParams[t],
                            r = i && p.indexOf(i, e);
                        if (i && r >= 0) return [t, r]
                    }
                }
            }
        }, function(e, t, n) {
            "use strict";

            function i(e) { this.value = e }

            function r() {}

            function o(e, t, n, i) {
                var r = t.popStack(),
                    o = 0,
                    s = n.length;
                for (e && s--; s > o; o++) r = t.nameLookup(r, n[o], i);
                return e ? [t.aliasable("container.strict"), "(", r, ", ", t.quotedString(n[o]), ")"] : r
            }
            var s = n(8).default;
            t.__esModule = !0;
            var a = n(10),
                l = n(12),
                c = s(l),
                u = n(13),
                p = n(18),
                d = s(p);
            r.prototype = {
                    nameLookup: function(e, t) { return r.isValidJavaScriptVariableName(t) ? [e, ".", t] : [e, "[", JSON.stringify(t), "]"] },
                    depthedLookup: function(e) { return [this.aliasable("container.lookup"), '(depths, "', e, '")'] },
                    compilerInfo: function() {
                        var e = a.COMPILER_REVISION,
                            t = a.REVISION_CHANGES[e];
                        return [e, t]
                    },
                    appendToBuffer: function(e, t, n) { return u.isArray(e) || (e = [e]), e = this.source.wrap(e, t), this.environment.isSimple ? ["return ", e, ";"] : n ? ["buffer += ", e, ";"] : (e.appendToBuffer = !0, e) },
                    initializeBuffer: function() { return this.quotedString("") },
                    compile: function(e, t, n, i) {
                        this.environment = e, this.options = t, this.stringParams = this.options.stringParams, this.trackIds = this.options.trackIds, this.precompile = !i, this.name = this.environment.name, this.isChild = !!n, this.context = n || { decorators: [], programs: [], environments: [] }, this.preamble(), this.stackSlot = 0, this.stackVars = [], this.aliases = {}, this.registers = { list: [] }, this.hashes = [], this.compileStack = [], this.inlineStack = [], this.blockParams = [], this.compileChildren(e, t), this.useDepths = this.useDepths || e.useDepths || e.useDecorators || this.options.compat, this.useBlockParams = this.useBlockParams || e.useBlockParams;
                        var r = e.opcodes,
                            o = void 0,
                            s = void 0,
                            a = void 0,
                            l = void 0;
                        for (a = 0, l = r.length; l > a; a++) o = r[a], this.source.currentLocation = o.loc, s = s || o.loc, this[o.opcode].apply(this, o.args);
                        if (this.source.currentLocation = s, this.pushSource(""), this.stackSlot || this.inlineStack.length || this.compileStack.length) throw new c.default("Compile completed with content left on stack");
                        this.decorators.isEmpty() ? this.decorators = void 0 : (this.useDecorators = !0, this.decorators.prepend("var decorators = container.decorators;\n"), this.decorators.push("return fn;"), i ? this.decorators = Function.apply(this, ["fn", "props", "container", "depth0", "data", "blockParams", "depths", this.decorators.merge()]) : (this.decorators.prepend("function(fn, props, container, depth0, data, blockParams, depths) {\n"), this.decorators.push("}\n"), this.decorators = this.decorators.merge()));
                        var u = this.createFunctionContext(i);
                        if (this.isChild) return u;
                        var p = { compiler: this.compilerInfo(), main: u };
                        this.decorators && (p.main_d = this.decorators, p.useDecorators = !0);
                        var d = this.context,
                            h = d.programs,
                            f = d.decorators;
                        for (a = 0, l = h.length; l > a; a++) h[a] && (p[a] = h[a], f[a] && (p[a + "_d"] = f[a], p.useDecorators = !0));
                        return this.environment.usePartial && (p.usePartial = !0), this.options.data && (p.useData = !0), this.useDepths && (p.useDepths = !0), this.useBlockParams && (p.useBlockParams = !0), this.options.compat && (p.compat = !0), i ? p.compilerOptions = this.options : (p.compiler = JSON.stringify(p.compiler), this.source.currentLocation = { start: { line: 1, column: 0 } }, p = this.objectLiteral(p), t.srcName ? (p = p.toStringWithSourceMap({ file: t.destName }), p.map = p.map && p.map.toString()) : p = p.toString()), p
                    },
                    preamble: function() { this.lastContext = 0, this.source = new d.default(this.options.srcName), this.decorators = new d.default(this.options.srcName) },
                    createFunctionContext: function(e) {
                        var t = "",
                            n = this.stackVars.concat(this.registers.list);
                        n.length > 0 && (t += ", " + n.join(", "));
                        var i = 0;
                        for (var r in this.aliases) {
                            var o = this.aliases[r];
                            this.aliases.hasOwnProperty(r) && o.children && o.referenceCount > 1 && (t += ", alias" + ++i + "=" + r, o.children[0] = "alias" + i)
                        }
                        var s = ["container", "depth0", "helpers", "partials", "data"];
                        (this.useBlockParams || this.useDepths) && s.push("blockParams"), this.useDepths && s.push("depths");
                        var a = this.mergeSource(t);
                        return e ? (s.push(a), Function.apply(this, s)) : this.source.wrap(["function(", s.join(","), ") {\n  ", a, "}"])
                    },
                    mergeSource: function(e) {
                        var t = this.environment.isSimple,
                            n = !this.forceBuffer,
                            i = void 0,
                            r = void 0,
                            o = void 0,
                            s = void 0;
                        return this.source.each(function(e) { e.appendToBuffer ? (o ? e.prepend("  + ") : o = e, s = e) : (o && (r ? o.prepend("buffer += ") : i = !0, s.add(";"), o = s = void 0), r = !0, t || (n = !1)) }), n ? o ? (o.prepend("return "), s.add(";")) : r || this.source.push('return "";') : (e += ", buffer = " + (i ? "" : this.initializeBuffer()), o ? (o.prepend("return buffer + "), s.add(";")) : this.source.push("return buffer;")), e && this.source.prepend("var " + e.substring(2) + (i ? "" : ";\n")), this.source.merge()
                    },
                    blockValue: function(e) {
                        var t = this.aliasable("helpers.blockHelperMissing"),
                            n = [this.contextName(0)];
                        this.setupHelperArgs(e, 0, n);
                        var i = this.popStack();
                        n.splice(1, 0, i), this.push(this.source.functionCall(t, "call", n))
                    },
                    ambiguousBlockValue: function() {
                        var e = this.aliasable("helpers.blockHelperMissing"),
                            t = [this.contextName(0)];
                        this.setupHelperArgs("", 0, t, !0), this.flushInline();
                        var n = this.topStack();
                        t.splice(1, 0, n), this.pushSource(["if (!", this.lastHelper, ") { ", n, " = ", this.source.functionCall(e, "call", t), "}"])
                    },
                    appendContent: function(e) { this.pendingContent ? e = this.pendingContent + e : this.pendingLocation = this.source.currentLocation, this.pendingContent = e },
                    append: function() {
                        if (this.isInline()) this.replaceStack(function(e) { return [" != null ? ", e, ' : ""'] }), this.pushSource(this.appendToBuffer(this.popStack()));
                        else {
                            var e = this.popStack();
                            this.pushSource(["if (", e, " != null) { ", this.appendToBuffer(e, void 0, !0), " }"]), this.environment.isSimple && this.pushSource(["else { ", this.appendToBuffer("''", void 0, !0), " }"])
                        }
                    },
                    appendEscaped: function() { this.pushSource(this.appendToBuffer([this.aliasable("container.escapeExpression"), "(", this.popStack(), ")"])) },
                    getContext: function(e) { this.lastContext = e },
                    pushContext: function() { this.pushStackLiteral(this.contextName(this.lastContext)) },
                    lookupOnContext: function(e, t, n, i) {
                        var r = 0;
                        i || !this.options.compat || this.lastContext ? this.pushContext() : this.push(this.depthedLookup(e[r++])), this.resolvePath("context", e, r, t, n)
                    },
                    lookupBlockParam: function(e, t) { this.useBlockParams = !0, this.push(["blockParams[", e[0], "][", e[1], "]"]), this.resolvePath("context", t, 1) },
                    lookupData: function(e, t, n) { e ? this.pushStackLiteral("container.data(data, " + e + ")") : this.pushStackLiteral("data"), this.resolvePath("data", t, 0, !0, n) },
                    resolvePath: function(e, t, n, i, r) { var s = this; if (this.options.strict || this.options.assumeObjects) return void this.push(o(this.options.strict && r, this, t, e)); for (var a = t.length; a > n; n++) this.replaceStack(function(r) { var o = s.nameLookup(r, t[n], e); return i ? [" && ", o] : [" != null ? ", o, " : ", r] }) },
                    resolvePossibleLambda: function() { this.push([this.aliasable("container.lambda"), "(", this.popStack(), ", ", this.contextName(0), ")"]) },
                    pushStringParam: function(e, t) { this.pushContext(), this.pushString(t), "SubExpression" !== t && ("string" == typeof e ? this.pushString(e) : this.pushStackLiteral(e)) },
                    emptyHash: function(e) { this.trackIds && this.push("{}"), this.stringParams && (this.push("{}"), this.push("{}")), this.pushStackLiteral(e ? "undefined" : "{}") },
                    pushHash: function() { this.hash && this.hashes.push(this.hash), this.hash = { values: [], types: [], contexts: [], ids: [] } },
                    popHash: function() {
                        var e = this.hash;
                        this.hash = this.hashes.pop(), this.trackIds && this.push(this.objectLiteral(e.ids)), this.stringParams && (this.push(this.objectLiteral(e.contexts)), this.push(this.objectLiteral(e.types))), this.push(this.objectLiteral(e.values))
                    },
                    pushString: function(e) { this.pushStackLiteral(this.quotedString(e)) },
                    pushLiteral: function(e) { this.pushStackLiteral(e) },
                    pushProgram: function(e) { null != e ? this.pushStackLiteral(this.programExpression(e)) : this.pushStackLiteral(null) },
                    registerDecorator: function(e, t) {
                        var n = this.nameLookup("decorators", t, "decorator"),
                            i = this.setupHelperArgs(t, e);
                        this.decorators.push(["fn = ", this.decorators.functionCall(n, "", ["fn", "props", "container", i]), " || fn;"])
                    },
                    invokeHelper: function(e, t, n) {
                        var i = this.popStack(),
                            r = this.setupHelper(e, t),
                            o = n ? [r.name, " || "] : "",
                            s = ["("].concat(o, i);
                        this.options.strict || s.push(" || ", this.aliasable("helpers.helperMissing")), s.push(")"), this.push(this.source.functionCall(s, "call", r.callParams))
                    },
                    invokeKnownHelper: function(e, t) {
                        var n = this.setupHelper(e, t);
                        this.push(this.source.functionCall(n.name, "call", n.callParams))
                    },
                    invokeAmbiguous: function(e, t) {
                        this.useRegister("helper");
                        var n = this.popStack();
                        this.emptyHash();
                        var i = this.setupHelper(0, e, t),
                            r = this.lastHelper = this.nameLookup("helpers", e, "helper"),
                            o = ["(", "(helper = ", r, " || ", n, ")"];
                        this.options.strict || (o[0] = "(helper = ", o.push(" != null ? helper : ", this.aliasable("helpers.helperMissing"))), this.push(["(", o, i.paramsInit ? ["),(", i.paramsInit] : [], "),", "(typeof helper === ", this.aliasable('"function"'), " ? ", this.source.functionCall("helper", "call", i.callParams), " : helper))"])
                    },
                    invokePartial: function(e, t, n) {
                        var i = [],
                            r = this.setupParams(t, 1, i);
                        e && (t = this.popStack(), delete r.name), n && (r.indent = JSON.stringify(n)), r.helpers = "helpers", r.partials = "partials", r.decorators = "container.decorators", e ? i.unshift(t) : i.unshift(this.nameLookup("partials", t, "partial")), this.options.compat && (r.depths = "depths"), r = this.objectLiteral(r), i.push(r), this.push(this.source.functionCall("container.invokePartial", "", i))
                    },
                    assignToHash: function(e) {
                        var t = this.popStack(),
                            n = void 0,
                            i = void 0,
                            r = void 0;
                        this.trackIds && (r = this.popStack()), this.stringParams && (i = this.popStack(), n = this.popStack());
                        var o = this.hash;
                        n && (o.contexts[e] = n), i && (o.types[e] = i), r && (o.ids[e] = r), o.values[e] = t
                    },
                    pushId: function(e, t, n) { "BlockParam" === e ? this.pushStackLiteral("blockParams[" + t[0] + "].path[" + t[1] + "]" + (n ? " + " + JSON.stringify("." + n) : "")) : "PathExpression" === e ? this.pushString(t) : "SubExpression" === e ? this.pushStackLiteral("true") : this.pushStackLiteral("null") },
                    compiler: r,
                    compileChildren: function(e, t) {
                        for (var n = e.children, i = void 0, r = void 0, o = 0, s = n.length; s > o; o++) {
                            i = n[o], r = new this.compiler;
                            var a = this.matchExistingProgram(i);
                            null == a ? (this.context.programs.push(""), a = this.context.programs.length, i.index = a, i.name = "program" + a, this.context.programs[a] = r.compile(i, t, this.context, !this.precompile), this.context.decorators[a] = r.decorators, this.context.environments[a] = i, this.useDepths = this.useDepths || r.useDepths, this.useBlockParams = this.useBlockParams || r.useBlockParams) : (i.index = a, i.name = "program" + a, this.useDepths = this.useDepths || i.useDepths, this.useBlockParams = this.useBlockParams || i.useBlockParams)
                        }
                    },
                    matchExistingProgram: function(e) { for (var t = 0, n = this.context.environments.length; n > t; t++) { var i = this.context.environments[t]; if (i && i.equals(e)) return t } },
                    programExpression: function(e) {
                        var t = this.environment.children[e],
                            n = [t.index, "data", t.blockParams];
                        return (this.useBlockParams || this.useDepths) && n.push("blockParams"), this.useDepths && n.push("depths"), "container.program(" + n.join(", ") + ")"
                    },
                    useRegister: function(e) { this.registers[e] || (this.registers[e] = !0, this.registers.list.push(e)) },
                    push: function(e) { return e instanceof i || (e = this.source.wrap(e)), this.inlineStack.push(e), e },
                    pushStackLiteral: function(e) { this.push(new i(e)) },
                    pushSource: function(e) { this.pendingContent && (this.source.push(this.appendToBuffer(this.source.quotedString(this.pendingContent), this.pendingLocation)), this.pendingContent = void 0), e && this.source.push(e) },
                    replaceStack: function(e) {
                        var t = ["("],
                            n = void 0,
                            r = void 0,
                            o = void 0;
                        if (!this.isInline()) throw new c.default("replaceStack on non-inline");
                        var s = this.popStack(!0);
                        if (s instanceof i) n = [s.value], t = ["(", n], o = !0;
                        else {
                            r = !0;
                            var a = this.incrStack();
                            t = ["((", this.push(a), " = ", s, ")"], n = this.topStack()
                        }
                        var l = e.call(this, n);
                        o || this.popStack(), r && this.stackSlot--, this.push(t.concat(l, ")"))
                    },
                    incrStack: function() { return this.stackSlot++, this.stackSlot > this.stackVars.length && this.stackVars.push("stack" + this.stackSlot), this.topStackName() },
                    topStackName: function() { return "stack" + this.stackSlot },
                    flushInline: function() {
                        var e = this.inlineStack;
                        this.inlineStack = [];
                        for (var t = 0, n = e.length; n > t; t++) {
                            var r = e[t];
                            if (r instanceof i) this.compileStack.push(r);
                            else {
                                var o = this.incrStack();
                                this.pushSource([o, " = ", r, ";"]), this.compileStack.push(o)
                            }
                        }
                    },
                    isInline: function() { return this.inlineStack.length },
                    popStack: function(e) {
                        var t = this.isInline(),
                            n = (t ? this.inlineStack : this.compileStack).pop();
                        if (!e && n instanceof i) return n.value;
                        if (!t) {
                            if (!this.stackSlot) throw new c.default("Invalid stack pop");
                            this.stackSlot--
                        }
                        return n
                    },
                    topStack: function() {
                        var e = this.isInline() ? this.inlineStack : this.compileStack,
                            t = e[e.length - 1];
                        return t instanceof i ? t.value : t
                    },
                    contextName: function(e) { return this.useDepths && e ? "depths[" + e + "]" : "depth" + e },
                    quotedString: function(e) { return this.source.quotedString(e) },
                    objectLiteral: function(e) { return this.source.objectLiteral(e) },
                    aliasable: function(e) { var t = this.aliases[e]; return t ? (t.referenceCount++, t) : (t = this.aliases[e] = this.source.wrap(e), t.aliasable = !0, t.referenceCount = 1, t) },
                    setupHelper: function(e, t, n) {
                        var i = [],
                            r = this.setupHelperArgs(t, e, i, n),
                            o = this.nameLookup("helpers", t, "helper"),
                            s = this.aliasable(this.contextName(0) + " != null ? " + this.contextName(0) + " : {}");
                        return { params: i, paramsInit: r, name: o, callParams: [s].concat(i) }
                    },
                    setupParams: function(e, t, n) {
                        var i = {},
                            r = [],
                            o = [],
                            s = [],
                            a = !n,
                            l = void 0;
                        a && (n = []), i.name = this.quotedString(e), i.hash = this.popStack(), this.trackIds && (i.hashIds = this.popStack()), this.stringParams && (i.hashTypes = this.popStack(), i.hashContexts = this.popStack());
                        var c = this.popStack(),
                            u = this.popStack();
                        (u || c) && (i.fn = u || "container.noop", i.inverse = c || "container.noop");
                        for (var p = t; p--;) l = this.popStack(), n[p] = l, this.trackIds && (s[p] = this.popStack()), this.stringParams && (o[p] = this.popStack(), r[p] = this.popStack());
                        return a && (i.args = this.source.generateArray(n)), this.trackIds && (i.ids = this.source.generateArray(s)), this.stringParams && (i.types = this.source.generateArray(o), i.contexts = this.source.generateArray(r)), this.options.data && (i.data = "data"), this.useBlockParams && (i.blockParams = "blockParams"), i
                    },
                    setupHelperArgs: function(e, t, n, i) { var r = this.setupParams(e, t, n); return r = this.objectLiteral(r), i ? (this.useRegister("options"), n.push("options"), ["options=", r]) : n ? (n.push(r), "") : r }
                },
                function() { for (var e = "break else new var case finally return void catch for switch while continue function this with default if throw delete in try do instanceof typeof abstract enum int short boolean export interface static byte extends long super char final native synchronized class float package throws const goto private transient debugger implements protected volatile double import public let yield await null true false".split(" "), t = r.RESERVED_WORDS = {}, n = 0, i = e.length; i > n; n++) t[e[n]] = !0 }(), r.isValidJavaScriptVariableName = function(e) { return !r.RESERVED_WORDS[e] && /^[a-zA-Z_$][0-9a-zA-Z_$]*$/.test(e) }, t.default = r, e.exports = t.default
        }, function(e, t, n) {
            "use strict";

            function i() { this.parents = [] }

            function r(e) { this.acceptRequired(e, "path"), this.acceptArray(e.params), this.acceptKey(e, "hash") }

            function o(e) { r.call(this, e), this.acceptKey(e, "program"), this.acceptKey(e, "inverse") }

            function s(e) { this.acceptRequired(e, "name"), this.acceptArray(e.params), this.acceptKey(e, "hash") }
            var a = n(8).default;
            t.__esModule = !0;
            var l = n(12),
                c = a(l);
            i.prototype = {
                constructor: i,
                mutating: !1,
                acceptKey: function(e, t) {
                    var n = this.accept(e[t]);
                    if (this.mutating) {
                        if (n && !i.prototype[n.type]) throw new c.default('Unexpected node type "' + n.type + '" found when accepting ' + t + " on " + e.type);
                        e[t] = n
                    }
                },
                acceptRequired: function(e, t) { if (this.acceptKey(e, t), !e[t]) throw new c.default(e.type + " requires " + t) },
                acceptArray: function(e) { for (var t = 0, n = e.length; n > t; t++) this.acceptKey(e, t), e[t] || (e.splice(t, 1), t--, n--) },
                accept: function(e) {
                    if (e) {
                        if (!this[e.type]) throw new c.default("Unknown type: " + e.type, e);
                        this.current && this.parents.unshift(this.current), this.current = e;
                        var t = this[e.type](e);
                        return this.current = this.parents.shift(), !this.mutating || t ? t : t !== !1 ? e : void 0
                    }
                },
                Program: function(e) { this.acceptArray(e.body) },
                MustacheStatement: r,
                Decorator: r,
                BlockStatement: o,
                DecoratorBlock: o,
                PartialStatement: s,
                PartialBlockStatement: function(e) { s.call(this, e), this.acceptKey(e, "program") },
                ContentStatement: function() {},
                CommentStatement: function() {},
                SubExpression: r,
                PathExpression: function() {},
                StringLiteral: function() {},
                NumberLiteral: function() {},
                BooleanLiteral: function() {},
                UndefinedLiteral: function() {},
                NullLiteral: function() {},
                Hash: function(e) { this.acceptArray(e.pairs) },
                HashPair: function(e) { this.acceptRequired(e, "value") }
            }, t.default = i, e.exports = t.default
        }, function(e, t, n) {
            (function(n) {
                "use strict";
                t.__esModule = !0, t.default = function(e) {
                    var t = "undefined" != typeof n ? n : window,
                        i = t.Handlebars;
                    e.noConflict = function() { t.Handlebars === e && (t.Handlebars = i) }
                }, e.exports = t.default
            }).call(t, function() { return this }())
        }, function(e, t, n) {
            "use strict";
            t.default = function(e) { return e && e.__esModule ? e : { default: e } }, t.__esModule = !0
        }, function(e, t, n) {
            "use strict";
            t.default = function(e) {
                if (e && e.__esModule) return e;
                var t = {};
                if (null != e)
                    for (var n in e) Object.prototype.hasOwnProperty.call(e, n) && (t[n] = e[n]);
                return t.default = e, t
            }, t.__esModule = !0
        }, function(e, t, n) {
            "use strict";

            function i(e, t, n) { this.helpers = e || {}, this.partials = t || {}, this.decorators = n || {}, l.registerDefaultHelpers(this), c.registerDefaultDecorators(this) }
            var r = n(8).default;
            t.__esModule = !0, t.HandlebarsEnvironment = i;
            var o = n(13),
                s = n(12),
                a = r(s),
                l = n(19),
                c = n(20),
                u = n(21),
                p = r(u),
                d = "4.0.3";
            t.VERSION = d;
            var h = 7;
            t.COMPILER_REVISION = h;
            var f = { 1: "<= 1.0.rc.2", 2: "== 1.0.0-rc.3", 3: "== 1.0.0-rc.4", 4: "== 1.x.x", 5: "== 2.0.0-alpha.x", 6: ">= 2.0.0-beta.1", 7: ">= 4.0.0" };
            t.REVISION_CHANGES = f;
            var v = "[object Object]";
            i.prototype = {
                constructor: i,
                logger: p.default,
                log: p.default.log,
                registerHelper: function(e, t) {
                    if (o.toString.call(e) === v) {
                        if (t) throw new a.default("Arg not supported with multiple helpers");
                        o.extend(this.helpers, e)
                    } else this.helpers[e] = t
                },
                unregisterHelper: function(e) { delete this.helpers[e] },
                registerPartial: function(e, t) {
                    if (o.toString.call(e) === v) o.extend(this.partials, e);
                    else {
                        if ("undefined" == typeof t) throw new a.default("Attempting to register a partial as undefined");
                        this.partials[e] = t
                    }
                },
                unregisterPartial: function(e) { delete this.partials[e] },
                registerDecorator: function(e, t) {
                    if (o.toString.call(e) === v) {
                        if (t) throw new a.default("Arg not supported with multiple decorators");
                        o.extend(this.decorators, e)
                    } else this.decorators[e] = t
                },
                unregisterDecorator: function(e) { delete this.decorators[e] }
            };
            var g = p.default.log;
            t.log = g, t.createFrame = o.createFrame, t.logger = p.default
        }, function(e, t, n) {
            "use strict";

            function i(e) { this.string = e }
            t.__esModule = !0, i.prototype.toString = i.prototype.toHTML = function() { return "" + this.string }, t.default = i, e.exports = t.default
        }, function(e, t, n) {
            "use strict";

            function i(e, t) {
                var n = t && t.loc,
                    o = void 0,
                    s = void 0;
                n && (o = n.start.line, s = n.start.column, e += " - " + o + ":" + s);
                for (var a = Error.prototype.constructor.call(this, e), l = 0; l < r.length; l++) this[r[l]] = a[r[l]];
                Error.captureStackTrace && Error.captureStackTrace(this, i), n && (this.lineNumber = o, this.column = s)
            }
            t.__esModule = !0;
            var r = ["description", "fileName", "lineNumber", "message", "name", "number", "stack"];
            i.prototype = new Error, t.default = i, e.exports = t.default
        }, function(e, t, n) {
            "use strict";

            function i(e) { return p[e] }

            function r(e) {
                for (var t = 1; t < arguments.length; t++)
                    for (var n in arguments[t]) Object.prototype.hasOwnProperty.call(arguments[t], n) && (e[n] = arguments[t][n]);
                return e
            }

            function o(e, t) {
                for (var n = 0, i = e.length; i > n; n++)
                    if (e[n] === t) return n;
                return -1
            }

            function s(e) {
                if ("string" != typeof e) {
                    if (e && e.toHTML) return e.toHTML();
                    if (null == e) return "";
                    if (!e) return e + "";
                    e = "" + e
                }
                return h.test(e) ? e.replace(d, i) : e
            }

            function a(e) { return !e && 0 !== e || !(!g(e) || 0 !== e.length) }

            function l(e) { var t = r({}, e); return t._parent = e, t }

            function c(e, t) { return e.path = t, e }

            function u(e, t) { return (e ? e + "." : "") + t }
            t.__esModule = !0, t.extend = r, t.indexOf = o, t.escapeExpression = s, t.isEmpty = a, t.createFrame = l, t.blockParams = c, t.appendContextPath = u;
            var p = { "&": "&amp;", "<": "&lt;", ">": "&gt;", '"': "&quot;", "'": "&#x27;", "`": "&#x60;", "=": "&#x3D;" },
                d = /[&<>"'`=]/g,
                h = /[&<>"'`=]/,
                f = Object.prototype.toString;
            t.toString = f;
            var v = function(e) { return "function" == typeof e };
            v(/x/) && (t.isFunction = v = function(e) { return "function" == typeof e && "[object Function]" === f.call(e) }), t.isFunction = v;
            var g = Array.isArray || function(e) { return !(!e || "object" != typeof e) && "[object Array]" === f.call(e) };
            t.isArray = g
        }, function(e, t, n) {
            "use strict";

            function i(e) {
                var t = e && e[0] || 1,
                    n = m.COMPILER_REVISION;
                if (t !== n) {
                    if (n > t) {
                        var i = m.REVISION_CHANGES[n],
                            r = m.REVISION_CHANGES[t];
                        throw new g.default("Template was precompiled with an older version of Handlebars than the current runtime. Please update your precompiler to a newer version (" + i + ") or downgrade your runtime to an older version (" + r + ").")
                    }
                    throw new g.default("Template was precompiled with a newer version of Handlebars than the current runtime. Please update your runtime to a newer version (" + e[1] + ").")
                }
            }

            function r(e, t) {
                function n(n, i, r) {
                    r.hash && (i = f.extend({}, i, r.hash), r.ids && (r.ids[0] = !0)), n = t.VM.resolvePartial.call(this, n, i, r);
                    var o = t.VM.invokePartial.call(this, n, i, r);
                    if (null == o && t.compile && (r.partials[r.name] = t.compile(n, e.compilerOptions, t), o = r.partials[r.name](i, r)), null != o) {
                        if (r.indent) {
                            for (var s = o.split("\n"), a = 0, l = s.length; l > a && (s[a] || a + 1 !== l); a++) s[a] = r.indent + s[a];
                            o = s.join("\n")
                        }
                        return o
                    }
                    throw new g.default("The partial " + r.name + " could not be compiled when running in runtime-only mode")
                }

                function i(t) {
                    function n(t) { return "" + e.main(r, t, r.helpers, r.partials, s, l, a) }
                    var o = arguments.length <= 1 || void 0 === arguments[1] ? {} : arguments[1],
                        s = o.data;
                    i._setup(o), !o.partial && e.useData && (s = c(t, s));
                    var a = void 0,
                        l = e.useBlockParams ? [] : void 0;
                    return e.useDepths && (a = o.depths ? t !== o.depths[0] ? [t].concat(o.depths) : o.depths : [t]), (n = u(e.main, n, r, o.depths || [], s, l))(t, o)
                }
                if (!t) throw new g.default("No environment passed to template");
                if (!e || !e.main) throw new g.default("Unknown template object: " + typeof e);
                e.main.decorator = e.main_d, t.VM.checkRevision(e.compiler);
                var r = {
                    strict: function(e, t) { if (!(t in e)) throw new g.default('"' + t + '" not defined in ' + e); return e[t] },
                    lookup: function(e, t) {
                        for (var n = e.length, i = 0; n > i; i++)
                            if (e[i] && null != e[i][t]) return e[i][t]
                    },
                    lambda: function(e, t) { return "function" == typeof e ? e.call(t) : e },
                    escapeExpression: f.escapeExpression,
                    invokePartial: n,
                    fn: function(t) { var n = e[t]; return n.decorator = e[t + "_d"], n },
                    programs: [],
                    program: function(e, t, n, i, r) {
                        var s = this.programs[e],
                            a = this.fn(e);
                        return t || r || i || n ? s = o(this, e, a, t, n, i, r) : s || (s = this.programs[e] = o(this, e, a)), s
                    },
                    data: function(e, t) { for (; e && t--;) e = e._parent; return e },
                    merge: function(e, t) { var n = e || t; return e && t && e !== t && (n = f.extend({}, t, e)), n },
                    noop: t.VM.noop,
                    compilerInfo: e.compiler
                };
                return i.isTop = !0, i._setup = function(n) {
                    n.partial ? (r.helpers = n.helpers, r.partials = n.partials, r.decorators = n.decorators) : (r.helpers = r.merge(n.helpers, t.helpers),
                        e.usePartial && (r.partials = r.merge(n.partials, t.partials)), (e.usePartial || e.useDecorators) && (r.decorators = r.merge(n.decorators, t.decorators)))
                }, i._child = function(t, n, i, s) { if (e.useBlockParams && !i) throw new g.default("must pass block params"); if (e.useDepths && !s) throw new g.default("must pass parent depths"); return o(r, t, e[t], n, 0, i, s) }, i
            }

            function o(e, t, n, i, r, o, s) {
                function a(t) {
                    var r = arguments.length <= 1 || void 0 === arguments[1] ? {} : arguments[1],
                        a = s;
                    return s && t !== s[0] && (a = [t].concat(s)), n(e, t, e.helpers, e.partials, r.data || i, o && [r.blockParams].concat(o), a)
                }
                return a = u(n, a, e, s, i, o), a.program = t, a.depth = s ? s.length : 0, a.blockParams = r || 0, a
            }

            function s(e, t, n) { return e ? e.call || n.name || (n.name = e, e = n.partials[e]) : e = "@partial-block" === n.name ? n.data["partial-block"] : n.partials[n.name], e }

            function a(e, t, n) { n.partial = !0, n.ids && (n.data.contextPath = n.ids[0] || n.data.contextPath); var i = void 0; if (n.fn && n.fn !== l && (n.data = m.createFrame(n.data), i = n.data["partial-block"] = n.fn, i.partials && (n.partials = f.extend({}, n.partials, i.partials))), void 0 === e && i && (e = i), void 0 === e) throw new g.default("The partial " + n.name + " could not be found"); return e instanceof Function ? e(t, n) : void 0 }

            function l() { return "" }

            function c(e, t) { return t && "root" in t || (t = t ? m.createFrame(t) : {}, t.root = e), t }

            function u(e, t, n, i, r, o) {
                if (e.decorator) {
                    var s = {};
                    t = e.decorator(t, s, n, i && i[0], r, o, i), f.extend(t, s)
                }
                return t
            }
            var p = n(9).default,
                d = n(8).default;
            t.__esModule = !0, t.checkRevision = i, t.template = r, t.wrapProgram = o, t.resolvePartial = s, t.invokePartial = a, t.noop = l;
            var h = n(13),
                f = p(h),
                v = n(12),
                g = d(v),
                m = n(10)
        }, function(e, t, n) {
            "use strict";
            var i = function() {
                function e() { this.yy = {} }
                var t = {
                        trace: function() {},
                        yy: {},
                        symbols_: { error: 2, root: 3, program: 4, EOF: 5, program_repetition0: 6, statement: 7, mustache: 8, block: 9, rawBlock: 10, partial: 11, partialBlock: 12, content: 13, COMMENT: 14, CONTENT: 15, openRawBlock: 16, rawBlock_repetition_plus0: 17, END_RAW_BLOCK: 18, OPEN_RAW_BLOCK: 19, helperName: 20, openRawBlock_repetition0: 21, openRawBlock_option0: 22, CLOSE_RAW_BLOCK: 23, openBlock: 24, block_option0: 25, closeBlock: 26, openInverse: 27, block_option1: 28, OPEN_BLOCK: 29, openBlock_repetition0: 30, openBlock_option0: 31, openBlock_option1: 32, CLOSE: 33, OPEN_INVERSE: 34, openInverse_repetition0: 35, openInverse_option0: 36, openInverse_option1: 37, openInverseChain: 38, OPEN_INVERSE_CHAIN: 39, openInverseChain_repetition0: 40, openInverseChain_option0: 41, openInverseChain_option1: 42, inverseAndProgram: 43, INVERSE: 44, inverseChain: 45, inverseChain_option0: 46, OPEN_ENDBLOCK: 47, OPEN: 48, mustache_repetition0: 49, mustache_option0: 50, OPEN_UNESCAPED: 51, mustache_repetition1: 52, mustache_option1: 53, CLOSE_UNESCAPED: 54, OPEN_PARTIAL: 55, partialName: 56, partial_repetition0: 57, partial_option0: 58, openPartialBlock: 59, OPEN_PARTIAL_BLOCK: 60, openPartialBlock_repetition0: 61, openPartialBlock_option0: 62, param: 63, sexpr: 64, OPEN_SEXPR: 65, sexpr_repetition0: 66, sexpr_option0: 67, CLOSE_SEXPR: 68, hash: 69, hash_repetition_plus0: 70, hashSegment: 71, ID: 72, EQUALS: 73, blockParams: 74, OPEN_BLOCK_PARAMS: 75, blockParams_repetition_plus0: 76, CLOSE_BLOCK_PARAMS: 77, path: 78, dataName: 79, STRING: 80, NUMBER: 81, BOOLEAN: 82, UNDEFINED: 83, NULL: 84, DATA: 85, pathSegments: 86, SEP: 87, $accept: 0, $end: 1 },
                        terminals_: { 2: "error", 5: "EOF", 14: "COMMENT", 15: "CONTENT", 18: "END_RAW_BLOCK", 19: "OPEN_RAW_BLOCK", 23: "CLOSE_RAW_BLOCK", 29: "OPEN_BLOCK", 33: "CLOSE", 34: "OPEN_INVERSE", 39: "OPEN_INVERSE_CHAIN", 44: "INVERSE", 47: "OPEN_ENDBLOCK", 48: "OPEN", 51: "OPEN_UNESCAPED", 54: "CLOSE_UNESCAPED", 55: "OPEN_PARTIAL", 60: "OPEN_PARTIAL_BLOCK", 65: "OPEN_SEXPR", 68: "CLOSE_SEXPR", 72: "ID", 73: "EQUALS", 75: "OPEN_BLOCK_PARAMS", 77: "CLOSE_BLOCK_PARAMS", 80: "STRING", 81: "NUMBER", 82: "BOOLEAN", 83: "UNDEFINED", 84: "NULL", 85: "DATA", 87: "SEP" },
                        productions_: [0, [3, 2],
                            [4, 1],
                            [7, 1],
                            [7, 1],
                            [7, 1],
                            [7, 1],
                            [7, 1],
                            [7, 1],
                            [7, 1],
                            [13, 1],
                            [10, 3],
                            [16, 5],
                            [9, 4],
                            [9, 4],
                            [24, 6],
                            [27, 6],
                            [38, 6],
                            [43, 2],
                            [45, 3],
                            [45, 1],
                            [26, 3],
                            [8, 5],
                            [8, 5],
                            [11, 5],
                            [12, 3],
                            [59, 5],
                            [63, 1],
                            [63, 1],
                            [64, 5],
                            [69, 1],
                            [71, 3],
                            [74, 3],
                            [20, 1],
                            [20, 1],
                            [20, 1],
                            [20, 1],
                            [20, 1],
                            [20, 1],
                            [20, 1],
                            [56, 1],
                            [56, 1],
                            [79, 2],
                            [78, 1],
                            [86, 3],
                            [86, 1],
                            [6, 0],
                            [6, 2],
                            [17, 1],
                            [17, 2],
                            [21, 0],
                            [21, 2],
                            [22, 0],
                            [22, 1],
                            [25, 0],
                            [25, 1],
                            [28, 0],
                            [28, 1],
                            [30, 0],
                            [30, 2],
                            [31, 0],
                            [31, 1],
                            [32, 0],
                            [32, 1],
                            [35, 0],
                            [35, 2],
                            [36, 0],
                            [36, 1],
                            [37, 0],
                            [37, 1],
                            [40, 0],
                            [40, 2],
                            [41, 0],
                            [41, 1],
                            [42, 0],
                            [42, 1],
                            [46, 0],
                            [46, 1],
                            [49, 0],
                            [49, 2],
                            [50, 0],
                            [50, 1],
                            [52, 0],
                            [52, 2],
                            [53, 0],
                            [53, 1],
                            [57, 0],
                            [57, 2],
                            [58, 0],
                            [58, 1],
                            [61, 0],
                            [61, 2],
                            [62, 0],
                            [62, 1],
                            [66, 0],
                            [66, 2],
                            [67, 0],
                            [67, 1],
                            [70, 1],
                            [70, 2],
                            [76, 1],
                            [76, 2]
                        ],
                        performAction: function(e, t, n, i, r, o, s) {
                            var a = o.length - 1;
                            switch (r) {
                                case 1:
                                    return o[a - 1];
                                case 2:
                                    this.$ = i.prepareProgram(o[a]);
                                    break;
                                case 3:
                                    this.$ = o[a];
                                    break;
                                case 4:
                                    this.$ = o[a];
                                    break;
                                case 5:
                                    this.$ = o[a];
                                    break;
                                case 6:
                                    this.$ = o[a];
                                    break;
                                case 7:
                                    this.$ = o[a];
                                    break;
                                case 8:
                                    this.$ = o[a];
                                    break;
                                case 9:
                                    this.$ = { type: "CommentStatement", value: i.stripComment(o[a]), strip: i.stripFlags(o[a], o[a]), loc: i.locInfo(this._$) };
                                    break;
                                case 10:
                                    this.$ = { type: "ContentStatement", original: o[a], value: o[a], loc: i.locInfo(this._$) };
                                    break;
                                case 11:
                                    this.$ = i.prepareRawBlock(o[a - 2], o[a - 1], o[a], this._$);
                                    break;
                                case 12:
                                    this.$ = { path: o[a - 3], params: o[a - 2], hash: o[a - 1] };
                                    break;
                                case 13:
                                    this.$ = i.prepareBlock(o[a - 3], o[a - 2], o[a - 1], o[a], !1, this._$);
                                    break;
                                case 14:
                                    this.$ = i.prepareBlock(o[a - 3], o[a - 2], o[a - 1], o[a], !0, this._$);
                                    break;
                                case 15:
                                    this.$ = { open: o[a - 5], path: o[a - 4], params: o[a - 3], hash: o[a - 2], blockParams: o[a - 1], strip: i.stripFlags(o[a - 5], o[a]) };
                                    break;
                                case 16:
                                    this.$ = { path: o[a - 4], params: o[a - 3], hash: o[a - 2], blockParams: o[a - 1], strip: i.stripFlags(o[a - 5], o[a]) };
                                    break;
                                case 17:
                                    this.$ = { path: o[a - 4], params: o[a - 3], hash: o[a - 2], blockParams: o[a - 1], strip: i.stripFlags(o[a - 5], o[a]) };
                                    break;
                                case 18:
                                    this.$ = { strip: i.stripFlags(o[a - 1], o[a - 1]), program: o[a] };
                                    break;
                                case 19:
                                    var l = i.prepareBlock(o[a - 2], o[a - 1], o[a], o[a], !1, this._$),
                                        c = i.prepareProgram([l], o[a - 1].loc);
                                    c.chained = !0, this.$ = { strip: o[a - 2].strip, program: c, chain: !0 };
                                    break;
                                case 20:
                                    this.$ = o[a];
                                    break;
                                case 21:
                                    this.$ = { path: o[a - 1], strip: i.stripFlags(o[a - 2], o[a]) };
                                    break;
                                case 22:
                                    this.$ = i.prepareMustache(o[a - 3], o[a - 2], o[a - 1], o[a - 4], i.stripFlags(o[a - 4], o[a]), this._$);
                                    break;
                                case 23:
                                    this.$ = i.prepareMustache(o[a - 3], o[a - 2], o[a - 1], o[a - 4], i.stripFlags(o[a - 4], o[a]), this._$);
                                    break;
                                case 24:
                                    this.$ = { type: "PartialStatement", name: o[a - 3], params: o[a - 2], hash: o[a - 1], indent: "", strip: i.stripFlags(o[a - 4], o[a]), loc: i.locInfo(this._$) };
                                    break;
                                case 25:
                                    this.$ = i.preparePartialBlock(o[a - 2], o[a - 1], o[a], this._$);
                                    break;
                                case 26:
                                    this.$ = { path: o[a - 3], params: o[a - 2], hash: o[a - 1], strip: i.stripFlags(o[a - 4], o[a]) };
                                    break;
                                case 27:
                                    this.$ = o[a];
                                    break;
                                case 28:
                                    this.$ = o[a];
                                    break;
                                case 29:
                                    this.$ = { type: "SubExpression", path: o[a - 3], params: o[a - 2], hash: o[a - 1], loc: i.locInfo(this._$) };
                                    break;
                                case 30:
                                    this.$ = { type: "Hash", pairs: o[a], loc: i.locInfo(this._$) };
                                    break;
                                case 31:
                                    this.$ = { type: "HashPair", key: i.id(o[a - 2]), value: o[a], loc: i.locInfo(this._$) };
                                    break;
                                case 32:
                                    this.$ = i.id(o[a - 1]);
                                    break;
                                case 33:
                                    this.$ = o[a];
                                    break;
                                case 34:
                                    this.$ = o[a];
                                    break;
                                case 35:
                                    this.$ = { type: "StringLiteral", value: o[a], original: o[a], loc: i.locInfo(this._$) };
                                    break;
                                case 36:
                                    this.$ = { type: "NumberLiteral", value: Number(o[a]), original: Number(o[a]), loc: i.locInfo(this._$) };
                                    break;
                                case 37:
                                    this.$ = { type: "BooleanLiteral", value: "true" === o[a], original: "true" === o[a], loc: i.locInfo(this._$) };
                                    break;
                                case 38:
                                    this.$ = { type: "UndefinedLiteral", original: void 0, value: void 0, loc: i.locInfo(this._$) };
                                    break;
                                case 39:
                                    this.$ = { type: "NullLiteral", original: null, value: null, loc: i.locInfo(this._$) };
                                    break;
                                case 40:
                                    this.$ = o[a];
                                    break;
                                case 41:
                                    this.$ = o[a];
                                    break;
                                case 42:
                                    this.$ = i.preparePath(!0, o[a], this._$);
                                    break;
                                case 43:
                                    this.$ = i.preparePath(!1, o[a], this._$);
                                    break;
                                case 44:
                                    o[a - 2].push({ part: i.id(o[a]), original: o[a], separator: o[a - 1] }), this.$ = o[a - 2];
                                    break;
                                case 45:
                                    this.$ = [{ part: i.id(o[a]), original: o[a] }];
                                    break;
                                case 46:
                                    this.$ = [];
                                    break;
                                case 47:
                                    o[a - 1].push(o[a]);
                                    break;
                                case 48:
                                    this.$ = [o[a]];
                                    break;
                                case 49:
                                    o[a - 1].push(o[a]);
                                    break;
                                case 50:
                                    this.$ = [];
                                    break;
                                case 51:
                                    o[a - 1].push(o[a]);
                                    break;
                                case 58:
                                    this.$ = [];
                                    break;
                                case 59:
                                    o[a - 1].push(o[a]);
                                    break;
                                case 64:
                                    this.$ = [];
                                    break;
                                case 65:
                                    o[a - 1].push(o[a]);
                                    break;
                                case 70:
                                    this.$ = [];
                                    break;
                                case 71:
                                    o[a - 1].push(o[a]);
                                    break;
                                case 78:
                                    this.$ = [];
                                    break;
                                case 79:
                                    o[a - 1].push(o[a]);
                                    break;
                                case 82:
                                    this.$ = [];
                                    break;
                                case 83:
                                    o[a - 1].push(o[a]);
                                    break;
                                case 86:
                                    this.$ = [];
                                    break;
                                case 87:
                                    o[a - 1].push(o[a]);
                                    break;
                                case 90:
                                    this.$ = [];
                                    break;
                                case 91:
                                    o[a - 1].push(o[a]);
                                    break;
                                case 94:
                                    this.$ = [];
                                    break;
                                case 95:
                                    o[a - 1].push(o[a]);
                                    break;
                                case 98:
                                    this.$ = [o[a]];
                                    break;
                                case 99:
                                    o[a - 1].push(o[a]);
                                    break;
                                case 100:
                                    this.$ = [o[a]];
                                    break;
                                case 101:
                                    o[a - 1].push(o[a])
                            }
                        },
                        table: [{ 3: 1, 4: 2, 5: [2, 46], 6: 3, 14: [2, 46], 15: [2, 46], 19: [2, 46], 29: [2, 46], 34: [2, 46], 48: [2, 46], 51: [2, 46], 55: [2, 46], 60: [2, 46] }, { 1: [3] }, { 5: [1, 4] }, { 5: [2, 2], 7: 5, 8: 6, 9: 7, 10: 8, 11: 9, 12: 10, 13: 11, 14: [1, 12], 15: [1, 20], 16: 17, 19: [1, 23], 24: 15, 27: 16, 29: [1, 21], 34: [1, 22], 39: [2, 2], 44: [2, 2], 47: [2, 2], 48: [1, 13], 51: [1, 14], 55: [1, 18], 59: 19, 60: [1, 24] }, { 1: [2, 1] }, { 5: [2, 47], 14: [2, 47], 15: [2, 47], 19: [2, 47], 29: [2, 47], 34: [2, 47], 39: [2, 47], 44: [2, 47], 47: [2, 47], 48: [2, 47], 51: [2, 47], 55: [2, 47], 60: [2, 47] }, { 5: [2, 3], 14: [2, 3], 15: [2, 3], 19: [2, 3], 29: [2, 3], 34: [2, 3], 39: [2, 3], 44: [2, 3], 47: [2, 3], 48: [2, 3], 51: [2, 3], 55: [2, 3], 60: [2, 3] }, { 5: [2, 4], 14: [2, 4], 15: [2, 4], 19: [2, 4], 29: [2, 4], 34: [2, 4], 39: [2, 4], 44: [2, 4], 47: [2, 4], 48: [2, 4], 51: [2, 4], 55: [2, 4], 60: [2, 4] }, { 5: [2, 5], 14: [2, 5], 15: [2, 5], 19: [2, 5], 29: [2, 5], 34: [2, 5], 39: [2, 5], 44: [2, 5], 47: [2, 5], 48: [2, 5], 51: [2, 5], 55: [2, 5], 60: [2, 5] }, { 5: [2, 6], 14: [2, 6], 15: [2, 6], 19: [2, 6], 29: [2, 6], 34: [2, 6], 39: [2, 6], 44: [2, 6], 47: [2, 6], 48: [2, 6], 51: [2, 6], 55: [2, 6], 60: [2, 6] }, { 5: [2, 7], 14: [2, 7], 15: [2, 7], 19: [2, 7], 29: [2, 7], 34: [2, 7], 39: [2, 7], 44: [2, 7], 47: [2, 7], 48: [2, 7], 51: [2, 7], 55: [2, 7], 60: [2, 7] }, { 5: [2, 8], 14: [2, 8], 15: [2, 8], 19: [2, 8], 29: [2, 8], 34: [2, 8], 39: [2, 8], 44: [2, 8], 47: [2, 8], 48: [2, 8], 51: [2, 8], 55: [2, 8], 60: [2, 8] }, { 5: [2, 9], 14: [2, 9], 15: [2, 9], 19: [2, 9], 29: [2, 9], 34: [2, 9], 39: [2, 9], 44: [2, 9], 47: [2, 9], 48: [2, 9], 51: [2, 9], 55: [2, 9], 60: [2, 9] }, { 20: 25, 72: [1, 35], 78: 26, 79: 27, 80: [1, 28], 81: [1, 29], 82: [1, 30], 83: [1, 31], 84: [1, 32], 85: [1, 34], 86: 33 }, { 20: 36, 72: [1, 35], 78: 26, 79: 27, 80: [1, 28], 81: [1, 29], 82: [1, 30], 83: [1, 31], 84: [1, 32], 85: [1, 34], 86: 33 }, { 4: 37, 6: 3, 14: [2, 46], 15: [2, 46], 19: [2, 46], 29: [2, 46], 34: [2, 46], 39: [2, 46], 44: [2, 46], 47: [2, 46], 48: [2, 46], 51: [2, 46], 55: [2, 46], 60: [2, 46] }, { 4: 38, 6: 3, 14: [2, 46], 15: [2, 46], 19: [2, 46], 29: [2, 46], 34: [2, 46], 44: [2, 46], 47: [2, 46], 48: [2, 46], 51: [2, 46], 55: [2, 46], 60: [2, 46] }, { 13: 40, 15: [1, 20], 17: 39 }, { 20: 42, 56: 41, 64: 43, 65: [1, 44], 72: [1, 35], 78: 26, 79: 27, 80: [1, 28], 81: [1, 29], 82: [1, 30], 83: [1, 31], 84: [1, 32], 85: [1, 34], 86: 33 }, { 4: 45, 6: 3, 14: [2, 46], 15: [2, 46], 19: [2, 46], 29: [2, 46], 34: [2, 46], 47: [2, 46], 48: [2, 46], 51: [2, 46], 55: [2, 46], 60: [2, 46] }, { 5: [2, 10], 14: [2, 10], 15: [2, 10], 18: [2, 10], 19: [2, 10], 29: [2, 10], 34: [2, 10], 39: [2, 10], 44: [2, 10], 47: [2, 10], 48: [2, 10], 51: [2, 10], 55: [2, 10], 60: [2, 10] }, { 20: 46, 72: [1, 35], 78: 26, 79: 27, 80: [1, 28], 81: [1, 29], 82: [1, 30], 83: [1, 31], 84: [1, 32], 85: [1, 34], 86: 33 }, { 20: 47, 72: [1, 35], 78: 26, 79: 27, 80: [1, 28], 81: [1, 29], 82: [1, 30], 83: [1, 31], 84: [1, 32], 85: [1, 34], 86: 33 }, { 20: 48, 72: [1, 35], 78: 26, 79: 27, 80: [1, 28], 81: [1, 29], 82: [1, 30], 83: [1, 31], 84: [1, 32], 85: [1, 34], 86: 33 }, { 20: 42, 56: 49, 64: 43, 65: [1, 44], 72: [1, 35], 78: 26, 79: 27, 80: [1, 28], 81: [1, 29], 82: [1, 30], 83: [1, 31], 84: [1, 32], 85: [1, 34], 86: 33 }, { 33: [2, 78], 49: 50, 65: [2, 78], 72: [2, 78], 80: [2, 78], 81: [2, 78], 82: [2, 78], 83: [2, 78], 84: [2, 78], 85: [2, 78] }, { 23: [2, 33], 33: [2, 33], 54: [2, 33], 65: [2, 33], 68: [2, 33], 72: [2, 33], 75: [2, 33], 80: [2, 33], 81: [2, 33], 82: [2, 33], 83: [2, 33], 84: [2, 33], 85: [2, 33] }, { 23: [2, 34], 33: [2, 34], 54: [2, 34], 65: [2, 34], 68: [2, 34], 72: [2, 34], 75: [2, 34], 80: [2, 34], 81: [2, 34], 82: [2, 34], 83: [2, 34], 84: [2, 34], 85: [2, 34] }, { 23: [2, 35], 33: [2, 35], 54: [2, 35], 65: [2, 35], 68: [2, 35], 72: [2, 35], 75: [2, 35], 80: [2, 35], 81: [2, 35], 82: [2, 35], 83: [2, 35], 84: [2, 35], 85: [2, 35] }, { 23: [2, 36], 33: [2, 36], 54: [2, 36], 65: [2, 36], 68: [2, 36], 72: [2, 36], 75: [2, 36], 80: [2, 36], 81: [2, 36], 82: [2, 36], 83: [2, 36], 84: [2, 36], 85: [2, 36] }, { 23: [2, 37], 33: [2, 37], 54: [2, 37], 65: [2, 37], 68: [2, 37], 72: [2, 37], 75: [2, 37], 80: [2, 37], 81: [2, 37], 82: [2, 37], 83: [2, 37], 84: [2, 37], 85: [2, 37] }, { 23: [2, 38], 33: [2, 38], 54: [2, 38], 65: [2, 38], 68: [2, 38], 72: [2, 38], 75: [2, 38], 80: [2, 38], 81: [2, 38], 82: [2, 38], 83: [2, 38], 84: [2, 38], 85: [2, 38] }, { 23: [2, 39], 33: [2, 39], 54: [2, 39], 65: [2, 39], 68: [2, 39], 72: [2, 39], 75: [2, 39], 80: [2, 39], 81: [2, 39], 82: [2, 39], 83: [2, 39], 84: [2, 39], 85: [2, 39] }, { 23: [2, 43], 33: [2, 43], 54: [2, 43], 65: [2, 43], 68: [2, 43], 72: [2, 43], 75: [2, 43], 80: [2, 43], 81: [2, 43], 82: [2, 43], 83: [2, 43], 84: [2, 43], 85: [2, 43], 87: [1, 51] }, { 72: [1, 35], 86: 52 }, { 23: [2, 45], 33: [2, 45], 54: [2, 45], 65: [2, 45], 68: [2, 45], 72: [2, 45], 75: [2, 45], 80: [2, 45], 81: [2, 45], 82: [2, 45], 83: [2, 45], 84: [2, 45], 85: [2, 45], 87: [2, 45] }, { 52: 53, 54: [2, 82], 65: [2, 82], 72: [2, 82], 80: [2, 82], 81: [2, 82], 82: [2, 82], 83: [2, 82], 84: [2, 82], 85: [2, 82] }, { 25: 54, 38: 56, 39: [1, 58], 43: 57, 44: [1, 59], 45: 55, 47: [2, 54] }, { 28: 60, 43: 61, 44: [1, 59], 47: [2, 56] }, { 13: 63, 15: [1, 20], 18: [1, 62] }, { 15: [2, 48], 18: [2, 48] }, { 33: [2, 86], 57: 64, 65: [2, 86], 72: [2, 86], 80: [2, 86], 81: [2, 86], 82: [2, 86], 83: [2, 86], 84: [2, 86], 85: [2, 86] }, { 33: [2, 40], 65: [2, 40], 72: [2, 40], 80: [2, 40], 81: [2, 40], 82: [2, 40], 83: [2, 40], 84: [2, 40], 85: [2, 40] }, { 33: [2, 41], 65: [2, 41], 72: [2, 41], 80: [2, 41], 81: [2, 41], 82: [2, 41], 83: [2, 41], 84: [2, 41], 85: [2, 41] }, { 20: 65, 72: [1, 35], 78: 26, 79: 27, 80: [1, 28], 81: [1, 29], 82: [1, 30], 83: [1, 31], 84: [1, 32], 85: [1, 34], 86: 33 }, { 26: 66, 47: [1, 67] }, { 30: 68, 33: [2, 58], 65: [2, 58], 72: [2, 58], 75: [2, 58], 80: [2, 58], 81: [2, 58], 82: [2, 58], 83: [2, 58], 84: [2, 58], 85: [2, 58] }, { 33: [2, 64], 35: 69, 65: [2, 64], 72: [2, 64], 75: [2, 64], 80: [2, 64], 81: [2, 64], 82: [2, 64], 83: [2, 64], 84: [2, 64], 85: [2, 64] }, { 21: 70, 23: [2, 50], 65: [2, 50], 72: [2, 50], 80: [2, 50], 81: [2, 50], 82: [2, 50], 83: [2, 50], 84: [2, 50], 85: [2, 50] }, { 33: [2, 90], 61: 71, 65: [2, 90], 72: [2, 90], 80: [2, 90], 81: [2, 90], 82: [2, 90], 83: [2, 90], 84: [2, 90], 85: [2, 90] }, { 20: 75, 33: [2, 80], 50: 72, 63: 73, 64: 76, 65: [1, 44], 69: 74, 70: 77, 71: 78, 72: [1, 79], 78: 26, 79: 27, 80: [1, 28], 81: [1, 29], 82: [1, 30], 83: [1, 31], 84: [1, 32], 85: [1, 34], 86: 33 }, { 72: [1, 80] }, { 23: [2, 42], 33: [2, 42], 54: [2, 42], 65: [2, 42], 68: [2, 42], 72: [2, 42], 75: [2, 42], 80: [2, 42], 81: [2, 42], 82: [2, 42], 83: [2, 42], 84: [2, 42], 85: [2, 42], 87: [1, 51] }, { 20: 75, 53: 81, 54: [2, 84], 63: 82, 64: 76, 65: [1, 44], 69: 83, 70: 77, 71: 78, 72: [1, 79], 78: 26, 79: 27, 80: [1, 28], 81: [1, 29], 82: [1, 30], 83: [1, 31], 84: [1, 32], 85: [1, 34], 86: 33 }, { 26: 84, 47: [1, 67] }, { 47: [2, 55] }, { 4: 85, 6: 3, 14: [2, 46], 15: [2, 46], 19: [2, 46], 29: [2, 46], 34: [2, 46], 39: [2, 46], 44: [2, 46], 47: [2, 46], 48: [2, 46], 51: [2, 46], 55: [2, 46], 60: [2, 46] }, { 47: [2, 20] }, { 20: 86, 72: [1, 35], 78: 26, 79: 27, 80: [1, 28], 81: [1, 29], 82: [1, 30], 83: [1, 31], 84: [1, 32], 85: [1, 34], 86: 33 }, { 4: 87, 6: 3, 14: [2, 46], 15: [2, 46], 19: [2, 46], 29: [2, 46], 34: [2, 46], 47: [2, 46], 48: [2, 46], 51: [2, 46], 55: [2, 46], 60: [2, 46] }, { 26: 88, 47: [1, 67] }, { 47: [2, 57] }, { 5: [2, 11], 14: [2, 11], 15: [2, 11], 19: [2, 11], 29: [2, 11], 34: [2, 11], 39: [2, 11], 44: [2, 11], 47: [2, 11], 48: [2, 11], 51: [2, 11], 55: [2, 11], 60: [2, 11] }, { 15: [2, 49], 18: [2, 49] }, { 20: 75, 33: [2, 88], 58: 89, 63: 90, 64: 76, 65: [1, 44], 69: 91, 70: 77, 71: 78, 72: [1, 79], 78: 26, 79: 27, 80: [1, 28], 81: [1, 29], 82: [1, 30], 83: [1, 31], 84: [1, 32], 85: [1, 34], 86: 33 }, { 65: [2, 94], 66: 92, 68: [2, 94], 72: [2, 94], 80: [2, 94], 81: [2, 94], 82: [2, 94], 83: [2, 94], 84: [2, 94], 85: [2, 94] }, { 5: [2, 25], 14: [2, 25], 15: [2, 25], 19: [2, 25], 29: [2, 25], 34: [2, 25], 39: [2, 25], 44: [2, 25], 47: [2, 25], 48: [2, 25], 51: [2, 25], 55: [2, 25], 60: [2, 25] }, { 20: 93, 72: [1, 35], 78: 26, 79: 27, 80: [1, 28], 81: [1, 29], 82: [1, 30], 83: [1, 31], 84: [1, 32], 85: [1, 34], 86: 33 }, { 20: 75, 31: 94, 33: [2, 60], 63: 95, 64: 76, 65: [1, 44], 69: 96, 70: 77, 71: 78, 72: [1, 79], 75: [2, 60], 78: 26, 79: 27, 80: [1, 28], 81: [1, 29], 82: [1, 30], 83: [1, 31], 84: [1, 32], 85: [1, 34], 86: 33 }, { 20: 75, 33: [2, 66], 36: 97, 63: 98, 64: 76, 65: [1, 44], 69: 99, 70: 77, 71: 78, 72: [1, 79], 75: [2, 66], 78: 26, 79: 27, 80: [1, 28], 81: [1, 29], 82: [1, 30], 83: [1, 31], 84: [1, 32], 85: [1, 34], 86: 33 }, { 20: 75, 22: 100, 23: [2, 52], 63: 101, 64: 76, 65: [1, 44], 69: 102, 70: 77, 71: 78, 72: [1, 79], 78: 26, 79: 27, 80: [1, 28], 81: [1, 29], 82: [1, 30], 83: [1, 31], 84: [1, 32], 85: [1, 34], 86: 33 }, { 20: 75, 33: [2, 92], 62: 103, 63: 104, 64: 76, 65: [1, 44], 69: 105, 70: 77, 71: 78, 72: [1, 79], 78: 26, 79: 27, 80: [1, 28], 81: [1, 29], 82: [1, 30], 83: [1, 31], 84: [1, 32], 85: [1, 34], 86: 33 }, { 33: [1, 106] }, { 33: [2, 79], 65: [2, 79], 72: [2, 79], 80: [2, 79], 81: [2, 79], 82: [2, 79], 83: [2, 79], 84: [2, 79], 85: [2, 79] }, { 33: [2, 81] }, { 23: [2, 27], 33: [2, 27], 54: [2, 27], 65: [2, 27], 68: [2, 27], 72: [2, 27], 75: [2, 27], 80: [2, 27], 81: [2, 27], 82: [2, 27], 83: [2, 27], 84: [2, 27], 85: [2, 27] }, { 23: [2, 28], 33: [2, 28], 54: [2, 28], 65: [2, 28], 68: [2, 28], 72: [2, 28], 75: [2, 28], 80: [2, 28], 81: [2, 28], 82: [2, 28], 83: [2, 28], 84: [2, 28], 85: [2, 28] }, { 23: [2, 30], 33: [2, 30], 54: [2, 30], 68: [2, 30], 71: 107, 72: [1, 108], 75: [2, 30] }, { 23: [2, 98], 33: [2, 98], 54: [2, 98], 68: [2, 98], 72: [2, 98], 75: [2, 98] }, { 23: [2, 45], 33: [2, 45], 54: [2, 45], 65: [2, 45], 68: [2, 45], 72: [2, 45], 73: [1, 109], 75: [2, 45], 80: [2, 45], 81: [2, 45], 82: [2, 45], 83: [2, 45], 84: [2, 45], 85: [2, 45], 87: [2, 45] }, { 23: [2, 44], 33: [2, 44], 54: [2, 44], 65: [2, 44], 68: [2, 44], 72: [2, 44], 75: [2, 44], 80: [2, 44], 81: [2, 44], 82: [2, 44], 83: [2, 44], 84: [2, 44], 85: [2, 44], 87: [2, 44] }, { 54: [1, 110] }, { 54: [2, 83], 65: [2, 83], 72: [2, 83], 80: [2, 83], 81: [2, 83], 82: [2, 83], 83: [2, 83], 84: [2, 83], 85: [2, 83] }, { 54: [2, 85] }, { 5: [2, 13], 14: [2, 13], 15: [2, 13], 19: [2, 13], 29: [2, 13], 34: [2, 13], 39: [2, 13], 44: [2, 13], 47: [2, 13], 48: [2, 13], 51: [2, 13], 55: [2, 13], 60: [2, 13] }, { 38: 56, 39: [1, 58], 43: 57, 44: [1, 59], 45: 112, 46: 111, 47: [2, 76] }, { 33: [2, 70], 40: 113, 65: [2, 70], 72: [2, 70], 75: [2, 70], 80: [2, 70], 81: [2, 70], 82: [2, 70], 83: [2, 70], 84: [2, 70], 85: [2, 70] }, { 47: [2, 18] }, { 5: [2, 14], 14: [2, 14], 15: [2, 14], 19: [2, 14], 29: [2, 14], 34: [2, 14], 39: [2, 14], 44: [2, 14], 47: [2, 14], 48: [2, 14], 51: [2, 14], 55: [2, 14], 60: [2, 14] }, { 33: [1, 114] }, { 33: [2, 87], 65: [2, 87], 72: [2, 87], 80: [2, 87], 81: [2, 87], 82: [2, 87], 83: [2, 87], 84: [2, 87], 85: [2, 87] }, { 33: [2, 89] }, { 20: 75, 63: 116, 64: 76, 65: [1, 44], 67: 115, 68: [2, 96], 69: 117, 70: 77, 71: 78, 72: [1, 79], 78: 26, 79: 27, 80: [1, 28], 81: [1, 29], 82: [1, 30], 83: [1, 31], 84: [1, 32], 85: [1, 34], 86: 33 }, { 33: [1, 118] }, { 32: 119, 33: [2, 62], 74: 120, 75: [1, 121] }, { 33: [2, 59], 65: [2, 59], 72: [2, 59], 75: [2, 59], 80: [2, 59], 81: [2, 59], 82: [2, 59], 83: [2, 59], 84: [2, 59], 85: [2, 59] }, { 33: [2, 61], 75: [2, 61] }, { 33: [2, 68], 37: 122, 74: 123, 75: [1, 121] }, { 33: [2, 65], 65: [2, 65], 72: [2, 65], 75: [2, 65], 80: [2, 65], 81: [2, 65], 82: [2, 65], 83: [2, 65], 84: [2, 65], 85: [2, 65] }, { 33: [2, 67], 75: [2, 67] }, { 23: [1, 124] }, { 23: [2, 51], 65: [2, 51], 72: [2, 51], 80: [2, 51], 81: [2, 51], 82: [2, 51], 83: [2, 51], 84: [2, 51], 85: [2, 51] }, { 23: [2, 53] }, { 33: [1, 125] }, { 33: [2, 91], 65: [2, 91], 72: [2, 91], 80: [2, 91], 81: [2, 91], 82: [2, 91], 83: [2, 91], 84: [2, 91], 85: [2, 91] }, { 33: [2, 93] }, { 5: [2, 22], 14: [2, 22], 15: [2, 22], 19: [2, 22], 29: [2, 22], 34: [2, 22], 39: [2, 22], 44: [2, 22], 47: [2, 22], 48: [2, 22], 51: [2, 22], 55: [2, 22], 60: [2, 22] }, { 23: [2, 99], 33: [2, 99], 54: [2, 99], 68: [2, 99], 72: [2, 99], 75: [2, 99] }, { 73: [1, 109] }, { 20: 75, 63: 126, 64: 76, 65: [1, 44], 72: [1, 35], 78: 26, 79: 27, 80: [1, 28], 81: [1, 29], 82: [1, 30], 83: [1, 31], 84: [1, 32], 85: [1, 34], 86: 33 }, { 5: [2, 23], 14: [2, 23], 15: [2, 23], 19: [2, 23], 29: [2, 23], 34: [2, 23], 39: [2, 23], 44: [2, 23], 47: [2, 23], 48: [2, 23], 51: [2, 23], 55: [2, 23], 60: [2, 23] }, { 47: [2, 19] }, { 47: [2, 77] }, { 20: 75, 33: [2, 72], 41: 127, 63: 128, 64: 76, 65: [1, 44], 69: 129, 70: 77, 71: 78, 72: [1, 79], 75: [2, 72], 78: 26, 79: 27, 80: [1, 28], 81: [1, 29], 82: [1, 30], 83: [1, 31], 84: [1, 32], 85: [1, 34], 86: 33 }, { 5: [2, 24], 14: [2, 24], 15: [2, 24], 19: [2, 24], 29: [2, 24], 34: [2, 24], 39: [2, 24], 44: [2, 24], 47: [2, 24], 48: [2, 24], 51: [2, 24], 55: [2, 24], 60: [2, 24] }, { 68: [1, 130] }, { 65: [2, 95], 68: [2, 95], 72: [2, 95], 80: [2, 95], 81: [2, 95], 82: [2, 95], 83: [2, 95], 84: [2, 95], 85: [2, 95] }, { 68: [2, 97] }, { 5: [2, 21], 14: [2, 21], 15: [2, 21], 19: [2, 21], 29: [2, 21], 34: [2, 21], 39: [2, 21], 44: [2, 21], 47: [2, 21], 48: [2, 21], 51: [2, 21], 55: [2, 21], 60: [2, 21] }, { 33: [1, 131] }, { 33: [2, 63] }, { 72: [1, 133], 76: 132 }, { 33: [1, 134] }, { 33: [2, 69] }, { 15: [2, 12] }, { 14: [2, 26], 15: [2, 26], 19: [2, 26], 29: [2, 26], 34: [2, 26], 47: [2, 26], 48: [2, 26], 51: [2, 26], 55: [2, 26], 60: [2, 26] }, { 23: [2, 31], 33: [2, 31], 54: [2, 31], 68: [2, 31], 72: [2, 31], 75: [2, 31] }, { 33: [2, 74], 42: 135, 74: 136, 75: [1, 121] }, { 33: [2, 71], 65: [2, 71], 72: [2, 71], 75: [2, 71], 80: [2, 71], 81: [2, 71], 82: [2, 71], 83: [2, 71], 84: [2, 71], 85: [2, 71] }, { 33: [2, 73], 75: [2, 73] }, { 23: [2, 29], 33: [2, 29], 54: [2, 29], 65: [2, 29], 68: [2, 29], 72: [2, 29], 75: [2, 29], 80: [2, 29], 81: [2, 29], 82: [2, 29], 83: [2, 29], 84: [2, 29], 85: [2, 29] }, { 14: [2, 15], 15: [2, 15], 19: [2, 15], 29: [2, 15], 34: [2, 15], 39: [2, 15], 44: [2, 15], 47: [2, 15], 48: [2, 15], 51: [2, 15], 55: [2, 15], 60: [2, 15] }, { 72: [1, 138], 77: [1, 137] }, { 72: [2, 100], 77: [2, 100] }, { 14: [2, 16], 15: [2, 16], 19: [2, 16], 29: [2, 16], 34: [2, 16], 44: [2, 16], 47: [2, 16], 48: [2, 16], 51: [2, 16], 55: [2, 16], 60: [2, 16] }, { 33: [1, 139] }, { 33: [2, 75] }, { 33: [2, 32] }, { 72: [2, 101], 77: [2, 101] }, { 14: [2, 17], 15: [2, 17], 19: [2, 17], 29: [2, 17], 34: [2, 17], 39: [2, 17], 44: [2, 17], 47: [2, 17], 48: [2, 17], 51: [2, 17], 55: [2, 17], 60: [2, 17] }],
                        defaultActions: { 4: [2, 1], 55: [2, 55], 57: [2, 20], 61: [2, 57], 74: [2, 81], 83: [2, 85], 87: [2, 18], 91: [2, 89], 102: [2, 53], 105: [2, 93], 111: [2, 19], 112: [2, 77], 117: [2, 97], 120: [2, 63], 123: [2, 69], 124: [2, 12], 136: [2, 75], 137: [2, 32] },
                        parseError: function(e, t) { throw new Error(e) },
                        parse: function(e) {
                            function t() { var e; return e = n.lexer.lex() || 1, "number" != typeof e && (e = n.symbols_[e] || e), e }
                            var n = this,
                                i = [0],
                                r = [null],
                                o = [],
                                s = this.table,
                                a = "",
                                l = 0,
                                c = 0,
                                u = 0;
                            this.lexer.setInput(e), this.lexer.yy = this.yy, this.yy.lexer = this.lexer, this.yy.parser = this, "undefined" == typeof this.lexer.yylloc && (this.lexer.yylloc = {});
                            var p = this.lexer.yylloc;
                            o.push(p);
                            var d = this.lexer.options && this.lexer.options.ranges;
                            "function" == typeof this.yy.parseError && (this.parseError = this.yy.parseError);
                            for (var h, f, v, g, m, y, b, k, w, x = {};;) {
                                if (v = i[i.length - 1], this.defaultActions[v] ? g = this.defaultActions[v] : ((null === h || "undefined" == typeof h) && (h = t()), g = s[v] && s[v][h]), "undefined" == typeof g || !g.length || !g[0]) {
                                    var S = "";
                                    if (!u) {
                                        w = [];
                                        for (y in s[v]) this.terminals_[y] && y > 2 && w.push("'" + this.terminals_[y] + "'");
                                        S = this.lexer.showPosition ? "Parse error on line " + (l + 1) + ":\n" + this.lexer.showPosition() + "\nExpecting " + w.join(", ") + ", got '" + (this.terminals_[h] || h) + "'" : "Parse error on line " + (l + 1) + ": Unexpected " + (1 == h ? "end of input" : "'" + (this.terminals_[h] || h) + "'"), this.parseError(S, { text: this.lexer.match, token: this.terminals_[h] || h, line: this.lexer.yylineno, loc: p, expected: w })
                                    }
                                }
                                if (g[0] instanceof Array && g.length > 1) throw new Error("Parse Error: multiple actions possible at state: " + v + ", token: " + h);
                                switch (g[0]) {
                                    case 1:
                                        i.push(h), r.push(this.lexer.yytext), o.push(this.lexer.yylloc), i.push(g[1]), h = null, f ? (h = f, f = null) : (c = this.lexer.yyleng, a = this.lexer.yytext, l = this.lexer.yylineno, p = this.lexer.yylloc, u > 0 && u--);
                                        break;
                                    case 2:
                                        if (b = this.productions_[g[1]][1], x.$ = r[r.length - b], x._$ = { first_line: o[o.length - (b || 1)].first_line, last_line: o[o.length - 1].last_line, first_column: o[o.length - (b || 1)].first_column, last_column: o[o.length - 1].last_column }, d && (x._$.range = [o[o.length - (b || 1)].range[0], o[o.length - 1].range[1]]), m = this.performAction.call(x, a, c, l, this.yy, g[1], r, o), "undefined" != typeof m) return m;
                                        b && (i = i.slice(0, -1 * b * 2), r = r.slice(0, -1 * b), o = o.slice(0, -1 * b)), i.push(this.productions_[g[1]][0]), r.push(x.$), o.push(x._$), k = s[i[i.length - 2]][i[i.length - 1]], i.push(k);
                                        break;
                                    case 3:
                                        return !0
                                }
                            }
                            return !0
                        }
                    },
                    n = function() {
                        var e = {
                            EOF: 1,
                            parseError: function(e, t) {
                                if (!this.yy.parser) throw new Error(e);
                                this.yy.parser.parseError(e, t)
                            },
                            setInput: function(e) { return this._input = e, this._more = this._less = this.done = !1, this.yylineno = this.yyleng = 0, this.yytext = this.matched = this.match = "", this.conditionStack = ["INITIAL"], this.yylloc = { first_line: 1, first_column: 0, last_line: 1, last_column: 0 }, this.options.ranges && (this.yylloc.range = [0, 0]), this.offset = 0, this },
                            input: function() {
                                var e = this._input[0];
                                this.yytext += e, this.yyleng++, this.offset++, this.match += e, this.matched += e;
                                var t = e.match(/(?:\r\n?|\n).*/g);
                                return t ? (this.yylineno++, this.yylloc.last_line++) : this.yylloc.last_column++, this.options.ranges && this.yylloc.range[1]++, this._input = this._input.slice(1), e
                            },
                            unput: function(e) {
                                var t = e.length,
                                    n = e.split(/(?:\r\n?|\n)/g);
                                this._input = e + this._input, this.yytext = this.yytext.substr(0, this.yytext.length - t - 1), this.offset -= t;
                                var i = this.match.split(/(?:\r\n?|\n)/g);
                                this.match = this.match.substr(0, this.match.length - 1), this.matched = this.matched.substr(0, this.matched.length - 1), n.length - 1 && (this.yylineno -= n.length - 1);
                                var r = this.yylloc.range;
                                return this.yylloc = { first_line: this.yylloc.first_line, last_line: this.yylineno + 1, first_column: this.yylloc.first_column, last_column: n ? (n.length === i.length ? this.yylloc.first_column : 0) + i[i.length - n.length].length - n[0].length : this.yylloc.first_column - t }, this.options.ranges && (this.yylloc.range = [r[0], r[0] + this.yyleng - t]), this
                            },
                            more: function() { return this._more = !0, this },
                            less: function(e) { this.unput(this.match.slice(e)) },
                            pastInput: function() { var e = this.matched.substr(0, this.matched.length - this.match.length); return (e.length > 20 ? "..." : "") + e.substr(-20).replace(/\n/g, "") },
                            upcomingInput: function() { var e = this.match; return e.length < 20 && (e += this._input.substr(0, 20 - e.length)), (e.substr(0, 20) + (e.length > 20 ? "..." : "")).replace(/\n/g, "") },
                            showPosition: function() {
                                var e = this.pastInput(),
                                    t = new Array(e.length + 1).join("-");
                                return e + this.upcomingInput() + "\n" + t + "^"
                            },
                            next: function() {
                                if (this.done) return this.EOF;
                                this._input || (this.done = !0);
                                var e, t, n, i, r;
                                this._more || (this.yytext = "", this.match = "");
                                for (var o = this._currentRules(), s = 0; s < o.length && (n = this._input.match(this.rules[o[s]]), !n || t && !(n[0].length > t[0].length) || (t = n, i = s, this.options.flex)); s++);
                                return t ? (r = t[0].match(/(?:\r\n?|\n).*/g), r && (this.yylineno += r.length), this.yylloc = { first_line: this.yylloc.last_line, last_line: this.yylineno + 1, first_column: this.yylloc.last_column, last_column: r ? r[r.length - 1].length - r[r.length - 1].match(/\r?\n?/)[0].length : this.yylloc.last_column + t[0].length }, this.yytext += t[0], this.match += t[0], this.matches = t, this.yyleng = this.yytext.length, this.options.ranges && (this.yylloc.range = [this.offset, this.offset += this.yyleng]), this._more = !1, this._input = this._input.slice(t[0].length), this.matched += t[0], e = this.performAction.call(this, this.yy, this, o[i], this.conditionStack[this.conditionStack.length - 1]), this.done && this._input && (this.done = !1), e ? e : void 0) : "" === this._input ? this.EOF : this.parseError("Lexical error on line " + (this.yylineno + 1) + ". Unrecognized text.\n" + this.showPosition(), { text: "", token: null, line: this.yylineno })
                            },
                            lex: function() { var e = this.next(); return "undefined" != typeof e ? e : this.lex() },
                            begin: function(e) { this.conditionStack.push(e) },
                            popState: function() { return this.conditionStack.pop() },
                            _currentRules: function() { return this.conditions[this.conditionStack[this.conditionStack.length - 1]].rules },
                            topState: function() { return this.conditionStack[this.conditionStack.length - 2] },
                            pushState: function(e) { this.begin(e) }
                        };
                        return e.options = {}, e.performAction = function(e, t, n, i) {
                            function r(e, n) { return t.yytext = t.yytext.substr(e, t.yyleng - n) }
                            switch (n) {
                                case 0:
                                    if ("\\\\" === t.yytext.slice(-2) ? (r(0, 1), this.begin("mu")) : "\\" === t.yytext.slice(-1) ? (r(0, 1), this.begin("emu")) : this.begin("mu"), t.yytext) return 15;
                                    break;
                                case 1:
                                    return 15;
                                case 2:
                                    return this.popState(), 15;
                                case 3:
                                    return this.begin("raw"), 15;
                                case 4:
                                    return this.popState(), "raw" === this.conditionStack[this.conditionStack.length - 1] ? 15 : (t.yytext = t.yytext.substr(5, t.yyleng - 9), "END_RAW_BLOCK");
                                case 5:
                                    return 15;
                                case 6:
                                    return this.popState(), 14;
                                case 7:
                                    return 65;
                                case 8:
                                    return 68;
                                case 9:
                                    return 19;
                                case 10:
                                    return this.popState(), this.begin("raw"), 23;
                                case 11:
                                    return 55;
                                case 12:
                                    return 60;
                                case 13:
                                    return 29;
                                case 14:
                                    return 47;
                                case 15:
                                    return this.popState(), 44;
                                case 16:
                                    return this.popState(), 44;
                                case 17:
                                    return 34;
                                case 18:
                                    return 39;
                                case 19:
                                    return 51;
                                case 20:
                                    return 48;
                                case 21:
                                    this.unput(t.yytext), this.popState(), this.begin("com");
                                    break;
                                case 22:
                                    return this.popState(), 14;
                                case 23:
                                    return 48;
                                case 24:
                                    return 73;
                                case 25:
                                    return 72;
                                case 26:
                                    return 72;
                                case 27:
                                    return 87;
                                case 28:
                                    break;
                                case 29:
                                    return this.popState(), 54;
                                case 30:
                                    return this.popState(), 33;
                                case 31:
                                    return t.yytext = r(1, 2).replace(/\\"/g, '"'), 80;
                                case 32:
                                    return t.yytext = r(1, 2).replace(/\\'/g, "'"), 80;
                                case 33:
                                    return 85;
                                case 34:
                                    return 82;
                                case 35:
                                    return 82;
                                case 36:
                                    return 83;
                                case 37:
                                    return 84;
                                case 38:
                                    return 81;
                                case 39:
                                    return 75;
                                case 40:
                                    return 77;
                                case 41:
                                    return 72;
                                case 42:
                                    return t.yytext = t.yytext.replace(/\\([\\\]])/g, "$1"), 72;
                                case 43:
                                    return "INVALID";
                                case 44:
                                    return 5
                            }
                        }, e.rules = [/^(?:[^\x00]*?(?=(\{\{)))/, /^(?:[^\x00]+)/, /^(?:[^\x00]{2,}?(?=(\{\{|\\\{\{|\\\\\{\{|$)))/, /^(?:\{\{\{\{(?=[^\/]))/, /^(?:\{\{\{\{\/[^\s!"#%-,\.\/;->@\[-\^`\{-~]+(?=[=}\s\/.])\}\}\}\})/, /^(?:[^\x00]*?(?=(\{\{\{\{)))/, /^(?:[\s\S]*?--(~)?\}\})/, /^(?:\()/, /^(?:\))/, /^(?:\{\{\{\{)/, /^(?:\}\}\}\})/, /^(?:\{\{(~)?>)/, /^(?:\{\{(~)?#>)/, /^(?:\{\{(~)?#\*?)/, /^(?:\{\{(~)?\/)/, /^(?:\{\{(~)?\^\s*(~)?\}\})/, /^(?:\{\{(~)?\s*else\s*(~)?\}\})/, /^(?:\{\{(~)?\^)/, /^(?:\{\{(~)?\s*else\b)/, /^(?:\{\{(~)?\{)/, /^(?:\{\{(~)?&)/, /^(?:\{\{(~)?!--)/, /^(?:\{\{(~)?![\s\S]*?\}\})/, /^(?:\{\{(~)?\*?)/, /^(?:=)/, /^(?:\.\.)/, /^(?:\.(?=([=~}\s\/.)|])))/, /^(?:[\/.])/, /^(?:\s+)/, /^(?:\}(~)?\}\})/, /^(?:(~)?\}\})/, /^(?:"(\\["]|[^"])*")/, /^(?:'(\\[']|[^'])*')/, /^(?:@)/, /^(?:true(?=([~}\s)])))/, /^(?:false(?=([~}\s)])))/, /^(?:undefined(?=([~}\s)])))/, /^(?:null(?=([~}\s)])))/, /^(?:-?[0-9]+(?:\.[0-9]+)?(?=([~}\s)])))/, /^(?:as\s+\|)/, /^(?:\|)/, /^(?:([^\s!"#%-,\.\/;->@\[-\^`\{-~]+(?=([=~}\s\/.)|]))))/, /^(?:\[(\\\]|[^\]])*\])/, /^(?:.)/, /^(?:$)/], e.conditions = { mu: { rules: [7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44], inclusive: !1 }, emu: { rules: [2], inclusive: !1 }, com: { rules: [6], inclusive: !1 }, raw: { rules: [3, 4, 5], inclusive: !1 }, INITIAL: { rules: [0, 1, 44], inclusive: !0 } }, e
                    }();
                return t.lexer = n, e.prototype = t, t.Parser = e, new e
            }();
            t.__esModule = !0, t.default = i
        }, function(e, t, n) {
            "use strict";

            function i() {
                var e = arguments.length <= 0 || void 0 === arguments[0] ? {} : arguments[0];
                this.options = e
            }

            function r(e, t, n) {
                void 0 === t && (t = e.length);
                var i = e[t - 1],
                    r = e[t - 2];
                return i ? "ContentStatement" === i.type ? (r || !n ? /\r?\n\s*?$/ : /(^|\r?\n)\s*?$/).test(i.original) : void 0 : n
            }

            function o(e, t, n) {
                void 0 === t && (t = -1);
                var i = e[t + 1],
                    r = e[t + 2];
                return i ? "ContentStatement" === i.type ? (r || !n ? /^\s*?\r?\n/ : /^\s*?(\r?\n|$)/).test(i.original) : void 0 : n
            }

            function s(e, t, n) {
                var i = e[null == t ? 0 : t + 1];
                if (i && "ContentStatement" === i.type && (n || !i.rightStripped)) {
                    var r = i.value;
                    i.value = i.value.replace(n ? /^\s+/ : /^[ \t]*\r?\n?/, ""), i.rightStripped = i.value !== r
                }
            }

            function a(e, t, n) { var i = e[null == t ? e.length - 1 : t - 1]; if (i && "ContentStatement" === i.type && (n || !i.leftStripped)) { var r = i.value; return i.value = i.value.replace(n ? /\s+$/ : /[ \t]+$/, ""), i.leftStripped = i.value !== r, i.leftStripped } }
            var l = n(8).default;
            t.__esModule = !0;
            var c = n(6),
                u = l(c);
            i.prototype = new u.default, i.prototype.Program = function(e) {
                var t = !this.options.ignoreStandalone,
                    n = !this.isRootSeen;
                this.isRootSeen = !0;
                for (var i = e.body, l = 0, c = i.length; c > l; l++) {
                    var u = i[l],
                        p = this.accept(u);
                    if (p) {
                        var d = r(i, l, n),
                            h = o(i, l, n),
                            f = p.openStandalone && d,
                            v = p.closeStandalone && h,
                            g = p.inlineStandalone && d && h;
                        p.close && s(i, l, !0), p.open && a(i, l, !0), t && g && (s(i, l), a(i, l) && "PartialStatement" === u.type && (u.indent = /([ \t]+$)/.exec(i[l - 1].original)[1])), t && f && (s((u.program || u.inverse).body), a(i, l)), t && v && (s(i, l), a((u.inverse || u.program).body))
                    }
                }
                return e
            }, i.prototype.BlockStatement = i.prototype.DecoratorBlock = i.prototype.PartialBlockStatement = function(e) {
                this.accept(e.program), this.accept(e.inverse);
                var t = e.program || e.inverse,
                    n = e.program && e.inverse,
                    i = n,
                    l = n;
                if (n && n.chained)
                    for (i = n.body[0].program; l.chained;) l = l.body[l.body.length - 1].program;
                var c = { open: e.openStrip.open, close: e.closeStrip.close, openStandalone: o(t.body), closeStandalone: r((i || t).body) };
                if (e.openStrip.close && s(t.body, null, !0), n) {
                    var u = e.inverseStrip;
                    u.open && a(t.body, null, !0), u.close && s(i.body, null, !0), e.closeStrip.open && a(l.body, null, !0), !this.options.ignoreStandalone && r(t.body) && o(i.body) && (a(t.body), s(i.body))
                } else e.closeStrip.open && a(t.body, null, !0);
                return c
            }, i.prototype.Decorator = i.prototype.MustacheStatement = function(e) { return e.strip }, i.prototype.PartialStatement = i.prototype.CommentStatement = function(e) { var t = e.strip || {}; return { inlineStandalone: !0, open: t.open, close: t.close } }, t.default = i, e.exports = t.default
        }, function(e, t, n) {
            "use strict";

            function i(e, t) { if (t = t.path ? t.path.original : t, e.path.original !== t) { var n = { loc: e.path.loc }; throw new g.default(e.path.original + " doesn't match " + t, n) } }

            function r(e, t) { this.source = e, this.start = { line: t.first_line, column: t.first_column }, this.end = { line: t.last_line, column: t.last_column } }

            function o(e) { return /^\[.*\]$/.test(e) ? e.substr(1, e.length - 2) : e }

            function s(e, t) { return { open: "~" === e.charAt(2), close: "~" === t.charAt(t.length - 3) } }

            function a(e) { return e.replace(/^\{\{~?\!-?-?/, "").replace(/-?-?~?\}\}$/, "") }

            function l(e, t, n) {
                n = this.locInfo(n);
                for (var i = e ? "@" : "", r = [], o = 0, s = "", a = 0, l = t.length; l > a; a++) {
                    var c = t[a].part,
                        u = t[a].original !== c;
                    if (i += (t[a].separator || "") + c, u || ".." !== c && "." !== c && "this" !== c) r.push(c);
                    else { if (r.length > 0) throw new g.default("Invalid path: " + i, { loc: n }); ".." === c && (o++, s += "../") }
                }
                return { type: "PathExpression", data: e, depth: o, parts: r, original: i, loc: n }
            }

            function c(e, t, n, i, r, o) {
                var s = i.charAt(3) || i.charAt(2),
                    a = "{" !== s && "&" !== s,
                    l = /\*/.test(i);
                return { type: l ? "Decorator" : "MustacheStatement", path: e, params: t, hash: n, escaped: a, strip: r, loc: this.locInfo(o) }
            }

            function u(e, t, n, r) { i(e, n), r = this.locInfo(r); var o = { type: "Program", body: t, strip: {}, loc: r }; return { type: "BlockStatement", path: e.path, params: e.params, hash: e.hash, program: o, openStrip: {}, inverseStrip: {}, closeStrip: {}, loc: r } }

            function p(e, t, n, r, o, s) {
                r && r.path && i(e, r);
                var a = /\*/.test(e.open);
                t.blockParams = e.blockParams;
                var l = void 0,
                    c = void 0;
                if (n) {
                    if (a) throw new g.default("Unexpected inverse block on decorator", n);
                    n.chain && (n.program.body[0].closeStrip = r.strip), c = n.strip, l = n.program
                }
                return o && (o = l, l = t, t = o), { type: a ? "DecoratorBlock" : "BlockStatement", path: e.path, params: e.params, hash: e.hash, program: t, inverse: l, openStrip: e.strip, inverseStrip: c, closeStrip: r && r.strip, loc: this.locInfo(s) }
            }

            function d(e, t) {
                if (!t && e.length) {
                    var n = e[0].loc,
                        i = e[e.length - 1].loc;
                    n && i && (t = { source: n.source, start: { line: n.start.line, column: n.start.column }, end: { line: i.end.line, column: i.end.column } })
                }
                return { type: "Program", body: e, strip: {}, loc: t }
            }

            function h(e, t, n, r) { return i(e, n), { type: "PartialBlockStatement", name: e.path, params: e.params, hash: e.hash, program: t, openStrip: e.strip, closeStrip: n && n.strip, loc: this.locInfo(r) } }
            var f = n(8).default;
            t.__esModule = !0, t.SourceLocation = r, t.id = o, t.stripFlags = s, t.stripComment = a, t.preparePath = l, t.prepareMustache = c, t.prepareRawBlock = u, t.prepareBlock = p, t.prepareProgram = d, t.preparePartialBlock = h;
            var v = n(12),
                g = f(v)
        }, function(e, t, n) {
            "use strict";

            function i(e, t, n) { if (o.isArray(e)) { for (var i = [], r = 0, s = e.length; s > r; r++) i.push(t.wrap(e[r], n)); return i } return "boolean" == typeof e || "number" == typeof e ? e + "" : e }

            function r(e) { this.srcFile = e, this.source = [] }
            t.__esModule = !0;
            var o = n(13),
                s = void 0;
            try {} catch (e) {}
            s || (s = function(e, t, n, i) { this.src = "", i && this.add(i) }, s.prototype = { add: function(e) { o.isArray(e) && (e = e.join("")), this.src += e }, prepend: function(e) { o.isArray(e) && (e = e.join("")), this.src = e + this.src }, toStringWithSourceMap: function() { return { code: this.toString() } }, toString: function() { return this.src } }), r.prototype = {
                isEmpty: function() { return !this.source.length },
                prepend: function(e, t) { this.source.unshift(this.wrap(e, t)) },
                push: function(e, t) { this.source.push(this.wrap(e, t)) },
                merge: function() { var e = this.empty(); return this.each(function(t) { e.add(["  ", t, "\n"]) }), e },
                each: function(e) { for (var t = 0, n = this.source.length; n > t; t++) e(this.source[t]) },
                empty: function() { var e = this.currentLocation || { start: {} }; return new s(e.start.line, e.start.column, this.srcFile) },
                wrap: function(e) { var t = arguments.length <= 1 || void 0 === arguments[1] ? this.currentLocation || { start: {} } : arguments[1]; return e instanceof s ? e : (e = i(e, this, t), new s(t.start.line, t.start.column, this.srcFile, e)) },
                functionCall: function(e, t, n) { return n = this.generateList(n), this.wrap([e, t ? "." + t + "(" : "(", n, ")"]) },
                quotedString: function(e) { return '"' + (e + "").replace(/\\/g, "\\\\").replace(/"/g, '\\"').replace(/\n/g, "\\n").replace(/\r/g, "\\r").replace(/\u2028/g, "\\u2028").replace(/\u2029/g, "\\u2029") + '"' },
                objectLiteral: function(e) {
                    var t = [];
                    for (var n in e)
                        if (e.hasOwnProperty(n)) { var r = i(e[n], this); "undefined" !== r && t.push([this.quotedString(n), ":", r]) }
                    var o = this.generateList(t);
                    return o.prepend("{"), o.add("}"), o
                },
                generateList: function(e) { for (var t = this.empty(), n = 0, r = e.length; r > n; n++) n && t.add(","), t.add(i(e[n], this)); return t },
                generateArray: function(e) { var t = this.generateList(e); return t.prepend("["), t.add("]"), t }
            }, t.default = r, e.exports = t.default
        }, function(e, t, n) {
            "use strict";

            function i(e) { s.default(e), l.default(e), u.default(e), d.default(e), f.default(e), g.default(e), y.default(e) }
            var r = n(8).default;
            t.__esModule = !0, t.registerDefaultHelpers = i;
            var o = n(22),
                s = r(o),
                a = n(23),
                l = r(a),
                c = n(24),
                u = r(c),
                p = n(25),
                d = r(p),
                h = n(26),
                f = r(h),
                v = n(27),
                g = r(v),
                m = n(28),
                y = r(m)
        }, function(e, t, n) {
            "use strict";

            function i(e) { s.default(e) }
            var r = n(8).default;
            t.__esModule = !0, t.registerDefaultDecorators = i;
            var o = n(29),
                s = r(o)
        }, function(e, t, n) {
            "use strict";
            t.__esModule = !0;
            var i = n(13),
                r = {
                    methodMap: ["debug", "info", "warn", "error"],
                    level: "info",
                    lookupLevel: function(e) {
                        if ("string" == typeof e) {
                            var t = i.indexOf(r.methodMap, e.toLowerCase());
                            e = t >= 0 ? t : parseInt(e, 10)
                        }
                        return e
                    },
                    log: function(e) {
                        if (e = r.lookupLevel(e), "undefined" != typeof console && r.lookupLevel(r.level) <= e) {
                            var t = r.methodMap[e];
                            console[t] || (t = "log");
                            for (var n = arguments.length, i = Array(n > 1 ? n - 1 : 0), o = 1; n > o; o++) i[o - 1] = arguments[o];
                            console[t].apply(console, i)
                        }
                    }
                };
            t.default = r, e.exports = t.default
        }, function(e, t, n) {
            "use strict";
            t.__esModule = !0;
            var i = n(13);
            t.default = function(e) {
                e.registerHelper("blockHelperMissing", function(t, n) {
                    var r = n.inverse,
                        o = n.fn;
                    if (t === !0) return o(this);
                    if (t === !1 || null == t) return r(this);
                    if (i.isArray(t)) return t.length > 0 ? (n.ids && (n.ids = [n.name]), e.helpers.each(t, n)) : r(this);
                    if (n.data && n.ids) {
                        var s = i.createFrame(n.data);
                        s.contextPath = i.appendContextPath(n.data.contextPath, n.name), n = { data: s }
                    }
                    return o(t, n)
                })
            }, e.exports = t.default
        }, function(e, t, n) {
            "use strict";
            var i = n(8).default;
            t.__esModule = !0;
            var r = n(13),
                o = n(12),
                s = i(o);
            t.default = function(e) {
                e.registerHelper("each", function(e, t) {
                    function n(t, n, o) { c && (c.key = t, c.index = n, c.first = 0 === n, c.last = !!o, u && (c.contextPath = u + t)), l += i(e[t], { data: c, blockParams: r.blockParams([e[t], t], [u + t, null]) }) }
                    if (!t) throw new s.default("Must pass iterator to #each");
                    var i = t.fn,
                        o = t.inverse,
                        a = 0,
                        l = "",
                        c = void 0,
                        u = void 0;
                    if (t.data && t.ids && (u = r.appendContextPath(t.data.contextPath, t.ids[0]) + "."), r.isFunction(e) && (e = e.call(this)), t.data && (c = r.createFrame(t.data)), e && "object" == typeof e)
                        if (r.isArray(e))
                            for (var p = e.length; p > a; a++) a in e && n(a, a, a === e.length - 1);
                        else {
                            var d = void 0;
                            for (var h in e) e.hasOwnProperty(h) && (void 0 !== d && n(d, a - 1), d = h, a++);
                            void 0 !== d && n(d, a - 1, !0)
                        }
                    return 0 === a && (l = o(this)), l
                })
            }, e.exports = t.default
        }, function(e, t, n) {
            "use strict";
            var i = n(8).default;
            t.__esModule = !0;
            var r = n(12),
                o = i(r);
            t.default = function(e) { e.registerHelper("helperMissing", function() { if (1 !== arguments.length) throw new o.default('Missing helper: "' + arguments[arguments.length - 1].name + '"') }) }, e.exports = t.default
        }, function(e, t, n) {
            "use strict";
            t.__esModule = !0;
            var i = n(13);
            t.default = function(e) { e.registerHelper("if", function(e, t) { return i.isFunction(e) && (e = e.call(this)), !t.hash.includeZero && !e || i.isEmpty(e) ? t.inverse(this) : t.fn(this) }), e.registerHelper("unless", function(t, n) { return e.helpers.if.call(this, t, { fn: n.inverse, inverse: n.fn, hash: n.hash }) }) }, e.exports = t.default
        }, function(e, t, n) {
            "use strict";
            t.__esModule = !0, t.default = function(e) {
                e.registerHelper("log", function() {
                    for (var t = [void 0], n = arguments[arguments.length - 1], i = 0; i < arguments.length - 1; i++) t.push(arguments[i]);
                    var r = 1;
                    null != n.hash.level ? r = n.hash.level : n.data && null != n.data.level && (r = n.data.level), t[0] = r, e.log.apply(e, t)
                })
            }, e.exports = t.default
        }, function(e, t, n) {
            "use strict";
            t.__esModule = !0, t.default = function(e) { e.registerHelper("lookup", function(e, t) { return e && e[t] }) }, e.exports = t.default
        }, function(e, t, n) {
            "use strict";
            t.__esModule = !0;
            var i = n(13);
            t.default = function(e) { e.registerHelper("with", function(e, t) { i.isFunction(e) && (e = e.call(this)); var n = t.fn; if (i.isEmpty(e)) return t.inverse(this); var r = t.data; return t.data && t.ids && (r = i.createFrame(t.data), r.contextPath = i.appendContextPath(t.data.contextPath, t.ids[0])), n(e, { data: r, blockParams: i.blockParams([e], [r && r.contextPath]) }) }) }, e.exports = t.default
        }, function(e, t, n) {
            "use strict";
            t.__esModule = !0;
            var i = n(13);
            t.default = function(e) {
                e.registerDecorator("inline", function(e, t, n, r) {
                    var o = e;
                    return t.partials || (t.partials = {}, o = function(r, o) {
                        var s = n.partials;
                        n.partials = i.extend({}, s, t.partials);
                        var a = e(r, o);
                        return n.partials = s, a
                    }), t.partials[r.args[0]] = r.fn, o
                })
            }, e.exports = t.default
        }])
    }),
    /*!
     * queryParams.js
     */
    window.Shopify = window.Shopify || {}, Shopify.queryParams = {}, location.search.length)
    for (var aKeyValue, i = 0, aCouples = location.search.substr(1).split("&"); i < aCouples.length; i++) aKeyValue = aCouples[i].split("="), aKeyValue.length > 1 && (Shopify.queryParams[decodeURIComponent(aKeyValue[0])] = decodeURIComponent(aKeyValue[1]));
/*!
 * tocca.min.js
 */
/*! tocca v0.2.0-beta.2 || Gianluca Guarini */
var SWIPE_THRESHOLD = 50;
! function(e, t) {
    "use strict";
    if ("function" != typeof e.createEvent) return !1;
    var n, i, r, o, s, a, l, c, u = "undefined" != typeof jQuery,
        p = function(e) {
            var t = e.toLowerCase(),
                n = "MS" + e;
            return navigator.msPointerEnabled ? n : t
        },
        d = !!navigator.pointerEnabled || navigator.msPointerEnabled,
        h = function() { return "ontouchstart" in window || window.DocumentTouch && document instanceof DocumentTouch || d },
        f = function(e) {
            var t = h(),
                n = /mouse/.test(e.type);
            return !n && t && /touch/.test(e.type) && !d || !n && t && !/touch/.test(e.type) && d || n && !t
        },
        v = { touchstart: p("PointerDown") + " touchstart", touchend: p("PointerUp") + " touchend", touchmove: p("PointerMove") + " touchmove" },
        g = function(e, t, n) { for (var i = t.split(" "), r = i.length; r--;) e.addEventListener(i[r], n, !1) },
        m = function(e) { return e.targetTouches ? e.targetTouches[0] : e },
        y = function() { return (new Date).getTime() },
        b = function(t, r, o, s) {
            var a = e.createEvent("Event");
            if (a.originalEvent = o, s = s || {}, s.x = n, s.y = i, s.distance = s.distance, u && (a = $.Event(r, { originalEvent: o }), jQuery(t).trigger(a, s)), a.initEvent) {
                for (var l in s) a[l] = s[l];
                a.initEvent(r, !0, !0), t.dispatchEvent(a)
            }
            t["on" + r] && t["on" + r](a)
        },
        k = function(e) {
            if (f(e)) {
                var t = m(e);
                r = n = t.pageX, o = i = t.pageY, c = setTimeout(function() { b(e.target, "longtap", e), a = e.target }, E), s = y(), A++
            }
        },
        w = function(e) {
            if (f(e)) {
                var t = [],
                    u = y(),
                    p = o - i,
                    d = r - n;
                if (clearTimeout(l), clearTimeout(c), -S >= d && t.push("swiperight"), d >= S && t.push("swipeleft"), -S >= p && t.push("swipedown"), p >= S && t.push("swipeup"), t.length)
                    for (var h = 0; h < t.length; h++) {
                        var v = t[h];
                        b(e.target, v, e, { distance: { x: Math.abs(d), y: Math.abs(p) } })
                    } else r >= n - P && n + P >= r && o >= i - P && i + P >= o && s + T - u >= 0 && (b(e.target, 2 === A && a === e.target ? "dbltap" : "tap", e), a = e.target), l = setTimeout(function() { A = 0 }, C)
            }
        },
        x = function(e) {
            if (f(e)) {
                var t = m(e);
                n = t.pageX, i = t.pageY
            }
        },
        S = t.SWIPE_THRESHOLD || 100,
        T = t.TAP_THRESHOLD || 150,
        C = t.DBL_TAP_THRESHOLD || 200,
        E = t.LONG_TAP_THRESHOLD || 1e3,
        P = t.TAP_PRECISION / 2 || 30,
        _ = t.JUST_ON_TOUCH_DEVICES,
        A = 0;
    g(e, v.touchstart + (_ ? "" : " mousedown"), k), g(e, v.touchend + (_ ? "" : " mouseup"), w), g(e, v.touchmove + (_ ? "" : " mousemove"), x)
}(document, window),
/*!
 * jquery.ba-throttle-debounce.min.js
 */
/*
 * jQuery throttle / debounce - v1.1 - 3/7/2010
 * http://benalman.com/projects/jquery-throttle-debounce-plugin/
 *
 * Copyright (c) 2010 "Cowboy" Ben Alman
 * Dual licensed under the MIT and GPL licenses.
 * http://benalman.com/about/license/
 */
function(e, t) {
    var n, i = e.jQuery || e.Cowboy || (e.Cowboy = {});
    i.throttle = n = function(e, n, r, o) {
        function s() {
            function i() { l = +new Date, r.apply(c, p) }

            function s() { a = t }
            var c = this,
                u = +new Date - l,
                p = arguments;
            o && !a && i(), a && clearTimeout(a), o === t && u > e ? i() : n !== !0 && (a = setTimeout(o ? s : i, o === t ? e - u : e))
        }
        var a, l = 0;
        return "boolean" != typeof n && (o = r, r = n, n = t), i.guid && (s.guid = r.guid = r.guid || i.guid++), s
    }, i.debounce = function(e, i, r) { return r === t ? n(e, i, !1) : n(e, r, i !== !1) }
}(this);


/* Cookie + Currency
 * Cookie plugin
 *
 * Copyright (c) 2006 Klaus Hartl (stilbuero.de)
 * Dual licensed under the MIT and GPL licenses:
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.gnu.org/licenses/gpl.html
 *
 */
jQuery.cookie = function(b, j, m) {
    if (typeof j != "undefined") {
        m = m || {};
        if (j === null) {
            j = "";
            m.expires = -1
        }
        var e = "";
        if (m.expires && (typeof m.expires == "number" || m.expires.toUTCString)) {
            var f;
            if (typeof m.expires == "number") {
                f = new Date();
                f.setTime(f.getTime() + (m.expires * 24 * 60 * 60 * 1000))
            } else { f = m.expires }
            e = "; expires=" + f.toUTCString()
        }
        var l = m.path ? "; path=" + (m.path) : "";
        var g = m.domain ? "; domain=" + (m.domain) : "";
        var a = m.secure ? "; secure" : "";
        document.cookie = [b, "=", encodeURIComponent(j), e, l, g, a].join("")
    } else { var d = null; if (document.cookie && document.cookie != "") { var k = document.cookie.split(";"); for (var h = 0; h < k.length; h++) { var c = jQuery.trim(k[h]); if (c.substring(0, b.length + 1) == (b + "=")) { d = decodeURIComponent(c.substring(b.length + 1)); break } } } return d }
};

/*
 * Currency tools
 *
 * Copyright (c) 2015 Caroline Schnapp (mllegeorgesand@gmail.com)
 * Licensed under the MIT license:
 * http://www.opensource.org/licenses/mit-license.php
 *
 */
if (typeof Currency === "undefined") { var Currency = {} }
Currency.cookie = { configuration: { expires: 365, path: "/", domain: window.location.hostname }, name: "currency", write: function(a) { jQuery.cookie(this.name, a, this.configuration) }, read: function() { return jQuery.cookie(this.name) }, destroy: function() { jQuery.cookie(this.name, null, this.configuration) } };
Currency.moneyFormats = { USD: { money_format: "${{amount}}", money_with_currency_format: "${{amount}} USD" }, EUR: { money_format: "&euro;{{amount}}", money_with_currency_format: "&euro;{{amount}} EUR" }, GBP: { money_format: "&pound;{{amount}}", money_with_currency_format: "&pound;{{amount}} GBP" }, CAD: { money_format: "${{amount}}", money_with_currency_format: "${{amount}} CAD" }, ALL: { money_format: "Lek {{amount}}", money_with_currency_format: "Lek {{amount}} ALL" }, DZD: { money_format: "DA {{amount}}", money_with_currency_format: "DA {{amount}} DZD" }, AOA: { money_format: "Kz{{amount}}", money_with_currency_format: "Kz{{amount}} AOA" }, ARS: { money_format: "${{amount_with_comma_separator}}", money_with_currency_format: "${{amount_with_comma_separator}} ARS" }, AMD: { money_format: "{{amount}} AMD", money_with_currency_format: "{{amount}} AMD" }, AWG: { money_format: "Afl{{amount}}", money_with_currency_format: "Afl{{amount}} AWG" }, AUD: { money_format: "${{amount}}", money_with_currency_format: "${{amount}} AUD" }, BBD: { money_format: "${{amount}}", money_with_currency_format: "${{amount}} Bds" }, AZN: { money_format: "m.{{amount}}", money_with_currency_format: "m.{{amount}} AZN" }, BDT: { money_format: "Tk {{amount}}", money_with_currency_format: "Tk {{amount}} BDT" }, BSD: { money_format: "BS${{amount}}", money_with_currency_format: "BS${{amount}} BSD" }, BHD: { money_format: "{{amount}}0 BD", money_with_currency_format: "{{amount}}0 BHD" }, BYR: { money_format: "Br {{amount}}", money_with_currency_format: "Br {{amount}} BYR" }, BZD: { money_format: "BZ${{amount}}", money_with_currency_format: "BZ${{amount}} BZD" }, BTN: { money_format: "Nu {{amount}}", money_with_currency_format: "Nu {{amount}} BTN" }, BAM: { money_format: "KM {{amount_with_comma_separator}}", money_with_currency_format: "KM {{amount_with_comma_separator}} BAM" }, BRL: { money_format: "R$ {{amount_with_comma_separator}}", money_with_currency_format: "R$ {{amount_with_comma_separator}} BRL" }, BOB: { money_format: "Bs{{amount_with_comma_separator}}", money_with_currency_format: "Bs{{amount_with_comma_separator}} BOB" }, BWP: { money_format: "P{{amount}}", money_with_currency_format: "P{{amount}} BWP" }, BND: { money_format: "${{amount}}", money_with_currency_format: "${{amount}} BND" }, BGN: { money_format: "{{amount}} Ð»Ð²", money_with_currency_format: "{{amount}} Ð»Ð² BGN" }, MMK: { money_format: "K{{amount}}", money_with_currency_format: "K{{amount}} MMK" }, KHR: { money_format: "KHR{{amount}}", money_with_currency_format: "KHR{{amount}}" }, KYD: { money_format: "${{amount}}", money_with_currency_format: "${{amount}} KYD" }, XAF: { money_format: "FCFA{{amount}}", money_with_currency_format: "FCFA{{amount}} XAF" }, CLP: { money_format: "${{amount_no_decimals}}", money_with_currency_format: "${{amount_no_decimals}} CLP" }, CNY: { money_format: "&#165;{{amount}}", money_with_currency_format: "&#165;{{amount}} CNY" }, COP: { money_format: "${{amount_with_comma_separator}}", money_with_currency_format: "${{amount_with_comma_separator}} COP" }, CRC: { money_format: "&#8353; {{amount_with_comma_separator}}", money_with_currency_format: "&#8353; {{amount_with_comma_separator}} CRC" }, HRK: { money_format: "{{amount_with_comma_separator}} kn", money_with_currency_format: "{{amount_with_comma_separator}} kn HRK" }, CZK: { money_format: "{{amount_with_comma_separator}} K&#269;", money_with_currency_format: "{{amount_with_comma_separator}} K&#269;" }, DKK: { money_format: "{{amount_with_comma_separator}}", money_with_currency_format: "kr.{{amount_with_comma_separator}}" }, DOP: { money_format: "RD$ {{amount}}", money_with_currency_format: "RD$ {{amount}}" }, XCD: { money_format: "${{amount}}", money_with_currency_format: "EC${{amount}}" }, EGP: { money_format: "LE {{amount}}", money_with_currency_format: "LE {{amount}} EGP" }, ETB: { money_format: "Br{{amount}}", money_with_currency_format: "Br{{amount}} ETB" }, XPF: { money_format: "{{amount_no_decimals_with_comma_separator}} XPF", money_with_currency_format: "{{amount_no_decimals_with_comma_separator}} XPF" }, FJD: { money_format: "${{amount}}", money_with_currency_format: "FJ${{amount}}" }, GMD: { money_format: "D {{amount}}", money_with_currency_format: "D {{amount}} GMD" }, GHS: { money_format: "GH&#8373;{{amount}}", money_with_currency_format: "GH&#8373;{{amount}}" }, GTQ: { money_format: "Q{{amount}}", money_with_currency_format: "{{amount}} GTQ" }, GYD: { money_format: "G${{amount}}", money_with_currency_format: "${{amount}} GYD" }, GEL: { money_format: "{{amount}} GEL", money_with_currency_format: "{{amount}} GEL" }, HNL: { money_format: "L {{amount}}", money_with_currency_format: "L {{amount}} HNL" }, HKD: { money_format: "${{amount}}", money_with_currency_format: "HK${{amount}}" }, HUF: { money_format: "{{amount_no_decimals_with_comma_separator}}", money_with_currency_format: "{{amount_no_decimals_with_comma_separator}} Ft" }, ISK: { money_format: "{{amount_no_decimals}} kr", money_with_currency_format: "{{amount_no_decimals}} kr ISK" }, INR: { money_format: "Rs. {{amount}}", money_with_currency_format: "Rs. {{amount}}" }, IDR: { money_format: "{{amount_with_comma_separator}}", money_with_currency_format: "Rp {{amount_with_comma_separator}}" }, ILS: { money_format: "{{amount}} NIS", money_with_currency_format: "{{amount}} NIS" }, JMD: { money_format: "${{amount}}", money_with_currency_format: "${{amount}} JMD" }, JPY: { money_format: "&#165;{{amount_no_decimals}}", money_with_currency_format: "&#165;{{amount_no_decimals}} JPY" }, JEP: { money_format: "&pound;{{amount}}", money_with_currency_format: "&pound;{{amount}} JEP" }, JOD: { money_format: "{{amount}}0 JD", money_with_currency_format: "{{amount}}0 JOD" }, KZT: { money_format: "{{amount}} KZT", money_with_currency_format: "{{amount}} KZT" }, KES: { money_format: "KSh{{amount}}", money_with_currency_format: "KSh{{amount}}" }, KWD: { money_format: "{{amount}}0 KD", money_with_currency_format: "{{amount}}0 KWD" }, KGS: { money_format: "Ð»Ð²{{amount}}", money_with_currency_format: "Ð»Ð²{{amount}}" }, LVL: { money_format: "Ls {{amount}}", money_with_currency_format: "Ls {{amount}} LVL" }, LBP: { money_format: "L&pound;{{amount}}", money_with_currency_format: "L&pound;{{amount}} LBP" }, LTL: { money_format: "{{amount}} Lt", money_with_currency_format: "{{amount}} Lt" }, MGA: { money_format: "Ar {{amount}}", money_with_currency_format: "Ar {{amount}} MGA" }, MKD: { money_format: "Ð´ÐµÐ½ {{amount}}", money_with_currency_format: "Ð´ÐµÐ½ {{amount}} MKD" }, MOP: { money_format: "MOP${{amount}}", money_with_currency_format: "MOP${{amount}}" }, MVR: { money_format: "Rf{{amount}}", money_with_currency_format: "Rf{{amount}} MRf" }, MXN: { money_format: "$ {{amount}}", money_with_currency_format: "$ {{amount}} MXN" }, MYR: { money_format: "RM{{amount}} MYR", money_with_currency_format: "RM{{amount}} MYR" }, MUR: { money_format: "Rs {{amount}}", money_with_currency_format: "Rs {{amount}} MUR" }, MDL: { money_format: "{{amount}} MDL", money_with_currency_format: "{{amount}} MDL" }, MAD: { money_format: "{{amount}} dh", money_with_currency_format: "Dh {{amount}} MAD" }, MNT: { money_format: "{{amount_no_decimals}} &#8366", money_with_currency_format: "{{amount_no_decimals}} MNT" }, MZN: { money_format: "{{amount}} Mt", money_with_currency_format: "Mt {{amount}} MZN" }, NAD: { money_format: "N${{amount}}", money_with_currency_format: "N${{amount}} NAD" }, NPR: { money_format: "Rs{{amount}}", money_with_currency_format: "Rs{{amount}} NPR" }, ANG: { money_format: "&fnof;{{amount}}", money_with_currency_format: "{{amount}} NA&fnof;" }, NZD: { money_format: "${{amount}}", money_with_currency_format: "${{amount}} NZD" }, NIO: { money_format: "C${{amount}}", money_with_currency_format: "C${{amount}} NIO" }, NGN: { money_format: "&#8358;{{amount}}", money_with_currency_format: "&#8358;{{amount}} NGN" }, NOK: { money_format: "kr {{amount_with_comma_separator}}", money_with_currency_format: "kr {{amount_with_comma_separator}} NOK" }, OMR: { money_format: "{{amount_with_comma_separator}} OMR", money_with_currency_format: "{{amount_with_comma_separator}} OMR" }, PKR: { money_format: "Rs.{{amount}}", money_with_currency_format: "Rs.{{amount}} PKR" }, PGK: { money_format: "K {{amount}}", money_with_currency_format: "K {{amount}} PGK" }, PYG: { money_format: "Gs. {{amount_no_decimals_with_comma_separator}}", money_with_currency_format: "Gs. {{amount_no_decimals_with_comma_separator}} PYG" }, PEN: { money_format: "S/. {{amount}}", money_with_currency_format: "S/. {{amount}} PEN" }, PHP: { money_format: "&#8369;{{amount}}", money_with_currency_format: "&#8369;{{amount}} PHP" }, PLN: { money_format: "{{amount_with_comma_separator}} zl", money_with_currency_format: "{{amount_with_comma_separator}} zl PLN" }, QAR: { money_format: "QAR {{amount_with_comma_separator}}", money_with_currency_format: "QAR {{amount_with_comma_separator}}" }, RON: { money_format: "{{amount_with_comma_separator}} lei", money_with_currency_format: "{{amount_with_comma_separator}} lei RON" }, RUB: { money_format: "&#1088;&#1091;&#1073;{{amount_with_comma_separator}}", money_with_currency_format: "&#1088;&#1091;&#1073;{{amount_with_comma_separator}} RUB" }, RWF: { money_format: "{{amount_no_decimals}} RF", money_with_currency_format: "{{amount_no_decimals}} RWF" }, WST: { money_format: "WS$ {{amount}}", money_with_currency_format: "WS$ {{amount}} WST" }, SAR: { money_format: "{{amount}} SR", money_with_currency_format: "{{amount}} SAR" }, STD: { money_format: "Db {{amount}}", money_with_currency_format: "Db {{amount}} STD" }, RSD: { money_format: "{{amount}} RSD", money_with_currency_format: "{{amount}} RSD" }, SCR: { money_format: "Rs {{amount}}", money_with_currency_format: "Rs {{amount}} SCR" }, SGD: { money_format: "${{amount}}", money_with_currency_format: "${{amount}} SGD" }, SYP: { money_format: "S&pound;{{amount}}", money_with_currency_format: "S&pound;{{amount}} SYP" }, ZAR: { money_format: "R {{amount}}", money_with_currency_format: "R {{amount}} ZAR" }, KRW: { money_format: "&#8361;{{amount_no_decimals}}", money_with_currency_format: "&#8361;{{amount_no_decimals}} KRW" }, LKR: { money_format: "Rs {{amount}}", money_with_currency_format: "Rs {{amount}} LKR" }, SEK: { money_format: "{{amount_no_decimals}} kr", money_with_currency_format: "{{amount_no_decimals}} kr SEK" }, CHF: { money_format: "SFr. {{amount}}", money_with_currency_format: "SFr. {{amount}} CHF" }, TWD: { money_format: "${{amount}}", money_with_currency_format: "${{amount}} TWD" }, THB: { money_format: "{{amount}} &#xe3f;", money_with_currency_format: "{{amount}} &#xe3f; THB" }, TZS: { money_format: "{{amount}} TZS", money_with_currency_format: "{{amount}} TZS" }, TTD: { money_format: "${{amount}}", money_with_currency_format: "${{amount}} TTD" }, TND: { money_format: "{{amount}}", money_with_currency_format: "{{amount}} DT" }, TRY: { money_format: "{{amount}}TL", money_with_currency_format: "{{amount}}TL" }, UGX: { money_format: "Ush {{amount_no_decimals}}", money_with_currency_format: "Ush {{amount_no_decimals}} UGX" }, UAH: { money_format: "â‚´{{amount}}", money_with_currency_format: "â‚´{{amount}} UAH" }, AED: { money_format: "Dhs. {{amount}}", money_with_currency_format: "Dhs. {{amount}} AED" }, UYU: { money_format: "${{amount_with_comma_separator}}", money_with_currency_format: "${{amount_with_comma_separator}} UYU" }, VUV: { money_format: "${{amount}}", money_with_currency_format: "${{amount}}VT" }, VEF: { money_format: "Bs. {{amount_with_comma_separator}}", money_with_currency_format: "Bs. {{amount_with_comma_separator}} VEF" }, VND: { money_format: "{{amount_no_decimals_with_comma_separator}}&#8363;", money_with_currency_format: "{{amount_no_decimals_with_comma_separator}} VND" }, XBT: { money_format: "{{amount_no_decimals}} BTC", money_with_currency_format: "{{amount_no_decimals}} BTC" }, XOF: { money_format: "CFA{{amount}}", money_with_currency_format: "CFA{{amount}} XOF" }, ZMW: { money_format: "K{{amount_no_decimals_with_comma_separator}}", money_with_currency_format: "ZMW{{amount_no_decimals_with_comma_separator}}" } };
Currency.formatMoney = function(b, g) {
    if (typeof Shopify.formatMoney === "function") { return Shopify.formatMoney(b, g) }
    if (typeof b == "string") { b = b.replace(".", "") }
    var f = "";
    var e = /\{\{\s*(\w+)\s*\}\}/;
    var a = g || "${{amount}}";

    function c(h, i) { return (typeof h == "undefined" ? i : h) }

    function d(m, k, l, j) {
        k = c(k, 2);
        l = c(l, ",");
        j = c(j, ".");
        if (isNaN(m) || m == null) { return 0 }
        m = (m / 100).toFixed(k);
        var n = m.split("."),
            i = n[0].replace(/(\d)(?=(\d\d\d)+(?!\d))/g, "$1" + l),
            h = n[1] ? (j + n[1]) : "";
        return i + h
    }
    switch (a.match(e)[1]) {
        case "amount":
            f = d(b, 2);
            break;
        case "amount_no_decimals":
            f = d(b, 0);
            break;
        case "amount_with_comma_separator":
            f = d(b, 2, ".", ",");
            break;
        case "amount_no_decimals_with_comma_separator":
            f = d(b, 0, ".", ",");
            break
    }
    return a.replace(e, f)
};
Currency.currentCurrency = "";
Currency.format = "money_with_currency_format";
Currency.convertAll = function(c, b, a, d) {
    jQuery(a || "span.money").each(function() {
        if (jQuery(this).attr("data-currency") === b) { return }
        if (jQuery(this).attr("data-currency-" + b)) { jQuery(this).html(jQuery(this).attr("data-currency-" + b)) } else {
            var e = 0;
            var f = Currency.moneyFormats[c][d || Currency.format] || "{{amount}}";
            var g = Currency.moneyFormats[b][d || Currency.format] || "{{amount}}";
            if (f.indexOf("amount_no_decimals") !== -1) { e = Currency.convert(parseInt(jQuery(this).html().replace(/[^0-9]/g, ""), 10) * 100, c, b) } else { if (c === "JOD" || c == "KWD" || c == "BHD") { e = Currency.convert(parseInt(jQuery(this).html().replace(/[^0-9]/g, ""), 10) / 10, c, b) } else { e = Currency.convert(parseInt(jQuery(this).html().replace(/[^0-9]/g, ""), 10), c, b) } }
            var h = Currency.formatMoney(e, g);
            jQuery(this).html(h);
            jQuery(this).attr("data-currency-" + b, h)
        }
        jQuery(this).attr("data-currency", b)
    });
    this.currentCurrency = b;
    this.cookie.write(b)
};


/*	Popper + Bootstrap 4
 Copyright (C) Federico Zivolo 2017
 Distributed under the MIT License (license terms are at http://opensource.org/licenses/MIT).
 */
(function(e, t) { 'object' == typeof exports && 'undefined' != typeof module ? module.exports = t() : 'function' == typeof define && define.amd ? define(t) : e.Popper = t() })(this, function() {
    'use strict';

    function e(e) { return e && '[object Function]' === {}.toString.call(e) }

    function t(e, t) { if (1 !== e.nodeType) return []; var o = window.getComputedStyle(e, null); return t ? o[t] : o }

    function o(e) { return 'HTML' === e.nodeName ? e : e.parentNode || e.host }

    function n(e) {
        if (!e || -1 !== ['HTML', 'BODY', '#document'].indexOf(e.nodeName)) return window.document.body;
        var i = t(e),
            r = i.overflow,
            p = i.overflowX,
            s = i.overflowY;
        return /(auto|scroll)/.test(r + s + p) ? e : n(o(e))
    }

    function r(e) {
        var o = e && e.offsetParent,
            i = o && o.nodeName;
        return i && 'BODY' !== i && 'HTML' !== i ? -1 !== ['TD', 'TABLE'].indexOf(o.nodeName) && 'static' === t(o, 'position') ? r(o) : o : window.document.documentElement
    }

    function p(e) { var t = e.nodeName; return 'BODY' !== t && ('HTML' === t || r(e.firstElementChild) === e) }

    function s(e) { return null === e.parentNode ? e : s(e.parentNode) }

    function d(e, t) {
        if (!e || !e.nodeType || !t || !t.nodeType) return window.document.documentElement;
        var o = e.compareDocumentPosition(t) & Node.DOCUMENT_POSITION_FOLLOWING,
            i = o ? e : t,
            n = o ? t : e,
            a = document.createRange();
        a.setStart(i, 0), a.setEnd(n, 0);
        var f = a.commonAncestorContainer;
        if (e !== f && t !== f || i.contains(n)) return p(f) ? f : r(f);
        var l = s(e);
        return l.host ? d(l.host, t) : d(e, s(t).host)
    }

    function a(e) {
        var t = 1 < arguments.length && void 0 !== arguments[1] ? arguments[1] : 'top',
            o = 'top' === t ? 'scrollTop' : 'scrollLeft',
            i = e.nodeName;
        if ('BODY' === i || 'HTML' === i) {
            var n = window.document.documentElement,
                r = window.document.scrollingElement || n;
            return r[o]
        }
        return e[o]
    }

    function f(e, t) {
        var o = 2 < arguments.length && void 0 !== arguments[2] && arguments[2],
            i = a(t, 'top'),
            n = a(t, 'left'),
            r = o ? -1 : 1;
        return e.top += i * r, e.bottom += i * r, e.left += n * r, e.right += n * r, e
    }

    function l(e, t) {
        var o = 'x' === t ? 'Left' : 'Top',
            i = 'Left' == o ? 'Right' : 'Bottom';
        return +e['border' + o + 'Width'].split('px')[0] + +e['border' + i + 'Width'].split('px')[0]
    }

    function m(e, t, o, i) { return _(t['offset' + e], o['client' + e], o['offset' + e], ie() ? o['offset' + e] + i['margin' + ('Height' === e ? 'Top' : 'Left')] + i['margin' + ('Height' === e ? 'Bottom' : 'Right')] : 0) }

    function h() {
        var e = window.document.body,
            t = window.document.documentElement,
            o = ie() && window.getComputedStyle(t);
        return { height: m('Height', e, t, o), width: m('Width', e, t, o) }
    }

    function c(e) { return se({}, e, { right: e.left + e.width, bottom: e.top + e.height }) }

    function g(e) {
        var o = {};
        if (ie()) try {
            o = e.getBoundingClientRect();
            var i = a(e, 'top'),
                n = a(e, 'left');
            o.top += i, o.left += n, o.bottom += i, o.right += n
        } catch (e) {} else o = e.getBoundingClientRect();
        var r = { left: o.left, top: o.top, width: o.right - o.left, height: o.bottom - o.top },
            p = 'HTML' === e.nodeName ? h() : {},
            s = p.width || e.clientWidth || r.right - r.left,
            d = p.height || e.clientHeight || r.bottom - r.top,
            f = e.offsetWidth - s,
            m = e.offsetHeight - d;
        if (f || m) {
            var g = t(e);
            f -= l(g, 'x'), m -= l(g, 'y'), r.width -= f, r.height -= m
        }
        return c(r)
    }

    function u(e, o) {
        var i = ie(),
            r = 'HTML' === o.nodeName,
            p = g(e),
            s = g(o),
            d = n(e),
            a = t(o),
            l = +a.borderTopWidth.split('px')[0],
            m = +a.borderLeftWidth.split('px')[0],
            h = c({ top: p.top - s.top - l, left: p.left - s.left - m, width: p.width, height: p.height });
        if (h.marginTop = 0, h.marginLeft = 0, !i && r) {
            var u = +a.marginTop.split('px')[0],
                b = +a.marginLeft.split('px')[0];
            h.top -= l - u, h.bottom -= l - u, h.left -= m - b, h.right -= m - b, h.marginTop = u, h.marginLeft = b
        }
        return (i ? o.contains(d) : o === d && 'BODY' !== d.nodeName) && (h = f(h, o)), h
    }

    function b(e) {
        var t = window.document.documentElement,
            o = u(e, t),
            i = _(t.clientWidth, window.innerWidth || 0),
            n = _(t.clientHeight, window.innerHeight || 0),
            r = a(t),
            p = a(t, 'left'),
            s = { top: r - o.top + o.marginTop, left: p - o.left + o.marginLeft, width: i, height: n };
        return c(s)
    }

    function y(e) { var i = e.nodeName; return 'BODY' === i || 'HTML' === i ? !1 : 'fixed' === t(e, 'position') || y(o(e)) }

    function w(e, t, i, r) {
        var p = { top: 0, left: 0 },
            s = d(e, t);
        if ('viewport' === r) p = b(s);
        else {
            var a;
            'scrollParent' === r ? (a = n(o(e)), 'BODY' === a.nodeName && (a = window.document.documentElement)) : 'window' === r ? a = window.document.documentElement : a = r;
            var f = u(a, s);
            if ('HTML' === a.nodeName && !y(s)) {
                var l = h(),
                    m = l.height,
                    c = l.width;
                p.top += f.top - f.marginTop, p.bottom = m + f.top, p.left += f.left - f.marginLeft, p.right = c + f.left
            } else p = f
        }
        return p.left += i, p.top += i, p.right -= i, p.bottom -= i, p
    }

    function v(e) {
        var t = e.width,
            o = e.height;
        return t * o
    }

    function E(e, t, o, i, n) {
        var r = 5 < arguments.length && void 0 !== arguments[5] ? arguments[5] : 0;
        if (-1 === e.indexOf('auto')) return e;
        var p = w(o, i, r, n),
            s = { top: { width: p.width, height: t.top - p.top }, right: { width: p.right - t.right, height: p.height }, bottom: { width: p.width, height: p.bottom - t.bottom }, left: { width: t.left - p.left, height: p.height } },
            d = Object.keys(s).map(function(e) { return se({ key: e }, s[e], { area: v(s[e]) }) }).sort(function(e, t) { return t.area - e.area }),
            a = d.filter(function(e) {
                var t = e.width,
                    i = e.height;
                return t >= o.clientWidth && i >= o.clientHeight
            }),
            f = 0 < a.length ? a[0].key : d[0].key,
            l = e.split('-')[1];
        return f + (l ? '-' + l : '')
    }

    function x(e, t, o) { var i = d(t, o); return u(o, i) }

    function O(e) {
        var t = window.getComputedStyle(e),
            o = parseFloat(t.marginTop) + parseFloat(t.marginBottom),
            i = parseFloat(t.marginLeft) + parseFloat(t.marginRight),
            n = { width: e.offsetWidth + i, height: e.offsetHeight + o };
        return n
    }

    function L(e) { var t = { left: 'right', right: 'left', bottom: 'top', top: 'bottom' }; return e.replace(/left|right|bottom|top/g, function(e) { return t[e] }) }

    function S(e, t, o) {
        o = o.split('-')[0];
        var i = O(e),
            n = { width: i.width, height: i.height },
            r = -1 !== ['right', 'left'].indexOf(o),
            p = r ? 'top' : 'left',
            s = r ? 'left' : 'top',
            d = r ? 'height' : 'width',
            a = r ? 'width' : 'height';
        return n[p] = t[p] + t[d] / 2 - i[d] / 2, n[s] = o === s ? t[s] - i[a] : t[L(s)], n
    }

    function T(e, t) { return Array.prototype.find ? e.find(t) : e.filter(t)[0] }

    function C(e, t, o) { if (Array.prototype.findIndex) return e.findIndex(function(e) { return e[t] === o }); var i = T(e, function(e) { return e[t] === o }); return e.indexOf(i) }

    function N(t, o, i) {
        var n = void 0 === i ? t : t.slice(0, C(t, 'name', i));
        return n.forEach(function(t) {
            t.function && console.warn('`modifier.function` is deprecated, use `modifier.fn`!');
            var i = t.function || t.fn;
            t.enabled && e(i) && (o.offsets.popper = c(o.offsets.popper), o.offsets.reference = c(o.offsets.reference), o = i(o, t))
        }), o
    }

    function k() {
        if (!this.state.isDestroyed) {
            var e = { instance: this, styles: {}, attributes: {}, flipped: !1, offsets: {} };
            e.offsets.reference = x(this.state, this.popper, this.reference), e.placement = E(this.options.placement, e.offsets.reference, this.popper, this.reference, this.options.modifiers.flip.boundariesElement, this.options.modifiers.flip.padding), e.originalPlacement = e.placement, e.offsets.popper = S(this.popper, e.offsets.reference, e.placement), e.offsets.popper.position = 'absolute', e = N(this.modifiers, e), this.state.isCreated ? this.options.onUpdate(e) : (this.state.isCreated = !0, this.options.onCreate(e))
        }
    }

    function W(e, t) {
        return e.some(function(e) {
            var o = e.name,
                i = e.enabled;
            return i && o === t
        })
    }

    function B(e) {
        for (var t = [!1, 'ms', 'Webkit', 'Moz', 'O'], o = e.charAt(0).toUpperCase() + e.slice(1), n = 0; n < t.length - 1; n++) {
            var i = t[n],
                r = i ? '' + i + o : e;
            if ('undefined' != typeof window.document.body.style[r]) return r
        }
        return null
    }

    function D() { return this.state.isDestroyed = !0, W(this.modifiers, 'applyStyle') && (this.popper.removeAttribute('x-placement'), this.popper.style.left = '', this.popper.style.position = '', this.popper.style.top = '', this.popper.style[B('transform')] = ''), this.disableEventListeners(), this.options.removeOnDestroy && this.popper.parentNode.removeChild(this.popper), this }

    function H(e, t, o, i) {
        var r = 'BODY' === e.nodeName,
            p = r ? window : e;
        p.addEventListener(t, o, { passive: !0 }), r || H(n(p.parentNode), t, o, i), i.push(p)
    }

    function P(e, t, o, i) { o.updateBound = i, window.addEventListener('resize', o.updateBound, { passive: !0 }); var r = n(e); return H(r, 'scroll', o.updateBound, o.scrollParents), o.scrollElement = r, o.eventsEnabled = !0, o }

    function A() { this.state.eventsEnabled || (this.state = P(this.reference, this.options, this.state, this.scheduleUpdate)) }

    function M(e, t) { return window.removeEventListener('resize', t.updateBound), t.scrollParents.forEach(function(e) { e.removeEventListener('scroll', t.updateBound) }), t.updateBound = null, t.scrollParents = [], t.scrollElement = null, t.eventsEnabled = !1, t }

    function I() { this.state.eventsEnabled && (window.cancelAnimationFrame(this.scheduleUpdate), this.state = M(this.reference, this.state)) }

    function R(e) { return '' !== e && !isNaN(parseFloat(e)) && isFinite(e) }

    function U(e, t) { Object.keys(t).forEach(function(o) { var i = ''; - 1 !== ['width', 'height', 'top', 'right', 'bottom', 'left'].indexOf(o) && R(t[o]) && (i = 'px'), e.style[o] = t[o] + i }) }

    function Y(e, t) { Object.keys(t).forEach(function(o) { var i = t[o];!1 === i ? e.removeAttribute(o) : e.setAttribute(o, t[o]) }) }

    function F(e, t, o) {
        var i = T(e, function(e) { var o = e.name; return o === t }),
            n = !!i && e.some(function(e) { return e.name === o && e.enabled && e.order < i.order });
        if (!n) {
            var r = '`' + t + '`';
            console.warn('`' + o + '`' + ' modifier is required by ' + r + ' modifier in order to work, be sure to include it before ' + r + '!')
        }
        return n
    }

    function j(e) { return 'end' === e ? 'start' : 'start' === e ? 'end' : e }

    function K(e) {
        var t = 1 < arguments.length && void 0 !== arguments[1] && arguments[1],
            o = ae.indexOf(e),
            i = ae.slice(o + 1).concat(ae.slice(0, o));
        return t ? i.reverse() : i
    }

    function q(e, t, o, i) {
        var n = e.match(/((?:\-|\+)?\d*\.?\d*)(.*)/),
            r = +n[1],
            p = n[2];
        if (!r) return e;
        if (0 === p.indexOf('%')) {
            var s;
            switch (p) {
                case '%p':
                    s = o;
                    break;
                case '%':
                case '%r':
                default:
                    s = i;
            }
            var d = c(s);
            return d[t] / 100 * r
        }
        if ('vh' === p || 'vw' === p) { var a; return a = 'vh' === p ? _(document.documentElement.clientHeight, window.innerHeight || 0) : _(document.documentElement.clientWidth, window.innerWidth || 0), a / 100 * r }
        return r
    }

    function G(e, t, o, i) {
        var n = [0, 0],
            r = -1 !== ['right', 'left'].indexOf(i),
            p = e.split(/(\+|\-)/).map(function(e) { return e.trim() }),
            s = p.indexOf(T(p, function(e) { return -1 !== e.search(/,|\s/) }));
        p[s] && -1 === p[s].indexOf(',') && console.warn('Offsets separated by white space(s) are deprecated, use a comma (,) instead.');
        var d = /\s*,\s*|\s+/,
            a = -1 === s ? [p] : [p.slice(0, s).concat([p[s].split(d)[0]]), [p[s].split(d)[1]].concat(p.slice(s + 1))];
        return a = a.map(function(e, i) {
            var n = (1 === i ? !r : r) ? 'height' : 'width',
                p = !1;
            return e.reduce(function(e, t) { return '' === e[e.length - 1] && -1 !== ['+', '-'].indexOf(t) ? (e[e.length - 1] = t, p = !0, e) : p ? (e[e.length - 1] += t, p = !1, e) : e.concat(t) }, []).map(function(e) { return q(e, n, t, o) })
        }), a.forEach(function(e, t) { e.forEach(function(o, i) { R(o) && (n[t] += o * ('-' === e[i - 1] ? -1 : 1)) }) }), n
    }
    for (var z = Math.min, V = Math.floor, _ = Math.max, X = ['native code', '[object MutationObserverConstructor]'], Q = function(e) { return X.some(function(t) { return -1 < (e || '').toString().indexOf(t) }) }, J = 'undefined' != typeof window, Z = ['Edge', 'Trident', 'Firefox'], $ = 0, ee = 0; ee < Z.length; ee += 1)
        if (J && 0 <= navigator.userAgent.indexOf(Z[ee])) { $ = 1; break }
    var i, te = J && Q(window.MutationObserver),
        oe = te ? function(e) {
            var t = !1,
                o = 0,
                i = document.createElement('span'),
                n = new MutationObserver(function() { e(), t = !1 });
            return n.observe(i, { attributes: !0 }),
                function() { t || (t = !0, i.setAttribute('x-index', o), ++o) }
        } : function(e) { var t = !1; return function() { t || (t = !0, setTimeout(function() { t = !1, e() }, $)) } },
        ie = function() { return void 0 == i && (i = -1 !== navigator.appVersion.indexOf('MSIE 10')), i },
        ne = function(e, t) { if (!(e instanceof t)) throw new TypeError('Cannot call a class as a function') },
        re = function() {
            function e(e, t) { for (var o, n = 0; n < t.length; n++) o = t[n], o.enumerable = o.enumerable || !1, o.configurable = !0, 'value' in o && (o.writable = !0), Object.defineProperty(e, o.key, o) }
            return function(t, o, i) { return o && e(t.prototype, o), i && e(t, i), t }
        }(),
        pe = function(e, t, o) { return t in e ? Object.defineProperty(e, t, { value: o, enumerable: !0, configurable: !0, writable: !0 }) : e[t] = o, e },
        se = Object.assign || function(e) {
            for (var t, o = 1; o < arguments.length; o++)
                for (var i in t = arguments[o], t) Object.prototype.hasOwnProperty.call(t, i) && (e[i] = t[i]);
            return e
        },
        de = ['auto-start', 'auto', 'auto-end', 'top-start', 'top', 'top-end', 'right-start', 'right', 'right-end', 'bottom-end', 'bottom', 'bottom-start', 'left-end', 'left', 'left-start'],
        ae = de.slice(3),
        fe = { FLIP: 'flip', CLOCKWISE: 'clockwise', COUNTERCLOCKWISE: 'counterclockwise' },
        le = function() {
            function t(o, i) {
                var n = this,
                    r = 2 < arguments.length && void 0 !== arguments[2] ? arguments[2] : {};
                ne(this, t), this.scheduleUpdate = function() { return requestAnimationFrame(n.update) }, this.update = oe(this.update.bind(this)), this.options = se({}, t.Defaults, r), this.state = { isDestroyed: !1, isCreated: !1, scrollParents: [] }, this.reference = o.jquery ? o[0] : o, this.popper = i.jquery ? i[0] : i, this.options.modifiers = {}, Object.keys(se({}, t.Defaults.modifiers, r.modifiers)).forEach(function(e) { n.options.modifiers[e] = se({}, t.Defaults.modifiers[e] || {}, r.modifiers ? r.modifiers[e] : {}) }), this.modifiers = Object.keys(this.options.modifiers).map(function(e) { return se({ name: e }, n.options.modifiers[e]) }).sort(function(e, t) { return e.order - t.order }), this.modifiers.forEach(function(t) { t.enabled && e(t.onLoad) && t.onLoad(n.reference, n.popper, n.options, t, n.state) }), this.update();
                var p = this.options.eventsEnabled;
                p && this.enableEventListeners(), this.state.eventsEnabled = p
            }
            return re(t, [{ key: 'update', value: function() { return k.call(this) } }, { key: 'destroy', value: function() { return D.call(this) } }, { key: 'enableEventListeners', value: function() { return A.call(this) } }, { key: 'disableEventListeners', value: function() { return I.call(this) } }]), t
        }();
    return le.Utils = ('undefined' == typeof window ? global : window).PopperUtils, le.placements = de, le.Defaults = {
        placement: 'bottom',
        eventsEnabled: !0,
        removeOnDestroy: !1,
        onCreate: function() {},
        onUpdate: function() {},
        modifiers: {
            shift: {
                order: 100,
                enabled: !0,
                fn: function(e) {
                    var t = e.placement,
                        o = t.split('-')[0],
                        i = t.split('-')[1];
                    if (i) {
                        var n = e.offsets,
                            r = n.reference,
                            p = n.popper,
                            s = -1 !== ['bottom', 'top'].indexOf(o),
                            d = s ? 'left' : 'top',
                            a = s ? 'width' : 'height',
                            f = { start: pe({}, d, r[d]), end: pe({}, d, r[d] + r[a] - p[a]) };
                        e.offsets.popper = se({}, p, f[i])
                    }
                    return e
                }
            },
            offset: {
                order: 200,
                enabled: !0,
                fn: function(e, t) {
                    var o, i = t.offset,
                        n = e.placement,
                        r = e.offsets,
                        p = r.popper,
                        s = r.reference,
                        d = n.split('-')[0];
                    return o = R(+i) ? [+i, 0] : G(i, p, s, d), 'left' === d ? (p.top += o[0], p.left -= o[1]) : 'right' === d ? (p.top += o[0], p.left += o[1]) : 'top' === d ? (p.left += o[0], p.top -= o[1]) : 'bottom' === d && (p.left += o[0], p.top += o[1]), e.popper = p, e
                },
                offset: 0
            },
            preventOverflow: {
                order: 300,
                enabled: !0,
                fn: function(e, t) {
                    var o = t.boundariesElement || r(e.instance.popper);
                    e.instance.reference === o && (o = r(o));
                    var i = w(e.instance.popper, e.instance.reference, t.padding, o);
                    t.boundaries = i;
                    var n = t.priority,
                        p = e.offsets.popper,
                        s = {
                            primary: function(e) { var o = p[e]; return p[e] < i[e] && !t.escapeWithReference && (o = _(p[e], i[e])), pe({}, e, o) },
                            secondary: function(e) {
                                var o = 'right' === e ? 'left' : 'top',
                                    n = p[o];
                                return p[e] > i[e] && !t.escapeWithReference && (n = z(p[o], i[e] - ('right' === e ? p.width : p.height))), pe({}, o, n)
                            }
                        };
                    return n.forEach(function(e) {
                        var t = -1 === ['left', 'top'].indexOf(e) ? 'secondary' : 'primary';
                        p = se({}, p, s[t](e))
                    }), e.offsets.popper = p, e
                },
                priority: ['left', 'right', 'top', 'bottom'],
                padding: 5,
                boundariesElement: 'scrollParent'
            },
            keepTogether: {
                order: 400,
                enabled: !0,
                fn: function(e) {
                    var t = e.offsets,
                        o = t.popper,
                        i = t.reference,
                        n = e.placement.split('-')[0],
                        r = V,
                        p = -1 !== ['top', 'bottom'].indexOf(n),
                        s = p ? 'right' : 'bottom',
                        d = p ? 'left' : 'top',
                        a = p ? 'width' : 'height';
                    return o[s] < r(i[d]) && (e.offsets.popper[d] = r(i[d]) - o[a]), o[d] > r(i[s]) && (e.offsets.popper[d] = r(i[s])), e
                }
            },
            arrow: {
                order: 500,
                enabled: !0,
                fn: function(e, t) {
                    if (!F(e.instance.modifiers, 'arrow', 'keepTogether')) return e;
                    var o = t.element;
                    if ('string' == typeof o) { if (o = e.instance.popper.querySelector(o), !o) return e; } else if (!e.instance.popper.contains(o)) return console.warn('WARNING: `arrow.element` must be child of its popper element!'), e;
                    var i = e.placement.split('-')[0],
                        n = e.offsets,
                        r = n.popper,
                        p = n.reference,
                        s = -1 !== ['left', 'right'].indexOf(i),
                        d = s ? 'height' : 'width',
                        a = s ? 'top' : 'left',
                        f = s ? 'left' : 'top',
                        l = s ? 'bottom' : 'right',
                        m = O(o)[d];
                    p[l] - m < r[a] && (e.offsets.popper[a] -= r[a] - (p[l] - m)), p[a] + m > r[l] && (e.offsets.popper[a] += p[a] + m - r[l]);
                    var h = p[a] + p[d] / 2 - m / 2,
                        g = h - c(e.offsets.popper)[a];
                    return g = _(z(r[d] - m, g), 0), e.arrowElement = o, e.offsets.arrow = {}, e.offsets.arrow[a] = Math.round(g), e.offsets.arrow[f] = '', e
                },
                element: '[x-arrow]'
            },
            flip: {
                order: 600,
                enabled: !0,
                fn: function(e, t) {
                    if (W(e.instance.modifiers, 'inner')) return e;
                    if (e.flipped && e.placement === e.originalPlacement) return e;
                    var o = w(e.instance.popper, e.instance.reference, t.padding, t.boundariesElement),
                        i = e.placement.split('-')[0],
                        n = L(i),
                        r = e.placement.split('-')[1] || '',
                        p = [];
                    switch (t.behavior) {
                        case fe.FLIP:
                            p = [i, n];
                            break;
                        case fe.CLOCKWISE:
                            p = K(i);
                            break;
                        case fe.COUNTERCLOCKWISE:
                            p = K(i, !0);
                            break;
                        default:
                            p = t.behavior;
                    }
                    return p.forEach(function(s, d) {
                        if (i !== s || p.length === d + 1) return e;
                        i = e.placement.split('-')[0], n = L(i);
                        var a = e.offsets.popper,
                            f = e.offsets.reference,
                            l = V,
                            m = 'left' === i && l(a.right) > l(f.left) || 'right' === i && l(a.left) < l(f.right) || 'top' === i && l(a.bottom) > l(f.top) || 'bottom' === i && l(a.top) < l(f.bottom),
                            h = l(a.left) < l(o.left),
                            c = l(a.right) > l(o.right),
                            g = l(a.top) < l(o.top),
                            u = l(a.bottom) > l(o.bottom),
                            b = 'left' === i && h || 'right' === i && c || 'top' === i && g || 'bottom' === i && u,
                            y = -1 !== ['top', 'bottom'].indexOf(i),
                            w = !!t.flipVariations && (y && 'start' === r && h || y && 'end' === r && c || !y && 'start' === r && g || !y && 'end' === r && u);
                        (m || b || w) && (e.flipped = !0, (m || b) && (i = p[d + 1]), w && (r = j(r)), e.placement = i + (r ? '-' + r : ''), e.offsets.popper = se({}, e.offsets.popper, S(e.instance.popper, e.offsets.reference, e.placement)), e = N(e.instance.modifiers, e, 'flip'))
                    }), e
                },
                behavior: 'flip',
                padding: 5,
                boundariesElement: 'viewport'
            },
            inner: {
                order: 700,
                enabled: !1,
                fn: function(e) {
                    var t = e.placement,
                        o = t.split('-')[0],
                        i = e.offsets,
                        n = i.popper,
                        r = i.reference,
                        p = -1 !== ['left', 'right'].indexOf(o),
                        s = -1 === ['top', 'left'].indexOf(o);
                    return n[p ? 'left' : 'top'] = r[t] - (s ? n[p ? 'width' : 'height'] : 0), e.placement = L(t), e.offsets.popper = c(n), e
                }
            },
            hide: {
                order: 800,
                enabled: !0,
                fn: function(e) {
                    if (!F(e.instance.modifiers, 'hide', 'preventOverflow')) return e;
                    var t = e.offsets.reference,
                        o = T(e.instance.modifiers, function(e) { return 'preventOverflow' === e.name }).boundaries;
                    if (t.bottom < o.top || t.left > o.right || t.top > o.bottom || t.right < o.left) {
                        if (!0 === e.hide) return e;
                        e.hide = !0, e.attributes['x-out-of-boundaries'] = ''
                    } else {
                        if (!1 === e.hide) return e;
                        e.hide = !1, e.attributes['x-out-of-boundaries'] = !1
                    }
                    return e
                }
            },
            computeStyle: {
                order: 850,
                enabled: !0,
                fn: function(e, t) {
                    var o = t.x,
                        i = t.y,
                        n = e.offsets.popper,
                        p = T(e.instance.modifiers, function(e) { return 'applyStyle' === e.name }).gpuAcceleration;
                    void 0 !== p && console.warn('WARNING: `gpuAcceleration` option moved to `computeStyle` modifier and will not be supported in future versions of Popper.js!');
                    var s, d, a = void 0 === p ? t.gpuAcceleration : p,
                        f = r(e.instance.popper),
                        l = g(f),
                        m = { position: n.position },
                        h = { left: V(n.left), top: V(n.top), bottom: V(n.bottom), right: V(n.right) },
                        c = 'bottom' === o ? 'top' : 'bottom',
                        u = 'right' === i ? 'left' : 'right',
                        b = B('transform');
                    if (d = 'bottom' == c ? -l.height + h.bottom : h.top, s = 'right' == u ? -l.width + h.right : h.left, a && b) m[b] = 'translate3d(' + s + 'px, ' + d + 'px, 0)', m[c] = 0, m[u] = 0, m.willChange = 'transform';
                    else {
                        var y = 'bottom' == c ? -1 : 1,
                            w = 'right' == u ? -1 : 1;
                        m[c] = d * y, m[u] = s * w, m.willChange = c + ', ' + u
                    }
                    var v = { "x-placement": e.placement };
                    return e.attributes = se({}, v, e.attributes), e.styles = se({}, m, e.styles), e
                },
                gpuAcceleration: !0,
                x: 'bottom',
                y: 'right'
            },
            applyStyle: {
                order: 900,
                enabled: !0,
                fn: function(e) { return U(e.instance.popper, e.styles), Y(e.instance.popper, e.attributes), e.offsets.arrow && U(e.arrowElement, e.offsets.arrow), e },
                onLoad: function(e, t, o, i, n) {
                    var r = x(n, t, e),
                        p = E(o.placement, r, t, e, o.modifiers.flip.boundariesElement, o.modifiers.flip.padding);
                    return t.setAttribute('x-placement', p), U(t, { position: 'absolute' }), o
                },
                gpuAcceleration: void 0
            }
        }
    }, le
});
//# sourceMappingURL=popper.min.js.map
/*!
 * Bootstrap v4.3.1 (https://getbootstrap.com/)
 * Copyright 2011-2019 The Bootstrap Authors (https://github.com/twbs/bootstrap/graphs/contributors)
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 */
! function(t, e) { "object" == typeof exports && "undefined" != typeof module ? e(exports, require("jquery"), require("popper.js")) : "function" == typeof define && define.amd ? define(["exports", "jquery", "popper.js"], e) : e((t = t || self).bootstrap = {}, t.jQuery, t.Popper) }(this, function(t, g, u) {
    "use strict";

    function i(t, e) {
        for (var n = 0; n < e.length; n++) {
            var i = e[n];
            i.enumerable = i.enumerable || !1, i.configurable = !0, "value" in i && (i.writable = !0), Object.defineProperty(t, i.key, i)
        }
    }

    function s(t, e, n) { return e && i(t.prototype, e), n && i(t, n), t }

    function l(o) {
        for (var t = 1; t < arguments.length; t++) {
            var r = null != arguments[t] ? arguments[t] : {},
                e = Object.keys(r);
            "function" == typeof Object.getOwnPropertySymbols && (e = e.concat(Object.getOwnPropertySymbols(r).filter(function(t) { return Object.getOwnPropertyDescriptor(r, t).enumerable }))), e.forEach(function(t) {
                var e, n, i;
                e = o, i = r[n = t], n in e ? Object.defineProperty(e, n, { value: i, enumerable: !0, configurable: !0, writable: !0 }) : e[n] = i
            })
        }
        return o
    }
    g = g && g.hasOwnProperty("default") ? g.default : g, u = u && u.hasOwnProperty("default") ? u.default : u;
    var e = "transitionend";

    function n(t) {
        var e = this,
            n = !1;
        return g(this).one(_.TRANSITION_END, function() { n = !0 }), setTimeout(function() { n || _.triggerTransitionEnd(e) }, t), this
    }
    var _ = {
        TRANSITION_END: "bsTransitionEnd",
        getUID: function(t) { for (; t += ~~(1e6 * Math.random()), document.getElementById(t);); return t },
        getSelectorFromElement: function(t) {
            var e = t.getAttribute("data-target");
            if (!e || "#" === e) {
                var n = t.getAttribute("href");
                e = n && "#" !== n ? n.trim() : ""
            }
            try { return document.querySelector(e) ? e : null } catch (t) { return null }
        },
        getTransitionDurationFromElement: function(t) {
            if (!t) return 0;
            var e = g(t).css("transition-duration"),
                n = g(t).css("transition-delay"),
                i = parseFloat(e),
                o = parseFloat(n);
            return i || o ? (e = e.split(",")[0], n = n.split(",")[0], 1e3 * (parseFloat(e) + parseFloat(n))) : 0
        },
        reflow: function(t) { return t.offsetHeight },
        triggerTransitionEnd: function(t) { g(t).trigger(e) },
        supportsTransitionEnd: function() { return Boolean(e) },
        isElement: function(t) { return (t[0] || t).nodeType },
        typeCheckConfig: function(t, e, n) {
            for (var i in n)
                if (Object.prototype.hasOwnProperty.call(n, i)) {
                    var o = n[i],
                        r = e[i],
                        s = r && _.isElement(r) ? "element" : (a = r, {}.toString.call(a).match(/\s([a-z]+)/i)[1].toLowerCase());
                    if (!new RegExp(o).test(s)) throw new Error(t.toUpperCase() + ': Option "' + i + '" provided type "' + s + '" but expected type "' + o + '".')
                }
            var a
        },
        findShadowRoot: function(t) { if (!document.documentElement.attachShadow) return null; if ("function" != typeof t.getRootNode) return t instanceof ShadowRoot ? t : t.parentNode ? _.findShadowRoot(t.parentNode) : null; var e = t.getRootNode(); return e instanceof ShadowRoot ? e : null }
    };
    g.fn.emulateTransitionEnd = n, g.event.special[_.TRANSITION_END] = { bindType: e, delegateType: e, handle: function(t) { if (g(t.target).is(this)) return t.handleObj.handler.apply(this, arguments) } };
    var o = "alert",
        r = "bs.alert",
        a = "." + r,
        c = g.fn[o],
        h = { CLOSE: "close" + a, CLOSED: "closed" + a, CLICK_DATA_API: "click" + a + ".data-api" },
        f = "alert",
        d = "fade",
        m = "show",
        p = function() {
            function i(t) { this._element = t }
            var t = i.prototype;
            return t.close = function(t) {
                var e = this._element;
                t && (e = this._getRootElement(t)), this._triggerCloseEvent(e).isDefaultPrevented() || this._removeElement(e)
            }, t.dispose = function() { g.removeData(this._element, r), this._element = null }, t._getRootElement = function(t) {
                var e = _.getSelectorFromElement(t),
                    n = !1;
                return e && (n = document.querySelector(e)), n || (n = g(t).closest("." + f)[0]), n
            }, t._triggerCloseEvent = function(t) { var e = g.Event(h.CLOSE); return g(t).trigger(e), e }, t._removeElement = function(e) {
                var n = this;
                if (g(e).removeClass(m), g(e).hasClass(d)) {
                    var t = _.getTransitionDurationFromElement(e);
                    g(e).one(_.TRANSITION_END, function(t) { return n._destroyElement(e, t) }).emulateTransitionEnd(t)
                } else this._destroyElement(e)
            }, t._destroyElement = function(t) { g(t).detach().trigger(h.CLOSED).remove() }, i._jQueryInterface = function(n) {
                return this.each(function() {
                    var t = g(this),
                        e = t.data(r);
                    e || (e = new i(this), t.data(r, e)), "close" === n && e[n](this)
                })
            }, i._handleDismiss = function(e) { return function(t) { t && t.preventDefault(), e.close(this) } }, s(i, null, [{ key: "VERSION", get: function() { return "4.3.1" } }]), i
        }();
    g(document).on(h.CLICK_DATA_API, '[data-dismiss="alert"]', p._handleDismiss(new p)), g.fn[o] = p._jQueryInterface, g.fn[o].Constructor = p, g.fn[o].noConflict = function() { return g.fn[o] = c, p._jQueryInterface };
    var v = "button",
        y = "bs.button",
        E = "." + y,
        C = ".data-api",
        T = g.fn[v],
        S = "active",
        b = "btn",
        I = "focus",
        D = '[data-toggle^="button"]',
        w = '[data-toggle="buttons"]',
        A = 'input:not([type="hidden"])',
        N = ".active",
        O = ".btn",
        k = { CLICK_DATA_API: "click" + E + C, FOCUS_BLUR_DATA_API: "focus" + E + C + " blur" + E + C },
        P = function() {
            function n(t) { this._element = t }
            var t = n.prototype;
            return t.toggle = function() {
                var t = !0,
                    e = !0,
                    n = g(this._element).closest(w)[0];
                if (n) {
                    var i = this._element.querySelector(A);
                    if (i) {
                        if ("radio" === i.type)
                            if (i.checked && this._element.classList.contains(S)) t = !1;
                            else {
                                var o = n.querySelector(N);
                                o && g(o).removeClass(S)
                            }
                        if (t) {
                            if (i.hasAttribute("disabled") || n.hasAttribute("disabled") || i.classList.contains("disabled") || n.classList.contains("disabled")) return;
                            i.checked = !this._element.classList.contains(S), g(i).trigger("change")
                        }
                        i.focus(), e = !1
                    }
                }
                e && this._element.setAttribute("aria-pressed", !this._element.classList.contains(S)), t && g(this._element).toggleClass(S)
            }, t.dispose = function() { g.removeData(this._element, y), this._element = null }, n._jQueryInterface = function(e) {
                return this.each(function() {
                    var t = g(this).data(y);
                    t || (t = new n(this), g(this).data(y, t)), "toggle" === e && t[e]()
                })
            }, s(n, null, [{ key: "VERSION", get: function() { return "4.3.1" } }]), n
        }();
    g(document).on(k.CLICK_DATA_API, D, function(t) {
        t.preventDefault();
        var e = t.target;
        g(e).hasClass(b) || (e = g(e).closest(O)), P._jQueryInterface.call(g(e), "toggle")
    }).on(k.FOCUS_BLUR_DATA_API, D, function(t) {
        var e = g(t.target).closest(O)[0];
        g(e).toggleClass(I, /^focus(in)?$/.test(t.type))
    }), g.fn[v] = P._jQueryInterface, g.fn[v].Constructor = P, g.fn[v].noConflict = function() { return g.fn[v] = T, P._jQueryInterface };
    var L = "carousel",
        j = "bs.carousel",
        H = "." + j,
        R = ".data-api",
        x = g.fn[L],
        F = { interval: 5e3, keyboard: !0, slide: !1, pause: "hover", wrap: !0, touch: !0 },
        U = { interval: "(number|boolean)", keyboard: "boolean", slide: "(boolean|string)", pause: "(string|boolean)", wrap: "boolean", touch: "boolean" },
        W = "next",
        q = "prev",
        M = "left",
        K = "right",
        Q = { SLIDE: "slide" + H, SLID: "slid" + H, KEYDOWN: "keydown" + H, MOUSEENTER: "mouseenter" + H, MOUSELEAVE: "mouseleave" + H, TOUCHSTART: "touchstart" + H, TOUCHMOVE: "touchmove" + H, TOUCHEND: "touchend" + H, POINTERDOWN: "pointerdown" + H, POINTERUP: "pointerup" + H, DRAG_START: "dragstart" + H, LOAD_DATA_API: "load" + H + R, CLICK_DATA_API: "click" + H + R },
        B = "carousel",
        V = "active",
        Y = "slide",
        z = "carousel-item-right",
        X = "carousel-item-left",
        $ = "carousel-item-next",
        G = "carousel-item-prev",
        J = "pointer-event",
        Z = ".active",
        tt = ".active.carousel-item",
        et = ".carousel-item",
        nt = ".carousel-item img",
        it = ".carousel-item-next, .carousel-item-prev",
        ot = ".carousel-indicators",
        rt = "[data-slide], [data-slide-to]",
        st = '[data-ride="carousel"]',
        at = { TOUCH: "touch", PEN: "pen" },
        lt = function() {
            function r(t, e) { this._items = null, this._interval = null, this._activeElement = null, this._isPaused = !1, this._isSliding = !1, this.touchTimeout = null, this.touchStartX = 0, this.touchDeltaX = 0, this._config = this._getConfig(e), this._element = t, this._indicatorsElement = this._element.querySelector(ot), this._touchSupported = "ontouchstart" in document.documentElement || 0 < navigator.maxTouchPoints, this._pointerEvent = Boolean(window.PointerEvent || window.MSPointerEvent), this._addEventListeners() }
            var t = r.prototype;
            return t.next = function() { this._isSliding || this._slide(W) }, t.nextWhenVisible = function() {!document.hidden && g(this._element).is(":visible") && "hidden" !== g(this._element).css("visibility") && this.next() }, t.prev = function() { this._isSliding || this._slide(q) }, t.pause = function(t) { t || (this._isPaused = !0), this._element.querySelector(it) && (_.triggerTransitionEnd(this._element), this.cycle(!0)), clearInterval(this._interval), this._interval = null }, t.cycle = function(t) { t || (this._isPaused = !1), this._interval && (clearInterval(this._interval), this._interval = null), this._config.interval && !this._isPaused && (this._interval = setInterval((document.visibilityState ? this.nextWhenVisible : this.next).bind(this), this._config.interval)) }, t.to = function(t) {
                var e = this;
                this._activeElement = this._element.querySelector(tt);
                var n = this._getItemIndex(this._activeElement);
                if (!(t > this._items.length - 1 || t < 0))
                    if (this._isSliding) g(this._element).one(Q.SLID, function() { return e.to(t) });
                    else {
                        if (n === t) return this.pause(), void this.cycle();
                        var i = n < t ? W : q;
                        this._slide(i, this._items[t])
                    }
            }, t.dispose = function() { g(this._element).off(H), g.removeData(this._element, j), this._items = null, this._config = null, this._element = null, this._interval = null, this._isPaused = null, this._isSliding = null, this._activeElement = null, this._indicatorsElement = null }, t._getConfig = function(t) { return t = l({}, F, t), _.typeCheckConfig(L, t, U), t }, t._handleSwipe = function() {
                var t = Math.abs(this.touchDeltaX);
                if (!(t <= 40)) {
                    var e = t / this.touchDeltaX;
                    0 < e && this.prev(), e < 0 && this.next()
                }
            }, t._addEventListeners = function() {
                var e = this;
                this._config.keyboard && g(this._element).on(Q.KEYDOWN, function(t) { return e._keydown(t) }), "hover" === this._config.pause && g(this._element).on(Q.MOUSEENTER, function(t) { return e.pause(t) }).on(Q.MOUSELEAVE, function(t) { return e.cycle(t) }), this._config.touch && this._addTouchEventListeners()
            }, t._addTouchEventListeners = function() {
                var n = this;
                if (this._touchSupported) {
                    var e = function(t) { n._pointerEvent && at[t.originalEvent.pointerType.toUpperCase()] ? n.touchStartX = t.originalEvent.clientX : n._pointerEvent || (n.touchStartX = t.originalEvent.touches[0].clientX) },
                        i = function(t) { n._pointerEvent && at[t.originalEvent.pointerType.toUpperCase()] && (n.touchDeltaX = t.originalEvent.clientX - n.touchStartX), n._handleSwipe(), "hover" === n._config.pause && (n.pause(), n.touchTimeout && clearTimeout(n.touchTimeout), n.touchTimeout = setTimeout(function(t) { return n.cycle(t) }, 500 + n._config.interval)) };
                    g(this._element.querySelectorAll(nt)).on(Q.DRAG_START, function(t) { return t.preventDefault() }), this._pointerEvent ? (g(this._element).on(Q.POINTERDOWN, function(t) { return e(t) }), g(this._element).on(Q.POINTERUP, function(t) { return i(t) }), this._element.classList.add(J)) : (g(this._element).on(Q.TOUCHSTART, function(t) { return e(t) }), g(this._element).on(Q.TOUCHMOVE, function(t) {
                        var e;
                        (e = t).originalEvent.touches && 1 < e.originalEvent.touches.length ? n.touchDeltaX = 0 : n.touchDeltaX = e.originalEvent.touches[0].clientX - n.touchStartX
                    }), g(this._element).on(Q.TOUCHEND, function(t) { return i(t) }))
                }
            }, t._keydown = function(t) {
                if (!/input|textarea/i.test(t.target.tagName)) switch (t.which) {
                    case 37:
                        t.preventDefault(), this.prev();
                        break;
                    case 39:
                        t.preventDefault(), this.next()
                }
            }, t._getItemIndex = function(t) { return this._items = t && t.parentNode ? [].slice.call(t.parentNode.querySelectorAll(et)) : [], this._items.indexOf(t) }, t._getItemByDirection = function(t, e) {
                var n = t === W,
                    i = t === q,
                    o = this._getItemIndex(e),
                    r = this._items.length - 1;
                if ((i && 0 === o || n && o === r) && !this._config.wrap) return e;
                var s = (o + (t === q ? -1 : 1)) % this._items.length;
                return -1 === s ? this._items[this._items.length - 1] : this._items[s]
            }, t._triggerSlideEvent = function(t, e) {
                var n = this._getItemIndex(t),
                    i = this._getItemIndex(this._element.querySelector(tt)),
                    o = g.Event(Q.SLIDE, { relatedTarget: t, direction: e, from: i, to: n });
                return g(this._element).trigger(o), o
            }, t._setActiveIndicatorElement = function(t) {
                if (this._indicatorsElement) {
                    var e = [].slice.call(this._indicatorsElement.querySelectorAll(Z));
                    g(e).removeClass(V);
                    var n = this._indicatorsElement.children[this._getItemIndex(t)];
                    n && g(n).addClass(V)
                }
            }, t._slide = function(t, e) {
                var n, i, o, r = this,
                    s = this._element.querySelector(tt),
                    a = this._getItemIndex(s),
                    l = e || s && this._getItemByDirection(t, s),
                    c = this._getItemIndex(l),
                    h = Boolean(this._interval);
                if (o = t === W ? (n = X, i = $, M) : (n = z, i = G, K), l && g(l).hasClass(V)) this._isSliding = !1;
                else if (!this._triggerSlideEvent(l, o).isDefaultPrevented() && s && l) {
                    this._isSliding = !0, h && this.pause(), this._setActiveIndicatorElement(l);
                    var u = g.Event(Q.SLID, { relatedTarget: l, direction: o, from: a, to: c });
                    if (g(this._element).hasClass(Y)) {
                        g(l).addClass(i), _.reflow(l), g(s).addClass(n), g(l).addClass(n);
                        var f = parseInt(l.getAttribute("data-interval"), 10);
                        this._config.interval = f ? (this._config.defaultInterval = this._config.defaultInterval || this._config.interval, f) : this._config.defaultInterval || this._config.interval;
                        var d = _.getTransitionDurationFromElement(s);
                        g(s).one(_.TRANSITION_END, function() { g(l).removeClass(n + " " + i).addClass(V), g(s).removeClass(V + " " + i + " " + n), r._isSliding = !1, setTimeout(function() { return g(r._element).trigger(u) }, 0) }).emulateTransitionEnd(d)
                    } else g(s).removeClass(V), g(l).addClass(V), this._isSliding = !1, g(this._element).trigger(u);
                    h && this.cycle()
                }
            }, r._jQueryInterface = function(i) {
                return this.each(function() {
                    var t = g(this).data(j),
                        e = l({}, F, g(this).data());
                    "object" == typeof i && (e = l({}, e, i));
                    var n = "string" == typeof i ? i : e.slide;
                    if (t || (t = new r(this, e), g(this).data(j, t)), "number" == typeof i) t.to(i);
                    else if ("string" == typeof n) {
                        if ("undefined" == typeof t[n]) throw new TypeError('No method named "' + n + '"');
                        t[n]()
                    } else e.interval && e.ride && (t.pause(), t.cycle())
                })
            }, r._dataApiClickHandler = function(t) {
                var e = _.getSelectorFromElement(this);
                if (e) {
                    var n = g(e)[0];
                    if (n && g(n).hasClass(B)) {
                        var i = l({}, g(n).data(), g(this).data()),
                            o = this.getAttribute("data-slide-to");
                        o && (i.interval = !1), r._jQueryInterface.call(g(n), i), o && g(n).data(j).to(o), t.preventDefault()
                    }
                }
            }, s(r, null, [{ key: "VERSION", get: function() { return "4.3.1" } }, { key: "Default", get: function() { return F } }]), r
        }();
    g(document).on(Q.CLICK_DATA_API, rt, lt._dataApiClickHandler), g(window).on(Q.LOAD_DATA_API, function() {
        for (var t = [].slice.call(document.querySelectorAll(st)), e = 0, n = t.length; e < n; e++) {
            var i = g(t[e]);
            lt._jQueryInterface.call(i, i.data())
        }
    }), g.fn[L] = lt._jQueryInterface, g.fn[L].Constructor = lt, g.fn[L].noConflict = function() { return g.fn[L] = x, lt._jQueryInterface };
    var ct = "collapse",
        ht = "bs.collapse",
        ut = "." + ht,
        ft = g.fn[ct],
        dt = { toggle: !0, parent: "" },
        gt = { toggle: "boolean", parent: "(string|element)" },
        _t = { SHOW: "show" + ut, SHOWN: "shown" + ut, HIDE: "hide" + ut, HIDDEN: "hidden" + ut, CLICK_DATA_API: "click" + ut + ".data-api" },
        mt = "show",
        pt = "collapse",
        vt = "collapsing",
        yt = "collapsed",
        Et = "width",
        Ct = "height",
        Tt = ".show, .collapsing",
        St = '[data-toggle="collapse"]',
        bt = function() {
            function a(e, t) {
                this._isTransitioning = !1, this._element = e, this._config = this._getConfig(t), this._triggerArray = [].slice.call(document.querySelectorAll('[data-toggle="collapse"][href="#' + e.id + '"],[data-toggle="collapse"][data-target="#' + e.id + '"]'));
                for (var n = [].slice.call(document.querySelectorAll(St)), i = 0, o = n.length; i < o; i++) {
                    var r = n[i],
                        s = _.getSelectorFromElement(r),
                        a = [].slice.call(document.querySelectorAll(s)).filter(function(t) { return t === e });
                    null !== s && 0 < a.length && (this._selector = s, this._triggerArray.push(r))
                }
                this._parent = this._config.parent ? this._getParent() : null, this._config.parent || this._addAriaAndCollapsedClass(this._element, this._triggerArray), this._config.toggle && this.toggle()
            }
            var t = a.prototype;
            return t.toggle = function() { g(this._element).hasClass(mt) ? this.hide() : this.show() }, t.show = function() {
                var t, e, n = this;
                if (!this._isTransitioning && !g(this._element).hasClass(mt) && (this._parent && 0 === (t = [].slice.call(this._parent.querySelectorAll(Tt)).filter(function(t) { return "string" == typeof n._config.parent ? t.getAttribute("data-parent") === n._config.parent : t.classList.contains(pt) })).length && (t = null), !(t && (e = g(t).not(this._selector).data(ht)) && e._isTransitioning))) {
                    var i = g.Event(_t.SHOW);
                    if (g(this._element).trigger(i), !i.isDefaultPrevented()) {
                        t && (a._jQueryInterface.call(g(t).not(this._selector), "hide"), e || g(t).data(ht, null));
                        var o = this._getDimension();
                        g(this._element).removeClass(pt).addClass(vt), this._element.style[o] = 0, this._triggerArray.length && g(this._triggerArray).removeClass(yt).attr("aria-expanded", !0), this.setTransitioning(!0);
                        var r = "scroll" + (o[0].toUpperCase() + o.slice(1)),
                            s = _.getTransitionDurationFromElement(this._element);
                        g(this._element).one(_.TRANSITION_END, function() { g(n._element).removeClass(vt).addClass(pt).addClass(mt), n._element.style[o] = "", n.setTransitioning(!1), g(n._element).trigger(_t.SHOWN) }).emulateTransitionEnd(s), this._element.style[o] = this._element[r] + "px"
                    }
                }
            }, t.hide = function() {
                var t = this;
                if (!this._isTransitioning && g(this._element).hasClass(mt)) {
                    var e = g.Event(_t.HIDE);
                    if (g(this._element).trigger(e), !e.isDefaultPrevented()) {
                        var n = this._getDimension();
                        this._element.style[n] = this._element.getBoundingClientRect()[n] + "px", _.reflow(this._element), g(this._element).addClass(vt).removeClass(pt).removeClass(mt);
                        var i = this._triggerArray.length;
                        if (0 < i)
                            for (var o = 0; o < i; o++) {
                                var r = this._triggerArray[o],
                                    s = _.getSelectorFromElement(r);
                                if (null !== s) g([].slice.call(document.querySelectorAll(s))).hasClass(mt) || g(r).addClass(yt).attr("aria-expanded", !1)
                            }
                        this.setTransitioning(!0);
                        this._element.style[n] = "";
                        var a = _.getTransitionDurationFromElement(this._element);
                        g(this._element).one(_.TRANSITION_END, function() { t.setTransitioning(!1), g(t._element).removeClass(vt).addClass(pt).trigger(_t.HIDDEN) }).emulateTransitionEnd(a)
                    }
                }
            }, t.setTransitioning = function(t) { this._isTransitioning = t }, t.dispose = function() { g.removeData(this._element, ht), this._config = null, this._parent = null, this._element = null, this._triggerArray = null, this._isTransitioning = null }, t._getConfig = function(t) { return (t = l({}, dt, t)).toggle = Boolean(t.toggle), _.typeCheckConfig(ct, t, gt), t }, t._getDimension = function() { return g(this._element).hasClass(Et) ? Et : Ct }, t._getParent = function() {
                var t, n = this;
                _.isElement(this._config.parent) ? (t = this._config.parent, "undefined" != typeof this._config.parent.jquery && (t = this._config.parent[0])) : t = document.querySelector(this._config.parent);
                var e = '[data-toggle="collapse"][data-parent="' + this._config.parent + '"]',
                    i = [].slice.call(t.querySelectorAll(e));
                return g(i).each(function(t, e) { n._addAriaAndCollapsedClass(a._getTargetFromElement(e), [e]) }), t
            }, t._addAriaAndCollapsedClass = function(t, e) {
                var n = g(t).hasClass(mt);
                e.length && g(e).toggleClass(yt, !n).attr("aria-expanded", n)
            }, a._getTargetFromElement = function(t) { var e = _.getSelectorFromElement(t); return e ? document.querySelector(e) : null }, a._jQueryInterface = function(i) {
                return this.each(function() {
                    var t = g(this),
                        e = t.data(ht),
                        n = l({}, dt, t.data(), "object" == typeof i && i ? i : {});
                    if (!e && n.toggle && /show|hide/.test(i) && (n.toggle = !1), e || (e = new a(this, n), t.data(ht, e)), "string" == typeof i) {
                        if ("undefined" == typeof e[i]) throw new TypeError('No method named "' + i + '"');
                        e[i]()
                    }
                })
            }, s(a, null, [{ key: "VERSION", get: function() { return "4.3.1" } }, { key: "Default", get: function() { return dt } }]), a
        }();
    g(document).on(_t.CLICK_DATA_API, St, function(t) {
        "A" === t.currentTarget.tagName && t.preventDefault();
        var n = g(this),
            e = _.getSelectorFromElement(this),
            i = [].slice.call(document.querySelectorAll(e));
        g(i).each(function() {
            var t = g(this),
                e = t.data(ht) ? "toggle" : n.data();
            bt._jQueryInterface.call(t, e)
        })
    }), g.fn[ct] = bt._jQueryInterface, g.fn[ct].Constructor = bt, g.fn[ct].noConflict = function() { return g.fn[ct] = ft, bt._jQueryInterface };
    var It = "dropdown",
        Dt = "bs.dropdown",
        wt = "." + Dt,
        At = ".data-api",
        Nt = g.fn[It],
        Ot = new RegExp("38|40|27"),
        kt = { HIDE: "hide" + wt, HIDDEN: "hidden" + wt, SHOW: "show" + wt, SHOWN: "shown" + wt, CLICK: "click" + wt, CLICK_DATA_API: "click" + wt + At, KEYDOWN_DATA_API: "keydown" + wt + At, KEYUP_DATA_API: "keyup" + wt + At },
        Pt = "disabled",
        Lt = "show",
        jt = "dropup",
        Ht = "dropright",
        Rt = "dropleft",
        xt = "dropdown-menu-right",
        Ft = "position-static",
        Ut = '[data-toggle="dropdown"]',
        Wt = ".dropdown form",
        qt = ".dropdown-menu",
        Mt = ".navbar-nav",
        Kt = ".dropdown-menu .dropdown-item:not(.disabled):not(:disabled)",
        Qt = "top-start",
        Bt = "top-end",
        Vt = "bottom-start",
        Yt = "bottom-end",
        zt = "right-start",
        Xt = "left-start",
        $t = { offset: 0, flip: !0, boundary: "scrollParent", reference: "toggle", display: "dynamic" },
        Gt = { offset: "(number|string|function)", flip: "boolean", boundary: "(string|element)", reference: "(string|element)", display: "string" },
        Jt = function() {
            function c(t, e) { this._element = t, this._popper = null, this._config = this._getConfig(e), this._menu = this._getMenuElement(), this._inNavbar = this._detectNavbar(), this._addEventListeners() }
            var t = c.prototype;
            return t.toggle = function() {
                if (!this._element.disabled && !g(this._element).hasClass(Pt)) {
                    var t = c._getParentFromElement(this._element),
                        e = g(this._menu).hasClass(Lt);
                    if (c._clearMenus(), !e) {
                        var n = { relatedTarget: this._element },
                            i = g.Event(kt.SHOW, n);
                        if (g(t).trigger(i), !i.isDefaultPrevented()) { if (!this._inNavbar) { if ("undefined" == typeof u) throw new TypeError("Bootstrap's dropdowns require Popper.js (https://popper.js.org/)"); var o = this._element; "parent" === this._config.reference ? o = t : _.isElement(this._config.reference) && (o = this._config.reference, "undefined" != typeof this._config.reference.jquery && (o = this._config.reference[0])), "scrollParent" !== this._config.boundary && g(t).addClass(Ft), this._popper = new u(o, this._menu, this._getPopperConfig()) } "ontouchstart" in document.documentElement && 0 === g(t).closest(Mt).length && g(document.body).children().on("mouseover", null, g.noop), this._element.focus(), this._element.setAttribute("aria-expanded", !0), g(this._menu).toggleClass(Lt), g(t).toggleClass(Lt).trigger(g.Event(kt.SHOWN, n)) }
                    }
                }
            }, t.show = function() {
                if (!(this._element.disabled || g(this._element).hasClass(Pt) || g(this._menu).hasClass(Lt))) {
                    var t = { relatedTarget: this._element },
                        e = g.Event(kt.SHOW, t),
                        n = c._getParentFromElement(this._element);
                    g(n).trigger(e), e.isDefaultPrevented() || (g(this._menu).toggleClass(Lt), g(n).toggleClass(Lt).trigger(g.Event(kt.SHOWN, t)))
                }
            }, t.hide = function() {
                if (!this._element.disabled && !g(this._element).hasClass(Pt) && g(this._menu).hasClass(Lt)) {
                    var t = { relatedTarget: this._element },
                        e = g.Event(kt.HIDE, t),
                        n = c._getParentFromElement(this._element);
                    g(n).trigger(e), e.isDefaultPrevented() || (g(this._menu).toggleClass(Lt), g(n).toggleClass(Lt).trigger(g.Event(kt.HIDDEN, t)))
                }
            }, t.dispose = function() { g.removeData(this._element, Dt), g(this._element).off(wt), this._element = null, (this._menu = null) !== this._popper && (this._popper.destroy(), this._popper = null) }, t.update = function() { this._inNavbar = this._detectNavbar(), null !== this._popper && this._popper.scheduleUpdate() }, t._addEventListeners = function() {
                var e = this;
                g(this._element).on(kt.CLICK, function(t) { t.preventDefault(), t.stopPropagation(), e.toggle() })
            }, t._getConfig = function(t) { return t = l({}, this.constructor.Default, g(this._element).data(), t), _.typeCheckConfig(It, t, this.constructor.DefaultType), t }, t._getMenuElement = function() {
                if (!this._menu) {
                    var t = c._getParentFromElement(this._element);
                    t && (this._menu = t.querySelector(qt))
                }
                return this._menu
            }, t._getPlacement = function() {
                var t = g(this._element.parentNode),
                    e = Vt;
                return t.hasClass(jt) ? (e = Qt, g(this._menu).hasClass(xt) && (e = Bt)) : t.hasClass(Ht) ? e = zt : t.hasClass(Rt) ? e = Xt : g(this._menu).hasClass(xt) && (e = Yt), e
            }, t._detectNavbar = function() { return 0 < g(this._element).closest(".navbar").length }, t._getOffset = function() {
                var e = this,
                    t = {};
                return "function" == typeof this._config.offset ? t.fn = function(t) { return t.offsets = l({}, t.offsets, e._config.offset(t.offsets, e._element) || {}), t } : t.offset = this._config.offset, t
            }, t._getPopperConfig = function() { var t = { placement: this._getPlacement(), modifiers: { offset: this._getOffset(), flip: { enabled: this._config.flip }, preventOverflow: { boundariesElement: this._config.boundary } } }; return "static" === this._config.display && (t.modifiers.applyStyle = { enabled: !1 }), t }, c._jQueryInterface = function(e) {
                return this.each(function() {
                    var t = g(this).data(Dt);
                    if (t || (t = new c(this, "object" == typeof e ? e : null), g(this).data(Dt, t)), "string" == typeof e) {
                        if ("undefined" == typeof t[e]) throw new TypeError('No method named "' + e + '"');
                        t[e]()
                    }
                })
            }, c._clearMenus = function(t) {
                if (!t || 3 !== t.which && ("keyup" !== t.type || 9 === t.which))
                    for (var e = [].slice.call(document.querySelectorAll(Ut)), n = 0, i = e.length; n < i; n++) {
                        var o = c._getParentFromElement(e[n]),
                            r = g(e[n]).data(Dt),
                            s = { relatedTarget: e[n] };
                        if (t && "click" === t.type && (s.clickEvent = t), r) {
                            var a = r._menu;
                            if (g(o).hasClass(Lt) && !(t && ("click" === t.type && /input|textarea/i.test(t.target.tagName) || "keyup" === t.type && 9 === t.which) && g.contains(o, t.target))) {
                                var l = g.Event(kt.HIDE, s);
                                g(o).trigger(l), l.isDefaultPrevented() || ("ontouchstart" in document.documentElement && g(document.body).children().off("mouseover", null, g.noop), e[n].setAttribute("aria-expanded", "false"), g(a).removeClass(Lt), g(o).removeClass(Lt).trigger(g.Event(kt.HIDDEN, s)))
                            }
                        }
                    }
            }, c._getParentFromElement = function(t) { var e, n = _.getSelectorFromElement(t); return n && (e = document.querySelector(n)), e || t.parentNode }, c._dataApiKeydownHandler = function(t) {
                if ((/input|textarea/i.test(t.target.tagName) ? !(32 === t.which || 27 !== t.which && (40 !== t.which && 38 !== t.which || g(t.target).closest(qt).length)) : Ot.test(t.which)) && (t.preventDefault(), t.stopPropagation(), !this.disabled && !g(this).hasClass(Pt))) {
                    var e = c._getParentFromElement(this),
                        n = g(e).hasClass(Lt);
                    if (n && (!n || 27 !== t.which && 32 !== t.which)) {
                        var i = [].slice.call(e.querySelectorAll(Kt));
                        if (0 !== i.length) {
                            var o = i.indexOf(t.target);
                            38 === t.which && 0 < o && o--, 40 === t.which && o < i.length - 1 && o++, o < 0 && (o = 0), i[o].focus()
                        }
                    } else {
                        if (27 === t.which) {
                            var r = e.querySelector(Ut);
                            g(r).trigger("focus")
                        }
                        g(this).trigger("click")
                    }
                }
            }, s(c, null, [{ key: "VERSION", get: function() { return "4.3.1" } }, { key: "Default", get: function() { return $t } }, { key: "DefaultType", get: function() { return Gt } }]), c
        }();
    g(document).on(kt.KEYDOWN_DATA_API, Ut, Jt._dataApiKeydownHandler).on(kt.KEYDOWN_DATA_API, qt, Jt._dataApiKeydownHandler).on(kt.CLICK_DATA_API + " " + kt.KEYUP_DATA_API, Jt._clearMenus).on(kt.CLICK_DATA_API, Ut, function(t) { t.preventDefault(), t.stopPropagation(), Jt._jQueryInterface.call(g(this), "toggle") }).on(kt.CLICK_DATA_API, Wt, function(t) { t.stopPropagation() }), g.fn[It] = Jt._jQueryInterface, g.fn[It].Constructor = Jt, g.fn[It].noConflict = function() { return g.fn[It] = Nt, Jt._jQueryInterface };
    var Zt = "modal",
        te = "bs.modal",
        ee = "." + te,
        ne = g.fn[Zt],
        ie = { backdrop: !0, keyboard: !0, focus: !0, show: !0 },
        oe = { backdrop: "(boolean|string)", keyboard: "boolean", focus: "boolean", show: "boolean" },
        re = { HIDE: "hide" + ee, HIDDEN: "hidden" + ee, SHOW: "show" + ee, SHOWN: "shown" + ee, FOCUSIN: "focusin" + ee, RESIZE: "resize" + ee, CLICK_DISMISS: "click.dismiss" + ee, KEYDOWN_DISMISS: "keydown.dismiss" + ee, MOUSEUP_DISMISS: "mouseup.dismiss" + ee, MOUSEDOWN_DISMISS: "mousedown.dismiss" + ee, CLICK_DATA_API: "click" + ee + ".data-api" },
        se = "modal-dialog-scrollable",
        ae = "modal-scrollbar-measure",
        le = "modal-backdrop",
        ce = "modal-open",
        he = "fade",
        ue = "show",
        fe = ".modal-dialog",
        de = ".modal-body",
        ge = '[data-toggle="modal"]',
        _e = '[data-dismiss="modal"]',
        me = ".fixed-top, .fixed-bottom, .is-fixed, .sticky-top",
        pe = ".sticky-top",
        ve = function() {
            function o(t, e) { this._config = this._getConfig(e), this._element = t, this._dialog = t.querySelector(fe), this._backdrop = null, this._isShown = !1, this._isBodyOverflowing = !1, this._ignoreBackdropClick = !1, this._isTransitioning = !1, this._scrollbarWidth = 0 }
            var t = o.prototype;
            return t.toggle = function(t) { return this._isShown ? this.hide() : this.show(t) }, t.show = function(t) {
                var e = this;
                if (!this._isShown && !this._isTransitioning) {
                    g(this._element).hasClass(he) && (this._isTransitioning = !0);
                    var n = g.Event(re.SHOW, { relatedTarget: t });
                    g(this._element).trigger(n), this._isShown || n.isDefaultPrevented() || (this._isShown = !0, this._checkScrollbar(), this._setScrollbar(), this._adjustDialog(), this._setEscapeEvent(), this._setResizeEvent(), g(this._element).on(re.CLICK_DISMISS, _e, function(t) { return e.hide(t) }), g(this._dialog).on(re.MOUSEDOWN_DISMISS, function() { g(e._element).one(re.MOUSEUP_DISMISS, function(t) { g(t.target).is(e._element) && (e._ignoreBackdropClick = !0) }) }), this._showBackdrop(function() { return e._showElement(t) }))
                }
            }, t.hide = function(t) {
                var e = this;
                if (t && t.preventDefault(), this._isShown && !this._isTransitioning) {
                    var n = g.Event(re.HIDE);
                    if (g(this._element).trigger(n), this._isShown && !n.isDefaultPrevented()) {
                        this._isShown = !1;
                        var i = g(this._element).hasClass(he);
                        if (i && (this._isTransitioning = !0), this._setEscapeEvent(), this._setResizeEvent(), g(document).off(re.FOCUSIN), g(this._element).removeClass(ue), g(this._element).off(re.CLICK_DISMISS), g(this._dialog).off(re.MOUSEDOWN_DISMISS), i) {
                            var o = _.getTransitionDurationFromElement(this._element);
                            g(this._element).one(_.TRANSITION_END, function(t) { return e._hideModal(t) }).emulateTransitionEnd(o)
                        } else this._hideModal()
                    }
                }
            }, t.dispose = function() {
                [window, this._element, this._dialog].forEach(function(t) { return g(t).off(ee) }), g(document).off(re.FOCUSIN), g.removeData(this._element, te), this._config = null, this._element = null, this._dialog = null, this._backdrop = null, this._isShown = null, this._isBodyOverflowing = null, this._ignoreBackdropClick = null, this._isTransitioning = null, this._scrollbarWidth = null
            }, t.handleUpdate = function() { this._adjustDialog() }, t._getConfig = function(t) { return t = l({}, ie, t), _.typeCheckConfig(Zt, t, oe), t }, t._showElement = function(t) {
                var e = this,
                    n = g(this._element).hasClass(he);
                this._element.parentNode && this._element.parentNode.nodeType === Node.ELEMENT_NODE || document.body.appendChild(this._element), this._element.style.display = "block", this._element.removeAttribute("aria-hidden"), this._element.setAttribute("aria-modal", !0), g(this._dialog).hasClass(se) ? this._dialog.querySelector(de).scrollTop = 0 : this._element.scrollTop = 0, n && _.reflow(this._element), g(this._element).addClass(ue), this._config.focus && this._enforceFocus();
                var i = g.Event(re.SHOWN, { relatedTarget: t }),
                    o = function() { e._config.focus && e._element.focus(), e._isTransitioning = !1, g(e._element).trigger(i) };
                if (n) {
                    var r = _.getTransitionDurationFromElement(this._dialog);
                    g(this._dialog).one(_.TRANSITION_END, o).emulateTransitionEnd(r)
                } else o()
            }, t._enforceFocus = function() {
                var e = this;
                g(document).off(re.FOCUSIN).on(re.FOCUSIN, function(t) { document !== t.target && e._element !== t.target && 0 === g(e._element).has(t.target).length && e._element.focus() })
            }, t._setEscapeEvent = function() {
                var e = this;
                this._isShown && this._config.keyboard ? g(this._element).on(re.KEYDOWN_DISMISS, function(t) { 27 === t.which && (t.preventDefault(), e.hide()) }) : this._isShown || g(this._element).off(re.KEYDOWN_DISMISS)
            }, t._setResizeEvent = function() {
                var e = this;
                this._isShown ? g(window).on(re.RESIZE, function(t) { return e.handleUpdate(t) }) : g(window).off(re.RESIZE)
            }, t._hideModal = function() {
                var t = this;
                this._element.style.display = "none", this._element.setAttribute("aria-hidden", !0), this._element.removeAttribute("aria-modal"), this._isTransitioning = !1, this._showBackdrop(function() { g(document.body).removeClass(ce), t._resetAdjustments(), t._resetScrollbar(), g(t._element).trigger(re.HIDDEN) })
            }, t._removeBackdrop = function() { this._backdrop && (g(this._backdrop).remove(), this._backdrop = null) }, t._showBackdrop = function(t) {
                var e = this,
                    n = g(this._element).hasClass(he) ? he : "";
                if (this._isShown && this._config.backdrop) {
                    if (this._backdrop = document.createElement("div"), this._backdrop.className = le, n && this._backdrop.classList.add(n), g(this._backdrop).appendTo(document.body), g(this._element).on(re.CLICK_DISMISS, function(t) { e._ignoreBackdropClick ? e._ignoreBackdropClick = !1 : t.target === t.currentTarget && ("static" === e._config.backdrop ? e._element.focus() : e.hide()) }), n && _.reflow(this._backdrop), g(this._backdrop).addClass(ue), !t) return;
                    if (!n) return void t();
                    var i = _.getTransitionDurationFromElement(this._backdrop);
                    g(this._backdrop).one(_.TRANSITION_END, t).emulateTransitionEnd(i)
                } else if (!this._isShown && this._backdrop) {
                    g(this._backdrop).removeClass(ue);
                    var o = function() { e._removeBackdrop(), t && t() };
                    if (g(this._element).hasClass(he)) {
                        var r = _.getTransitionDurationFromElement(this._backdrop);
                        g(this._backdrop).one(_.TRANSITION_END, o).emulateTransitionEnd(r)
                    } else o()
                } else t && t()
            }, t._adjustDialog = function() { var t = this._element.scrollHeight > document.documentElement.clientHeight;!this._isBodyOverflowing && t && (this._element.style.paddingLeft = this._scrollbarWidth + "px"), this._isBodyOverflowing && !t && (this._element.style.paddingRight = this._scrollbarWidth + "px") }, t._resetAdjustments = function() { this._element.style.paddingLeft = "", this._element.style.paddingRight = "" }, t._checkScrollbar = function() {
                var t = document.body.getBoundingClientRect();
                this._isBodyOverflowing = t.left + t.right < window.innerWidth, this._scrollbarWidth = this._getScrollbarWidth()
            }, t._setScrollbar = function() {
                var o = this;
                if (this._isBodyOverflowing) {
                    var t = [].slice.call(document.querySelectorAll(me)),
                        e = [].slice.call(document.querySelectorAll(pe));
                    g(t).each(function(t, e) {
                        var n = e.style.paddingRight,
                            i = g(e).css("padding-right");
                        g(e).data("padding-right", n).css("padding-right", parseFloat(i) + o._scrollbarWidth + "px")
                    }), g(e).each(function(t, e) {
                        var n = e.style.marginRight,
                            i = g(e).css("margin-right");
                        g(e).data("margin-right", n).css("margin-right", parseFloat(i) - o._scrollbarWidth + "px")
                    });
                    var n = document.body.style.paddingRight,
                        i = g(document.body).css("padding-right");
                    g(document.body).data("padding-right", n).css("padding-right", parseFloat(i) + this._scrollbarWidth + "px")
                }
                g(document.body).addClass(ce)
            }, t._resetScrollbar = function() {
                var t = [].slice.call(document.querySelectorAll(me));
                g(t).each(function(t, e) {
                    var n = g(e).data("padding-right");
                    g(e).removeData("padding-right"), e.style.paddingRight = n || ""
                });
                var e = [].slice.call(document.querySelectorAll("" + pe));
                g(e).each(function(t, e) { var n = g(e).data("margin-right"); "undefined" != typeof n && g(e).css("margin-right", n).removeData("margin-right") });
                var n = g(document.body).data("padding-right");
                g(document.body).removeData("padding-right"), document.body.style.paddingRight = n || ""
            }, t._getScrollbarWidth = function() {
                var t = document.createElement("div");
                t.className = ae, document.body.appendChild(t);
                var e = t.getBoundingClientRect().width - t.clientWidth;
                return document.body.removeChild(t), e
            }, o._jQueryInterface = function(n, i) {
                return this.each(function() {
                    var t = g(this).data(te),
                        e = l({}, ie, g(this).data(), "object" == typeof n && n ? n : {});
                    if (t || (t = new o(this, e), g(this).data(te, t)), "string" == typeof n) {
                        if ("undefined" == typeof t[n]) throw new TypeError('No method named "' + n + '"');
                        t[n](i)
                    } else e.show && t.show(i)
                })
            }, s(o, null, [{ key: "VERSION", get: function() { return "4.3.1" } }, { key: "Default", get: function() { return ie } }]), o
        }();
    g(document).on(re.CLICK_DATA_API, ge, function(t) {
        var e, n = this,
            i = _.getSelectorFromElement(this);
        i && (e = document.querySelector(i));
        var o = g(e).data(te) ? "toggle" : l({}, g(e).data(), g(this).data());
        "A" !== this.tagName && "AREA" !== this.tagName || t.preventDefault();
        var r = g(e).one(re.SHOW, function(t) { t.isDefaultPrevented() || r.one(re.HIDDEN, function() { g(n).is(":visible") && n.focus() }) });
        ve._jQueryInterface.call(g(e), o, this)
    }), g.fn[Zt] = ve._jQueryInterface, g.fn[Zt].Constructor = ve, g.fn[Zt].noConflict = function() { return g.fn[Zt] = ne, ve._jQueryInterface };
    var ye = ["background", "cite", "href", "itemtype", "longdesc", "poster", "src", "xlink:href"],
        Ee = { "*": ["class", "dir", "id", "lang", "role", /^aria-[\w-]*$/i], a: ["target", "href", "title", "rel"], area: [], b: [], br: [], col: [], code: [], div: [], em: [], hr: [], h1: [], h2: [], h3: [], h4: [], h5: [], h6: [], i: [], img: ["src", "alt", "title", "width", "height"], li: [], ol: [], p: [], pre: [], s: [], small: [], span: [], sub: [], sup: [], strong: [], u: [], ul: [] },
        Ce = /^(?:(?:https?|mailto|ftp|tel|file):|[^&:/?#]*(?:[/?#]|$))/gi,
        Te = /^data:(?:image\/(?:bmp|gif|jpeg|jpg|png|tiff|webp)|video\/(?:mpeg|mp4|ogg|webm)|audio\/(?:mp3|oga|ogg|opus));base64,[a-z0-9+/]+=*$/i;

    function Se(t, s, e) {
        if (0 === t.length) return t;
        if (e && "function" == typeof e) return e(t);
        for (var n = (new window.DOMParser).parseFromString(t, "text/html"), a = Object.keys(s), l = [].slice.call(n.body.querySelectorAll("*")), i = function(t, e) {
                var n = l[t],
                    i = n.nodeName.toLowerCase();
                if (-1 === a.indexOf(n.nodeName.toLowerCase())) return n.parentNode.removeChild(n), "continue";
                var o = [].slice.call(n.attributes),
                    r = [].concat(s["*"] || [], s[i] || []);
                o.forEach(function(t) {
                    (function(t, e) {
                        var n = t.nodeName.toLowerCase();
                        if (-1 !== e.indexOf(n)) return -1 === ye.indexOf(n) || Boolean(t.nodeValue.match(Ce) || t.nodeValue.match(Te));
                        for (var i = e.filter(function(t) { return t instanceof RegExp }), o = 0, r = i.length; o < r; o++)
                            if (n.match(i[o])) return !0;
                        return !1
                    })(t, r) || n.removeAttribute(t.nodeName)
                })
            }, o = 0, r = l.length; o < r; o++) i(o);
        return n.body.innerHTML
    }
    var be = "tooltip",
        Ie = "bs.tooltip",
        De = "." + Ie,
        we = g.fn[be],
        Ae = "bs-tooltip",
        Ne = new RegExp("(^|\\s)" + Ae + "\\S+", "g"),
        Oe = ["sanitize", "whiteList", "sanitizeFn"],
        ke = { animation: "boolean", template: "string", title: "(string|element|function)", trigger: "string", delay: "(number|object)", html: "boolean", selector: "(string|boolean)", placement: "(string|function)", offset: "(number|string|function)", container: "(string|element|boolean)", fallbackPlacement: "(string|array)", boundary: "(string|element)", sanitize: "boolean", sanitizeFn: "(null|function)", whiteList: "object" },
        Pe = { AUTO: "auto", TOP: "top", RIGHT: "right", BOTTOM: "bottom", LEFT: "left" },
        Le = { animation: !0, template: '<div class="tooltip" role="tooltip"><div class="arrow"></div><div class="tooltip-inner"></div></div>', trigger: "hover focus", title: "", delay: 0, html: !1, selector: !1, placement: "top", offset: 0, container: !1, fallbackPlacement: "flip", boundary: "scrollParent", sanitize: !0, sanitizeFn: null, whiteList: Ee },
        je = "show",
        He = "out",
        Re = { HIDE: "hide" + De, HIDDEN: "hidden" + De, SHOW: "show" + De, SHOWN: "shown" + De, INSERTED: "inserted" + De, CLICK: "click" + De, FOCUSIN: "focusin" + De, FOCUSOUT: "focusout" + De, MOUSEENTER: "mouseenter" + De, MOUSELEAVE: "mouseleave" + De },
        xe = "fade",
        Fe = "show",
        Ue = ".tooltip-inner",
        We = ".arrow",
        qe = "hover",
        Me = "focus",
        Ke = "click",
        Qe = "manual",
        Be = function() {
            function i(t, e) {
                if ("undefined" == typeof u) throw new TypeError("Bootstrap's tooltips require Popper.js (https://popper.js.org/)");
                this._isEnabled = !0, this._timeout = 0, this._hoverState = "", this._activeTrigger = {}, this._popper = null, this.element = t, this.config = this._getConfig(e), this.tip = null, this._setListeners()
            }
            var t = i.prototype;
            return t.enable = function() { this._isEnabled = !0 }, t.disable = function() { this._isEnabled = !1 }, t.toggleEnabled = function() { this._isEnabled = !this._isEnabled }, t.toggle = function(t) {
                if (this._isEnabled)
                    if (t) {
                        var e = this.constructor.DATA_KEY,
                            n = g(t.currentTarget).data(e);
                        n || (n = new this.constructor(t.currentTarget, this._getDelegateConfig()), g(t.currentTarget).data(e, n)), n._activeTrigger.click = !n._activeTrigger.click, n._isWithActiveTrigger() ? n._enter(null, n) : n._leave(null, n)
                    } else {
                        if (g(this.getTipElement()).hasClass(Fe)) return void this._leave(null, this);
                        this._enter(null, this)
                    }
            }, t.dispose = function() { clearTimeout(this._timeout), g.removeData(this.element, this.constructor.DATA_KEY), g(this.element).off(this.constructor.EVENT_KEY), g(this.element).closest(".modal").off("hide.bs.modal"), this.tip && g(this.tip).remove(), this._isEnabled = null, this._timeout = null, this._hoverState = null, (this._activeTrigger = null) !== this._popper && this._popper.destroy(), this._popper = null, this.element = null, this.config = null, this.tip = null }, t.show = function() {
                var e = this;
                if ("none" === g(this.element).css("display")) throw new Error("Please use show on visible elements");
                var t = g.Event(this.constructor.Event.SHOW);
                if (this.isWithContent() && this._isEnabled) {
                    g(this.element).trigger(t);
                    var n = _.findShadowRoot(this.element),
                        i = g.contains(null !== n ? n : this.element.ownerDocument.documentElement, this.element);
                    if (t.isDefaultPrevented() || !i) return;
                    var o = this.getTipElement(),
                        r = _.getUID(this.constructor.NAME);
                    o.setAttribute("id", r), this.element.setAttribute("aria-describedby", r), this.setContent(), this.config.animation && g(o).addClass(xe);
                    var s = "function" == typeof this.config.placement ? this.config.placement.call(this, o, this.element) : this.config.placement,
                        a = this._getAttachment(s);
                    this.addAttachmentClass(a);
                    var l = this._getContainer();
                    g(o).data(this.constructor.DATA_KEY, this), g.contains(this.element.ownerDocument.documentElement, this.tip) || g(o).appendTo(l), g(this.element).trigger(this.constructor.Event.INSERTED), this._popper = new u(this.element, o, { placement: a, modifiers: { offset: this._getOffset(), flip: { behavior: this.config.fallbackPlacement }, arrow: { element: We }, preventOverflow: { boundariesElement: this.config.boundary } }, onCreate: function(t) { t.originalPlacement !== t.placement && e._handlePopperPlacementChange(t) }, onUpdate: function(t) { return e._handlePopperPlacementChange(t) } }), g(o).addClass(Fe), "ontouchstart" in document.documentElement && g(document.body).children().on("mouseover", null, g.noop);
                    var c = function() {
                        e.config.animation && e._fixTransition();
                        var t = e._hoverState;
                        e._hoverState = null, g(e.element).trigger(e.constructor.Event.SHOWN), t === He && e._leave(null, e)
                    };
                    if (g(this.tip).hasClass(xe)) {
                        var h = _.getTransitionDurationFromElement(this.tip);
                        g(this.tip).one(_.TRANSITION_END, c).emulateTransitionEnd(h)
                    } else c()
                }
            }, t.hide = function(t) {
                var e = this,
                    n = this.getTipElement(),
                    i = g.Event(this.constructor.Event.HIDE),
                    o = function() { e._hoverState !== je && n.parentNode && n.parentNode.removeChild(n), e._cleanTipClass(), e.element.removeAttribute("aria-describedby"), g(e.element).trigger(e.constructor.Event.HIDDEN), null !== e._popper && e._popper.destroy(), t && t() };
                if (g(this.element).trigger(i), !i.isDefaultPrevented()) {
                    if (g(n).removeClass(Fe), "ontouchstart" in document.documentElement && g(document.body).children().off("mouseover", null, g.noop), this._activeTrigger[Ke] = !1, this._activeTrigger[Me] = !1, this._activeTrigger[qe] = !1, g(this.tip).hasClass(xe)) {
                        var r = _.getTransitionDurationFromElement(n);
                        g(n).one(_.TRANSITION_END, o).emulateTransitionEnd(r)
                    } else o();
                    this._hoverState = ""
                }
            }, t.update = function() { null !== this._popper && this._popper.scheduleUpdate() }, t.isWithContent = function() { return Boolean(this.getTitle()) }, t.addAttachmentClass = function(t) { g(this.getTipElement()).addClass(Ae + "-" + t) }, t.getTipElement = function() { return this.tip = this.tip || g(this.config.template)[0], this.tip }, t.setContent = function() {
                var t = this.getTipElement();
                this.setElementContent(g(t.querySelectorAll(Ue)), this.getTitle()), g(t).removeClass(xe + " " + Fe)
            }, t.setElementContent = function(t, e) { "object" != typeof e || !e.nodeType && !e.jquery ? this.config.html ? (this.config.sanitize && (e = Se(e, this.config.whiteList, this.config.sanitizeFn)), t.html(e)) : t.text(e) : this.config.html ? g(e).parent().is(t) || t.empty().append(e) : t.text(g(e).text()) }, t.getTitle = function() { var t = this.element.getAttribute("data-original-title"); return t || (t = "function" == typeof this.config.title ? this.config.title.call(this.element) : this.config.title), t }, t._getOffset = function() {
                var e = this,
                    t = {};
                return "function" == typeof this.config.offset ? t.fn = function(t) { return t.offsets = l({}, t.offsets, e.config.offset(t.offsets, e.element) || {}), t } : t.offset = this.config.offset, t
            }, t._getContainer = function() { return !1 === this.config.container ? document.body : _.isElement(this.config.container) ? g(this.config.container) : g(document).find(this.config.container) }, t._getAttachment = function(t) { return Pe[t.toUpperCase()] }, t._setListeners = function() {
                var i = this;
                this.config.trigger.split(" ").forEach(function(t) {
                    if ("click" === t) g(i.element).on(i.constructor.Event.CLICK, i.config.selector, function(t) { return i.toggle(t) });
                    else if (t !== Qe) {
                        var e = t === qe ? i.constructor.Event.MOUSEENTER : i.constructor.Event.FOCUSIN,
                            n = t === qe ? i.constructor.Event.MOUSELEAVE : i.constructor.Event.FOCUSOUT;
                        g(i.element).on(e, i.config.selector, function(t) { return i._enter(t) }).on(n, i.config.selector, function(t) { return i._leave(t) })
                    }
                }), g(this.element).closest(".modal").on("hide.bs.modal", function() { i.element && i.hide() }), this.config.selector ? this.config = l({}, this.config, { trigger: "manual", selector: "" }) : this._fixTitle()
            }, t._fixTitle = function() {
                var t = typeof this.element.getAttribute("data-original-title");
                (this.element.getAttribute("title") || "string" !== t) && (this.element.setAttribute("data-original-title", this.element.getAttribute("title") || ""), this.element.setAttribute("title", ""))
            }, t._enter = function(t, e) {
                var n = this.constructor.DATA_KEY;
                (e = e || g(t.currentTarget).data(n)) || (e = new this.constructor(t.currentTarget, this._getDelegateConfig()), g(t.currentTarget).data(n, e)), t && (e._activeTrigger["focusin" === t.type ? Me : qe] = !0), g(e.getTipElement()).hasClass(Fe) || e._hoverState === je ? e._hoverState = je : (clearTimeout(e._timeout), e._hoverState = je, e.config.delay && e.config.delay.show ? e._timeout = setTimeout(function() { e._hoverState === je && e.show() }, e.config.delay.show) : e.show())
            }, t._leave = function(t, e) {
                var n = this.constructor.DATA_KEY;
                (e = e || g(t.currentTarget).data(n)) || (e = new this.constructor(t.currentTarget, this._getDelegateConfig()), g(t.currentTarget).data(n, e)), t && (e._activeTrigger["focusout" === t.type ? Me : qe] = !1), e._isWithActiveTrigger() || (clearTimeout(e._timeout), e._hoverState = He, e.config.delay && e.config.delay.hide ? e._timeout = setTimeout(function() { e._hoverState === He && e.hide() }, e.config.delay.hide) : e.hide())
            }, t._isWithActiveTrigger = function() {
                for (var t in this._activeTrigger)
                    if (this._activeTrigger[t]) return !0;
                return !1
            }, t._getConfig = function(t) { var e = g(this.element).data(); return Object.keys(e).forEach(function(t) {-1 !== Oe.indexOf(t) && delete e[t] }), "number" == typeof(t = l({}, this.constructor.Default, e, "object" == typeof t && t ? t : {})).delay && (t.delay = { show: t.delay, hide: t.delay }), "number" == typeof t.title && (t.title = t.title.toString()), "number" == typeof t.content && (t.content = t.content.toString()), _.typeCheckConfig(be, t, this.constructor.DefaultType), t.sanitize && (t.template = Se(t.template, t.whiteList, t.sanitizeFn)), t }, t._getDelegateConfig = function() {
                var t = {};
                if (this.config)
                    for (var e in this.config) this.constructor.Default[e] !== this.config[e] && (t[e] = this.config[e]);
                return t
            }, t._cleanTipClass = function() {
                var t = g(this.getTipElement()),
                    e = t.attr("class").match(Ne);
                null !== e && e.length && t.removeClass(e.join(""))
            }, t._handlePopperPlacementChange = function(t) {
                var e = t.instance;
                this.tip = e.popper, this._cleanTipClass(), this.addAttachmentClass(this._getAttachment(t.placement))
            }, t._fixTransition = function() {
                var t = this.getTipElement(),
                    e = this.config.animation;
                null === t.getAttribute("x-placement") && (g(t).removeClass(xe), this.config.animation = !1, this.hide(), this.show(), this.config.animation = e)
            }, i._jQueryInterface = function(n) {
                return this.each(function() {
                    var t = g(this).data(Ie),
                        e = "object" == typeof n && n;
                    if ((t || !/dispose|hide/.test(n)) && (t || (t = new i(this, e), g(this).data(Ie, t)), "string" == typeof n)) {
                        if ("undefined" == typeof t[n]) throw new TypeError('No method named "' + n + '"');
                        t[n]()
                    }
                })
            }, s(i, null, [{ key: "VERSION", get: function() { return "4.3.1" } }, { key: "Default", get: function() { return Le } }, { key: "NAME", get: function() { return be } }, { key: "DATA_KEY", get: function() { return Ie } }, { key: "Event", get: function() { return Re } }, { key: "EVENT_KEY", get: function() { return De } }, { key: "DefaultType", get: function() { return ke } }]), i
        }();
    g.fn[be] = Be._jQueryInterface, g.fn[be].Constructor = Be, g.fn[be].noConflict = function() { return g.fn[be] = we, Be._jQueryInterface };
    var Ve = "popover",
        Ye = "bs.popover",
        ze = "." + Ye,
        Xe = g.fn[Ve],
        $e = "bs-popover",
        Ge = new RegExp("(^|\\s)" + $e + "\\S+", "g"),
        Je = l({}, Be.Default, { placement: "right", trigger: "click", content: "", template: '<div class="popover" role="tooltip"><div class="arrow"></div><h3 class="popover-header"></h3><div class="popover-body"></div></div>' }),
        Ze = l({}, Be.DefaultType, { content: "(string|element|function)" }),
        tn = "fade",
        en = "show",
        nn = ".popover-header",
        on = ".popover-body",
        rn = { HIDE: "hide" + ze, HIDDEN: "hidden" + ze, SHOW: "show" + ze, SHOWN: "shown" + ze, INSERTED: "inserted" + ze, CLICK: "click" + ze, FOCUSIN: "focusin" + ze, FOCUSOUT: "focusout" + ze, MOUSEENTER: "mouseenter" + ze, MOUSELEAVE: "mouseleave" + ze },
        sn = function(t) {
            var e, n;

            function i() { return t.apply(this, arguments) || this }
            n = t, (e = i).prototype = Object.create(n.prototype), (e.prototype.constructor = e).__proto__ = n;
            var o = i.prototype;
            return o.isWithContent = function() { return this.getTitle() || this._getContent() }, o.addAttachmentClass = function(t) { g(this.getTipElement()).addClass($e + "-" + t) }, o.getTipElement = function() { return this.tip = this.tip || g(this.config.template)[0], this.tip }, o.setContent = function() {
                var t = g(this.getTipElement());
                this.setElementContent(t.find(nn), this.getTitle());
                var e = this._getContent();
                "function" == typeof e && (e = e.call(this.element)), this.setElementContent(t.find(on), e), t.removeClass(tn + " " + en)
            }, o._getContent = function() { return this.element.getAttribute("data-content") || this.config.content }, o._cleanTipClass = function() {
                var t = g(this.getTipElement()),
                    e = t.attr("class").match(Ge);
                null !== e && 0 < e.length && t.removeClass(e.join(""))
            }, i._jQueryInterface = function(n) {
                return this.each(function() {
                    var t = g(this).data(Ye),
                        e = "object" == typeof n ? n : null;
                    if ((t || !/dispose|hide/.test(n)) && (t || (t = new i(this, e), g(this).data(Ye, t)), "string" == typeof n)) {
                        if ("undefined" == typeof t[n]) throw new TypeError('No method named "' + n + '"');
                        t[n]()
                    }
                })
            }, s(i, null, [{ key: "VERSION", get: function() { return "4.3.1" } }, { key: "Default", get: function() { return Je } }, { key: "NAME", get: function() { return Ve } }, { key: "DATA_KEY", get: function() { return Ye } }, { key: "Event", get: function() { return rn } }, { key: "EVENT_KEY", get: function() { return ze } }, { key: "DefaultType", get: function() { return Ze } }]), i
        }(Be);
    g.fn[Ve] = sn._jQueryInterface, g.fn[Ve].Constructor = sn, g.fn[Ve].noConflict = function() { return g.fn[Ve] = Xe, sn._jQueryInterface };
    var an = "scrollspy",
        ln = "bs.scrollspy",
        cn = "." + ln,
        hn = g.fn[an],
        un = { offset: 10, method: "auto", target: "" },
        fn = { offset: "number", method: "string", target: "(string|element)" },
        dn = { ACTIVATE: "activate" + cn, SCROLL: "scroll" + cn, LOAD_DATA_API: "load" + cn + ".data-api" },
        gn = "dropdown-item",
        _n = "active",
        mn = '[data-spy="scroll"]',
        pn = ".nav, .list-group",
        vn = ".nav-link",
        yn = ".nav-item",
        En = ".list-group-item",
        Cn = ".dropdown",
        Tn = ".dropdown-item",
        Sn = ".dropdown-toggle",
        bn = "offset",
        In = "position",
        Dn = function() {
            function n(t, e) {
                var n = this;
                this._element = t, this._scrollElement = "BODY" === t.tagName ? window : t, this._config = this._getConfig(e), this._selector = this._config.target + " " + vn + "," + this._config.target + " " + En + "," + this._config.target + " " + Tn, this._offsets = [], this._targets = [], this._activeTarget = null, this._scrollHeight = 0, g(this._scrollElement).on(dn.SCROLL, function(t) { return n._process(t) }), this.refresh(), this._process()
            }
            var t = n.prototype;
            return t.refresh = function() {
                var e = this,
                    t = this._scrollElement === this._scrollElement.window ? bn : In,
                    o = "auto" === this._config.method ? t : this._config.method,
                    r = o === In ? this._getScrollTop() : 0;
                this._offsets = [], this._targets = [], this._scrollHeight = this._getScrollHeight(), [].slice.call(document.querySelectorAll(this._selector)).map(function(t) { var e, n = _.getSelectorFromElement(t); if (n && (e = document.querySelector(n)), e) { var i = e.getBoundingClientRect(); if (i.width || i.height) return [g(e)[o]().top + r, n] } return null }).filter(function(t) { return t }).sort(function(t, e) { return t[0] - e[0] }).forEach(function(t) { e._offsets.push(t[0]), e._targets.push(t[1]) })
            }, t.dispose = function() { g.removeData(this._element, ln), g(this._scrollElement).off(cn), this._element = null, this._scrollElement = null, this._config = null, this._selector = null, this._offsets = null, this._targets = null, this._activeTarget = null, this._scrollHeight = null }, t._getConfig = function(t) {
                if ("string" != typeof(t = l({}, un, "object" == typeof t && t ? t : {})).target) {
                    var e = g(t.target).attr("id");
                    e || (e = _.getUID(an), g(t.target).attr("id", e)), t.target = "#" + e
                }
                return _.typeCheckConfig(an, t, fn), t
            }, t._getScrollTop = function() { return this._scrollElement === window ? this._scrollElement.pageYOffset : this._scrollElement.scrollTop }, t._getScrollHeight = function() { return this._scrollElement.scrollHeight || Math.max(document.body.scrollHeight, document.documentElement.scrollHeight) }, t._getOffsetHeight = function() { return this._scrollElement === window ? window.innerHeight : this._scrollElement.getBoundingClientRect().height }, t._process = function() {
                var t = this._getScrollTop() + this._config.offset,
                    e = this._getScrollHeight(),
                    n = this._config.offset + e - this._getOffsetHeight();
                if (this._scrollHeight !== e && this.refresh(), n <= t) {
                    var i = this._targets[this._targets.length - 1];
                    this._activeTarget !== i && this._activate(i)
                } else { if (this._activeTarget && t < this._offsets[0] && 0 < this._offsets[0]) return this._activeTarget = null, void this._clear(); for (var o = this._offsets.length; o--;) { this._activeTarget !== this._targets[o] && t >= this._offsets[o] && ("undefined" == typeof this._offsets[o + 1] || t < this._offsets[o + 1]) && this._activate(this._targets[o]) } }
            }, t._activate = function(e) {
                this._activeTarget = e, this._clear();
                var t = this._selector.split(",").map(function(t) { return t + '[data-target="' + e + '"],' + t + '[href="' + e + '"]' }),
                    n = g([].slice.call(document.querySelectorAll(t.join(","))));
                n.hasClass(gn) ? (n.closest(Cn).find(Sn).addClass(_n), n.addClass(_n)) : (n.addClass(_n), n.parents(pn).prev(vn + ", " + En).addClass(_n), n.parents(pn).prev(yn).children(vn).addClass(_n)), g(this._scrollElement).trigger(dn.ACTIVATE, { relatedTarget: e })
            }, t._clear = function() {
                [].slice.call(document.querySelectorAll(this._selector)).filter(function(t) { return t.classList.contains(_n) }).forEach(function(t) { return t.classList.remove(_n) })
            }, n._jQueryInterface = function(e) {
                return this.each(function() {
                    var t = g(this).data(ln);
                    if (t || (t = new n(this, "object" == typeof e && e), g(this).data(ln, t)), "string" == typeof e) {
                        if ("undefined" == typeof t[e]) throw new TypeError('No method named "' + e + '"');
                        t[e]()
                    }
                })
            }, s(n, null, [{ key: "VERSION", get: function() { return "4.3.1" } }, { key: "Default", get: function() { return un } }]), n
        }();
    g(window).on(dn.LOAD_DATA_API, function() {
        for (var t = [].slice.call(document.querySelectorAll(mn)), e = t.length; e--;) {
            var n = g(t[e]);
            Dn._jQueryInterface.call(n, n.data())
        }
    }), g.fn[an] = Dn._jQueryInterface, g.fn[an].Constructor = Dn, g.fn[an].noConflict = function() { return g.fn[an] = hn, Dn._jQueryInterface };
    var wn = "bs.tab",
        An = "." + wn,
        Nn = g.fn.tab,
        On = { HIDE: "hide" + An, HIDDEN: "hidden" + An, SHOW: "show" + An, SHOWN: "shown" + An, CLICK_DATA_API: "click" + An + ".data-api" },
        kn = "dropdown-menu",
        Pn = "active",
        Ln = "disabled",
        jn = "fade",
        Hn = "show",
        Rn = ".dropdown",
        xn = ".nav, .list-group",
        Fn = ".active",
        Un = "> li > .active",
        Wn = '[data-toggle="tab"], [data-toggle="pill"], [data-toggle="list"]',
        qn = ".dropdown-toggle",
        Mn = "> .dropdown-menu .active",
        Kn = function() {
            function i(t) { this._element = t }
            var t = i.prototype;
            return t.show = function() {
                var n = this;
                if (!(this._element.parentNode && this._element.parentNode.nodeType === Node.ELEMENT_NODE && g(this._element).hasClass(Pn) || g(this._element).hasClass(Ln))) {
                    var t, i, e = g(this._element).closest(xn)[0],
                        o = _.getSelectorFromElement(this._element);
                    if (e) {
                        var r = "UL" === e.nodeName || "OL" === e.nodeName ? Un : Fn;
                        i = (i = g.makeArray(g(e).find(r)))[i.length - 1]
                    }
                    var s = g.Event(On.HIDE, { relatedTarget: this._element }),
                        a = g.Event(On.SHOW, { relatedTarget: i });
                    if (i && g(i).trigger(s), g(this._element).trigger(a), !a.isDefaultPrevented() && !s.isDefaultPrevented()) {
                        o && (t = document.querySelector(o)), this._activate(this._element, e);
                        var l = function() {
                            var t = g.Event(On.HIDDEN, { relatedTarget: n._element }),
                                e = g.Event(On.SHOWN, { relatedTarget: i });
                            g(i).trigger(t), g(n._element).trigger(e)
                        };
                        t ? this._activate(t, t.parentNode, l) : l()
                    }
                }
            }, t.dispose = function() { g.removeData(this._element, wn), this._element = null }, t._activate = function(t, e, n) {
                var i = this,
                    o = (!e || "UL" !== e.nodeName && "OL" !== e.nodeName ? g(e).children(Fn) : g(e).find(Un))[0],
                    r = n && o && g(o).hasClass(jn),
                    s = function() { return i._transitionComplete(t, o, n) };
                if (o && r) {
                    var a = _.getTransitionDurationFromElement(o);
                    g(o).removeClass(Hn).one(_.TRANSITION_END, s).emulateTransitionEnd(a)
                } else s()
            }, t._transitionComplete = function(t, e, n) {
                if (e) {
                    g(e).removeClass(Pn);
                    var i = g(e.parentNode).find(Mn)[0];
                    i && g(i).removeClass(Pn), "tab" === e.getAttribute("role") && e.setAttribute("aria-selected", !1)
                }
                if (g(t).addClass(Pn), "tab" === t.getAttribute("role") && t.setAttribute("aria-selected", !0), _.reflow(t), t.classList.contains(jn) && t.classList.add(Hn), t.parentNode && g(t.parentNode).hasClass(kn)) {
                    var o = g(t).closest(Rn)[0];
                    if (o) {
                        var r = [].slice.call(o.querySelectorAll(qn));
                        g(r).addClass(Pn)
                    }
                    t.setAttribute("aria-expanded", !0)
                }
                n && n()
            }, i._jQueryInterface = function(n) {
                return this.each(function() {
                    var t = g(this),
                        e = t.data(wn);
                    if (e || (e = new i(this), t.data(wn, e)), "string" == typeof n) {
                        if ("undefined" == typeof e[n]) throw new TypeError('No method named "' + n + '"');
                        e[n]()
                    }
                })
            }, s(i, null, [{ key: "VERSION", get: function() { return "4.3.1" } }]), i
        }();
    g(document).on(On.CLICK_DATA_API, Wn, function(t) { t.preventDefault(), Kn._jQueryInterface.call(g(this), "show") }), g.fn.tab = Kn._jQueryInterface, g.fn.tab.Constructor = Kn, g.fn.tab.noConflict = function() { return g.fn.tab = Nn, Kn._jQueryInterface };
    var Qn = "toast",
        Bn = "bs.toast",
        Vn = "." + Bn,
        Yn = g.fn[Qn],
        zn = { CLICK_DISMISS: "click.dismiss" + Vn, HIDE: "hide" + Vn, HIDDEN: "hidden" + Vn, SHOW: "show" + Vn, SHOWN: "shown" + Vn },
        Xn = "fade",
        $n = "hide",
        Gn = "show",
        Jn = "showing",
        Zn = { animation: "boolean", autohide: "boolean", delay: "number" },
        ti = { animation: !0, autohide: !0, delay: 500 },
        ei = '[data-dismiss="toast"]',
        ni = function() {
            function i(t, e) { this._element = t, this._config = this._getConfig(e), this._timeout = null, this._setListeners() }
            var t = i.prototype;
            return t.show = function() {
                var t = this;
                g(this._element).trigger(zn.SHOW), this._config.animation && this._element.classList.add(Xn);
                var e = function() { t._element.classList.remove(Jn), t._element.classList.add(Gn), g(t._element).trigger(zn.SHOWN), t._config.autohide && t.hide() };
                if (this._element.classList.remove($n), this._element.classList.add(Jn), this._config.animation) {
                    var n = _.getTransitionDurationFromElement(this._element);
                    g(this._element).one(_.TRANSITION_END, e).emulateTransitionEnd(n)
                } else e()
            }, t.hide = function(t) {
                var e = this;
                this._element.classList.contains(Gn) && (g(this._element).trigger(zn.HIDE), t ? this._close() : this._timeout = setTimeout(function() { e._close() }, this._config.delay))
            }, t.dispose = function() { clearTimeout(this._timeout), this._timeout = null, this._element.classList.contains(Gn) && this._element.classList.remove(Gn), g(this._element).off(zn.CLICK_DISMISS), g.removeData(this._element, Bn), this._element = null, this._config = null }, t._getConfig = function(t) { return t = l({}, ti, g(this._element).data(), "object" == typeof t && t ? t : {}), _.typeCheckConfig(Qn, t, this.constructor.DefaultType), t }, t._setListeners = function() {
                var t = this;
                g(this._element).on(zn.CLICK_DISMISS, ei, function() { return t.hide(!0) })
            }, t._close = function() {
                var t = this,
                    e = function() { t._element.classList.add($n), g(t._element).trigger(zn.HIDDEN) };
                if (this._element.classList.remove(Gn), this._config.animation) {
                    var n = _.getTransitionDurationFromElement(this._element);
                    g(this._element).one(_.TRANSITION_END, e).emulateTransitionEnd(n)
                } else e()
            }, i._jQueryInterface = function(n) {
                return this.each(function() {
                    var t = g(this),
                        e = t.data(Bn);
                    if (e || (e = new i(this, "object" == typeof n && n), t.data(Bn, e)), "string" == typeof n) {
                        if ("undefined" == typeof e[n]) throw new TypeError('No method named "' + n + '"');
                        e[n](this)
                    }
                })
            }, s(i, null, [{ key: "VERSION", get: function() { return "4.3.1" } }, { key: "DefaultType", get: function() { return Zn } }, { key: "Default", get: function() { return ti } }]), i
        }();
    g.fn[Qn] = ni._jQueryInterface, g.fn[Qn].Constructor = ni, g.fn[Qn].noConflict = function() { return g.fn[Qn] = Yn, ni._jQueryInterface },
        function() { if ("undefined" == typeof g) throw new TypeError("Bootstrap's JavaScript requires jQuery. jQuery must be included before Bootstrap's JavaScript."); var t = g.fn.jquery.split(" ")[0].split("."); if (t[0] < 2 && t[1] < 9 || 1 === t[0] && 9 === t[1] && t[2] < 1 || 4 <= t[0]) throw new Error("Bootstrap's JavaScript requires at least jQuery v1.9.1 but less than v4.0.0") }(), t.Util = _, t.Alert = p, t.Button = P, t.Carousel = lt, t.Collapse = bt, t.Dropdown = Jt, t.Modal = ve, t.Popover = sn, t.Scrollspy = Dn, t.Tab = Kn, t.Toast = ni, t.Tooltip = Be, Object.defineProperty(t, "__esModule", { value: !0 })
});

//----- countdown.js
! function() {
    $.fn.lofCountDown = function(a) { return this.each(function() { new $.lofCountDown(this, a) }) }, $.lofCountDown = function(a, b) {
        if (this.options = $.extend({ autoStart: !0, LeadingZero: !0, DisplayFormat: "<div>%%D%% Days</div><div>%%H%% Hours</div><div>%%M%% Minutes</div><div>%%S%% Seconds</div>", FinishMessage: "Expired", CountActive: !0, TargetDate: null }, b || {}), null != this.options.TargetDate && "" != this.options.TargetDate) {
            this.timer = null, this.element = a, this.CountStepper = -1, this.CountStepper = Math.ceil(this.CountStepper), this.SetTimeOutPeriod = 1e3 * (Math.abs(this.CountStepper) - 1) + 990;
            var c = new Date(this.options.TargetDate),
                d = new Date;
            ddiff = new Date(this.CountStepper > 0 ? d - c : c - d), gsecs = Math.floor(ddiff.valueOf() / 1e3), this.CountBack(gsecs, this)
        }
    }, $.lofCountDown.fn = $.lofCountDown.prototype, $.lofCountDown.fn.extend = $.lofCountDown.extend = $.extend, $.lofCountDown.fn.extend({ calculateDate: function(a, b, c) { var d = (Math.floor(a / b) % c).toString(); return this.options.LeadingZero && d.length < 2 && (d = "0" + d), "<b>" + d + "</b>" }, CountBack: function(a, b) { return a < 0 ? void(b.element.innerHTML = '<div class="lof-labelexpired"> ' + b.options.FinishMessage + "</div>") : (clearInterval(b.timer), DisplayStr = b.options.DisplayFormat.replace(/%%D%%/g, b.calculateDate(a, 86400, 1e5)), DisplayStr = DisplayStr.replace(/%%H%%/g, b.calculateDate(a, 3600, 24)), DisplayStr = DisplayStr.replace(/%%M%%/g, b.calculateDate(a, 60, 60)), DisplayStr = DisplayStr.replace(/%%S%%/g, b.calculateDate(a, 1, 60)), b.element.innerHTML = DisplayStr, void(b.options.CountActive && (b.timer = null, b.timer = setTimeout(function() { b.CountBack(a + b.CountStepper, b) }, b.SetTimeOutPeriod)))) } })
}(jQuery);

//---------- jquery.history.js
"object" != typeof JSON && (JSON = {}),
    function() {
        "use strict";

        function f(a) { return a < 10 ? "0" + a : a }

        function quote(a) { return escapable.lastIndex = 0, escapable.test(a) ? '"' + a.replace(escapable, function(a) { var b = meta[a]; return "string" == typeof b ? b : "\\u" + ("0000" + a.charCodeAt(0).toString(16)).slice(-4) }) + '"' : '"' + a + '"' }

        function str(a, b) {
            var c, d, e, f, h, g = gap,
                i = b[a];
            switch (i && "object" == typeof i && "function" == typeof i.toJSON && (i = i.toJSON(a)), "function" == typeof rep && (i = rep.call(b, a, i)), typeof i) {
                case "string":
                    return quote(i);
                case "number":
                    return isFinite(i) ? String(i) : "null";
                case "boolean":
                case "null":
                    return String(i);
                case "object":
                    if (!i) return "null";
                    if (gap += indent, h = [], "[object Array]" === Object.prototype.toString.apply(i)) { for (f = i.length, c = 0; c < f; c += 1) h[c] = str(c, i) || "null"; return e = 0 === h.length ? "[]" : gap ? "[\n" + gap + h.join(",\n" + gap) + "\n" + g + "]" : "[" + h.join(",") + "]", gap = g, e }
                    if (rep && "object" == typeof rep)
                        for (f = rep.length, c = 0; c < f; c += 1) "string" == typeof rep[c] && (d = rep[c], e = str(d, i), e && h.push(quote(d) + (gap ? ": " : ":") + e));
                    else
                        for (d in i) Object.prototype.hasOwnProperty.call(i, d) && (e = str(d, i), e && h.push(quote(d) + (gap ? ": " : ":") + e));
                    return e = 0 === h.length ? "{}" : gap ? "{\n" + gap + h.join(",\n" + gap) + "\n" + g + "}" : "{" + h.join(",") + "}", gap = g, e
            }
        }
        "function" != typeof Date.prototype.toJSON && (Date.prototype.toJSON = function() { return isFinite(this.valueOf()) ? this.getUTCFullYear() + "-" + f(this.getUTCMonth() + 1) + "-" + f(this.getUTCDate()) + "T" + f(this.getUTCHours()) + ":" + f(this.getUTCMinutes()) + ":" + f(this.getUTCSeconds()) + "Z" : null }, String.prototype.toJSON = Number.prototype.toJSON = Boolean.prototype.toJSON = function() { return this.valueOf() });
        var cx = /[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
            escapable = /[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
            gap, indent, meta = { "\b": "\\b", "	": "\\t", "\n": "\\n", "\f": "\\f", "\r": "\\r", '"': '\\"', "\\": "\\\\" },
            rep;
        "function" != typeof JSON.stringify && (JSON.stringify = function(a, b, c) {
            var d;
            if (gap = "", indent = "", "number" == typeof c)
                for (d = 0; d < c; d += 1) indent += " ";
            else "string" == typeof c && (indent = c);
            if (rep = b, !b || "function" == typeof b || "object" == typeof b && "number" == typeof b.length) return str("", { "": a });
            throw new Error("JSON.stringify")
        }), "function" != typeof JSON.parse && (JSON.parse = function(text, reviver) {
            function walk(a, b) {
                var c, d, e = a[b];
                if (e && "object" == typeof e)
                    for (c in e) Object.prototype.hasOwnProperty.call(e, c) && (d = walk(e, c), void 0 !== d ? e[c] = d : delete e[c]);
                return reviver.call(a, b, e)
            }
            var j;
            if (text = String(text), cx.lastIndex = 0, cx.test(text) && (text = text.replace(cx, function(a) { return "\\u" + ("0000" + a.charCodeAt(0).toString(16)).slice(-4) })), /^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g, "@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g, "]").replace(/(?:^|:|,)(?:\s*\[)+/g, ""))) return j = eval("(" + text + ")"), "function" == typeof reviver ? walk({ "": j }, "") : j;
            throw new SyntaxError("JSON.parse")
        })
    }(),
    function(a, b) {
        "use strict";
        var c = a.History = a.History || {},
            d = a.jQuery;
        if ("undefined" != typeof c.Adapter) throw new Error("History.js Adapter has already been loaded...");
        c.Adapter = { bind: function(a, b, c) { d(a).bind(b, c) }, trigger: function(a, b, c) { d(a).trigger(b, c) }, extractEventData: function(a, c, d) { var e = c && c.originalEvent && c.originalEvent[a] || d && d[a] || b; return e }, onDomLoad: function(a) { d(a) } }, "undefined" != typeof c.init && c.init()
    }(window),
    function(a) {
        "use strict";
        var c = a.document,
            d = a.setTimeout || d,
            e = a.clearTimeout || e,
            f = a.setInterval || f,
            g = a.History = a.History || {};
        if ("undefined" != typeof g.initHtml4) throw new Error("History.js HTML4 Support has already been loaded...");
        g.initHtml4 = function() {
            return "undefined" != typeof g.initHtml4.initialized ? !1 : (g.initHtml4.initialized = !0, g.enabled = !0, g.savedHashes = [], g.isLastHash = function(a) { var c, b = g.getHashByIndex(); return c = a === b }, g.isHashEqual = function(a, b) { return a = encodeURIComponent(a).replace(/%25/g, "%"), b = encodeURIComponent(b).replace(/%25/g, "%"), a === b }, g.saveHash = function(a) { return g.isLastHash(a) ? !1 : (g.savedHashes.push(a), !0) }, g.getHashByIndex = function(a) { var b = null; return b = "undefined" == typeof a ? g.savedHashes[g.savedHashes.length - 1] : a < 0 ? g.savedHashes[g.savedHashes.length + a] : g.savedHashes[a] }, g.discardedHashes = {}, g.discardedStates = {}, g.discardState = function(a, b, c) { var e, d = g.getHashByState(a); return e = { discardedState: a, backState: c, forwardState: b }, g.discardedStates[d] = e, !0 }, g.discardHash = function(a, b, c) { var d = { discardedHash: a, backState: c, forwardState: b }; return g.discardedHashes[a] = d, !0 }, g.discardedState = function(a) { var c, b = g.getHashByState(a); return c = g.discardedStates[b] || !1 }, g.discardedHash = function(a) { var b = g.discardedHashes[a] || !1; return b }, g.recycleState = function(a) { var b = g.getHashByState(a); return g.discardedState(a) && delete g.discardedStates[b], !0 }, g.emulated.hashChange && (g.hashChangeInit = function() {
                g.checkerFunction = null;
                var d, e, h, i, b = "",
                    j = Boolean(g.getHash());
                return g.isInternetExplorer() ? (d = "historyjs-iframe", e = c.createElement("iframe"), e.setAttribute("id", d), e.setAttribute("src", "#"), e.style.display = "none", c.body.appendChild(e), e.contentWindow.document.open(), e.contentWindow.document.close(), h = "", i = !1, g.checkerFunction = function() {
                    if (i) return !1;
                    i = !0;
                    var c = g.getHash(),
                        d = g.getHash(e.contentWindow.document);
                    return c !== b ? (b = c, d !== c && (h = d = c, e.contentWindow.document.open(), e.contentWindow.document.close(), e.contentWindow.document.location.hash = g.escapeHash(c)), g.Adapter.trigger(a, "hashchange")) : d !== h && (h = d, j && "" === d ? g.back() : g.setHash(d, !1)), i = !1, !0
                }) : g.checkerFunction = function() { var c = g.getHash() || ""; return c !== b && (b = c, g.Adapter.trigger(a, "hashchange")), !0 }, g.intervalList.push(f(g.checkerFunction, g.options.hashChangeInterval)), !0
            }, g.Adapter.onDomLoad(g.hashChangeInit)), g.emulated.pushState && (g.onHashChange = function(b) {
                var i, c = b && b.newURL || g.getLocationHref(),
                    d = g.getHashByUrl(c),
                    e = null,
                    f = null;
                return g.isLastHash(d) ? (g.busy(!1), !1) : (g.doubleCheckComplete(), g.saveHash(d), d && g.isTraditionalAnchor(d) ? (g.Adapter.trigger(a, "anchorchange"), g.busy(!1), !1) : (e = g.extractState(g.getFullUrl(d || g.getLocationHref()), !0), g.isLastSavedState(e) ? (g.busy(!1), !1) : (f = g.getHashByState(e), i = g.discardedState(e), i ? (g.getHashByIndex(-2) === g.getHashByState(i.forwardState) ? g.back(!1) : g.forward(!1), !1) : (g.pushState(e.data, e.title, encodeURI(e.url), !1), !0))))
            }, g.Adapter.bind(a, "hashchange", g.onHashChange), g.pushState = function(b, c, d, e) {
                if (d = encodeURI(d).replace(/%25/g, "%"), g.getHashByUrl(d)) throw new Error("History.js does not support states with fragment-identifiers (hashes/anchors).");
                if (e !== !1 && g.busy()) return g.pushQueue({ scope: g, callback: g.pushState, args: arguments, queue: e }), !1;
                g.busy(!0);
                var f = g.createStateObject(b, c, d),
                    h = g.getHashByState(f),
                    i = g.getState(!1),
                    j = g.getHashByState(i),
                    k = g.getHash(),
                    l = g.expectedStateId == f.id;
                return g.storeState(f), g.expectedStateId = f.id, g.recycleState(f), g.setTitle(f), h === j ? (g.busy(!1), !1) : (g.saveState(f), l || g.Adapter.trigger(a, "statechange"), !g.isHashEqual(h, k) && !g.isHashEqual(h, g.getShortUrl(g.getLocationHref())) && g.setHash(h, !1), g.busy(!1), !0)
            }, g.replaceState = function(b, c, d, e) {
                if (d = encodeURI(d).replace(/%25/g, "%"), g.getHashByUrl(d)) throw new Error("History.js does not support states with fragment-identifiers (hashes/anchors).");
                if (e !== !1 && g.busy()) return g.pushQueue({ scope: g, callback: g.replaceState, args: arguments, queue: e }), !1;
                g.busy(!0);
                var f = g.createStateObject(b, c, d),
                    h = g.getHashByState(f),
                    i = g.getState(!1),
                    j = g.getHashByState(i),
                    k = g.getStateByIndex(-2);
                return g.discardState(i, f, k), h === j ? (g.storeState(f), g.expectedStateId = f.id, g.recycleState(f), g.setTitle(f), g.saveState(f), g.Adapter.trigger(a, "statechange"), g.busy(!1)) : g.pushState(f.data, f.title, f.url, !1), !0
            }), g.emulated.pushState && g.getHash() && !g.emulated.hashChange && g.Adapter.onDomLoad(function() { g.Adapter.trigger(a, "hashchange") }), void 0)
        }, "undefined" != typeof g.init && g.init()
    }(window),
    function(a, b) {
        "use strict";
        var c = a.console || b,
            d = a.document,
            e = a.navigator,
            f = !1,
            g = a.setTimeout,
            h = a.clearTimeout,
            i = a.setInterval,
            j = a.clearInterval,
            k = a.JSON,
            l = a.alert,
            m = a.History = a.History || {},
            n = a.history;
        try { f = a.sessionStorage, f.setItem("TEST", "1"), f.removeItem("TEST") } catch (o) { f = !1 }
        if (k.stringify = k.stringify || k.encode, k.parse = k.parse || k.decode, "undefined" != typeof m.init) throw new Error("History.js Core has already been loaded...");
        m.init = function() { return "undefined" == typeof m.Adapter ? !1 : ("undefined" != typeof m.initCore && m.initCore(), "undefined" != typeof m.initHtml4 && m.initHtml4(), !0) }, m.initCore = function() {
            if ("undefined" != typeof m.initCore.initialized) return !1;
            if (m.initCore.initialized = !0, m.options = m.options || {}, m.options.hashChangeInterval = m.options.hashChangeInterval || 100, m.options.safariPollInterval = m.options.safariPollInterval || 500, m.options.doubleCheckInterval = m.options.doubleCheckInterval || 500, m.options.disableSuid = m.options.disableSuid || !1, m.options.storeInterval = m.options.storeInterval || 1e3, m.options.busyDelay = m.options.busyDelay || 250, m.options.debug = m.options.debug || !1, m.options.initialTitle = m.options.initialTitle || d.title, m.options.html4Mode = m.options.html4Mode || !1, m.options.delayInit = m.options.delayInit || !1, m.intervalList = [], m.clearAllIntervals = function() {
                    var a, b = m.intervalList;
                    if ("undefined" != typeof b && null !== b) {
                        for (a = 0; a < b.length; a++) j(b[a]);
                        m.intervalList = null
                    }
                }, m.debug = function() {
                    (m.options.debug || !1) && m.log.apply(m, arguments)
                }, m.log = function() {
                    var e, f, g, h, i, a = "undefined" != typeof c && "undefined" != typeof c.log && "undefined" != typeof c.log.apply,
                        b = d.getElementById("log");
                    for (a ? (h = Array.prototype.slice.call(arguments), e = h.shift(), "undefined" != typeof c.debug ? c.debug.apply(c, [e, h]) : c.log.apply(c, [e, h])) : e = "\n" + arguments[0] + "\n", f = 1, g = arguments.length; f < g; ++f) {
                        if (i = arguments[f], "object" == typeof i && "undefined" != typeof k) try { i = k.stringify(i) } catch (j) {}
                        e += "\n" + i + "\n"
                    }
                    return b ? (b.value += e + "\n-----\n", b.scrollTop = b.scrollHeight - b.clientHeight) : a || l(e), !0
                }, m.getInternetExplorerMajorVersion = function() {
                    var a = m.getInternetExplorerMajorVersion.cached = "undefined" != typeof m.getInternetExplorerMajorVersion.cached ? m.getInternetExplorerMajorVersion.cached : function() {
                        for (var a = 3, b = d.createElement("div"), c = b.getElementsByTagName("i");
                            (b.innerHTML = "<!--[if gt IE " + ++a + "]><i></i><![endif]-->") && c[0];);
                        return a > 4 ? a : !1
                    }();
                    return a
                }, m.isInternetExplorer = function() { var a = m.isInternetExplorer.cached = "undefined" != typeof m.isInternetExplorer.cached ? m.isInternetExplorer.cached : Boolean(m.getInternetExplorerMajorVersion()); return a }, m.emulated = m.options.html4Mode ? { pushState: !0, hashChange: !0 } : { pushState: !Boolean(a.history && a.history.pushState && a.history.replaceState && !/ Mobile\/([1-7][a-z]|(8([abcde]|f(1[0-8]))))/i.test(e.userAgent) && !/AppleWebKit\/5([0-2]|3[0-2])/i.test(e.userAgent)), hashChange: Boolean(!("onhashchange" in a || "onhashchange" in d) || m.isInternetExplorer() && m.getInternetExplorerMajorVersion() < 8) }, m.enabled = !m.emulated.pushState, m.bugs = { setHash: Boolean(!m.emulated.pushState && "Apple Computer, Inc." === e.vendor && /AppleWebKit\/5([0-2]|3[0-3])/.test(e.userAgent)), safariPoll: Boolean(!m.emulated.pushState && "Apple Computer, Inc." === e.vendor && /AppleWebKit\/5([0-2]|3[0-3])/.test(e.userAgent)), ieDoubleCheck: Boolean(m.isInternetExplorer() && m.getInternetExplorerMajorVersion() < 8), hashEscape: Boolean(m.isInternetExplorer() && m.getInternetExplorerMajorVersion() < 7) }, m.isEmptyObject = function(a) {
                    for (var b in a)
                        if (a.hasOwnProperty(b)) return !1;
                    return !0
                }, m.cloneObject = function(a) { var b, c; return a ? (b = k.stringify(a), c = k.parse(b)) : c = {}, c }, m.getRootUrl = function() { var a = d.location.protocol + "//" + (d.location.hostname || d.location.host); return d.location.port && (a += ":" + d.location.port), a += "/" }, m.getBaseHref = function() {
                    var a = d.getElementsByTagName("base"),
                        b = null,
                        c = "";
                    return 1 === a.length && (b = a[0], c = b.href.replace(/[^\/]+$/, "")), c = c.replace(/\/+$/, ""), c && (c += "/"), c
                }, m.getBaseUrl = function() { var a = m.getBaseHref() || m.getBasePageUrl() || m.getRootUrl(); return a }, m.getPageUrl = function() {
                    var c, a = m.getState(!1, !1),
                        b = (a || {}).url || m.getLocationHref();
                    return c = b.replace(/\/+$/, "").replace(/[^\/]+$/, function(a) { return /\./.test(a) ? a : a + "/" })
                }, m.getBasePageUrl = function() { var a = m.getLocationHref().replace(/[#\?].*/, "").replace(/[^\/]+$/, function(a) { return /[^\/]$/.test(a) ? "" : a }).replace(/\/+$/, "") + "/"; return a }, m.getFullUrl = function(a, b) {
                    var c = a,
                        d = a.substring(0, 1);
                    return b = "undefined" == typeof b ? !0 : b, /[a-z]+\:\/\//.test(a) || (c = "/" === d ? m.getRootUrl() + a.replace(/^\/+/, "") : "#" === d ? m.getPageUrl().replace(/#.*/, "") + a : "?" === d ? m.getPageUrl().replace(/[\?#].*/, "") + a : b ? m.getBaseUrl() + a.replace(/^(\.\/)+/, "") : m.getBasePageUrl() + a.replace(/^(\.\/)+/, "")), c.replace(/\#$/, "")
                }, m.getShortUrl = function(a) {
                    var b = a,
                        c = m.getBaseUrl(),
                        d = m.getRootUrl();
                    return m.emulated.pushState && (b = b.replace(c, "")), b = b.replace(d, "/"), m.isTraditionalAnchor(b) && (b = "./" + b), b = b.replace(/^(\.\/)+/g, "./").replace(/\#$/, "")
                }, m.getLocationHref = function(a) { return a = a || d, a.URL === a.location.href ? a.location.href : a.location.href === decodeURIComponent(a.URL) ? a.URL : a.location.hash && decodeURIComponent(a.location.href.replace(/^[^#]+/, "")) === a.location.hash ? a.location.href : -1 == a.URL.indexOf("#") && -1 != a.location.href.indexOf("#") ? a.location.href : a.URL || a.location.href }, m.store = {}, m.idToState = m.idToState || {}, m.stateToId = m.stateToId || {}, m.urlToId = m.urlToId || {}, m.storedStates = m.storedStates || [], m.savedStates = m.savedStates || [], m.normalizeStore = function() { m.store.idToState = m.store.idToState || {}, m.store.urlToId = m.store.urlToId || {}, m.store.stateToId = m.store.stateToId || {} }, m.getState = function(a, b) { "undefined" == typeof a && (a = !0), "undefined" == typeof b && (b = !0); var c = m.getLastSavedState(); return !c && b && (c = m.createStateObject()), a && (c = m.cloneObject(c), c.url = c.cleanUrl || c.url), c }, m.getIdByState = function(a) {
                    var c, b = m.extractId(a.url);
                    if (!b)
                        if (c = m.getStateString(a), "undefined" != typeof m.stateToId[c]) b = m.stateToId[c];
                        else if ("undefined" != typeof m.store.stateToId[c]) b = m.store.stateToId[c];
                    else {
                        for (; b = (new Date).getTime() + String(Math.random()).replace(/\D/g, ""), "undefined" != typeof m.idToState[b] || "undefined" != typeof m.store.idToState[b];);
                        m.stateToId[c] = b, m.idToState[b] = a
                    }
                    return b
                }, m.normalizeState = function(a) { var b, c; return a && "object" == typeof a || (a = {}), "undefined" != typeof a.normalized ? a : (a.data && "object" == typeof a.data || (a.data = {}), b = {}, b.normalized = !0, b.title = a.title || "", b.url = m.getFullUrl(a.url ? a.url : m.getLocationHref()), b.hash = m.getShortUrl(b.url), b.data = m.cloneObject(a.data), b.id = m.getIdByState(b), b.cleanUrl = b.url.replace(/\??\&_suid.*/, ""), b.url = b.cleanUrl, c = !m.isEmptyObject(b.data), (b.title || c) && m.options.disableSuid !== !0 && (b.hash = m.getShortUrl(b.url).replace(/\??\&_suid.*/, ""), /\?/.test(b.hash) || (b.hash += "?"), b.hash += "&_suid=" + b.id), b.hashedUrl = m.getFullUrl(b.hash), (m.emulated.pushState || m.bugs.safariPoll) && m.hasUrlDuplicate(b) && (b.url = b.hashedUrl), b) }, m.createStateObject = function(a, b, c) { var d = { data: a, title: b, url: c }; return d = m.normalizeState(d) }, m.getStateById = function(a) { a = String(a); var c = m.idToState[a] || m.store.idToState[a] || b; return c }, m.getStateString = function(a) { var b, c, d; return b = m.normalizeState(a), c = { data: b.data, title: a.title, url: a.url }, d = k.stringify(c) }, m.getStateId = function(a) { var b, c; return b = m.normalizeState(a), c = b.id }, m.getHashByState = function(a) { var b, c; return b = m.normalizeState(a), c = b.hash }, m.extractId = function(a) { var b, c, d, e; return e = -1 != a.indexOf("#") ? a.split("#")[0] : a, c = /(.*)\&_suid=([0-9]+)$/.exec(e), d = c ? c[1] || a : a, b = c ? String(c[2] || "") : "", b || !1 }, m.isTraditionalAnchor = function(a) { var b = !/[\/\?\.]/.test(a); return b }, m.extractState = function(a, b) { var d, e, c = null; return b = b || !1, d = m.extractId(a), d && (c = m.getStateById(d)), c || (e = m.getFullUrl(a), d = m.getIdByUrl(e) || !1, d && (c = m.getStateById(d)), !c && b && !m.isTraditionalAnchor(a) && (c = m.createStateObject(null, null, e))), c }, m.getIdByUrl = function(a) { var c = m.urlToId[a] || m.store.urlToId[a] || b; return c }, m.getLastSavedState = function() { return m.savedStates[m.savedStates.length - 1] || b }, m.getLastStoredState = function() { return m.storedStates[m.storedStates.length - 1] || b }, m.hasUrlDuplicate = function(a) { var c, b = !1; return c = m.extractState(a.url), b = c && c.id !== a.id }, m.storeState = function(a) { return m.urlToId[a.url] = a.id, m.storedStates.push(m.cloneObject(a)), a }, m.isLastSavedState = function(a) { var c, d, e, b = !1; return m.savedStates.length && (c = a.id, d = m.getLastSavedState(), e = d.id, b = c === e), b }, m.saveState = function(a) { return m.isLastSavedState(a) ? !1 : (m.savedStates.push(m.cloneObject(a)), !0) }, m.getStateByIndex = function(a) { var b = null; return b = "undefined" == typeof a ? m.savedStates[m.savedStates.length - 1] : a < 0 ? m.savedStates[m.savedStates.length + a] : m.savedStates[a] }, m.getCurrentIndex = function() { var a = null; return a = m.savedStates.length < 1 ? 0 : m.savedStates.length - 1 }, m.getHash = function(a) { var c, b = m.getLocationHref(a); return c = m.getHashByUrl(b) }, m.unescapeHash = function(a) { var b = m.normalizeHash(a); return b = decodeURIComponent(b) }, m.normalizeHash = function(a) { var b = a.replace(/[^#]*#/, "").replace(/#.*/, ""); return b }, m.setHash = function(a, b) { var c, e; return b !== !1 && m.busy() ? (m.pushQueue({ scope: m, callback: m.setHash, args: arguments, queue: b }), !1) : (m.busy(!0), c = m.extractState(a, !0), c && !m.emulated.pushState ? m.pushState(c.data, c.title, c.url, !1) : m.getHash() !== a && (m.bugs.setHash ? (e = m.getPageUrl(), m.pushState(null, null, e + "#" + a, !1)) : d.location.hash = a), m) }, m.escapeHash = function(b) { var c = m.normalizeHash(b); return c = a.encodeURIComponent(c), m.bugs.hashEscape || (c = c.replace(/\%21/g, "!").replace(/\%26/g, "&").replace(/\%3D/g, "=").replace(/\%3F/g, "?")), c }, m.getHashByUrl = function(a) { var b = String(a).replace(/([^#]*)#?([^#]*)#?(.*)/, "$2"); return b = m.unescapeHash(b) }, m.setTitle = function(a) {
                    var c, b = a.title;
                    b || (c = m.getStateByIndex(0), c && c.url === a.url && (b = c.title || m.options.initialTitle));
                    try { d.getElementsByTagName("title")[0].innerHTML = b.replace("<", "&lt;").replace(">", "&gt;").replace(" & ", " &amp; ") } catch (e) {}
                    return d.title = b, m
                }, m.queues = [], m.busy = function(a) {
                    if ("undefined" != typeof a ? m.busy.flag = a : "undefined" == typeof m.busy.flag && (m.busy.flag = !1), !m.busy.flag) {
                        h(m.busy.timeout);
                        var b = function() {
                            var a, c, d;
                            if (!m.busy.flag)
                                for (a = m.queues.length - 1; a >= 0; --a) c = m.queues[a], 0 !== c.length && (d = c.shift(), m.fireQueueItem(d), m.busy.timeout = g(b, m.options.busyDelay))
                        };
                        m.busy.timeout = g(b, m.options.busyDelay)
                    }
                    return m.busy.flag
                }, m.busy.flag = !1, m.fireQueueItem = function(a) { return a.callback.apply(a.scope || m, a.args || []) }, m.pushQueue = function(a) { return m.queues[a.queue || 0] = m.queues[a.queue || 0] || [], m.queues[a.queue || 0].push(a), m }, m.queue = function(a, b) { return "function" == typeof a && (a = { callback: a }), "undefined" != typeof b && (a.queue = b), m.busy() ? m.pushQueue(a) : m.fireQueueItem(a), m }, m.clearQueue = function() { return m.busy.flag = !1, m.queues = [], m }, m.stateChanged = !1, m.doubleChecker = !1, m.doubleCheckComplete = function() { return m.stateChanged = !0, m.doubleCheckClear(), m }, m.doubleCheckClear = function() { return m.doubleChecker && (h(m.doubleChecker), m.doubleChecker = !1), m }, m.doubleCheck = function(a) { return m.stateChanged = !1, m.doubleCheckClear(), m.bugs.ieDoubleCheck && (m.doubleChecker = g(function() { return m.doubleCheckClear(), m.stateChanged || a(), !0 }, m.options.doubleCheckInterval)), m }, m.safariStatePoll = function() { var c, b = m.extractState(m.getLocationHref()); return m.isLastSavedState(b) ? void 0 : (c = b, c || (c = m.createStateObject()), m.Adapter.trigger(a, "popstate"), m) }, m.back = function(a) { return a !== !1 && m.busy() ? (m.pushQueue({ scope: m, callback: m.back, args: arguments, queue: a }), !1) : (m.busy(!0), m.doubleCheck(function() { m.back(!1) }), n.go(-1), !0) }, m.forward = function(a) { return a !== !1 && m.busy() ? (m.pushQueue({ scope: m, callback: m.forward, args: arguments, queue: a }), !1) : (m.busy(!0), m.doubleCheck(function() { m.forward(!1) }), n.go(1), !0) }, m.go = function(a, b) {
                    var c;
                    if (a > 0)
                        for (c = 1; c <= a; ++c) m.forward(b);
                    else { if (!(a < 0)) throw new Error("History.go: History.go requires a positive or negative integer passed."); for (c = -1; c >= a; --c) m.back(b) }
                    return m
                }, m.emulated.pushState) {
                var p = function() {};
                m.pushState = m.pushState || p, m.replaceState = m.replaceState || p
            } else m.onPopState = function(b, c) {
                var f, g, d = !1,
                    e = !1;
                return m.doubleCheckComplete(), f = m.getHash(), f ? (g = m.extractState(f || m.getLocationHref(), !0), g ? m.replaceState(g.data, g.title, g.url, !1) : (m.Adapter.trigger(a, "anchorchange"), m.busy(!1)), m.expectedStateId = !1, !1) : (d = m.Adapter.extractEventData("state", b, c) || !1, e = d ? m.getStateById(d) : m.expectedStateId ? m.getStateById(m.expectedStateId) : m.extractState(m.getLocationHref()), e || (e = m.createStateObject(null, null, m.getLocationHref())), m.expectedStateId = !1, m.isLastSavedState(e) ? (m.busy(!1), !1) : (m.storeState(e), m.saveState(e), m.setTitle(e), m.Adapter.trigger(a, "statechange"), m.busy(!1), !0))
            }, m.Adapter.bind(a, "popstate", m.onPopState), m.pushState = function(b, c, d, e) {
                if (m.getHashByUrl(d) && m.emulated.pushState) throw new Error("History.js does not support states with fragement-identifiers (hashes/anchors).");
                if (e !== !1 && m.busy()) return m.pushQueue({ scope: m, callback: m.pushState, args: arguments, queue: e }), !1;
                m.busy(!0);
                var f = m.createStateObject(b, c, d);
                return m.isLastSavedState(f) ? m.busy(!1) : (m.storeState(f), m.expectedStateId = f.id, n.pushState(f.id, f.title, f.url), m.Adapter.trigger(a, "popstate")), !0
            }, m.replaceState = function(b, c, d, e) {
                if (m.getHashByUrl(d) && m.emulated.pushState) throw new Error("History.js does not support states with fragement-identifiers (hashes/anchors).");
                if (e !== !1 && m.busy()) return m.pushQueue({ scope: m, callback: m.replaceState, args: arguments, queue: e }), !1;
                m.busy(!0);
                var f = m.createStateObject(b, c, d);
                return m.isLastSavedState(f) ? m.busy(!1) : (m.storeState(f), m.expectedStateId = f.id, n.replaceState(f.id, f.title, f.url), m.Adapter.trigger(a, "popstate")), !0
            };
            if (f) {
                try { m.store = k.parse(f.getItem("History.store")) || {} } catch (q) { m.store = {} }
                m.normalizeStore()
            } else m.store = {}, m.normalizeStore();
            m.Adapter.bind(a, "unload", m.clearAllIntervals), m.saveState(m.storeState(m.extractState(m.getLocationHref(), !0))), f && (m.onUnload = function() {
                var a, b, c;
                try { a = k.parse(f.getItem("History.store")) || {} } catch (d) { a = {} }
                a.idToState = a.idToState || {}, a.urlToId = a.urlToId || {}, a.stateToId = a.stateToId || {};
                for (b in m.idToState) m.idToState.hasOwnProperty(b) && (a.idToState[b] = m.idToState[b]);
                for (b in m.urlToId) m.urlToId.hasOwnProperty(b) && (a.urlToId[b] = m.urlToId[b]);
                for (b in m.stateToId) m.stateToId.hasOwnProperty(b) && (a.stateToId[b] = m.stateToId[b]);
                m.store = a, m.normalizeStore(), c = k.stringify(a);
                try { f.setItem("History.store", c) } catch (e) {
                    if (e.code !== DOMException.QUOTA_EXCEEDED_ERR) throw e;
                    f.length && (f.removeItem("History.store"), f.setItem("History.store", c))
                }
            }, m.intervalList.push(i(m.onUnload, m.options.storeInterval)), m.Adapter.bind(a, "beforeunload", m.onUnload), m.Adapter.bind(a, "unload", m.onUnload)), m.emulated.pushState || (m.bugs.safariPoll && m.intervalList.push(i(m.safariStatePoll, m.options.safariPollInterval)), ("Apple Computer, Inc." === e.vendor || "Mozilla" === (e.appCodeName || "")) && (m.Adapter.bind(a, "hashchange", function() { m.Adapter.trigger(a, "popstate") }), m.getHash() && m.Adapter.onDomLoad(function() { m.Adapter.trigger(a, "hashchange") })))
        }, (!m.options || !m.options.delayInit) && m.init()
    }(window);

/*! jquery-dateformat 28-04-2018 */
var DateFormat = {};
! function(e) {
    var I = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"],
        O = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"],
        v = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"],
        w = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"],
        a = { Jan: "01", Feb: "02", Mar: "03", Apr: "04", May: "05", Jun: "06", Jul: "07", Aug: "08", Sep: "09", Oct: "10", Nov: "11", Dec: "12" },
        u = /\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}\.?\d{0,3}[Z\-+]?(\d{2}:?\d{2})?/;
    DateFormat.format = function() {
        function o(e) { return a[e] || e }

        function i(e) {
            var a, r, t, n, s, o = e,
                i = "";
            return -1 !== o.indexOf(".") && (o = (n = o.split("."))[0], i = n[n.length - 1]), 3 === (s = o.split(":")).length ? (a = s[0], r = s[1], t = s[2].replace(/\s.+/, "").replace(/[a-z]/gi, ""), { time: o = o.replace(/\s.+/, "").replace(/[a-z]/gi, ""), hour: a, minute: r, second: t, millis: i }) : { time: "", hour: "", minute: "", second: "", millis: "" }
        }

        function D(e, a) { for (var r = a - String(e).length, t = 0; t < r; t++) e = "0" + e; return e }
        return {
            parseDate: function(e) {
                var a, r, t = { date: null, year: null, month: null, dayOfMonth: null, dayOfWeek: null, time: null };
                if ("number" == typeof e) return this.parseDate(new Date(e));
                if ("function" == typeof e.getFullYear) t.year = String(e.getFullYear()), t.month = String(e.getMonth() + 1), t.dayOfMonth = String(e.getDate()), t.time = i(e.toTimeString() + "." + e.getMilliseconds());
                else if (-1 != e.search(u)) a = e.split(/[T\+-]/), t.year = a[0], t.month = a[1], t.dayOfMonth = a[2], t.time = i(a[3].split(".")[0]);
                else switch (6 === (a = e.split(" ")).length && isNaN(a[5]) && (a[a.length] = "()"), a.length) {
                    case 6:
                        t.year = a[5], t.month = o(a[1]), t.dayOfMonth = a[2], t.time = i(a[3]);
                        break;
                    case 2:
                        r = a[0].split("-"), t.year = r[0], t.month = r[1], t.dayOfMonth = r[2], t.time = i(a[1]);
                        break;
                    case 7:
                    case 9:
                    case 10:
                        t.year = a[3];
                        var n = parseInt(a[1]),
                            s = parseInt(a[2]);
                        n && !s ? (t.month = o(a[2]), t.dayOfMonth = a[1]) : (t.month = o(a[1]), t.dayOfMonth = a[2]), t.time = i(a[4]);
                        break;
                    case 1:
                        r = a[0].split(""), t.year = r[0] + r[1] + r[2] + r[3], t.month = r[5] + r[6], t.dayOfMonth = r[8] + r[9], t.time = i(r[13] + r[14] + r[15] + r[16] + r[17] + r[18] + r[19] + r[20]);
                        break;
                    default:
                        return null
                }
                return t.time ? t.date = new Date(t.year, t.month - 1, t.dayOfMonth, t.time.hour, t.time.minute, t.time.second, t.time.millis) : t.date = new Date(t.year, t.month - 1, t.dayOfMonth), t.dayOfWeek = String(t.date.getDay()), t
            },
            date: function(a, e) {
                try {
                    var r = this.parseDate(a);
                    if (null === r) return a;
                    for (var t, n = r.year, s = r.month, o = r.dayOfMonth, i = r.dayOfWeek, u = r.time, c = "", h = "", l = "", m = !1, y = 0; y < e.length; y++) {
                        var d = e.charAt(y),
                            f = e.charAt(y + 1);
                        if (m) "'" == d ? (h += "" === c ? "'" : c, c = "", m = !1) : c += d;
                        else switch (l = "", c += d) {
                            case "ddd":
                                h += (S = i, I[parseInt(S, 10)] || S), c = "";
                                break;
                            case "dd":
                                if ("d" === f) break;
                                h += D(o, 2), c = "";
                                break;
                            case "d":
                                if ("d" === f) break;
                                h += parseInt(o, 10), c = "";
                                break;
                            case "D":
                                h += o = 1 == o || 21 == o || 31 == o ? parseInt(o, 10) + "st" : 2 == o || 22 == o ? parseInt(o, 10) + "nd" : 3 == o || 23 == o ? parseInt(o, 10) + "rd" : parseInt(o, 10) + "th", c = "";
                                break;
                            case "MMMM":
                                h += (M = s, void 0, g = parseInt(M, 10) - 1, w[g] || M), c = "";
                                break;
                            case "MMM":
                                if ("M" === f) break;
                                h += (k = s, void 0, p = parseInt(k, 10) - 1, v[p] || k), c = "";
                                break;
                            case "MM":
                                if ("M" === f) break;
                                h += D(s, 2), c = "";
                                break;
                            case "M":
                                if ("M" === f) break;
                                h += parseInt(s, 10), c = "";
                                break;
                            case "y":
                            case "yyy":
                                if ("y" === f) break;
                                h += c, c = "";
                                break;
                            case "yy":
                                if ("y" === f) break;
                                h += String(n).slice(-2), c = "";
                                break;
                            case "yyyy":
                                h += n, c = "";
                                break;
                            case "HH":
                                h += D(u.hour, 2), c = "";
                                break;
                            case "H":
                                if ("H" === f) break;
                                h += parseInt(u.hour, 10), c = "";
                                break;
                            case "hh":
                                h += D(t = 0 === parseInt(u.hour, 10) ? 12 : u.hour < 13 ? u.hour : u.hour - 12, 2), c = "";
                                break;
                            case "h":
                                if ("h" === f) break;
                                t = 0 === parseInt(u.hour, 10) ? 12 : u.hour < 13 ? u.hour : u.hour - 12, h += parseInt(t, 10), c = "";
                                break;
                            case "mm":
                                h += D(u.minute, 2), c = "";
                                break;
                            case "m":
                                if ("m" === f) break;
                                h += parseInt(u.minute, 10), c = "";
                                break;
                            case "ss":
                                h += D(u.second.substring(0, 2), 2), c = "";
                                break;
                            case "s":
                                if ("s" === f) break;
                                h += parseInt(u.second, 10), c = "";
                                break;
                            case "S":
                            case "SS":
                                if ("S" === f) break;
                                h += c, c = "";
                                break;
                            case "SSS":
                                h += D(u.millis.substring(0, 3), 3), c = "";
                                break;
                            case "a":
                                h += 12 <= u.hour ? "PM" : "AM", c = "";
                                break;
                            case "p":
                                h += 12 <= u.hour ? "p.m." : "a.m.", c = "";
                                break;
                            case "E":
                                h += (b = i, O[parseInt(b, 10)] || b), c = "";
                                break;
                            case "'":
                                c = "", m = !0;
                                break;
                            default:
                                h += d, c = ""
                        }
                    }
                    return h += l
                } catch (e) { return console && console.log && console.log(e), a }
                var b, k, p, M, g, S
            },
            prettyDate: function(e) { var a, r, t, n, s; if ("string" != typeof e && "number" != typeof e || (a = new Date(e)), "object" == typeof e && (a = new Date(e.toString())), r = ((new Date).getTime() - a.getTime()) / 1e3, t = Math.abs(r), n = Math.floor(t / 86400), !isNaN(n)) return s = r < 0 ? "from now" : "ago", t < 60 ? 0 <= r ? "just now" : "in a moment" : t < 120 ? "1 minute " + s : t < 3600 ? Math.floor(t / 60) + " minutes " + s : t < 7200 ? "1 hour " + s : t < 86400 ? Math.floor(t / 3600) + " hours " + s : 1 === n ? 0 <= r ? "Yesterday" : "Tomorrow" : n < 7 ? n + " days " + s : 7 === n ? "1 week " + s : n < 31 ? Math.ceil(n / 7) + " weeks " + s : "more than 5 weeks " + s },
            toBrowserTimeZone: function(e, a) { return this.date(new Date(e), a || "MM/dd/yyyy HH:mm:ss") }
        }
    }()
}(), jQuery.format = DateFormat.format;

// Infinite scroll - https://github.com/Elkfox/Ajaxinate
"function" != typeof Object.assign && (Object.assign = function(n) {
    "use strict";
    if (null == n) throw new TypeError("Cannot convert undefined or null to object");
    n = Object(n);
    for (var t = 1; t < arguments.length; t++) {
        var r = arguments[t];
        if (null != r)
            for (var e in r) Object.prototype.hasOwnProperty.call(r, e) && (n[e] = r[e])
    }
    return n
});
var Ajaxinate = function(t) {
    var e = t || {};
    this.settings = Object.assign({ pagination: ".AjaxinatePagination", method: "scroll", container: ".AjaxinateLoop", offset: 0, loadingText: "Loading", callback: null }, e), this.addScrollListeners = this.addScrollListeners.bind(this), this.addClickListener = this.addClickListener.bind(this), this.checkIfPaginationInView = this.checkIfPaginationInView.bind(this), this.stopMultipleClicks = this.stopMultipleClicks.bind(this), this.destroy = this.destroy.bind(this), this.containerElement = document.querySelector(this.settings.container), this.paginationElement = document.querySelector(this.settings.pagination), this.initialize()
};
Ajaxinate.prototype.initialize = function() { this.containerElement && { click: this.addClickListener, scroll: this.addScrollListeners }[this.settings.method]() }, Ajaxinate.prototype.addScrollListeners = function() { this.paginationElement && (document.addEventListener("scroll", this.checkIfPaginationInView), window.addEventListener("resize", this.checkIfPaginationInView), window.addEventListener("orientationchange", this.checkIfPaginationInView)) }, Ajaxinate.prototype.addClickListener = function() { this.paginationElement && (this.nextPageLinkElement = this.paginationElement.querySelector("a"), this.clickActive = !0, null !== this.nextPageLinkElement && this.nextPageLinkElement.addEventListener("click", this.stopMultipleClicks)) }, Ajaxinate.prototype.stopMultipleClicks = function(t) { t.preventDefault(), this.clickActive && (this.nextPageLinkElement.innerHTML = this.settings.loadingText, this.nextPageUrl = this.nextPageLinkElement.href, this.clickActive = !1, this.loadMore()) }, Ajaxinate.prototype.checkIfPaginationInView = function() {
    var t = this.paginationElement.getBoundingClientRect().top - this.settings.offset,
        e = this.paginationElement.getBoundingClientRect().bottom + this.settings.offset;
    t <= window.innerHeight && e >= 0 && (this.nextPageLinkElement = this.paginationElement.querySelector("a"), this.removeScrollListener(), this.nextPageLinkElement && (this.nextPageLinkElement.innerHTML = this.settings.loadingText, this.nextPageUrl = this.nextPageLinkElement.href, this.loadMore()))
}, Ajaxinate.prototype.loadMore = function() {
    this.request = new XMLHttpRequest, this.request.onreadystatechange = function() {
        if (4 === this.request.readyState && 200 === this.request.status) {
            var t = this.request.responseXML.querySelectorAll(this.settings.container)[0],
                e = this.request.responseXML.querySelectorAll(this.settings.pagination)[0];
            this.containerElement.insertAdjacentHTML("beforeend", t.innerHTML), this.paginationElement.innerHTML = e.innerHTML, this.settings.callback && "function" == typeof this.settings.callback && this.settings.callback(this.request.responseXML), this.initialize()
        }
    }.bind(this), this.request.open("GET", this.nextPageUrl), this.request.responseType = "document", this.request.send()
}, Ajaxinate.prototype.removeClickListener = function() { this.nextPageLinkElement.addEventListener("click", this.stopMultipleClicks) }, Ajaxinate.prototype.removeScrollListener = function() { document.removeEventListener("scroll", this.checkIfPaginationInView), window.removeEventListener("resize", this.checkIfPaginationInView), window.removeEventListener("orientationchange", this.checkIfPaginationInView) }, Ajaxinate.prototype.destroy = function() { return { click: this.removeClickListener, scroll: this.removeScrollListener }[this.settings.method](), this };

/* Sticky-kit v1.1.3 | MIT | Leaf Corcoran 2015 | http://leafo.net */
(function() {
    var t, i;
    t = window.jQuery, i = t(window), t.fn.stick_in_parent = function(o) { var e, s, r, n, l, a, c, p, u, d, f, g; for (null == o && (o = {}), g = o.sticky_class, l = o.inner_scrolling, f = o.recalc_every, d = o.parent, p = o.offset_top, c = o.spacer, s = o.bottoming, null == p && (p = 0), null == d && (d = void 0), null == l && (l = !0), null == g && (g = "is_stuck"), e = t(document), null == s && (s = !0), u = function(t) { var i; return window.getComputedStyle ? (t = window.getComputedStyle(t[0]), i = parseFloat(t.getPropertyValue("width")) + parseFloat(t.getPropertyValue("margin-left")) + parseFloat(t.getPropertyValue("margin-right")), "border-box" !== t.getPropertyValue("box-sizing") && (i += parseFloat(t.getPropertyValue("border-left-width")) + parseFloat(t.getPropertyValue("border-right-width")) + parseFloat(t.getPropertyValue("padding-left")) + parseFloat(t.getPropertyValue("padding-right"))), i) : t.outerWidth(!0) }, r = function(o, r, n, a, h, k, y, m) { var b, v, w, _, x, P, V, F, C, z, I, A; if (!o.data("sticky_kit")) { if (o.data("sticky_kit", !0), x = e.height(), V = o.parent(), null != d && (V = V.closest(d)), !V.length) throw "failed to find stick parent"; if (b = w = !1, (I = null != c ? c && o.closest(c) : t("<div />")) && I.css("position", o.css("position")), (F = function() { var t, i, s; if (!m && (x = e.height(), t = parseInt(V.css("border-top-width"), 10), i = parseInt(V.css("padding-top"), 10), r = parseInt(V.css("padding-bottom"), 10), n = V.offset().top + t + i, a = V.height(), w && (b = w = !1, null == c && (o.insertAfter(I), I.detach()), o.css({ position: "", top: "", width: "", bottom: "" }).removeClass(g), s = !0), h = o.offset().top - (parseInt(o.css("margin-top"), 10) || 0) - p, k = o.outerHeight(!0), y = o.css("float"), I && I.css({ width: u(o), height: k, display: o.css("display"), "vertical-align": o.css("vertical-align"), float: y }), s)) return A() })(), k !== a) return _ = void 0, P = p, z = f, A = function() { var t, u, d, v; if (!m && (d = !1, null != z && (0 >= --z && (z = f, F(), d = !0)), d || e.height() === x || F(), d = i.scrollTop(), null != _ && (u = d - _), _ = d, w ? (s && (v = d + k + P > a + n, b && !v && (b = !1, o.css({ position: "fixed", bottom: "", top: P }).trigger("sticky_kit:unbottom"))), d < h && (w = !1, P = p, null == c && ("left" !== y && "right" !== y || o.insertAfter(I), I.detach()), t = { position: "", width: "", top: "" }, o.css(t).removeClass(g).trigger("sticky_kit:unstick")), l && (t = i.height(), k + p > t && !b && (P -= u, P = Math.max(t - k, P), P = Math.min(p, P), w && o.css({ top: P + "px" })))) : d > h && (w = !0, (t = { position: "fixed", top: P }).width = "border-box" === o.css("box-sizing") ? o.outerWidth() + "px" : o.width() + "px", o.css(t).addClass(g), null == c && (o.after(I), "left" !== y && "right" !== y || I.append(o)), o.trigger("sticky_kit:stick")), w && s && (null == v && (v = d + k + P > a + n), !b && v))) return b = !0, "static" === V.css("position") && V.css({ position: "relative" }), o.css({ position: "absolute", bottom: r, top: "auto" }).trigger("sticky_kit:bottom") }, C = function() { return F(), A() }, v = function() { if (m = !0, i.off("touchmove", A), i.off("scroll", A), i.off("resize", C), t(document.body).off("sticky_kit:recalc", C), o.off("sticky_kit:detach", v), o.removeData("sticky_kit"), o.css({ position: "", bottom: "", top: "", width: "" }), V.position("position", ""), w) return null == c && ("left" !== y && "right" !== y || o.insertAfter(I), I.remove()), o.removeClass(g) }, i.on("touchmove", A), i.on("scroll", A), i.on("resize", C), t(document.body).on("sticky_kit:recalc", C), o.on("sticky_kit:detach", v), setTimeout(A, 0) } }, n = 0, a = this.length; n < a; n++) o = this[n], r(t(o)); return this }
}).call(this);

/*!
 * css-vars-ponyfill
 * v2.1.1
 * https://jhildenbiddle.github.io/css-vars-ponyfill/
 * (c) 2018-2019 John Hildenbiddle <http://hildenbiddle.com>
 * MIT license
 */
! function(e, t) { "object" == typeof exports && "undefined" != typeof module ? module.exports = t() : "function" == typeof define && define.amd ? define(t) : (e = e || self).cssVars = t() }(this, function() {
    "use strict";

    function e() { return (e = Object.assign || function(e) { for (var t = 1; t < arguments.length; t++) { var r = arguments[t]; for (var n in r) Object.prototype.hasOwnProperty.call(r, n) && (e[n] = r[n]) } return e }).apply(this, arguments) }

    function t(e) { return function(e) { if (Array.isArray(e)) { for (var t = 0, r = new Array(e.length); t < e.length; t++) r[t] = e[t]; return r } }(e) || function(e) { if (Symbol.iterator in Object(e) || "[object Arguments]" === Object.prototype.toString.call(e)) return Array.from(e) }(e) || function() { throw new TypeError("Invalid attempt to spread non-iterable instance") }() }

    function r(e) {
        var t = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : {},
            r = { mimeType: t.mimeType || null, onBeforeSend: t.onBeforeSend || Function.prototype, onSuccess: t.onSuccess || Function.prototype, onError: t.onError || Function.prototype, onComplete: t.onComplete || Function.prototype },
            n = Array.isArray(e) ? e : [e],
            o = Array.apply(null, Array(n.length)).map(function(e) { return null });

        function s() { return !("<" === (arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : "").trim().charAt(0)) }

        function a(e, t) { r.onError(e, n[t], t) }

        function c(e, t) {
            var s = r.onSuccess(e, n[t], t);
            e = !1 === s ? "" : s || e, o[t] = e, -1 === o.indexOf(null) && r.onComplete(o)
        }
        var i = document.createElement("a");
        n.forEach(function(e, t) {
            if (i.setAttribute("href", e), i.href = String(i.href), Boolean(document.all && !window.atob) && i.host.split(":")[0] !== location.host.split(":")[0]) {
                if (i.protocol === location.protocol) {
                    var n = new XDomainRequest;
                    n.open("GET", e), n.timeout = 0, n.onprogress = Function.prototype, n.ontimeout = Function.prototype, n.onload = function() { s(n.responseText) ? c(n.responseText, t) : a(n, t) }, n.onerror = function(e) { a(n, t) }, setTimeout(function() { n.send() }, 0)
                } else console.warn("Internet Explorer 9 Cross-Origin (CORS) requests must use the same protocol (".concat(e, ")")), a(null, t)
            } else {
                var o = new XMLHttpRequest;
                o.open("GET", e), r.mimeType && o.overrideMimeType && o.overrideMimeType(r.mimeType), r.onBeforeSend(o, e, t), o.onreadystatechange = function() { 4 === o.readyState && (200 === o.status && s(o.responseText) ? c(o.responseText, t) : a(o, t)) }, o.send()
            }
        })
    }

    function n(e) {
        var t = { cssComments: /\/\*[\s\S]+?\*\//g, cssImports: /(?:@import\s*)(?:url\(\s*)?(?:['"])([^'"]*)(?:['"])(?:\s*\))?(?:[^;]*;)/g },
            n = { rootElement: e.rootElement || document, include: e.include || 'style,link[rel="stylesheet"]', exclude: e.exclude || null, filter: e.filter || null, useCSSOM: e.useCSSOM || !1, onBeforeSend: e.onBeforeSend || Function.prototype, onSuccess: e.onSuccess || Function.prototype, onError: e.onError || Function.prototype, onComplete: e.onComplete || Function.prototype },
            s = Array.apply(null, n.rootElement.querySelectorAll(n.include)).filter(function(e) { return t = e, r = n.exclude, !(t.matches || t.matchesSelector || t.webkitMatchesSelector || t.mozMatchesSelector || t.msMatchesSelector || t.oMatchesSelector).call(t, r); var t, r }),
            a = Array.apply(null, Array(s.length)).map(function(e) { return null });

        function c() {
            if (-1 === a.indexOf(null)) {
                var e = a.join("");
                n.onComplete(e, a, s)
            }
        }

        function i(e, t, o, s) {
            var i = n.onSuccess(e, o, s);
            (function e(t, o, s, a) {
                var c = arguments.length > 4 && void 0 !== arguments[4] ? arguments[4] : [];
                var i = arguments.length > 5 && void 0 !== arguments[5] ? arguments[5] : [];
                var l = u(t, s, i);
                l.rules.length ? r(l.absoluteUrls, {
                    onBeforeSend: function(e, t, r) { n.onBeforeSend(e, o, t) },
                    onSuccess: function(e, t, r) {
                        var s = n.onSuccess(e, o, t),
                            a = u(e = !1 === s ? "" : s || e, t, i);
                        return a.rules.forEach(function(t, r) { e = e.replace(t, a.absoluteRules[r]) }), e
                    },
                    onError: function(r, n, u) { c.push({ xhr: r, url: n }), i.push(l.rules[u]), e(t, o, s, a, c, i) },
                    onComplete: function(r) { r.forEach(function(e, r) { t = t.replace(l.rules[r], e) }), e(t, o, s, a, c, i) }
                }) : a(t, c)
            })(e = void 0 !== i && !1 === Boolean(i) ? "" : i || e, o, s, function(e, r) { null === a[t] && (r.forEach(function(e) { return n.onError(e.xhr, o, e.url) }), !n.filter || n.filter.test(e) ? a[t] = e : a[t] = "", c()) })
        }

        function u(e, r) {
            var n = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : [],
                s = {};
            return s.rules = (e.replace(t.cssComments, "").match(t.cssImports) || []).filter(function(e) { return -1 === n.indexOf(e) }), s.urls = s.rules.map(function(e) { return e.replace(t.cssImports, "$1") }), s.absoluteUrls = s.urls.map(function(e) { return o(e, r) }), s.absoluteRules = s.rules.map(function(e, t) {
                var n = s.urls[t],
                    a = o(s.absoluteUrls[t], r);
                return e.replace(n, a)
            }), s
        }
        s.length ? s.forEach(function(e, t) {
            var s = e.getAttribute("href"),
                u = e.getAttribute("rel"),
                l = "LINK" === e.nodeName && s && u && "stylesheet" === u.toLowerCase(),
                f = "STYLE" === e.nodeName;
            if (l) r(s, {
                mimeType: "text/css",
                onBeforeSend: function(t, r, o) { n.onBeforeSend(t, e, r) },
                onSuccess: function(r, n, a) {
                    var c = o(s, location.href);
                    i(r, t, e, c)
                },
                onError: function(r, o, s) { a[t] = "", n.onError(r, e, o), c() }
            });
            else if (f) {
                var d = e.textContent;
                n.useCSSOM && (d = Array.apply(null, e.sheet.cssRules).map(function(e) { return e.cssText }).join("")), i(d, t, e, location.href)
            } else a[t] = "", c()
        }) : n.onComplete("", [])
    }

    function o(e) {
        var t = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : location.href,
            r = document.implementation.createHTMLDocument(""),
            n = r.createElement("base"),
            o = r.createElement("a");
        return r.head.appendChild(n), r.body.appendChild(o), n.href = t, o.href = e, o.href
    }
    var s = a;

    function a(e, t, r) { e instanceof RegExp && (e = c(e, r)), t instanceof RegExp && (t = c(t, r)); var n = i(e, t, r); return n && { start: n[0], end: n[1], pre: r.slice(0, n[0]), body: r.slice(n[0] + e.length, n[1]), post: r.slice(n[1] + t.length) } }

    function c(e, t) { var r = t.match(e); return r ? r[0] : null }

    function i(e, t, r) {
        var n, o, s, a, c, i = r.indexOf(e),
            u = r.indexOf(t, i + 1),
            l = i;
        if (i >= 0 && u > 0) {
            for (n = [], s = r.length; l >= 0 && !c;) l == i ? (n.push(l), i = r.indexOf(e, l + 1)) : 1 == n.length ? c = [n.pop(), u] : ((o = n.pop()) < s && (s = o, a = u), u = r.indexOf(t, l + 1)), l = i < u && i >= 0 ? i : u;
            n.length && (c = [s, a])
        }
        return c
    }

    function u(t) {
        var r = e({}, { preserveStatic: !0, removeComments: !1 }, arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : {});

        function n(e) { throw new Error("CSS parse error: ".concat(e)) }

        function o(e) { var r = e.exec(t); if (r) return t = t.slice(r[0].length), r }

        function a() { return o(/^{\s*/) }

        function c() { return o(/^}/) }

        function i() { o(/^\s*/) }

        function u() { if (i(), "/" === t[0] && "*" === t[1]) { for (var e = 2; t[e] && ("*" !== t[e] || "/" !== t[e + 1]);) e++; if (!t[e]) return n("end of comment is missing"); var r = t.slice(2, e); return t = t.slice(e + 2), { type: "comment", comment: r } } }

        function l() { for (var e, t = []; e = u();) t.push(e); return r.removeComments ? [] : t }

        function f() {
            for (i();
                "}" === t[0];) n("extra closing bracket");
            var e = o(/^(("(?:\\"|[^"])*"|'(?:\\'|[^'])*'|[^{])+)/);
            if (e) return e[0].trim().replace(/\/\*([^*]|[\r\n]|(\*+([^*\/]|[\r\n])))*\*\/+/g, "").replace(/"(?:\\"|[^"])*"|'(?:\\'|[^'])*'/g, function(e) { return e.replace(/,/g, "â€Œ") }).split(/\s*(?![^(]*\)),\s*/).map(function(e) { return e.replace(/\u200C/g, ",") })
        }

        function d() {
            o(/^([;\s]*)+/);
            var e = /\/\*[^*]*\*+([^\/*][^*]*\*+)*\//g,
                t = o(/^(\*?[-#\/*\\\w]+(\[[0-9a-z_-]+\])?)\s*/);
            if (t) {
                if (t = t[0].trim(), !o(/^:\s*/)) return n("property missing ':'");
                var r = o(/^((?:\/\*.*?\*\/|'(?:\\'|.)*?'|"(?:\\"|.)*?"|\((\s*'(?:\\'|.)*?'|"(?:\\"|.)*?"|[^)]*?)\s*\)|[^};])+)/),
                    s = { type: "declaration", property: t.replace(e, ""), value: r ? r[0].replace(e, "").trim() : "" };
                return o(/^[;\s]*/), s
            }
        }

        function p() { if (!a()) return n("missing '{'"); for (var e, t = l(); e = d();) t.push(e), t = t.concat(l()); return c() ? t : n("missing '}'") }

        function m() { i(); for (var e, t = []; e = o(/^((\d+\.\d+|\.\d+|\d+)%?|[a-z]+)\s*/);) t.push(e[1]), o(/^,\s*/); if (t.length) return { type: "keyframe", values: t, declarations: p() } }

        function v() {
            if (i(), "@" === t[0]) {
                var e = function() { var e = o(/^@([-\w]+)?keyframes\s*/); if (e) { var t = e[1]; if (!(e = o(/^([-\w]+)\s*/))) return n("@keyframes missing name"); var r, s = e[1]; if (!a()) return n("@keyframes missing '{'"); for (var i = l(); r = m();) i.push(r), i = i.concat(l()); return c() ? { type: "keyframes", name: s, vendor: t, keyframes: i } : n("@keyframes missing '}'") } }() || function() { var e = o(/^@supports *([^{]+)/); if (e) return { type: "supports", supports: e[1].trim(), rules: y() } }() || function() { if (o(/^@host\s*/)) return { type: "host", rules: y() } }() || function() { var e = o(/^@media([^{]+)*/); if (e) return { type: "media", media: (e[1] || "").trim(), rules: y() } }() || function() { var e = o(/^@custom-media\s+(--[^\s]+)\s*([^{;]+);/); if (e) return { type: "custom-media", name: e[1].trim(), media: e[2].trim() } }() || function() { if (o(/^@page */)) return { type: "page", selectors: f() || [], declarations: p() } }() || function() { var e = o(/^@([-\w]+)?document *([^{]+)/); if (e) return { type: "document", document: e[2].trim(), vendor: e[1] ? e[1].trim() : null, rules: y() } }() || function() { if (o(/^@font-face\s*/)) return { type: "font-face", declarations: p() } }() || function() { var e = o(/^@(import|charset|namespace)\s*([^;]+);/); if (e) return { type: e[1], name: e[2].trim() } }();
                if (e && !r.preserveStatic) {
                    var s = !1;
                    if (e.declarations) s = e.declarations.some(function(e) { return /var\(/.test(e.value) });
                    else s = (e.keyframes || e.rules || []).some(function(e) { return (e.declarations || []).some(function(e) { return /var\(/.test(e.value) }) });
                    return s ? e : {}
                }
                return e
            }
        }

        function h() {
            if (!r.preserveStatic) {
                var e = s("{", "}", t);
                if (e) {
                    var o = /:(?:root|host)(?![.:#(])/.test(e.pre) && /--\S*\s*:/.test(e.body),
                        a = /var\(/.test(e.body);
                    if (!o && !a) return t = t.slice(e.end + 1), {}
                }
            }
            var c = f() || [],
                i = r.preserveStatic ? p() : p().filter(function(e) {
                    var t = c.some(function(e) { return /:(?:root|host)(?![.:#(])/.test(e) }) && /^--\S/.test(e.property),
                        r = /var\(/.test(e.value);
                    return t || r
                });
            return c.length || n("selector missing"), { type: "rule", selectors: c, declarations: i }
        }

        function y(e) { if (!e && !a()) return n("missing '{'"); for (var r, o = l(); t.length && (e || "}" !== t[0]) && (r = v() || h());) r.type && o.push(r), o = o.concat(l()); return e || c() ? o : n("missing '}'") }
        return { type: "stylesheet", stylesheet: { rules: y(!0), errors: [] } }
    }

    function l(t) {
        var r = e({}, { parseHost: !1, store: {}, onWarning: function() {} }, arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : {}),
            n = new RegExp(":".concat(r.parseHost ? "host" : "root", "(?![.:#(])"));
        return "string" == typeof t && (t = u(t, r)), t.stylesheet.rules.forEach(function(e) {
            "rule" === e.type && e.selectors.some(function(e) { return n.test(e) }) && e.declarations.forEach(function(e, t) {
                var n = e.property,
                    o = e.value;
                n && 0 === n.indexOf("--") && (r.store[n] = o)
            })
        }), r.store
    }

    function f(e) {
        var t = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : "",
            r = arguments.length > 2 ? arguments[2] : void 0,
            n = { charset: function(e) { return "@charset " + e.name + ";" }, comment: function(e) { return 0 === e.comment.indexOf("__CSSVARSPONYFILL") ? "/*" + e.comment + "*/" : "" }, "custom-media": function(e) { return "@custom-media " + e.name + " " + e.media + ";" }, declaration: function(e) { return e.property + ":" + e.value + ";" }, document: function(e) { return "@" + (e.vendor || "") + "document " + e.document + "{" + o(e.rules) + "}" }, "font-face": function(e) { return "@font-face{" + o(e.declarations) + "}" }, host: function(e) { return "@host{" + o(e.rules) + "}" }, import: function(e) { return "@import " + e.name + ";" }, keyframe: function(e) { return e.values.join(",") + "{" + o(e.declarations) + "}" }, keyframes: function(e) { return "@" + (e.vendor || "") + "keyframes " + e.name + "{" + o(e.keyframes) + "}" }, media: function(e) { return "@media " + e.media + "{" + o(e.rules) + "}" }, namespace: function(e) { return "@namespace " + e.name + ";" }, page: function(e) { return "@page " + (e.selectors.length ? e.selectors.join(", ") : "") + "{" + o(e.declarations) + "}" }, rule: function(e) { var t = e.declarations; if (t.length) return e.selectors.join(",") + "{" + o(t) + "}" }, supports: function(e) { return "@supports " + e.supports + "{" + o(e.rules) + "}" } };

        function o(e) {
            for (var o = "", s = 0; s < e.length; s++) {
                var a = e[s];
                r && r(a);
                var c = n[a.type](a);
                c && (o += c, c.length && a.selectors && (o += t))
            }
            return o
        }
        return o(e.stylesheet.rules)
    }
    a.range = i;
    var d = "--",
        p = "var";

    function m(t) {
        var r = e({}, { preserveStatic: !0, preserveVars: !1, variables: {}, onWarning: function() {} }, arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : {});
        return "string" == typeof t && (t = u(t, r)),
            function e(t, r) { t.rules.forEach(function(n) { n.rules ? e(n, r) : n.keyframes ? n.keyframes.forEach(function(e) { "keyframe" === e.type && r(e.declarations, n) }) : n.declarations && r(n.declarations, t) }) }(t.stylesheet, function(e, t) {
                for (var n = 0; n < e.length; n++) {
                    var o = e[n],
                        s = o.type,
                        a = o.property,
                        c = o.value;
                    if ("declaration" === s)
                        if (r.preserveVars || !a || 0 !== a.indexOf(d)) {
                            if (-1 !== c.indexOf(p + "(")) {
                                var i = h(c, r);
                                i !== o.value && (i = v(i), r.preserveVars ? (e.splice(n, 0, { type: s, property: a, value: i }), n++) : o.value = i)
                            }
                        } else e.splice(n, 1), n--
                }
            }), f(t)
    }

    function v(e) {
        return (e.match(/calc\(([^)]+)\)/g) || []).forEach(function(t) {
            var r = "calc".concat(t.split("calc").join(""));
            e = e.replace(t, r)
        }), e
    }

    function h(e) {
        var t = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : {},
            r = arguments.length > 2 ? arguments[2] : void 0;
        if (-1 === e.indexOf("var(")) return e;
        var n = s("(", ")", e);
        return n ? "var" === n.pre.slice(-3) ? 0 === n.body.trim().length ? (t.onWarning("var() must contain a non-whitespace string"), e) : n.pre.slice(0, -3) + function(e) {
            var n = e.split(",")[0].replace(/[\s\n\t]/g, ""),
                o = (e.match(/(?:\s*,\s*){1}(.*)?/) || [])[1],
                s = Object.prototype.hasOwnProperty.call(t.variables, n) ? String(t.variables[n]) : void 0,
                a = s || (o ? String(o) : void 0),
                c = r || e;
            return s || t.onWarning('variable "'.concat(n, '" is undefined')), a && "undefined" !== a && a.length > 0 ? h(a, t, c) : "var(".concat(c, ")")
        }(n.body) + h(n.post, t) : n.pre + "(".concat(h(n.body, t), ")") + h(n.post, t) : (-1 !== e.indexOf("var(") && t.onWarning('missing closing ")" in the value "'.concat(e, '"')), e)
    }
    var y = "undefined" != typeof window,
        g = y && window.CSS && window.CSS.supports && window.CSS.supports("(--a: 0)"),
        S = { group: 0, job: 0 },
        b = { rootElement: y ? document : null, shadowDOM: !1, include: "style,link[rel=stylesheet]", exclude: "", variables: {}, onlyLegacy: !0, preserveStatic: !0, preserveVars: !1, silent: !1, updateDOM: !0, updateURLs: !0, watch: null, onBeforeSend: function() {}, onWarning: function() {}, onError: function() {}, onSuccess: function() {}, onComplete: function() {} },
        E = { cssComments: /\/\*[\s\S]+?\*\//g, cssKeyframes: /@(?:-\w*-)?keyframes/, cssMediaQueries: /@media[^{]+\{([\s\S]+?})\s*}/g, cssUrls: /url\((?!['"]?(?:data|http|\/\/):)['"]?([^'")]*)['"]?\)/g, cssVarDeclRules: /(?::(?:root|host)(?![.:#(])[\s,]*[^{]*{\s*[^}]*})/g, cssVarDecls: /(?:[\s;]*)(-{2}\w[\w-]*)(?:\s*:\s*)([^;]*);/g, cssVarFunc: /var\(\s*--[\w-]/, cssVars: /(?:(?::(?:root|host)(?![.:#(])[\s,]*[^{]*{\s*[^;]*;*\s*)|(?:var\(\s*))(--[^:)]+)(?:\s*[:)])/ },
        w = { dom: {}, job: {}, user: {} },
        C = !1,
        O = null,
        A = 0,
        x = null,
        j = !1;

    function k() {
        var r = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {},
            o = "cssVars(): ",
            s = e({}, b, r);

        function a(e, t, r, n) {!s.silent && window.console && console.error("".concat(o).concat(e, "\n"), t), s.onError(e, t, r, n) }

        function c(e) {!s.silent && window.console && console.warn("".concat(o).concat(e)), s.onWarning(e) }
        if (y) {
            if (s.watch) return s.watch = b.watch,
                function(e) {
                    function t(e) { return "LINK" === e.tagName && -1 !== (e.getAttribute("rel") || "").indexOf("stylesheet") && !e.disabled }
                    if (!window.MutationObserver) return;
                    O && (O.disconnect(), O = null);
                    (O = new MutationObserver(function(r) {
                        r.some(function(r) {
                            var n, o = !1;
                            return "attributes" === r.type ? o = t(r.target) : "childList" === r.type && (n = r.addedNodes, o = Array.apply(null, n).some(function(e) {
                                var r = 1 === e.nodeType && e.hasAttribute("data-cssvars"),
                                    n = function(e) { return "STYLE" === e.tagName && !e.disabled }(e) && E.cssVars.test(e.textContent);
                                return !r && (t(e) || n)
                            }) || function(t) {
                                return Array.apply(null, t).some(function(t) {
                                    var r = 1 === t.nodeType,
                                        n = r && "out" === t.getAttribute("data-cssvars"),
                                        o = r && "src" === t.getAttribute("data-cssvars"),
                                        s = o;
                                    if (o || n) {
                                        var a = t.getAttribute("data-cssvars-group"),
                                            c = e.rootElement.querySelector('[data-cssvars-group="'.concat(a, '"]'));
                                        o && (L(e.rootElement), w.dom = {}), c && c.parentNode.removeChild(c)
                                    }
                                    return s
                                })
                            }(r.removedNodes)), o
                        }) && k(e)
                    })).observe(document.documentElement, { attributes: !0, attributeFilter: ["disabled", "href"], childList: !0, subtree: !0 })
                }(s), void k(s);
            if (!1 === s.watch && O && (O.disconnect(), O = null), !s.__benchmark) {
                if (C === s.rootElement) return void

                function(e) {
                    var t = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : 100;
                    clearTimeout(x), x = setTimeout(function() { e.__benchmark = null, k(e) }, t)
                }(r);
                if (s.__benchmark = T(), s.exclude = [O ? '[data-cssvars]:not([data-cssvars=""])' : '[data-cssvars="out"]', s.exclude].filter(function(e) { return e }).join(","), s.variables = function() {
                        var e = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {},
                            t = /^-{2}/;
                        return Object.keys(e).reduce(function(r, n) { return r[t.test(n) ? n : "--".concat(n.replace(/^-+/, ""))] = e[n], r }, {})
                    }(s.variables), !O)
                    if (Array.apply(null, s.rootElement.querySelectorAll('[data-cssvars="out"]')).forEach(function(e) {
                            var t = e.getAttribute("data-cssvars-group");
                            (t ? s.rootElement.querySelector('[data-cssvars="src"][data-cssvars-group="'.concat(t, '"]')) : null) || e.parentNode.removeChild(e)
                        }), A) {
                        var i = s.rootElement.querySelectorAll('[data-cssvars]:not([data-cssvars="out"])');
                        i.length < A && (A = i.length, w.dom = {})
                    }
            }
            if ("loading" !== document.readyState) {
                var d = Boolean(s.shadowDOM || s.rootElement.shadowRoot || s.rootElement.host);
                if (g && s.onlyLegacy) {
                    if (s.updateDOM) {
                        var p = s.rootElement.host || (s.rootElement === document ? document.documentElement : s.rootElement);
                        Object.keys(s.variables).forEach(function(e) { p.style.setProperty(e, s.variables[e]) })
                    }
                } else d && !j ? n({ rootElement: b.rootElement, include: b.include, exclude: s.exclude, onSuccess: function(e, t, r) { return (e = ((e = e.replace(E.cssComments, "").replace(E.cssMediaQueries, "")).match(E.cssVarDeclRules) || []).join("")) || !1 }, onComplete: function(e, t, r) { l(e, { store: w.dom, onWarning: c }), j = !0, k(s) } }) : (C = s.rootElement, n({
                    rootElement: s.rootElement,
                    include: s.include,
                    exclude: s.exclude,
                    onBeforeSend: s.onBeforeSend,
                    onError: function(e, t, r) {
                        var n = e.responseURL || _(r, location.href),
                            o = e.statusText ? "(".concat(e.statusText, ")") : "Unspecified Error" + (0 === e.status ? " (possibly CORS related)" : "");
                        a("CSS XHR Error: ".concat(n, " ").concat(e.status, " ").concat(o), t, e, n)
                    },
                    onSuccess: function(e, t, r) {
                        var n = s.onSuccess(e, t, r);
                        return e = void 0 !== n && !1 === Boolean(n) ? "" : n || e, s.updateURLs && (e = function(e, t) {
                            return (e.replace(E.cssComments, "").match(E.cssUrls) || []).forEach(function(r) {
                                var n = r.replace(E.cssUrls, "$1"),
                                    o = _(n, t);
                                e = e.replace(r, r.replace(n, o))
                            }), e
                        }(e, r)), e
                    },
                    onComplete: function(r, n) {
                        var o = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : [],
                            i = {},
                            p = s.updateDOM ? w.dom : Object.keys(w.job).length ? w.job : w.job = JSON.parse(JSON.stringify(w.dom)),
                            v = !1;
                        if (o.forEach(function(e, t) {
                                if (E.cssVars.test(n[t])) try {
                                    var r = u(n[t], { preserveStatic: s.preserveStatic, removeComments: !0 });
                                    l(r, { parseHost: d, store: i, onWarning: c }), e.__cssVars = { tree: r }
                                } catch (t) { a(t.message, e) }
                            }), s.updateDOM && e(w.user, s.variables), e(i, s.variables), v = Boolean((document.querySelector("[data-cssvars]") || Object.keys(w.dom).length) && Object.keys(i).some(function(e) { return i[e] !== p[e] })), e(p, w.user, i), v) L(s.rootElement), k(s);
                        else {
                            var h = [],
                                y = [],
                                g = !1;
                            if (w.job = {}, s.updateDOM && S.job++, o.forEach(function(t) {
                                    var r = !t.__cssVars;
                                    if (t.__cssVars) try {
                                        m(t.__cssVars.tree, e({}, s, { variables: p, onWarning: c }));
                                        var n = f(t.__cssVars.tree);
                                        if (s.updateDOM) {
                                            if (t.getAttribute("data-cssvars") || t.setAttribute("data-cssvars", "src"), n.length) {
                                                var o = t.getAttribute("data-cssvars-group") || ++S.group,
                                                    i = n.replace(/\s/g, ""),
                                                    u = s.rootElement.querySelector('[data-cssvars="out"][data-cssvars-group="'.concat(o, '"]')) || document.createElement("style");
                                                g = g || E.cssKeyframes.test(n), u.hasAttribute("data-cssvars") || u.setAttribute("data-cssvars", "out"), i === t.textContent.replace(/\s/g, "") ? (r = !0, u && u.parentNode && (t.removeAttribute("data-cssvars-group"), u.parentNode.removeChild(u))) : i !== u.textContent.replace(/\s/g, "") && ([t, u].forEach(function(e) { e.setAttribute("data-cssvars-job", S.job), e.setAttribute("data-cssvars-group", o) }), u.textContent = n, h.push(n), y.push(u), u.parentNode || t.parentNode.insertBefore(u, t.nextSibling))
                                            }
                                        } else t.textContent.replace(/\s/g, "") !== n && h.push(n)
                                    } catch (e) { a(e.message, t) }
                                    r && t.setAttribute("data-cssvars", "skip"), t.hasAttribute("data-cssvars-job") || t.setAttribute("data-cssvars-job", S.job)
                                }), A = s.rootElement.querySelectorAll('[data-cssvars]:not([data-cssvars="out"])').length, s.shadowDOM)
                                for (var b, O = [s.rootElement].concat(t(s.rootElement.querySelectorAll("*"))), x = 0; b = O[x]; ++x)
                                    if (b.shadowRoot && b.shadowRoot.querySelector("style")) {
                                        var j = e({}, s, { rootElement: b.shadowRoot, variables: w.dom });
                                        k(j)
                                    }
                            s.updateDOM && g && M(s.rootElement), C = !1, s.onComplete(h.join(""), y, JSON.parse(JSON.stringify(p)), T() - s.__benchmark)
                        }
                    }
                }))
            } else document.addEventListener("DOMContentLoaded", function e(t) { k(r), document.removeEventListener("DOMContentLoaded", e) })
        }
    }

    function M(e) {
        var t = ["animation-name", "-moz-animation-name", "-webkit-animation-name"].filter(function(e) { return getComputedStyle(document.body)[e] })[0];
        if (t) {
            for (var r = e.getElementsByTagName("*"), n = [], o = 0, s = r.length; o < s; o++) { var a = r[o]; "none" !== getComputedStyle(a)[t] && (a.style[t] += "__CSSVARSPONYFILL-KEYFRAMES__", n.push(a)) }
            document.body.offsetHeight;
            for (var c = 0, i = n.length; c < i; c++) {
                var u = n[c].style;
                u[t] = u[t].replace("__CSSVARSPONYFILL-KEYFRAMES__", "")
            }
        }
    }

    function _(e) {
        var t = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : location.href,
            r = document.implementation.createHTMLDocument(""),
            n = r.createElement("base"),
            o = r.createElement("a");
        return r.head.appendChild(n), r.body.appendChild(o), n.href = t, o.href = e, o.href
    }

    function T() { return y && (window.performance || {}).now ? window.performance.now() : (new Date).getTime() }

    function L(e) { Array.apply(null, e.querySelectorAll('[data-cssvars="skip"],[data-cssvars="src"]')).forEach(function(e) { return e.setAttribute("data-cssvars", "") }) }
    return k.reset = function() { for (var e in C = !1, O && (O.disconnect(), O = null), A = 0, x = null, j = !1, w) w[e] = {} }, k
});

/*!
 * Isotope PACKAGED v3.0.6
 *
 * Licensed GPLv3 for open source use
 * or Isotope Commercial License for commercial use
 *
 * https://isotope.metafizzy.co
 * Copyright 2010-2018 Metafizzy
 */

! function(t, e) { "function" == typeof define && define.amd ? define("jquery-bridget/jquery-bridget", ["jquery"], function(i) { return e(t, i) }) : "object" == typeof module && module.exports ? module.exports = e(t, require("jquery")) : t.jQueryBridget = e(t, t.jQuery) }(window, function(t, e) {
    "use strict";

    function i(i, s, a) {
        function u(t, e, o) {
            var n, s = "$()." + i + '("' + e + '")';
            return t.each(function(t, u) {
                var h = a.data(u, i);
                if (!h) return void r(i + " not initialized. Cannot call methods, i.e. " + s);
                var d = h[e];
                if (!d || "_" == e.charAt(0)) return void r(s + " is not a valid method");
                var l = d.apply(h, o);
                n = void 0 === n ? l : n
            }), void 0 !== n ? n : t
        }

        function h(t, e) {
            t.each(function(t, o) {
                var n = a.data(o, i);
                n ? (n.option(e), n._init()) : (n = new s(o, e), a.data(o, i, n))
            })
        }
        a = a || e || t.jQuery, a && (s.prototype.option || (s.prototype.option = function(t) { a.isPlainObject(t) && (this.options = a.extend(!0, this.options, t)) }), a.fn[i] = function(t) { if ("string" == typeof t) { var e = n.call(arguments, 1); return u(this, t, e) } return h(this, t), this }, o(a))
    }

    function o(t) {!t || t && t.bridget || (t.bridget = i) }
    var n = Array.prototype.slice,
        s = t.console,
        r = "undefined" == typeof s ? function() {} : function(t) { s.error(t) };
    return o(e || t.jQuery), i
}),
function(t, e) { "function" == typeof define && define.amd ? define("ev-emitter/ev-emitter", e) : "object" == typeof module && module.exports ? module.exports = e() : t.EvEmitter = e() }("undefined" != typeof window ? window : this, function() {
    function t() {}
    var e = t.prototype;
    return e.on = function(t, e) {
        if (t && e) {
            var i = this._events = this._events || {},
                o = i[t] = i[t] || [];
            return o.indexOf(e) == -1 && o.push(e), this
        }
    }, e.once = function(t, e) {
        if (t && e) {
            this.on(t, e);
            var i = this._onceEvents = this._onceEvents || {},
                o = i[t] = i[t] || {};
            return o[e] = !0, this
        }
    }, e.off = function(t, e) { var i = this._events && this._events[t]; if (i && i.length) { var o = i.indexOf(e); return o != -1 && i.splice(o, 1), this } }, e.emitEvent = function(t, e) {
        var i = this._events && this._events[t];
        if (i && i.length) {
            i = i.slice(0), e = e || [];
            for (var o = this._onceEvents && this._onceEvents[t], n = 0; n < i.length; n++) {
                var s = i[n],
                    r = o && o[s];
                r && (this.off(t, s), delete o[s]), s.apply(this, e)
            }
            return this
        }
    }, e.allOff = function() { delete this._events, delete this._onceEvents }, t
}),
function(t, e) { "function" == typeof define && define.amd ? define("get-size/get-size", e) : "object" == typeof module && module.exports ? module.exports = e() : t.getSize = e() }(window, function() {
    "use strict";

    function t(t) {
        var e = parseFloat(t),
            i = t.indexOf("%") == -1 && !isNaN(e);
        return i && e
    }

    function e() {}

    function i() {
        for (var t = { width: 0, height: 0, innerWidth: 0, innerHeight: 0, outerWidth: 0, outerHeight: 0 }, e = 0; e < h; e++) {
            var i = u[e];
            t[i] = 0
        }
        return t
    }

    function o(t) { var e = getComputedStyle(t); return e || a("Style returned " + e + ". Are you running this code in a hidden iframe on Firefox? See https://bit.ly/getsizebug1"), e }

    function n() {
        if (!d) {
            d = !0;
            var e = document.createElement("div");
            e.style.width = "200px", e.style.padding = "1px 2px 3px 4px", e.style.borderStyle = "solid", e.style.borderWidth = "1px 2px 3px 4px", e.style.boxSizing = "border-box";
            var i = document.body || document.documentElement;
            i.appendChild(e);
            var n = o(e);
            r = 200 == Math.round(t(n.width)), s.isBoxSizeOuter = r, i.removeChild(e)
        }
    }

    function s(e) {
        if (n(), "string" == typeof e && (e = document.querySelector(e)), e && "object" == typeof e && e.nodeType) {
            var s = o(e);
            if ("none" == s.display) return i();
            var a = {};
            a.width = e.offsetWidth, a.height = e.offsetHeight;
            for (var d = a.isBorderBox = "border-box" == s.boxSizing, l = 0; l < h; l++) {
                var f = u[l],
                    c = s[f],
                    m = parseFloat(c);
                a[f] = isNaN(m) ? 0 : m
            }
            var p = a.paddingLeft + a.paddingRight,
                y = a.paddingTop + a.paddingBottom,
                g = a.marginLeft + a.marginRight,
                v = a.marginTop + a.marginBottom,
                _ = a.borderLeftWidth + a.borderRightWidth,
                z = a.borderTopWidth + a.borderBottomWidth,
                I = d && r,
                x = t(s.width);
            x !== !1 && (a.width = x + (I ? 0 : p + _));
            var S = t(s.height);
            return S !== !1 && (a.height = S + (I ? 0 : y + z)), a.innerWidth = a.width - (p + _), a.innerHeight = a.height - (y + z), a.outerWidth = a.width + g, a.outerHeight = a.height + v, a
        }
    }
    var r, a = "undefined" == typeof console ? e : function(t) { console.error(t) },
        u = ["paddingLeft", "paddingRight", "paddingTop", "paddingBottom", "marginLeft", "marginRight", "marginTop", "marginBottom", "borderLeftWidth", "borderRightWidth", "borderTopWidth", "borderBottomWidth"],
        h = u.length,
        d = !1;
    return s
}),
function(t, e) { "use strict"; "function" == typeof define && define.amd ? define("desandro-matches-selector/matches-selector", e) : "object" == typeof module && module.exports ? module.exports = e() : t.matchesSelector = e() }(window, function() {
    "use strict";
    var t = function() {
        var t = window.Element.prototype;
        if (t.matches) return "matches";
        if (t.matchesSelector) return "matchesSelector";
        for (var e = ["webkit", "moz", "ms", "o"], i = 0; i < e.length; i++) {
            var o = e[i],
                n = o + "MatchesSelector";
            if (t[n]) return n
        }
    }();
    return function(e, i) { return e[t](i) }
}),
function(t, e) { "function" == typeof define && define.amd ? define("fizzy-ui-utils/utils", ["desandro-matches-selector/matches-selector"], function(i) { return e(t, i) }) : "object" == typeof module && module.exports ? module.exports = e(t, require("desandro-matches-selector")) : t.fizzyUIUtils = e(t, t.matchesSelector) }(window, function(t, e) {
    var i = {};
    i.extend = function(t, e) { for (var i in e) t[i] = e[i]; return t }, i.modulo = function(t, e) { return (t % e + e) % e };
    var o = Array.prototype.slice;
    i.makeArray = function(t) { if (Array.isArray(t)) return t; if (null === t || void 0 === t) return []; var e = "object" == typeof t && "number" == typeof t.length; return e ? o.call(t) : [t] }, i.removeFrom = function(t, e) {
        var i = t.indexOf(e);
        i != -1 && t.splice(i, 1)
    }, i.getParent = function(t, i) {
        for (; t.parentNode && t != document.body;)
            if (t = t.parentNode, e(t, i)) return t
    }, i.getQueryElement = function(t) { return "string" == typeof t ? document.querySelector(t) : t }, i.handleEvent = function(t) {
        var e = "on" + t.type;
        this[e] && this[e](t)
    }, i.filterFindElements = function(t, o) {
        t = i.makeArray(t);
        var n = [];
        return t.forEach(function(t) {
            if (t instanceof HTMLElement) {
                if (!o) return void n.push(t);
                e(t, o) && n.push(t);
                for (var i = t.querySelectorAll(o), s = 0; s < i.length; s++) n.push(i[s])
            }
        }), n
    }, i.debounceMethod = function(t, e, i) {
        i = i || 100;
        var o = t.prototype[e],
            n = e + "Timeout";
        t.prototype[e] = function() {
            var t = this[n];
            clearTimeout(t);
            var e = arguments,
                s = this;
            this[n] = setTimeout(function() { o.apply(s, e), delete s[n] }, i)
        }
    }, i.docReady = function(t) { var e = document.readyState; "complete" == e || "interactive" == e ? setTimeout(t) : document.addEventListener("DOMContentLoaded", t) }, i.toDashed = function(t) { return t.replace(/(.)([A-Z])/g, function(t, e, i) { return e + "-" + i }).toLowerCase() };
    var n = t.console;
    return i.htmlInit = function(e, o) {
        i.docReady(function() {
            var s = i.toDashed(o),
                r = "data-" + s,
                a = document.querySelectorAll("[" + r + "]"),
                u = document.querySelectorAll(".js-" + s),
                h = i.makeArray(a).concat(i.makeArray(u)),
                d = r + "-options",
                l = t.jQuery;
            h.forEach(function(t) {
                var i, s = t.getAttribute(r) || t.getAttribute(d);
                try { i = s && JSON.parse(s) } catch (a) { return void(n && n.error("Error parsing " + r + " on " + t.className + ": " + a)) }
                var u = new e(t, i);
                l && l.data(t, o, u)
            })
        })
    }, i
}),
function(t, e) { "function" == typeof define && define.amd ? define("outlayer/item", ["ev-emitter/ev-emitter", "get-size/get-size"], e) : "object" == typeof module && module.exports ? module.exports = e(require("ev-emitter"), require("get-size")) : (t.Outlayer = {}, t.Outlayer.Item = e(t.EvEmitter, t.getSize)) }(window, function(t, e) {
    "use strict";

    function i(t) { for (var e in t) return !1; return e = null, !0 }

    function o(t, e) { t && (this.element = t, this.layout = e, this.position = { x: 0, y: 0 }, this._create()) }

    function n(t) { return t.replace(/([A-Z])/g, function(t) { return "-" + t.toLowerCase() }) }
    var s = document.documentElement.style,
        r = "string" == typeof s.transition ? "transition" : "WebkitTransition",
        a = "string" == typeof s.transform ? "transform" : "WebkitTransform",
        u = { WebkitTransition: "webkitTransitionEnd", transition: "transitionend" }[r],
        h = { transform: a, transition: r, transitionDuration: r + "Duration", transitionProperty: r + "Property", transitionDelay: r + "Delay" },
        d = o.prototype = Object.create(t.prototype);
    d.constructor = o, d._create = function() { this._transn = { ingProperties: {}, clean: {}, onEnd: {} }, this.css({ position: "absolute" }) }, d.handleEvent = function(t) {
        var e = "on" + t.type;
        this[e] && this[e](t)
    }, d.getSize = function() { this.size = e(this.element) }, d.css = function(t) {
        var e = this.element.style;
        for (var i in t) {
            var o = h[i] || i;
            e[o] = t[i]
        }
    }, d.getPosition = function() {
        var t = getComputedStyle(this.element),
            e = this.layout._getOption("originLeft"),
            i = this.layout._getOption("originTop"),
            o = t[e ? "left" : "right"],
            n = t[i ? "top" : "bottom"],
            s = parseFloat(o),
            r = parseFloat(n),
            a = this.layout.size;
        o.indexOf("%") != -1 && (s = s / 100 * a.width), n.indexOf("%") != -1 && (r = r / 100 * a.height), s = isNaN(s) ? 0 : s, r = isNaN(r) ? 0 : r, s -= e ? a.paddingLeft : a.paddingRight, r -= i ? a.paddingTop : a.paddingBottom, this.position.x = s, this.position.y = r
    }, d.layoutPosition = function() {
        var t = this.layout.size,
            e = {},
            i = this.layout._getOption("originLeft"),
            o = this.layout._getOption("originTop"),
            n = i ? "paddingLeft" : "paddingRight",
            s = i ? "left" : "right",
            r = i ? "right" : "left",
            a = this.position.x + t[n];
        e[s] = this.getXValue(a), e[r] = "";
        var u = o ? "paddingTop" : "paddingBottom",
            h = o ? "top" : "bottom",
            d = o ? "bottom" : "top",
            l = this.position.y + t[u];
        e[h] = this.getYValue(l), e[d] = "", this.css(e), this.emitEvent("layout", [this])
    }, d.getXValue = function(t) { var e = this.layout._getOption("horizontal"); return this.layout.options.percentPosition && !e ? t / this.layout.size.width * 100 + "%" : t + "px" }, d.getYValue = function(t) { var e = this.layout._getOption("horizontal"); return this.layout.options.percentPosition && e ? t / this.layout.size.height * 100 + "%" : t + "px" }, d._transitionTo = function(t, e) {
        this.getPosition();
        var i = this.position.x,
            o = this.position.y,
            n = t == this.position.x && e == this.position.y;
        if (this.setPosition(t, e), n && !this.isTransitioning) return void this.layoutPosition();
        var s = t - i,
            r = e - o,
            a = {};
        a.transform = this.getTranslate(s, r), this.transition({ to: a, onTransitionEnd: { transform: this.layoutPosition }, isCleaning: !0 })
    }, d.getTranslate = function(t, e) {
        var i = this.layout._getOption("originLeft"),
            o = this.layout._getOption("originTop");
        return t = i ? t : -t, e = o ? e : -e, "translate3d(" + t + "px, " + e + "px, 0)"
    }, d.goTo = function(t, e) { this.setPosition(t, e), this.layoutPosition() }, d.moveTo = d._transitionTo, d.setPosition = function(t, e) { this.position.x = parseFloat(t), this.position.y = parseFloat(e) }, d._nonTransition = function(t) { this.css(t.to), t.isCleaning && this._removeStyles(t.to); for (var e in t.onTransitionEnd) t.onTransitionEnd[e].call(this) }, d.transition = function(t) {
        if (!parseFloat(this.layout.options.transitionDuration)) return void this._nonTransition(t);
        var e = this._transn;
        for (var i in t.onTransitionEnd) e.onEnd[i] = t.onTransitionEnd[i];
        for (i in t.to) e.ingProperties[i] = !0, t.isCleaning && (e.clean[i] = !0);
        if (t.from) {
            this.css(t.from);
            var o = this.element.offsetHeight;
            o = null
        }
        this.enableTransition(t.to), this.css(t.to), this.isTransitioning = !0
    };
    var l = "opacity," + n(a);
    d.enableTransition = function() {
        if (!this.isTransitioning) {
            var t = this.layout.options.transitionDuration;
            t = "number" == typeof t ? t + "ms" : t, this.css({ transitionProperty: l, transitionDuration: t, transitionDelay: this.staggerDelay || 0 }), this.element.addEventListener(u, this, !1)
        }
    }, d.onwebkitTransitionEnd = function(t) { this.ontransitionend(t) }, d.onotransitionend = function(t) { this.ontransitionend(t) };
    var f = { "-webkit-transform": "transform" };
    d.ontransitionend = function(t) {
        if (t.target === this.element) {
            var e = this._transn,
                o = f[t.propertyName] || t.propertyName;
            if (delete e.ingProperties[o], i(e.ingProperties) && this.disableTransition(), o in e.clean && (this.element.style[t.propertyName] = "", delete e.clean[o]), o in e.onEnd) {
                var n = e.onEnd[o];
                n.call(this), delete e.onEnd[o]
            }
            this.emitEvent("transitionEnd", [this])
        }
    }, d.disableTransition = function() { this.removeTransitionStyles(), this.element.removeEventListener(u, this, !1), this.isTransitioning = !1 }, d._removeStyles = function(t) {
        var e = {};
        for (var i in t) e[i] = "";
        this.css(e)
    };
    var c = { transitionProperty: "", transitionDuration: "", transitionDelay: "" };
    return d.removeTransitionStyles = function() { this.css(c) }, d.stagger = function(t) { t = isNaN(t) ? 0 : t, this.staggerDelay = t + "ms" }, d.removeElem = function() { this.element.parentNode.removeChild(this.element), this.css({ display: "" }), this.emitEvent("remove", [this]) }, d.remove = function() { return r && parseFloat(this.layout.options.transitionDuration) ? (this.once("transitionEnd", function() { this.removeElem() }), void this.hide()) : void this.removeElem() }, d.reveal = function() {
        delete this.isHidden, this.css({ display: "" });
        var t = this.layout.options,
            e = {},
            i = this.getHideRevealTransitionEndProperty("visibleStyle");
        e[i] = this.onRevealTransitionEnd, this.transition({ from: t.hiddenStyle, to: t.visibleStyle, isCleaning: !0, onTransitionEnd: e })
    }, d.onRevealTransitionEnd = function() { this.isHidden || this.emitEvent("reveal") }, d.getHideRevealTransitionEndProperty = function(t) { var e = this.layout.options[t]; if (e.opacity) return "opacity"; for (var i in e) return i }, d.hide = function() {
        this.isHidden = !0, this.css({ display: "" });
        var t = this.layout.options,
            e = {},
            i = this.getHideRevealTransitionEndProperty("hiddenStyle");
        e[i] = this.onHideTransitionEnd, this.transition({ from: t.visibleStyle, to: t.hiddenStyle, isCleaning: !0, onTransitionEnd: e })
    }, d.onHideTransitionEnd = function() { this.isHidden && (this.css({ display: "none" }), this.emitEvent("hide")) }, d.destroy = function() { this.css({ position: "", left: "", right: "", top: "", bottom: "", transition: "", transform: "" }) }, o
}),
function(t, e) { "use strict"; "function" == typeof define && define.amd ? define("outlayer/outlayer", ["ev-emitter/ev-emitter", "get-size/get-size", "fizzy-ui-utils/utils", "./item"], function(i, o, n, s) { return e(t, i, o, n, s) }) : "object" == typeof module && module.exports ? module.exports = e(t, require("ev-emitter"), require("get-size"), require("fizzy-ui-utils"), require("./item")) : t.Outlayer = e(t, t.EvEmitter, t.getSize, t.fizzyUIUtils, t.Outlayer.Item) }(window, function(t, e, i, o, n) {
    "use strict";

    function s(t, e) {
        var i = o.getQueryElement(t);
        if (!i) return void(u && u.error("Bad element for " + this.constructor.namespace + ": " + (i || t)));
        this.element = i, h && (this.$element = h(this.element)), this.options = o.extend({}, this.constructor.defaults), this.option(e);
        var n = ++l;
        this.element.outlayerGUID = n, f[n] = this, this._create();
        var s = this._getOption("initLayout");
        s && this.layout()
    }

    function r(t) {
        function e() { t.apply(this, arguments) }
        return e.prototype = Object.create(t.prototype), e.prototype.constructor = e, e
    }

    function a(t) {
        if ("number" == typeof t) return t;
        var e = t.match(/(^\d*\.?\d*)(\w*)/),
            i = e && e[1],
            o = e && e[2];
        if (!i.length) return 0;
        i = parseFloat(i);
        var n = m[o] || 1;
        return i * n
    }
    var u = t.console,
        h = t.jQuery,
        d = function() {},
        l = 0,
        f = {};
    s.namespace = "outlayer", s.Item = n, s.defaults = { containerStyle: { position: "relative" }, initLayout: !0, originLeft: !0, originTop: !0, resize: !0, resizeContainer: !0, transitionDuration: "0.4s", hiddenStyle: { opacity: 0, transform: "scale(0.001)" }, visibleStyle: { opacity: 1, transform: "scale(1)" } };
    var c = s.prototype;
    o.extend(c, e.prototype), c.option = function(t) { o.extend(this.options, t) }, c._getOption = function(t) { var e = this.constructor.compatOptions[t]; return e && void 0 !== this.options[e] ? this.options[e] : this.options[t] }, s.compatOptions = { initLayout: "isInitLayout", horizontal: "isHorizontal", layoutInstant: "isLayoutInstant", originLeft: "isOriginLeft", originTop: "isOriginTop", resize: "isResizeBound", resizeContainer: "isResizingContainer" }, c._create = function() {
        this.reloadItems(), this.stamps = [], this.stamp(this.options.stamp), o.extend(this.element.style, this.options.containerStyle);
        var t = this._getOption("resize");
        t && this.bindResize()
    }, c.reloadItems = function() { this.items = this._itemize(this.element.children) }, c._itemize = function(t) {
        for (var e = this._filterFindItemElements(t), i = this.constructor.Item, o = [], n = 0; n < e.length; n++) {
            var s = e[n],
                r = new i(s, this);
            o.push(r)
        }
        return o
    }, c._filterFindItemElements = function(t) { return o.filterFindElements(t, this.options.itemSelector) }, c.getItemElements = function() { return this.items.map(function(t) { return t.element }) }, c.layout = function() {
        this._resetLayout(), this._manageStamps();
        var t = this._getOption("layoutInstant"),
            e = void 0 !== t ? t : !this._isLayoutInited;
        this.layoutItems(this.items, e), this._isLayoutInited = !0
    }, c._init = c.layout, c._resetLayout = function() { this.getSize() }, c.getSize = function() { this.size = i(this.element) }, c._getMeasurement = function(t, e) {
        var o, n = this.options[t];
        n ? ("string" == typeof n ? o = this.element.querySelector(n) : n instanceof HTMLElement && (o = n), this[t] = o ? i(o)[e] : n) : this[t] = 0
    }, c.layoutItems = function(t, e) { t = this._getItemsForLayout(t), this._layoutItems(t, e), this._postLayout() }, c._getItemsForLayout = function(t) { return t.filter(function(t) { return !t.isIgnored }) }, c._layoutItems = function(t, e) {
        if (this._emitCompleteOnItems("layout", t), t && t.length) {
            var i = [];
            t.forEach(function(t) {
                var o = this._getItemLayoutPosition(t);
                o.item = t, o.isInstant = e || t.isLayoutInstant, i.push(o)
            }, this), this._processLayoutQueue(i)
        }
    }, c._getItemLayoutPosition = function() { return { x: 0, y: 0 } }, c._processLayoutQueue = function(t) { this.updateStagger(), t.forEach(function(t, e) { this._positionItem(t.item, t.x, t.y, t.isInstant, e) }, this) }, c.updateStagger = function() { var t = this.options.stagger; return null === t || void 0 === t ? void(this.stagger = 0) : (this.stagger = a(t), this.stagger) }, c._positionItem = function(t, e, i, o, n) { o ? t.goTo(e, i) : (t.stagger(n * this.stagger), t.moveTo(e, i)) }, c._postLayout = function() { this.resizeContainer() }, c.resizeContainer = function() {
        var t = this._getOption("resizeContainer");
        if (t) {
            var e = this._getContainerSize();
            e && (this._setContainerMeasure(e.width, !0), this._setContainerMeasure(e.height, !1))
        }
    }, c._getContainerSize = d, c._setContainerMeasure = function(t, e) {
        if (void 0 !== t) {
            var i = this.size;
            i.isBorderBox && (t += e ? i.paddingLeft + i.paddingRight + i.borderLeftWidth + i.borderRightWidth : i.paddingBottom + i.paddingTop + i.borderTopWidth + i.borderBottomWidth), t = Math.max(t, 0), this.element.style[e ? "width" : "height"] = t + "px"
        }
    }, c._emitCompleteOnItems = function(t, e) {
        function i() { n.dispatchEvent(t + "Complete", null, [e]) }

        function o() { r++, r == s && i() }
        var n = this,
            s = e.length;
        if (!e || !s) return void i();
        var r = 0;
        e.forEach(function(e) { e.once(t, o) })
    }, c.dispatchEvent = function(t, e, i) {
        var o = e ? [e].concat(i) : i;
        if (this.emitEvent(t, o), h)
            if (this.$element = this.$element || h(this.element), e) {
                var n = h.Event(e);
                n.type = t, this.$element.trigger(n, i)
            } else this.$element.trigger(t, i)
    }, c.ignore = function(t) {
        var e = this.getItem(t);
        e && (e.isIgnored = !0)
    }, c.unignore = function(t) {
        var e = this.getItem(t);
        e && delete e.isIgnored
    }, c.stamp = function(t) { t = this._find(t), t && (this.stamps = this.stamps.concat(t), t.forEach(this.ignore, this)) }, c.unstamp = function(t) { t = this._find(t), t && t.forEach(function(t) { o.removeFrom(this.stamps, t), this.unignore(t) }, this) }, c._find = function(t) { if (t) return "string" == typeof t && (t = this.element.querySelectorAll(t)), t = o.makeArray(t) }, c._manageStamps = function() { this.stamps && this.stamps.length && (this._getBoundingRect(), this.stamps.forEach(this._manageStamp, this)) }, c._getBoundingRect = function() {
        var t = this.element.getBoundingClientRect(),
            e = this.size;
        this._boundingRect = { left: t.left + e.paddingLeft + e.borderLeftWidth, top: t.top + e.paddingTop + e.borderTopWidth, right: t.right - (e.paddingRight + e.borderRightWidth), bottom: t.bottom - (e.paddingBottom + e.borderBottomWidth) }
    }, c._manageStamp = d, c._getElementOffset = function(t) {
        var e = t.getBoundingClientRect(),
            o = this._boundingRect,
            n = i(t),
            s = { left: e.left - o.left - n.marginLeft, top: e.top - o.top - n.marginTop, right: o.right - e.right - n.marginRight, bottom: o.bottom - e.bottom - n.marginBottom };
        return s
    }, c.handleEvent = o.handleEvent, c.bindResize = function() { t.addEventListener("resize", this), this.isResizeBound = !0 }, c.unbindResize = function() { t.removeEventListener("resize", this), this.isResizeBound = !1 }, c.onresize = function() { this.resize() }, o.debounceMethod(s, "onresize", 100), c.resize = function() { this.isResizeBound && this.needsResizeLayout() && this.layout() }, c.needsResizeLayout = function() {
        var t = i(this.element),
            e = this.size && t;
        return e && t.innerWidth !== this.size.innerWidth
    }, c.addItems = function(t) { var e = this._itemize(t); return e.length && (this.items = this.items.concat(e)), e }, c.appended = function(t) {
        var e = this.addItems(t);
        e.length && (this.layoutItems(e, !0), this.reveal(e))
    }, c.prepended = function(t) {
        var e = this._itemize(t);
        if (e.length) {
            var i = this.items.slice(0);
            this.items = e.concat(i), this._resetLayout(), this._manageStamps(), this.layoutItems(e, !0), this.reveal(e), this.layoutItems(i)
        }
    }, c.reveal = function(t) {
        if (this._emitCompleteOnItems("reveal", t), t && t.length) {
            var e = this.updateStagger();
            t.forEach(function(t, i) { t.stagger(i * e), t.reveal() })
        }
    }, c.hide = function(t) {
        if (this._emitCompleteOnItems("hide", t), t && t.length) {
            var e = this.updateStagger();
            t.forEach(function(t, i) { t.stagger(i * e), t.hide() })
        }
    }, c.revealItemElements = function(t) {
        var e = this.getItems(t);
        this.reveal(e)
    }, c.hideItemElements = function(t) {
        var e = this.getItems(t);
        this.hide(e)
    }, c.getItem = function(t) { for (var e = 0; e < this.items.length; e++) { var i = this.items[e]; if (i.element == t) return i } }, c.getItems = function(t) {
        t = o.makeArray(t);
        var e = [];
        return t.forEach(function(t) {
            var i = this.getItem(t);
            i && e.push(i)
        }, this), e
    }, c.remove = function(t) {
        var e = this.getItems(t);
        this._emitCompleteOnItems("remove", e), e && e.length && e.forEach(function(t) { t.remove(), o.removeFrom(this.items, t) }, this)
    }, c.destroy = function() {
        var t = this.element.style;
        t.height = "", t.position = "", t.width = "", this.items.forEach(function(t) { t.destroy() }), this.unbindResize();
        var e = this.element.outlayerGUID;
        delete f[e], delete this.element.outlayerGUID, h && h.removeData(this.element, this.constructor.namespace)
    }, s.data = function(t) { t = o.getQueryElement(t); var e = t && t.outlayerGUID; return e && f[e] }, s.create = function(t, e) { var i = r(s); return i.defaults = o.extend({}, s.defaults), o.extend(i.defaults, e), i.compatOptions = o.extend({}, s.compatOptions), i.namespace = t, i.data = s.data, i.Item = r(n), o.htmlInit(i, t), h && h.bridget && h.bridget(t, i), i };
    var m = { ms: 1, s: 1e3 };
    return s.Item = n, s
}),
function(t, e) { "function" == typeof define && define.amd ? define("isotope-layout/js/item", ["outlayer/outlayer"], e) : "object" == typeof module && module.exports ? module.exports = e(require("outlayer")) : (t.Isotope = t.Isotope || {}, t.Isotope.Item = e(t.Outlayer)) }(window, function(t) {
    "use strict";

    function e() { t.Item.apply(this, arguments) }
    var i = e.prototype = Object.create(t.Item.prototype),
        o = i._create;
    i._create = function() { this.id = this.layout.itemGUID++, o.call(this), this.sortData = {} }, i.updateSortData = function() {
        if (!this.isIgnored) {
            this.sortData.id = this.id, this.sortData["original-order"] = this.id, this.sortData.random = Math.random();
            var t = this.layout.options.getSortData,
                e = this.layout._sorters;
            for (var i in t) {
                var o = e[i];
                this.sortData[i] = o(this.element, this)
            }
        }
    };
    var n = i.destroy;
    return i.destroy = function() { n.apply(this, arguments), this.css({ display: "" }) }, e
}),
function(t, e) { "function" == typeof define && define.amd ? define("isotope-layout/js/layout-mode", ["get-size/get-size", "outlayer/outlayer"], e) : "object" == typeof module && module.exports ? module.exports = e(require("get-size"), require("outlayer")) : (t.Isotope = t.Isotope || {}, t.Isotope.LayoutMode = e(t.getSize, t.Outlayer)) }(window, function(t, e) {
    "use strict";

    function i(t) { this.isotope = t, t && (this.options = t.options[this.namespace], this.element = t.element, this.items = t.filteredItems, this.size = t.size) }
    var o = i.prototype,
        n = ["_resetLayout", "_getItemLayoutPosition", "_manageStamp", "_getContainerSize", "_getElementOffset", "needsResizeLayout", "_getOption"];
    return n.forEach(function(t) { o[t] = function() { return e.prototype[t].apply(this.isotope, arguments) } }), o.needsVerticalResizeLayout = function() {
        var e = t(this.isotope.element),
            i = this.isotope.size && e;
        return i && e.innerHeight != this.isotope.size.innerHeight
    }, o._getMeasurement = function() { this.isotope._getMeasurement.apply(this, arguments) }, o.getColumnWidth = function() { this.getSegmentSize("column", "Width") }, o.getRowHeight = function() { this.getSegmentSize("row", "Height") }, o.getSegmentSize = function(t, e) {
        var i = t + e,
            o = "outer" + e;
        if (this._getMeasurement(i, o), !this[i]) {
            var n = this.getFirstItemSize();
            this[i] = n && n[o] || this.isotope.size["inner" + e]
        }
    }, o.getFirstItemSize = function() { var e = this.isotope.filteredItems[0]; return e && e.element && t(e.element) }, o.layout = function() { this.isotope.layout.apply(this.isotope, arguments) }, o.getSize = function() { this.isotope.getSize(), this.size = this.isotope.size }, i.modes = {}, i.create = function(t, e) {
        function n() { i.apply(this, arguments) }
        return n.prototype = Object.create(o), n.prototype.constructor = n, e && (n.options = e), n.prototype.namespace = t, i.modes[t] = n, n
    }, i
}),
function(t, e) { "function" == typeof define && define.amd ? define("masonry-layout/masonry", ["outlayer/outlayer", "get-size/get-size"], e) : "object" == typeof module && module.exports ? module.exports = e(require("outlayer"), require("get-size")) : t.Masonry = e(t.Outlayer, t.getSize) }(window, function(t, e) {
    var i = t.create("masonry");
    i.compatOptions.fitWidth = "isFitWidth";
    var o = i.prototype;
    return o._resetLayout = function() {
        this.getSize(), this._getMeasurement("columnWidth", "outerWidth"), this._getMeasurement("gutter", "outerWidth"), this.measureColumns(), this.colYs = [];
        for (var t = 0; t < this.cols; t++) this.colYs.push(0);
        this.maxY = 0, this.horizontalColIndex = 0
    }, o.measureColumns = function() {
        if (this.getContainerWidth(), !this.columnWidth) {
            var t = this.items[0],
                i = t && t.element;
            this.columnWidth = i && e(i).outerWidth || this.containerWidth
        }
        var o = this.columnWidth += this.gutter,
            n = this.containerWidth + this.gutter,
            s = n / o,
            r = o - n % o,
            a = r && r < 1 ? "round" : "floor";
        s = Math[a](s), this.cols = Math.max(s, 1)
    }, o.getContainerWidth = function() {
        var t = this._getOption("fitWidth"),
            i = t ? this.element.parentNode : this.element,
            o = e(i);
        this.containerWidth = o && o.innerWidth
    }, o._getItemLayoutPosition = function(t) {
        t.getSize();
        var e = t.size.outerWidth % this.columnWidth,
            i = e && e < 1 ? "round" : "ceil",
            o = Math[i](t.size.outerWidth / this.columnWidth);
        o = Math.min(o, this.cols);
        for (var n = this.options.horizontalOrder ? "_getHorizontalColPosition" : "_getTopColPosition", s = this[n](o, t), r = { x: this.columnWidth * s.col, y: s.y }, a = s.y + t.size.outerHeight, u = o + s.col, h = s.col; h < u; h++) this.colYs[h] = a;
        return r
    }, o._getTopColPosition = function(t) {
        var e = this._getTopColGroup(t),
            i = Math.min.apply(Math, e);
        return { col: e.indexOf(i), y: i }
    }, o._getTopColGroup = function(t) { if (t < 2) return this.colYs; for (var e = [], i = this.cols + 1 - t, o = 0; o < i; o++) e[o] = this._getColGroupY(o, t); return e }, o._getColGroupY = function(t, e) { if (e < 2) return this.colYs[t]; var i = this.colYs.slice(t, t + e); return Math.max.apply(Math, i) }, o._getHorizontalColPosition = function(t, e) {
        var i = this.horizontalColIndex % this.cols,
            o = t > 1 && i + t > this.cols;
        i = o ? 0 : i;
        var n = e.size.outerWidth && e.size.outerHeight;
        return this.horizontalColIndex = n ? i + t : this.horizontalColIndex, { col: i, y: this._getColGroupY(i, t) }
    }, o._manageStamp = function(t) {
        var i = e(t),
            o = this._getElementOffset(t),
            n = this._getOption("originLeft"),
            s = n ? o.left : o.right,
            r = s + i.outerWidth,
            a = Math.floor(s / this.columnWidth);
        a = Math.max(0, a);
        var u = Math.floor(r / this.columnWidth);
        u -= r % this.columnWidth ? 0 : 1, u = Math.min(this.cols - 1, u);
        for (var h = this._getOption("originTop"), d = (h ? o.top : o.bottom) + i.outerHeight, l = a; l <= u; l++) this.colYs[l] = Math.max(d, this.colYs[l])
    }, o._getContainerSize = function() { this.maxY = Math.max.apply(Math, this.colYs); var t = { height: this.maxY }; return this._getOption("fitWidth") && (t.width = this._getContainerFitWidth()), t }, o._getContainerFitWidth = function() { for (var t = 0, e = this.cols; --e && 0 === this.colYs[e];) t++; return (this.cols - t) * this.columnWidth - this.gutter }, o.needsResizeLayout = function() { var t = this.containerWidth; return this.getContainerWidth(), t != this.containerWidth }, i
}),
function(t, e) { "function" == typeof define && define.amd ? define("isotope-layout/js/layout-modes/masonry", ["../layout-mode", "masonry-layout/masonry"], e) : "object" == typeof module && module.exports ? module.exports = e(require("../layout-mode"), require("masonry-layout")) : e(t.Isotope.LayoutMode, t.Masonry) }(window, function(t, e) {
    "use strict";
    var i = t.create("masonry"),
        o = i.prototype,
        n = { _getElementOffset: !0, layout: !0, _getMeasurement: !0 };
    for (var s in e.prototype) n[s] || (o[s] = e.prototype[s]);
    var r = o.measureColumns;
    o.measureColumns = function() { this.items = this.isotope.filteredItems, r.call(this) };
    var a = o._getOption;
    return o._getOption = function(t) { return "fitWidth" == t ? void 0 !== this.options.isFitWidth ? this.options.isFitWidth : this.options.fitWidth : a.apply(this.isotope, arguments) }, i
}),
function(t, e) { "function" == typeof define && define.amd ? define("isotope-layout/js/layout-modes/fit-rows", ["../layout-mode"], e) : "object" == typeof exports ? module.exports = e(require("../layout-mode")) : e(t.Isotope.LayoutMode) }(window, function(t) {
    "use strict";
    var e = t.create("fitRows"),
        i = e.prototype;
    return i._resetLayout = function() { this.x = 0, this.y = 0, this.maxY = 0, this._getMeasurement("gutter", "outerWidth") }, i._getItemLayoutPosition = function(t) {
        t.getSize();
        var e = t.size.outerWidth + this.gutter,
            i = this.isotope.size.innerWidth + this.gutter;
        0 !== this.x && e + this.x > i && (this.x = 0, this.y = this.maxY);
        var o = { x: this.x, y: this.y };
        return this.maxY = Math.max(this.maxY, this.y + t.size.outerHeight), this.x += e, o
    }, i._getContainerSize = function() { return { height: this.maxY } }, e
}),
function(t, e) { "function" == typeof define && define.amd ? define("isotope-layout/js/layout-modes/vertical", ["../layout-mode"], e) : "object" == typeof module && module.exports ? module.exports = e(require("../layout-mode")) : e(t.Isotope.LayoutMode) }(window, function(t) {
    "use strict";
    var e = t.create("vertical", { horizontalAlignment: 0 }),
        i = e.prototype;
    return i._resetLayout = function() { this.y = 0 }, i._getItemLayoutPosition = function(t) {
        t.getSize();
        var e = (this.isotope.size.innerWidth - t.size.outerWidth) * this.options.horizontalAlignment,
            i = this.y;
        return this.y += t.size.outerHeight, { x: e, y: i }
    }, i._getContainerSize = function() { return { height: this.y } }, e
}),
function(t, e) { "function" == typeof define && define.amd ? define(["outlayer/outlayer", "get-size/get-size", "desandro-matches-selector/matches-selector", "fizzy-ui-utils/utils", "isotope-layout/js/item", "isotope-layout/js/layout-mode", "isotope-layout/js/layout-modes/masonry", "isotope-layout/js/layout-modes/fit-rows", "isotope-layout/js/layout-modes/vertical"], function(i, o, n, s, r, a) { return e(t, i, o, n, s, r, a) }) : "object" == typeof module && module.exports ? module.exports = e(t, require("outlayer"), require("get-size"), require("desandro-matches-selector"), require("fizzy-ui-utils"), require("isotope-layout/js/item"), require("isotope-layout/js/layout-mode"), require("isotope-layout/js/layout-modes/masonry"), require("isotope-layout/js/layout-modes/fit-rows"), require("isotope-layout/js/layout-modes/vertical")) : t.Isotope = e(t, t.Outlayer, t.getSize, t.matchesSelector, t.fizzyUIUtils, t.Isotope.Item, t.Isotope.LayoutMode) }(window, function(t, e, i, o, n, s, r) {
    function a(t, e) {
        return function(i, o) {
            for (var n = 0; n < t.length; n++) {
                var s = t[n],
                    r = i.sortData[s],
                    a = o.sortData[s];
                if (r > a || r < a) {
                    var u = void 0 !== e[s] ? e[s] : e,
                        h = u ? 1 : -1;
                    return (r > a ? 1 : -1) * h
                }
            }
            return 0
        }
    }
    var u = t.jQuery,
        h = String.prototype.trim ? function(t) { return t.trim() } : function(t) { return t.replace(/^\s+|\s+$/g, "") },
        d = e.create("isotope", { layoutMode: "masonry", isJQueryFiltering: !0, sortAscending: !0 });
    d.Item = s, d.LayoutMode = r;
    var l = d.prototype;
    l._create = function() { this.itemGUID = 0, this._sorters = {}, this._getSorters(), e.prototype._create.call(this), this.modes = {}, this.filteredItems = this.items, this.sortHistory = ["original-order"]; for (var t in r.modes) this._initLayoutMode(t) }, l.reloadItems = function() { this.itemGUID = 0, e.prototype.reloadItems.call(this) }, l._itemize = function() {
        for (var t = e.prototype._itemize.apply(this, arguments), i = 0; i < t.length; i++) {
            var o = t[i];
            o.id = this.itemGUID++
        }
        return this._updateItemsSortData(t), t
    }, l._initLayoutMode = function(t) {
        var e = r.modes[t],
            i = this.options[t] || {};
        this.options[t] = e.options ? n.extend(e.options, i) : i, this.modes[t] = new e(this)
    }, l.layout = function() { return !this._isLayoutInited && this._getOption("initLayout") ? void this.arrange() : void this._layout() }, l._layout = function() {
        var t = this._getIsInstant();
        this._resetLayout(), this._manageStamps(), this.layoutItems(this.filteredItems, t), this._isLayoutInited = !0
    }, l.arrange = function(t) {
        this.option(t), this._getIsInstant();
        var e = this._filter(this.items);
        this.filteredItems = e.matches, this._bindArrangeComplete(), this._isInstant ? this._noTransition(this._hideReveal, [e]) : this._hideReveal(e), this._sort(), this._layout()
    }, l._init = l.arrange, l._hideReveal = function(t) { this.reveal(t.needReveal), this.hide(t.needHide) }, l._getIsInstant = function() {
        var t = this._getOption("layoutInstant"),
            e = void 0 !== t ? t : !this._isLayoutInited;
        return this._isInstant = e, e
    }, l._bindArrangeComplete = function() {
        function t() { e && i && o && n.dispatchEvent("arrangeComplete", null, [n.filteredItems]) }
        var e, i, o, n = this;
        this.once("layoutComplete", function() { e = !0, t() }), this.once("hideComplete", function() { i = !0, t() }), this.once("revealComplete", function() { o = !0, t() })
    }, l._filter = function(t) {
        var e = this.options.filter;
        e = e || "*";
        for (var i = [], o = [], n = [], s = this._getFilterTest(e), r = 0; r < t.length; r++) {
            var a = t[r];
            if (!a.isIgnored) {
                var u = s(a);
                u && i.push(a), u && a.isHidden ? o.push(a) : u || a.isHidden || n.push(a)
            }
        }
        return { matches: i, needReveal: o, needHide: n }
    }, l._getFilterTest = function(t) {
        return u && this.options.isJQueryFiltering ? function(e) {
            return u(e.element).is(t);
        } : "function" == typeof t ? function(e) { return t(e.element) } : function(e) { return o(e.element, t) }
    }, l.updateSortData = function(t) {
        var e;
        t ? (t = n.makeArray(t), e = this.getItems(t)) : e = this.items, this._getSorters(), this._updateItemsSortData(e)
    }, l._getSorters = function() {
        var t = this.options.getSortData;
        for (var e in t) {
            var i = t[e];
            this._sorters[e] = f(i)
        }
    }, l._updateItemsSortData = function(t) {
        for (var e = t && t.length, i = 0; e && i < e; i++) {
            var o = t[i];
            o.updateSortData()
        }
    };
    var f = function() {
        function t(t) {
            if ("string" != typeof t) return t;
            var i = h(t).split(" "),
                o = i[0],
                n = o.match(/^\[(.+)\]$/),
                s = n && n[1],
                r = e(s, o),
                a = d.sortDataParsers[i[1]];
            return t = a ? function(t) { return t && a(r(t)) } : function(t) { return t && r(t) }
        }

        function e(t, e) { return t ? function(e) { return e.getAttribute(t) } : function(t) { var i = t.querySelector(e); return i && i.textContent } }
        return t
    }();
    d.sortDataParsers = { parseInt: function(t) { return parseInt(t, 10) }, parseFloat: function(t) { return parseFloat(t) } }, l._sort = function() {
        if (this.options.sortBy) {
            var t = n.makeArray(this.options.sortBy);
            this._getIsSameSortBy(t) || (this.sortHistory = t.concat(this.sortHistory));
            var e = a(this.sortHistory, this.options.sortAscending);
            this.filteredItems.sort(e)
        }
    }, l._getIsSameSortBy = function(t) {
        for (var e = 0; e < t.length; e++)
            if (t[e] != this.sortHistory[e]) return !1;
        return !0
    }, l._mode = function() {
        var t = this.options.layoutMode,
            e = this.modes[t];
        if (!e) throw new Error("No layout mode: " + t);
        return e.options = this.options[t], e
    }, l._resetLayout = function() { e.prototype._resetLayout.call(this), this._mode()._resetLayout() }, l._getItemLayoutPosition = function(t) { return this._mode()._getItemLayoutPosition(t) }, l._manageStamp = function(t) { this._mode()._manageStamp(t) }, l._getContainerSize = function() { return this._mode()._getContainerSize() }, l.needsResizeLayout = function() { return this._mode().needsResizeLayout() }, l.appended = function(t) {
        var e = this.addItems(t);
        if (e.length) {
            var i = this._filterRevealAdded(e);
            this.filteredItems = this.filteredItems.concat(i)
        }
    }, l.prepended = function(t) {
        var e = this._itemize(t);
        if (e.length) {
            this._resetLayout(), this._manageStamps();
            var i = this._filterRevealAdded(e);
            this.layoutItems(this.filteredItems), this.filteredItems = i.concat(this.filteredItems), this.items = e.concat(this.items)
        }
    }, l._filterRevealAdded = function(t) { var e = this._filter(t); return this.hide(e.needHide), this.reveal(e.matches), this.layoutItems(e.matches, !0), e.matches }, l.insert = function(t) {
        var e = this.addItems(t);
        if (e.length) {
            var i, o, n = e.length;
            for (i = 0; i < n; i++) o = e[i], this.element.appendChild(o.element);
            var s = this._filter(e).matches;
            for (i = 0; i < n; i++) e[i].isLayoutInstant = !0;
            for (this.arrange(), i = 0; i < n; i++) delete e[i].isLayoutInstant;
            this.reveal(s)
        }
    };
    var c = l.remove;
    return l.remove = function(t) {
        t = n.makeArray(t);
        var e = this.getItems(t);
        c.call(this, t);
        for (var i = e && e.length, o = 0; i && o < i; o++) {
            var s = e[o];
            n.removeFrom(this.filteredItems, s)
        }
    }, l.shuffle = function() {
        for (var t = 0; t < this.items.length; t++) {
            var e = this.items[t];
            e.sortData.random = Math.random()
        }
        this.options.sortBy = "random", this._sort(), this._layout()
    }, l._noTransition = function(t, e) {
        var i = this.options.transitionDuration;
        this.options.transitionDuration = 0;
        var o = t.apply(this, e);
        return this.options.transitionDuration = i, o
    }, l.getFilteredItemElements = function() { return this.filteredItems.map(function(t) { return t.element }) }, d
});

/* instafeed.js | v2.0.0-rc2 | https://github.com/stevenschobert/instafeed.js | License: MIT */
! function exportInstafeed(e, t) { "function" == typeof define && define.amd ? define([], t) : "object" == typeof exports && "string" != typeof exports.nodeName ? module.exports = t() : e.Instafeed = t() }(this, function defineInstafeed() {
    function n(e, t) { if (!e) throw new Error(t) }

    function e(e) {
        n(!e || "object" == typeof e, "options must be an object, got " + e + " (" + typeof e + ")");
        var t = { accessToken: null, accessTokenTimeout: 1e4, after: null, apiTimeout: 1e4, before: null, debug: !1, error: null, filter: null, limit: null, mock: !1, render: null, sort: null, success: null, target: "instafeed", template: '<a href="{{link}}"><img title="{{caption}}" src="{{image}}" /></a>', templateBoundaries: ["{{", "}}"], transform: null };
        if (e)
            for (var o in t) "undefined" != typeof e[o] && (t[o] = e[o]);
        n("string" == typeof t.target || "object" == typeof t.target, "target must be a string or DOM node, got " + t.target + " (" + typeof t.target + ")"), n("string" == typeof t.accessToken || "function" == typeof t.accessToken, "accessToken must be a string or function, got " + t.accessToken + " (" + typeof t.accessToken + ")"), n("number" == typeof t.accessTokenTimeout, "accessTokenTimeout must be a number, got " + t.accessTokenTimeout + " (" + typeof t.accessTokenTimeout + ")"), n("number" == typeof t.apiTimeout, "apiTimeout must be a number, got " + t.apiTimeout + " (" + typeof t.apiTimeout + ")"), n("boolean" == typeof t.debug, "debug must be true or false, got " + t.debug + " (" + typeof t.debug + ")"), n("boolean" == typeof t.mock, "mock must be true or false, got " + t.mock + " (" + typeof t.mock + ")"), n("object" == typeof t.templateBoundaries && 2 === t.templateBoundaries.length && "string" == typeof t.templateBoundaries[0] && "string" == typeof t.templateBoundaries[1], "templateBoundaries must be an array of 2 strings, got " + t.templateBoundaries + " (" + typeof t.templateBoundaries + ")"), n(!t.template || "string" == typeof t.template, "template must null or string, got " + t.template + " (" + typeof t.template + ")"), n(!t.error || "function" == typeof t.error, "error must be null or function, got " + t.error + " (" + typeof t.error + ")"), n(!t.before || "function" == typeof t.before, "before must be null or function, got " + t.before + " (" + typeof t.before + ")"), n(!t.after || "function" == typeof t.after, "after must be null or function, got " + t.after + " (" + typeof t.after + ")"), n(!t.success || "function" == typeof t.success, "success must be null or function, got " + t.success + " (" + typeof t.success + ")"), n(!t.filter || "function" == typeof t.filter, "filter must be null or function, got " + t.filter + " (" + typeof t.filter + ")"), n(!t.transform || "function" == typeof t.transform, "transform must be null or function, got " + t.transform + " (" + typeof t.transform + ")"), n(!t.sort || "function" == typeof t.sort, "sort must be null or function, got " + t.sort + " (" + typeof t.sort + ")"), n(!t.render || "function" == typeof t.render, "render must be null or function, got " + t.render + " (" + typeof t.render + ")"), n(!t.limit || "number" == typeof t.limit, "limit must be null or number, got " + t.limit + " (" + typeof t.limit + ")"), this._state = { running: !1 }, this._options = t
    }
    return e.prototype.run = function() {
        var r = this,
            s = null,
            o = null,
            i = null,
            a = null;
        return this._debug("run", "options", this._options), this._debug("run", "state", this._state), this._state.running ? (this._debug("run", "already running, skipping"), !1) : (this._start(), this._debug("run", "getting dom node"), (s = "string" == typeof this._options.target ? document.getElementById(this._options.target) : this._options.target) ? (this._debug("run", "got dom node", s), this._debug("run", "getting access token"), this._getAccessToken(function(e, t) {
            if (e) return r._debug("onTokenReceived", "error", e), void r._fail(new Error("error getting access token: " + e.message));
            o = "https://graph.instagram.com/me/media?fields=caption,id,media_type,media_url,permalink,thumbnail_url,timestamp,username&access_token=" + t, r._debug("onTokenReceived", "request url", o), r._makeApiRequest(o, function(e, t) {
                if (e) return r._debug("onResponseReceived", "error", e), void r._fail(new Error("api request error: " + e.message));
                r._debug("onResponseReceived", "data", t), r._success(t);
                try { i = r._processData(t), r._debug("onResponseReceived", "processed data", i) } catch (o) { return void r._fail(o) }
                if (r._options.mock) r._debug("onResponseReceived", "mock enabled, skipping render");
                else {
                    try { a = r._renderData(i), r._debug("onResponseReceived", "html content", a) } catch (n) { return void r._fail(n) }
                    s.innerHTML = a
                }
                r._finish()
            })
        }), !0) : (this._fail(new Error("no element found with ID " + this._options.target)), !1))
    }, e.prototype._processData = function(e) {
        var t = "function" == typeof this._options.transform,
            o = "function" == typeof this._options.filter,
            n = "function" == typeof this._options.sort,
            r = "number" == typeof this._options.limit,
            s = [],
            i = null,
            a = null,
            u = null,
            c = null;
        if (this._debug("processData", "hasFilter", o, "hasTransform", t, "hasSort", n, "hasLimit", r), "object" != typeof e || "object" != typeof e.data || e.data.length <= 0) return null;
        for (var l = 0; l < e.data.length; l++) {
            if (a = this._getItemData(e.data[l]), t) try { u = this._options.transform(a), this._debug("processData", "transformed item", a, u) } catch (p) { throw this._debug("processData", "error calling transform", p), new Error("error in transform: " + p.message) } else u = a;
            if (o) {
                try { c = this._options.filter(u), this._debug("processData", "filter item result", u, c) } catch (p) { throw this._debug("processData", "error calling filter", p), new Error("error in filter: " + p.message) }
                c && s.push(u)
            } else s.push(u)
        }
        if (n) try { s.sort(this._options.sort) } catch (p) { throw this._debug("processData", "error calling sort", p), new Error("error in sort: " + p.message) }
        return r && (i = s.length - this._options.limit, this._debug("processData", "checking limit", s.length, this._options.limit, i), 0 < i && s.splice(s.length - i, i)), s
    }, e.prototype._extractTags = function(e) {
        var t = /#([^\s]+)/gi,
            o = /[~`!@#$%^&*\(\)\-\+={}\[\]:;"'<>\?,\./|\\\s]+/i,
            n = [];
        if ("string" == typeof e)
            for (; null !== (match = t.exec(e));) !1 === o.test(match[1]) && n.push(match[1]);
        return n
    }, e.prototype._getItemData = function(e) {
        var t = null,
            o = null;
        switch (e.media_type) {
            case "IMAGE":
                t = "image", o = e.media_url;
                break;
            case "VIDEO":
                t = "video", o = e.thumbnail_url;
                break;
            case "CAROUSEL_ALBUM":
                t = "album", o = e.media_url
        }
        return { caption: e.caption, tags: this._extractTags(e.caption), id: e.id, image: o, link: e.permalink, model: e, timestamp: e.timestamp, type: t, username: e.username }
    }, e.prototype._renderData = function(e) {
        var t = "string" == typeof this._options.template,
            o = "function" == typeof this._options.render,
            n = null,
            r = null,
            s = "";
        if (this._debug("renderData", "hasTemplate", t, "hasRender", o), "object" != typeof e || e.length <= 0) return null;
        for (var i = 0; i < e.length; i++) {
            if (n = e[i], o) try { r = this._options.render(n, this._options), this._debug("renderData", "custom render result", n, r) } catch (a) { throw this._debug("renderData", "error calling render", a), new Error("error in render: " + a.message) } else t && (r = this._basicRender(n));
            r ? s += r : this._debug("renderData", "render item did not return any content", n)
        }
        return s
    }, e.prototype._basicRender = function(e) { for (var t = new RegExp(this._options.templateBoundaries[0] + "([\\s\\w.]+)" + this._options.templateBoundaries[1], "gm"), o = this._options.template, n = null, r = "", s = 0, i = null, a = null; null !== (n = t.exec(o));) i = n[1], r += o.slice(s, n.index), (a = this._valueForKeyPath(i, e)) && (r += a.toString()), s = t.lastIndex; return s < o.length && (r += o.slice(s, o.length)), r }, e.prototype._valueForKeyPath = function(e, t) {
        for (var o = /([\w]+)/gm, n = null, r = t; null !== (n = o.exec(e));) {
            if ("object" != typeof r) return null;
            r = r[n[1]]
        }
        return r
    }, e.prototype._fail = function(e) {!this._runHook("error", e) && console && "function" == typeof console.error && console.error(e), this._state.running = !1 }, e.prototype._start = function() { this._state.running = !0, this._runHook("before") }, e.prototype._finish = function() { this._runHook("after"), this._state.running = !1 }, e.prototype._success = function(e) { this._runHook("success", e), this._state.running = !1 }, e.prototype._makeApiRequest = function(e, o) {
        var n = !1,
            r = this,
            s = null,
            i = function i(e, t) { n || (n = !0, o(e, t)) };
        (s = new XMLHttpRequest).ontimeout = function(e) { i(new Error("api request timed out")) }, s.onerror = function(e) { i(new Error("api connection error")) }, s.onload = function(e) {
            var t = s.getResponseHeader("Content-Type"),
                o = null;
            if (r._debug("apiRequestOnLoad", "loaded", e), r._debug("apiRequestOnLoad", "response status", s.status), r._debug("apiRequestOnLoad", "response content type", t), 0 <= t.indexOf("application/json")) try { o = JSON.parse(s.responseText) } catch (n) { return r._debug("apiRequestOnLoad", "json parsing error", n, s.responseText), void i(new Error("error parsing response json")) }
            200 === s.status ? i(null, o) : o && o.error ? i(new Error(o.error.code + " " + o.error.message)) : i(new Error("status code " + s.status))
        }, s.open("GET", e, !0), s.timeout = this._options.apiTimeout, s.send()
    }, e.prototype._getAccessToken = function(o) {
        var n = !1,
            r = this,
            s = null,
            i = function i(e, t) { n || (n = !0, clearTimeout(s), o(e, t)) };
        if ("function" == typeof this._options.accessToken) { this._debug("getAccessToken", "calling accessToken as function"), s = setTimeout(function() { r._debug("getAccessToken", "timeout check", n), i(new Error("accessToken timed out"), null) }, this._options.accessTokenTimeout); try { this._options.accessToken(function(e, t) { r._debug("getAccessToken", "received accessToken callback", n, e, t), i(e, t) }) } catch (e) { this._debug("getAccessToken", "error invoking the accessToken as function", e), i(e, null) } } else this._debug("getAccessToken", "treating accessToken as static", typeof this._options.accessToken), i(null, this._options.accessToken)
    }, e.prototype._debug = function() {
        var e = null;
        this._options.debug && console && "function" == typeof console.log && ((e = [].slice.call(arguments))[0] = "[Instafeed] [" + e[0] + "]", console.log.apply(null, e))
    }, e.prototype._runHook = function(e, t) {
        var o = !1;
        if ("function" == typeof this._options[e]) try { this._options[e](t), o = !0 } catch (n) { this._debug("runHook", "error calling hook", e, n) }
        return o
    }, e
});
//# sourceMappingURL=instafeed.min.map

//aos scroll
! function(e, t) { "object" == typeof exports && "object" == typeof module ? module.exports = t() : "function" == typeof define && define.amd ? define([], t) : "object" == typeof exports ? exports.AOS = t() : e.AOS = t() }(this, function() {
    return function(e) {
        function t(o) { if (n[o]) return n[o].exports; var i = n[o] = { exports: {}, id: o, loaded: !1 }; return e[o].call(i.exports, i, i.exports, t), i.loaded = !0, i.exports }
        var n = {};
        return t.m = e, t.c = n, t.p = "dist/", t(0)
    }([function(e, t, n) {
        "use strict";

        function o(e) { return e && e.__esModule ? e : { default: e } }
        var i = Object.assign || function(e) { for (var t = 1; t < arguments.length; t++) { var n = arguments[t]; for (var o in n) Object.prototype.hasOwnProperty.call(n, o) && (e[o] = n[o]) } return e },
            r = n(1),
            a = (o(r), n(6)),
            u = o(a),
            c = n(7),
            f = o(c),
            s = n(8),
            d = o(s),
            l = n(9),
            p = o(l),
            m = n(10),
            b = o(m),
            v = n(11),
            y = o(v),
            g = n(14),
            h = o(g),
            w = [],
            k = !1,
            x = document.all && !window.atob,
            j = { offset: 120, delay: 0, easing: "ease", duration: 400, disable: !1, once: !1, startEvent: "DOMContentLoaded", throttleDelay: 99, debounceDelay: 50, disableMutationObserver: !1 },
            O = function() { var e = arguments.length > 0 && void 0 !== arguments[0] && arguments[0]; if (e && (k = !0), k) return w = (0, y.default)(w, j), (0, b.default)(w, j.once), w },
            _ = function() { w = (0, h.default)(), O() },
            S = function() { w.forEach(function(e, t) { e.node.removeAttribute("data-aos"), e.node.removeAttribute("data-aos-easing"), e.node.removeAttribute("data-aos-duration"), e.node.removeAttribute("data-aos-delay") }) },
            z = function(e) { return e === !0 || "mobile" === e && p.default.mobile() || "phone" === e && p.default.phone() || "tablet" === e && p.default.tablet() || "function" == typeof e && e() === !0 },
            A = function(e) {
                return j = i(j, e), w = (0, h.default)(), z(j.disable) || x ? S() : (document.querySelector("body").setAttribute("data-aos-easing", j.easing), document.querySelector("body").setAttribute("data-aos-duration", j.duration), document.querySelector("body").setAttribute("data-aos-delay", j.delay), "DOMContentLoaded" === j.startEvent && ["complete", "interactive"].indexOf(document.readyState) > -1 ? O(!0) : "load" === j.startEvent ? window.addEventListener(j.startEvent, function() { O(!0) }) : document.addEventListener(j.startEvent, function() { O(!0) }), window.addEventListener("resize", (0, f.default)(O, j.debounceDelay, !0)), window.addEventListener("orientationchange", (0, f.default)(O, j.debounceDelay, !0)), window.addEventListener("scroll", (0, u.default)(function() {
                    (0, b.default)(w, j.once)
                }, j.throttleDelay)), j.disableMutationObserver || (0, d.default)("[data-aos]", _), w)
            };
        e.exports = { init: A, refresh: O, refreshHard: _ }
    }, function(e, t) {}, , , , , function(e, t) {
        (function(t) {
            "use strict";

            function n(e, t, n) {
                function o(t) {
                    var n = b,
                        o = v;
                    return b = v = void 0, k = t, g = e.apply(o, n)
                }

                function r(e) { return k = e, h = setTimeout(s, t), _ ? o(e) : g }

                function a(e) {
                    var n = e - w,
                        o = e - k,
                        i = t - n;
                    return S ? j(i, y - o) : i
                }

                function c(e) {
                    var n = e - w,
                        o = e - k;
                    return void 0 === w || n >= t || n < 0 || S && o >= y
                }

                function s() { var e = O(); return c(e) ? d(e) : void(h = setTimeout(s, a(e))) }

                function d(e) { return h = void 0, z && b ? o(e) : (b = v = void 0, g) }

                function l() { void 0 !== h && clearTimeout(h), k = 0, b = w = v = h = void 0 }

                function p() { return void 0 === h ? g : d(O()) }

                function m() {
                    var e = O(),
                        n = c(e);
                    if (b = arguments, v = this, w = e, n) { if (void 0 === h) return r(w); if (S) return h = setTimeout(s, t), o(w) }
                    return void 0 === h && (h = setTimeout(s, t)), g
                }
                var b, v, y, g, h, w, k = 0,
                    _ = !1,
                    S = !1,
                    z = !0;
                if ("function" != typeof e) throw new TypeError(f);
                return t = u(t) || 0, i(n) && (_ = !!n.leading, S = "maxWait" in n, y = S ? x(u(n.maxWait) || 0, t) : y, z = "trailing" in n ? !!n.trailing : z), m.cancel = l, m.flush = p, m
            }

            function o(e, t, o) {
                var r = !0,
                    a = !0;
                if ("function" != typeof e) throw new TypeError(f);
                return i(o) && (r = "leading" in o ? !!o.leading : r, a = "trailing" in o ? !!o.trailing : a), n(e, t, { leading: r, maxWait: t, trailing: a })
            }

            function i(e) { var t = "undefined" == typeof e ? "undefined" : c(e); return !!e && ("object" == t || "function" == t) }

            function r(e) { return !!e && "object" == ("undefined" == typeof e ? "undefined" : c(e)) }

            function a(e) { return "symbol" == ("undefined" == typeof e ? "undefined" : c(e)) || r(e) && k.call(e) == d }

            function u(e) {
                if ("number" == typeof e) return e;
                if (a(e)) return s;
                if (i(e)) {
                    var t = "function" == typeof e.valueOf ? e.valueOf() : e;
                    e = i(t) ? t + "" : t
                }
                if ("string" != typeof e) return 0 === e ? e : +e;
                e = e.replace(l, "");
                var n = m.test(e);
                return n || b.test(e) ? v(e.slice(2), n ? 2 : 8) : p.test(e) ? s : +e
            }
            var c = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) { return typeof e } : function(e) { return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e },
                f = "Expected a function",
                s = NaN,
                d = "[object Symbol]",
                l = /^\s+|\s+$/g,
                p = /^[-+]0x[0-9a-f]+$/i,
                m = /^0b[01]+$/i,
                b = /^0o[0-7]+$/i,
                v = parseInt,
                y = "object" == ("undefined" == typeof t ? "undefined" : c(t)) && t && t.Object === Object && t,
                g = "object" == ("undefined" == typeof self ? "undefined" : c(self)) && self && self.Object === Object && self,
                h = y || g || Function("return this")(),
                w = Object.prototype,
                k = w.toString,
                x = Math.max,
                j = Math.min,
                O = function() { return h.Date.now() };
            e.exports = o
        }).call(t, function() { return this }())
    }, function(e, t) {
        (function(t) {
            "use strict";

            function n(e, t, n) {
                function i(t) {
                    var n = b,
                        o = v;
                    return b = v = void 0, O = t, g = e.apply(o, n)
                }

                function r(e) { return O = e, h = setTimeout(s, t), _ ? i(e) : g }

                function u(e) {
                    var n = e - w,
                        o = e - O,
                        i = t - n;
                    return S ? x(i, y - o) : i
                }

                function f(e) {
                    var n = e - w,
                        o = e - O;
                    return void 0 === w || n >= t || n < 0 || S && o >= y
                }

                function s() { var e = j(); return f(e) ? d(e) : void(h = setTimeout(s, u(e))) }

                function d(e) { return h = void 0, z && b ? i(e) : (b = v = void 0, g) }

                function l() { void 0 !== h && clearTimeout(h), O = 0, b = w = v = h = void 0 }

                function p() { return void 0 === h ? g : d(j()) }

                function m() {
                    var e = j(),
                        n = f(e);
                    if (b = arguments, v = this, w = e, n) { if (void 0 === h) return r(w); if (S) return h = setTimeout(s, t), i(w) }
                    return void 0 === h && (h = setTimeout(s, t)), g
                }
                var b, v, y, g, h, w, O = 0,
                    _ = !1,
                    S = !1,
                    z = !0;
                if ("function" != typeof e) throw new TypeError(c);
                return t = a(t) || 0, o(n) && (_ = !!n.leading, S = "maxWait" in n, y = S ? k(a(n.maxWait) || 0, t) : y, z = "trailing" in n ? !!n.trailing : z), m.cancel = l, m.flush = p, m
            }

            function o(e) { var t = "undefined" == typeof e ? "undefined" : u(e); return !!e && ("object" == t || "function" == t) }

            function i(e) { return !!e && "object" == ("undefined" == typeof e ? "undefined" : u(e)) }

            function r(e) { return "symbol" == ("undefined" == typeof e ? "undefined" : u(e)) || i(e) && w.call(e) == s }

            function a(e) {
                if ("number" == typeof e) return e;
                if (r(e)) return f;
                if (o(e)) {
                    var t = "function" == typeof e.valueOf ? e.valueOf() : e;
                    e = o(t) ? t + "" : t
                }
                if ("string" != typeof e) return 0 === e ? e : +e;
                e = e.replace(d, "");
                var n = p.test(e);
                return n || m.test(e) ? b(e.slice(2), n ? 2 : 8) : l.test(e) ? f : +e
            }
            var u = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) { return typeof e } : function(e) { return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e },
                c = "Expected a function",
                f = NaN,
                s = "[object Symbol]",
                d = /^\s+|\s+$/g,
                l = /^[-+]0x[0-9a-f]+$/i,
                p = /^0b[01]+$/i,
                m = /^0o[0-7]+$/i,
                b = parseInt,
                v = "object" == ("undefined" == typeof t ? "undefined" : u(t)) && t && t.Object === Object && t,
                y = "object" == ("undefined" == typeof self ? "undefined" : u(self)) && self && self.Object === Object && self,
                g = v || y || Function("return this")(),
                h = Object.prototype,
                w = h.toString,
                k = Math.max,
                x = Math.min,
                j = function() { return g.Date.now() };
            e.exports = n
        }).call(t, function() { return this }())
    }, function(e, t) {
        "use strict";

        function n(e, t) {
            var n = new r(o);
            a = t, n.observe(i.documentElement, { childList: !0, subtree: !0, removedNodes: !0 })
        }

        function o(e) {
            e && e.forEach(function(e) {
                var t = Array.prototype.slice.call(e.addedNodes),
                    n = Array.prototype.slice.call(e.removedNodes),
                    o = t.concat(n).filter(function(e) { return e.hasAttribute && e.hasAttribute("data-aos") }).length;
                o && a()
            })
        }
        Object.defineProperty(t, "__esModule", { value: !0 });
        var i = window.document,
            r = window.MutationObserver || window.WebKitMutationObserver || window.MozMutationObserver,
            a = function() {};
        t.default = n
    }, function(e, t) {
        "use strict";

        function n(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") }

        function o() { return navigator.userAgent || navigator.vendor || window.opera || "" }
        Object.defineProperty(t, "__esModule", { value: !0 });
        var i = function() {
                function e(e, t) {
                    for (var n = 0; n < t.length; n++) {
                        var o = t[n];
                        o.enumerable = o.enumerable || !1, o.configurable = !0, "value" in o && (o.writable = !0), Object.defineProperty(e, o.key, o)
                    }
                }
                return function(t, n, o) { return n && e(t.prototype, n), o && e(t, o), t }
            }(),
            r = /(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i,
            a = /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i,
            u = /(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i,
            c = /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i,
            f = function() {
                function e() { n(this, e) }
                return i(e, [{ key: "phone", value: function() { var e = o(); return !(!r.test(e) && !a.test(e.substr(0, 4))) } }, { key: "mobile", value: function() { var e = o(); return !(!u.test(e) && !c.test(e.substr(0, 4))) } }, { key: "tablet", value: function() { return this.mobile() && !this.phone() } }]), e
            }();
        t.default = new f
    }, function(e, t) {
        "use strict";
        Object.defineProperty(t, "__esModule", { value: !0 });
        var n = function(e, t, n) {
                var o = e.node.getAttribute("data-aos-once");
                t > e.position ? e.node.classList.add("aos-animate") : "undefined" != typeof o && ("false" === o || !n && "true" !== o) && e.node.classList.remove("aos-animate")
            },
            o = function(e, t) {
                var o = window.pageYOffset,
                    i = window.innerHeight;
                e.forEach(function(e, r) { n(e, i + o, t) })
            };
        t.default = o
    }, function(e, t, n) {
        "use strict";

        function o(e) { return e && e.__esModule ? e : { default: e } }
        Object.defineProperty(t, "__esModule", { value: !0 });
        var i = n(12),
            r = o(i),
            a = function(e, t) { return e.forEach(function(e, n) { e.node.classList.add("aos-init"), e.position = (0, r.default)(e.node, t.offset) }), e };
        t.default = a
    }, function(e, t, n) {
        "use strict";

        function o(e) { return e && e.__esModule ? e : { default: e } }
        Object.defineProperty(t, "__esModule", { value: !0 });
        var i = n(13),
            r = o(i),
            a = function(e, t) {
                var n = 0,
                    o = 0,
                    i = window.innerHeight,
                    a = { offset: e.getAttribute("data-aos-offset"), anchor: e.getAttribute("data-aos-anchor"), anchorPlacement: e.getAttribute("data-aos-anchor-placement") };
                switch (a.offset && !isNaN(a.offset) && (o = parseInt(a.offset)), a.anchor && document.querySelectorAll(a.anchor) && (e = document.querySelectorAll(a.anchor)[0]), n = (0, r.default)(e).top, a.anchorPlacement) {
                    case "top-bottom":
                        break;
                    case "center-bottom":
                        n += e.offsetHeight / 2;
                        break;
                    case "bottom-bottom":
                        n += e.offsetHeight;
                        break;
                    case "top-center":
                        n += i / 2;
                        break;
                    case "bottom-center":
                        n += i / 2 + e.offsetHeight;
                        break;
                    case "center-center":
                        n += i / 2 + e.offsetHeight / 2;
                        break;
                    case "top-top":
                        n += i;
                        break;
                    case "bottom-top":
                        n += e.offsetHeight + i;
                        break;
                    case "center-top":
                        n += e.offsetHeight / 2 + i
                }
                return a.anchorPlacement || a.offset || isNaN(t) || (o = t), n + o
            };
        t.default = a
    }, function(e, t) {
        "use strict";
        Object.defineProperty(t, "__esModule", { value: !0 });
        var n = function(e) { for (var t = 0, n = 0; e && !isNaN(e.offsetLeft) && !isNaN(e.offsetTop);) t += e.offsetLeft - ("BODY" != e.tagName ? e.scrollLeft : 0), n += e.offsetTop - ("BODY" != e.tagName ? e.scrollTop : 0), e = e.offsetParent; return { top: n, left: t } };
        t.default = n
    }, function(e, t) {
        "use strict";
        Object.defineProperty(t, "__esModule", { value: !0 });
        var n = function(e) { return e = e || document.querySelectorAll("[data-aos]"), Array.prototype.map.call(e, function(e) { return { node: e } }) };
        t.default = n
    }])
});

/*!
 * simpleParallax.min - simpleParallax is a simple JavaScript library that gives your website parallax animations on any images, 
 * @date: 01-02-2020 23:1:26, 
 * @version: 5.3.0,
 * @link: https://simpleparallax.com/
 */
! function(t, e) { "object" == typeof exports && "object" == typeof module ? module.exports = e() : "function" == typeof define && define.amd ? define("simpleParallax", [], e) : "object" == typeof exports ? exports.simpleParallax = e() : t.simpleParallax = e() }(window, (function() {
    return function(t) {
        var e = {};

        function n(i) { if (e[i]) return e[i].exports; var s = e[i] = { i: i, l: !1, exports: {} }; return t[i].call(s.exports, s, s.exports, n), s.l = !0, s.exports }
        return n.m = t, n.c = e, n.d = function(t, e, i) { n.o(t, e) || Object.defineProperty(t, e, { enumerable: !0, get: i }) }, n.r = function(t) { "undefined" != typeof Symbol && Symbol.toStringTag && Object.defineProperty(t, Symbol.toStringTag, { value: "Module" }), Object.defineProperty(t, "__esModule", { value: !0 }) }, n.t = function(t, e) {
            if (1 & e && (t = n(t)), 8 & e) return t;
            if (4 & e && "object" == typeof t && t && t.__esModule) return t;
            var i = Object.create(null);
            if (n.r(i), Object.defineProperty(i, "default", { enumerable: !0, value: t }), 2 & e && "string" != typeof t)
                for (var s in t) n.d(i, s, function(e) { return t[e] }.bind(null, s));
            return i
        }, n.n = function(t) { var e = t && t.__esModule ? function() { return t.default } : function() { return t }; return n.d(e, "a", e), e }, n.o = function(t, e) { return Object.prototype.hasOwnProperty.call(t, e) }, n.p = "", n(n.s = 0)
    }([function(t, e, n) {
        "use strict";

        function i(t, e) {
            for (var n = 0; n < e.length; n++) {
                var i = e[n];
                i.enumerable = i.enumerable || !1, i.configurable = !0, "value" in i && (i.writable = !0), Object.defineProperty(t, i.key, i)
            }
        }
        n.r(e);
        var s = new(function() {
                function t() {! function(t, e) { if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function") }(this, t), this.positions = { top: 0, bottom: 0, height: 0 } }
                var e, n, s;
                return e = t, (n = [{ key: "setViewportTop", value: function(t) { return this.positions.top = t ? t.scrollTop : window.pageYOffset, this.positions } }, { key: "setViewportBottom", value: function() { return this.positions.bottom = this.positions.top + this.positions.height, this.positions } }, { key: "setViewportAll", value: function(t) { return this.positions.top = t ? t.scrollTop : window.pageYOffset, this.positions.height = t ? t.clientHeight : document.documentElement.clientHeight, this.positions.bottom = this.positions.top + this.positions.height, this.positions } }]) && i(e.prototype, n), s && i(e, s), t
            }()),
            o = function(t) { return NodeList.prototype.isPrototypeOf(t) || HTMLCollection.prototype.isPrototypeOf(t) ? Array.from(t) : "string" == typeof t || t instanceof String ? document.querySelectorAll(t) : [t] },
            r = function() { for (var t, e = "transform webkitTransform mozTransform oTransform msTransform".split(" "), n = 0; void 0 === t;) t = void 0 !== document.createElement("div").style[e[n]] ? e[n] : void 0, n += 1; return t }(),
            a = function(t) { return !!t && (!!t.complete && (void 0 === t.naturalWidth || 0 !== t.naturalWidth)) };

        function l(t) { return function(t) { if (Array.isArray(t)) { for (var e = 0, n = new Array(t.length); e < t.length; e++) n[e] = t[e]; return n } }(t) || function(t) { if (Symbol.iterator in Object(t) || "[object Arguments]" === Object.prototype.toString.call(t)) return Array.from(t) }(t) || function() { throw new TypeError("Invalid attempt to spread non-iterable instance") }() }

        function u(t, e) {
            for (var n = 0; n < e.length; n++) {
                var i = e[n];
                i.enumerable = i.enumerable || !1, i.configurable = !0, "value" in i && (i.writable = !0), Object.defineProperty(t, i.key, i)
            }
        }
        var h = function() {
            function t(e, n) {! function(t, e) { if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function") }(this, t), this.element = e, this.elementContainer = e, this.settings = n, this.isVisible = !0, this.isInit = !1, this.oldTranslateValue = -1, this.init = this.init.bind(this), a(e) ? this.init() : this.element.addEventListener("load", this.init) }
            var e, n, i;
            return e = t, (n = [{
                key: "init",
                value: function() {
                    var t = this;
                    this.isInit || this.element.closest(".simpleParallax") || (!1 === this.settings.overflow && this.wrapElement(this.element), this.setTransformCSS(), this.getElementOffset(), this.intersectionObserver(), this.getTranslateValue(), this.animate(), this.settings.delay > 0 && setTimeout((function() { t.setTransitionCSS() }), 10), this.isInit = !0)
                }
            }, {
                key: "wrapElement",
                value: function() {
                    var t = this.element.closest("picture") || this.element,
                        e = document.createElement("div");
                    e.classList.add("simpleParallax"), e.style.overflow = "hidden", t.parentNode.insertBefore(e, t), e.appendChild(t), this.elementContainer = e
                }
            }, {
                key: "unWrapElement",
                value: function() {
                    var t = this.elementContainer;
                    t.replaceWith.apply(t, l(t.childNodes))
                }
            }, { key: "setTransformCSS", value: function() {!1 === this.settings.overflow && (this.element.style[r] = "scale(".concat(this.settings.scale, ")")), this.element.style.willChange = "transform" } }, { key: "setTransitionCSS", value: function() { this.element.style.transition = "transform ".concat(this.settings.delay, "s ").concat(this.settings.transition) } }, { key: "unSetStyle", value: function() { this.element.style.willChange = "", this.element.style[r] = "", this.element.style.transition = "" } }, {
                key: "getElementOffset",
                value: function() {
                    var t = this.elementContainer.getBoundingClientRect();
                    if (this.elementHeight = t.height, this.elementTop = t.top + s.positions.top, this.settings.customContainer) {
                        var e = this.settings.customContainer.getBoundingClientRect();
                        this.elementTop = t.top - e.top + s.positions.top
                    }
                    this.elementBottom = this.elementHeight + this.elementTop
                }
            }, {
                key: "buildThresholdList",
                value: function() {
                    for (var t = [], e = 1; e <= this.elementHeight; e++) {
                        var n = e / this.elementHeight;
                        t.push(n)
                    }
                    return t
                }
            }, {
                key: "intersectionObserver",
                value: function() {
                    var t = { root: null, threshold: this.buildThresholdList() };
                    this.observer = new IntersectionObserver(this.intersectionObserverCallback.bind(this), t), this.observer.observe(this.element)
                }
            }, { key: "intersectionObserverCallback", value: function(t) { for (var e = t.length - 1; e >= 0; e--) t[e].isIntersecting ? this.isVisible = !0 : this.isVisible = !1 } }, { key: "checkIfVisible", value: function() { return this.elementBottom > s.positions.top && this.elementTop < s.positions.bottom } }, {
                key: "getRangeMax",
                value: function() {
                    var t = this.element.clientHeight;
                    this.rangeMax = t * this.settings.scale - t
                }
            }, { key: "getTranslateValue", value: function() { var t = ((s.positions.bottom - this.elementTop) / ((s.positions.height + this.elementHeight) / 100)).toFixed(1); return t = Math.min(100, Math.max(0, t)), 0 !== this.settings.maxTransition && t > this.settings.maxTransition && (t = this.settings.maxTransition), this.oldPercentage !== t && (this.rangeMax || this.getRangeMax(), this.translateValue = (t / 100 * this.rangeMax - this.rangeMax / 2).toFixed(0), this.oldTranslateValue !== this.translateValue && (this.oldPercentage = t, this.oldTranslateValue = this.translateValue, !0)) } }, {
                key: "animate",
                value: function() {
                    var t, e = 0,
                        n = 0;
                    (this.settings.orientation.includes("left") || this.settings.orientation.includes("right")) && (n = "".concat(this.settings.orientation.includes("left") ? -1 * this.translateValue : this.translateValue, "px")), (this.settings.orientation.includes("up") || this.settings.orientation.includes("down")) && (e = "".concat(this.settings.orientation.includes("up") ? -1 * this.translateValue : this.translateValue, "px")), t = !1 === this.settings.overflow ? "translate3d(".concat(n, ", ").concat(e, ", 0) scale(").concat(this.settings.scale, ")") : "translate3d(".concat(n, ", ").concat(e, ", 0)"), this.element.style[r] = t
                }
            }]) && u(e.prototype, n), i && u(e, i), t
        }();

        function c(t) { return function(t) { if (Array.isArray(t)) { for (var e = 0, n = new Array(t.length); e < t.length; e++) n[e] = t[e]; return n } }(t) || function(t) { if (Symbol.iterator in Object(t) || "[object Arguments]" === Object.prototype.toString.call(t)) return Array.from(t) }(t) || function() { throw new TypeError("Invalid attempt to spread non-iterable instance") }() }

        function f(t, e) {
            for (var n = 0; n < e.length; n++) {
                var i = e[n];
                i.enumerable = i.enumerable || !1, i.configurable = !0, "value" in i && (i.writable = !0), Object.defineProperty(t, i.key, i)
            }
        }
        n.d(e, "default", (function() { return b }));
        var m, p, d, g = !0,
            v = !1,
            y = [],
            b = function() {
                function t(e, n) {! function(t, e) { if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function") }(this, t), e && (this.elements = o(e), this.defaults = { delay: .4, orientation: "up", scale: 1.3, overflow: !1, transition: "cubic-bezier(0,0,0,1)", customContainer: !1, maxTransition: 0 }, this.settings = Object.assign(this.defaults, n), "IntersectionObserver" in window || (g = !1), this.settings.customContainer && (console.log(o(this.settings.customContainer)[0]), this.customContainer = o(this.settings.customContainer)[0]), this.lastPosition = -1, this.resizeIsDone = this.resizeIsDone.bind(this), this.handleResize = this.handleResize.bind(this), this.proceedRequestAnimationFrame = this.proceedRequestAnimationFrame.bind(this), this.init()) }
                var e, n, i;
                return e = t, (n = [{
                    key: "init",
                    value: function() {
                        var t = this;
                        s.setViewportAll(this.customContainer), y = [].concat(c(this.elements.map((function(e) { return new h(e, t.settings) }))), c(y)), m = y.length, v || (this.proceedRequestAnimationFrame(), window.addEventListener("resize", this.resizeIsDone), v = !0)
                    }
                }, { key: "resizeIsDone", value: function() { clearTimeout(d), d = setTimeout(this.handleResize, 500) } }, {
                    key: "handleResize",
                    value: function() {
                        s.setViewportAll(this.customContainer);
                        for (var t = m - 1; t >= 0; t--) y[t].getElementOffset(), y[t].getRangeMax();
                        this.lastPosition = -1
                    }
                }, {
                    key: "proceedRequestAnimationFrame",
                    value: function() {
                        if (s.setViewportTop(this.customContainer), this.lastPosition !== s.positions.top) {
                            s.setViewportBottom();
                            for (var t = m - 1; t >= 0; t--) this.proceedElement(y[t]);
                            p = window.requestAnimationFrame(this.proceedRequestAnimationFrame), this.lastPosition = s.positions.top
                        } else p = window.requestAnimationFrame(this.proceedRequestAnimationFrame)
                    }
                }, {
                    key: "proceedElement",
                    value: function(t) {
                        (!g || this.customContainer ? t.checkIfVisible() : t.isVisible) && t.getTranslateValue() && t.animate()
                    }
                }, {
                    key: "destroy",
                    value: function() {
                        var t = this,
                            e = [];
                        y = y.filter((function(n) { return t.elements.includes(n.element) ? (e.push(n), !1) : n }));
                        for (var n = e.length - 1; n >= 0; n--) e[n].unSetStyle(), !1 === this.settings.overflow && e[n].unWrapElement();
                        (m = y.length) || (window.cancelAnimationFrame(p), window.removeEventListener("resize", this.handleResize))
                    }
                }]) && f(e.prototype, n), i && f(e, i), t
            }()
    }]).default
}));

//jGrowl - https://github.com/ksylvest/jquery-growl
var _createClass = function() {
    function t(t, i) {
        for (var e = 0; e < i.length; e++) {
            var s = i[e];
            s.enumerable = s.enumerable || !1, s.configurable = !0, "value" in s && (s.writable = !0), Object.defineProperty(t, s.key, s)
        }
    }
    return function(i, e, s) { return e && t(i.prototype, e), s && t(i, s), i }
}();

function _classCallCheck(t, i) { if (!(t instanceof i)) throw new TypeError("Cannot call a class as a function") }(function() {
    "use strict";
    var t, i, e;
    t = jQuery, i = function() {
        var t = function() {
            function t() { _classCallCheck(this, t) }
            return _createClass(t, null, [{
                key: "transition",
                value: function(t) {
                    var i, e, s, n;
                    for (n in i = t[0], e = this.transitions)
                        if (s = e[n], null != i.style[n]) return s
                }
            }]), t
        }();
        return t.transitions = { webkitTransition: "webkitTransitionEnd", mozTransition: "mozTransitionEnd", oTransition: "oTransitionEnd", transition: "transitionend" }, t
    }(), e = function() {
        var e = function() {
            function e() {
                var i = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {};
                _classCallCheck(this, e), this.render = this.render.bind(this), this.bind = this.bind.bind(this), this.unbind = this.unbind.bind(this), this.mouseEnter = this.mouseEnter.bind(this), this.mouseLeave = this.mouseLeave.bind(this), this.click = this.click.bind(this), this.close = this.close.bind(this), this.cycle = this.cycle.bind(this), this.waitAndDismiss = this.waitAndDismiss.bind(this), this.present = this.present.bind(this), this.dismiss = this.dismiss.bind(this), this.remove = this.remove.bind(this), this.animate = this.animate.bind(this), this.$growls = this.$growls.bind(this), this.$growl = this.$growl.bind(this), this.html = this.html.bind(this), this.content = this.content.bind(this), this.container = this.container.bind(this), this.settings = t.extend({}, e.settings, i), this.initialize(this.settings.location), this.render()
            }
            return _createClass(e, null, [{ key: "growl", value: function() { return new e(arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {}) } }]), _createClass(e, [{ key: "initialize", value: function(i) { var e; return t("body:not(:has(#" + (e = "growls-" + i) + "))").append('<div id="' + e + '" />') } }, {
                key: "render",
                value: function() {
                    var t;
                    t = this.$growl(), this.$growls(this.settings.location).append(t), this.settings.fixed ? this.present() : this.cycle()
                }
            }, { key: "bind", value: function() { var t = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : this.$growl(); return t.on("click", this.click), this.settings.delayOnHover && (t.on("mouseenter", this.mouseEnter), t.on("mouseleave", this.mouseLeave)), t.on("contextmenu", this.close).find("." + this.settings.namespace + "-close").on("click", this.close) } }, { key: "unbind", value: function() { var t = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : this.$growl(); return t.off("click", this.click), this.settings.delayOnHover && (t.off("mouseenter", this.mouseEnter), t.off("mouseleave", this.mouseLeave)), t.off("contextmenu", this.close).find("." + this.settings.namespace + "-close").off("click", this.close) } }, { key: "mouseEnter", value: function(t) { return this.$growl().stop(!0, !0) } }, { key: "mouseLeave", value: function(t) { return this.waitAndDismiss() } }, { key: "click", value: function(t) { if (null != this.settings.url) return t.preventDefault(), t.stopPropagation(), window.open(this.settings.url) } }, { key: "close", value: function(t) { return t.preventDefault(), t.stopPropagation(), this.$growl().stop().queue(this.dismiss).queue(this.remove) } }, { key: "cycle", value: function() { return this.$growl().queue(this.present).queue(this.waitAndDismiss()) } }, { key: "waitAndDismiss", value: function() { return this.$growl().delay(this.settings.duration).queue(this.dismiss).queue(this.remove) } }, { key: "present", value: function(t) { var i; return i = this.$growl(), this.bind(i), this.animate(i, this.settings.namespace + "-incoming", "out", t) } }, { key: "dismiss", value: function(t) { var i; return i = this.$growl(), this.unbind(i), this.animate(i, this.settings.namespace + "-outgoing", "in", t) } }, { key: "remove", value: function(t) { return this.$growl().remove(), "function" == typeof t ? t() : void 0 } }, {
                key: "animate",
                value: function(t, e) {
                    var s, n = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : "in",
                        o = arguments[3];
                    s = i.transition(t), t["in" === n ? "removeClass" : "addClass"](e), t.offset().position, t["in" === n ? "addClass" : "removeClass"](e), null != o && (null != s ? t.one(s, o) : o())
                }
            }, { key: "$growls", value: function(i) { var e; return null == this.$_growls && (this.$_growls = []), null != (e = this.$_growls)[i] ? e[i] : e[i] = t("#growls-" + i) } }, { key: "$growl", value: function() { return null != this.$_growl ? this.$_growl : this.$_growl = t(this.html()) } }, { key: "html", value: function() { return this.container(this.content()) } }, { key: "content", value: function() { return "<div class='" + this.settings.namespace + "-close'>" + this.settings.close + "</div>\n<div class='" + this.settings.namespace + "-title'>" + this.settings.title + "</div>\n<div class='" + this.settings.namespace + "-message'>" + this.settings.message + "</div>" } }, { key: "container", value: function(t) { return "<div class='" + this.settings.namespace + " " + this.settings.namespace + "-" + this.settings.style + " " + this.settings.namespace + "-" + this.settings.size + "'>\n  " + t + "\n</div>" } }]), e
        }();
        return e.settings = { namespace: "growl", duration: 3200, close: "&#215;", location: "default", style: "default", size: "medium", delayOnHover: !0 }, e
    }(), this.Growl = e, t.growl = function() { var t = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {}; return e.growl(t) }, t.growl.error = function() { var i, e = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {}; return i = { title: "Error!", style: "error" }, t.growl(t.extend(i, e)) }, t.growl.notice = function() { var i, e = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {}; return i = { title: "Notice!", style: "notice" }, t.growl(t.extend(i, e)) }, t.growl.warning = function() { var i, e = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {}; return i = { title: "Warning!", style: "warning" }, t.growl(t.extend(i, e)) }
}).call(this);


/*! PhotoSwipe - v4.1.3 - 2019-01-08
 * http://photoswipe.com
 * Copyright (c) 2019 Dmitry Semenov; */
! function(a, b) { "function" == typeof define && define.amd ? define(b) : "object" == typeof exports ? module.exports = b() : a.PhotoSwipe = b() }(this, function() {
    "use strict";
    var a = function(a, b, c, d) {
        var e = {
            features: null,
            bind: function(a, b, c, d) {
                var e = (d ? "remove" : "add") + "EventListener";
                b = b.split(" ");
                for (var f = 0; f < b.length; f++) b[f] && a[e](b[f], c, !1)
            },
            isArray: function(a) { return a instanceof Array },
            createEl: function(a, b) { var c = document.createElement(b || "div"); return a && (c.className = a), c },
            getScrollY: function() { var a = window.pageYOffset; return void 0 !== a ? a : document.documentElement.scrollTop },
            unbind: function(a, b, c) { e.bind(a, b, c, !0) },
            removeClass: function(a, b) {
                var c = new RegExp("(\\s|^)" + b + "(\\s|$)");
                a.className = a.className.replace(c, " ").replace(/^\s\s*/, "").replace(/\s\s*$/, "")
            },
            addClass: function(a, b) { e.hasClass(a, b) || (a.className += (a.className ? " " : "") + b) },
            hasClass: function(a, b) { return a.className && new RegExp("(^|\\s)" + b + "(\\s|$)").test(a.className) },
            getChildByClass: function(a, b) {
                for (var c = a.firstChild; c;) {
                    if (e.hasClass(c, b)) return c;
                    c = c.nextSibling
                }
            },
            arraySearch: function(a, b, c) {
                for (var d = a.length; d--;)
                    if (a[d][c] === b) return d;
                return -1
            },
            extend: function(a, b, c) {
                for (var d in b)
                    if (b.hasOwnProperty(d)) {
                        if (c && a.hasOwnProperty(d)) continue;
                        a[d] = b[d]
                    }
            },
            easing: { sine: { out: function(a) { return Math.sin(a * (Math.PI / 2)) }, inOut: function(a) { return -(Math.cos(Math.PI * a) - 1) / 2 } }, cubic: { out: function(a) { return --a * a * a + 1 } } },
            detectFeatures: function() {
                if (e.features) return e.features;
                var a = e.createEl(),
                    b = a.style,
                    c = "",
                    d = {};
                if (d.oldIE = document.all && !document.addEventListener, d.touch = "ontouchstart" in window, window.requestAnimationFrame && (d.raf = window.requestAnimationFrame, d.caf = window.cancelAnimationFrame), d.pointerEvent = !!window.PointerEvent || navigator.msPointerEnabled, !d.pointerEvent) {
                    var f = navigator.userAgent;
                    if (/iP(hone|od)/.test(navigator.platform)) {
                        var g = navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/);
                        g && g.length > 0 && (g = parseInt(g[1], 10), g >= 1 && g < 8 && (d.isOldIOSPhone = !0))
                    }
                    var h = f.match(/Android\s([0-9\.]*)/),
                        i = h ? h[1] : 0;
                    i = parseFloat(i), i >= 1 && (i < 4.4 && (d.isOldAndroid = !0), d.androidVersion = i), d.isMobileOpera = /opera mini|opera mobi/i.test(f)
                }
                for (var j, k, l = ["transform", "perspective", "animationName"], m = ["", "webkit", "Moz", "ms", "O"], n = 0; n < 4; n++) {
                    c = m[n];
                    for (var o = 0; o < 3; o++) j = l[o], k = c + (c ? j.charAt(0).toUpperCase() + j.slice(1) : j), !d[j] && k in b && (d[j] = k);
                    c && !d.raf && (c = c.toLowerCase(), d.raf = window[c + "RequestAnimationFrame"], d.raf && (d.caf = window[c + "CancelAnimationFrame"] || window[c + "CancelRequestAnimationFrame"]))
                }
                if (!d.raf) {
                    var p = 0;
                    d.raf = function(a) {
                        var b = (new Date).getTime(),
                            c = Math.max(0, 16 - (b - p)),
                            d = window.setTimeout(function() { a(b + c) }, c);
                        return p = b + c, d
                    }, d.caf = function(a) { clearTimeout(a) }
                }
                return d.svg = !!document.createElementNS && !!document.createElementNS("http://www.w3.org/2000/svg", "svg").createSVGRect, e.features = d, d
            }
        };
        e.detectFeatures(), e.features.oldIE && (e.bind = function(a, b, c, d) {
            b = b.split(" ");
            for (var e, f = (d ? "detach" : "attach") + "Event", g = function() { c.handleEvent.call(c) }, h = 0; h < b.length; h++)
                if (e = b[h])
                    if ("object" == typeof c && c.handleEvent) {
                        if (d) { if (!c["oldIE" + e]) return !1 } else c["oldIE" + e] = g;
                        a[f]("on" + e, c["oldIE" + e])
                    } else a[f]("on" + e, c)
        });
        var f = this,
            g = 25,
            h = 3,
            i = { allowPanToNext: !0, spacing: .12, bgOpacity: 1, mouseUsed: !1, loop: !0, pinchToClose: !0, closeOnScroll: !0, closeOnVerticalDrag: !0, verticalDragRange: .75, hideAnimationDuration: 333, showAnimationDuration: 333, showHideOpacity: !1, focus: !0, escKey: !0, arrowKeys: !0, mainScrollEndFriction: .35, panEndFriction: .35, isClickableElement: function(a) { return "A" === a.tagName }, getDoubleTapZoom: function(a, b) { return a ? 1 : b.initialZoomLevel < .7 ? 1 : 1.33 }, maxSpreadZoom: 1.33, modal: !0, scaleMode: "fit" };
        e.extend(i, d);
        var j, k, l, m, n, o, p, q, r, s, t, u, v, w, x, y, z, A, B, C, D, E, F, G, H, I, J, K, L, M, N, O, P, Q, R, S, T, U, V, W, X, Y, Z, $, _, aa, ba, ca, da, ea, fa, ga, ha, ia, ja, ka, la, ma = function() { return { x: 0, y: 0 } },
            na = ma(),
            oa = ma(),
            pa = ma(),
            qa = {},
            ra = 0,
            sa = {},
            ta = ma(),
            ua = 0,
            va = !0,
            wa = [],
            xa = {},
            ya = !1,
            za = function(a, b) { e.extend(f, b.publicMethods), wa.push(a) },
            Aa = function(a) { var b = ac(); return a > b - 1 ? a - b : a < 0 ? b + a : a },
            Ba = {},
            Ca = function(a, b) { return Ba[a] || (Ba[a] = []), Ba[a].push(b) },
            Da = function(a) {
                var b = Ba[a];
                if (b) {
                    var c = Array.prototype.slice.call(arguments);
                    c.shift();
                    for (var d = 0; d < b.length; d++) b[d].apply(f, c)
                }
            },
            Ea = function() { return (new Date).getTime() },
            Fa = function(a) { ja = a, f.bg.style.opacity = a * i.bgOpacity },
            Ga = function(a, b, c, d, e) {
                (!ya || e && e !== f.currItem) && (d /= e ? e.fitRatio : f.currItem.fitRatio), a[E] = u + b + "px, " + c + "px" + v + " scale(" + d + ")"
            },
            Ha = function(a) { ea && (a && (s > f.currItem.fitRatio ? ya || (mc(f.currItem, !1, !0), ya = !0) : ya && (mc(f.currItem), ya = !1)), Ga(ea, pa.x, pa.y, s)) },
            Ia = function(a) { a.container && Ga(a.container.style, a.initialPosition.x, a.initialPosition.y, a.initialZoomLevel, a) },
            Ja = function(a, b) { b[E] = u + a + "px, 0px" + v },
            Ka = function(a, b) {
                if (!i.loop && b) {
                    var c = m + (ta.x * ra - a) / ta.x,
                        d = Math.round(a - tb.x);
                    (c < 0 && d > 0 || c >= ac() - 1 && d < 0) && (a = tb.x + d * i.mainScrollEndFriction)
                }
                tb.x = a, Ja(a, n)
            },
            La = function(a, b) { var c = ub[a] - sa[a]; return oa[a] + na[a] + c - c * (b / t) },
            Ma = function(a, b) { a.x = b.x, a.y = b.y, b.id && (a.id = b.id) },
            Na = function(a) { a.x = Math.round(a.x), a.y = Math.round(a.y) },
            Oa = null,
            Pa = function() { Oa && (e.unbind(document, "mousemove", Pa), e.addClass(a, "pswp--has_mouse"), i.mouseUsed = !0, Da("mouseUsed")), Oa = setTimeout(function() { Oa = null }, 100) },
            Qa = function() { e.bind(document, "keydown", f), N.transform && e.bind(f.scrollWrap, "click", f), i.mouseUsed || e.bind(document, "mousemove", Pa), e.bind(window, "resize scroll orientationchange", f), Da("bindEvents") },
            Ra = function() { e.unbind(window, "resize scroll orientationchange", f), e.unbind(window, "scroll", r.scroll), e.unbind(document, "keydown", f), e.unbind(document, "mousemove", Pa), N.transform && e.unbind(f.scrollWrap, "click", f), V && e.unbind(window, p, f), clearTimeout(O), Da("unbindEvents") },
            Sa = function(a, b) { var c = ic(f.currItem, qa, a); return b && (da = c), c },
            Ta = function(a) { return a || (a = f.currItem), a.initialZoomLevel },
            Ua = function(a) { return a || (a = f.currItem), a.w > 0 ? i.maxSpreadZoom : 1 },
            Va = function(a, b, c, d) { return d === f.currItem.initialZoomLevel ? (c[a] = f.currItem.initialPosition[a], !0) : (c[a] = La(a, d), c[a] > b.min[a] ? (c[a] = b.min[a], !0) : c[a] < b.max[a] && (c[a] = b.max[a], !0)) },
            Wa = function() {
                if (E) { var b = N.perspective && !G; return u = "translate" + (b ? "3d(" : "("), void(v = N.perspective ? ", 0px)" : ")") }
                E = "left", e.addClass(a, "pswp--ie"), Ja = function(a, b) { b.left = a + "px" }, Ia = function(a) {
                    var b = a.fitRatio > 1 ? 1 : a.fitRatio,
                        c = a.container.style,
                        d = b * a.w,
                        e = b * a.h;
                    c.width = d + "px", c.height = e + "px", c.left = a.initialPosition.x + "px", c.top = a.initialPosition.y + "px"
                }, Ha = function() {
                    if (ea) {
                        var a = ea,
                            b = f.currItem,
                            c = b.fitRatio > 1 ? 1 : b.fitRatio,
                            d = c * b.w,
                            e = c * b.h;
                        a.width = d + "px", a.height = e + "px", a.left = pa.x + "px", a.top = pa.y + "px"
                    }
                }
            },
            Xa = function(a) {
                var b = "";
                i.escKey && 27 === a.keyCode ? b = "close" : i.arrowKeys && (37 === a.keyCode ? b = "prev" : 39 === a.keyCode && (b = "next")), b && (a.ctrlKey || a.altKey || a.shiftKey || a.metaKey || (a.preventDefault ? a.preventDefault() : a.returnValue = !1, f[b]()))
            },
            Ya = function(a) { a && (Y || X || fa || T) && (a.preventDefault(), a.stopPropagation()) },
            Za = function() { f.setScrollOffset(0, e.getScrollY()) },
            $a = {},
            _a = 0,
            ab = function(a) { $a[a] && ($a[a].raf && I($a[a].raf), _a--, delete $a[a]) },
            bb = function(a) { $a[a] && ab(a), $a[a] || (_a++, $a[a] = {}) },
            cb = function() { for (var a in $a) $a.hasOwnProperty(a) && ab(a) },
            db = function(a, b, c, d, e, f, g) {
                var h, i = Ea();
                bb(a);
                var j = function() {
                    if ($a[a]) {
                        if (h = Ea() - i, h >= d) return ab(a), f(c), void(g && g());
                        f((c - b) * e(h / d) + b), $a[a].raf = H(j)
                    }
                };
                j()
            },
            eb = {
                shout: Da,
                listen: Ca,
                viewportSize: qa,
                options: i,
                isMainScrollAnimating: function() { return fa },
                getZoomLevel: function() { return s },
                getCurrentIndex: function() { return m },
                isDragging: function() { return V },
                isZooming: function() { return aa },
                setScrollOffset: function(a, b) { sa.x = a, M = sa.y = b, Da("updateScrollOffset", sa) },
                applyZoomPan: function(a, b, c, d) { pa.x = b, pa.y = c, s = a, Ha(d) },
                init: function() {
                    if (!j && !k) {
                        var c;
                        f.framework = e, f.template = a, f.bg = e.getChildByClass(a, "pswp__bg"), J = a.className, j = !0, N = e.detectFeatures(), H = N.raf, I = N.caf, E = N.transform, L = N.oldIE, f.scrollWrap = e.getChildByClass(a, "pswp__scroll-wrap"), f.container = e.getChildByClass(f.scrollWrap, "pswp__container"), n = f.container.style, f.itemHolders = y = [{ el: f.container.children[0], wrap: 0, index: -1 }, { el: f.container.children[1], wrap: 0, index: -1 }, { el: f.container.children[2], wrap: 0, index: -1 }], y[0].el.style.display = y[2].el.style.display = "none", Wa(), r = { resize: f.updateSize, orientationchange: function() { clearTimeout(O), O = setTimeout(function() { qa.x !== f.scrollWrap.clientWidth && f.updateSize() }, 500) }, scroll: Za, keydown: Xa, click: Ya };
                        var d = N.isOldIOSPhone || N.isOldAndroid || N.isMobileOpera;
                        for (N.animationName && N.transform && !d || (i.showAnimationDuration = i.hideAnimationDuration = 0), c = 0; c < wa.length; c++) f["init" + wa[c]]();
                        if (b) {
                            var g = f.ui = new b(f, e);
                            g.init()
                        }
                        Da("firstUpdate"), m = m || i.index || 0, (isNaN(m) || m < 0 || m >= ac()) && (m = 0), f.currItem = _b(m), (N.isOldIOSPhone || N.isOldAndroid) && (va = !1), a.setAttribute("aria-hidden", "false"), i.modal && (va ? a.style.position = "fixed" : (a.style.position = "absolute", a.style.top = e.getScrollY() + "px")), void 0 === M && (Da("initialLayout"), M = K = e.getScrollY());
                        var l = "pswp--open ";
                        for (i.mainClass && (l += i.mainClass + " "), i.showHideOpacity && (l += "pswp--animate_opacity "), l += G ? "pswp--touch" : "pswp--notouch", l += N.animationName ? " pswp--css_animation" : "", l += N.svg ? " pswp--svg" : "", e.addClass(a, l), f.updateSize(), o = -1, ua = null, c = 0; c < h; c++) Ja((c + o) * ta.x, y[c].el.style);
                        L || e.bind(f.scrollWrap, q, f), Ca("initialZoomInEnd", function() { f.setContent(y[0], m - 1), f.setContent(y[2], m + 1), y[0].el.style.display = y[2].el.style.display = "block", i.focus && a.focus(), Qa() }), f.setContent(y[1], m), f.updateCurrItem(), Da("afterInit"), va || (w = setInterval(function() { _a || V || aa || s !== f.currItem.initialZoomLevel || f.updateSize() }, 1e3)), e.addClass(a, "pswp--visible")
                    }
                },
                close: function() { j && (j = !1, k = !0, Da("close"), Ra(), cc(f.currItem, null, !0, f.destroy)) },
                destroy: function() { Da("destroy"), Xb && clearTimeout(Xb), a.setAttribute("aria-hidden", "true"), a.className = J, w && clearInterval(w), e.unbind(f.scrollWrap, q, f), e.unbind(window, "scroll", f), zb(), cb(), Ba = null },
                panTo: function(a, b, c) { c || (a > da.min.x ? a = da.min.x : a < da.max.x && (a = da.max.x), b > da.min.y ? b = da.min.y : b < da.max.y && (b = da.max.y)), pa.x = a, pa.y = b, Ha() },
                handleEvent: function(a) { a = a || window.event, r[a.type] && r[a.type](a) },
                goTo: function(a) {
                    a = Aa(a);
                    var b = a - m;
                    ua = b, m = a, f.currItem = _b(m), ra -= b, Ka(ta.x * ra), cb(), fa = !1, f.updateCurrItem()
                },
                next: function() { f.goTo(m + 1) },
                prev: function() { f.goTo(m - 1) },
                updateCurrZoomItem: function(a) {
                    if (a && Da("beforeChange", 0), y[1].el.children.length) {
                        var b = y[1].el.children[0];
                        ea = e.hasClass(b, "pswp__zoom-wrap") ? b.style : null
                    } else ea = null;
                    da = f.currItem.bounds, t = s = f.currItem.initialZoomLevel, pa.x = da.center.x, pa.y = da.center.y, a && Da("afterChange")
                },
                invalidateCurrItems: function() { x = !0; for (var a = 0; a < h; a++) y[a].item && (y[a].item.needsUpdate = !0) },
                updateCurrItem: function(a) {
                    if (0 !== ua) {
                        var b, c = Math.abs(ua);
                        if (!(a && c < 2)) {
                            f.currItem = _b(m), ya = !1, Da("beforeChange", ua), c >= h && (o += ua + (ua > 0 ? -h : h), c = h);
                            for (var d = 0; d < c; d++) ua > 0 ? (b = y.shift(), y[h - 1] = b, o++, Ja((o + 2) * ta.x, b.el.style), f.setContent(b, m - c + d + 1 + 1)) : (b = y.pop(), y.unshift(b), o--, Ja(o * ta.x, b.el.style), f.setContent(b, m + c - d - 1 - 1));
                            if (ea && 1 === Math.abs(ua)) {
                                var e = _b(z);
                                e.initialZoomLevel !== s && (ic(e, qa), mc(e), Ia(e))
                            }
                            ua = 0, f.updateCurrZoomItem(), z = m, Da("afterChange")
                        }
                    }
                },
                updateSize: function(b) {
                    if (!va && i.modal) {
                        var c = e.getScrollY();
                        if (M !== c && (a.style.top = c + "px", M = c), !b && xa.x === window.innerWidth && xa.y === window.innerHeight) return;
                        xa.x = window.innerWidth, xa.y = window.innerHeight, a.style.height = xa.y + "px"
                    }
                    if (qa.x = f.scrollWrap.clientWidth, qa.y = f.scrollWrap.clientHeight, Za(), ta.x = qa.x + Math.round(qa.x * i.spacing), ta.y = qa.y, Ka(ta.x * ra), Da("beforeResize"), void 0 !== o) {
                        for (var d, g, j, k = 0; k < h; k++) d = y[k], Ja((k + o) * ta.x, d.el.style), j = m + k - 1, i.loop && ac() > 2 && (j = Aa(j)), g = _b(j), g && (x || g.needsUpdate || !g.bounds) ? (f.cleanSlide(g), f.setContent(d, j), 1 === k && (f.currItem = g, f.updateCurrZoomItem(!0)), g.needsUpdate = !1) : d.index === -1 && j >= 0 && f.setContent(d, j), g && g.container && (ic(g, qa), mc(g), Ia(g));
                        x = !1
                    }
                    t = s = f.currItem.initialZoomLevel, da = f.currItem.bounds, da && (pa.x = da.center.x, pa.y = da.center.y, Ha(!0)), Da("resize")
                },
                zoomTo: function(a, b, c, d, f) {
                    b && (t = s, ub.x = Math.abs(b.x) - pa.x, ub.y = Math.abs(b.y) - pa.y, Ma(oa, pa));
                    var g = Sa(a, !1),
                        h = {};
                    Va("x", g, h, a), Va("y", g, h, a);
                    var i = s,
                        j = { x: pa.x, y: pa.y };
                    Na(h);
                    var k = function(b) { 1 === b ? (s = a, pa.x = h.x, pa.y = h.y) : (s = (a - i) * b + i, pa.x = (h.x - j.x) * b + j.x, pa.y = (h.y - j.y) * b + j.y), f && f(b), Ha(1 === b) };
                    c ? db("customZoomTo", 0, 1, c, d || e.easing.sine.inOut, k) : k(1)
                }
            },
            fb = 30,
            gb = 10,
            hb = {},
            ib = {},
            jb = {},
            kb = {},
            lb = {},
            mb = [],
            nb = {},
            ob = [],
            pb = {},
            qb = 0,
            rb = ma(),
            sb = 0,
            tb = ma(),
            ub = ma(),
            vb = ma(),
            wb = function(a, b) { return a.x === b.x && a.y === b.y },
            xb = function(a, b) { return Math.abs(a.x - b.x) < g && Math.abs(a.y - b.y) < g },
            yb = function(a, b) { return pb.x = Math.abs(a.x - b.x), pb.y = Math.abs(a.y - b.y), Math.sqrt(pb.x * pb.x + pb.y * pb.y) },
            zb = function() { Z && (I(Z), Z = null) },
            Ab = function() { V && (Z = H(Ab), Qb()) },
            Bb = function() { return !("fit" === i.scaleMode && s === f.currItem.initialZoomLevel) },
            Cb = function(a, b) { return !(!a || a === document) && (!(a.getAttribute("class") && a.getAttribute("class").indexOf("pswp__scroll-wrap") > -1) && (b(a) ? a : Cb(a.parentNode, b))) },
            Db = {},
            Eb = function(a, b) { return Db.prevent = !Cb(a.target, i.isClickableElement), Da("preventDragEvent", a, b, Db), Db.prevent },
            Fb = function(a, b) { return b.x = a.pageX, b.y = a.pageY, b.id = a.identifier, b },
            Gb = function(a, b, c) { c.x = .5 * (a.x + b.x), c.y = .5 * (a.y + b.y) },
            Hb = function(a, b, c) {
                if (a - Q > 50) {
                    var d = ob.length > 2 ? ob.shift() : {};
                    d.x = b, d.y = c, ob.push(d), Q = a
                }
            },
            Ib = function() { var a = pa.y - f.currItem.initialPosition.y; return 1 - Math.abs(a / (qa.y / 2)) },
            Jb = {},
            Kb = {},
            Lb = [],
            Mb = function(a) { for (; Lb.length > 0;) Lb.pop(); return F ? (la = 0, mb.forEach(function(a) { 0 === la ? Lb[0] = a : 1 === la && (Lb[1] = a), la++ })) : a.type.indexOf("touch") > -1 ? a.touches && a.touches.length > 0 && (Lb[0] = Fb(a.touches[0], Jb), a.touches.length > 1 && (Lb[1] = Fb(a.touches[1], Kb))) : (Jb.x = a.pageX, Jb.y = a.pageY, Jb.id = "", Lb[0] = Jb), Lb },
            Nb = function(a, b) {
                var c, d, e, g, h = 0,
                    j = pa[a] + b[a],
                    k = b[a] > 0,
                    l = tb.x + b.x,
                    m = tb.x - nb.x;
                return c = j > da.min[a] || j < da.max[a] ? i.panEndFriction : 1, j = pa[a] + b[a] * c, !i.allowPanToNext && s !== f.currItem.initialZoomLevel || (ea ? "h" !== ga || "x" !== a || X || (k ? (j > da.min[a] && (c = i.panEndFriction, h = da.min[a] - j, d = da.min[a] - oa[a]), (d <= 0 || m < 0) && ac() > 1 ? (g = l, m < 0 && l > nb.x && (g = nb.x)) : da.min.x !== da.max.x && (e = j)) : (j < da.max[a] && (c = i.panEndFriction, h = j - da.max[a], d = oa[a] - da.max[a]), (d <= 0 || m > 0) && ac() > 1 ? (g = l, m > 0 && l < nb.x && (g = nb.x)) : da.min.x !== da.max.x && (e = j))) : g = l, "x" !== a) ? void(fa || $ || s > f.currItem.fitRatio && (pa[a] += b[a] * c)) : (void 0 !== g && (Ka(g, !0), $ = g !== nb.x), da.min.x !== da.max.x && (void 0 !== e ? pa.x = e : $ || (pa.x += b.x * c)), void 0 !== g)
            },
            Ob = function(a) {
                if (!("mousedown" === a.type && a.button > 0)) {
                    if ($b) return void a.preventDefault();
                    if (!U || "mousedown" !== a.type) {
                        if (Eb(a, !0) && a.preventDefault(), Da("pointerDown"), F) {
                            var b = e.arraySearch(mb, a.pointerId, "id");
                            b < 0 && (b = mb.length), mb[b] = { x: a.pageX, y: a.pageY, id: a.pointerId }
                        }
                        var c = Mb(a),
                            d = c.length;
                        _ = null, cb(), V && 1 !== d || (V = ha = !0, e.bind(window, p, f), S = ka = ia = T = $ = Y = W = X = !1, ga = null, Da("firstTouchStart", c), Ma(oa, pa), na.x = na.y = 0, Ma(kb, c[0]), Ma(lb, kb), nb.x = ta.x * ra, ob = [{ x: kb.x, y: kb.y }], Q = P = Ea(), Sa(s, !0), zb(), Ab()), !aa && d > 1 && !fa && !$ && (t = s, X = !1, aa = W = !0, na.y = na.x = 0, Ma(oa, pa), Ma(hb, c[0]), Ma(ib, c[1]), Gb(hb, ib, vb), ub.x = Math.abs(vb.x) - pa.x, ub.y = Math.abs(vb.y) - pa.y, ba = ca = yb(hb, ib))
                    }
                }
            },
            Pb = function(a) {
                if (a.preventDefault(), F) {
                    var b = e.arraySearch(mb, a.pointerId, "id");
                    if (b > -1) {
                        var c = mb[b];
                        c.x = a.pageX, c.y = a.pageY
                    }
                }
                if (V) {
                    var d = Mb(a);
                    if (ga || Y || aa) _ = d;
                    else if (tb.x !== ta.x * ra) ga = "h";
                    else {
                        var f = Math.abs(d[0].x - kb.x) - Math.abs(d[0].y - kb.y);
                        Math.abs(f) >= gb && (ga = f > 0 ? "h" : "v", _ = d)
                    }
                }
            },
            Qb = function() {
                if (_) {
                    var a = _.length;
                    if (0 !== a)
                        if (Ma(hb, _[0]), jb.x = hb.x - kb.x, jb.y = hb.y - kb.y, aa && a > 1) {
                            if (kb.x = hb.x, kb.y = hb.y, !jb.x && !jb.y && wb(_[1], ib)) return;
                            Ma(ib, _[1]), X || (X = !0, Da("zoomGestureStarted"));
                            var b = yb(hb, ib),
                                c = Vb(b);
                            c > f.currItem.initialZoomLevel + f.currItem.initialZoomLevel / 15 && (ka = !0);
                            var d = 1,
                                e = Ta(),
                                g = Ua();
                            if (c < e)
                                if (i.pinchToClose && !ka && t <= f.currItem.initialZoomLevel) {
                                    var h = e - c,
                                        j = 1 - h / (e / 1.2);
                                    Fa(j), Da("onPinchClose", j), ia = !0
                                } else d = (e - c) / e, d > 1 && (d = 1), c = e - d * (e / 3);
                            else c > g && (d = (c - g) / (6 * e), d > 1 && (d = 1), c = g + d * e);
                            d < 0 && (d = 0), ba = b, Gb(hb, ib, rb), na.x += rb.x - vb.x, na.y += rb.y - vb.y, Ma(vb, rb), pa.x = La("x", c), pa.y = La("y", c), S = c > s, s = c, Ha()
                        } else {
                            if (!ga) return;
                            if (ha && (ha = !1, Math.abs(jb.x) >= gb && (jb.x -= _[0].x - lb.x), Math.abs(jb.y) >= gb && (jb.y -= _[0].y - lb.y)), kb.x = hb.x, kb.y = hb.y, 0 === jb.x && 0 === jb.y) return;
                            if ("v" === ga && i.closeOnVerticalDrag && !Bb()) { na.y += jb.y, pa.y += jb.y; var k = Ib(); return T = !0, Da("onVerticalDrag", k), Fa(k), void Ha() }
                            Hb(Ea(), hb.x, hb.y), Y = !0, da = f.currItem.bounds;
                            var l = Nb("x", jb);
                            l || (Nb("y", jb), Na(pa), Ha())
                        }
                }
            },
            Rb = function(a) {
                if (N.isOldAndroid) {
                    if (U && "mouseup" === a.type) return;
                    a.type.indexOf("touch") > -1 && (clearTimeout(U), U = setTimeout(function() { U = 0 }, 600))
                }
                Da("pointerUp"), Eb(a, !1) && a.preventDefault();
                var b;
                if (F) {
                    var c = e.arraySearch(mb, a.pointerId, "id");
                    if (c > -1)
                        if (b = mb.splice(c, 1)[0], navigator.msPointerEnabled) {
                            var d = { 4: "mouse", 2: "touch", 3: "pen" };
                            b.type = d[a.pointerType], b.type || (b.type = a.pointerType || "mouse")
                        } else b.type = a.pointerType || "mouse"
                }
                var g, h = Mb(a),
                    j = h.length;
                if ("mouseup" === a.type && (j = 0), 2 === j) return _ = null, !0;
                1 === j && Ma(lb, h[0]), 0 !== j || ga || fa || (b || ("mouseup" === a.type ? b = { x: a.pageX, y: a.pageY, type: "mouse" } : a.changedTouches && a.changedTouches[0] && (b = { x: a.changedTouches[0].pageX, y: a.changedTouches[0].pageY, type: "touch" })), Da("touchRelease", a, b));
                var k = -1;
                if (0 === j && (V = !1, e.unbind(window, p, f), zb(), aa ? k = 0 : sb !== -1 && (k = Ea() - sb)), sb = 1 === j ? Ea() : -1, g = k !== -1 && k < 150 ? "zoom" : "swipe", aa && j < 2 && (aa = !1, 1 === j && (g = "zoomPointerUp"), Da("zoomGestureEnded")), _ = null, Y || X || fa || T)
                    if (cb(), R || (R = Sb()), R.calculateSwipeSpeed("x"), T) {
                        var l = Ib();
                        if (l < i.verticalDragRange) f.close();
                        else {
                            var m = pa.y,
                                n = ja;
                            db("verticalDrag", 0, 1, 300, e.easing.cubic.out, function(a) { pa.y = (f.currItem.initialPosition.y - m) * a + m, Fa((1 - n) * a + n), Ha() }), Da("onVerticalDrag", 1)
                        }
                    } else {
                        if (($ || fa) && 0 === j) {
                            var o = Ub(g, R);
                            if (o) return;
                            g = "zoomPointerUp"
                        }
                        if (!fa) return "swipe" !== g ? void Wb() : void(!$ && s > f.currItem.fitRatio && Tb(R))
                    }
            },
            Sb = function() { var a, b, c = { lastFlickOffset: {}, lastFlickDist: {}, lastFlickSpeed: {}, slowDownRatio: {}, slowDownRatioReverse: {}, speedDecelerationRatio: {}, speedDecelerationRatioAbs: {}, distanceOffset: {}, backAnimDestination: {}, backAnimStarted: {}, calculateSwipeSpeed: function(d) { ob.length > 1 ? (a = Ea() - Q + 50, b = ob[ob.length - 2][d]) : (a = Ea() - P, b = lb[d]), c.lastFlickOffset[d] = kb[d] - b, c.lastFlickDist[d] = Math.abs(c.lastFlickOffset[d]), c.lastFlickDist[d] > 20 ? c.lastFlickSpeed[d] = c.lastFlickOffset[d] / a : c.lastFlickSpeed[d] = 0, Math.abs(c.lastFlickSpeed[d]) < .1 && (c.lastFlickSpeed[d] = 0), c.slowDownRatio[d] = .95, c.slowDownRatioReverse[d] = 1 - c.slowDownRatio[d], c.speedDecelerationRatio[d] = 1 }, calculateOverBoundsAnimOffset: function(a, b) { c.backAnimStarted[a] || (pa[a] > da.min[a] ? c.backAnimDestination[a] = da.min[a] : pa[a] < da.max[a] && (c.backAnimDestination[a] = da.max[a]), void 0 !== c.backAnimDestination[a] && (c.slowDownRatio[a] = .7, c.slowDownRatioReverse[a] = 1 - c.slowDownRatio[a], c.speedDecelerationRatioAbs[a] < .05 && (c.lastFlickSpeed[a] = 0, c.backAnimStarted[a] = !0, db("bounceZoomPan" + a, pa[a], c.backAnimDestination[a], b || 300, e.easing.sine.out, function(b) { pa[a] = b, Ha() })))) }, calculateAnimOffset: function(a) { c.backAnimStarted[a] || (c.speedDecelerationRatio[a] = c.speedDecelerationRatio[a] * (c.slowDownRatio[a] + c.slowDownRatioReverse[a] - c.slowDownRatioReverse[a] * c.timeDiff / 10), c.speedDecelerationRatioAbs[a] = Math.abs(c.lastFlickSpeed[a] * c.speedDecelerationRatio[a]), c.distanceOffset[a] = c.lastFlickSpeed[a] * c.speedDecelerationRatio[a] * c.timeDiff, pa[a] += c.distanceOffset[a]) }, panAnimLoop: function() { if ($a.zoomPan && ($a.zoomPan.raf = H(c.panAnimLoop), c.now = Ea(), c.timeDiff = c.now - c.lastNow, c.lastNow = c.now, c.calculateAnimOffset("x"), c.calculateAnimOffset("y"), Ha(), c.calculateOverBoundsAnimOffset("x"), c.calculateOverBoundsAnimOffset("y"), c.speedDecelerationRatioAbs.x < .05 && c.speedDecelerationRatioAbs.y < .05)) return pa.x = Math.round(pa.x), pa.y = Math.round(pa.y), Ha(), void ab("zoomPan") } }; return c },
            Tb = function(a) { return a.calculateSwipeSpeed("y"), da = f.currItem.bounds, a.backAnimDestination = {}, a.backAnimStarted = {}, Math.abs(a.lastFlickSpeed.x) <= .05 && Math.abs(a.lastFlickSpeed.y) <= .05 ? (a.speedDecelerationRatioAbs.x = a.speedDecelerationRatioAbs.y = 0, a.calculateOverBoundsAnimOffset("x"), a.calculateOverBoundsAnimOffset("y"), !0) : (bb("zoomPan"), a.lastNow = Ea(), void a.panAnimLoop()) },
            Ub = function(a, b) {
                var c;
                fa || (qb = m);
                var d;
                if ("swipe" === a) {
                    var g = kb.x - lb.x,
                        h = b.lastFlickDist.x < 10;
                    g > fb && (h || b.lastFlickOffset.x > 20) ? d = -1 : g < -fb && (h || b.lastFlickOffset.x < -20) && (d = 1)
                }
                var j;
                d && (m += d, m < 0 ? (m = i.loop ? ac() - 1 : 0, j = !0) : m >= ac() && (m = i.loop ? 0 : ac() - 1, j = !0), j && !i.loop || (ua += d, ra -= d, c = !0));
                var k, l = ta.x * ra,
                    n = Math.abs(l - tb.x);
                return c || l > tb.x == b.lastFlickSpeed.x > 0 ? (k = Math.abs(b.lastFlickSpeed.x) > 0 ? n / Math.abs(b.lastFlickSpeed.x) : 333, k = Math.min(k, 400), k = Math.max(k, 250)) : k = 333, qb === m && (c = !1), fa = !0, Da("mainScrollAnimStart"), db("mainScroll", tb.x, l, k, e.easing.cubic.out, Ka, function() { cb(), fa = !1, qb = -1, (c || qb !== m) && f.updateCurrItem(), Da("mainScrollAnimComplete") }), c && f.updateCurrItem(!0), c
            },
            Vb = function(a) { return 1 / ca * a * t },
            Wb = function() {
                var a = s,
                    b = Ta(),
                    c = Ua();
                s < b ? a = b : s > c && (a = c);
                var d, g = 1,
                    h = ja;
                return ia && !S && !ka && s < b ? (f.close(), !0) : (ia && (d = function(a) { Fa((g - h) * a + h) }), f.zoomTo(a, 0, 200, e.easing.cubic.out, d), !0)
            };
        za("Gestures", {
            publicMethods: {
                initGestures: function() {
                    var a = function(a, b, c, d, e) { A = a + b, B = a + c, C = a + d, D = e ? a + e : "" };
                    F = N.pointerEvent, F && N.touch && (N.touch = !1), F ? navigator.msPointerEnabled ? a("MSPointer", "Down", "Move", "Up", "Cancel") : a("pointer", "down", "move", "up", "cancel") : N.touch ? (a("touch", "start", "move", "end", "cancel"), G = !0) : a("mouse", "down", "move", "up"), p = B + " " + C + " " + D, q = A, F && !G && (G = navigator.maxTouchPoints > 1 || navigator.msMaxTouchPoints > 1), f.likelyTouchDevice = G, r[A] = Ob, r[B] = Pb, r[C] = Rb, D && (r[D] = r[C]), N.touch && (q += " mousedown", p += " mousemove mouseup", r.mousedown = r[A], r.mousemove = r[B], r.mouseup = r[C]), G || (i.allowPanToNext = !1)
                }
            }
        });
        var Xb, Yb, Zb, $b, _b, ac, bc, cc = function(b, c, d, g) {
                Xb && clearTimeout(Xb), $b = !0, Zb = !0;
                var h;
                b.initialLayout ? (h = b.initialLayout, b.initialLayout = null) : h = i.getThumbBoundsFn && i.getThumbBoundsFn(m);
                var j = d ? i.hideAnimationDuration : i.showAnimationDuration,
                    k = function() { ab("initialZoom"), d ? (f.template.removeAttribute("style"), f.bg.removeAttribute("style")) : (Fa(1), c && (c.style.display = "block"), e.addClass(a, "pswp--animated-in"), Da("initialZoom" + (d ? "OutEnd" : "InEnd"))), g && g(), $b = !1 };
                if (!j || !h || void 0 === h.x) return Da("initialZoom" + (d ? "Out" : "In")), s = b.initialZoomLevel, Ma(pa, b.initialPosition), Ha(), a.style.opacity = d ? 0 : 1, Fa(1), void(j ? setTimeout(function() { k() }, j) : k());
                var n = function() {
                    var c = l,
                        g = !f.currItem.src || f.currItem.loadError || i.showHideOpacity;
                    b.miniImg && (b.miniImg.style.webkitBackfaceVisibility = "hidden"), d || (s = h.w / b.w, pa.x = h.x, pa.y = h.y - K, f[g ? "template" : "bg"].style.opacity = .001, Ha()), bb("initialZoom"), d && !c && e.removeClass(a, "pswp--animated-in"), g && (d ? e[(c ? "remove" : "add") + "Class"](a, "pswp--animate_opacity") : setTimeout(function() { e.addClass(a, "pswp--animate_opacity") }, 30)), Xb = setTimeout(function() {
                        if (Da("initialZoom" + (d ? "Out" : "In")), d) {
                            var f = h.w / b.w,
                                i = { x: pa.x, y: pa.y },
                                l = s,
                                m = ja,
                                n = function(b) { 1 === b ? (s = f, pa.x = h.x, pa.y = h.y - M) : (s = (f - l) * b + l, pa.x = (h.x - i.x) * b + i.x, pa.y = (h.y - M - i.y) * b + i.y), Ha(), g ? a.style.opacity = 1 - b : Fa(m - b * m) };
                            c ? db("initialZoom", 0, 1, j, e.easing.cubic.out, n, k) : (n(1), Xb = setTimeout(k, j + 20))
                        } else s = b.initialZoomLevel, Ma(pa, b.initialPosition), Ha(), Fa(1), g ? a.style.opacity = 1 : Fa(1), Xb = setTimeout(k, j + 20)
                    }, d ? 25 : 90)
                };
                n()
            },
            dc = {},
            ec = [],
            fc = { index: 0, errorMsg: '<div class="pswp__error-msg"><a href="%url%" target="_blank">The image</a> could not be loaded.</div>', forceProgressiveLoading: !1, preload: [1, 1], getNumItemsFn: function() { return Yb.length } },
            gc = function() { return { center: { x: 0, y: 0 }, max: { x: 0, y: 0 }, min: { x: 0, y: 0 } } },
            hc = function(a, b, c) {
                var d = a.bounds;
                d.center.x = Math.round((dc.x - b) / 2), d.center.y = Math.round((dc.y - c) / 2) + a.vGap.top, d.max.x = b > dc.x ? Math.round(dc.x - b) : d.center.x, d.max.y = c > dc.y ? Math.round(dc.y - c) + a.vGap.top : d.center.y, d.min.x = b > dc.x ? 0 : d.center.x, d.min.y = c > dc.y ? a.vGap.top : d.center.y
            },
            ic = function(a, b, c) {
                if (a.src && !a.loadError) {
                    var d = !c;
                    if (d && (a.vGap || (a.vGap = { top: 0, bottom: 0 }), Da("parseVerticalMargin", a)), dc.x = b.x, dc.y = b.y - a.vGap.top - a.vGap.bottom, d) {
                        var e = dc.x / a.w,
                            f = dc.y / a.h;
                        a.fitRatio = e < f ? e : f;
                        var g = i.scaleMode;
                        "orig" === g ? c = 1 : "fit" === g && (c = a.fitRatio), c > 1 && (c = 1), a.initialZoomLevel = c, a.bounds || (a.bounds = gc())
                    }
                    if (!c) return;
                    return hc(a, a.w * c, a.h * c), d && c === a.initialZoomLevel && (a.initialPosition = a.bounds.center), a.bounds
                }
                return a.w = a.h = 0, a.initialZoomLevel = a.fitRatio = 1, a.bounds = gc(), a.initialPosition = a.bounds.center, a.bounds
            },
            jc = function(a, b, c, d, e, g) { b.loadError || d && (b.imageAppended = !0, mc(b, d, b === f.currItem && ya), c.appendChild(d), g && setTimeout(function() { b && b.loaded && b.placeholder && (b.placeholder.style.display = "none", b.placeholder = null) }, 500)) },
            kc = function(a) {
                a.loading = !0, a.loaded = !1;
                var b = a.img = e.createEl("pswp__img", "img"),
                    c = function() { a.loading = !1, a.loaded = !0, a.loadComplete ? a.loadComplete(a) : a.img = null, b.onload = b.onerror = null, b = null };
                return b.onload = c, b.onerror = function() { a.loadError = !0, c() }, b.src = a.src, b
            },
            lc = function(a, b) { if (a.src && a.loadError && a.container) return b && (a.container.innerHTML = ""), a.container.innerHTML = i.errorMsg.replace("%url%", a.src), !0 },
            mc = function(a, b, c) {
                if (a.src) {
                    b || (b = a.container.lastChild);
                    var d = c ? a.w : Math.round(a.w * a.fitRatio),
                        e = c ? a.h : Math.round(a.h * a.fitRatio);
                    a.placeholder && !a.loaded && (a.placeholder.style.width = d + "px", a.placeholder.style.height = e + "px"), b.style.width = d + "px", b.style.height = e + "px"
                }
            },
            nc = function() {
                if (ec.length) {
                    for (var a, b = 0; b < ec.length; b++) a = ec[b], a.holder.index === a.index && jc(a.index, a.item, a.baseDiv, a.img, !1, a.clearPlaceholder);
                    ec = []
                }
            };
        za("Controller", {
            publicMethods: {
                lazyLoadItem: function(a) {
                    a = Aa(a);
                    var b = _b(a);
                    b && (!b.loaded && !b.loading || x) && (Da("gettingData", a, b), b.src && kc(b))
                },
                initController: function() {
                    e.extend(i, fc, !0), f.items = Yb = c, _b = f.getItemAt, ac = i.getNumItemsFn, bc = i.loop, ac() < 3 && (i.loop = !1), Ca("beforeChange", function(a) {
                        var b, c = i.preload,
                            d = null === a || a >= 0,
                            e = Math.min(c[0], ac()),
                            g = Math.min(c[1], ac());
                        for (b = 1; b <= (d ? g : e); b++) f.lazyLoadItem(m + b);
                        for (b = 1; b <= (d ? e : g); b++) f.lazyLoadItem(m - b)
                    }), Ca("initialLayout", function() { f.currItem.initialLayout = i.getThumbBoundsFn && i.getThumbBoundsFn(m) }), Ca("mainScrollAnimComplete", nc), Ca("initialZoomInEnd", nc), Ca("destroy", function() {
                        for (var a, b = 0; b < Yb.length; b++) a = Yb[b], a.container && (a.container = null), a.placeholder && (a.placeholder = null), a.img && (a.img = null), a.preloader && (a.preloader = null), a.loadError && (a.loaded = a.loadError = !1);
                        ec = null
                    })
                },
                getItemAt: function(a) { return a >= 0 && (void 0 !== Yb[a] && Yb[a]) },
                allowProgressiveImg: function() { return i.forceProgressiveLoading || !G || i.mouseUsed || screen.width > 1200 },
                setContent: function(a, b) {
                    i.loop && (b = Aa(b));
                    var c = f.getItemAt(a.index);
                    c && (c.container = null);
                    var d, g = f.getItemAt(b);
                    if (!g) return void(a.el.innerHTML = "");
                    Da("gettingData", b, g), a.index = b, a.item = g;
                    var h = g.container = e.createEl("pswp__zoom-wrap");
                    if (!g.src && g.html && (g.html.tagName ? h.appendChild(g.html) : h.innerHTML = g.html), lc(g), ic(g, qa), !g.src || g.loadError || g.loaded) g.src && !g.loadError && (d = e.createEl("pswp__img", "img"), d.style.opacity = 1, d.src = g.src, mc(g, d), jc(b, g, h, d, !0));
                    else {
                        if (g.loadComplete = function(c) {
                                if (j) {
                                    if (a && a.index === b) {
                                        if (lc(c, !0)) return c.loadComplete = c.img = null, ic(c, qa), Ia(c), void(a.index === m && f.updateCurrZoomItem());
                                        c.imageAppended ? !$b && c.placeholder && (c.placeholder.style.display = "none", c.placeholder = null) : N.transform && (fa || $b) ? ec.push({ item: c, baseDiv: h, img: c.img, index: b, holder: a, clearPlaceholder: !0 }) : jc(b, c, h, c.img, fa || $b, !0)
                                    }
                                    c.loadComplete = null, c.img = null, Da("imageLoadComplete", b, c)
                                }
                            }, e.features.transform) {
                            var k = "pswp__img pswp__img--placeholder";
                            k += g.msrc ? "" : " pswp__img--placeholder--blank";
                            var l = e.createEl(k, g.msrc ? "img" : "");
                            g.msrc && (l.src = g.msrc), mc(g, l), h.appendChild(l), g.placeholder = l
                        }
                        g.loading || kc(g), f.allowProgressiveImg() && (!Zb && N.transform ? ec.push({ item: g, baseDiv: h, img: g.img, index: b, holder: a }) : jc(b, g, h, g.img, !0, !0))
                    }
                    Zb || b !== m ? Ia(g) : (ea = h.style, cc(g, d || g.img)), a.el.innerHTML = "", a.el.appendChild(h)
                },
                cleanSlide: function(a) { a.img && (a.img.onload = a.img.onerror = null), a.loaded = a.loading = a.img = a.imageAppended = !1 }
            }
        });
        var oc, pc = {},
            qc = function(a, b, c) {
                var d = document.createEvent("CustomEvent"),
                    e = { origEvent: a, target: a.target, releasePoint: b, pointerType: c || "touch" };
                d.initCustomEvent("pswpTap", !0, !0, e), a.target.dispatchEvent(d)
            };
        za("Tap", {
            publicMethods: {
                initTap: function() { Ca("firstTouchStart", f.onTapStart), Ca("touchRelease", f.onTapRelease), Ca("destroy", function() { pc = {}, oc = null }) },
                onTapStart: function(a) { a.length > 1 && (clearTimeout(oc), oc = null) },
                onTapRelease: function(a, b) {
                    if (b && !Y && !W && !_a) {
                        var c = b;
                        if (oc && (clearTimeout(oc), oc = null, xb(c, pc))) return void Da("doubleTap", c);
                        if ("mouse" === b.type) return void qc(a, b, "mouse");
                        var d = a.target.tagName.toUpperCase();
                        if ("BUTTON" === d || e.hasClass(a.target, "pswp__single-tap")) return void qc(a, b);
                        Ma(pc, c), oc = setTimeout(function() { qc(a, b), oc = null }, 300)
                    }
                }
            }
        });
        var rc;
        za("DesktopZoom", {
            publicMethods: {
                initDesktopZoom: function() { L || (G ? Ca("mouseUsed", function() { f.setupDesktopZoom() }) : f.setupDesktopZoom(!0)) },
                setupDesktopZoom: function(b) {
                    rc = {};
                    var c = "wheel mousewheel DOMMouseScroll";
                    Ca("bindEvents", function() { e.bind(a, c, f.handleMouseWheel) }), Ca("unbindEvents", function() { rc && e.unbind(a, c, f.handleMouseWheel) }), f.mouseZoomedIn = !1;
                    var d, g = function() { f.mouseZoomedIn && (e.removeClass(a, "pswp--zoomed-in"), f.mouseZoomedIn = !1), s < 1 ? e.addClass(a, "pswp--zoom-allowed") : e.removeClass(a, "pswp--zoom-allowed"), h() },
                        h = function() { d && (e.removeClass(a, "pswp--dragging"), d = !1) };
                    Ca("resize", g), Ca("afterChange", g), Ca("pointerDown", function() { f.mouseZoomedIn && (d = !0, e.addClass(a, "pswp--dragging")) }), Ca("pointerUp", h), b || g()
                },
                handleMouseWheel: function(a) {
                    if (s <= f.currItem.fitRatio) return i.modal && (!i.closeOnScroll || _a || V ? a.preventDefault() : E && Math.abs(a.deltaY) > 2 && (l = !0, f.close())), !0;
                    if (a.stopPropagation(), rc.x = 0, "deltaX" in a) 1 === a.deltaMode ? (rc.x = 18 * a.deltaX, rc.y = 18 * a.deltaY) : (rc.x = a.deltaX, rc.y = a.deltaY);
                    else if ("wheelDelta" in a) a.wheelDeltaX && (rc.x = -.16 * a.wheelDeltaX), a.wheelDeltaY ? rc.y = -.16 * a.wheelDeltaY : rc.y = -.16 * a.wheelDelta;
                    else {
                        if (!("detail" in a)) return;
                        rc.y = a.detail
                    }
                    Sa(s, !0);
                    var b = pa.x - rc.x,
                        c = pa.y - rc.y;
                    (i.modal || b <= da.min.x && b >= da.max.x && c <= da.min.y && c >= da.max.y) && a.preventDefault(), f.panTo(b, c)
                },
                toggleDesktopZoom: function(b) {
                    b = b || { x: qa.x / 2 + sa.x, y: qa.y / 2 + sa.y };
                    var c = i.getDoubleTapZoom(!0, f.currItem),
                        d = s === c;
                    f.mouseZoomedIn = !d, f.zoomTo(d ? f.currItem.initialZoomLevel : c, b, 333), e[(d ? "remove" : "add") + "Class"](a, "pswp--zoomed-in")
                }
            }
        });
        var sc, tc, uc, vc, wc, xc, yc, zc, Ac, Bc, Cc, Dc, Ec = { history: !0, galleryUID: 1 },
            Fc = function() { return Cc.hash.substring(1) },
            Gc = function() { sc && clearTimeout(sc), uc && clearTimeout(uc) },
            Hc = function() {
                var a = Fc(),
                    b = {};
                if (a.length < 5) return b;
                var c, d = a.split("&");
                for (c = 0; c < d.length; c++)
                    if (d[c]) {
                        var e = d[c].split("=");
                        e.length < 2 || (b[e[0]] = e[1])
                    }
                if (i.galleryPIDs) {
                    var f = b.pid;
                    for (b.pid = 0, c = 0; c < Yb.length; c++)
                        if (Yb[c].pid === f) { b.pid = c; break }
                } else b.pid = parseInt(b.pid, 10) - 1;
                return b.pid < 0 && (b.pid = 0), b
            },
            Ic = function() {
                if (uc && clearTimeout(uc), _a || V) return void(uc = setTimeout(Ic, 500));
                vc ? clearTimeout(tc) : vc = !0;
                var a = m + 1,
                    b = _b(m);
                b.hasOwnProperty("pid") && (a = b.pid);
                var c = yc + "&gid=" + i.galleryUID + "&pid=" + a;
                zc || Cc.hash.indexOf(c) === -1 && (Bc = !0);
                var d = Cc.href.split("#")[0] + "#" + c;
                Dc ? "#" + c !== window.location.hash && history[zc ? "replaceState" : "pushState"]("", document.title, d) : zc ? Cc.replace(d) : Cc.hash = c, zc = !0, tc = setTimeout(function() { vc = !1 }, 60)
            };
        za("History", {
            publicMethods: {
                initHistory: function() {
                    if (e.extend(i, Ec, !0), i.history) {
                        Cc = window.location, Bc = !1, Ac = !1, zc = !1, yc = Fc(), Dc = "pushState" in history, yc.indexOf("gid=") > -1 && (yc = yc.split("&gid=")[0], yc = yc.split("?gid=")[0]), Ca("afterChange", f.updateURL), Ca("unbindEvents", function() { e.unbind(window, "hashchange", f.onHashChange) });
                        var a = function() { xc = !0, Ac || (Bc ? history.back() : yc ? Cc.hash = yc : Dc ? history.pushState("", document.title, Cc.pathname + Cc.search) : Cc.hash = ""), Gc() };
                        Ca("unbindEvents", function() { l && a() }), Ca("destroy", function() { xc || a() }), Ca("firstUpdate", function() { m = Hc().pid });
                        var b = yc.indexOf("pid=");
                        b > -1 && (yc = yc.substring(0, b), "&" === yc.slice(-1) && (yc = yc.slice(0, -1))), setTimeout(function() { j && e.bind(window, "hashchange", f.onHashChange) }, 40)
                    }
                },
                onHashChange: function() { return Fc() === yc ? (Ac = !0, void f.close()) : void(vc || (wc = !0, f.goTo(Hc().pid), wc = !1)) },
                updateURL: function() { Gc(), wc || (zc ? sc = setTimeout(Ic, 800) : Ic()) }
            }
        }), e.extend(f, eb)
    };
    return a
});

/*! PhotoSwipe Default UI - 4.1.3 - 2019-01-08
 * http://photoswipe.com
 * Copyright (c) 2019 Dmitry Semenov; */
! function(a, b) { "function" == typeof define && define.amd ? define(b) : "object" == typeof exports ? module.exports = b() : a.PhotoSwipeUI_Default = b() }(this, function() {
    "use strict";
    var a = function(a, b) {
        var c, d, e, f, g, h, i, j, k, l, m, n, o, p, q, r, s, t, u, v = this,
            w = !1,
            x = !0,
            y = !0,
            z = { barsSize: { top: 44, bottom: "auto" }, closeElClasses: ["item", "caption", "zoom-wrap", "ui", "top-bar"], timeToIdle: 4e3, timeToIdleOutside: 1e3, loadingIndicatorDelay: 1e3, addCaptionHTMLFn: function(a, b) { return a.title ? (b.children[0].innerHTML = a.title, !0) : (b.children[0].innerHTML = "", !1) }, closeEl: !0, captionEl: !0, fullscreenEl: !0, zoomEl: !0, shareEl: !0, counterEl: !0, arrowEl: !0, preloaderEl: !0, tapToClose: !1, tapToToggleControls: !0, clickToCloseNonZoomable: !0, shareButtons: [{ id: "facebook", label: "Share on Facebook", url: "https://www.facebook.com/sharer/sharer.php?u={{url}}" }, { id: "twitter", label: "Tweet", url: "https://twitter.com/intent/tweet?text={{text}}&url={{url}}" }, { id: "pinterest", label: "Pin it", url: "http://www.pinterest.com/pin/create/button/?url={{url}}&media={{image_url}}&description={{text}}" }, { id: "download", label: "Download image", url: "{{raw_image_url}}", download: !0 }], getImageURLForShare: function() { return a.currItem.src || "" }, getPageURLForShare: function() { return window.location.href }, getTextForShare: function() { return a.currItem.title || "" }, indexIndicatorSep: " / ", fitControlsWidth: 1200 },
            A = function(a) {
                if (r) return !0;
                a = a || window.event, q.timeToIdle && q.mouseUsed && !k && K();
                for (var c, d, e = a.target || a.srcElement, f = e.getAttribute("class") || "", g = 0; g < S.length; g++) c = S[g], c.onTap && f.indexOf("pswp__" + c.name) > -1 && (c.onTap(), d = !0);
                if (d) {
                    a.stopPropagation && a.stopPropagation(), r = !0;
                    var h = b.features.isOldAndroid ? 600 : 30;
                    s = setTimeout(function() { r = !1 }, h)
                }
            },
            B = function() { return !a.likelyTouchDevice || q.mouseUsed || screen.width > q.fitControlsWidth },
            C = function(a, c, d) { b[(d ? "add" : "remove") + "Class"](a, "pswp__" + c) },
            D = function() {
                var a = 1 === q.getNumItemsFn();
                a !== p && (C(d, "ui--one-slide", a), p = a)
            },
            E = function() { C(i, "share-modal--hidden", y) },
            F = function() { return y = !y, y ? (b.removeClass(i, "pswp__share-modal--fade-in"), setTimeout(function() { y && E() }, 300)) : (E(), setTimeout(function() { y || b.addClass(i, "pswp__share-modal--fade-in") }, 30)), y || H(), !1 },
            G = function(b) { b = b || window.event; var c = b.target || b.srcElement; return a.shout("shareLinkClick", b, c), !!c.href && (!!c.hasAttribute("download") || (window.open(c.href, "pswp_share", "scrollbars=yes,resizable=yes,toolbar=no,location=yes,width=550,height=420,top=100,left=" + (window.screen ? Math.round(screen.width / 2 - 275) : 100)), y || F(), !1)) },
            H = function() {
                for (var a, b, c, d, e, f = "", g = 0; g < q.shareButtons.length; g++) a = q.shareButtons[g], c = q.getImageURLForShare(a), d = q.getPageURLForShare(a), e = q.getTextForShare(a), b = a.url.replace("{{url}}", encodeURIComponent(d)).replace("{{image_url}}", encodeURIComponent(c)).replace("{{raw_image_url}}", c).replace("{{text}}", encodeURIComponent(e)), f += '<a href="' + b + '" target="_blank" class="pswp__share--' + a.id + '"' + (a.download ? "download" : "") + ">" + a.label + "</a>", q.parseShareButtonOut && (f = q.parseShareButtonOut(a, f));
                i.children[0].innerHTML = f, i.children[0].onclick = G
            },
            I = function(a) {
                for (var c = 0; c < q.closeElClasses.length; c++)
                    if (b.hasClass(a, "pswp__" + q.closeElClasses[c])) return !0
            },
            J = 0,
            K = function() { clearTimeout(u), J = 0, k && v.setIdle(!1) },
            L = function(a) {
                a = a ? a : window.event;
                var b = a.relatedTarget || a.toElement;
                b && "HTML" !== b.nodeName || (clearTimeout(u), u = setTimeout(function() { v.setIdle(!0) }, q.timeToIdleOutside))
            },
            M = function() { q.fullscreenEl && !b.features.isOldAndroid && (c || (c = v.getFullscreenAPI()), c ? (b.bind(document, c.eventK, v.updateFullscreen), v.updateFullscreen(), b.addClass(a.template, "pswp--supports-fs")) : b.removeClass(a.template, "pswp--supports-fs")) },
            N = function() { q.preloaderEl && (O(!0), l("beforeChange", function() { clearTimeout(o), o = setTimeout(function() { a.currItem && a.currItem.loading ? (!a.allowProgressiveImg() || a.currItem.img && !a.currItem.img.naturalWidth) && O(!1) : O(!0) }, q.loadingIndicatorDelay) }), l("imageLoadComplete", function(b, c) { a.currItem === c && O(!0) })) },
            O = function(a) { n !== a && (C(m, "preloader--active", !a), n = a) },
            P = function(a) {
                var c = a.vGap;
                if (B()) {
                    var g = q.barsSize;
                    if (q.captionEl && "auto" === g.bottom)
                        if (f || (f = b.createEl("pswp__caption pswp__caption--fake"), f.appendChild(b.createEl("pswp__caption__center")), d.insertBefore(f, e), b.addClass(d, "pswp__ui--fit")), q.addCaptionHTMLFn(a, f, !0)) {
                            var h = f.clientHeight;
                            c.bottom = parseInt(h, 10) || 44
                        } else c.bottom = g.top;
                    else c.bottom = "auto" === g.bottom ? 0 : g.bottom;
                    c.top = g.top
                } else c.top = c.bottom = 0
            },
            Q = function() { q.timeToIdle && l("mouseUsed", function() { b.bind(document, "mousemove", K), b.bind(document, "mouseout", L), t = setInterval(function() { J++, 2 === J && v.setIdle(!0) }, q.timeToIdle / 2) }) },
            R = function() {
                l("onVerticalDrag", function(a) { x && a < .95 ? v.hideControls() : !x && a >= .95 && v.showControls() });
                var a;
                l("onPinchClose", function(b) { x && b < .9 ? (v.hideControls(), a = !0) : a && !x && b > .9 && v.showControls() }), l("zoomGestureEnded", function() { a = !1, a && !x && v.showControls() })
            },
            S = [{ name: "caption", option: "captionEl", onInit: function(a) { e = a } }, { name: "share-modal", option: "shareEl", onInit: function(a) { i = a }, onTap: function() { F() } }, { name: "button--share", option: "shareEl", onInit: function(a) { h = a }, onTap: function() { F() } }, { name: "button--zoom", option: "zoomEl", onTap: a.toggleDesktopZoom }, { name: "counter", option: "counterEl", onInit: function(a) { g = a } }, { name: "button--close", option: "closeEl", onTap: a.close }, { name: "button--arrow--left", option: "arrowEl", onTap: a.prev }, { name: "button--arrow--right", option: "arrowEl", onTap: a.next }, { name: "button--fs", option: "fullscreenEl", onTap: function() { c.isFullscreen() ? c.exit() : c.enter() } }, { name: "preloader", option: "preloaderEl", onInit: function(a) { m = a } }],
            T = function() {
                var a, c, e, f = function(d) {
                    if (d)
                        for (var f = d.length, g = 0; g < f; g++) { a = d[g], c = a.className; for (var h = 0; h < S.length; h++) e = S[h], c.indexOf("pswp__" + e.name) > -1 && (q[e.option] ? (b.removeClass(a, "pswp__element--disabled"), e.onInit && e.onInit(a)) : b.addClass(a, "pswp__element--disabled")) }
                };
                f(d.children);
                var g = b.getChildByClass(d, "pswp__top-bar");
                g && f(g.children)
            };
        v.init = function() {
            b.extend(a.options, z, !0), q = a.options, d = b.getChildByClass(a.scrollWrap, "pswp__ui"), l = a.listen, R(), l("beforeChange", v.update), l("doubleTap", function(b) {
                var c = a.currItem.initialZoomLevel;
                a.getZoomLevel() !== c ? a.zoomTo(c, b, 333) : a.zoomTo(q.getDoubleTapZoom(!1, a.currItem), b, 333)
            }), l("preventDragEvent", function(a, b, c) {
                var d = a.target || a.srcElement;
                d && d.getAttribute("class") && a.type.indexOf("mouse") > -1 && (d.getAttribute("class").indexOf("__caption") > 0 || /(SMALL|STRONG|EM)/i.test(d.tagName)) && (c.prevent = !1)
            }), l("bindEvents", function() { b.bind(d, "pswpTap click", A), b.bind(a.scrollWrap, "pswpTap", v.onGlobalTap), a.likelyTouchDevice || b.bind(a.scrollWrap, "mouseover", v.onMouseOver) }), l("unbindEvents", function() { y || F(), t && clearInterval(t), b.unbind(document, "mouseout", L), b.unbind(document, "mousemove", K), b.unbind(d, "pswpTap click", A), b.unbind(a.scrollWrap, "pswpTap", v.onGlobalTap), b.unbind(a.scrollWrap, "mouseover", v.onMouseOver), c && (b.unbind(document, c.eventK, v.updateFullscreen), c.isFullscreen() && (q.hideAnimationDuration = 0, c.exit()), c = null) }), l("destroy", function() { q.captionEl && (f && d.removeChild(f), b.removeClass(e, "pswp__caption--empty")), i && (i.children[0].onclick = null), b.removeClass(d, "pswp__ui--over-close"), b.addClass(d, "pswp__ui--hidden"), v.setIdle(!1) }), q.showAnimationDuration || b.removeClass(d, "pswp__ui--hidden"), l("initialZoomIn", function() { q.showAnimationDuration && b.removeClass(d, "pswp__ui--hidden") }), l("initialZoomOut", function() { b.addClass(d, "pswp__ui--hidden") }), l("parseVerticalMargin", P), T(), q.shareEl && h && i && (y = !0), D(), Q(), M(), N()
        }, v.setIdle = function(a) { k = a, C(d, "ui--idle", a) }, v.update = function() { x && a.currItem ? (v.updateIndexIndicator(), q.captionEl && (q.addCaptionHTMLFn(a.currItem, e), C(e, "caption--empty", !a.currItem.title)), w = !0) : w = !1, y || F(), D() }, v.updateFullscreen = function(d) { d && setTimeout(function() { a.setScrollOffset(0, b.getScrollY()) }, 50), b[(c.isFullscreen() ? "add" : "remove") + "Class"](a.template, "pswp--fs") }, v.updateIndexIndicator = function() { q.counterEl && (g.innerHTML = a.getCurrentIndex() + 1 + q.indexIndicatorSep + q.getNumItemsFn()) }, v.onGlobalTap = function(c) {
            c = c || window.event;
            var d = c.target || c.srcElement;
            if (!r)
                if (c.detail && "mouse" === c.detail.pointerType) {
                    if (I(d)) return void a.close();
                    b.hasClass(d, "pswp__img") && (1 === a.getZoomLevel() && a.getZoomLevel() <= a.currItem.fitRatio ? q.clickToCloseNonZoomable && a.close() : a.toggleDesktopZoom(c.detail.releasePoint))
                } else if (q.tapToToggleControls && (x ? v.hideControls() : v.showControls()), q.tapToClose && (b.hasClass(d, "pswp__img") || I(d))) return void a.close()
        }, v.onMouseOver = function(a) {
            a = a || window.event;
            var b = a.target || a.srcElement;
            C(d, "ui--over-close", I(b))
        }, v.hideControls = function() { b.addClass(d, "pswp__ui--hidden"), x = !1 }, v.showControls = function() { x = !0, w || v.update(), b.removeClass(d, "pswp__ui--hidden") }, v.supportsFullscreen = function() { var a = document; return !!(a.exitFullscreen || a.mozCancelFullScreen || a.webkitExitFullscreen || a.msExitFullscreen) }, v.getFullscreenAPI = function() {
            var b, c = document.documentElement,
                d = "fullscreenchange";
            return c.requestFullscreen ? b = { enterK: "requestFullscreen", exitK: "exitFullscreen", elementK: "fullscreenElement", eventK: d } : c.mozRequestFullScreen ? b = { enterK: "mozRequestFullScreen", exitK: "mozCancelFullScreen", elementK: "mozFullScreenElement", eventK: "moz" + d } : c.webkitRequestFullscreen ? b = { enterK: "webkitRequestFullscreen", exitK: "webkitExitFullscreen", elementK: "webkitFullscreenElement", eventK: "webkit" + d } : c.msRequestFullscreen && (b = { enterK: "msRequestFullscreen", exitK: "msExitFullscreen", elementK: "msFullscreenElement", eventK: "MSFullscreenChange" }), b && (b.enter = function() { return j = q.closeOnScroll, q.closeOnScroll = !1, "webkitRequestFullscreen" !== this.enterK ? a.template[this.enterK]() : void a.template[this.enterK](Element.ALLOW_KEYBOARD_INPUT) }, b.exit = function() { return q.closeOnScroll = j, document[this.exitK]() }, b.isFullscreen = function() { return document[this.elementK] }), b
        }
    };
    return a
});

/*!
	Zoom 1.7.21
	license: MIT
	http://www.jacklmoore.com/zoom
*/
(function(o) {
    var t = { url: !1, callback: !1, target: !1, duration: 120, on: "mouseover", touch: !0, onZoomIn: !1, onZoomOut: !1, magnify: 1 };
    o.zoom = function(t, n, e, i) {
        var u, c, a, r, m, l, s, f = o(t),
            h = f.css("position"),
            d = o(n);
        return t.style.position = /(absolute|fixed)/.test(h) ? h : "relative", t.style.overflow = "hidden", e.style.width = e.style.height = "", o(e).addClass("zoomImg").css({ position: "absolute", top: 0, left: 0, opacity: 0, width: e.width * i, height: e.height * i, border: "none", maxWidth: "none", maxHeight: "none" }).appendTo(t), {
            init: function() { c = f.outerWidth(), u = f.outerHeight(), n === t ? (r = c, a = u) : (r = d.outerWidth(), a = d.outerHeight()), m = (e.width - c) / r, l = (e.height - u) / a, s = d.offset() },
            move: function(o) {
                var t = o.pageX - s.left,
                    n = o.pageY - s.top;
                n = Math.max(Math.min(n, a), 0), t = Math.max(Math.min(t, r), 0), e.style.left = t * -m + "px", e.style.top = n * -l + "px"
            }
        }
    }, o.fn.zoom = function(n) {
        return this.each(function() {
            var e = o.extend({}, t, n || {}),
                i = e.target && o(e.target)[0] || this,
                u = this,
                c = o(u),
                a = document.createElement("img"),
                r = o(a),
                m = "mousemove.zoom",
                l = !1,
                s = !1;
            if (!e.url) { var f = u.querySelector("img"); if (f && (e.url = f.getAttribute("data-src") || f.currentSrc || f.src), !e.url) return }
            c.one("zoom.destroy", function(o, t) { c.off(".zoom"), i.style.position = o, i.style.overflow = t, a.onload = null, r.remove() }.bind(this, i.style.position, i.style.overflow)), a.onload = function() {
                function t(t) { f.init(), f.move(t), r.stop().fadeTo(o.support.opacity ? e.duration : 0, 1, o.isFunction(e.onZoomIn) ? e.onZoomIn.call(a) : !1) }

                function n() { r.stop().fadeTo(e.duration, 0, o.isFunction(e.onZoomOut) ? e.onZoomOut.call(a) : !1) }
                var f = o.zoom(i, u, a, e.magnify);
                "grab" === e.on ? c.on("mousedown.zoom", function(e) { 1 === e.which && (o(document).one("mouseup.zoom", function() { n(), o(document).off(m, f.move) }), t(e), o(document).on(m, f.move), e.preventDefault()) }) : "click" === e.on ? c.on("click.zoom", function(e) { return l ? void 0 : (l = !0, t(e), o(document).on(m, f.move), o(document).one("click.zoom", function() { n(), l = !1, o(document).off(m, f.move) }), !1) }) : "toggle" === e.on ? c.on("click.zoom", function(o) { l ? n() : t(o), l = !l }) : "mouseover" === e.on && (f.init(), c.on("mouseenter.zoom", t).on("mouseleave.zoom", n).on(m, f.move)), e.touch && c.on("touchstart.zoom", function(o) { o.preventDefault(), s ? (s = !1, n()) : (s = !0, t(o.originalEvent.touches[0] || o.originalEvent.changedTouches[0])) }).on("touchmove.zoom", function(o) { o.preventDefault(), f.move(o.originalEvent.touches[0] || o.originalEvent.changedTouches[0]) }).on("touchend.zoom", function(o) { o.preventDefault(), s && (s = !1, n()) }), o.isFunction(e.callback) && e.callback.call(a)
            }, a.setAttribute("role", "presentation"), a.alt = "", a.src = e.url
        })
    }, o.fn.zoom.defaults = t
})(window.jQuery);





function floatToString(t, r) { var e = t.toFixed(r).toString(); return e.match(/^\.\d+/) ? "0" + e : e }

function attributeToString(t) { return "string" != typeof t && "undefined" === (t += "") && (t = ""), jQuery.trim(t) }
"undefined" == typeof window.Shopify && (window.Shopify = {}), Shopify.money_format = "${{amount}}", Shopify.onError = function(t, r) {
    var e = eval("(" + t.responseText + ")");
    e.message ? alert(e.message + "(" + e.status + "): " + e.description) : alert("Error : " + Shopify.fullMessagesFromErrors(e).join("; ") + ".")
}, Shopify.fullMessagesFromErrors = function(t) { var o = []; return jQuery.each(t, function(e, t) { jQuery.each(t, function(t, r) { o.push(e + " " + r) }) }), o }, Shopify.onCartUpdate = function(t) { alert("There are now " + t.item_count + " items in the cart.") }, Shopify.onCartShippingRatesUpdate = function(t, r) {
    var e = "";
    r.zip && (e += r.zip + ", "), r.province && (e += r.province + ", "), e += r.country, alert("There are " + t.length + " shipping rates available for " + e + ", starting at " + Shopify.formatMoney(t[0].price) + ".")
}, Shopify.onItemAdded = function(t) { alert(t.title + " was added to your shopping cart.") }, Shopify.onProduct = function(t) { alert("Received everything we ever wanted to know about " + t.title) }, Shopify.formatMoney = function(t, r) {
    function n(t, r) { return void 0 === t ? r : t }

    function e(t, r, e, o) { if (r = n(r, 2), e = n(e, ","), o = n(o, "."), isNaN(t) || null == t) return 0; var a = (t = (t / 100).toFixed(r)).split("."); return a[0].replace(/(\d)(?=(\d\d\d)+(?!\d))/g, "$1" + e) + (a[1] ? o + a[1] : "") }
    "string" == typeof t && (t = t.replace(".", ""));
    var o = "",
        a = /\{\{\s*(\w+)\s*\}\}/,
        i = r || this.money_format;
    switch (i.match(a)[1]) {
        case "amount":
            o = e(t, 2);
            break;
        case "amount_no_decimals":
            o = e(t, 0);
            break;
        case "amount_with_comma_separator":
            o = e(t, 2, ".", ",");
            break;
        case "amount_with_space_separator":
            o = e(t, 2, " ", ",");
            break;
        case "amount_with_period_and_space_separator":
            o = e(t, 2, " ", ".");
            break;
        case "amount_no_decimals_with_comma_separator":
            o = e(t, 0, ".", ",");
            break;
        case "amount_no_decimals_with_space_separator":
            o = e(t, 0, ".", "");
            break;
        case "amount_with_space_separator":
            o = e(t, 2, ",", "");
            break;
        case "amount_with_apostrophe_separator":
            o = e(t, 2, "'", ".")
    }
    return i.replace(a, o)
}, Shopify.resizeImage = function(t, r) { try { if ("original" == r) return t; var e = t.match(/(.*\/[\w\-\_\.]+)\.(\w{2,4})/); return e[1] + "_" + r + "." + e[2] } catch (o) { return t } }, Shopify.addItem = function(t, r, e) {
    var o = { type: "POST", url: "/cart/add.js", data: "quantity=" + (r = r || 1) + "&id=" + t, dataType: "json", success: function(t) { "function" == typeof e ? e(t) : Shopify.onItemAdded(t) }, error: function(t, r) { Shopify.onError(t, r) } };
    jQuery.ajax(o)
}, Shopify.addItemFromForm = function(t, r) {
    var e = { type: "POST", url: "/cart/add.js", data: jQuery("#" + t).serialize(), dataType: "json", success: function(t) { "function" == typeof r ? r(t) : Shopify.onItemAdded(t) }, error: function(t, r) { Shopify.onError(t, r) } };
    jQuery.ajax(e)
}, Shopify.getCart = function(r) { jQuery.getJSON("/cart.js", function(t) { "function" == typeof r ? r(t) : Shopify.onCartUpdate(t) }) }, Shopify.pollForCartShippingRatesForDestination = function(o, a, t) { t = t || Shopify.onError; var n = function() { jQuery.ajax("/cart/async_shipping_rates", { dataType: "json", success: function(t, r, e) { 200 === e.status ? "function" == typeof a ? a(t.shipping_rates, o) : Shopify.onCartShippingRatesUpdate(t.shipping_rates, o) : setTimeout(n, 500) }, error: t }) }; return n }, Shopify.getCartShippingRatesForDestination = function(t, r, e) {
    e = e || Shopify.onError;
    var o = { type: "POST", url: "/cart/prepare_shipping_rates", data: Shopify.param({ shipping_address: t }), success: Shopify.pollForCartShippingRatesForDestination(t, r, e), error: e };
    jQuery.ajax(o)
}, Shopify.getProduct = function(t, r) { jQuery.getJSON("/products/" + t + ".js", function(t) { "function" == typeof r ? r(t) : Shopify.onProduct(t) }) }, Shopify.changeItem = function(t, r, e) {
    var o = { type: "POST", url: "/cart/change.js", data: "quantity=" + r + "&id=" + t, dataType: "json", success: function(t) { "function" == typeof e ? e(t) : Shopify.onCartUpdate(t) }, error: function(t, r) { Shopify.onError(t, r) } };
    jQuery.ajax(o)
}, Shopify.removeItem = function(t, r) {
    var e = { type: "POST", url: "/cart/change.js", data: "quantity=0&id=" + t, dataType: "json", success: function(t) { "function" == typeof r ? r(t) : Shopify.onCartUpdate(t) }, error: function(t, r) { Shopify.onError(t, r) } };
    jQuery.ajax(e)
}, Shopify.clear = function(r) {
    var t = { type: "POST", url: "/cart/clear.js", data: "", dataType: "json", success: function(t) { "function" == typeof r ? r(t) : Shopify.onCartUpdate(t) }, error: function(t, r) { Shopify.onError(t, r) } };
    jQuery.ajax(t)
}, Shopify.updateCartFromForm = function(t, r) {
    var e = { type: "POST", url: "/cart/update.js", data: jQuery("#" + t).serialize(), dataType: "json", success: function(t) { "function" == typeof r ? r(t) : Shopify.onCartUpdate(t) }, error: function(t, r) { Shopify.onError(t, r) } };
    jQuery.ajax(e)
}, Shopify.updateCartAttributes = function(t, r) {
    var o = "";
    jQuery.isArray(t) ? jQuery.each(t, function(t, r) { var e = attributeToString(r.key); "" !== e && (o += "attributes[" + e + "]=" + attributeToString(r.value) + "&") }) : "object" == typeof t && null !== t && jQuery.each(t, function(t, r) { o += "attributes[" + attributeToString(t) + "]=" + attributeToString(r) + "&" });
    var e = { type: "POST", url: "/cart/update.js", data: o, dataType: "json", success: function(t) { "function" == typeof r ? r(t) : Shopify.onCartUpdate(t) }, error: function(t, r) { Shopify.onError(t, r) } };
    jQuery.ajax(e)
}, Shopify.updateCartNote = function(t, r) {
    var e = { type: "POST", url: "/cart/update.js", data: "note=" + attributeToString(t), dataType: "json", success: function(t) { "function" == typeof r ? r(t) : Shopify.onCartUpdate(t) }, error: function(t, r) { Shopify.onError(t, r) } };
    jQuery.ajax(e)
}, "1.4" <= jQuery.fn.jquery ? Shopify.param = jQuery.param : (Shopify.param = function(t) {
    var e = [],
        r = function(t, r) { r = jQuery.isFunction(r) ? r() : r, e[e.length] = encodeURIComponent(t) + "=" + encodeURIComponent(r) };
    if (jQuery.isArray(t) || t.jquery) jQuery.each(t, function() { r(this.name, this.value) });
    else
        for (var o in t) Shopify.buildParams(o, t[o], r);
    return e.join("&").replace(/%20/g, "+")
}, Shopify.buildParams = function(e, t, o) { jQuery.isArray(t) && t.length ? jQuery.each(t, function(t, r) { rbracket.test(e) ? o(e, r) : Shopify.buildParams(e + "[" + ("object" == typeof r || jQuery.isArray(r) ? t : "") + "]", r, o) }) : null != t && "object" == typeof t ? Shopify.isEmptyObject(t) ? o(e, "") : jQuery.each(t, function(t, r) { Shopify.buildParams(e + "[" + t + "]", r, o) }) : o(e, t) }, Shopify.isEmptyObject = function(t) { for (var r in t) return !1; return !0 });










/** Shopify CDN: Minification failed

Line 3891:6 Transforming let to the configured target environment ("es5") is not supported yet
Line 3892:6 Transforming let to the configured target environment ("es5") is not supported yet
Line 4263:7 Transforming let to the configured target environment ("es5") is not supported yet
Line 4745:4 Transforming let to the configured target environment ("es5") is not supported yet

**/
window.theme = window.theme || {};
window.slate = window.slate || {};

/* ================ SLATE ================ */
theme.Sections = function Sections() {
    this.constructors = {};
    this.instances = [];

    $(document)
        .on('shopify:section:load', this._onSectionLoad.bind(this))
        .on('shopify:section:unload', this._onSectionUnload.bind(this))
        .on('shopify:section:select', this._onSelect.bind(this))
        .on('shopify:section:deselect', this._onDeselect.bind(this))
        .on('shopify:block:select', this._onBlockSelect.bind(this))
        .on('shopify:block:deselect', this._onBlockDeselect.bind(this));
};

theme.Sections.prototype = _.assignIn({}, theme.Sections.prototype, {
    _createInstance: function(container, constructor) {
        var $container = $(container);
        var id = $container.attr('data-section-id');
        var type = $container.attr('data-section-type');

        constructor = constructor || this.constructors[type];

        if (_.isUndefined(constructor)) {
            return;
        }

        var instance = _.assignIn(new constructor(container), {
            id: id,
            type: type,
            container: container
        });

        this.instances.push(instance);
    },

    _onSectionLoad: function(evt) {
        var container = $('[data-section-id]', evt.target)[0];
        if (container) {
            this._createInstance(container);
        }
        if (AOS) {
            AOS.refreshHard();
        }
    },
    _loadSubSections: function() {
        if (AOS) {
            AOS.refreshHard();
        }
    },
    _onSectionUnload: function(evt) {
        this.instances = _.filter(this.instances, function(instance) {
            var isEventInstance = instance.id === evt.detail.sectionId;

            if (isEventInstance) {
                if (_.isFunction(instance.onUnload)) {
                    instance.onUnload(evt);
                }
            }

            return !isEventInstance;
        });
    },

    _onSelect: function(evt) {
        // eslint-disable-next-line no-shadow
        var instance = _.find(this.instances, function(instance) {
            return instance.id === evt.detail.sectionId;
        });

        if (!_.isUndefined(instance) && _.isFunction(instance.onSelect)) {
            instance.onSelect(evt);
        }
    },

    _onDeselect: function(evt) {
        // eslint-disable-next-line no-shadow
        var instance = _.find(this.instances, function(instance) {
            return instance.id === evt.detail.sectionId;
        });

        if (!_.isUndefined(instance) && _.isFunction(instance.onDeselect)) {
            instance.onDeselect(evt);
        }
    },

    _onBlockSelect: function(evt) {
        // eslint-disable-next-line no-shadow
        var instance = _.find(this.instances, function(instance) {
            return instance.id === evt.detail.sectionId;
        });

        if (!_.isUndefined(instance) && _.isFunction(instance.onBlockSelect)) {
            instance.onBlockSelect(evt);
        }
    },

    _onBlockDeselect: function(evt) {
        // eslint-disable-next-line no-shadow
        var instance = _.find(this.instances, function(instance) {
            return instance.id === evt.detail.sectionId;
        });

        if (!_.isUndefined(instance) && _.isFunction(instance.onBlockDeselect)) {
            instance.onBlockDeselect(evt);
        }
    },

    register: function(type, constructor) {
        this.constructors[type] = constructor;

        $('[data-section-type=' + type + ']').each(
            function(index, container) {
                this._createInstance(container, constructor);
            }.bind(this)
        );
    }
});

window.slate = window.slate || {};

/**
 * iFrames
 * -----------------------------------------------------------------------------
 * Wrap videos in div to force responsive layout.
 *
 * @namespace iframes
 */

slate.rte = {
    wrapTable: function() {
        $('.rte table').wrap('<div class="rte__table-wrapper"></div>');
    },

    iframeReset: function() {
        var $iframeVideo = $(
            '.rte iframe[src*="youtube.com/embed"], .rte iframe[src*="player.vimeo"]'
        );
        var $iframeReset = $iframeVideo.add('.rte iframe#admin_bar_iframe');

        $iframeVideo.each(function() {
            // Add wrapper to make video responsive
            $(this).wrap('<div class="video-wrapper"></div>');
        });

        $iframeReset.each(function() {
            // Re-set the src attribute on each iframe after page load
            // for Chrome's "incorrect iFrame content on 'back'" bug.
            // https://code.google.com/p/chromium/issues/detail?id=395791
            // Need to specifically target video and admin bar
            this.src = this.src;
        });
    }
};

window.slate = window.slate || {};

/**
 * A11y Helpers
 * -----------------------------------------------------------------------------
 * A collection of useful functions that help make your theme more accessible
 * to users with visual impairments.
 *
 *
 * @namespace a11y
 */

slate.a11y = {
    /**
     * For use when focus shifts to a container rather than a link
     * eg for In-page links, after scroll, focus shifts to content area so that
     * next `tab` is where user expects if focusing a link, just $link.focus();
     *
     * @param {JQuery} $element - The element to be acted upon
     */
    pageLinkFocus: function($element) {
        var focusClass = 'js-focus-hidden';

        $element
            .first()
            .attr('tabIndex', '-1')
            .focus()
            .addClass(focusClass)
            .one('blur', callback);

        function callback() {
            $element
                .first()
                .removeClass(focusClass)
                .removeAttr('tabindex');
        }
    },

    /**
     * If there's a hash in the url, focus the appropriate element
     */
    focusHash: function() {
        var hash = window.location.hash;

        // is there a hash in the url? is it an element on the page?
        if (hash && document.getElementById(hash.slice(1))) {
            this.pageLinkFocus($(hash));
        }
    },

    /**
     * When an in-page (url w/hash) link is clicked, focus the appropriate element
     */
    bindInPageLinks: function() {
        $('a[href*=#]').on(
            'click',
            function(evt) {
                this.pageLinkFocus($(evt.currentTarget.hash));
            }.bind(this)
        );
    },

    /**
     * Traps the focus in a particular container
     *
     * @param {object} options - Options to be used
     * @param {jQuery} options.$container - Container to trap focus within
     * @param {jQuery} options.$elementToFocus - Element to be focused when focus leaves container
     * @param {string} options.namespace - Namespace used for new focus event handler
     */
    trapFocus: function(options) {
        var eventName = options.namespace ?
            'focusin.' + options.namespace :
            'focusin';

        if (!options.$elementToFocus) {
            options.$elementToFocus = options.$container;
        }

        options.$container.attr('tabindex', '-1');
        options.$elementToFocus.focus();

        $(document).on(eventName, function(evt) {
            if (
                options.$container[0] !== evt.target &&
                !options.$container.has(evt.target).length
            ) {
                options.$container.focus();
            }
        });
    },

    /**
     * Removes the trap of focus in a particular container
     *
     * @param {object} options - Options to be used
     * @param {jQuery} options.$container - Container to trap focus within
     * @param {string} options.namespace - Namespace used for new focus event handler
     */
    removeTrapFocus: function(options) {
        var eventName = options.namespace ?
            'focusin.' + options.namespace :
            'focusin';

        if (options.$container && options.$container.length) {
            options.$container.removeAttr('tabindex');
        }

        $(document).off(eventName);
    }
};

/**
 * Currency Helpers
 * -----------------------------------------------------------------------------
 * A collection of useful functions that help with currency formatting
 *
 * Current contents
 * - formatMoney - Takes an amount in cents and returns it as a formatted dollar value.
 *
 * Alternatives
 * - Accounting.js - http://openexchangerates.github.io/accounting.js/
 *
 */

theme.Currency = (function() {
    var moneyFormat = '${{amount}}'; // eslint-disable-line camelcase

    function formatMoney(cents, format) {
        if (typeof cents === 'string') {
            cents = cents.replace('.', '');
        }
        var value = '';
        var placeholderRegex = /\{\{\s*(\w+)\s*\}\}/;
        var formatString = format || moneyFormat;

        function formatWithDelimiters(number, precision, thousands, decimal) {
            thousands = thousands || ',';
            decimal = decimal || '.';

            if (isNaN(number) || number === null) {
                return 0;
            }

            number = (number / 100.0).toFixed(precision);

            var parts = number.split('.');
            var dollarsAmount = parts[0].replace(
                /(\d)(?=(\d\d\d)+(?!\d))/g,
                '$1' + thousands
            );
            var centsAmount = parts[1] ? decimal + parts[1] : '';

            return dollarsAmount + centsAmount;
        }

        switch (formatString.match(placeholderRegex)[1]) {
            case 'amount':
                value = formatWithDelimiters(cents, 2);
                break;
            case 'amount_no_decimals':
                value = formatWithDelimiters(cents, 0);
                break;
            case 'amount_with_comma_separator':
                value = formatWithDelimiters(cents, 2, '.', ',');
                break;
            case 'amount_no_decimals_with_comma_separator':
                value = formatWithDelimiters(cents, 0, '.', ',');
                break;
            case 'amount_no_decimals_with_space_separator':
                value = formatWithDelimiters(cents, 0, ' ');
                break;
            case 'amount_with_apostrophe_separator':
                value = formatWithDelimiters(cents, 2, "'");
                break;
        }
        return formatString.replace(placeholderRegex, value);
    }

    return {
        formatMoney: formatMoney
    };
})();

/**
 * Image Helper Functions
 * -----------------------------------------------------------------------------
 * A collection of functions that help with basic image operations.
 *
 */

theme.Images = (function() {
    /**
     * Preloads an image in memory and uses the browsers cache to store it until needed.
     *
     * @param {Array} images - A list of image urls
     * @param {String} size - A shopify image size attribute
     */

    function preload(images, size) {
        if (typeof images === 'string') {
            images = [images];
        }

        for (var i = 0; i < images.length; i++) {
            var image = images[i];
            this.loadImage(this.getSizedImageUrl(image, size));
        }
    }

    /**
     * Loads and caches an image in the browsers cache.
     * @param {string} path - An image url
     */
    function loadImage(path) {
        new Image().src = path;
    }

    /**
     * Swaps the src of an image for another OR returns the imageURL to the callback function
     * @param image
     * @param element
     * @param callback
     */
    function switchImage(image, element, callback) {
        var size = this.imageSize(element.src);
        var imageUrl = this.getSizedImageUrl(image.src, size);

        if (callback) {
            callback(imageUrl, image, element); // eslint-disable-line callback-return
        } else {
            element.src = imageUrl;
        }
    }

    /**
     * +++ Useful
     * Find the Shopify image attribute size
     *
     * @param {string} src
     * @returns {null}
     */
    function imageSize(src) {
        src = src || '';

        var match = src.match(
            /.+_((?:pico|icon|thumb|small|compact|medium|large|grande)|\d{1,4}x\d{0,4}|x\d{1,4})[_\\.@]/
        );

        if (match === null) {
            return null;
        } else {
            return match[1];
        }
    }

    /**
     * +++ Useful
     * Adds a Shopify size attribute to a URL
     *
     * @param src
     * @param size
     * @returns {*}
     */
    function getSizedImageUrl(src, size) {
        if (size === null) {
            return src;
        }

        if (size === 'master') {
            return this.removeProtocol(src);
        }

        var match = src.match(
            /\.(jpg|jpeg|gif|png|bmp|bitmap|tiff|tif)(\?v=\d+)?$/i
        );

        if (match !== null) {
            var prefix = src.split(match[0]);
            var suffix = match[0];

            return this.removeProtocol(prefix[0] + '_' + size + suffix);
        }

        return null;
    }

    function removeProtocol(path) {
        return path.replace(/http(s)?:/, '');
    }

    return {
        preload: preload,
        loadImage: loadImage,
        switchImage: switchImage,
        imageSize: imageSize,
        getSizedImageUrl: getSizedImageUrl,
        removeProtocol: removeProtocol
    };
})();

/**
 * Variant Selection scripts
 * ------------------------------------------------------------------------------
 *
 * Handles change events from the variant inputs in any `cart/add` forms that may
 * exist.  Also updates the master select and triggers updates when the variants
 * price or image changes.
 *
 * @namespace variants
 */

slate.Variants = (function() {
    /**
     * Variant constructor
     *
     * @param {object} options - Settings from `product.js`
     */
    function Variants(options) {
        this.$container = options.$container;
        this.product = options.product;
        this.singleOptionSelector = options.singleOptionSelector;
        this.originalSelectorId = options.originalSelectorId;
        this.enableHistoryState = options.enableHistoryState;
        this.currentVariant = this._getVariantFromOptions();

        $(this.singleOptionSelector, this.$container).on(
            'change',
            this._onSelectChange.bind(this)
        );
    }

    Variants.prototype = _.assignIn({}, Variants.prototype, {
        /**
         * Get the currently selected options from add-to-cart form. Works with all
         * form input elements.
         *
         * @return {array} options - Values of currently selected variants
         */
        _getCurrentOptions: function() {
            var currentOptions = _.map(
                $(this.singleOptionSelector, this.$container),
                function(element) {
                    var $element = $(element);
                    var type = $element.attr('type');
                    var currentOption = {};

                    if (type === 'radio' || type === 'checkbox') {
                        if ($element[0].checked) {
                            currentOption.value = $element.val();
                            currentOption.index = $element.data('index');

                            return currentOption;
                        } else {
                            return false;
                        }
                    } else {
                        currentOption.value = $element.val();
                        currentOption.index = $element.data('index');

                        return currentOption;
                    }
                }
            );

            // remove any unchecked input values if using radio buttons or checkboxes
            currentOptions = _.compact(currentOptions);

            return currentOptions;
        },

        /**
         * Find variant based on selected values.
         *
         * @param  {array} selectedValues - Values of variant inputs
         * @return {object || undefined} found - Variant object from product.variants
         */
        _getVariantFromOptions: function() {
            var selectedValues = this._getCurrentOptions();
            var variants = this.product.variants;

            var found = _.find(variants, function(variant) {
                return selectedValues.every(function(values) {
                    return _.isEqual(variant[values.index], values.value);
                });
            });

            return found;
        },

        /**
         * Event handler for when a variant input changes.
         */
        _onSelectChange: function() {
            var variant = this._getVariantFromOptions();

            this.$container.trigger({
                type: 'variantChange',
                variant: variant
            });

            if (!variant) {
                return;
            }

            this._updateMasterSelect(variant);
            this._updateImages(variant);
            this._updatePrice(variant);
            this._updateSKU(variant);
            this.currentVariant = variant;

            if (this.enableHistoryState) {
                this._updateHistoryState(variant);
            }
        },

        /**
         * Trigger event when variant image changes
         *
         * @param  {object} variant - Currently selected variant
         * @return {event}  variantImageChange
         */
        _updateImages: function(variant) {
            var variantImage = variant.featured_image || {};
            var currentVariantImage = this.currentVariant.featured_image || {};

            if (!variant.featured_image ||
                variantImage.src === currentVariantImage.src
            ) {
                return;
            }

            this.$container.trigger({
                type: 'variantImageChange',
                variant: variant
            });
        },

        /**
         * Trigger event when variant price changes.
         *
         * @param  {object} variant - Currently selected variant
         * @return {event} variantPriceChange
         */
        _updatePrice: function(variant) {
            if (
                variant.price === this.currentVariant.price &&
                variant.compare_at_price === this.currentVariant.compare_at_price
            ) {
                return;
            }

            this.$container.trigger({
                type: 'variantPriceChange',
                variant: variant
            });
        },

        /**
         * Trigger event when variant sku changes.
         *
         * @param  {object} variant - Currently selected variant
         * @return {event} variantSKUChange
         */
        _updateSKU: function(variant) {
            if (variant.sku === this.currentVariant.sku) {
                return;
            }

            this.$container.trigger({
                type: 'variantSKUChange',
                variant: variant
            });
        },

        /**
         * Update history state for product deeplinking
         *
         * @param  {variant} variant - Currently selected variant
         * @return {k}         [description]
         */
        _updateHistoryState: function(variant) {
            if (!history.replaceState || !variant) {
                return;
            }

            var newurl =
                window.location.protocol +
                '//' +
                window.location.host +
                window.location.pathname +
                '?variant=' +
                variant.id;
            window.history.replaceState({ path: newurl }, '', newurl);
        },

        /**
         * Update hidden master select of variant change
         *
         * @param  {variant} variant - Currently selected variant
         */
        _updateMasterSelect: function(variant) {
            $(this.originalSelectorId, this.$container).val(variant.id);
        }
    });

    return Variants;
})();


/*================ MODULES ================*/
window.Drawers = (function() {
    var Drawer = function(id, position, options) {
        var defaults = {
            close: '.js-drawer-close',
            open: '.js-drawer-open-' + position,
            openClass: 'js-drawer-open',
            dirOpenClass: 'js-drawer-open-' + position
        };

        this.nodes = {
            $parent: $('body, html'),
            $page: $('.page-element'),
            $moved: $('.is-moved-by-drawer')
        };

        this.config = $.extend(defaults, options);
        this.position = position;

        this.$drawer = $('#' + id);
        this.$open = $(this.config.open);

        if (!this.$drawer.length) {
            return false;
        }

        this.drawerIsOpen = false;
        this.init();
    };

    Drawer.prototype.init = function() {
        this.$open.attr('aria-expanded', 'false');
        this.$open.on('click', $.proxy(this.open, this));
        this.$drawer.find(this.config.close).on('click', $.proxy(this.close, this));
    };

    Drawer.prototype.open = function(evt) {
        // Keep track if drawer was opened from a click, or called by another function
        var externalCall = false;

        // don't open an opened drawer
        if (this.drawerIsOpen) {
            return;
        }

        this.$open.addClass(this.config.openClass);

        // Prevent following href if link is clicked
        if (evt) {
            evt.preventDefault();
        } else {
            externalCall = true;
        }

        // Without this, the drawer opens, the click event bubbles up to $nodes.page
        // which closes the drawer.
        if (evt && evt.stopPropagation) {
            evt.stopPropagation();
            // save the source of the click, we'll focus to this on close
            this.$activeSource = $(evt.currentTarget);
        }

        if (this.drawerIsOpen && !externalCall) {
            return this.close();
        }

        // Add is-transitioning class to moved elements on open so drawer can have
        // transition for close animation
        this.nodes.$moved.addClass('is-transitioning');
        this.$drawer.prepareTransition();

        this.nodes.$parent.addClass(
            this.config.openClass + ' ' + this.config.dirOpenClass
        );
        this.drawerIsOpen = true;

        // Set focus on drawer
        slate.a11y.trapFocus({
            $container: this.$drawer,
            namespace: 'drawer_focus'
        });

        // Run function when draw opens if set
        if (
            this.config.onDrawerOpen &&
            typeof this.config.onDrawerOpen === 'function'
        ) {
            if (!externalCall) {
                this.config.onDrawerOpen();
            }
        }

        if (this.$activeSource && this.$activeSource.attr('aria-expanded')) {
            this.$activeSource.attr('aria-expanded', 'true');
        }

        this.bindEvents();
    };

    Drawer.prototype.close = function() {
        // don't close a closed drawer
        if (!this.drawerIsOpen) {
            return;
        }

        this.$open.removeClass(this.config.openClass);

        // deselect any focused form elements
        $(document.activeElement).trigger('blur');

        // Ensure closing transition is applied to moved elements, like the nav
        this.nodes.$moved.prepareTransition({ disableExisting: true });
        this.$drawer.prepareTransition({ disableExisting: true });

        this.nodes.$parent.removeClass(
            this.config.dirOpenClass + ' ' + this.config.openClass
        );

        this.drawerIsOpen = false;

        // Remove focus on drawer
        slate.a11y.removeTrapFocus({
            $container: this.$drawer,
            namespace: 'drawer_focus'
        });

        if (this.$activeSource && this.$activeSource.attr('aria-expanded')) {
            this.$activeSource.attr('aria-expanded', 'false');
        }

        this.unbindEvents();
    };

    Drawer.prototype.bindEvents = function() {
        // Lock scrolling on mobile
        this.nodes.$page.on('touchmove.drawer', function() {
            return false;
        });

        // Clicking out of drawer closes it
        this.nodes.$page.on(
            'click.drawer',
            $.proxy(function() {
                this.close();
                return false;
            }, this)
        );

        // Pressing escape closes drawer
        this.nodes.$parent.on(
            'keyup.drawer',
            $.proxy(function(evt) {
                if (evt.keyCode === 27) {
                    this.close();
                }
            }, this)
        );
    };

    Drawer.prototype.unbindEvents = function() {
        this.nodes.$page.off('.drawer');
        this.nodes.$parent.off('.drawer');
    };

    return Drawer;
})();

window.Modals = (function() {
    var Modal = function(id, name, options) {
        var defaults = {
            close: '.js-modal-close',
            open: '.js-modal-open-' + name,
            openClass: 'modal--is-active'
        };

        this.$modal = $('#' + id);

        if (!this.$modal.length) {
            return false;
        }

        this.nodes = {
            $body: $('body')
        };

        this.config = $.extend(defaults, options);

        this.modalIsOpen = false;
        this.$focusOnOpen = this.config.focusOnOpen ?
            $(this.config.focusOnOpen) :
            this.$modal;
        this.init();
    };

    Modal.prototype.init = function() {
        var $openBtn = $(this.config.open);

        // Add aria controls
        $openBtn.attr('aria-expanded', 'false');

        $(this.config.open).on('click', $.proxy(this.open, this));
        this.$modal.find(this.config.close).on('click', $.proxy(this.close, this));
    };

    Modal.prototype.open = function(evt) {
        // Keep track if modal was opened from a click, or called by another function
        var externalCall = false;

        // don't open an opened modal
        if (this.modalIsOpen) {
            return;
        }

        // Prevent following href if link is clicked
        if (evt) {
            evt.preventDefault();
        } else {
            externalCall = true;
        }

        // Without this, the modal opens, the click event bubbles up to $nodes.page
        // which closes the modal.
        if (evt && evt.stopPropagation) {
            evt.stopPropagation();
            // save the source of the click, we'll focus to this on close
            this.$activeSource = $(evt.currentTarget);
        }

        if (this.modalIsOpen && !externalCall) {
            return this.close();
        }

        this.$modal.prepareTransition().addClass(this.config.openClass);
        this.nodes.$body.addClass(this.config.openClass);

        this.modalIsOpen = true;

        // Set focus on modal
        slate.a11y.trapFocus({
            $container: this.$modal,
            namespace: 'modal_focus',
            $elementToFocus: this.$focusOnOpen
        });

        if (this.$activeSource && this.$activeSource.attr('aria-expanded')) {
            this.$activeSource.attr('aria-expanded', 'true');
        }

        this.bindEvents();
    };

    Modal.prototype.close = function() {
        // don't close a closed modal
        if (!this.modalIsOpen) {
            return;
        }

        // deselect any focused form elements
        $(document.activeElement).trigger('blur');

        this.$modal.prepareTransition().removeClass(this.config.openClass);
        this.nodes.$body.removeClass(this.config.openClass);

        this.modalIsOpen = false;

        // Remove focus on modal
        slate.a11y.removeTrapFocus({
            $container: this.$modal,
            namespace: 'modal_focus'
        });

        if (this.$activeSource && this.$activeSource.attr('aria-expanded')) {
            this.$activeSource.attr('aria-expanded', 'false').focus();
        }

        this.unbindEvents();
    };

    Modal.prototype.bindEvents = function() {
        // Pressing escape closes modal
        this.nodes.$body.on(
            'keyup.modal',
            $.proxy(function(evt) {
                if (evt.keyCode === 27) {
                    this.close();
                }
            }, this)
        );
    };

    Modal.prototype.unbindEvents = function() {
        this.nodes.$body.off('.modal');
    };

    return Modal;
})();

window.QtySelector = (function() {
    var QtySelector = function($el) {
        this.cache = {
            $body: $('body'),
            $subtotal: $('#CartSubtotal'),
            $discountTotal: $('#cartDiscountTotal'),
            $cartTable: $('.cart-table'),
            $cartTemplate: $('#CartProducts')
        };

        this.settings = {
            loadingClass: 'js-qty--is-loading',
            isCartTemplate: this.cache.$body.hasClass('template-cart'),
            // On the cart template, minimum is 0. Elsewhere min is 1
            minQty: this.cache.$body.hasClass('template-cart') ? 0 : 1
        };

        this.$el = $el;
        this.qtyUpdateTimeout;
        this.createInputs();
        this.bindEvents();
    };

    QtySelector.prototype.createInputs = function() {
        var $el = this.$el;

        var data = {
            value: $el.val(),
            key: $el.attr('id'),
            name: $el.attr('name'),
            line: $el.attr('data-line')
        };
        var source = $('#QuantityTemplate').html();
        var template = Handlebars.compile(source);

        this.$wrapper = $(template(data)).insertBefore($el);

        // Remove original number input
        $el.remove();
    };

    QtySelector.prototype.validateAvailability = function(line, quantity) {
        var product = theme.cartObject.items[line - 1]; // 0-based index in API
        var handle = product.handle; // needed for the ajax request
        var id = product.id; // needed to find right variant from ajax results

        var params = {
            type: 'GET',
            url: '/products/' + handle + '.js',
            dataType: 'json',
            success: $.proxy(function(cartProduct) {
                this.validateAvailabilityCallback(line, quantity, id, cartProduct);
            }, this)
        };

        $.ajax(params);
    };

    QtySelector.prototype.validateAvailabilityCallback = function(
        line,
        quantity,
        id,
        product
    ) {
        var quantityIsAvailable = true;

        // This returns all variants of a product.
        // Loop through them to get our desired one.
        for (var i = 0; i < product.variants.length; i++) {
            var variant = product.variants[i];
            if (variant.id === id) {
                break;
            }
        }

        // If the variant tracks inventory and does not sell when sold out
        // we can compare the requested with available quantity
        if (
            variant.inventory_management !== null &&
            variant.inventory_policy === 'deny'
        ) {
            if (variant.inventory_quantity < quantity) {

                // Set quantity to max amount available
                this.$wrapper.find('.js-qty__input').val(variant.inventory_quantity);

                quantityIsAvailable = false;
                this.$wrapper.removeClass(this.settings.loadingClass);
            }
        }

        if (quantityIsAvailable) {
            this.updateItemQuantity(line, quantity);
        }
    };

    QtySelector.prototype.validateQty = function(qty) {
        if (parseFloat(qty) === parseInt(qty, 10) && !isNaN(qty)) {
            // We have a valid number!
        } else {
            // Not a number. Default to 1.
            qty = 1;
        }
        return parseInt(qty, 10);
    };

    QtySelector.prototype.adjustQty = function(evt) {
        var $el = $(evt.currentTarget);
        var $input = $el.siblings('.js-qty__input');
        var qty = this.validateQty($input.val());
        var line = $input.attr('data-line');

        if ($el.hasClass('js-qty__adjust--minus')) {
            qty -= 1;
            if (qty <= this.settings.minQty) {
                qty = this.settings.minQty;
            }
        } else {
            qty += 1;
        }

        if (this.settings.isCartTemplate) {
            $el.parent().addClass(this.settings.loadingClass);
            this.updateCartItemPrice(line, qty);
        } else {
            $input.val(qty);
        }
    };

    QtySelector.prototype.bindEvents = function() {
        this.$wrapper
            .find('.js-qty__adjust')
            .on('click', $.proxy(this.adjustQty, this));

        // Select input text on click
        this.$wrapper.on('click', '.js-qty__input', function() {
            this.setSelectionRange(0, this.value.length);
        });

        // If the quantity changes on the cart template, update the price
        if (this.settings.isCartTemplate) {
            this.$wrapper.on(
                'change',
                '.js-qty__input',
                $.proxy(function(evt) {
                    var $input = $(evt.currentTarget);
                    var line = $input.attr('data-line');
                    var qty = this.validateQty($input.val());
                    $input.parent().addClass(this.settings.loadingClass);
                    this.updateCartItemPrice(line, qty);
                }, this)
            );
        }
    };

    QtySelector.prototype.updateCartItemPrice = function(line, qty) {
        // Update cart after short timeout so user doesn't create simultaneous ajax calls
        clearTimeout(this.qtyUpdateTimeout);
        this.qtyUpdateTimeout = setTimeout(
            $.proxy(function() {
                this.validateAvailability(line, qty);
            }, this),
            200
        );
    };

    QtySelector.prototype.updateItemQuantity = function(line, quantity) {
        var params = {
            type: 'POST',
            url: '/cart/change.js',
            data: 'quantity=' + quantity + '&line=' + line,
            dataType: 'json',
            success: $.proxy(function(cart) {
                this.updateCartItemCallback(cart);
            }, this)
        };

        $.ajax(params);
    };

    QtySelector.prototype.updateCartItemCallback = function(cart) {
        // Reload the page to show the empty cart if no items
        if (cart.item_count === 0) {
            location.reload();
            return;
        }

        // Update cart object
        theme.cartObject = cart;

        // Handlebars.js cart layout
        var data = {};
        var items = [];
        var item = {};
        var source = $('#CartProductTemplate').html();
        var template = Handlebars.compile(source);
        var prodImg;

        // Add each item to our handlebars.js data
        $.each(cart.items, function(index, cartItem) {
            /* Hack to get product image thumbnail
             *   - If image is not null
             *     - Remove file extension, add 240x240, and re-add extension
             *     - Create server relative link
             *   - A hard-coded url of no-image
             */

            if (cartItem.image === null) {
                prodImg =
                    '//cdn.shopify.com/s/assets/admin/no-image-medium-cc9732cb976dd349a0df1d39816fbcc7.gif';
            } else {
                prodImg = cartItem.image
                    .replace(/(\.[^.]*)$/, '_240x240$1')
                    .replace('http:', '');
            }

            if (cartItem.properties !== null) {
                $.each(cartItem.properties, function(key, value) {
                    if (key.charAt(0) === '_' || !value) {
                        delete cartItem.properties[key];
                    }
                });
            }

            // Create item's data object and add to 'items' array
            item = {
                key: cartItem.key,
                line: index + 1, // Shopify uses a 1+ index in the API
                url: cartItem.url,
                img: prodImg,
                name: cartItem.product_title,
                variation: cartItem.variant_title,
                properties: cartItem.properties,
                itemQty: cartItem.quantity,
                price: theme.Currency.formatMoney(cartItem.price, theme.moneyFormat),
                vendor: cartItem.vendor,
                linePrice: theme.Currency.formatMoney(
                    cartItem.line_price,
                    theme.moneyFormat
                ),
                originalLinePrice: theme.Currency.formatMoney(
                    cartItem.original_line_price,
                    theme.moneyFormat
                ),
                discounts: cartItem.discounts,
                discountsApplied: cartItem.line_price === cartItem.original_line_price ? false : true
            };

            items.push(item);
            theme.updateCurrencies();
        });

        // Gather all cart data and add to DOM
        data = {
            items: items
        };
        this.cache.$cartTemplate.empty().append(template(data));

        // Create new quantity selectors
        this.cache.$cartTable.find('input[type="number"]').each(function(i, el) {
            new QtySelector($(el));
        });

        // Update the cart subtotal
        this.cache.$subtotal.html(
            theme.Currency.formatMoney(cart.total_price, theme.moneyFormat)
        );

        // Update the cart total discounts
        if (cart.total_discount > 0) {
            this.cache.$discountTotal.html(
                theme.strings.totalCartDiscount.replace(
                    '[savings]',
                    theme.Currency.formatMoney(cart.total_discount, theme.moneyFormat)
                )
            );
        } else {
            this.cache.$discountTotal.empty();
        }

        theme.miniCart.updateElements();
        theme.updateCurrencies();
        // Set focus on cart table
        slate.a11y.pageLinkFocus(this.cache.$cartTable);
    };

    return QtySelector;
})();

/*
  Allow product to be added to cart via ajax with
  custom success and error responses.
*/
window.AjaxCart = (function() {
    var styleCart = $('.js-mini-cart').attr("data-cartmini");
    var cart = function($form) {
        this.cache = {
            $cartIconIndicator: $('.site-header__cart-indicator')
        };

        this.$form = $form;
        this.eventListeners();

        this.showNotice = false;
        if (this.$form.length) {
            this.showNotice = this.$form.hasClass('js-form--notice') ? true : false;
        }
    };

    cart.prototype.eventListeners = function() {
        if (this.$form.length) {
            this.$form.on('submit', $.proxy(this.addItemFromForm, this));
        }
    };

    cart.prototype.addItemFromForm = function(evt) {
        evt.preventDefault();

        var params = {
            type: 'POST',
            url: '/cart/add.js',
            data: this.$form.serialize(),
            dataType: 'json',
            success: $.proxy(function(lineItem) {
                //this.success(lineItem);
                window.location.href = '/cart';
            }, this),
            error: $.proxy(function(XMLHttpRequest, textStatus) {
                this.error(XMLHttpRequest, textStatus);
            }, this)
        };
        $.ajax(params);
    };

    cart.prototype.success = function(item) {
        theme.miniCart.updateElements();
        theme.miniCart.generateCart();
        if (styleCart != 'false') {
            if (this.showNotice) {
                var htmlVariant = item.variant_title !== null ? '<i>(' + item.variant_title + ')</i>' : '';
                var htmlAlert = '<div class="media mt-2 alert--cart"><a class="mr-3" href="/cart"><img class="lazyload" data-src="' + item.image + '"></a><div class="media-body align-self-center"><p class="m-0 font-weight-bold">' + item.product_title + ' x ' + item.quantity + '</p>' + htmlVariant + '<div><div>';
                theme.alert.new(theme.strings.addToCartSuccess, htmlAlert, 3000, 'notice');
            } else {
                theme.crosssell.showPopup(item);
            }
        }
    };

    // Error handling reference from Shopify.onError in api.jquery.js
    cart.prototype.error = function(XMLHttpRequest) {
        var data = JSON.parse(XMLHttpRequest.responseText);

        if (data.message) {
            theme.alert.new('', data.description, 3000, 'warning');
        }
    };

    return cart;
})();

/*================ TEMPLATES ================*/
theme.customerTemplates = (function() {
    function initEventListeners() {
        // Show reset password form
        $('#RecoverPassword').on('click', function(evt) {
            evt.preventDefault();
            toggleRecoverPasswordForm();
        });

        // Hide reset password form
        $('#HideRecoverPasswordLink').on('click', function(evt) {
            evt.preventDefault();
            toggleRecoverPasswordForm();
        });
    }

    /**
     *
     *  Show/Hide recover password form
     *
     */
    function toggleRecoverPasswordForm() {
        $('#RecoverPasswordForm').toggleClass('hide');
        $('#CustomerLoginForm').toggleClass('hide');
    }

    /**
     *
     *  Show reset password success message
     *
     */
    function resetPasswordSuccess() {
        // check if reset password form was successfully submited
        if (!$('.reset-password-success').length) {
            return;
        }

        // show success message
        $('#ResetSuccess').removeClass('hide');
    }

    /**
     *
     *  Show/hide customer address forms
     *
     */
    function customerAddressForm() {
        var $newAddressForm = $('#AddressNewForm');

        if (!$newAddressForm.length) {
            return;
        }

        // Initialize observers on address selectors, defined in shopify_common.js
        if (Shopify) {
            // eslint-disable-next-line no-new
            new Shopify.CountryProvinceSelector(
                'AddressCountryNew',
                'AddressProvinceNew', {
                    hideElement: 'AddressProvinceContainerNew'
                }
            );
        }

        // Initialize each edit form's country/province selector
        $('.address-country-option').each(function() {
            var formId = $(this).data('form-id');
            var countrySelector = 'AddressCountry_' + formId;
            var provinceSelector = 'AddressProvince_' + formId;
            var containerSelector = 'AddressProvinceContainer_' + formId;

            // eslint-disable-next-line no-new
            new Shopify.CountryProvinceSelector(countrySelector, provinceSelector, {
                hideElement: containerSelector
            });
        });

        // Toggle new/edit address forms
        $('.address-new-toggle').on('click', function() {
            $newAddressForm.toggleClass('hide');
        });

        $('.address-edit-toggle').on('click', function() {
            var formId = $(this).data('form-id');
            $('#EditAddress_' + formId).toggleClass('hide');
        });

        $('.address-delete').on('click', function() {
            var $el = $(this);
            var formId = $el.data('form-id');
            var confirmMessage = $el.data('confirm-message');

            // eslint-disable-next-line no-alert
            if (
                confirm(
                    confirmMessage || 'Are you sure you wish to delete this address?'
                )
            ) {
                Shopify.postLink('/account/addresses/' + formId, {
                    parameters: { _method: 'delete' }
                });
            }
        });
    }

    /**
     *
     *  Check URL for reset password hash
     *
     */
    function checkUrlHash() {
        var hash = window.location.hash;

        // Allow deep linking to recover password form
        if (hash === '#recover') {
            toggleRecoverPasswordForm();
        }
    }

    return {
        init: function() {
            checkUrlHash();
            initEventListeners();
            resetPasswordSuccess();
            customerAddressForm();
        }
    };
})();

/*================ SECTIONS ================*/
theme.HeaderSection = (function() {
    function Header() {
        theme.NavDrawer = new window.Drawers('NavDrawer', 'left');
    }

    return Header;
})();

theme.Product = (function() {
    var defaults = {
        smallBreakpoint: 750,
        productThumbIndex: 0,
        productThumbMax: 0,
        ajaxCart: false,
        stockSetting: false
    };

    function Product(container) {
        var $container = (this.$container = $(container));
        var sectionId = $container.attr('data-section-id');

        this.selectors = {
            originalSelectorId: '#ProductSelect-' + sectionId,
            modal: 'ProductModal',
            productZoomImage: '#ProductZoomImg',
            addToCart: '#AddToCart-' + sectionId,
            productPrice: '#ProductPrice-' + sectionId,
            comparePrice: '#ComparePrice-' + sectionId,
            addToCartText: '#AddToCartText-' + sectionId,
            SKU: '.js-variant-sku',
            productImageContainers: '.product__photo-container-' + sectionId,
            productImageWrappers: '.product__photo-wrapper-' + sectionId,
            productThumbContainers: '.product-single__thumbnail-item-' + sectionId,
            productThumbsWrapper: '.product-single__thumbnails-' + sectionId,
            productThumbs: '.product-single__thumbnail-' + sectionId,
            saleTag: '#ProductSaleTag-' + sectionId,
            productStock: '#ProductStock-' + sectionId,
            singleOptionSelector: '.single-option-selector-' + sectionId,
            shopifyPaymentButton: '.shopify-payment-button',
            availability: '.product-single__availability',
            hurrify: '.js-hurrify'
        };

        this.settings = $.extend({}, defaults, {
            sectionId: sectionId,
            ajaxCart: $container.data('ajax'),
            stockSetting: $container.data('stock'),
            enableHistoryState: $container.data('enable-history-state') || false,
            namespace: '.product-' + sectionId
        });

        // Stop parsing if we don't have the product json script tag
        if (!$('#ProductJson-' + sectionId).html()) {
            return;
        }

        this.productSingleObject = JSON.parse(
            $('#ProductJson-' + sectionId).html()
        );
        this.addVariantInfo();

        this.init();
    }

    Product.prototype = _.assignIn({}, Product.prototype, {
        init: function() {
            this._stringOverrides();
            this._initVariants();
            this._productZoomImage();
            this._productThumbSwitch();
            this._productThumbnailSlider();
            this._initQtySelector();

            if (this.settings.ajaxCart) {
                theme.AjaxCart = new window.AjaxCart(
                    $('#AddToCartForm-' + this.settings.sectionId)
                );
            }
        },

        _stringOverrides: function() {
            window.productStrings = window.productStrings || {};
            $.extend(theme.strings, window.productStrings);
        },

        addVariantInfo: function() {
            if (!this.productSingleObject || !this.settings.stockSetting) {
                return;
            }

            var variantInfo = JSON.parse(
                $('#VariantJson-' + this.settings.sectionId).html()
            );

            for (var i = 0; i < variantInfo.length; i++) {
                $.extend(this.productSingleObject.variants[i], variantInfo[i]);
            }
        },

        _initVariants: function() {
            var options = {
                $container: this.$container,
                enableHistoryState: this.settings.enableHistoryState,
                product: this.productSingleObject,
                singleOptionSelector: this.selectors.singleOptionSelector,
                originalSelectorId: this.selectors.originalSelectorId
            };

            // eslint-disable-next-line no-new
            this.variants = new slate.Variants(options);

            this.$container.on(
                'variantChange' + this.settings.namespace,
                this._updateAddToCartBtn.bind(this)
            );
            this.$container.on(
                'variantChange' + this.settings.namespace,
                this._updateStickyCart.bind(this)
            );
            this.$container.on(
                'variantPriceChange' + this.settings.namespace,
                this._updatePrice.bind(this)
            );
            this.$container.on(
                'variantSKUChange' + this.settings.namespace,
                this._updateSKU.bind(this)
            );
            this.$container.on(
                'variantImageChange' + this.settings.namespace,
                this._updateImages.bind(this)
            );
        },

        _updateStock: function(variant) {
            if (!this.settings.stockSetting) return;

            var $stock = $(this.selectors.productStock),
                $hurrify = $(this.selectors.hurrify);

            // If we don't track variant inventory, hide stock
            if (!variant || !variant.inventory_management) {
                $stock.addClass('hide');
                $hurrify.addClass('hide');
                return;
            }

            if (variant.inventory_quantity < 10 && variant.inventory_quantity > 0) {
                $stock
                    .html(
                        theme.strings.stockAvailable.replace(
                            '1',
                            variant.inventory_quantity
                        )
                    )
                    .removeClass('hide');
                $hurrify.removeClass('hide').find('.progress-bar').css('width', variant.inventory_quantity * 10 + '%');
                return;
            }

            if (variant.inventory_quantity <= 0 && variant.incoming) {
                $stock
                    .html(
                        theme.strings.willNotShipUntil.replace(
                            '[date]',
                            variant.next_incoming_date
                        )
                    )
                    .removeClass('hide');
                $hurrify.addClass('hide');
                return;
            }

            // If there's more than 10 available, hide stock
            $stock.addClass('hide');
            $hurrify.addClass('hide');
        },

        _updateIncomingInfo: function(variant) {
            if (!this.settings.stockSetting) return;

            var $stock = $(this.selectors.productStock);

            if (variant.incoming) {
                $stock
                    .html(
                        theme.strings.willBeInStockAfter.replace(
                            '[date]',
                            variant.next_incoming_date
                        )
                    )
                    .removeClass('hide');
                return;
            }

            // If there is no stock incoming, hide stock
            $stock.addClass('hide');
        },

        _updateAddToCartBtn: function(evt) {
            var variant = evt.variant;

            var cache = {
                $addToCart: $(this.selectors.addToCart),
                $addToCartText: $(this.selectors.addToCartText)
            };

            if (variant) {
                // Select a valid variant if available
                theme.noticeSoldout.init(variant);
                if (variant.available) {
                    // We have a valid product variant, so enable the submit button
                    cache.$addToCart.removeClass('btn--sold-out').prop('disabled', false);
                    cache.$addToCartText.html(theme.strings.addToCart);
                    $(this.selectors.shopifyPaymentButton, this.$container).show();
                    // Show how many items are left, if below 10
                    this._updateStock(variant);
                    //update availability - available
                    $(this.selectors.availability).find('span').text(theme.strings.available);
                } else {
                    // Variant is sold out, disable the submit button
                    cache.$addToCart.prop('disabled', true).addClass('btn--sold-out');
                    cache.$addToCartText.html(theme.strings.soldOut);
                    $(this.selectors.shopifyPaymentButton, this.$container).hide();
                    // Update when stock will be available
                    this._updateIncomingInfo(variant);
                    //update availability - soldout
                    $(this.selectors.availability).find('span').text(theme.strings.soldOut);
                }
            } else {
                cache.$addToCart.prop('disabled', true).removeClass('btn--sold-out');
                cache.$addToCartText.html(theme.strings.unavailable);
                //update availability - unavailable
                $(this.selectors.availability).find('span').text(theme.strings.unavailable);
                $(this.selectors.shopifyPaymentButton, this.$container).hide();
                // Hide stock display
                this._updateStock();
            }
        },

        _updatePrice: function(evt) {
            var variant = evt.variant;

            if (variant) {
                $(this.selectors.productPrice).html(
                    theme.Currency.formatMoney(variant.price, theme.moneyFormat)
                );

                // Update and show the product's compare price if necessary
                if (variant.compare_at_price > variant.price) {
                    $(this.selectors.comparePrice)
                        .html(
                            theme.Currency.formatMoney(
                                variant.compare_at_price,
                                theme.moneyFormat
                            )
                        )
                        .removeClass('hide');
                    $(this.selectors.saleTag).removeClass('hide');
                } else {
                    $(this.selectors.comparePrice).addClass('hide');
                    $(this.selectors.saleTag).addClass('hide');
                }

                theme.updateCurrencies();
            } else {
                $(this.selectors.comparePrice).addClass('hide');
            }
        },

        _updateSKU: function(evt) {
            var variant = evt.variant;

            if (variant) {
                $(this.selectors.SKU).html(variant.sku);
            }
        },

        _updateImages: function(evt) {
            var variant = evt.variant;

            if (variant && variant.featured_image) {
                var imageId = variant.featured_image.id;
                this.switchProductImage(imageId);
                this.setActiveThumbnail(imageId);
            }
        },
        _updateStickyCart: function(evt) {
            var variant = evt.variant,
                $stickyPrice = $('#js-sticky-price'),
                $stickyTitle = $('#js-sticky-title'),
                $stickyImage = $('#js-sticky-img'),
                $stickyButton = $('#js-sticky-btn');
            if (variant) {
                //update title
                $stickyTitle.html(' - ' + variant.title);
                //update price
                $stickyPrice.html(theme.Currency.formatMoney(variant.price, theme.moneyFormat));
                //update selectbox
                for (var i = 1; i <= 3; i++) {
                    var option = 'option' + i,
                        $selecBox = '#js-sticky-option-' + i;
                    if (variant[option] !== null) {
                        var valueOption = variant[option];
                        $($selecBox).val(valueOption);
                    }
                }
                //update button cart
                if (variant.available) {
                    $stickyButton.prop('disabled', false).removeClass('btn--sold-out');
                    $stickyButton.html(theme.strings.addToCart);
                } else {
                    $stickyButton.prop('disabled', true).addClass('btn--sold-out');
                    $stickyButton.html(theme.strings.soldOut);
                }
                //update image
                if (variant.featured_image) {
                    $stickyImage.attr('src', theme.Images.getSizedImageUrl(variant.featured_image.src, '200x'));
                }
            } else {
                //update title
                $stickyTitle.html(' - ' + theme.strings.unavailable);
                //update button cart
                $stickyButton.prop('disabled', true).removeClass('btn--sold-out');
                $stickyButton.html(theme.strings.unavailable);
            }
        },

        switchProductImage: function(imageId) {
            var $imageToShow = $(
                this.selectors.productImageContainers +
                "[data-image-id='" +
                imageId +
                "']",
                this.$container
            );
            var $imagesToHide = $(
                this.selectors.productImageContainers +
                ":not([data-image-id='" +
                imageId +
                "'])",
                this.$container
            );
            $imagesToHide.addClass('hide');
            $imageToShow.removeClass('hide');
            //Scroll to active
            topMenuHeight = $('.site-header').outerHeight();
            if (this.settings.sectionId === 'product-template-8') {
                $([document.documentElement, document.body]).animate({
                    scrollTop: $imageToShow.offset().top - topMenuHeight
                }, 500);
            }
        },

        setActiveThumbnail: function(imageId) {
            var $thumbnailToShow = $(
                this.selectors.productThumbContainers +
                "[data-image-id='" +
                imageId +
                "']",
                this.$container
            );
            var $thumbnailsToHide = $(
                this.selectors.productThumbContainers +
                ":not([data-image-id='" +
                imageId +
                "'])",
                this.$container
            );
            $thumbnailsToHide.removeClass('is-active');
            $thumbnailToShow.addClass('is-active');
            $thumbnailToShow.trigger('click');
            var $thumbnails = $(this.selectors.productThumbsWrapper, this.$container);

            // If there is a slick carousel, get the slide index, and position it into view with animation.
            if ($thumbnails.hasClass('slick-initialized')) {
                // eslint-disable-next-line shopify/jquery-dollar-sign-reference
                var currentActiveSlideIndex = $thumbnails.slick('slickCurrentSlide');
                var newActiveSlideIndex = parseInt(
                    $thumbnailToShow.attr('data-slick-index')
                );
                if (currentActiveSlideIndex !== newActiveSlideIndex) {
                    $thumbnails.slick('slickGoTo', newActiveSlideIndex, false);

                }
            }
        },

        _productZoomImage: function() {
            // The zoom image is only used on the product template, so return early
            // even if a featured product section is present.
            if (!$('.product-single ' + this.selectors.productImageContainers).length) {
                return;
            }

            var self = this;

            $(this.selectors.productImageWrappers).on(
                'click' + this.settings.namespace,
                function(evt) {
                    evt.preventDefault();
                    // Empty src before loadig new image to avoid awkward image swap
                    $(self.selectors.productZoomImage)
                        .attr('src', '')
                        .attr('src', $(this).attr('href'));
                }
            );

            this.ProductModal = new window.Modals(
                this.selectors.modal,
                'product-modal'
            );

            // Close modal if clicked, but not if the image is clicked
            this.ProductModal.$modal.on('click' + this.settings.namespace, function(
                evt
            ) {
                if (evt.target.nodeName !== 'IMG') {
                    self.ProductModal.close();
                }
            });
        },

        _productThumbSwitch: function() {
            if (!$(this.selectors.productThumbs).length) {
                return;
            }

            var self = this;

            $(this.selectors.productThumbs).on(
                'click' + this.settings.namespace,
                function(evt) {
                    evt.preventDefault();
                    var imageId = $(this)
                        .parent()
                        .data('image-id');
                    self.setActiveThumbnail(imageId);
                    self.switchProductImage(imageId);
                }
            );
            //trigger hover thumb
            // $(this.selectors.productThumbs).on('click',function(){
            //   $(this).trigger('click');
            // });
        },

        /*
          Thumbnail slider
         */
        _productThumbnailSlider: function() {
            var $productThumbsWrapper = $(this.selectors.productThumbsWrapper);
            var $productThumbs = $(this.selectors.productThumbs);
            if (!$productThumbs.length) {
                return;
            }

            if ($productThumbs.length > 1) {
                $productThumbsWrapper.on(
                    'init' + this.settings.namespace,
                    this._productSwipeInit.bind(this)
                );

                if (this.settings.sectionId === 'product-template-3' || this.settings.sectionId === 'product-template-4') {
                    $productThumbsWrapper.slick({
                        accessibility: false,
                        arrows: true,
                        dots: false,
                        infinite: false,
                        autoplay: false,
                        slidesToShow: 5,
                        slidesToScroll: 5,
                        vertical: true,
                        verticalSwiping: true,
                        responsive: [{
                            breakpoint: 992,
                            settings: {
                                vertical: false,
                                verticalSwiping: false,
                                slidesToShow: 4,
                                slidesToScroll: 4,
                                dots: false,
                            }
                        }]
                    }).css('opacity', '1');
                } else if (this.settings.sectionId === 'product-template-5') {
                    $productThumbsWrapper.slick({
                        accessibility: false,
                        arrows: true,
                        dots: false,
                        infinite: true,
                        autoplay: false,
                        slidesToShow: 2,
                        slidesToScroll: 1,
                        responsive: [{
                            breakpoint: 992,
                            settings: {
                                slidesToShow: 4,
                                slidesToScroll: 4,
                                dots: false,
                            }
                        }]
                    }).css('opacity', '1');
                } else if (this.settings.sectionId === 'product-template-7') {
                    $productThumbsWrapper.slick({
                        accessibility: false,
                        arrows: true,
                        dots: true,
                        infinite: true,
                        autoplay: false,
                        slidesToShow: 1,
                        slidesToScroll: 1,
                        responsive: [{
                            breakpoint: 992,
                            settings: {
                                slidesToShow: 1,
                                slidesToScroll: 1,
                                dots: false,
                                arrows: true,
                            }
                        }]
                    }).css('opacity', '1');
                } else if (this.settings.sectionId === 'product-template-8') {
                    var lastId,
                        topMenu = $(".product-single__thumbnails"),
                        topMenuHeight = $('.site-header').outerHeight() + 20,
                        // All list items
                        menuItems = topMenu.find(".product-single__thumbnail");


                    if ($(window).width() > 767) {
                        menuItems.click(function(e) {
                            var findid = $(this).attr('href');
                            offsetTop = $(findid).offset().top - topMenuHeight + 1;
                            $('html, body').stop().animate({
                                scrollTop: offsetTop
                            }, 200);
                            return false;
                        });
                        // Anchors corresponding to menu items
                        scrollItems = menuItems.map(function() {
                            var item = $($(this).attr('href'));
                            if (item.length) { return item; }
                        });

                        $(window).scroll(function() {
                            // Get container scroll position
                            var fromTop = $(this).scrollTop() + topMenuHeight;
                            // Get id of current scroll item
                            var cur = scrollItems.map(function() {
                                if ($(this).offset().top < fromTop)
                                    return this;
                            });
                            // Get the id of the current element
                            cur = cur[cur.length - 1];
                            var id = cur && cur.length ? cur[0].id : "";

                            if (lastId !== id) {
                                lastId = id;
                                // Set/remove active class
                                menuItems
                                    .parent().removeClass("is-active")
                                    .end().filter("[href='#" + id + "']").parent().addClass("is-active");
                            }
                        });
                    } else {
                        menuItems.click(function(e) {
                            var findid = $(this).attr('href');
                            offsetTop = $(findid).offset().top;
                            $('html, body').stop().animate({
                                scrollTop: offsetTop
                            });
                            return false;
                        });
                    }

                    $productThumbsWrapper.slick({
                        accessibility: false,
                        arrows: true,
                        dots: false,
                        infinite: false,
                        autoplay: false,
                        slidesToShow: 5,
                        slidesToScroll: 1,
                        vertical: true,
                        verticalSwiping: true,
                        responsive: [{
                            breakpoint: 992,
                            settings: {
                                vertical: false,
                                verticalSwiping: false,
                                slidesToShow: 4,
                                slidesToScroll: 4,
                                dots: true,
                            }
                        }]
                    }).css('opacity', '1');
                } else {
                    $productThumbsWrapper.slick({
                        accessibility: false,
                        arrows: true,
                        dots: false,
                        infinite: false,
                        autoplay: false,
                        slidesToShow: 4,
                        slidesToScroll: 4
                    }).css('opacity', '1');
                }

                // Show highlighted thumbnail by repositioning slider
                $productThumbsWrapper.slick(
                    'slickGoTo',
                    $productThumbsWrapper.find('.is-active').attr('data-slick-index'),
                    true
                );
            }
        },

        _productSwipeInit: function(evt, obj) {
            // Slider is initialized. Setup custom swipe events
            this.settings.productThumbIndex = obj.currentSlide;
            this.settings.productThumbMax = obj.slideCount - 1; // we need the 0-based index

            var self = this;

            $(this.selectors.productImageWrappers).on(
                'swipeleft swiperight',
                function(event) {
                    if (event.type === 'swipeleft') {
                        self._goToNextThumbnail();
                    }

                    if (event.type === 'swiperight') {
                        self._goToPrevThumbnail();
                    }

                    // Trigger click on newly requested thumbnail
                    $(
                            '.product-single__thumbnail-item[data-slick-index="' +
                            self.settings.productThumbIndex +
                            '"]'
                        )
                        .find('.product-single__thumbnail')
                        .trigger('click');

                }
            );
        },
        _goToNextThumbnail: function() {
            this.settings.productThumbIndex++;

            if (this.settings.productThumbIndex > this.settings.productThumbMax) {
                this.settings.productThumbIndex = 0;
            }

            $(this.selectors.productThumbsWrapper).slick(
                'slickGoTo',
                this.settings.productThumbIndex,
                true
            );
        },

        _goToPrevThumbnail: function() {
            this.settings.productThumbIndex--;

            if (this.settings.productThumbIndex < 0) {
                this.settings.productThumbIndex = this.settings.productThumbMax;
            }

            $(this.selectors.productThumbsWrapper).slick(
                'slickGoTo',
                this.settings.productThumbIndex,
                true
            );
        },

        _initQtySelector: function() {
            this.$container.find('.product-form__quantity').each(function(i, el) {
                // eslint-disable-next-line no-new
                new QtySelector($(el));
            });
        },

        onUnload: function() {
            $(this.selectors.productImageWrappers).off(this.settings.namespace);
            $(this.selectors.productThumbs).off(this.settings.namespace);
            $(this.selectors.productThumbs).slick('unslick');
            if (this.ProductModal) {
                this.ProductModal.$modal.off(this.settings.namespace);
            }
        }
    });

    return Product;
})();

theme.Slideshow = (function() {
    this.$slideshow = null;
    var classes = {
        slideshow: 'slideshow',
        slickActiveMobile: 'slick-active-mobile',
        controlsHover: 'slideshow__controls--hover',
        isPaused: 'is-paused'
    };

    var selectors = {
        section: '.shopify-section',
        wrapper: '#SlideshowWrapper-',
        slides: '.slideshow__slide',
        textWrapperMobile: '.slideshow__text-wrap--mobile',
        textContentMobile: '.slideshow__text-content--mobile',
        controls: '.slideshow__controls',
        dots: '.slick-dots',
        arrowLeft: '.slideshow__arrow-left',
        arrowRight: '.slideshow__arrow-right'
    };

    function slideshow(el, sectionId) {
        var $slideshow = (this.$slideshow = $(el));
        this.adaptHeight = this.$slideshow.data('adapt-height');
        this.$wrapper = this.$slideshow.closest(selectors.wrapper + sectionId);
        this.$section = this.$wrapper.closest(selectors.section);
        this.$controls = this.$wrapper.find(selectors.controls);
        this.$textWrapperMobile = this.$section.find(selectors.textWrapperMobile);
        this.autorotate = this.$slideshow.data('autorotate');
        var autoplaySpeed = this.$slideshow.data('speed');
        var loadSlideA11yString = this.$slideshow.data('slide-nav-a11y');

        this.settings = {
            rtl: theme.rtl,
            accessibility: true,
            arrows: true,
            dots: true,
            fade: (theme.rtl ? false : true),
            draggable: true,
            touchThreshold: 20,
            autoplay: this.autorotate,
            autoplaySpeed: autoplaySpeed
        };

        this.$slideshow.on('beforeChange', beforeChange.bind(this));
        this.$slideshow.on('init', slideshowA11ySetup.bind(this));

        // Add class to style mobile dots & show the correct text content for the
        // first slide on mobile when the slideshow initialises
        this.$slideshow.on(
            'init',
            function() {
                this.$mobileDots
                    .find('li:first-of-type')
                    .addClass(classes.slickActiveMobile);
                this.showMobileText(0);
            }.bind(this)
        );

        if (this.adaptHeight) {
            this.setSlideshowHeight();
            $(window).resize($.debounce(50, this.setSlideshowHeight.bind(this)));
        }

        this.$slideshow.slick(this.settings);

        // This can't be called when the slick 'init' event fires due to how slick
        // adds a11y features.
        slideshowPostInitA11ySetup.bind(this)();
    }

    function slideshowA11ySetup(event, obj) {
        var $slider = obj.$slider;
        var $list = obj.$list;
        this.$dots = this.$section.find(selectors.dots);
        this.$mobileDots = this.$dots.eq(1);

        // Remove default Slick aria-live attr until slider is focused
        $list.removeAttr('aria-live');

        //     this.$wrapper.on('keyup', keyboardNavigation.bind(this));
        //     this.$controls.on('keyup', keyboardNavigation.bind(this));
        //     this.$textWrapperMobile.on('keyup', keyboardNavigation.bind(this));

        // When an element in the slider is focused
        // pause slideshow and set aria-live.
        this.$wrapper
            .on(
                'focusin',
                function(evt) {
                    if (!this.$wrapper.has(evt.target).length) {
                        return;
                    }

                    $list.attr('aria-live', 'polite');
                    if (this.autorotate) {
                        $slider.slick('slickPause');
                    }
                }.bind(this)
            )
            .on(
                'focusout',
                function(evt) {
                    if (!this.$wrapper.has(evt.target).length) {
                        return;
                    }

                    $list.removeAttr('aria-live');
                }.bind(this)
            );

        // Add arrow key support when focused
        if (this.$dots) {
            this.$dots
                .find('a')
                .each(function() {
                    var $dot = $(this);
                    $dot.on('click keyup', function(evt) {
                        if (
                            evt.type === 'keyup' &&
                            evt.which !== slate.utils.keyboardKeys.ENTER
                        )
                            return;

                        evt.preventDefault();

                        var slideNumber = $(evt.target).data('slide-number');

                        $slider.attr('tabindex', -1).slick('slickGoTo', slideNumber);

                        if (evt.type === 'keyup') {
                            $slider.focus();
                        }
                    });
                })
                .eq(0)
                .attr('aria-current', 'true');
        }

        this.$controls
            .on('focusin', highlightControls.bind(this))
            .on('focusout', unhighlightControls.bind(this));
    }

    function slideshowPostInitA11ySetup() {
        var $slides = this.$slideshow.find(selectors.slides);

        $slides.removeAttr('role').removeAttr('aria-labelledby');
        this.$dots
            .removeAttr('role')
            .find('li')
            .removeAttr('role')
            .removeAttr('aria-selected')
            .each(function() {
                var $dot = $(this);
                var ariaControls = $dot.attr('aria-controls');
                $dot
                    .removeAttr('aria-controls')
                    .find('a')
                    .attr('aria-controls', ariaControls);
            });
    }

    function beforeChange(event, slick, currentSlide, nextSlide) {
        var $dotLinks = this.$dots.find('a');
        var $mobileDotLinks = this.$mobileDots.find('li');

        $dotLinks
            .removeAttr('aria-current')
            .eq(nextSlide)
            .attr('aria-current', 'true');

        $mobileDotLinks
            .removeClass(classes.slickActiveMobile)
            .eq(nextSlide)
            .addClass(classes.slickActiveMobile);
        this.showMobileText(nextSlide);
    }

    //   function keyboardNavigation() {
    //     if (event.keyCode === slate.utils.keyboardKeys.LEFTARROW) {
    //       this.$slideshow.slick('slickPrev');
    //     }
    //     if (event.keyCode === slate.utils.keyboardKeys.RIGHTARROW) {
    //       this.$slideshow.slick('slickNext');
    //     }
    //   }

    function highlightControls() {
        this.$controls.addClass(classes.controlsHover);
    }

    function unhighlightControls() {
        this.$controls.removeClass(classes.controlsHover);
    }

    slideshow.prototype.setSlideshowHeight = function() {
        var minAspectRatio = this.$slideshow.data('min-aspect-ratio');
        this.$slideshow.height($(document).width() / minAspectRatio);
    };

    slideshow.prototype.showMobileText = function(slideIndex) {
        var $allTextContent = this.$textWrapperMobile.find(
            selectors.textContentMobile
        );
        var currentTextContentSelector =
            selectors.textContentMobile + '-' + slideIndex;
        var $currentTextContent = this.$textWrapperMobile.find(
            currentTextContentSelector
        );
        if (!$currentTextContent.length &&
            this.$slideshow.find(selectors.slides).length === 1
        ) {
            this.$textWrapperMobile.hide();
        } else {
            this.$textWrapperMobile.show();
        }
        $allTextContent.hide();
        $currentTextContent.show();
    };

    function getSlideshowId($el) {
        return '#Slideshow-' + $el.data('id');
    }

    return slideshow;
})();

theme.slideshows = {};

theme.SlideshowSection = (function() {
    function SlideshowSection(container) {
        var $container = (this.$container = $(container));
        var sectionId = $container.attr('data-section-id');
        var slideshow = (this.slideshow = '#Slideshow-' + sectionId);

        theme.slideshows[slideshow] = new theme.Slideshow(slideshow, sectionId);
    }

    return SlideshowSection;
})();

theme.SlideshowSection.prototype = _.assignIn({},
    theme.SlideshowSection.prototype, {
        onUnload: function() {
            delete theme.slideshows[this.slideshow];
        },

        onBlockSelect: function(evt) {
            var $slideshow = $(this.slideshow);
            var adaptHeight = $slideshow.data('adapt-height');

            if (adaptHeight) {
                theme.slideshows[this.slideshow].setSlideshowHeight();
            }

            // Ignore the cloned version
            var $slide = $(
                '.slideshow__slide--' + evt.detail.blockId + ':not(.slick-cloned)'
            );
            var slideIndex = $slide.data('slick-index');

            // Go to selected slide, pause auto-rotate
            $slideshow.slick('slickGoTo', slideIndex).slick('slickPause');
        },

        onBlockDeselect: function() {
            // Resume auto-rotate
            $(this.slideshow).slick('slickPlay');
        }
    }
);

theme.slideshows = {};

theme.Cart = (function() {
    var selectors = {
        cartNote: '#CartSpecialInstructions',
        cartQtyInput: '.cart__quantity',
        cartNoCookiesClass: 'cart--no-cookies'
    };

    function Cart(container) {
        var $container = (this.$container = $(container));
        var sectionId = $container.attr('data-section-id');

        theme.cartObject = JSON.parse($('#CartJson-' + sectionId).html());

        this.init($container);
    }

    Cart.prototype = _.assignIn({}, Cart.prototype, {
        init: function($container) {
            this._initQtySelector();
            this._initCartNote();

            if (!this._cookiesEnabled()) {
                $container.addClass(selectors.cartNoCookiesClass);
            }
        },

        _initQtySelector: function() {
            $(selectors.cartQtyInput).each(function(i, el) {
                // eslint-disable-next-line no-new
                new QtySelector($(el));
            });
        },

        _initCartNote: function() {
            if (!$(selectors.cartNote).length) {
                return;
            }

            var $el = $(selectors.cartNote);
            var noteText;
            var params;
            var noteOffset = $el[0].offsetHeight - $el[0].clientHeight;

            // Auto grow the cart note if text fills it up
            $el.on('keyup input', function() {
                $(this)
                    .css('height', 'auto')
                    .css('height', $el[0].scrollHeight + noteOffset);
            });

            // Save the cart note via ajax. A safeguard in case
            // a user decides to leave the page before clicking 'Update Cart'
            $el.on(
                'change',
                $.proxy(function() {
                    noteText = $el.val();
                    params = {
                        type: 'POST',
                        url: '/cart/update.js',
                        data: 'note=' + this._attributeToString(noteText),
                        dataType: 'json'
                    };
                    $.ajax(params);
                }, this)
            );
        },

        _attributeToString: function(attr) {
            if (typeof attr !== 'string') {
                attr = String(attr);
                if (attr === 'undefined') {
                    attr = '';
                }
            }
            return $.trim(attr);
        },

        _cookiesEnabled: function() {
            var cookieEnabled = navigator.cookieEnabled;

            if (!cookieEnabled) {
                document.cookie = 'testcookie';
                cookieEnabled = document.cookie.indexOf('testcookie') !== -1;
            }
            return cookieEnabled;
        }
    });

    return Cart;
})();

// Instagrams
theme.Instagrams = (function() {
    function Instagrams(container) {
        this.$container = $(container).on('init', this._a11y.bind(this));
        //console.log(this.$container);
        this.settings = {
            style: this.$container.data('style'),
            accesstoken: this.$container.data('accesstoken'),
            userid: this.$container.data('userid'),
            limit: this.$container.data('limit'),
            resolution: this.$container.data('resolution'),
            target: this.$container.attr('id'),
            rows: this.$container.data('rows'),

            slidesToShow: this.$container.data('slidestoshow') || 1,
            infinite: this.$container.data('infinite') || false,
            arrows: this.$container.data('arrows') || false,
            draggable: this.$container.data('draggable') || false,
            dots: this.$container.data('dots') || false,
        }
        this.settings.slidesToShow1200 = (this.settings.slidesToShow - 1) > 1 ? (this.settings.slidesToShow - 1) : 1;
        this.settings.slidesToShow992 = (this.settings.slidesToShow - 2) > 1 ? (this.settings.slidesToShow - 2) : 1;
        this.settings.slidesToShow768 = (this.settings.slidesToShow - 3) > 1 ? (this.settings.slidesToShow - 3) : 1;
        this.settings.slidesToShow480 = 2;

        var _self = this;
        var $instagramSelector = $('#' + this.settings.target);
        if (this.settings.style === 'grid') {
            var afterInstagram = function() {} // blank function
        } else if (this.settings.style === 'carousel') {
            var afterInstagram = function() {
                $instagramSelector.slick({
                    slidesToShow: _self.settings.slidesToShow,
                    slidesToScroll: _self.settings.slidesToShow,
                    arrows: _self.settings.arrows,
                    dots: _self.settings.dots,
                    draggable: _self.settings.draggable,
                    infinite: _self.settings.infinite,
                    rows: _self.settings.rows,
                    responsive: [{
                            breakpoint: 1200,
                            settings: {
                                slidesToShow: _self.settings.slidesToShow1200,
                                slidesToScroll: _self.settings.slidesToShow1200,
                            }
                        },
                        {
                            breakpoint: 992,
                            settings: {
                                slidesToShow: _self.settings.slidesToShow992,
                                slidesToScroll: _self.settings.slidesToShow992,
                            }
                        },
                        {
                            breakpoint: 768,
                            settings: {
                                slidesToShow: _self.settings.slidesToShow768,
                                slidesToScroll: _self.settings.slidesToShow768,
                            }
                        },
                        {
                            breakpoint: 480,
                            settings: {
                                slidesToShow: _self.settings.slidesToShow480,
                                slidesToScroll: _self.settings.slidesToShow480,
                            }
                        }
                    ]
                })
            }
        }

        var feed = new Instafeed({
            get: 'user',
            target: this.settings.target,
            userId: this.settings.userid,
            accessToken: this.settings.accesstoken,
            limit: this.settings.limit,
            resolution: this.settings.resolution,
            template: '<div class="col hv-image-brightness"><a class="instagram-item" href="{{link}}" target="_blank" id="{{id}}"><img alt="instagram image" class="transition lazyload" data-src="{{image}}" /></a></div>',
            after: afterInstagram
        });

        feed.run();
    }

    Instagrams.prototype = _.assignIn({}, Instagrams.prototype, {
        _a11y: function(event, obj) {
            var $list = obj.$list;
            var $wrapper = this.$container.parent();

            // Remove default Slick aria-live attr until slider is focused
            $list.removeAttr('aria-live');

            // When an element in the slider is focused set aria-live
            $wrapper.on('focusin', function(evt) {
                if ($wrapper.has(evt.target).length) {
                    $list.attr('aria-live', 'polite');
                }
            });

            // Remove aria-live
            $wrapper.on('focusout', function(evt) {
                if ($wrapper.has(evt.target).length) {
                    $list.removeAttr('aria-live');
                }
            });
        }
    });

    return Instagrams;
})();

// Slick carousel
theme.slickCarousel = (function() {
    function Carousels(container) {
        this.$container = $(container).on('init', this._a11y.bind(this));
        this.settings = {
            rows: this.$container.data('rows') || 1,
            slidesToShow: this.$container.data('slidestoshow') || 1,
            slidesToScroll: this.$container.data('slidestoscroll') || 1,
            infinite: this.$container.data('infinite') || false,
            arrows: this.$container.data('arrows') || false,
            dots: this.$container.data('dots') || false,
            autoplay: this.$container.data('autoplay') || false,
            draggable: this.$container.data('draggable') || false,
            accessibility: this.$container.data('accessibility') || true,
        }
        this.settings.slidesToShow1200 = (this.settings.slidesToShow - 1) > 1 ? (this.settings.slidesToShow - 1) : 1;
        this.settings.slidesToShow992 = (this.settings.slidesToShow - 2) > 1 ? (this.settings.slidesToShow - 2) : 1;
        this.settings.slidesToShow768 = (this.settings.slidesToShow - 3) > 1 ? (this.settings.slidesToShow - 3) : 1;
        this.settings.slidesToShow480 = (this.settings.slidesToShow - 4) > 1 ? (this.settings.slidesToShow - 4) : 1;
        this.settings.slidesToScroll1200 = (this.settings.slidesToScroll - 1) > 1 ? (this.settings.slidesToScroll - 1) : 1;
        this.settings.slidesToScroll992 = (this.settings.slidesToScroll - 2) > 1 ? (this.settings.slidesToScroll - 2) : 1;
        this.settings.slidesToScroll768 = (this.settings.slidesToScroll - 3) > 1 ? (this.settings.slidesToScroll - 3) : 1;
        this.settings.slidesToScroll480 = (this.settings.slidesToScroll - 4) > 1 ? (this.settings.slidesToScroll - 4) : 1;
        this.$container.slick({
            rtl: theme.rtl,
            rows: this.settings.rows,
            slidesToShow: this.settings.slidesToShow,
            slidesToScroll: this.settings.slidesToScroll,
            arrows: this.settings.arrows,
            dots: this.settings.dots,
            autoplay: this.settings.autoplay,
            accessibility: this.settings.accessibility,
            draggable: this.settings.draggable,
            infinite: this.settings.infinite,
            adaptiveHeight: true,
            responsive: [{
                    breakpoint: 1200,
                    settings: {
                        slidesToShow: this.settings.slidesToShow1200,
                        slidesToScroll: this.settings.slidesToScroll1200
                    }
                },
                {
                    breakpoint: 992,
                    settings: {
                        slidesToShow: this.settings.slidesToShow992,
                        slidesToScroll: this.settings.slidesToScroll992
                    }
                },
                {
                    breakpoint: 768,
                    settings: {
                        slidesToShow: this.settings.slidesToShow768,
                        slidesToScroll: this.settings.slidesToScroll768
                    }
                },
                {
                    breakpoint: 480,
                    settings: {
                        slidesToShow: 1,
                        slidesToScroll: this.settings.slidesToScroll480
                    }
                }
            ]
        })
    }

    Carousels.prototype = _.assignIn({}, Carousels.prototype, {
        _a11y: function(event, obj) {
            var $list = obj.$list;
            var $wrapper = this.$container.parent();

            // Remove default Slick aria-live attr until slider is focused
            $list.removeAttr('aria-live');

            // When an element in the slider is focused set aria-live
            $wrapper.on('focusin', function(evt) {
                if ($wrapper.has(evt.target).length) {
                    $list.attr('aria-live', 'polite');
                }
            });

            // Remove aria-live
            $wrapper.on('focusout', function(evt) {
                if ($wrapper.has(evt.target).length) {
                    $list.removeAttr('aria-live');
                }
            });
        },

        _goToSlide: function(slideIndex) {
            this.$container.slick('slickGoTo', slideIndex);
        },

        onUnload: function() {
            delete this.$container;
        },

        onBlockSelect: function(evt) {
            // Ignore the cloned version
            var $slide = $(
                '.carousel__slide-wrapper--' + evt.detail.blockId + ':not(.slick-cloned)'
            );
            var slideIndex = $slide.data('slick-index');

            // Go to selected slide, pause autoplay
            this._goToSlide(slideIndex);

        }
    });

    return Carousels;
})()

// Productlists
theme.Productlists = (function() {
    function Productlists(container) {
        this.$container = $(container).on('init', this._a11y.bind(this));
        this.settings = {
            slidesToShow: this.$container.data('slidestoshow') || 1,
            rows: this.$container.data('rows') || 1,
            arrows: this.$container.data('arrows') || false,
            dots: this.$container.data('dots') || false,
            draggable: this.$container.data('draggable') || false,
            infinite: this.$container.data('infinite') || false,
        }
        this.settings.slidesToShow1200 = (this.settings.slidesToShow - 1) > 1 ? (this.settings.slidesToShow - 1) : 1;
        this.settings.slidesToShow992 = (this.settings.slidesToShow - 2) > 1 ? (this.settings.slidesToShow - 2) : 1;
        this.settings.slidesToShow768 = (this.settings.slidesToShow - 3) > 1 ? (this.settings.slidesToShow - 3) : 1;
        this.settings.slidesToShow480 = 2;
        this.$container.slick({
            rtl: theme.rtl,
            accessibility: true,
            slidesToShow: this.settings.slidesToShow,
            slidesToScroll: this.settings.slidesToShow,
            rows: this.settings.rows,
            arrows: this.settings.arrows,
            dots: this.settings.dots,
            infinite: this.settings.infinite,
            draggable: this.settings.draggable,
            responsive: [{
                    breakpoint: 1200,
                    settings: {
                        slidesToShow: this.settings.slidesToShow1200,
                        slidesToScroll: this.settings.slidesToShow1200
                    }
                },
                {
                    breakpoint: 992,
                    settings: {
                        slidesToShow: this.settings.slidesToShow992,
                        slidesToScroll: this.settings.slidesToShow992
                    }
                },
                {
                    breakpoint: 768,
                    settings: {
                        slidesToShow: this.settings.slidesToShow768,
                        slidesToScroll: this.settings.slidesToShow768
                    }
                },
                {
                    breakpoint: 480,
                    settings: {
                        slidesToShow: this.settings.slidesToShow480,
                        slidesToScroll: this.settings.slidesToShow480
                    }
                }
            ]
        }).css('opacity', '1');
    }

    Productlists.prototype = _.assignIn({}, Productlists.prototype, {
        _a11y: function(event, obj) {
            var $list = obj.$list;
            var $wrapper = this.$container.parent();

            // Remove default Slick aria-live attr until slider is focused
            $list.removeAttr('aria-live');

            // When an element in the slider is focused set aria-live
            $wrapper.on('focusin', function(evt) {
                if ($wrapper.has(evt.target).length) {
                    $list.attr('aria-live', 'polite');
                }
            });

            // Remove aria-live
            $wrapper.on('focusout', function(evt) {
                if ($wrapper.has(evt.target).length) {
                    $list.removeAttr('aria-live');
                }
            });
        },

        _goToSlide: function(slideIndex) {
            this.$container.slick('slickGoTo', slideIndex);
        },

        onUnload: function() {
            delete this.$container;
        }
    });

    return Productlists;
})();

// Producttabs
theme.Producttabs = (function() {
    function Producttabs(container) {
        var _self = this; // avoid conflict
        this.$container = $(container).on('init', this._a11y.bind(this));
        this.slickWrap = '.prdtab-content';
        this.settings = {
            slidesToShow: this.$container.data('slidestoshow') || 1,
            arrows: this.$container.data('arrows') || false,
            rows: this.$container.data('rows') || 1,
            dots: this.$container.data('dots') || false,
            draggable: this.$container.data('draggable') || false,
            infinite: this.$container.data('infinite') || false,
        }
        this.settings.slidesToShow1200 = (this.settings.slidesToShow - 1) > 1 ? (this.settings.slidesToShow - 1) : 1;
        this.settings.slidesToShow992 = (this.settings.slidesToShow - 2) > 1 ? (this.settings.slidesToShow - 2) : 1;
        this.settings.slidesToShow768 = (this.settings.slidesToShow - 3) > 1 ? (this.settings.slidesToShow - 3) : 1;
        this.settings.slidesToShow480 = 2;

        this._initSlick();
        this.$container.find('a[data-toggle="tab"]').on("shown.bs.tab", function(e) {
            _self._unSlick();
            _self._initSlick();
            theme.tooltip.load();
        })
    }

    Producttabs.prototype = _.assignIn({}, Producttabs.prototype, {
        _a11y: function(event, obj) {
            var $list = obj.$list;
            var $wrapper = this.$container.parent();

            // Remove default Slick aria-live attr until slider is focused
            $list.removeAttr('aria-live');

            // When an element in the slider is focused set aria-live
            $wrapper.on('focusin', function(evt) {
                if ($wrapper.has(evt.target).length) {
                    $list.attr('aria-live', 'polite');
                }
            });

            // Remove aria-live
            $wrapper.on('focusout', function(evt) {
                if ($wrapper.has(evt.target).length) {
                    $list.removeAttr('aria-live');
                }
            });
        },

        _getSliderSettings: function() {
            return {
                rtl: theme.rtl,
                accessibility: true,
                slidesToShow: this.settings.slidesToShow,
                slidesToScroll: this.settings.slidesToShow,
                arrows: this.settings.arrows,
                rows: this.settings.rows,
                dots: this.settings.dots,
                infinite: this.settings.infinite,
                draggable: this.settings.draggable,
                responsive: [{
                        breakpoint: 1200,
                        settings: {
                            slidesToShow: this.settings.slidesToShow1200,
                            slidesToScroll: this.settings.slidesToShow1200
                        }
                    },
                    {
                        breakpoint: 992,
                        settings: {
                            slidesToShow: this.settings.slidesToShow992,
                            slidesToScroll: this.settings.slidesToShow992
                        }
                    },
                    {
                        breakpoint: 768,
                        settings: {
                            slidesToShow: this.settings.slidesToShow768,
                            slidesToScroll: this.settings.slidesToShow768
                        }
                    },
                    {
                        breakpoint: 480,
                        settings: {
                            slidesToShow: this.settings.slidesToShow480,
                            slidesToScroll: this.settings.slidesToShow480
                        }
                    }
                ]
            }
        },

        _initSlick: function() {
            this.$container.find(this.slickWrap).slick(this._getSliderSettings()).css('opacity', '1');
        },

        _unSlick: function() {
            this.$container.find(this.slickWrap).slick('unslick');
        },

        onUnload: function() {
            delete this.$container;
        },

        onSelect: function() {
            this._unSlick();
            this._initSlick();
        },

        onBlockSelect: function(evt) {
            var navItem = $('.nav-link-' + evt.detail.blockId);
            navItem.tab('show');
            this._unSlick();
            this._initSlick();
        }
    });

    return Producttabs;
})();

theme.Video = (function() {
    var promiseYoutubeAPI;
    var promiseVimeoAPI;

    var youtube = {
        promiseAPI: function() {
            if (!promiseYoutubeAPI) {
                var tag = document.createElement('script');

                tag.src = 'https://www.youtube.com/iframe_api';
                var firstScriptTag = document.getElementsByTagName('script')[0];
                firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

                promiseYoutubeAPI = $.Deferred(function(defer) {
                    window.onYouTubeIframeAPIReady = defer.resolve;

                    setTimeout(function() {
                        defer.reject('Request for YouTube API timed out after 30 seconds.');
                    }, 30000);
                });
            }

            return promiseYoutubeAPI;
        },
        promisePlayer: function(id, options) {
            return this.promiseAPI().then(function() {
                return $.Deferred(function(defer) {
                    if (typeof window.YT === 'undefined') {
                        defer.reject(
                            "We're sorry, something went wrong. The YouTube API has not loaded correctly."
                        );
                    }

                    /* eslint-disable no-undef */
                    var player = new YT.Player(id, options); // global YT variable injected by YouTube API

                    player.addEventListener('onReady', function() {
                        defer.resolve(player);
                    });

                    setTimeout(function() {
                        defer.reject(
                            'Request for YouTube player has timed out after 30 seconds.'
                        );
                    }, 30000);
                });
            });
        }
    };

    var vimeo = {
        promiseAPI: function() {
            if (!promiseVimeoAPI) {
                promiseVimeoAPI = $.Deferred(function(defer) {
                    var tag = document.createElement('script');
                    tag.src = 'https://player.vimeo.com/api/player.js';
                    tag.onload = tag.onreadystatechange = function() {
                        if (!this.readyState || this.readyState === 'complete') {
                            defer.resolve();
                        }
                    };

                    var firstScriptTag = document.getElementsByTagName('script')[0];
                    firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

                    setTimeout(function() {
                        defer.reject('Request for Vimeo API timed out after 30 seconds.');
                    }, 30000);
                });
            }

            return promiseVimeoAPI;
        },

        promisePlayer: function(id, options) {
            return this.promiseAPI().then(function() {
                return $.Deferred(function(defer) {
                    if (typeof window.Vimeo === 'undefined') {
                        defer.reject(
                            "We're sorry, something went wrong. The Vimeo API has not loaded correctly."
                        );
                    }

                    var player = new window.Vimeo.Player(id, options);

                    setTimeout(function() {
                        defer.reject(
                            'Request for Vimeo player has timed out after 30 seconds.'
                        );
                    }, 30000);

                    player.ready().then(function() {
                        defer.resolve(player);
                    });
                });
            });
        }
    };

    var selectors = {
        loadPlayerButton: '.video-section__load-player-button',
        closePlayerButton: '.video-section__player-close',
        playerContainer: '.video-section__player',
        cover: '.video-section__cover',
        errorMessage: '.video-section__error',
        bodyOverlay: '.video-section__body-overlay',
        body: 'body'
    };
    var classes = {
        playerLoading: 'video-section--loading',
        playerLoaded: 'video-section--loaded',
        playerError: 'video-section--error',
        videoPlaying: 'video-playing'
    };

    function Video(container) {
        this.$container = $(container);
        var sectionId = this.$container.attr('data-section-id');
        this.namespace = '.' + sectionId;
        this.onLoad();
    }

    Video.prototype = _.assignIn({}, Video.prototype, {
        onLoad: function() {
            this.$container
                .on('click', selectors.loadPlayerButton, this._loadPlayer.bind(this))
                .on('click', selectors.closePlayerButton, this._closePlayer.bind(this))
                .on('click', selectors.bodyOverlay, this._closePlayer.bind(this));
        },

        _loadPlayer: function() {
            var $container = this.$container;
            var $playerContainer = $(selectors.playerContainer, $container);
            var playerType = this.$container.attr('data-video-type');

            var promiseVideoPlayer;

            if (playerType === 'youtube') {
                promiseVideoPlayer = this._loadYoutubePlayer($playerContainer[0]);
            } else if (playerType === 'vimeo') {
                promiseVideoPlayer = this._loadVimeoPlayer($playerContainer[0]);
            }

            return promiseVideoPlayer
                .then(this._onPlayerLoadReady.bind(this))
                .fail(this._onPlayerLoadError.bind(this));
        },

        _loadYoutubePlayer: function(container) {
            return youtube
                .promisePlayer(container, {
                    videoId: this.$container.attr('data-video-id'),
                    ratio: 16 / 9,
                    playerVars: {
                        modestbranding: 1,
                        autoplay: 1,
                        showinfo: 0,
                        rel: 0
                    }
                })
                .then(
                    function(player) {
                        this.player = player;
                    }.bind(this)
                );
        },

        _loadVimeoPlayer: function(container) {
            return vimeo
                .promisePlayer(container, {
                    id: this.$container.attr('data-video-id')
                })
                .then(
                    function(player) {
                        this.player = player;
                        this.player.play();
                    }.bind(this)
                );
        },

        _onPlayerLoadReady: function() {
            $(selectors.closePlayerButton, this.$container)
                .show()
                .focus();
            $(selectors.cover, this.$container).addClass(classes.playerLoaded);
            this.$container.addClass(classes.playerLoaded);

            this._setScrollPositionValues();

            $(selectors.body).addClass(classes.videoPlaying);

            $(document).on('keyup' + this.namespace, this._closeOnEscape.bind(this));
            $(window).on(
                'resize' + this.namespace,
                this._setScrollPositionValues.bind(this)
            );
            slate.a11y.trapFocus({
                $container: this.$container,
                namespace: this.namespace
            });
        },

        _onPlayerLoadError: function(err) {
            this.$container.addClass(classes.playerError);
            $(selectors.errorMessage, this.$container).text(err);
        },

        _closeOnEscape: function(evt) {
            if (evt.keyCode !== 27) {
                return;
            }

            this._closePlayer();
            $(selectors.loadPlayerButton, this.$container).focus();
        },

        _onScroll: function() {
            var scrollTop = $(window).scrollTop();

            if (
                scrollTop > this.videoTop + 0.25 * this.videoHeight ||
                scrollTop + this.windowHeight <
                this.videoBottom - 0.25 * this.videoHeight
            ) {
                // Debounce DOM edits to the next frame with requestAnimationFrame
                requestAnimationFrame(this._closePlayer.bind(this));
            }
        },

        _setScrollPositionValues: function() {
            this.videoHeight = this.$container.outerHeight(true);
            this.videoTop = this.$container.offset().top;
            this.videoBottom = this.videoTop + this.videoHeight;
            this.windowHeight = $(window).innerHeight();
        },

        _closePlayer: function() {
            $(selectors.body).removeClass(classes.videoPlaying);
            $(selectors.cover, this.$container).removeClass(classes.playerLoaded);
            this.$container.removeClass(classes.playerLoaded);
            $(selectors.closePlayerButton, this.$container).hide();

            slate.a11y.removeTrapFocus({
                $container: this.$container,
                namespace: this.namespace
            });

            if (typeof this.player.destroy === 'function') {
                this.player.destroy();
            } else if (typeof this.player.unload === 'function') {
                this.player.unload();
            }

            $(document).off(this.namespace);
            $(window).off(this.namespace);
        }
    });

    return Video;
})();

theme.CollectionsList = (function() {
    function CollectionsList(container) {
        var $container = (this.$container = $(container));
        var stretchImage = $container.is('[data-stretch-image]');

        // Early return if 'secondary image layout' is enabled
        if (stretchImage) return;

        var namespace = (this.namespace = '.' + $container.attr('data-section-id'));
        var self = this;

        self._collectionListFix();
        $(window).on(
            'resize' + namespace,
            $.debounce(250, function() {
                self._collectionListFix();
            })
        );
    }

    CollectionsList.prototype = _.assignIn({}, CollectionsList.prototype, {
        onUnload: function() {
            $(window).off(this.namespace);
        },

        _collectionListFix: function() {
            var numberRows = this.$container.find('.grid').data('number-rows');
            var $featureCards = this.$container.find('.featured-card');

            // We can exit if 'Use secondary image layout' is enabled
            if ($featureCards.is('[data-stretch-image]')) return;

            // Go through each of the rows
            for (var i = 0; i < numberRows; i++) {
                var maxWrapperHeight = 0;
                var maxHeaderHeight = 0;
                var $currentRow = $featureCards.filter(
                    "[data-row-number='" + (i + 1) + "']"
                );
                var $cardHeaders = $currentRow.find('.featured-card__header');

                // Find the max heights for each row
                $currentRow.each(function() {
                    var $cardTitle = $(this).find('.featured-card__title');
                    var $cardAction = $(this).find('.featured-card__action');
                    var $cardImageWrapper = $(this).find('.featured-card__image-wrapper');
                    var headerHeight =
                        $cardTitle.outerHeight() + $cardAction.outerHeight() + 65;
                    var wrapperHeight = $cardImageWrapper.outerHeight();
                    if (headerHeight > maxHeaderHeight) {
                        maxHeaderHeight = headerHeight;
                    }
                    if (wrapperHeight > maxWrapperHeight) {
                        maxWrapperHeight = wrapperHeight;
                    }
                });

                // Set the heights of the headers and cards for this row with padding
                $cardHeaders.outerHeight(maxHeaderHeight);
                $currentRow.height(maxWrapperHeight + maxHeaderHeight + 40);
            }
        }
    });

    return CollectionsList;
})();

theme.ParrallaxImage = (function() {
    function ParrallaxImage(container) {
        this.container = container;
        this.sectionId = $(container).attr('data-section-id');
        this.namespace = 'parallax-' + this.sectionId;
        var images = document.getElementsByClassName('thumbnail' + this.sectionId);
        new simpleParallax(images, {
            scale: 1.5,
            delay: .6,
        });
    }

    ParrallaxImage.prototype = $.extend({}, ParrallaxImage.prototype, {
        onUnload: function(evt) {
            var instance = new simpleParallax(images);
            instance.destroy();
            delete theme.ParrallaxImage[this.namespace];
        }
    });

    return ParrallaxImage;
})();

theme.init = function() {
    theme.customerTemplates.init();
    slate.rte.wrapTable();
    slate.rte.iframeReset();

    // Common a11y fixes
    slate.a11y.pageLinkFocus($(window.location.hash));

    $('.in-page-link').on('click', function(evt) {
        slate.a11y.pageLinkFocus($(evt.currentTarget.hash));
    });

    $('a[href="#"]').on('click', function(evt) {
        evt.preventDefault();
    });


    //scroll animation
    AOS.init({
        startEvent: 'DOMContentLoaded',
        offset: 30, // offset (in px) from the original trigger point
        delay: 0, // values from 0 to 3000, with step 50ms
        duration: 1000,
        once: true
    });
    window.addEventListener('load', function() {
        AOS.refresh();
    });


    // Sections
    var sections = new theme.Sections();
    sections.register('header', theme.HeaderSection);
    sections.register('product', theme.Product);
    sections.register('slideshow-section', theme.SlideshowSection);
    sections.register('cart', theme.Cart);
    sections.register('instagrams', theme.Instagrams);
    sections.register('masonries', theme.Masonry);
    sections.register('productlist', theme.Productlists);
    sections.register('producttab', theme.Producttabs);
    sections.register('slickCarousels', theme.slickCarousel);
    sections.register('video', theme.Video);
    sections.register('collections-list', theme.CollectionsList);
    sections.register('parallax-image', theme.ParrallaxImage);
    sections.register('bgcollection', theme.Bgcollection);

    // Standalone modules
    $(window).on('load', theme.articleImages);
    theme.passwordModalInit();
};

theme.articleImages = function() {
    var $indentedRteImages = $('.rte--indented-images');
    if (!$indentedRteImages.length) {
        return;
    }

    $indentedRteImages.find('img').each(function(i, el) {
        var $el = $(el);
        var attr = $el.attr('style');

        // Check if undefined or float: none
        if (!attr || attr === 'float: none;') {
            // Add class to parent paragraph tag if image is wider than container
            if ($el.width() >= $indentedRteImages.width()) {
                $el.parent('p').addClass('rte__image-indent');
            }
        }
    });
};

theme.passwordModalInit = function() {
    var $loginModal = $('#LoginModal');
    if (!$loginModal.length) {
        return;
    }

    // Initialize modal
    theme.PasswordModal = new window.Modals('LoginModal', 'login-modal', {
        focusOnOpen: '#Password'
    });

    // Open modal if errors exist
    if ($loginModal.find('.errors').length) {
        theme.PasswordModal.open();
    }
};

// CSS var ponyfill
theme.cssVar = (function() {
    cssVars();
})()

// Ajax search https://gist.github.com/awojtczyk/53d74c8af5f893841f33979b0cdcd6fe
theme.ajaxSearch = (function() {
    var $inputSearch = '.js-ajaxsearch',
        $resultsList = '.search-results',
        $input = $($inputSearch).find('input[name="q"]'),
        $currentAjaxRequest,
        $displayProducts = 6;

    $($inputSearch).css('position', 'relative').each(function() {
        $input.attr('autocomplete', 'off').bind('keyup change', function() {
            var term = $(this).val(),
                form = $(this).closest('form'),
                searchURL = '/search?type=product&q=*' + term + '*';
            if (term.length > 2 && term !== $(this).attr('data-old-term')) {
                $(this).attr('data-old-term', term);
                if ($currentAjaxRequest !== undefined) $currentAjaxRequest.abort();
                $currentAjaxRequest = $.getJSON(searchURL + '&view=json', function(data) {
                    $($resultsList).empty();

                    if (data.results_count === 0) {
                        $($resultsList).html('<p class="text-center">' + theme.strings.ajaxSearchNoResult + '</p>')
                    } else {
                        $.each(data.results, function(index, item) {
                            if (index < $displayProducts) {
                                var itemPrice = theme.Currency.formatMoney(item.price, theme.moneyFormat);
                                var link = $('<a class="d-inline-flex ' + index + '"></a>')
                                    .attr('href', item.url)
                                    .append('<span class="image"><img src="' + item.thumbnail + '" /></span>')
                                    .append('<div class="meta"><p class="title">' + item.title + '</p>' + itemPrice + '</div>')
                                    .wrap('<div class="ajax-search-item"></div>');
                                $($resultsList).append(link.parent());
                                theme.updateCurrencies();
                            }
                        });
                        if (data.results_count > $displayProducts) {
                            $($resultsList).append('<a class="btn btn--full" href="' + searchURL + '">' + theme.strings.ajaxSearchViewAll + ' (' + data.results_count + ')</a>');
                        }
                    }
                    $($resultsList).addClass('active').fadeIn(200);
                });
            }
        });
    });

    //escape when click somethings
    $(document).click(function(event) {
        var target = event.target;
        if (!$(target).is($inputSearch) && !$(target).parents().is($inputSearch)) {
            $($resultsList).slideUp(300);
        }
    });
})();

// Quickview https://github.com/kellyvaughn/quickview-for-shopify/blob/master/quickview.js.liquid
theme.quickview = (function() {
    var product_handle = '',
        quickviewButtonClass = '.js-btn-quickview',
        quickviewId = '#jsQuickview',
        quickviewOption = '#jsQuickview select',
        quickviewThumb = '#qv-product-images',
        quickviewAddCartButton = '.qv-add-button',
        quickviewPrice = '.qv-product-price',
        quickviewComparePrice = '.qv-product-compare-price';

    // 1. Show quickview
    $(document).on('click', quickviewButtonClass, function() {
        var quickviewAvaible = $(this).attr("data-pavailable");
        product_handle = $(this).data('handle');
        //ResetQuickview
        $(quickviewId).removeClass().addClass('modal fade');
        $(quickviewThumb).removeClass().empty();
        $('.qv-product-options').empty();

        //Pushdata
        $(quickviewId).addClass(product_handle).data('handle', product_handle);
        jQuery.getJSON('/products/' + product_handle + '.js', function(product) {
            var title = product.title;
            var type = product.type;
            var vendor = product.vendor;
            var price = 0;
            var compare_price = 0;
            var desc = product.description.slice(0, 90);
            var images = product.images;
            var variants = product.variants;
            var options = product.options;
            var url = '/products/' + product_handle;
            $('.qv-product-title').text(title);
            $('.qv-product-type').text(type);
            $('.qv-product-description').html(desc);
            $('.qv-view-product').attr('href', url);
            $('.qv-view-type').text(type);
            $('.qv-view-vendor').text(vendor)
            if (quickviewAvaible == 'true') {
                $(quickviewAddCartButton).prop('disabled', false).html(theme.strings.addToCart);
            } else {
                $(quickviewAddCartButton).prop('disabled', true).html(theme.strings.soldOut);
            }
            $(product.variants).each(function(i, variants) {
                if (variants.sku != null) {
                    $('.qv-sku').addClass("show").removeClass("hide");
                    $('.qv-view-sku').text(product.variants[0].sku);
                } else {
                    $('.qv-sku').addClass("hide").removeClass("show");
                }

            });
            var imageCount = $(images).length;
            $(images).each(function(i, image) {
                image_embed = '<div><img src="' + image + '"></div>';
                image_embed = image_embed.replace('.jpg', '_800x.jpg').replace('.png', '_800x.png');
                $(quickviewThumb).append(image_embed);
            });
            $(quickviewThumb).slick({
                rtl: theme.rtl,
                'dots': true,
                'arrows': true,
                'respondTo': 'min',
                'useTransform': true
            }).css('opacity', '1');

            if (product.variants[0].option1 !== "Default Title") {
                $(options).each(function(i, option) {
                    var name = option.name;
                    var opt = name.replace(/ /g, '-').toLowerCase();
                    var selectClass = '.option.' + opt;
                    $('.qv-product-options').append('<div class="option-selection ' + opt + '"><span class="option text-uppercase font-weight-bold text-body">' + option.name + '</span><select class="option-' + i + ' option ' + opt + '"></select></div>');
                    $(option.values).each(function(i, value) {
                        $('.option.' + opt).append($('<option>', {
                            value: value,
                            text: value
                        }));
                    });
                });
            }
            $(product.variants).each(function(i, v) {
                if (v.inventory_quantity == 0) {
                    return true
                } else {
                    price = theme.Currency.formatMoney(v.price, theme.moneyFormat);
                    compare_price = theme.Currency.formatMoney(v.compare_at_price, theme.moneyFormat);
                    $(quickviewPrice).html(price);
                    if (v.compare_at_price !== null) {
                        $(quickviewComparePrice).html(compare_price).show();
                    } else {
                        $(quickviewComparePrice).hide();
                    }
                    theme.updateCurrencies();
                    $('select.option-0').val(v.option1);
                    $('select.option-1').val(v.option2);
                    $('select.option-2').val(v.option3);
                    return false
                }
            });
        });
        //addCartQuickview
    });
    // 2. Add to cart
    $(document).on('click', quickviewAddCartButton, function() {
        product_handle = $(quickviewId).data('handle');
        var qty = $('.qv-quantity').val(),
            selectedOptions = '',
            var_id = '';

        function processCart() {
            jQuery.post('/cart/add.js', {
                    quantity: qty,
                    id: var_id
                }, null, "json").done(function(item) {
                    var htmlVariant = item.variant_title !== null ? '<i>(' + item.variant_title + ')</i>' : '';
                    var styleCart = $('.js-mini-cart').attr("data-cartmini");
                    if (styleCart != 'true') {
                        var htmlAlert = '<div class="media mt-2 alert--cart"><a class="mr-3" href="/cart"><img class="lazyload" data-src="' + item.image + '"></a><div class="media-body align-self-center"><p class="m-0 font-weight-bold">' + item.product_title + ' x ' + item.quantity + '</p>' + htmlVariant + '<div><div>';
                        theme.alert.new(theme.strings.addToCartSuccess, htmlAlert, 3000, 'notice');
                    }
                    theme.miniCart.updateElements();
                    theme.miniCart.generateCart();
                })
                .fail(function($xhr) {
                    var data = $xhr.responseJSON;
                    theme.alert.new('', data.description, 3000, 'warning');
                });
        }
        $(quickviewOption).each(function(i) {
            if (selectedOptions == '') {
                selectedOptions = $(this).val();
            } else {
                selectedOptions = selectedOptions + ' / ' + $(this).val();
            }
        });
        jQuery.getJSON('/products/' + product_handle + '.js', function(product) {
            if (product.variants.length === 1) {
                var_id = product.variants[0].id;
            } else {
                $(product.variants).each(function(i, v) {
                    if (v.title == selectedOptions) {
                        var_id = v.id;
                    }
                });
            }
            processCart();
        });
    });
    // 3. Select variants
    $(document).on('change', quickviewOption, function() {
        var selectedOptions = '';
        $(quickviewOption).each(function(i) {
            if (selectedOptions == '') {
                selectedOptions = $(this).val();
            } else {
                selectedOptions = selectedOptions + ' / ' + $(this).val();
            }
        });
        jQuery.getJSON('/products/' + product_handle + '.js', function(product) {
            $(product.variants).each(function(i, v) {
                if (v.title == selectedOptions) {
                    if (v.featured_image !== null) {
                        var iSlick = v.featured_image.position - 1;
                        $(quickviewThumb).slick('slickGoTo', iSlick);
                    }
                    var price = theme.Currency.formatMoney(v.price, theme.moneyFormat);
                    var compare_price = theme.Currency.formatMoney(v.compare_at_price, theme.moneyFormat);
                    $(quickviewPrice).html(price);
                    $(quickviewComparePrice).html(compare_price);
                    if (v.sku != null) {
                        $('.qv-sku').addClass("show").removeClass("hide");
                        $('.qv-view-sku').text(v.sku);
                    } else {
                        $('.qv-sku').addClass("hide").removeClass("show");
                    }
                    if (v.compare_at_price !== null) {
                        $(quickviewComparePrice).html(compare_price).show();
                    } else {
                        $(quickviewComparePrice).hide();
                    }
                    theme.updateCurrencies();
                    if (v.inventory_management === null) {
                        $(quickviewAddCartButton).prop('disabled', false).val(theme.strings.addToCart);
                    } else {
                        if (v.inventory_quantity < 1) {
                            $(quickviewAddCartButton).prop('disabled', true).val(theme.strings.soldOut);
                        } else {
                            $(quickviewAddCartButton).prop('disabled', false).val(theme.strings.addToCart);
                        }
                    }
                }
            });
        });
    });
})()

//Button add to cart (in grid item)
theme.addCartButton = (function() {
    var buttonClass = '.js-grid-cart';
    $(document).on('click', buttonClass, function() {
        var $this = $(this);
        var id = $this.data('id');
        $this.addClass('is-loading');
        Shopify.addItem(id, 1, function(item) {
            location.href = "/cart";
            var htmlVariant = item.variant_title !== null ? '<i>(' + item.variant_title + ')</i>' : '';
            var styleCart = $('.js-mini-cart').attr("data-cartmini");
            if (styleCart != 'true') {
                var htmlAlert = '<div class="media mt-2 alert--cart"><a class="mr-3" href="/cart"><img class="lazyload" data-src="' + item.image + '"></a><div class="media-body align-self-center"><p class="m-0 font-weight-bold">' + item.product_title + ' x ' + item.quantity + '</p>' + htmlVariant + '<div><div>';
            }
            theme.miniCart.updateElements();
            theme.miniCart.generateCart();
            setTimeout(function() {
                styleCart != 'true' ? theme.alert.new(theme.strings.addToCartSuccess, htmlAlert, 3000, 'notice') : '';
                $this.removeClass('is-loading');
            }, 1000);
        });
    })
})()

// Button add to cart (in grid item)
//theme.addCartButton = (function(){
//  var buttonClass = '.js-grid-cart';
//  $(document).on('click',buttonClass,function(){
//    var $this = $(this);
//    var id = $this.data('id');
//    $this.addClass('is-loading');
//    Shopify.addItem(id,1,function(item){
//      var htmlVariant = item.variant_title !== null ? '<i>('+item.variant_title+')</i>' : '';
//      var styleCart = $('.js-mini-cart').attr("data-cartmini");
//        if(styleCart != 'true'){
//          var htmlAlert = '<div class="media mt-2 alert--cart"><a class="mr-3" href="/cart"><img class="lazyload" data-src="'+item.image+'"></a><div class="media-body align-self-center"><p class="m-0 font-weight-bold">'+item.product_title+' x '+ item.quantity +'</p>'+htmlVariant+'<div><div>';
//        }
//      theme.miniCart.updateElements();
//      theme.miniCart.generateCart();
//      setTimeout(function() {
//        styleCart != 'true' ? theme.alert.new(theme.strings.addToCartSuccess,htmlAlert,3000,'notice'): '';
//        $this.removeClass('is-loading');
//      }, 1000);
//    });
// })
//})()

// Multi currencies 
if (theme.enableCurrencies) {
    // Can be 'money_format' or 'money_with_currency_format'
    Currency.format = 'money_format';
    var shopCurrency = Shopify.currency.active;
    var cookieCurrency = Currency.cookie.read();
    // Fix for customer account pages 
    jQuery('span.money span.money').each(function() {
        jQuery(this).parent('span.money').removeClass('money');
    });
    // Add precalculated shop currency to data attribute 
    jQuery('span.money').each(function() {
        jQuery(this).attr('data-currency-' + Shopify.currency.active, jQuery(this).html());
    });
    // Select all your currencies buttons.
    var buttons = jQuery('#currencies a'),
        currentCurrencies = jQuery('.pre-currencies');
    // When the page loads.
    if (cookieCurrency == null || cookieCurrency == shopCurrency) {
        Currency.currentCurrency = shopCurrency;
    } else {
        Currency.currentCurrency = cookieCurrency;
        Currency.convertAll(shopCurrency, cookieCurrency);
        buttons.removeClass('selected');
        jQuery('#currencies a[data-currency=' + cookieCurrency + ']').addClass('selected');
        var htmlCurrently = jQuery('#currencies a[data-currency=' + cookieCurrency + ']').html();
        currentCurrencies.html(htmlCurrently);
    }
    buttons.click(function() {
        buttons.removeClass('selected');
        jQuery(this).addClass('selected');
        var newCurrency = jQuery(this).attr('data-currency');
        var htmlCurrently = jQuery(this).html();
        currentCurrencies.html(htmlCurrently);
        Currency.convertAll(Currency.currentCurrency, newCurrency);
    });
    // For product options.
    var original_selectCallback = window.selectCallback;
    var selectCallback = function(variant, selector) {
        original_selectCallback(variant, selector);
        Currency.convertAll(shopCurrency, jQuery('#currencies a.selected').attr('data-currency'));
    };
}
theme.updateCurrencies = function() {
    Currency.convertAll(shopCurrency, jQuery('#currencies a.selected').attr('data-currency'));
}



// Free shipping
theme.freeShipping = (function() {
    var $freeShippingClass = $('.js-free-shipping'),
        $freeShippingTextClass = $('.js-free-shipping-text'),
        $free_fisrt = $freeShippingClass.attr('data-start'),
        $free_end = $freeShippingClass.attr('data-end')
    minOrderValue = parseInt($freeShippingClass.data('value')) || 0,
        $percentClass = $('.js-free-shipping .progress-bar');

    function generate(cart) {
        var priceCart = cart.total_price;
        if (priceCart >= minOrderValue) {
            $percentClass.css('width', '100%').removeClass('progress-bar-striped bg-primary');
            $freeShippingTextClass.text(theme.strings.freeShipping)
        } else {
            let percent = priceCart / minOrderValue * 100;
            let left = Shopify.formatMoney((minOrderValue - priceCart), theme.moneyFormat);
            $percentClass.css('width', percent + '%').addClass('progress-bar-striped primary');
            $freeShippingTextClass.html($free_fisrt + ' ' + left + ' ' + $free_end);
            theme.updateCurrencies();
        }
    }

    Shopify.getCart(function(cart) {
        generate(cart);
    });

    return {
        load: generate
    }
})()

// Shipping time - https://github.com/phstc/jquery-dateFormat
theme.shippingTime = (function() {
    var $shippingTime = $('.js-shipping-time'),
        shippingTime = $shippingTime.data('time') || '',
        now = new Date(),
        restHour = 23 - now.getHours(),
        restMinute = 59 - now.getMinutes();
    if (shippingTime !== '') {
        var nextTime = new Date(now.getTime() + shippingTime * 86400000),
            formatTime = $.format.date(nextTime, "ddd, dd MMMM yyyy"),
            htmlShipping = 'Order in the next <b>' + restHour + '</b> hours <b>' + restMinute + '</b> minutes to get it by <b>' + formatTime + '</b>. ';
        $shippingTime.html(htmlShipping);
    }
})()

// Infinite scroll - https://github.com/Elkfox/Ajaxinate/blob/master/dist/ajaxinate.min.js
theme.infiniteScroll = (function() {
    function initInfiniteScroll() {
        if ($('.AjaxinateLoop').length === 0) {
            return;
        } else {
            var endlessScroll = new Ajaxinate({
                loadingText: '<div class="text-center"><div class="' + theme.loadingClass + '" role="status"></div></div>',
                callback: function() {
                    theme.wishlist.load();
                    theme.compare.load();
                    theme.countdown.load();
                    theme.priceRange.load();
                    theme.tooltip.load();
                    theme.collectionView.triggerView();
                    theme.swatchCard2.load();
                }
            });
        }
    }

    // Infinite scroll in other page (blog, list-collection)
    function initOtherPages() {
        var otherPages = new Ajaxinate({
            loadingText: '<div class="text-center"><div class="' + theme.loadingClass + '" role="status"></div></div>',
            container: '.js-pagination-content',
            pagination: '.js-pagination'
        });
    }

    document.addEventListener("DOMContentLoaded", function() {
        initInfiniteScroll();
        initOtherPages();
    });

    return {
        load: initInfiniteScroll
    }
})()

// Scroll to fixed
theme.scrollToFixed = (function() {
    var window_width = $(window).width();

    if (window_width < 768) {
        $(".js-stick-parent").trigger("sticky_kit:detach");
    } else {
        make_sticky();
    }
    $(window).resize(function() {

        window_width = $(window).width();

        if (window_width < 768) {
            $(".js-stick-parent").trigger("sticky_kit:detach");
        } else {
            make_sticky();
        }
    });

    function make_sticky() {
        $('.js-stick-parent').stick_in_parent();
    }

})()


theme.headersidebar = (function() {
    $('#dismiss, .overlaysidebar').on('click', function() {
        // hide sidebar
        $('#sidebar').removeClass('active');
        // hide overlay
        $('.overlaysidebar').removeClass('active');
    });

    $('#sidebarCollapse').on('click', function() {
        // open sidebar
        $('#sidebar').addClass('active');
        // fade in the overlay
        $('.overlaysidebar').addClass('active');
        $('.collapse.in').toggleClass('in');
        $('a[aria-expanded=true]').attr('aria-expanded', 'false');
    });
})()

// Wishlist
theme.wishlist = (function() {
    var wishlistButtonClass = '.js-btn-wishlist',
        wishlistRemoveButtonClass = '.js-remove-wishlist',
        $wishlistCount = $('.js-wishlist-count'),
        $wishlistContainer = $('.js-wishlist-content'),
        wishlistObject = JSON.parse(localStorage.getItem('localWishlist')) || [],
        wishlistPageUrl = $('.js-wishlist-link').attr('href'),
        loadNoResult = function() {
            // $wishlistContainer.html('<div class="col text-center"><div class="alert alert-warning d-inline-block">' + theme.strings.wishlistNoResult + '</div></div>');
        };

    function updateWishlist(self) {
        var productHandle = $(self).data('handle'),
            allSimilarProduct = $(wishlistButtonClass + '[data-handle="' + productHandle + '"]');
        var isAdded = $.inArray(productHandle, wishlistObject) !== -1 ? true : false;
        if (isAdded) {
            // go to wishlist page
            window.location.href = wishlistPageUrl;
        } else {
            wishlistObject.push(productHandle);
            allSimilarProduct.fadeOut('slow').fadeIn('fast').html(theme.strings.wishlistIconAdded + theme.strings.wishlistTextAdded);
            //change tooltip
            allSimilarProduct.attr('data-original-title', theme.strings.wishlistTextAdded);
            $('.tooltip-inner').text(theme.strings.wishlistTextAdded);
        }
        localStorage.setItem('localWishlist', JSON.stringify(wishlistObject));
        $wishlistCount.text(wishlistObject.length);
    };

    function loadWishlist() {
        $wishlistContainer.html('');
        //page wishlist
        if (wishlistObject.length > 0) {
            for (var i = 0; i < wishlistObject.length; i++) {
                var productHandle = wishlistObject[i];
                Shopify.getProduct(productHandle, function(product) {
                    var htmlProduct = '';
                    var productPrice = product.price_varies ? 'from ' + theme.Currency.formatMoney(product.price_min, theme.moneyFormat) : theme.Currency.formatMoney(product.price, theme.moneyFormat);
                    var productComparePrice = product.compare_at_price_min !== 0 ? theme.Currency.formatMoney(product.compare_at_price_min, theme.moneyFormat) : '';
                    htmlProduct += '<div class="js-wishlist-item col-md-4 col-sm-6 col-xs-6 col-12 mb-4">';
                    htmlProduct += '<div class="js-wishlist-itembox">';
                    htmlProduct += '<div class=" d-flex flex-row p-4">';
                    htmlProduct += '	<a class="d-inline-block mr-4 " href="' + product.url + '">';
                    htmlProduct += '		<img src="' + product.featured_image + '"/>';
                    htmlProduct += '	</a>';
                    htmlProduct += '	<div><a href="' + product.url + '" class="title-prouct d-block h4 text-body" >' + product.title + '</a>';
                    htmlProduct += '	<span> ' + productPrice + '</span>';
                    htmlProduct += '	 <s>' + productComparePrice + '</s></div>';
                    htmlProduct += '<button class="btn js-remove-wishlist" data-handle="' + product.handle + '">' + theme.strings.wishlistRemove + '</button>';
                    htmlProduct += '</div>';
                    htmlProduct += '</div>';
                    htmlProduct += '</div>';
                    $wishlistContainer.append(htmlProduct);
                    theme.updateCurrencies();
                });
            }
        } else {
            loadNoResult();
        }

        //count items
        $wishlistCount.text(wishlistObject.length);

        //button text
        $(wishlistButtonClass).each(function() {
            var productHandle = $(this).data('handle');
            var iconWishlist = $.inArray(productHandle, wishlistObject) !== -1 ? theme.strings.wishlistIconAdded : theme.strings.wishlistIcon;
            var textWishlist = $.inArray(productHandle, wishlistObject) !== -1 ? theme.strings.wishlistTextAdded : theme.strings.wishlistText;
            $(this).html(iconWishlist + textWishlist).attr('title', textWishlist);
        });
    }

    $(document).on('click', wishlistButtonClass, function(event) {
        event.preventDefault();
        updateWishlist(this);
    });
    $(document).on('click', wishlistRemoveButtonClass, function() {
        var productHandle = $(this).data('handle'),
            allSimilarProduct = $(wishlistButtonClass + '[data-handle="' + productHandle + '"]');

        //update button
        allSimilarProduct.html(theme.strings.wishlistIcon + theme.strings.wishlistText);
        //update tooltip
        allSimilarProduct.attr('data-original-title', theme.strings.wishlistText);
        $('.tooltip-inner').text(theme.strings.wishlistText);
        //update Object
        wishlistObject.splice(wishlistObject.indexOf(productHandle), 1);
        localStorage.setItem('localWishlist', JSON.stringify(wishlistObject));
        // Remove element
        $(this).closest('.js-wishlist-item').fadeOut(); // or .remove()
        //count
        $wishlistCount.text(wishlistObject.length);
        if (wishlistObject.length === 0) {
            loadNoResult();
        }
    });

    loadWishlist();
    $(document).on('shopify:section:load', loadWishlist);
    return {
        load: loadWishlist
    }
})()

// Compare
theme.compare = (function() {
    var compareButtonClass = '.js-btn-compare',
        compareRemoveButtonClass = '.js-remove-compare',
        $compareCount = $('.js-compare-count'),
        $compareContainer = $('.js-compare-content'),
        compareObject = JSON.parse(localStorage.getItem('localCompare')) || [],
        alertClass = 'notice';

    function updateCompare(self) {
        var productHandle = $(self).data('handle'),
            alertText = '';
        var isAdded = $.inArray(productHandle, compareObject) !== -1 ? true : false;
        if (isAdded) {
            compareObject.splice(compareObject.indexOf(productHandle), 1);
            alertText = theme.strings.compareNotifyRemoved;
            alertClass = 'notice';
        } else {
            if (compareObject.length === 4) {
                alertText = theme.strings.compareNotifyMaximum;
                alertClass = 'error';
            } else {
                alertClass = 'notice';
                compareObject.push(productHandle);
                alertText = theme.strings.compareNotifyAdded;
            }
        }
        localStorage.setItem('localCompare', JSON.stringify(compareObject));
        theme.alert.new(theme.strings.compareText, alertText, 2000, alertClass);
        $compareCount.text(compareObject.length);
    };

    function loadCompare() {
        var compareGrid;
        $compareContainer.html('');
        //popup compare
        if (compareObject.length > 0) {
            compareGrid = compareObject.length === 1 ? 'col-md-6 col-sm-6' : 'col';
            for (var i = 0; i < compareObject.length; i++) {
                var productHandle = compareObject[i];
                Shopify.getProduct(productHandle, function(product) {
                    var htmlProduct = '',
                        productPrice = product.price_varies ? 'from ' + theme.Currency.formatMoney(product.price_min, theme.moneyFormat) : theme.Currency.formatMoney(product.price, theme.moneyFormat),
                        productComparePrice = product.compare_at_price_min !== 0 ? theme.Currency.formatMoney(product.compare_at_price_min, theme.moneyFormat) : '',
                        productAvailable = product.available ? theme.strings.available : theme.strings.unavailable,
                        productAvailableClass = product.available ? 'alert-success' : 'alert-danger',
                        productTypeHTML = product.type !== "" ? '<a href="/collections/types?q=' + product.type + '">' + product.type + '</a>' : '<span>' + theme.strings.none + '</span>',
                        productVendorHTML = product.vendor !== "" ? '<a href="/collections/vendors?q=' + product.vendor + '">' + product.vendor + '</a>' : '<span>' + theme.strings.none + '</span>';
                    htmlProduct += '<div class="compare-item ' + compareGrid + ' col-xs-6">';
                    htmlProduct += '	<a href="' + product.url + '">';
                    htmlProduct += '		<img src="' + Shopify.resizeImage(product.featured_image, 'x300') + '"/>';
                    htmlProduct += '	</a>';
                    htmlProduct += '	<hr /><h5 >' + product.title + '</h5>';
                    htmlProduct += '	<hr /><s>' + productComparePrice + '</s>';
                    htmlProduct += '	<span> ' + productPrice + '</span>';
                    htmlProduct += '	<hr /><span class=' + productAvailableClass + '> ' + productAvailable + '</span>';
                    htmlProduct += '	<hr />' + productTypeHTML;
                    htmlProduct += '	<hr />' + productVendorHTML;
                    htmlProduct += '  <hr /><button class="btn js-remove-compare btn-theme gradient-theme" data-handle="' + product.handle + '">' + theme.strings.compareRemove + '</button>';
                    htmlProduct += '</div>';
                    $compareContainer.append(htmlProduct);
                    theme.updateCurrencies();
                });
            }
        } else {
            // $compareContainer.html('<div class="alert alert-warning d-inline-block">' + theme.strings.compareNoResult + '</div>');
        }

        //button text
        $(compareButtonClass).each(function() {
            var productHandle = $(this).data('handle');
            var status = $.inArray(productHandle, compareObject) !== -1 ? 'added' : '';
            $(this).removeClass('added').addClass(status);
        });

        //count items
        $compareCount.text(compareObject.length);
    }
    $(document).on('click', compareButtonClass, function(event) {
        event.preventDefault();
        updateCompare(this);
        loadCompare();
    });
    $(document).on('click', compareRemoveButtonClass, function() {
        var productHandle = $(this).data('handle');
        compareObject.splice(compareObject.indexOf(productHandle), 1);
        localStorage.setItem('localCompare', JSON.stringify(compareObject));
        loadCompare();
    });

    loadCompare();
    $(document).on('shopify:section:load', loadCompare);
    return {
        load: loadCompare
    }
})()

// Popup newsletter
theme.popupNewletter = (function() {
    var $popupNewsletter = $('#jsPopupNewsletter'),
        $newsletterForm = $('#jsPopupNewsletter form'),
        date = new Date(),
        minutes = theme.timePopupNewsletter;
    minutesdelay = $popupNewsletter.attr('data-delay');
    if ($popupNewsletter.length === 1) {
        date.setTime(date.getTime() + (minutes * 60 * 1000));
        var setCookies = function() {
            $.cookie('cookiesNewsletter', 'disabled', { expires: date, path: '/' });
        };
        if ($.cookie('cookiesNewsletter') !== "disabled") {
            $(window).on('load', function() {
                setTimeout(function() {
                    $popupNewsletter.modal('show');
                }, minutesdelay * 1000);
            });
            $popupNewsletter.on('hidden.bs.modal', setCookies);
            $newsletterForm.submit(setCookies);
        }
    }
})()

// Cookie policy
theme.cookie = (function() {
    var $policy = $('.js-cookie-policy'),
        $closeButton = $('.js-btn-ok'),
        isOk = localStorage.getItem('localCookie') || '';
    if (isOk === '') {
        $policy.fadeIn('slow');
    }
    $closeButton.on('click', function() {
        localStorage.setItem('localCookie', 'accept');
        $policy.fadeOut('slow');
    })
})()

// Announcement Bar
theme.announcement = (function() {
    var $bar = $('.js-announcement-bar'),
        $closeButton = $('.js-ab-close'),
        isClosed = localStorage.getItem('localAnnouncement') || '';
    if (isClosed === '') {
        $bar.fadeIn();
        $bar.closest('.body-theme').addClass('body-announcement-bar');
    }
    $closeButton.on('click', function() {
        localStorage.setItem('localAnnouncement', 'closed');
        $bar.slideUp();
        $bar.closest('.body-theme').removeClass('body-announcement-bar');
    })
})()

// Open external link in new tab
theme.exLink = (function() {
    var links = document.links;
    for (let i = 0, linksLength = links.length; i < linksLength; i++) {
        if (links[i].hostname !== window.location.hostname && $(links[i]).attr('href') !== 'javascript:void(0)') {
            links[i].target = '_blank';
        }
    }
})()

// Deal- countdown
theme.countdown = (function() {
    function initCountdown() {
        $(".js-countdown").each(function() {
            var endTime = $(this).data('time'),
                htmlLayout = "<ul class='list--inline'><li class='gradient-theme-vertical'><span class='countdown-time'>%%D%%</span><span class='countdown-text'>Days</span></li><li class='gradient-theme-vertical'><span class='countdown-time'>%%H%%</span><span class='countdown-text'>Hours</span></li><li class='gradient-theme-vertical'><span class='countdown-time'>%%M%%</span><span class='countdown-text'>Mins</span></li><li class='gradient-theme-vertical'><span class='countdown-time'>%%S%%</span><span class='countdown-text'>Secs</span></li></ul>";
            $(this).lofCountDown({
                TargetDate: endTime,
                DisplayFormat: htmlLayout,
                FinishMessage: '<span class="alert alert-warning d-inline-block">' + theme.strings.countdownEndText + '</span>'
            });
        });
    }
    initCountdown();
    return {
        load: initCountdown
    }
})()

// Price range - Collection page
theme.priceRange = (function() {
    function initPriceRange() {
        var min = 0,
            max = 0,
            slideRange = '#js-slider-range',
            productCard = '.js-product-card',
            slideRangeWrap = '.slider-range-wr',
            rangeMin = '.js-range-min',
            rangeMax = '.js-range-max',
            enablePriceRange = $('#js-slider-range').length === 1 ? true : false;

        if (enablePriceRange) {
            $(productCard).each(function() {
                if (eval($(this).data('price')) > max) max = eval($(this).data('price'));
                if (min == 0) min = eval($(this).data('price'));
                else if (eval($(this).data('price')) < min) min = eval($(this).data('price'));
            });

            if (min === max) {
                $(slideRangeWrap).fadeOut();
            } else {
                $(slideRangeWrap).fadeIn();
            }

            $(slideRange).slider({
                range: true,
                min: min,
                max: max,
                values: [min, max],
                slide: function(event, ui) {
                    var price1 = (Shopify.formatMoney(ui.values[0], theme.moneyFormat));
                    var price2 = (Shopify.formatMoney(ui.values[1], theme.moneyFormat));
                    $(rangeMin).html(price1);
                    $(rangeMax).html(price2);
                    theme.updateCurrencies();

                    // Show/Hide product when dragging
                    $(productCard).each(function() {
                        if (eval($(this).data('price')) >= ui.values[0] && eval($(this).data('price')) <= ui.values[1]) {
                            $(this).parent().fadeIn();
                        } else {
                            $(this).parent().fadeOut();
                        }
                    });
                }
            });

            var price1 = (Shopify.formatMoney(min, theme.moneyFormat));
            var price2 = (Shopify.formatMoney(max, theme.moneyFormat));
            $(rangeMin).html(price1);
            $(rangeMax).html(price2);
            theme.updateCurrencies();

        }
    }
    initPriceRange();
    return {
        load: initPriceRange
    }
})()

// Collection view - Collection page
theme.collectionView = (function() {
    var btnView = '.js-btn-view',
        btnViewActive = '.js-btn-view.active';

    $(document).on('click', btnView, function() {
        var value = $(this).data('col'),
            $gridItemCol = $('.js-col');

        $(btnView).removeClass('active');
        $(this).addClass('active');

        $gridItemCol.removeClass().addClass('js-col col-sm-6 col-12');
        if (value === 3) {
            $gridItemCol.addClass('col-lg-4');
        } else if (value === 4) {
            $gridItemCol.addClass('col-lg-3');
        } else if (value === 5) {
            $gridItemCol.addClass('col-lg-2-4');
        } else if (value === 6) {
            $gridItemCol.addClass('col-lg-2');
        };
    })

    function triggerCollectionView() {
        $(btnViewActive).trigger('click');
    }

    return {
        triggerView: triggerCollectionView
    }
})()

// Swath variant in card item
theme.swatchCard = (function() {
    $(document).on('click', '.js-swatch-card-item', function() { //click or mouseover
        $(".js-swatch-card-item").removeClass("active");
        $(this).addClass("active");
        var newImage = $(this).data('image');
        var id = $(this).data('id');
        var gridItem = $(this).closest('.js-product-card');
        gridItem.find('.product-card__image').find('img').attr('srcset', newImage);
        gridItem.find('.js-grid-cart').data('id', id).attr('data-id', id);
    });
})()

theme.swatchCard2 = (function() {
    function initVariant(id) {
        var productJson = JSON.parse($('.customJson-' + id).html());
        var $selectorForm = $('.customform-' + id);
        var $button = $('.js-customform-addtocart-' + id);
        var $buttontext = $button.find('span');
        var $wrapObject = $selectorForm.closest('.js-product-card');
        var options = {
            $container: $selectorForm,
            enableHistoryState: false,
            product: productJson,
            singleOptionSelector: '.single-option-selector-' + id,
            originalSelectorId: '#ProductSelect-' + id
        };
        var variants = new slate.Variants(options);
        var AjaxCart = new window.AjaxCart($selectorForm);
        var _updateButton = function(evt) {
            var variant = evt.variant;
            if (variant === undefined) {
                $button.prop('disabled', true).removeClass('btn--sold-out');
                $buttontext.html(theme.strings.unavailable);
            } else {
                if (variant.available) {
                    $button.removeClass('btn--sold-out').prop('disabled', false);
                    $buttontext.html(theme.strings.addToCart);
                } else {
                    $button.prop('disabled', true).addClass('btn--sold-out');
                    $buttontext.html(theme.strings.soldOut);
                }
            }
        }
        var _updateImage = function(evt) {
            var variant = evt.variant;
            var $mainImage = $wrapObject.find('.product-card__image').find('img');
            if (variant !== undefined && variant.featured_image !== null) {
                var variantImage = variant.featured_image;
                $mainImage.attr('srcset', variantImage.src);
            }
        }
        var _updatePrice = function(evt) {
            var $price = $wrapObject.find('.product-card__price');
            var variant = evt.variant;
            if (variant !== undefined) {
                var htmlComparePrice = variant.compare_at_price !== null ? '<s class="product-card__regular-price"><span class="money">' + variant.compare_at_price + '</span></s>' : '';
                var htmlPrice = '<span class="money">' + variant.price + '</span>' + htmlComparePrice;
                $price.html(htmlPrice);
                theme.updateCurrencies();
            }
        }
        variants.$container.on(
            'variantChange', _updateButton
        );
        variants.$container.on(
            'variantChange', _updateImage
        );
        variants.$container.on(
            'variantChange', _updatePrice
        );
    }

    function initForm() {
        $('.js-customform').each(function() {
            var id = $(this).data('id');
            initVariant(id);
        })
    }

    initForm();
    return {
        load: initForm
    }
})()

// Loading
theme.loading = (function() {
    var $loading = $('#js-loading'),
        hasLoading = $('#js-loading').length === 0 ? false : true;
    if (hasLoading) {
        $(window).load(function() {
            $loading.fadeOut();
        });
    }
})()

theme.effectLeavingPage = (function() {
    window.onbeforeunload = function() {
        $('body').css('opacity', '0');
    }
})()

// Isotope
theme.isotope = (function() {
    var enableIsotope = $('.enable-isotope').length === 1 ? true : false,
        $grid = $('.js-grid'),
        filter = '.js-filter-isotope';

    function initIsotope() {
        if (enableIsotope) {
            $grid.isotope({
                itemSelector: '.grid-item',
                percentPosition: true
            })
            $(document).on('click', filter, function() {
                var filterValue = $(this).data('filter') === '*' ? $(this).data('filter') : '.' + $(this).data('filter');
                $(filter).removeClass('active');
                $(this).addClass('active');
                $grid.isotope({
                    filter: filterValue
                });
            });
            $(window).scroll(function() {
                $grid.isotope('layout');
            });
            $(window).load(function() {
                $grid.isotope('layout');
                $(filter).first().trigger('click');
            });
        }
    }
    initIsotope();
})()

//aos



// theme.Wow = (function(){
//   new WOW().init();
// })()




// Masonry
theme.Masonry = (function() {
    function Masonry(container) {
        this.$container = $(container).on('init', this._a11y.bind(this));
        var $masonry = this.$container;
        $masonry.isotope({
            itemSelector: '.grid-item',
            percentPosition: true,
            masonry: {
                columnWidth: '.grid-sizer'
            }
        });
        $(window).load(function() {
            $masonry.isotope('layout').css('opacity', '1');
        });
        $(window).scroll(function() {
            $masonry.isotope('layout').css('opacity', '1');
        });
    }

    Masonry.prototype = _.assignIn({}, Masonry.prototype, {
        _a11y: function(event, obj) {
            var $list = obj.$list;
            var $wrapper = this.$container.parent();

            // Remove default Slick aria-live attr until slider is focused
            $list.removeAttr('aria-live');

            // When an element in the slider is focused set aria-live
            $wrapper.on('focusin', function(evt) {
                if ($wrapper.has(evt.target).length) {
                    $list.attr('aria-live', 'polite');
                }
            });

            // Remove aria-live
            $wrapper.on('focusout', function(evt) {
                if ($wrapper.has(evt.target).length) {
                    $list.removeAttr('aria-live');
                }
            });
        }
    });

    return Masonry;
})();



// Cross-selling
theme.crosssell = (function() {
    var crosssellClass = '.js-crosssell',
        handles = $(crosssellClass).data('handles') || '',
        arrayHandle = handles.split(','),
        $blockCrosssell = $('.block-cross-sell'),
        variantSelectClass = '.js-cross-select',
        crossImageClass = '.cross-item-image',
        crossPriceClass = '.cross-item-money';

    function generateCrosssell() {
        for (var i = 0; i < arrayHandle.length; i++) {
            var productHandle = arrayHandle[i];
            Shopify.getProduct(productHandle, function(product) {
                var htmlCross = '',
                    htmlOption = '',
                    firstAvailableVariant = '',
                    variantCount = product.variants.length;

                // generate select box and check first avaiable variant
                for (var j = 0; j < variantCount; j++) {
                    var variant = product.variants[j],
                        variantImage = variant.featured_image === null ? product.featured_image : variant.featured_image.src,
                        disabled = variant.available ? '' : 'disabled';
                    htmlOption += '<option ' + disabled + ' data-id="' + variant.id + '" data-price="' + variant.price + '" data-image="' + variantImage + '">' + variant.title + '</option>';
                    if (firstAvailableVariant === '' && variant.available) {
                        firstAvailableVariant = variant
                    }
                }
                var productPrice = theme.Currency.formatMoney(firstAvailableVariant.price, theme.moneyFormat),
                    productImage = firstAvailableVariant.featured_image === null ? product.featured_image : firstAvailableVariant.featured_image.src,
                    selectHide = variantCount === 1 ? 'hide' : '';

                // generate HTML
                htmlCross += '<div class="col cross-item ' + product.handle + '">';
                htmlCross += '	<a class="cross-item-image" href="' + product.url + '" title="' + product.title + '"><img src="' + productImage + '" />' + theme.strings.cartIcon + '</a>';
                htmlCross += '	<a target="_blank" href="' + product.url + '" title="' + product.title + '" class="cross-item-title">' + product.title + '</a>';
                htmlCross += '	<span class="cross-item-money">' + productPrice + '</span>';
                htmlCross += '	<select class="js-cross-select ' + selectHide + '" data-image="' + productImage + '" data-price="' + firstAvailableVariant.price + '" data-item="' + firstAvailableVariant.id + '">' + htmlOption + '</select>';
                htmlCross += '</div>';
                $(crosssellClass).append(htmlCross);
                theme.updateCurrencies();
            });
        }
    }

    function showPopupCrosssell(lineItem) {
        //generate lineitem;
        var htmlLineItem = '';
        htmlLineItem += '<span class="alert alert-success d-inline-block mb-2">' + theme.strings.addToCartSuccess + '</span>';
        htmlLineItem += '<div><img src="' + lineItem.image + '" alt="Added Product"></div>';
        htmlLineItem += '<h4 class="cross-item-title">' + lineItem.title + '</h4>';
        htmlLineItem += '<div class="mb-2">' + theme.strings.cartQuantity + ': ' + lineItem.quantity + '</div>';
        $('.js-cross-added').hide().html(htmlLineItem).fadeIn();

        // show popup
        var $popupCrosssell = $('#jsCrosssell');
        $popupCrosssell.modal('show');
    }

    if (handles !== '') {
        $(document).on('click', crossImageClass, function(event) {
            event.preventDefault();
            var parent = $(this).closest('.cross-item'),
                itemId = parent.find(variantSelectClass).attr('data-item');
            Shopify.addItem(itemId, 1, function(lineItem) {
                theme.miniCart.updateElements();
                theme.miniCart.generateCart();
                showPopupCrosssell(lineItem);
            });
        });
        $(document).on('change', variantSelectClass, function() {
            var selectVariant = $(this).children(':selected'),
                selectVariantId = selectVariant.data('id'),
                parent = $(this).parent(),
                newPrice = theme.Currency.formatMoney(selectVariant.data('price'), theme.moneyFormat);

            if (selectVariant.data('image') !== '') {
                parent.find(crossImageClass).find('img').attr('src', selectVariant.data('image'));
            }
            $(this).attr('data-item', selectVariantId);
            parent.find(crossPriceClass).html(newPrice);
            theme.updateCurrencies();
        });
        $(document).on('shopify:section:load', generateCrosssell);
        generateCrosssell();
        $blockCrosssell.removeClass('hide');
    }
    return {
        showPopup: showPopupCrosssell
    }
})()

// Upsell
theme.upsell = (function() {
    var popupUpsell = '#jsUpsell',
        $button = $('#jsUpsell .btn'),
        productUpsellId = $('#jsUpsell').data('id') || '',
        buttonAcceptClass = 'js-btn-accept',
        delayTime = $('#jsUpsell').data('delay') || 3000,
        isUpsell = $(popupUpsell).length === 1 ? true : false;
    if (isUpsell) {
        $(document).ready(function() {
            setTimeout(function() {
                $(popupUpsell).modal('show');
            }, delayTime);
        });
        $button.on('click', function() {
            if ($(this).hasClass(buttonAcceptClass)) {
                Shopify.addItem(productUpsellId, 1, function(item) {
                    theme.miniCart.updateElements();
                    theme.miniCart.generateCart();
                    var htmlVariant = item.variant_title !== null ? '<i>(' + item.variant_title + ')</i>' : '';
                    var htmlAlert = '<div class="media mt-2 alert--cart"><a class="mr-3" href="/cart"><img class="lazyload" data-src="' + item.image + '"></a><div class="media-body align-self-center"><p class="m-0 font-weight-bold">' + item.product_title + ' x ' + item.quantity + '</p>' + htmlVariant + '<div><div>';
                    theme.alert.new(theme.strings.addToCartSuccess, htmlAlert, 3000, 'notice');
                })
            }
            $(popupUpsell).modal('hide');
        })
    }
})()

// Coupon
theme.coupon = (function() {
    var popupCoupon = '#jsCoupon',
        $button = $('#jsCoupon .js-btn-coupon'),
        delayTime = $('#jsCoupon').data('delay') || 3000,
        isCoupon = $(popupCoupon).length === 1 ? true : false,
        isCopied = localStorage.getItem('localCoupon') || '';
    if (isCoupon && isCopied === '') {
        $(document).ready(function() {
            setTimeout(function() {
                $(popupCoupon).modal('show');
            }, delayTime);
        });
        $button.on('click', function() {
            var copyText = document.getElementById("coupon_code");
            copyText.select();
            document.execCommand("Copy");
            $(popupCoupon).modal('hide');
            theme.alert.new('Coupon code', 'Successfully copied, now you can paste code at checkout', 4000);
            localStorage.setItem('localCoupon', 'copied');
        })
    }
})()

// Overwrite Shopify.onError in Shopify API
Shopify.onError = function(t, r) {
    var e = eval("(" + t.responseText + ")");
    var mess = e.message ? e.message + "(" + e.status + "): " + e.description : "Error : " + Shopify.fullMessagesFromErrors(e).join("; ") + "."
    theme.alert.new('Alert', mess, 3000, 'warning');
}

// Megamenu width
theme.fixWidthMegamenu = (function() {
    var $megamenuClass = $('.site-nav__item-mega'),
        megaDropdownClass = '.meganav';
    $megamenuClass.each(function() {
        var widthMenu = $(this).data('width') || 0;
        if (widthMenu !== 0) {
            $(this).find(megaDropdownClass).css({ 'width': widthMenu + 'px', 'margin-left': '-' + widthMenu / 2 + 'px' });
        }
    });
})()

// Product video
theme.productVideo = (function() {
    var playButtonClass = '.js-play-button';
    $(document).on('click', playButtonClass, function() {
        let videoSelector = $(this).next(),
            videoObject = videoSelector.get(0);
        $(this).toggleClass('active');
        videoSelector.toggleClass('active');
        videoObject.paused ? videoObject.play() : videoObject.pause();
    })
})()

// Fake-viewers
theme.fakeViewer = (function() {
    var $fakeViewClass = $('.js-fake-view'),
        minValue = $fakeViewClass.data('min'),
        maxValue = $fakeViewClass.data('max'),
        duration = $fakeViewClass.data('duration');

    function randomInRange(start, end) {
        var value = Math.floor(Math.random() * (end - start + 1) + start);
        $fakeViewClass.text(value);
    }

    if (minValue !== undefined && maxValue !== undefined) {
        randomInRange(minValue, maxValue);
        setInterval(function() {
            randomInRange(minValue, maxValue);
        }, duration);
    }

})();

// Product-suggest
theme.productSuggest = (function() {
    var $productSuggestClass = $('.product-notification'),
        $closeButtonClass = $('.close-notifi'),
        duration = $productSuggestClass.data('time') || 0,
        productSuggestCookie = 'cookieSuggest';

    function SomeonePurchased() {
        if ($.cookie(productSuggestCookie) == 'closed') {
            $productSuggestClass.remove();
        }
        $closeButtonClass.on('click', function() {
            $productSuggestClass.remove();
            $.cookie(productSuggestCookie, 'closed', { expires: 1, path: '/' });
        });

        function toggleSomething() {
            if ($productSuggestClass.hasClass('active')) {
                $productSuggestClass.removeClass('active')
            } else {
                var arrayProducts = $('.data-product'),
                    randomProduct = Math.floor(Math.random() * arrayProducts.length),
                    Object = $(arrayProducts[randomProduct]);

                $productSuggestClass.addClass('active');
                $productSuggestClass.find('.product-image').attr('href', Object.data('url')).find('img').attr('src', Object.data('image'));
                $productSuggestClass.find('.product-name').text(Object.data('title')).attr('href', Object.data('url'));
                $productSuggestClass.find('.time-ago').text(Object.data('time'));
                $productSuggestClass.find('.from-ago').text(Object.data('local'));
            }
        }

        if (duration !== 0) {
            setInterval(toggleSomething, duration);
        }
    }
    SomeonePurchased();
})()


// Stickyheader
theme.stickyHeader = (function() {
    var stickHeaderClass = '.site-header--sticky';
    if ($(stickHeaderClass).length !== 0) {
        $(window).scroll(function() {
            if (window.pageYOffset >= 20) {
                $(stickHeaderClass).addClass('active');
            } else {
                $(stickHeaderClass).removeClass('active');
            }
        });
    }
})()

theme.PhotoSwipe = (function() {
    var initPhotoSwipeFromDOM = function(gallerySelector) {

        // parse slide data (url, title, size ...) from DOM elements 
        // (children of gallerySelector)
        var parseThumbnailElements = function(el) {
            var thumbElements = el.childNodes,
                numNodes = thumbElements.length,
                items = [],
                figureEl,
                linkEl,
                size,
                item;

            for (var i = 0; i < numNodes; i++) {

                figureEl = thumbElements[i]; // <figure> element

                // include only element nodes 
                if (figureEl.nodeType !== 1) {
                    continue;
                }

                linkEl = figureEl.children[0]; // <a> element

                size = linkEl.getAttribute('data-size').split('x');

                // create slide object
                item = {
                    src: linkEl.getAttribute('href'),
                    w: parseInt(size[0], 10),
                    h: parseInt(size[1], 10)
                };



                if (figureEl.children.length > 1) {
                    // <figcaption> content
                    item.title = figureEl.children[1].innerHTML;
                }

                if (linkEl.children.length > 0) {
                    // <img> thumbnail element, retrieving thumbnail url
                    item.msrc = linkEl.children[0].getAttribute('src');
                }

                item.el = figureEl; // save link to element for getThumbBoundsFn
                items.push(item);
            }

            return items;
        };

        // find nearest parent element
        var closest = function closest(el, fn) {
            return el && (fn(el) ? el : closest(el.parentNode, fn));
        };

        // triggers when user clicks on thumbnail
        var onThumbnailsClick = function(e) {
            e = e || window.event;
            e.preventDefault ? e.preventDefault() : e.returnValue = false;

            var eTarget = e.target || e.srcElement;

            // find root element of slide
            var clickedListItem = closest(eTarget, function(el) {
                return (el.tagName && el.tagName.toUpperCase() === 'FIGURE');
            });

            if (!clickedListItem) {
                return;
            }

            // find index of clicked item by looping through all child nodes
            // alternatively, you may define index via data- attribute
            var clickedGallery = clickedListItem.parentNode,
                childNodes = clickedListItem.parentNode.childNodes,
                numChildNodes = childNodes.length,
                nodeIndex = 0,
                index;

            for (var i = 0; i < numChildNodes; i++) {
                if (childNodes[i].nodeType !== 1) {
                    continue;
                }

                if (childNodes[i] === clickedListItem) {
                    index = nodeIndex;
                    break;
                }
                nodeIndex++;
            }



            if (index >= 0) {
                // open PhotoSwipe if valid index found
                openPhotoSwipe(index, clickedGallery);
            }
            return false;
        };

        // parse picture index and gallery index from URL (#&pid=1&gid=2)
        var photoswipeParseHash = function() {
            var hash = window.location.hash.substring(1),
                params = {};

            if (hash.length < 5) {
                return params;
            }

            var vars = hash.split('&');
            for (var i = 0; i < vars.length; i++) {
                if (!vars[i]) {
                    continue;
                }
                var pair = vars[i].split('=');
                if (pair.length < 2) {
                    continue;
                }
                params[pair[0]] = pair[1];
            }

            if (params.gid) {
                params.gid = parseInt(params.gid, 10);
            }

            return params;
        };

        var openPhotoSwipe = function(index, galleryElement, disableAnimation, fromURL) {
            var pswpElement = document.querySelectorAll('.pswp')[0],
                gallery,
                options,
                items;

            items = parseThumbnailElements(galleryElement);

            // define options (if needed)
            options = {
                maxSpreadZoom: 1,
                bgOpacity: 0.7,
                zoomEl: true,
                history: false,
                zoomEl: false,
                pinchToClose: false,
                closeOnScroll: false,
                // define gallery index (for URL)
                galleryUID: galleryElement.getAttribute('data-pswp-uid'),

            };

            // PhotoSwipe opened from URL
            if (fromURL) {
                if (options.galleryPIDs) {
                    // parse real index when custom PIDs are used 
                    // http://photoswipe.com/documentation/faq.html#custom-pid-in-url
                    for (var j = 0; j < items.length; j++) {
                        if (items[j].pid == index) {
                            options.index = j;
                            break;
                        }
                    }
                } else {
                    // in URL indexes start from 1
                    options.index = parseInt(index, 10) - 1;
                }
            } else {
                options.index = parseInt(index, 10);
            }

            // exit if index not found
            if (isNaN(options.index)) {
                return;
            }

            if (disableAnimation) {
                options.showAnimationDuration = 0;
            }

            // Pass data to PhotoSwipe and initialize it
            gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, items, options);
            gallery.init();
        };

        // loop through all gallery elements and bind events
        var galleryElements = document.querySelectorAll(gallerySelector);

        for (var i = 0, l = galleryElements.length; i < l; i++) {
            galleryElements[i].setAttribute('data-pswp-uid', i + 1);
            galleryElements[i].onclick = onThumbnailsClick;
        }

        // Parse URL and open gallery if it contains #&pid=3&gid=1
        var hashData = photoswipeParseHash();
        if (hashData.pid && hashData.gid) {
            openPhotoSwipe(hashData.pid, galleryElements[hashData.gid - 1], true, true);
        }
    };

    // execute above function
    initPhotoSwipeFromDOM('.my-gallery');
})()

theme.ZoomImage = (function() {
    $(window).resize(function() {
        var width = $(window).width();
        if (width > 767) {
            ZoomImage();
        }
    });
    $(window).width(function() {
        var width = $(window).width();
        if (width > 767) {
            ZoomImage();
        }
    });

    function ZoomImage() {
        $(".zoom_image").each(function(arg, el) {
            var image = $(el).find("img");
            $(el).zoom({
                on: 'mouseover',
                url: image.attr("src").replace("small", "big")
            });
        });
    }
})()

theme.activeAccordion = (function() {
    $('.collapse').on('shown.bs.collapse', function() {
        $(this).prev().addClass('active-acc');
    });
    $('.collapse').on('hidden.bs.collapse', function() {
        $(this).prev().removeClass('active-acc');
    });
})()


// Anchor scroll
theme.anchorScroll = (function() {
    $(document).on('click', 'a[href^="#"]', function(event) {
        event.preventDefault();
        var disableAnchor = $(this).hasClass('disabled-anchor');
        if (!disableAnchor) {
            $('html, body').animate({
                scrollTop: $($.attr(this, 'href')).offset().top
            }, 500);
        }
    });
})()

// Product-recently-viewed
theme.productRecentlyViewed = (function() {
    var $viewedElement = $('.js-recently-view'),
        $viewButton = $('.js-recently-view-button'),
        $content = $('.js-recently-view-content'),
        productHandle = $viewedElement.data('handle') || '',
        limit = $viewButton.data('limit') || 0,
        arrayProduct = JSON.parse(localStorage.getItem('localRecentlyViewed')) || [],
        lastProduct = arrayProduct[arrayProduct.length - 1] || '',
        isAdded = $.inArray(productHandle, arrayProduct) !== -1 ? true : false;

    function processViewed() {
        if (productHandle !== '') {
            //process last product
            if (lastProduct === productHandle && arrayProduct.length > 1) {
                lastProduct = arrayProduct[arrayProduct.length - 2]
            }

            //move current product to last of array
            if (isAdded) {
                arrayProduct.splice(arrayProduct.indexOf(productHandle), 1);
            }
            arrayProduct.push(productHandle);
            //remove first item if limit
            if (arrayProduct.length > limit) {
                arrayProduct.shift()
            }
            localStorage.setItem('localRecentlyViewed', JSON.stringify(arrayProduct));
        }
    }

    function generatorProduct() {
        $content.html('');
        if (arrayProduct.length > 0) {
            //array
            for (var i = 0; i < arrayProduct.length; i++) {
                var productHandle = arrayProduct[i];
                Shopify.getProduct(productHandle, function(product) {
                    var htmlProduct = '';
                    var productPrice = product.price_varies ? 'from ' + theme.Currency.formatMoney(product.price_min, theme.moneyFormat) : theme.Currency.formatMoney(product.price, theme.moneyFormat);
                    var productComparePrice = product.compare_at_price_min !== 0 ? theme.Currency.formatMoney(product.compare_at_price_min, theme.moneyFormat) : '';
                    htmlProduct += '<div class="col-12 col-lg-4 js-viewed-item mb-4">';
                    htmlProduct += '	<div class="border p-3 rounded media d-flex ">';
                    htmlProduct += '	<a class="mr-3 col-4 p-0" href="' + product.url + '">';
                    htmlProduct += '		<img src="' + product.featured_image + '"/>';
                    htmlProduct += '	</a>';
                    htmlProduct += '	<div class="media-body text-left">';
                    htmlProduct += '		<h4 class="mb-2 mt-2"><a href="' + product.url + '">' + product.title + '</a></h5>';
                    htmlProduct += '	<span> ' + productPrice + '</span>';
                    htmlProduct += '	<s>' + productComparePrice + '</s>';
                    htmlProduct += '	</div>';
                    htmlProduct += '	</div>';
                    htmlProduct += '</div>';
                    $content.append(htmlProduct);
                    theme.updateCurrencies();
                });
            }

            //last product
            Shopify.getProduct(lastProduct, function(product) {
                $viewButton.css('background-image', 'url(' + product.featured_image + ')').addClass('active');
            })
        }
    }

    processViewed();
    generatorProduct();

})()

// Notice when soldout
theme.alert = (function() {
    function createAlert(title, mess, time, type) {
        var aTitle = title || '',
            aTime = time || 2000,
            aMessage = mess || '',
            aClass = type || 'default';
        $.growl({
            title: aTitle,
            message: aMessage,
            duration: aTime,
            style: aClass,
            size: 'large'
        });
    }

    return {
        new: createAlert
    }
})()

// Notice when soldout
theme.noticeSoldout = (function() {
    var $soldoutWrapFormClass = $('.js-contact-soldout'),
        $textClass = $('.js-notify-text'),
        $soldoutValueId = $('#ContactProduct');

    function noticeSoldout(variant) {
        $soldoutWrapFormClass.find('.form-success').remove()
        if (variant.available) {
            $textClass.find('span').text('');
            $soldoutWrapFormClass.addClass('hide');
        } else {
            $textClass.find('span').text(': ' + variant.name);
            $soldoutWrapFormClass.removeClass('hide');
            $soldoutValueId.val(variant.name).attr('value', variant.name);
        }
    }
    return {
        init: noticeSoldout
    }
})()

// Sticky cart
theme.stickyCart = (function() {
    var $anchor = $('#js-anchor-sticky-cart'),
        $stCart = $('.sticky-cart-wr'),
        $close = $('#js-sticky-close'),
        disableStCart = localStorage.getItem('localDisableStCart') || '';
    if (disableStCart !== '') {
        $stCart.addClass('disable');
    }
    $close.on('click', function() {
        var isDisable = disableStCart !== '';
        if (isDisable) {
            localStorage.setItem('localDisableStCart', '');
        } else {
            localStorage.setItem('localDisableStCart', 'true');
        }
        $stCart.toggleClass('disable');
    })
    if ($anchor.length) {
        $(window).on('scroll', function() {
            var hT = $anchor.offset().top,
                hH = $anchor.outerHeight(),
                wH = $(window).height(),
                wS = $(this).scrollTop();
            if (wS > (hT + hH - wH)) {
                $stCart.addClass('active');
            } else {
                $stCart.removeClass('active');
            }
        });
    }

})()

//Fix reload safari
window.addEventListener("pageshow", function(evt) {
    if (evt.persisted) {
        setTimeout(function() {
            window.location.reload();
        }, 10);
    }
}, false);

// Back to top
theme.backToTop = (function() {
    var backtotopClass = $('.js-back-to-top');
    $(window).scroll(function() {
        if ($(this).scrollTop() > 300) {
            backtotopClass.fadeIn('slow');
        } else {
            backtotopClass.fadeOut('slow');
        }
    });
    backtotopClass.on('click', function() {
        $('body,html').animate({ scrollTop: 0 }, 800);
    });
})()


// Tooltip
theme.tooltip = (function() {
    var selector = '[data-toggle="tooltip"],[data-tooltip="true"]';

    function loadTooltip() {
        $(selector).tooltip(); //Bootstrap 4
    };
    $(document).on('click', selector, function() {
        $(this).tooltip('hide');
    });
    loadTooltip();
    return {
        load: loadTooltip
    }
})()

//Collections style 2
theme.Bgcollection = (function() {
    // init Isotope
    function Bgcollection(container) {
        var $container = this.$container = $(container);
        var sectionId = $container.attr('data-section-id');
        var wrapper = this.wrapper = '.bgcollection-wrapper';
        var slider = this.slider = '#Bgcollection-' + sectionId;
        var $slider = $(slider, wrapper);
        $(".colgrid__bg--full[data-index='1']").addClass('active');
        $('.colgrid .colgrid__box').each(function() {
            var index = $(this).attr("data-index");
            $(this).hover(
                function() {
                    $(".colgrid__bg--full[data-index='" + index + "']").addClass('active');
                },
                function() {
                    $(".colgrid__bg--full[data-index='" + index + "']").removeClass('active');
                }
            );
        });
    }

    return Bgcollection;
})();


//Sidebar
theme.sidebar = (function() {
    var togglebutton = '.js-toggle-filter',
        $sidebar = $('.js-sidebar');
    $(document).on('click', togglebutton, function() {
        $sidebar.toggleClass('active');
        $(this).toggleClass('active');
    })
})()

// Ajax filter in collection page
theme.ajaxFilter = (function() {
    var ajaxContent = '#js-product-ajax',
        ajaxSortBy = '#js-sortby',
        ajaxFillter = '#js-fillter',
        ajaxCollectionTitle = '.js-collection-title',
        pageTitle = $(document).find("title").text(),
        jsLoading = '#js-loading';

    var apollo = {
        init: function() {
            this.initFilter();
        },
        showLoading: function() {
            $(jsLoading).show();
        },
        hideLoading: function() {
            $('body,html').animate({
                scrollTop: $('#MainContent').offset().top - 150
            }, 600);
            setTimeout(function() {
                $(jsLoading).hide(); //delay 500ms for better UX
            }, 500);

        },
        initFilter: function() {
            apollo.filterParams();
            apollo.filterSortby();
            apollo.sidebarMapTagEvents();
            apollo.filterMapSorting();
            apollo.filterMapPaging();
        },
        filterParams: function() {
            Shopify.queryParams = {};
            if (location.search.length) {
                for (var aKeyValue, i = 0, aCouples = location.search.substr(1).split('&'); i < aCouples.length; i++) {
                    aKeyValue = aCouples[i].split('=');
                    if (aKeyValue.length > 1) {
                        Shopify.queryParams[decodeURIComponent(aKeyValue[0])] = decodeURIComponent(aKeyValue[1]);
                    }
                }
            }
        },
        filterSortby: function() {
            if (Shopify.queryParams.sort_by) {
                var sortby = Shopify.queryParams.sort_by;
                $(ajaxSortBy).val(sortby);
            }
        },
        filterCreateUrl: function(baseLink) {
            var newQuery = $.param(Shopify.queryParams).replace(/%2B/g, '+');
            if (baseLink) {
                if (newQuery != "") {
                    return baseLink + "?" + newQuery;
                } else {
                    return baseLink;
                }
            }
            return location.pathname + "?" + newQuery;
        },
        filterMapData: function(data) {
            // 1. update product grid
            $(ajaxContent).html($(ajaxContent, data.responseText).html());
            // 2. update left filter
            $(ajaxFillter).html($(ajaxFillter, data.responseText).html());
            // 3. update collection title
            $(ajaxCollectionTitle).html($(ajaxCollectionTitle, data.responseText).html());
        },
        filterAjaxClick: function(baseLink) {
            delete Shopify.queryParams.page;
            var newurl = apollo.filterCreateUrl(baseLink);
            History.pushState({
                param: Shopify.queryParams
            }, pageTitle, newurl);
            apollo.filterGetContent(newurl);
        },
        filterGetContent: function(newurl) {
            $.ajax({
                type: 'GET',
                url: newurl,
                data: {},
                beforeSend: function() {
                    apollo.showLoading();
                },
                complete: function(data) {
                    apollo.filterMapData(data);
                    theme.wishlist.load();
                    theme.compare.load();
                    theme.countdown.load();
                    theme.priceRange.load();
                    theme.tooltip.load();
                    theme.collectionView.triggerView();
                    theme.swatchCard2.load();
                    theme.infiniteScroll.load();
                    apollo.hideLoading();
                },
                error: function(xhr, text) {
                    apollo.hideLoading();
                    alert($.parseJSON(xhr.responseText).description);
                }
            });
        },
        sidebarMapTagEvents: function() {
            $(document).on('click', '.advanced-filter a', function(event) {
                event.preventDefault();
                $('.tooltip').removeClass('show');
                var currentTags = [];
                if (Shopify.queryParams.constraint) {
                    currentTags = Shopify.queryParams.constraint.split('+');
                }
                if (!$(this).parent().hasClass("active-filter")) {
                    var otherTag = $(this).parents('.catalog_filter_ul').find("li.active-filter");
                    if (otherTag.length > 0) {
                        var tagName = otherTag.data("handle");
                        if (tagName) {
                            var tagPos = currentTags.indexOf(tagName);
                            if (tagPos >= 0) {
                                currentTags.splice(tagPos, 1);
                            }
                        }
                    }
                }
                var dataHandle = $(this).parent().data("handle");
                if (dataHandle) {
                    var tagPos = currentTags.indexOf(dataHandle);
                    if (tagPos >= 0) {
                        currentTags.splice(tagPos, 1);
                    } else {
                        currentTags.push(dataHandle);
                    }
                }
                if (currentTags.length) {
                    Shopify.queryParams.constraint = currentTags.join('+');
                } else {
                    delete Shopify.queryParams.constraint;
                }
                apollo.filterAjaxClick();
            });
            $(document).on('click', '.advanced-filter .icon', function() {
                $(this).parent('.advanced-filter').find('a').trigger("click");
            });
        },
        filterMapSorting: function() {
            $(document).on('change', ajaxSortBy, function() {
                Shopify.queryParams.sort_by = $(this).val();
                apollo.filterAjaxClick();
            })
        },
        filterMapPaging: function() {
            $(document).on('click', '.js-pagination a', function() {
                event.preventDefault();
                var linkPage = $(this).attr("href").match(/page=\d+/g);
                if (linkPage) {
                    Shopify.queryParams.page = parseInt(linkPage[0].match(/\d+/g));
                    if (Shopify.queryParams.page) {
                        var newurl = apollo.filterCreateUrl();
                        History.pushState({
                            param: Shopify.queryParams
                        }, pageTitle, newurl);
                        apollo.filterGetContent(newurl);
                    }
                }
            });
        }
    }

    if ($(".template-collection")) {
        History.Adapter.bind(window, 'statechange', function() {
            var State = History.getState();
            apollo.filterParams();
        });
    }
    apollo.init();

})();
$(theme.init);tives
     * - Accounting.js - http://openexchangerates.github.io/accounting.js/
     *
     */

    theme.Currency = (function() {
        var moneyFormat = '${{amount}}'; // eslint-disable-line camelcase

        function formatMoney(cents, format) {
            if (typeof cents === 'string') {
                cents = cents.replace('.', '');
            }
            var value = '';
            var placeholderRegex = /\{\{\s*(\w+)\s*\}\}/;
            var formatString = format || moneyFormat;

            function formatWithDelimiters(number, precision, thousands, decimal) {
                thousands = thousands || ',';
                decimal = decimal || '.';

                if (isNaN(number) || number === null) {
                    return 0;
                }

                number = (number / 100.0).toFixed(precision);

                var parts = number.split('.');
                var dollarsAmount = parts[0].replace(
                    /(\d)(?=(\d\d\d)+(?!\d))/g,
                    '$1' + thousands
                );
                var centsAmount = parts[1] ? decimal + parts[1] : '';

                return dollarsAmount + centsAmount;
            }

            switch (formatString.match(placeholderRegex)[1]) {
                case 'amount':
                    value = formatWithDelimiters(cents, 2);
                    break;
                case 'amount_no_decimals':
                    value = formatWithDelimiters(cents, 0);
                    break;
                case 'amount_with_comma_separator':
                    value = formatWithDelimiters(cents, 2, '.', ',');
                    break;
                case 'amount_no_decimals_with_comma_separator':
                    value = formatWithDelimiters(cents, 0, '.', ',');
                    break;
                case 'amount_no_decimals_with_space_separator':
                    value = formatWithDelimiters(cents, 0, ' ');
                    break;
                case 'amount_with_apostrophe_separator':
                    value = formatWithDelimiters(cents, 2, "'");
                    break;
            }
            return formatString.replace(placeholderRegex, value);
        }

        return {
            formatMoney: formatMoney
        };
    })();

    /**
     * Image Helper Functions
     * -----------------------------------------------------------------------------
     * A collection of functions that help with basic image operations.
     *
     */

    theme.Images = (function() {
        /**
         * Preloads an image in memory and uses the browsers cache to store it until needed.
         *
         * @param {Array} images - A list of image urls
         * @param {String} size - A shopify image size attribute
         */

        function preload(images, size) {
            if (typeof images === 'string') {
                images = [images];
            }

            for (var i = 0; i < images.length; i++) {
                var image = images[i];
                this.loadImage(this.getSizedImageUrl(image, size));
            }
        }

        /**
         * Loads and caches an image in the browsers cache.
         * @param {string} path - An image url
         */
        function loadImage(path) {
            new Image().src = path;
        }

        /**
         * Swaps the src of an image for another OR returns the imageURL to the callback function
         * @param image
         * @param element
         * @param callback
         */
        function switchImage(image, element, callback) {
            var size = this.imageSize(element.src);
            var imageUrl = this.getSizedImageUrl(image.src, size);

            if (callback) {
                callback(imageUrl, image, element); // eslint-disable-line callback-return
            } else {
                element.src = imageUrl;
            }
        }

        /**
         * +++ Useful
         * Find the Shopify image attribute size
         *
         * @param {string} src
         * @returns {null}
         */
        function imageSize(src) {
            src = src || '';

            var match = src.match(
                /.+_((?:pico|icon|thumb|small|compact|medium|large|grande)|\d{1,4}x\d{0,4}|x\d{1,4})[_\\.@]/
            );

            if (match === null) {
                return null;
            } else {
                return match[1];
            }
        }

        /**
         * +++ Useful
         * Adds a Shopify size attribute to a URL
         *
         * @param src
         * @param size
         * @returns {*}
         */
        function getSizedImageUrl(src, size) {
            if (size === null) {
                return src;
            }

            if (size === 'master') {
                return this.removeProtocol(src);
            }

            var match = src.match(
                /\.(jpg|jpeg|gif|png|bmp|bitmap|tiff|tif)(\?v=\d+)?$/i
            );

            if (match !== null) {
                var prefix = src.split(match[0]);
                var suffix = match[0];

                return this.removeProtocol(prefix[0] + '_' + size + suffix);
            }

            return null;
        }

        function removeProtocol(path) {
            return path.replace(/http(s)?:/, '');
        }

        return {
            preload: preload,
            loadImage: loadImage,
            switchImage: switchImage,
            imageSize: imageSize,
            getSizedImageUrl: getSizedImageUrl,
            removeProtocol: removeProtocol
        };
    })();

    /**
     * Variant Selection scripts
     * ------------------------------------------------------------------------------
     *
     * Handles change events from the variant inputs in any `cart/add` forms that may
     * exist.  Also updates the master select and triggers updates when the variants
     * price or image changes.
     *
     * @namespace variants
     */

    slate.Variants = (function() {
        /**
         * Variant constructor
         *
         * @param {object} options - Settings from `product.js`
         */
        function Variants(options) {
            this.$container = options.$container;
            this.product = options.product;
            this.singleOptionSelector = options.singleOptionSelector;
            this.originalSelectorId = options.originalSelectorId;
            this.enableHistoryState = options.enableHistoryState;
            this.currentVariant = this._getVariantFromOptions();

            $(this.singleOptionSelector, this.$container).on(
                'change',
                this._onSelectChange.bind(this)
            );
        }

        Variants.prototype = _.assignIn({}, Variants.prototype, {
            /**
             * Get the currently selected options from add-to-cart form. Works with all
             * form input elements.
             *
             * @return {array} options - Values of currently selected variants
             */
            _getCurrentOptions: function() {
                var currentOptions = _.map(
                    $(this.singleOptionSelector, this.$container),
                    function(element) {
                        var $element = $(element);
                        var type = $element.attr('type');
                        var currentOption = {};

                        if (type === 'radio' || type === 'checkbox') {
                            if ($element[0].checked) {
                                currentOption.value = $element.val();
                                currentOption.index = $element.data('index');

                                return currentOption;
                            } else {
                                return false;
                            }
                        } else {
                            currentOption.value = $element.val();
                            currentOption.index = $element.data('index');

                            return currentOption;
                        }
                    }
                );

                // remove any unchecked input values if using radio buttons or checkboxes
                currentOptions = _.compact(currentOptions);

                return currentOptions;
            },

            /**
             * Find variant based on selected values.
             *
             * @param  {array} selectedValues - Values of variant inputs
             * @return {object || undefined} found - Variant object from product.variants
             */
            _getVariantFromOptions: function() {
                var selectedValues = this._getCurrentOptions();
                var variants = this.product.variants;

                var found = _.find(variants, function(variant) {
                    return selectedValues.every(function(values) {
                        return _.isEqual(variant[values.index], values.value);
                    });
                });

                return found;
            },

            /**
             * Event handler for when a variant input changes.
             */
            _onSelectChange: function() {
                var variant = this._getVariantFromOptions();

                this.$container.trigger({
                    type: 'variantChange',
                    variant: variant
                });

                if (!variant) {
                    return;
                }

                this._updateMasterSelect(variant);
                this._updateImages(variant);
                this._updatePrice(variant);
                this._updateSKU(variant);
                this.currentVariant = variant;

                if (this.enableHistoryState) {
                    this._updateHistoryState(variant);
                }
            },

            /**
             * Trigger event when variant image changes
             *
             * @param  {object} variant - Currently selected variant
             * @return {event}  variantImageChange
             */
            _updateImages: function(variant) {
                var variantImage = variant.featured_image || {};
                var currentVariantImage = this.currentVariant.featured_image || {};

                if (!variant.featured_image ||
                    variantImage.src === currentVariantImage.src
                ) {
                    return;
                }

                this.$container.trigger({
                    type: 'variantImageChange',
                    variant: variant
                });
            },

            /**
             * Trigger event when variant price changes.
             *
             * @param  {object} variant - Currently selected variant
             * @return {event} variantPriceChange
             */
            _updatePrice: function(variant) {
                if (
                    variant.price === this.currentVariant.price &&
                    variant.compare_at_price === this.currentVariant.compare_at_price
                ) {
                    return;
                }

                this.$container.trigger({
                    type: 'variantPriceChange',
                    variant: variant
                });
            },

            /**
             * Trigger event when variant sku changes.
             *
             * @param  {object} variant - Currently selected variant
             * @return {event} variantSKUChange
             */
            _updateSKU: function(variant) {
                if (variant.sku === this.currentVariant.sku) {
                    return;
                }

                this.$container.trigger({
                    type: 'variantSKUChange',
                    variant: variant
                });
            },

            /**
             * Update history state for product deeplinking
             *
             * @param  {variant} variant - Currently selected variant
             * @return {k}         [description]
             */
            _updateHistoryState: function(variant) {
                if (!history.replaceState || !variant) {
                    return;
                }

                var newurl =
                    window.location.protocol +
                    '//' +
                    window.location.host +
                    window.location.pathname +
                    '?variant=' +
                    variant.id;
                window.history.replaceState({ path: newurl }, '', newurl);
            },

            /**
             * Update hidden master select of variant change
             *
             * @param  {variant} variant - Currently selected variant
             */
            _updateMasterSelect: function(variant) {
                $(this.originalSelectorId, this.$container).val(variant.id);
            }
        });

        return Variants;
    })();


    /*================ MODULES ================*/
    window.Drawers = (function() {
        var Drawer = function(id, position, options) {
            var defaults = {
                close: '.js-drawer-close',
                open: '.js-drawer-open-' + position,
                openClass: 'js-drawer-open',
                dirOpenClass: 'js-drawer-open-' + position
            };

            this.nodes = {
                $parent: $('body, html'),
                $page: $('.page-element'),
                $moved: $('.is-moved-by-drawer')
            };

            this.config = $.extend(defaults, options);
            this.position = position;

            this.$drawer = $('#' + id);
            this.$open = $(this.config.open);

            if (!this.$drawer.length) {
                return false;
            }

            this.drawerIsOpen = false;
            this.init();
        };

        Drawer.prototype.init = function() {
            this.$open.attr('aria-expanded', 'false');
            this.$open.on('click', $.proxy(this.open, this));
            this.$drawer.find(this.config.close).on('click', $.proxy(this.close, this));
        };

        Drawer.prototype.open = function(evt) {
            // Keep track if drawer was opened from a click, or called by another function
            var externalCall = false;

            // don't open an opened drawer
            if (this.drawerIsOpen) {
                return;
            }

            this.$open.addClass(this.config.openClass);

            // Prevent following href if link is clicked
            if (evt) {
                evt.preventDefault();
            } else {
                externalCall = true;
            }

            // Without this, the drawer opens, the click event bubbles up to $nodes.page
            // which closes the drawer.
            if (evt && evt.stopPropagation) {
                evt.stopPropagation();
                // save the source of the click, we'll focus to this on close
                this.$activeSource = $(evt.currentTarget);
            }

            if (this.drawerIsOpen && !externalCall) {
                return this.close();
            }

            // Add is-transitioning class to moved elements on open so drawer can have
            // transition for close animation
            this.nodes.$moved.addClass('is-transitioning');
            this.$drawer.prepareTransition();

            this.nodes.$parent.addClass(
                this.config.openClass + ' ' + this.config.dirOpenClass
            );
            this.drawerIsOpen = true;

            // Set focus on drawer
            slate.a11y.trapFocus({
                $container: this.$drawer,
                namespace: 'drawer_focus'
            });

            // Run function when draw opens if set
            if (
                this.config.onDrawerOpen &&
                typeof this.config.onDrawerOpen === 'function'
            ) {
                if (!externalCall) {
                    this.config.onDrawerOpen();
                }
            }

            if (this.$activeSource && this.$activeSource.attr('aria-expanded')) {
                this.$activeSource.attr('aria-expanded', 'true');
            }

            this.bindEvents();
        };

        Drawer.prototype.close = function() {
            // don't close a closed drawer
            if (!this.drawerIsOpen) {
                return;
            }

            this.$open.removeClass(this.config.openClass);

            // deselect any focused form elements
            $(document.activeElement).trigger('blur');

            // Ensure closing transition is applied to moved elements, like the nav
            this.nodes.$moved.prepareTransition({ disableExisting: true });
            this.$drawer.prepareTransition({ disableExisting: true });

            this.nodes.$parent.removeClass(
                this.config.dirOpenClass + ' ' + this.config.openClass
            );

            this.drawerIsOpen = false;

            // Remove focus on drawer
            slate.a11y.removeTrapFocus({
                $container: this.$drawer,
                namespace: 'drawer_focus'
            });

            if (this.$activeSource && this.$activeSource.attr('aria-expanded')) {
                this.$activeSource.attr('aria-expanded', 'false');
            }

            this.unbindEvents();
        };

        Drawer.prototype.bindEvents = function() {
            // Lock scrolling on mobile
            this.nodes.$page.on('touchmove.drawer', function() {
                return false;
            });

            // Clicking out of drawer closes it
            this.nodes.$page.on(
                'click.drawer',
                $.proxy(function() {
                    this.close();
                    return false;
                }, this)
            );

            // Pressing escape closes drawer
            this.nodes.$parent.on(
                'keyup.drawer',
                $.proxy(function(evt) {
                    if (evt.keyCode === 27) {
                        this.close();
                    }
                }, this)
            );
        };

        Drawer.prototype.unbindEvents = function() {
            this.nodes.$page.off('.drawer');
            this.nodes.$parent.off('.drawer');
        };

        return Drawer;
    })();

    window.Modals = (function() {
        var Modal = function(id, name, options) {
            var defaults = {
                close: '.js-modal-close',
                open: '.js-modal-open-' + name,
                openClass: 'modal--is-active'
            };

            this.$modal = $('#' + id);

            if (!this.$modal.length) {
                return false;
            }

            this.nodes = {
                $body: $('body')
            };

            this.config = $.extend(defaults, options);

            this.modalIsOpen = false;
            this.$focusOnOpen = this.config.focusOnOpen ?
                $(this.config.focusOnOpen) :
                this.$modal;
            this.init();
        };

        Modal.prototype.init = function() {
            var $openBtn = $(this.config.open);

            // Add aria controls
            $openBtn.attr('aria-expanded', 'false');

            $(this.config.open).on('click', $.proxy(this.open, this));
            this.$modal.find(this.config.close).on('click', $.proxy(this.close, this));
        };

        Modal.prototype.open = function(evt) {
            // Keep track if modal was opened from a click, or called by another function
            var externalCall = false;

            // don't open an opened modal
            if (this.modalIsOpen) {
                return;
            }

            // Prevent following href if link is clicked
            if (evt) {
                evt.preventDefault();
            } else {
                externalCall = true;
            }

            // Without this, the modal opens, the click event bubbles up to $nodes.page
            // which closes the modal.
            if (evt && evt.stopPropagation) {
                evt.stopPropagation();
                // save the source of the click, we'll focus to this on close
                this.$activeSource = $(evt.currentTarget);
            }

            if (this.modalIsOpen && !externalCall) {
                return this.close();
            }

            this.$modal.prepareTransition().addClass(this.config.openClass);
            this.nodes.$body.addClass(this.config.openClass);

            this.modalIsOpen = true;

            // Set focus on modal
            slate.a11y.trapFocus({
                $container: this.$modal,
                namespace: 'modal_focus',
                $elementToFocus: this.$focusOnOpen
            });

            if (this.$activeSource && this.$activeSource.attr('aria-expanded')) {
                this.$activeSource.attr('aria-expanded', 'true');
            }

            this.bindEvents();
        };

        Modal.prototype.close = function() {
            // don't close a closed modal
            if (!this.modalIsOpen) {
                return;
            }

            // deselect any focused form elements
            $(document.activeElement).trigger('blur');

            this.$modal.prepareTransition().removeClass(this.config.openClass);
            this.nodes.$body.removeClass(this.config.openClass);

            this.modalIsOpen = false;

            // Remove focus on modal
            slate.a11y.removeTrapFocus({
                $container: this.$modal,
                namespace: 'modal_focus'
            });

            if (this.$activeSource && this.$activeSource.attr('aria-expanded')) {
                this.$activeSource.attr('aria-expanded', 'false').focus();
            }

            this.unbindEvents();
        };

        Modal.prototype.bindEvents = function() {
            // Pressing escape closes modal
            this.nodes.$body.on(
                'keyup.modal',
                $.proxy(function(evt) {
                    if (evt.keyCode === 27) {
                        this.close();
                    }
                }, this)
            );
        };

        Modal.prototype.unbindEvents = function() {
            this.nodes.$body.off('.modal');
        };

        return Modal;
    })();

    window.QtySelector = (function() {
        var QtySelector = function($el) {
            this.cache = {
                $body: $('body'),
                $subtotal: $('#CartSubtotal'),
                $discountTotal: $('#cartDiscountTotal'),
                $cartTable: $('.cart-table'),
                $cartTemplate: $('#CartProducts')
            };

            this.settings = {
                loadingClass: 'js-qty--is-loading',
                isCartTemplate: this.cache.$body.hasClass('template-cart'),
                // On the cart template, minimum is 0. Elsewhere min is 1
                minQty: this.cache.$body.hasClass('template-cart') ? 0 : 1
            };

            this.$el = $el;
            this.qtyUpdateTimeout;
            this.createInputs();
            this.bindEvents();
        };

        QtySelector.prototype.createInputs = function() {
            var $el = this.$el;

            var data = {
                value: $el.val(),
                key: $el.attr('id'),
                name: $el.attr('name'),
                line: $el.attr('data-line')
            };
            var source = $('#QuantityTemplate').html();
            var template = Handlebars.compile(source);

            this.$wrapper = $(template(data)).insertBefore($el);

            // Remove original number input
            $el.remove();
        };

        QtySelector.prototype.validateAvailability = function(line, quantity) {
            var product = theme.cartObject.items[line - 1]; // 0-based index in API
            var handle = product.handle; // needed for the ajax request
            var id = product.id; // needed to find right variant from ajax results

            var params = {
                type: 'GET',
                url: '/products/' + handle + '.js',
                dataType: 'json',
                success: $.proxy(function(cartProduct) {
                    this.validateAvailabilityCallback(line, quantity, id, cartProduct);
                }, this)
            };

            $.ajax(params);
        };

        QtySelector.prototype.validateAvailabilityCallback = function(
            line,
            quantity,
            id,
            product
        ) {
            var quantityIsAvailable = true;

            // This returns all variants of a product.
            // Loop through them to get our desired one.
            for (var i = 0; i < product.variants.length; i++) {
                var variant = product.variants[i];
                if (variant.id === id) {
                    break;
                }
            }

            // If the variant tracks inventory and does not sell when sold out
            // we can compare the requested with available quantity
            if (
                variant.inventory_management !== null &&
                variant.inventory_policy === 'deny'
            ) {
                if (variant.inventory_quantity < quantity) {

                    // Set quantity to max amount available
                    this.$wrapper.find('.js-qty__input').val(variant.inventory_quantity);

                    quantityIsAvailable = false;
                    this.$wrapper.removeClass(this.settings.loadingClass);
                }
            }

            if (quantityIsAvailable) {
                this.updateItemQuantity(line, quantity);
            }
        };

        QtySelector.prototype.validateQty = function(qty) {
            if (parseFloat(qty) === parseInt(qty, 10) && !isNaN(qty)) {
                // We have a valid number!
            } else {
                // Not a number. Default to 1.
                qty = 1;
            }
            return parseInt(qty, 10);
        };

        QtySelector.prototype.adjustQty = function(evt) {
            var $el = $(evt.currentTarget);
            var $input = $el.siblings('.js-qty__input');
            var qty = this.validateQty($input.val());
            var line = $input.attr('data-line');

            if ($el.hasClass('js-qty__adjust--minus')) {
                qty -= 1;
                if (qty <= this.settings.minQty) {
                    qty = this.settings.minQty;
                }
            } else {
                qty += 1;
            }

            if (this.settings.isCartTemplate) {
                $el.parent().addClass(this.settings.loadingClass);
                this.updateCartItemPrice(line, qty);
            } else {
                $input.val(qty);
            }
        };

        QtySelector.prototype.bindEvents = function() {
            this.$wrapper
                .find('.js-qty__adjust')
                .on('click', $.proxy(this.adjustQty, this));

            // Select input text on click
            this.$wrapper.on('click', '.js-qty__input', function() {
                this.setSelectionRange(0, this.value.length);
            });

            // If the quantity changes on the cart template, update the price
            if (this.settings.isCartTemplate) {
                this.$wrapper.on(
                    'change',
                    '.js-qty__input',
                    $.proxy(function(evt) {
                        var $input = $(evt.currentTarget);
                        var line = $input.attr('data-line');
                        var qty = this.validateQty($input.val());
                        $input.parent().addClass(this.settings.loadingClass);
                        this.updateCartItemPrice(line, qty);
                    }, this)
                );
            }
        };

        QtySelector.prototype.updateCartItemPrice = function(line, qty) {
            // Update cart after short timeout so user doesn't create simultaneous ajax calls
            clearTimeout(this.qtyUpdateTimeout);
            this.qtyUpdateTimeout = setTimeout(
                $.proxy(function() {
                    this.validateAvailability(line, qty);
                }, this),
                200
            );
        };

        QtySelector.prototype.updateItemQuantity = function(line, quantity) {
            var params = {
                type: 'POST',
                url: '/cart/change.js',
                data: 'quantity=' + quantity + '&line=' + line,
                dataType: 'json',
                success: $.proxy(function(cart) {
                    this.updateCartItemCallback(cart);
                }, this)
            };

            $.ajax(params);
        };

        QtySelector.prototype.updateCartItemCallback = function(cart) {
            // Reload the page to show the empty cart if no items
            if (cart.item_count === 0) {
                location.reload();
                return;
            }

            // Update cart object
            theme.cartObject = cart;

            // Handlebars.js cart layout
            var data = {};
            var items = [];
            var item = {};
            var source = $('#CartProductTemplate').html();
            var template = Handlebars.compile(source);
            var prodImg;

            // Add each item to our handlebars.js data
            $.each(cart.items, function(index, cartItem) {
                /* Hack to get product image thumbnail
                 *   - If image is not null
                 *     - Remove file extension, add 240x240, and re-add extension
                 *     - Create server relative link
                 *   - A hard-coded url of no-image
                 */

                if (cartItem.image === null) {
                    prodImg =
                        '//cdn.shopify.com/s/assets/admin/no-image-medium-cc9732cb976dd349a0df1d39816fbcc7.gif';
                } else {
                    prodImg = cartItem.image
                        .replace(/(\.[^.]*)$/, '_240x240$1')
                        .replace('http:', '');
                }

                if (cartItem.properties !== null) {
                    $.each(cartItem.properties, function(key, value) {
                        if (key.charAt(0) === '_' || !value) {
                            delete cartItem.properties[key];
                        }
                    });
                }

                // Create item's data object and add to 'items' array
                item = {
                    key: cartItem.key,
                    line: index + 1, // Shopify uses a 1+ index in the API
                    url: cartItem.url,
                    img: prodImg,
                    name: cartItem.product_title,
                    variation: cartItem.variant_title,
                    properties: cartItem.properties,
                    itemQty: cartItem.quantity,
                    price: theme.Currency.formatMoney(cartItem.price, theme.moneyFormat),
                    vendor: cartItem.vendor,
                    linePrice: theme.Currency.formatMoney(
                        cartItem.line_price,
                        theme.moneyFormat
                    ),
                    originalLinePrice: theme.Currency.formatMoney(
                        cartItem.original_line_price,
                        theme.moneyFormat
                    ),
                    discounts: cartItem.discounts,
                    discountsApplied: cartItem.line_price === cartItem.original_line_price ? false : true
                };

                items.push(item);
                theme.updateCurrencies();
            });

            // Gather all cart data and add to DOM
            data = {
                items: items
            };
            this.cache.$cartTemplate.empty().append(template(data));

            // Create new quantity selectors
            this.cache.$cartTable.find('input[type="number"]').each(function(i, el) {
                new QtySelector($(el));
            });

            // Update the cart subtotal
            this.cache.$subtotal.html(
                theme.Currency.formatMoney(cart.total_price, theme.moneyFormat)
            );

            // Update the cart total discounts
            if (cart.total_discount > 0) {
                this.cache.$discountTotal.html(
                    theme.strings.totalCartDiscount.replace(
                        '[savings]',
                        theme.Currency.formatMoney(cart.total_discount, theme.moneyFormat)
                    )
                );
            } else {
                this.cache.$discountTotal.empty();
            }

            theme.miniCart.updateElements();
            theme.updateCurrencies();
            // Set focus on cart table
            slate.a11y.pageLinkFocus(this.cache.$cartTable);
        };

        return QtySelector;
    })();

    /*
      Allow product to be added to cart via ajax with
      custom success and error responses.
    */
    window.AjaxCart = (function() {
        var styleCart = $('.js-mini-cart').attr("data-cartmini");
        var cart = function($form) {
            this.cache = {
                $cartIconIndicator: $('.site-header__cart-indicator')
            };

            this.$form = $form;
            this.eventListeners();

            this.showNotice = false;
            if (this.$form.length) {
                this.showNotice = this.$form.hasClass('js-form--notice') ? true : false;
            }
        };

        cart.prototype.eventListeners = function() {
            if (this.$form.length) {
                this.$form.on('submit', $.proxy(this.addItemFromForm, this));
            }
        };

        cart.prototype.addItemFromForm = function(evt) {
            evt.preventDefault();

            var params = {
                type: 'POST',
                url: '/cart/add.js',
                data: this.$form.serialize(),
                dataType: 'json',
                success: $.proxy(function(lineItem) {
                    //this.success(lineItem);
                    window.location.href = '/cart';
                }, this),
                error: $.proxy(function(XMLHttpRequest, textStatus) {
                    this.error(XMLHttpRequest, textStatus);
                }, this)
            };
            $.ajax(params);
        };

        cart.prototype.success = function(item) {
            theme.miniCart.updateElements();
            theme.miniCart.generateCart();
            if (styleCart != 'false') {
                if (this.showNotice) {
                    var htmlVariant = item.variant_title !== null ? '<i>(' + item.variant_title + ')</i>' : '';
                    var htmlAlert = '<div class="media mt-2 alert--cart"><a class="mr-3" href="/cart"><img class="lazyload" data-src="' + item.image + '"></a><div class="media-body align-self-center"><p class="m-0 font-weight-bold">' + item.product_title + ' x ' + item.quantity + '</p>' + htmlVariant + '<div><div>';
                    theme.alert.new(theme.strings.addToCartSuccess, htmlAlert, 3000, 'notice');
                } else {
                    theme.crosssell.showPopup(item);
                }
            }
        };

        // Error handling reference from Shopify.onError in api.jquery.js
        cart.prototype.error = function(XMLHttpRequest) {
            var data = JSON.parse(XMLHttpRequest.responseText);

            if (data.message) {
                theme.alert.new('', data.description, 3000, 'warning');
            }
        };

        return cart;
    })();

    /*================ TEMPLATES ================*/
    theme.customerTemplates = (function() {
        function initEventListeners() {
            // Show reset password form
            $('#RecoverPassword').on('click', function(evt) {
                evt.preventDefault();
                toggleRecoverPasswordForm();
            });

            // Hide reset password form
            $('#HideRecoverPasswordLink').on('click', function(evt) {
                evt.preventDefault();
                toggleRecoverPasswordForm();
            });
        }

        /**
         *
         *  Show/Hide recover password form
         *
         */
        function toggleRecoverPasswordForm() {
            $('#RecoverPasswordForm').toggleClass('hide');
            $('#CustomerLoginForm').toggleClass('hide');
        }

        /**
         *
         *  Show reset password success message
         *
         */
        function resetPasswordSuccess() {
            // check if reset password form was successfully submited
            if (!$('.reset-password-success').length) {
                return;
            }

            // show success message
            $('#ResetSuccess').removeClass('hide');
        }

        /**
         *
         *  Show/hide customer address forms
         *
         */
        function customerAddressForm() {
            var $newAddressForm = $('#AddressNewForm');

            if (!$newAddressForm.length) {
                return;
            }

            // Initialize observers on address selectors, defined in shopify_common.js
            if (Shopify) {
                // eslint-disable-next-line no-new
                new Shopify.CountryProvinceSelector(
                    'AddressCountryNew',
                    'AddressProvinceNew', {
                        hideElement: 'AddressProvinceContainerNew'
                    }
                );
            }

            // Initialize each edit form's country/province selector
            $('.address-country-option').each(function() {
                var formId = $(this).data('form-id');
                var countrySelector = 'AddressCountry_' + formId;
                var provinceSelector = 'AddressProvince_' + formId;
                var containerSelector = 'AddressProvinceContainer_' + formId;

                // eslint-disable-next-line no-new
                new Shopify.CountryProvinceSelector(countrySelector, provinceSelector, {
                    hideElement: containerSelector
                });
            });

            // Toggle new/edit address forms
            $('.address-new-toggle').on('click', function() {
                $newAddressForm.toggleClass('hide');
            });

            $('.address-edit-toggle').on('click', function() {
                var formId = $(this).data('form-id');
                $('#EditAddress_' + formId).toggleClass('hide');
            });

            $('.address-delete').on('click', function() {
                var $el = $(this);
                var formId = $el.data('form-id');
                var confirmMessage = $el.data('confirm-message');

                // eslint-disable-next-line no-alert
                if (
                    confirm(
                        confirmMessage || 'Are you sure you wish to delete this address?'
                    )
                ) {
                    Shopify.postLink('/account/addresses/' + formId, {
                        parameters: { _method: 'delete' }
                    });
                }
            });
        }

        /**
         *
         *  Check URL for reset password hash
         *
         */
        function checkUrlHash() {
            var hash = window.location.hash;

            // Allow deep linking to recover password form
            if (hash === '#recover') {
                toggleRecoverPasswordForm();
            }
        }

        return {
            init: function() {
                checkUrlHash();
                initEventListeners();
                resetPasswordSuccess();
                customerAddressForm();
            }
        };
    })();

    /*================ SECTIONS ================*/
    theme.HeaderSection = (function() {
        function Header() {
            theme.NavDrawer = new window.Drawers('NavDrawer', 'left');
        }

        return Header;
    })();

    theme.Product = (function() {
        var defaults = {
            smallBreakpoint: 750,
            productThumbIndex: 0,
            productThumbMax: 0,
            ajaxCart: false,
            stockSetting: false
        };

        function Product(container) {
            var $container = (this.$container = $(container));
            var sectionId = $container.attr('data-section-id');

            this.selectors = {
                originalSelectorId: '#ProductSelect-' + sectionId,
                modal: 'ProductModal',
                productZoomImage: '#ProductZoomImg',
                addToCart: '#AddToCart-' + sectionId,
                productPrice: '#ProductPrice-' + sectionId,
                comparePrice: '#ComparePrice-' + sectionId,
                addToCartText: '#AddToCartText-' + sectionId,
                SKU: '.js-variant-sku',
                productImageContainers: '.product__photo-container-' + sectionId,
                productImageWrappers: '.product__photo-wrapper-' + sectionId,
                productThumbContainers: '.product-single__thumbnail-item-' + sectionId,
                productThumbsWrapper: '.product-single__thumbnails-' + sectionId,
                productThumbs: '.product-single__thumbnail-' + sectionId,
                saleTag: '#ProductSaleTag-' + sectionId,
                productStock: '#ProductStock-' + sectionId,
                singleOptionSelector: '.single-option-selector-' + sectionId,
                shopifyPaymentButton: '.shopify-payment-button',
                availability: '.product-single__availability',
                hurrify: '.js-hurrify'
            };

            this.settings = $.extend({}, defaults, {
                sectionId: sectionId,
                ajaxCart: $container.data('ajax'),
                stockSetting: $container.data('stock'),
                enableHistoryState: $container.data('enable-history-state') || false,
                namespace: '.product-' + sectionId
            });

            // Stop parsing if we don't have the product json script tag
            if (!$('#ProductJson-' + sectionId).html()) {
                return;
            }

            this.productSingleObject = JSON.parse(
                $('#ProductJson-' + sectionId).html()
            );
            this.addVariantInfo();

            this.init();
        }

        Product.prototype = _.assignIn({}, Product.prototype, {
            init: function() {
                this._stringOverrides();
                this._initVariants();
                this._productZoomImage();
                this._productThumbSwitch();
                this._productThumbnailSlider();
                this._initQtySelector();

                if (this.settings.ajaxCart) {
                    theme.AjaxCart = new window.AjaxCart(
                        $('#AddToCartForm-' + this.settings.sectionId)
                    );
                }
            },

            _stringOverrides: function() {
                window.productStrings = window.productStrings || {};
                $.extend(theme.strings, window.productStrings);
            },

            addVariantInfo: function() {
                if (!this.productSingleObject || !this.settings.stockSetting) {
                    return;
                }

                var variantInfo = JSON.parse(
                    $('#VariantJson-' + this.settings.sectionId).html()
                );

                for (var i = 0; i < variantInfo.length; i++) {
                    $.extend(this.productSingleObject.variants[i], variantInfo[i]);
                }
            },

            _initVariants: function() {
                var options = {
                    $container: this.$container,
                    enableHistoryState: this.settings.enableHistoryState,
                    product: this.productSingleObject,
                    singleOptionSelector: this.selectors.singleOptionSelector,
                    originalSelectorId: this.selectors.originalSelectorId
                };

                // eslint-disable-next-line no-new
                this.variants = new slate.Variants(options);

                this.$container.on(
                    'variantChange' + this.settings.namespace,
                    this._updateAddToCartBtn.bind(this)
                );
                this.$container.on(
                    'variantChange' + this.settings.namespace,
                    this._updateStickyCart.bind(this)
                );
                this.$container.on(
                    'variantPriceChange' + this.settings.namespace,
                    this._updatePrice.bind(this)
                );
                this.$container.on(
                    'variantSKUChange' + this.settings.namespace,
                    this._updateSKU.bind(this)
                );
                this.$container.on(
                    'variantImageChange' + this.settings.namespace,
                    this._updateImages.bind(this)
                );
            },

            _updateStock: function(variant) {
                if (!this.settings.stockSetting) return;

                var $stock = $(this.selectors.productStock),
                    $hurrify = $(this.selectors.hurrify);

                // If we don't track variant inventory, hide stock
                if (!variant || !variant.inventory_management) {
                    $stock.addClass('hide');
                    $hurrify.addClass('hide');
                    return;
                }

                if (variant.inventory_quantity < 10 && variant.inventory_quantity > 0) {
                    $stock
                        .html(
                            theme.strings.stockAvailable.replace(
                                '1',
                                variant.inventory_quantity
                            )
                        )
                        .removeClass('hide');
                    $hurrify.removeClass('hide').find('.progress-bar').css('width', variant.inventory_quantity * 10 + '%');
                    return;
                }

                if (variant.inventory_quantity <= 0 && variant.incoming) {
                    $stock
                        .html(
                            theme.strings.willNotShipUntil.replace(
                                '[date]',
                                variant.next_incoming_date
                            )
                        )
                        .removeClass('hide');
                    $hurrify.addClass('hide');
                    return;
                }

                // If there's more than 10 available, hide stock
                $stock.addClass('hide');
                $hurrify.addClass('hide');
            },

            _updateIncomingInfo: function(variant) {
                if (!this.settings.stockSetting) return;

                var $stock = $(this.selectors.productStock);

                if (variant.incoming) {
                    $stock
                        .html(
                            theme.strings.willBeInStockAfter.replace(
                                '[date]',
                                variant.next_incoming_date
                            )
                        )
                        .removeClass('hide');
                    return;
                }

                // If there is no stock incoming, hide stock
                $stock.addClass('hide');
            },

            _updateAddToCartBtn: function(evt) {
                var variant = evt.variant;

                var cache = {
                    $addToCart: $(this.selectors.addToCart),
                    $addToCartText: $(this.selectors.addToCartText)
                };

                if (variant) {
                    // Select a valid variant if available
                    theme.noticeSoldout.init(variant);
                    if (variant.available) {
                        // We have a valid product variant, so enable the submit button
                        cache.$addToCart.removeClass('btn--sold-out').prop('disabled', false);
                        cache.$addToCartText.html(theme.strings.addToCart);
                        $(this.selectors.shopifyPaymentButton, this.$container).show();
                        // Show how many items are left, if below 10
                        this._updateStock(variant);
                        //update availability - available
                        $(this.selectors.availability).find('span').text(theme.strings.available);
                    } else {
                        // Variant is sold out, disable the submit button
                        cache.$addToCart.prop('disabled', true).addClass('btn--sold-out');
                        cache.$addToCartText.html(theme.strings.soldOut);
                        $(this.selectors.shopifyPaymentButton, this.$container).hide();
                        // Update when stock will be available
                        this._updateIncomingInfo(variant);
                        //update availability - soldout
                        $(this.selectors.availability).find('span').text(theme.strings.soldOut);
                    }
                } else {
                    cache.$addToCart.prop('disabled', true).removeClass('btn--sold-out');
                    cache.$addToCartText.html(theme.strings.unavailable);
                    //update availability - unavailable
                    $(this.selectors.availability).find('span').text(theme.strings.unavailable);
                    $(this.selectors.shopifyPaymentButton, this.$container).hide();
                    // Hide stock display
                    this._updateStock();
                }
            },

            _updatePrice: function(evt) {
                var variant = evt.variant;

                if (variant) {
                    $(this.selectors.productPrice).html(
                        theme.Currency.formatMoney(variant.price, theme.moneyFormat)
                    );

                    // Update and show the product's compare price if necessary
                    if (variant.compare_at_price > variant.price) {
                        $(this.selectors.comparePrice)
                            .html(
                                theme.Currency.formatMoney(
                                    variant.compare_at_price,
                                    theme.moneyFormat
                                )
                            )
                            .removeClass('hide');
                        $(this.selectors.saleTag).removeClass('hide');
                    } else {
                        $(this.selectors.comparePrice).addClass('hide');
                        $(this.selectors.saleTag).addClass('hide');
                    }

                    theme.updateCurrencies();
                } else {
                    $(this.selectors.comparePrice).addClass('hide');
                }
            },

            _updateSKU: function(evt) {
                var variant = evt.variant;

                if (variant) {
                    $(this.selectors.SKU).html(variant.sku);
                }
            },

            _updateImages: function(evt) {
                var variant = evt.variant;

                if (variant && variant.featured_image) {
                    var imageId = variant.featured_image.id;
                    this.switchProductImage(imageId);
                    this.setActiveThumbnail(imageId);
                }
            },
            _updateStickyCart: function(evt) {
                var variant = evt.variant,
                    $stickyPrice = $('#js-sticky-price'),
                    $stickyTitle = $('#js-sticky-title'),
                    $stickyImage = $('#js-sticky-img'),
                    $stickyButton = $('#js-sticky-btn');
                if (variant) {
                    //update title
                    $stickyTitle.html(' - ' + variant.title);
                    //update price
                    $stickyPrice.html(theme.Currency.formatMoney(variant.price, theme.moneyFormat));
                    //update selectbox
                    for (var i = 1; i <= 3; i++) {
                        var option = 'option' + i,
                            $selecBox = '#js-sticky-option-' + i;
                        if (variant[option] !== null) {
                            var valueOption = variant[option];
                            $($selecBox).val(valueOption);
                        }
                    }
                    //update button cart
                    if (variant.available) {
                        $stickyButton.prop('disabled', false).removeClass('btn--sold-out');
                        $stickyButton.html(theme.strings.addToCart);
                    } else {
                        $stickyButton.prop('disabled', true).addClass('btn--sold-out');
                        $stickyButton.html(theme.strings.soldOut);
                    }
                    //update image
                    if (variant.featured_image) {
                        $stickyImage.attr('src', theme.Images.getSizedImageUrl(variant.featured_image.src, '200x'));
                    }
                } else {
                    //update title
                    $stickyTitle.html(' - ' + theme.strings.unavailable);
                    //update button cart
                    $stickyButton.prop('disabled', true).removeClass('btn--sold-out');
                    $stickyButton.html(theme.strings.unavailable);
                }
            },

            switchProductImage: function(imageId) {
                var $imageToShow = $(
                    this.selectors.productImageContainers +
                    "[data-image-id='" +
                    imageId +
                    "']",
                    this.$container
                );
                var $imagesToHide = $(
                    this.selectors.productImageContainers +
                    ":not([data-image-id='" +
                    imageId +
                    "'])",
                    this.$container
                );
                $imagesToHide.addClass('hide');
                $imageToShow.removeClass('hide');
                //Scroll to active
                topMenuHeight = $('.site-header').outerHeight();
                if (this.settings.sectionId === 'product-template-8') {
                    $([document.documentElement, document.body]).animate({
                        scrollTop: $imageToShow.offset().top - topMenuHeight
                    }, 500);
                }
            },

            setActiveThumbnail: function(imageId) {
                var $thumbnailToShow = $(
                    this.selectors.productThumbContainers +
                    "[data-image-id='" +
                    imageId +
                    "']",
                    this.$container
                );
                var $thumbnailsToHide = $(
                    this.selectors.productThumbContainers +
                    ":not([data-image-id='" +
                    imageId +
                    "'])",
                    this.$container
                );
                $thumbnailsToHide.removeClass('is-active');
                $thumbnailToShow.addClass('is-active');
                $thumbnailToShow.trigger('click');
                var $thumbnails = $(this.selectors.productThumbsWrapper, this.$container);

                // If there is a slick carousel, get the slide index, and position it into view with animation.
                if ($thumbnails.hasClass('slick-initialized')) {
                    // eslint-disable-next-line shopify/jquery-dollar-sign-reference
                    var currentActiveSlideIndex = $thumbnails.slick('slickCurrentSlide');
                    var newActiveSlideIndex = parseInt(
                        $thumbnailToShow.attr('data-slick-index')
                    );
                    if (currentActiveSlideIndex !== newActiveSlideIndex) {
                        $thumbnails.slick('slickGoTo', newActiveSlideIndex, false);

                    }
                }
            },

            _productZoomImage: function() {
                // The zoom image is only used on the product template, so return early
                // even if a featured product section is present.
                if (!$('.product-single ' + this.selectors.productImageContainers).length) {
                    return;
                }

                var self = this;

                $(this.selectors.productImageWrappers).on(
                    'click' + this.settings.namespace,
                    function(evt) {
                        evt.preventDefault();
                        // Empty src before loadig new image to avoid awkward image swap
                        $(self.selectors.productZoomImage)
                            .attr('src', '')
                            .attr('src', $(this).attr('href'));
                    }
                );

                this.ProductModal = new window.Modals(
                    this.selectors.modal,
                    'product-modal'
                );

                // Close modal if clicked, but not if the image is clicked
                this.ProductModal.$modal.on('click' + this.settings.namespace, function(
                    evt
                ) {
                    if (evt.target.nodeName !== 'IMG') {
                        self.ProductModal.close();
                    }
                });
            },

            _productThumbSwitch: function() {
                if (!$(this.selectors.productThumbs).length) {
                    return;
                }

                var self = this;

                $(this.selectors.productThumbs).on(
                    'click' + this.settings.namespace,
                    function(evt) {
                        evt.preventDefault();
                        var imageId = $(this)
                            .parent()
                            .data('image-id');
                        self.setActiveThumbnail(imageId);
                        self.switchProductImage(imageId);
                    }
                );
                //trigger hover thumb
                // $(this.selectors.productThumbs).on('click',function(){
                //   $(this).trigger('click');
                // });
            },

            /*
              Thumbnail slider
             */
            _productThumbnailSlider: function() {
                var $productThumbsWrapper = $(this.selectors.productThumbsWrapper);
                var $productThumbs = $(this.selectors.productThumbs);
                if (!$productThumbs.length) {
                    return;
                }

                if ($productThumbs.length > 1) {
                    $productThumbsWrapper.on(
                        'init' + this.settings.namespace,
                        this._productSwipeInit.bind(this)
                    );

                    if (this.settings.sectionId === 'product-template-3' || this.settings.sectionId === 'product-template-4') {
                        $productThumbsWrapper.slick({
                            accessibility: false,
                            arrows: true,
                            dots: false,
                            infinite: false,
                            autoplay: false,
                            slidesToShow: 5,
                            slidesToScroll: 5,
                            vertical: true,
                            verticalSwiping: true,
                            responsive: [{
                                breakpoint: 992,
                                settings: {
                                    vertical: false,
                                    verticalSwiping: false,
                                    slidesToShow: 4,
                                    slidesToScroll: 4,
                                    dots: false,
                                }
                            }]
                        }).css('opacity', '1');
                    } else if (this.settings.sectionId === 'product-template-5') {
                        $productThumbsWrapper.slick({
                            accessibility: false,
                            arrows: true,
                            dots: false,
                            infinite: true,
                            autoplay: false,
                            slidesToShow: 2,
                            slidesToScroll: 1,
                            responsive: [{
                                breakpoint: 992,
                                settings: {
                                    slidesToShow: 4,
                                    slidesToScroll: 4,
                                    dots: false,
                                }
                            }]
                        }).css('opacity', '1');
                    } else if (this.settings.sectionId === 'product-template-7') {
                        $productThumbsWrapper.slick({
                            accessibility: false,
                            arrows: true,
                            dots: true,
                            infinite: true,
                            autoplay: false,
                            slidesToShow: 1,
                            slidesToScroll: 1,
                            responsive: [{
                                breakpoint: 992,
                                settings: {
                                    slidesToShow: 1,
                                    slidesToScroll: 1,
                                    dots: false,
                                    arrows: true,
                                }
                            }]
                        }).css('opacity', '1');
                    } else if (this.settings.sectionId === 'product-template-8') {
                        var lastId,
                            topMenu = $(".product-single__thumbnails"),
                            topMenuHeight = $('.site-header').outerHeight() + 20,
                            // All list items
                            menuItems = topMenu.find(".product-single__thumbnail");


                        if ($(window).width() > 767) {
                            menuItems.click(function(e) {
                                var findid = $(this).attr('href');
                                offsetTop = $(findid).offset().top - topMenuHeight + 1;
                                $('html, body').stop().animate({
                                    scrollTop: offsetTop
                                }, 200);
                                return false;
                            });
                            // Anchors corresponding to menu items
                            scrollItems = menuItems.map(function() {
                                var item = $($(this).attr('href'));
                                if (item.length) { return item; }
                            });

                            $(window).scroll(function() {
                                // Get container scroll position
                                var fromTop = $(this).scrollTop() + topMenuHeight;
                                // Get id of current scroll item
                                var cur = scrollItems.map(function() {
                                    if ($(this).offset().top < fromTop)
                                        return this;
                                });
                                // Get the id of the current element
                                cur = cur[cur.length - 1];
                                var id = cur && cur.length ? cur[0].id : "";

                                if (lastId !== id) {
                                    lastId = id;
                                    // Set/remove active class
                                    menuItems
                                        .parent().removeClass("is-active")
                                        .end().filter("[href='#" + id + "']").parent().addClass("is-active");
                                }
                            });
                        } else {
                            menuItems.click(function(e) {
                                var findid = $(this).attr('href');
                                offsetTop = $(findid).offset().top;
                                $('html, body').stop().animate({
                                    scrollTop: offsetTop
                                });
                                return false;
                            });
                        }

                        $productThumbsWrapper.slick({
                            accessibility: false,
                            arrows: true,
                            dots: false,
                            infinite: false,
                            autoplay: false,
                            slidesToShow: 5,
                            slidesToScroll: 1,
                            vertical: true,
                            verticalSwiping: true,
                            responsive: [{
                                breakpoint: 992,
                                settings: {
                                    vertical: false,
                                    verticalSwiping: false,
                                    slidesToShow: 4,
                                    slidesToScroll: 4,
                                    dots: true,
                                }
                            }]
                        }).css('opacity', '1');
                    } else {
                        $productThumbsWrapper.slick({
                            accessibility: false,
                            arrows: true,
                            dots: false,
                            infinite: false,
                            autoplay: false,
                            slidesToShow: 4,
                            slidesToScroll: 4
                        }).css('opacity', '1');
                    }

                    // Show highlighted thumbnail by repositioning slider
                    $productThumbsWrapper.slick(
                        'slickGoTo',
                        $productThumbsWrapper.find('.is-active').attr('data-slick-index'),
                        true
                    );
                }
            },

            _productSwipeInit: function(evt, obj) {
                // Slider is initialized. Setup custom swipe events
                this.settings.productThumbIndex = obj.currentSlide;
                this.settings.productThumbMax = obj.slideCount - 1; // we need the 0-based index

                var self = this;

                $(this.selectors.productImageWrappers).on(
                    'swipeleft swiperight',
                    function(event) {
                        if (event.type === 'swipeleft') {
                            self._goToNextThumbnail();
                        }

                        if (event.type === 'swiperight') {
                            self._goToPrevThumbnail();
                        }

                        // Trigger click on newly requested thumbnail
                        $(
                                '.product-single__thumbnail-item[data-slick-index="' +
                                self.settings.productThumbIndex +
                                '"]'
                            )
                            .find('.product-single__thumbnail')
                            .trigger('click');

                    }
                );
            },
            _goToNextThumbnail: function() {
                this.settings.productThumbIndex++;

                if (this.settings.productThumbIndex > this.settings.productThumbMax) {
                    this.settings.productThumbIndex = 0;
                }

                $(this.selectors.productThumbsWrapper).slick(
                    'slickGoTo',
                    this.settings.productThumbIndex,
                    true
                );
            },

            _goToPrevThumbnail: function() {
                this.settings.productThumbIndex--;

                if (this.settings.productThumbIndex < 0) {
                    this.settings.productThumbIndex = this.settings.productThumbMax;
                }

                $(this.selectors.productThumbsWrapper).slick(
                    'slickGoTo',
                    this.settings.productThumbIndex,
                    true
                );
            },

            _initQtySelector: function() {
                this.$container.find('.product-form__quantity').each(function(i, el) {
                    // eslint-disable-next-line no-new
                    new QtySelector($(el));
                });
            },

            onUnload: function() {
                $(this.selectors.productImageWrappers).off(this.settings.namespace);
                $(this.selectors.productThumbs).off(this.settings.namespace);
                $(this.selectors.productThumbs).slick('unslick');
                if (this.ProductModal) {
                    this.ProductModal.$modal.off(this.settings.namespace);
                }
            }
        });

        return Product;
    })();

    theme.Slideshow = (function() {
        this.$slideshow = null;
        var classes = {
            slideshow: 'slideshow',
            slickActiveMobile: 'slick-active-mobile',
            controlsHover: 'slideshow__controls--hover',
            isPaused: 'is-paused'
        };

        var selectors = {
            section: '.shopify-section',
            wrapper: '#SlideshowWrapper-',
            slides: '.slideshow__slide',
            textWrapperMobile: '.slideshow__text-wrap--mobile',
            textContentMobile: '.slideshow__text-content--mobile',
            controls: '.slideshow__controls',
            dots: '.slick-dots',
            arrowLeft: '.slideshow__arrow-left',
            arrowRight: '.slideshow__arrow-right'
        };

        function slideshow(el, sectionId) {
            var $slideshow = (this.$slideshow = $(el));
            this.adaptHeight = this.$slideshow.data('adapt-height');
            this.$wrapper = this.$slideshow.closest(selectors.wrapper + sectionId);
            this.$section = this.$wrapper.closest(selectors.section);
            this.$controls = this.$wrapper.find(selectors.controls);
            this.$textWrapperMobile = this.$section.find(selectors.textWrapperMobile);
            this.autorotate = this.$slideshow.data('autorotate');
            var autoplaySpeed = this.$slideshow.data('speed');
            var loadSlideA11yString = this.$slideshow.data('slide-nav-a11y');

            this.settings = {
                rtl: theme.rtl,
                accessibility: true,
                arrows: true,
                dots: true,
                fade: (theme.rtl ? false : true),
                draggable: true,
                touchThreshold: 20,
                autoplay: this.autorotate,
                autoplaySpeed: autoplaySpeed
            };

            this.$slideshow.on('beforeChange', beforeChange.bind(this));
            this.$slideshow.on('init', slideshowA11ySetup.bind(this));

            // Add class to style mobile dots & show the correct text content for the
            // first slide on mobile when the slideshow initialises
            this.$slideshow.on(
                'init',
                function() {
                    this.$mobileDots
                        .find('li:first-of-type')
                        .addClass(classes.slickActiveMobile);
                    this.showMobileText(0);
                }.bind(this)
            );

            if (this.adaptHeight) {
                this.setSlideshowHeight();
                $(window).resize($.debounce(50, this.setSlideshowHeight.bind(this)));
            }

            this.$slideshow.slick(this.settings);

            // This can't be called when the slick 'init' event fires due to how slick
            // adds a11y features.
            slideshowPostInitA11ySetup.bind(this)();
        }

        function slideshowA11ySetup(event, obj) {
            var $slider = obj.$slider;
            var $list = obj.$list;
            this.$dots = this.$section.find(selectors.dots);
            this.$mobileDots = this.$dots.eq(1);

            // Remove default Slick aria-live attr until slider is focused
            $list.removeAttr('aria-live');

            //     this.$wrapper.on('keyup', keyboardNavigation.bind(this));
            //     this.$controls.on('keyup', keyboardNavigation.bind(this));
            //     this.$textWrapperMobile.on('keyup', keyboardNavigation.bind(this));

            // When an element in the slider is focused
            // pause slideshow and set aria-live.
            this.$wrapper
                .on(
                    'focusin',
                    function(evt) {
                        if (!this.$wrapper.has(evt.target).length) {
                            return;
                        }

                        $list.attr('aria-live', 'polite');
                        if (this.autorotate) {
                            $slider.slick('slickPause');
                        }
                    }.bind(this)
                )
                .on(
                    'focusout',
                    function(evt) {
                        if (!this.$wrapper.has(evt.target).length) {
                            return;
                        }

                        $list.removeAttr('aria-live');
                    }.bind(this)
                );

            // Add arrow key support when focused
            if (this.$dots) {
                this.$dots
                    .find('a')
                    .each(function() {
                        var $dot = $(this);
                        $dot.on('click keyup', function(evt) {
                            if (
                                evt.type === 'keyup' &&
                                evt.which !== slate.utils.keyboardKeys.ENTER
                            )
                                return;

                            evt.preventDefault();

                            var slideNumber = $(evt.target).data('slide-number');

                            $slider.attr('tabindex', -1).slick('slickGoTo', slideNumber);

                            if (evt.type === 'keyup') {
                                $slider.focus();
                            }
                        });
                    })
                    .eq(0)
                    .attr('aria-current', 'true');
            }

            this.$controls
                .on('focusin', highlightControls.bind(this))
                .on('focusout', unhighlightControls.bind(this));
        }

        function slideshowPostInitA11ySetup() {
            var $slides = this.$slideshow.find(selectors.slides);

            $slides.removeAttr('role').removeAttr('aria-labelledby');
            this.$dots
                .removeAttr('role')
                .find('li')
                .removeAttr('role')
                .removeAttr('aria-selected')
                .each(function() {
                    var $dot = $(this);
                    var ariaControls = $dot.attr('aria-controls');
                    $dot
                        .removeAttr('aria-controls')
                        .find('a')
                        .attr('aria-controls', ariaControls);
                });
        }

        function beforeChange(event, slick, currentSlide, nextSlide) {
            var $dotLinks = this.$dots.find('a');
            var $mobileDotLinks = this.$mobileDots.find('li');

            $dotLinks
                .removeAttr('aria-current')
                .eq(nextSlide)
                .attr('aria-current', 'true');

            $mobileDotLinks
                .removeClass(classes.slickActiveMobile)
                .eq(nextSlide)
                .addClass(classes.slickActiveMobile);
            this.showMobileText(nextSlide);
        }

        //   function keyboardNavigation() {
        //     if (event.keyCode === slate.utils.keyboardKeys.LEFTARROW) {
        //       this.$slideshow.slick('slickPrev');
        //     }
        //     if (event.keyCode === slate.utils.keyboardKeys.RIGHTARROW) {
        //       this.$slideshow.slick('slickNext');
        //     }
        //   }

        function highlightControls() {
            this.$controls.addClass(classes.controlsHover);
        }

        function unhighlightControls() {
            this.$controls.removeClass(classes.controlsHover);
        }

        slideshow.prototype.setSlideshowHeight = function() {
            var minAspectRatio = this.$slideshow.data('min-aspect-ratio');
            this.$slideshow.height($(document).width() / minAspectRatio);
        };

        slideshow.prototype.showMobileText = function(slideIndex) {
            var $allTextContent = this.$textWrapperMobile.find(
                selectors.textContentMobile
            );
            var currentTextContentSelector =
                selectors.textContentMobile + '-' + slideIndex;
            var $currentTextContent = this.$textWrapperMobile.find(
                currentTextContentSelector
            );
            if (!$currentTextContent.length &&
                this.$slideshow.find(selectors.slides).length === 1
            ) {
                this.$textWrapperMobile.hide();
            } else {
                this.$textWrapperMobile.show();
            }
            $allTextContent.hide();
            $currentTextContent.show();
        };

        function getSlideshowId($el) {
            return '#Slideshow-' + $el.data('id');
        }

        return slideshow;
    })();

    theme.slideshows = {};

    theme.SlideshowSection = (function() {
        function SlideshowSection(container) {
            var $container = (this.$container = $(container));
            var sectionId = $container.attr('data-section-id');
            var slideshow = (this.slideshow = '#Slideshow-' + sectionId);

            theme.slideshows[slideshow] = new theme.Slideshow(slideshow, sectionId);
        }

        return SlideshowSection;
    })();

    theme.SlideshowSection.prototype = _.assignIn({},
        theme.SlideshowSection.prototype, {
            onUnload: function() {
                delete theme.slideshows[this.slideshow];
            },

            onBlockSelect: function(evt) {
                var $slideshow = $(this.slideshow);
                var adaptHeight = $slideshow.data('adapt-height');

                if (adaptHeight) {
                    theme.slideshows[this.slideshow].setSlideshowHeight();
                }

                // Ignore the cloned version
                var $slide = $(
                    '.slideshow__slide--' + evt.detail.blockId + ':not(.slick-cloned)'
                );
                var slideIndex = $slide.data('slick-index');

                // Go to selected slide, pause auto-rotate
                $slideshow.slick('slickGoTo', slideIndex).slick('slickPause');
            },

            onBlockDeselect: function() {
                // Resume auto-rotate
                $(this.slideshow).slick('slickPlay');
            }
        }
    );

    theme.slideshows = {};

    theme.Cart = (function() {
        var selectors = {
            cartNote: '#CartSpecialInstructions',
            cartQtyInput: '.cart__quantity',
            cartNoCookiesClass: 'cart--no-cookies'
        };

        function Cart(container) {
            var $container = (this.$container = $(container));
            var sectionId = $container.attr('data-section-id');

            theme.cartObject = JSON.parse($('#CartJson-' + sectionId).html());

            this.init($container);
        }

        Cart.prototype = _.assignIn({}, Cart.prototype, {
            init: function($container) {
                this._initQtySelector();
                this._initCartNote();

                if (!this._cookiesEnabled()) {
                    $container.addClass(selectors.cartNoCookiesClass);
                }
            },

            _initQtySelector: function() {
                $(selectors.cartQtyInput).each(function(i, el) {
                    // eslint-disable-next-line no-new
                    new QtySelector($(el));
                });
            },

            _initCartNote: function() {
                if (!$(selectors.cartNote).length) {
                    return;
                }

                var $el = $(selectors.cartNote);
                var noteText;
                var params;
                var noteOffset = $el[0].offsetHeight - $el[0].clientHeight;

                // Auto grow the cart note if text fills it up
                $el.on('keyup input', function() {
                    $(this)
                        .css('height', 'auto')
                        .css('height', $el[0].scrollHeight + noteOffset);
                });

                // Save the cart note via ajax. A safeguard in case
                // a user decides to leave the page before clicking 'Update Cart'
                $el.on(
                    'change',
                    $.proxy(function() {
                        noteText = $el.val();
                        params = {
                            type: 'POST',
                            url: '/cart/update.js',
                            data: 'note=' + this._attributeToString(noteText),
                            dataType: 'json'
                        };
                        $.ajax(params);
                    }, this)
                );
            },

            _attributeToString: function(attr) {
                if (typeof attr !== 'string') {
                    attr = String(attr);
                    if (attr === 'undefined') {
                        attr = '';
                    }
                }
                return $.trim(attr);
            },

            _cookiesEnabled: function() {
                var cookieEnabled = navigator.cookieEnabled;

                if (!cookieEnabled) {
                    document.cookie = 'testcookie';
                    cookieEnabled = document.cookie.indexOf('testcookie') !== -1;
                }
                return cookieEnabled;
            }
        });

        return Cart;
    })();

    // Instagrams
    theme.Instagrams = (function() {
        function Instagrams(container) {
            this.$container = $(container).on('init', this._a11y.bind(this));
            //console.log(this.$container);
            this.settings = {
                style: this.$container.data('style'),
                accesstoken: this.$container.data('accesstoken'),
                userid: this.$container.data('userid'),
                limit: this.$container.data('limit'),
                resolution: this.$container.data('resolution'),
                target: this.$container.attr('id'),
                rows: this.$container.data('rows'),

                slidesToShow: this.$container.data('slidestoshow') || 1,
                infinite: this.$container.data('infinite') || false,
                arrows: this.$container.data('arrows') || false,
                draggable: this.$container.data('draggable') || false,
                dots: this.$container.data('dots') || false,
            }
            this.settings.slidesToShow1200 = (this.settings.slidesToShow - 1) > 1 ? (this.settings.slidesToShow - 1) : 1;
            this.settings.slidesToShow992 = (this.settings.slidesToShow - 2) > 1 ? (this.settings.slidesToShow - 2) : 1;
            this.settings.slidesToShow768 = (this.settings.slidesToShow - 3) > 1 ? (this.settings.slidesToShow - 3) : 1;
            this.settings.slidesToShow480 = 2;

            var _self = this;
            var $instagramSelector = $('#' + this.settings.target);
            if (this.settings.style === 'grid') {
                var afterInstagram = function() {} // blank function
            } else if (this.settings.style === 'carousel') {
                var afterInstagram = function() {
                    $instagramSelector.slick({
                        slidesToShow: _self.settings.slidesToShow,
                        slidesToScroll: _self.settings.slidesToShow,
                        arrows: _self.settings.arrows,
                        dots: _self.settings.dots,
                        draggable: _self.settings.draggable,
                        infinite: _self.settings.infinite,
                        rows: _self.settings.rows,
                        responsive: [{
                                breakpoint: 1200,
                                settings: {
                                    slidesToShow: _self.settings.slidesToShow1200,
                                    slidesToScroll: _self.settings.slidesToShow1200,
                                }
                            },
                            {
                                breakpoint: 992,
                                settings: {
                                    slidesToShow: _self.settings.slidesToShow992,
                                    slidesToScroll: _self.settings.slidesToShow992,
                                }
                            },
                            {
                                breakpoint: 768,
                                settings: {
                                    slidesToShow: _self.settings.slidesToShow768,
                                    slidesToScroll: _self.settings.slidesToShow768,
                                }
                            },
                            {
                                breakpoint: 480,
                                settings: {
                                    slidesToShow: _self.settings.slidesToShow480,
                                    slidesToScroll: _self.settings.slidesToShow480,
                                }
                            }
                        ]
                    })
                }
            }

            var feed = new Instafeed({
                get: 'user',
                target: this.settings.target,
                userId: this.settings.userid,
                accessToken: this.settings.accesstoken,
                limit: this.settings.limit,
                resolution: this.settings.resolution,
                template: '<div class="col hv-image-brightness"><a class="instagram-item" href="{{link}}" target="_blank" id="{{id}}"><img alt="instagram image" class="transition lazyload" data-src="{{image}}" /></a></div>',
                after: afterInstagram
            });

            feed.run();
        }

        Instagrams.prototype = _.assignIn({}, Instagrams.prototype, {
            _a11y: function(event, obj) {
                var $list = obj.$list;
                var $wrapper = this.$container.parent();

                // Remove default Slick aria-live attr until slider is focused
                $list.removeAttr('aria-live');

                // When an element in the slider is focused set aria-live
                $wrapper.on('focusin', function(evt) {
                    if ($wrapper.has(evt.target).length) {
                        $list.attr('aria-live', 'polite');
                    }
                });

                // Remove aria-live
                $wrapper.on('focusout', function(evt) {
                    if ($wrapper.has(evt.target).length) {
                        $list.removeAttr('aria-live');
                    }
                });
            }
        });

        return Instagrams;
    })();

    // Slick carousel
    theme.slickCarousel = (function() {
        function Carousels(container) {
            this.$container = $(container).on('init', this._a11y.bind(this));
            this.settings = {
                rows: this.$container.data('rows') || 1,
                slidesToShow: this.$container.data('slidestoshow') || 1,
                slidesToScroll: this.$container.data('slidestoscroll') || 1,
                infinite: this.$container.data('infinite') || false,
                arrows: this.$container.data('arrows') || false,
                dots: this.$container.data('dots') || false,
                autoplay: this.$container.data('autoplay') || false,
                draggable: this.$container.data('draggable') || false,
                accessibility: this.$container.data('accessibility') || true,
            }
            this.settings.slidesToShow1200 = (this.settings.slidesToShow - 1) > 1 ? (this.settings.slidesToShow - 1) : 1;
            this.settings.slidesToShow992 = (this.settings.slidesToShow - 2) > 1 ? (this.settings.slidesToShow - 2) : 1;
            this.settings.slidesToShow768 = (this.settings.slidesToShow - 3) > 1 ? (this.settings.slidesToShow - 3) : 1;
            this.settings.slidesToShow480 = (this.settings.slidesToShow - 4) > 1 ? (this.settings.slidesToShow - 4) : 1;
            this.settings.slidesToScroll1200 = (this.settings.slidesToScroll - 1) > 1 ? (this.settings.slidesToScroll - 1) : 1;
            this.settings.slidesToScroll992 = (this.settings.slidesToScroll - 2) > 1 ? (this.settings.slidesToScroll - 2) : 1;
            this.settings.slidesToScroll768 = (this.settings.slidesToScroll - 3) > 1 ? (this.settings.slidesToScroll - 3) : 1;
            this.settings.slidesToScroll480 = (this.settings.slidesToScroll - 4) > 1 ? (this.settings.slidesToScroll - 4) : 1;
            this.$container.slick({
                rtl: theme.rtl,
                rows: this.settings.rows,
                slidesToShow: this.settings.slidesToShow,
                slidesToScroll: this.settings.slidesToScroll,
                arrows: this.settings.arrows,
                dots: this.settings.dots,
                autoplay: this.settings.autoplay,
                accessibility: this.settings.accessibility,
                draggable: this.settings.draggable,
                infinite: this.settings.infinite,
                adaptiveHeight: true,
                responsive: [{
                        breakpoint: 1200,
                        settings: {
                            slidesToShow: this.settings.slidesToShow1200,
                            slidesToScroll: this.settings.slidesToScroll1200
                        }
                    },
                    {
                        breakpoint: 992,
                        settings: {
                            slidesToShow: this.settings.slidesToShow992,
                            slidesToScroll: this.settings.slidesToScroll992
                        }
                    },
                    {
                        breakpoint: 768,
                        settings: {
                            slidesToShow: this.settings.slidesToShow768,
                            slidesToScroll: this.settings.slidesToScroll768
                        }
                    },
                    {
                        breakpoint: 480,
                        settings: {
                            slidesToShow: 1,
                            slidesToScroll: this.settings.slidesToScroll480
                        }
                    }
                ]
            })
        }

        Carousels.prototype = _.assignIn({}, Carousels.prototype, {
            _a11y: function(event, obj) {
                var $list = obj.$list;
                var $wrapper = this.$container.parent();

                // Remove default Slick aria-live attr until slider is focused
                $list.removeAttr('aria-live');

                // When an element in the slider is focused set aria-live
                $wrapper.on('focusin', function(evt) {
                    if ($wrapper.has(evt.target).length) {
                        $list.attr('aria-live', 'polite');
                    }
                });

                // Remove aria-live
                $wrapper.on('focusout', function(evt) {
                    if ($wrapper.has(evt.target).length) {
                        $list.removeAttr('aria-live');
                    }
                });
            },

            _goToSlide: function(slideIndex) {
                this.$container.slick('slickGoTo', slideIndex);
            },

            onUnload: function() {
                delete this.$container;
            },

            onBlockSelect: function(evt) {
                // Ignore the cloned version
                var $slide = $(
                    '.carousel__slide-wrapper--' + evt.detail.blockId + ':not(.slick-cloned)'
                );
                var slideIndex = $slide.data('slick-index');

                // Go to selected slide, pause autoplay
                this._goToSlide(slideIndex);

            }
        });

        return Carousels;
    })()

    // Productlists
    theme.Productlists = (function() {
        function Productlists(container) {
            this.$container = $(container).on('init', this._a11y.bind(this));
            this.settings = {
                slidesToShow: this.$container.data('slidestoshow') || 1,
                rows: this.$container.data('rows') || 1,
                arrows: this.$container.data('arrows') || false,
                dots: this.$container.data('dots') || false,
                draggable: this.$container.data('draggable') || false,
                infinite: this.$container.data('infinite') || false,
            }
            this.settings.slidesToShow1200 = (this.settings.slidesToShow - 1) > 1 ? (this.settings.slidesToShow - 1) : 1;
            this.settings.slidesToShow992 = (this.settings.slidesToShow - 2) > 1 ? (this.settings.slidesToShow - 2) : 1;
            this.settings.slidesToShow768 = (this.settings.slidesToShow - 3) > 1 ? (this.settings.slidesToShow - 3) : 1;
            this.settings.slidesToShow480 = 2;
            this.$container.slick({
                rtl: theme.rtl,
                accessibility: true,
                slidesToShow: this.settings.slidesToShow,
                slidesToScroll: this.settings.slidesToShow,
                rows: this.settings.rows,
                arrows: this.settings.arrows,
                dots: this.settings.dots,
                infinite: this.settings.infinite,
                draggable: this.settings.draggable,
                responsive: [{
                        breakpoint: 1200,
                        settings: {
                            slidesToShow: this.settings.slidesToShow1200,
                            slidesToScroll: this.settings.slidesToShow1200
                        }
                    },
                    {
                        breakpoint: 992,
                        settings: {
                            slidesToShow: this.settings.slidesToShow992,
                            slidesToScroll: this.settings.slidesToShow992
                        }
                    },
                    {
                        breakpoint: 768,
                        settings: {
                            slidesToShow: this.settings.slidesToShow768,
                            slidesToScroll: this.settings.slidesToShow768
                        }
                    },
                    {
                        breakpoint: 480,
                        settings: {
                            slidesToShow: this.settings.slidesToShow480,
                            slidesToScroll: this.settings.slidesToShow480
                        }
                    }
                ]
            }).css('opacity', '1');
        }

        Productlists.prototype = _.assignIn({}, Productlists.prototype, {
            _a11y: function(event, obj) {
                var $list = obj.$list;
                var $wrapper = this.$container.parent();

                // Remove default Slick aria-live attr until slider is focused
                $list.removeAttr('aria-live');

                // When an element in the slider is focused set aria-live
                $wrapper.on('focusin', function(evt) {
                    if ($wrapper.has(evt.target).length) {
                        $list.attr('aria-live', 'polite');
                    }
                });

                // Remove aria-live
                $wrapper.on('focusout', function(evt) {
                    if ($wrapper.has(evt.target).length) {
                        $list.removeAttr('aria-live');
                    }
                });
            },

            _goToSlide: function(slideIndex) {
                this.$container.slick('slickGoTo', slideIndex);
            },

            onUnload: function() {
                delete this.$container;
            }
        });

        return Productlists;
    })();

    // Producttabs
    theme.Producttabs = (function() {
        function Producttabs(container) {
            var _self = this; // avoid conflict
            this.$container = $(container).on('init', this._a11y.bind(this));
            this.slickWrap = '.prdtab-content';
            this.settings = {
                slidesToShow: this.$container.data('slidestoshow') || 1,
                arrows: this.$container.data('arrows') || false,
                rows: this.$container.data('rows') || 1,
                dots: this.$container.data('dots') || false,
                draggable: this.$container.data('draggable') || false,
                infinite: this.$container.data('infinite') || false,
            }
            this.settings.slidesToShow1200 = (this.settings.slidesToShow - 1) > 1 ? (this.settings.slidesToShow - 1) : 1;
            this.settings.slidesToShow992 = (this.settings.slidesToShow - 2) > 1 ? (this.settings.slidesToShow - 2) : 1;
            this.settings.slidesToShow768 = (this.settings.slidesToShow - 3) > 1 ? (this.settings.slidesToShow - 3) : 1;
            this.settings.slidesToShow480 = 2;

            this._initSlick();
            this.$container.find('a[data-toggle="tab"]').on("shown.bs.tab", function(e) {
                _self._unSlick();
                _self._initSlick();
                theme.tooltip.load();
            })
        }

        Producttabs.prototype = _.assignIn({}, Producttabs.prototype, {
            _a11y: function(event, obj) {
                var $list = obj.$list;
                var $wrapper = this.$container.parent();

                // Remove default Slick aria-live attr until slider is focused
                $list.removeAttr('aria-live');

                // When an element in the slider is focused set aria-live
                $wrapper.on('focusin', function(evt) {
                    if ($wrapper.has(evt.target).length) {
                        $list.attr('aria-live', 'polite');
                    }
                });

                // Remove aria-live
                $wrapper.on('focusout', function(evt) {
                    if ($wrapper.has(evt.target).length) {
                        $list.removeAttr('aria-live');
                    }
                });
            },

            _getSliderSettings: function() {
                return {
                    rtl: theme.rtl,
                    accessibility: true,
                    slidesToShow: this.settings.slidesToShow,
                    slidesToScroll: this.settings.slidesToShow,
                    arrows: this.settings.arrows,
                    rows: this.settings.rows,
                    dots: this.settings.dots,
                    infinite: this.settings.infinite,
                    draggable: this.settings.draggable,
                    responsive: [{
                            breakpoint: 1200,
                            settings: {
                                slidesToShow: this.settings.slidesToShow1200,
                                slidesToScroll: this.settings.slidesToShow1200
                            }
                        },
                        {
                            breakpoint: 992,
                            settings: {
                                slidesToShow: this.settings.slidesToShow992,
                                slidesToScroll: this.settings.slidesToShow992
                            }
                        },
                        {
                            breakpoint: 768,
                            settings: {
                                slidesToShow: this.settings.slidesToShow768,
                                slidesToScroll: this.settings.slidesToShow768
                            }
                        },
                        {
                            breakpoint: 480,
                            settings: {
                                slidesToShow: this.settings.slidesToShow480,
                                slidesToScroll: this.settings.slidesToShow480
                            }
                        }
                    ]
                }
            },

            _initSlick: function() {
                this.$container.find(this.slickWrap).slick(this._getSliderSettings()).css('opacity', '1');
            },

            _unSlick: function() {
                this.$container.find(this.slickWrap).slick('unslick');
            },

            onUnload: function() {
                delete this.$container;
            },

            onSelect: function() {
                this._unSlick();
                this._initSlick();
            },

            onBlockSelect: function(evt) {
                var navItem = $('.nav-link-' + evt.detail.blockId);
                navItem.tab('show');
                this._unSlick();
                this._initSlick();
            }
        });

        return Producttabs;
    })();

    theme.Video = (function() {
        var promiseYoutubeAPI;
        var promiseVimeoAPI;

        var youtube = {
            promiseAPI: function() {
                if (!promiseYoutubeAPI) {
                    var tag = document.createElement('script');

                    tag.src = 'https://www.youtube.com/iframe_api';
                    var firstScriptTag = document.getElementsByTagName('script')[0];
                    firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

                    promiseYoutubeAPI = $.Deferred(function(defer) {
                        window.onYouTubeIframeAPIReady = defer.resolve;

                        setTimeout(function() {
                            defer.reject('Request for YouTube API timed out after 30 seconds.');
                        }, 30000);
                    });
                }

                return promiseYoutubeAPI;
            },
            promisePlayer: function(id, options) {
                return this.promiseAPI().then(function() {
                    return $.Deferred(function(defer) {
                        if (typeof window.YT === 'undefined') {
                            defer.reject(
                                "We're sorry, something went wrong. The YouTube API has not loaded correctly."
                            );
                        }

                        /* eslint-disable no-undef */
                        var player = new YT.Player(id, options); // global YT variable injected by YouTube API

                        player.addEventListener('onReady', function() {
                            defer.resolve(player);
                        });

                        setTimeout(function() {
                            defer.reject(
                                'Request for YouTube player has timed out after 30 seconds.'
                            );
                        }, 30000);
                    });
                });
            }
        };

        var vimeo = {
            promiseAPI: function() {
                if (!promiseVimeoAPI) {
                    promiseVimeoAPI = $.Deferred(function(defer) {
                        var tag = document.createElement('script');
                        tag.src = 'https://player.vimeo.com/api/player.js';
                        tag.onload = tag.onreadystatechange = function() {
                            if (!this.readyState || this.readyState === 'complete') {
                                defer.resolve();
                            }
                        };

                        var firstScriptTag = document.getElementsByTagName('script')[0];
                        firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

                        setTimeout(function() {
                            defer.reject('Request for Vimeo API timed out after 30 seconds.');
                        }, 30000);
                    });
                }

                return promiseVimeoAPI;
            },

            promisePlayer: function(id, options) {
                return this.promiseAPI().then(function() {
                    return $.Deferred(function(defer) {
                        if (typeof window.Vimeo === 'undefined') {
                            defer.reject(
                                "We're sorry, something went wrong. The Vimeo API has not loaded correctly."
                            );
                        }

                        var player = new window.Vimeo.Player(id, options);

                        setTimeout(function() {
                            defer.reject(
                                'Request for Vimeo player has timed out after 30 seconds.'
                            );
                        }, 30000);

                        player.ready().then(function() {
                            defer.resolve(player);
                        });
                    });
                });
            }
        };

        var selectors = {
            loadPlayerButton: '.video-section__load-player-button',
            closePlayerButton: '.video-section__player-close',
            playerContainer: '.video-section__player',
            cover: '.video-section__cover',
            errorMessage: '.video-section__error',
            bodyOverlay: '.video-section__body-overlay',
            body: 'body'
        };
        var classes = {
            playerLoading: 'video-section--loading',
            playerLoaded: 'video-section--loaded',
            playerError: 'video-section--error',
            videoPlaying: 'video-playing'
        };

        function Video(container) {
            this.$container = $(container);
            var sectionId = this.$container.attr('data-section-id');
            this.namespace = '.' + sectionId;
            this.onLoad();
        }

        Video.prototype = _.assignIn({}, Video.prototype, {
            onLoad: function() {
                this.$container
                    .on('click', selectors.loadPlayerButton, this._loadPlayer.bind(this))
                    .on('click', selectors.closePlayerButton, this._closePlayer.bind(this))
                    .on('click', selectors.bodyOverlay, this._closePlayer.bind(this));
            },

            _loadPlayer: function() {
                var $container = this.$container;
                var $playerContainer = $(selectors.playerContainer, $container);
                var playerType = this.$container.attr('data-video-type');

                var promiseVideoPlayer;

                if (playerType === 'youtube') {
                    promiseVideoPlayer = this._loadYoutubePlayer($playerContainer[0]);
                } else if (playerType === 'vimeo') {
                    promiseVideoPlayer = this._loadVimeoPlayer($playerContainer[0]);
                }

                return promiseVideoPlayer
                    .then(this._onPlayerLoadReady.bind(this))
                    .fail(this._onPlayerLoadError.bind(this));
            },

            _loadYoutubePlayer: function(container) {
                return youtube
                    .promisePlayer(container, {
                        videoId: this.$container.attr('data-video-id'),
                        ratio: 16 / 9,
                        playerVars: {
                            modestbranding: 1,
                            autoplay: 1,
                            showinfo: 0,
                            rel: 0
                        }
                    })
                    .then(
                        function(player) {
                            this.player = player;
                        }.bind(this)
                    );
            },

            _loadVimeoPlayer: function(container) {
                return vimeo
                    .promisePlayer(container, {
                        id: this.$container.attr('data-video-id')
                    })
                    .then(
                        function(player) {
                            this.player = player;
                            this.player.play();
                        }.bind(this)
                    );
            },

            _onPlayerLoadReady: function() {
                $(selectors.closePlayerButton, this.$container)
                    .show()
                    .focus();
                $(selectors.cover, this.$container).addClass(classes.playerLoaded);
                this.$container.addClass(classes.playerLoaded);

                this._setScrollPositionValues();

                $(selectors.body).addClass(classes.videoPlaying);

                $(document).on('keyup' + this.namespace, this._closeOnEscape.bind(this));
                $(window).on(
                    'resize' + this.namespace,
                    this._setScrollPositionValues.bind(this)
                );
                slate.a11y.trapFocus({
                    $container: this.$container,
                    namespace: this.namespace
                });
            },

            _onPlayerLoadError: function(err) {
                this.$container.addClass(classes.playerError);
                $(selectors.errorMessage, this.$container).text(err);
            },

            _closeOnEscape: function(evt) {
                if (evt.keyCode !== 27) {
                    return;
                }

                this._closePlayer();
                $(selectors.loadPlayerButton, this.$container).focus();
            },

            _onScroll: function() {
                var scrollTop = $(window).scrollTop();

                if (
                    scrollTop > this.videoTop + 0.25 * this.videoHeight ||
                    scrollTop + this.windowHeight <
                    this.videoBottom - 0.25 * this.videoHeight
                ) {
                    // Debounce DOM edits to the next frame with requestAnimationFrame
                    requestAnimationFrame(this._closePlayer.bind(this));
                }
            },

            _setScrollPositionValues: function() {
                this.videoHeight = this.$container.outerHeight(true);
                this.videoTop = this.$container.offset().top;
                this.videoBottom = this.videoTop + this.videoHeight;
                this.windowHeight = $(window).innerHeight();
            },

            _closePlayer: function() {
                $(selectors.body).removeClass(classes.videoPlaying);
                $(selectors.cover, this.$container).removeClass(classes.playerLoaded);
                this.$container.removeClass(classes.playerLoaded);
                $(selectors.closePlayerButton, this.$container).hide();

                slate.a11y.removeTrapFocus({
                    $container: this.$container,
                    namespace: this.namespace
                });

                if (typeof this.player.destroy === 'function') {
                    this.player.destroy();
                } else if (typeof this.player.unload === 'function') {
                    this.player.unload();
                }

                $(document).off(this.namespace);
                $(window).off(this.namespace);
            }
        });

        return Video;
    })();

    theme.CollectionsList = (function() {
        function CollectionsList(container) {
            var $container = (this.$container = $(container));
            var stretchImage = $container.is('[data-stretch-image]');

            // Early return if 'secondary image layout' is enabled
            if (stretchImage) return;

            var namespace = (this.namespace = '.' + $container.attr('data-section-id'));
            var self = this;

            self._collectionListFix();
            $(window).on(
                'resize' + namespace,
                $.debounce(250, function() {
                    self._collectionListFix();
                })
            );
        }

        CollectionsList.prototype = _.assignIn({}, CollectionsList.prototype, {
            onUnload: function() {
                $(window).off(this.namespace);
            },

            _collectionListFix: function() {
                var numberRows = this.$container.find('.grid').data('number-rows');
                var $featureCards = this.$container.find('.featured-card');

                // We can exit if 'Use secondary image layout' is enabled
                if ($featureCards.is('[data-stretch-image]')) return;

                // Go through each of the rows
                for (var i = 0; i < numberRows; i++) {
                    var maxWrapperHeight = 0;
                    var maxHeaderHeight = 0;
                    var $currentRow = $featureCards.filter(
                        "[data-row-number='" + (i + 1) + "']"
                    );
                    var $cardHeaders = $currentRow.find('.featured-card__header');

                    // Find the max heights for each row
                    $currentRow.each(function() {
                        var $cardTitle = $(this).find('.featured-card__title');
                        var $cardAction = $(this).find('.featured-card__action');
                        var $cardImageWrapper = $(this).find('.featured-card__image-wrapper');
                        var headerHeight =
                            $cardTitle.outerHeight() + $cardAction.outerHeight() + 65;
                        var wrapperHeight = $cardImageWrapper.outerHeight();
                        if (headerHeight > maxHeaderHeight) {
                            maxHeaderHeight = headerHeight;
                        }
                        if (wrapperHeight > maxWrapperHeight) {
                            maxWrapperHeight = wrapperHeight;
                        }
                    });

                    // Set the heights of the headers and cards for this row with padding
                    $cardHeaders.outerHeight(maxHeaderHeight);
                    $currentRow.height(maxWrapperHeight + maxHeaderHeight + 40);
                }
            }
        });

        return CollectionsList;
    })();

    theme.ParrallaxImage = (function() {
        function ParrallaxImage(container) {
            this.container = container;
            this.sectionId = $(container).attr('data-section-id');
            this.namespace = 'parallax-' + this.sectionId;
            var images = document.getElementsByClassName('thumbnail' + this.sectionId);
            new simpleParallax(images, {
                scale: 1.5,
                delay: .6,
            });
        }

        ParrallaxImage.prototype = $.extend({}, ParrallaxImage.prototype, {
            onUnload: function(evt) {
                var instance = new simpleParallax(images);
                instance.destroy();
                delete theme.ParrallaxImage[this.namespace];
            }
        });

        return ParrallaxImage;
    })();

    theme.init = function() {
        theme.customerTemplates.init();
        slate.rte.wrapTable();
        slate.rte.iframeReset();

        // Common a11y fixes
        slate.a11y.pageLinkFocus($(window.location.hash));

        $('.in-page-link').on('click', function(evt) {
            slate.a11y.pageLinkFocus($(evt.currentTarget.hash));
        });

        $('a[href="#"]').on('click', function(evt) {
            evt.preventDefault();
        });


        //scroll animation
        AOS.init({
            startEvent: 'DOMContentLoaded',
            offset: 30, // offset (in px) from the original trigger point
            delay: 0, // values from 0 to 3000, with step 50ms
            duration: 1000,
            once: true
        });
        window.addEventListener('load', function() {
            AOS.refresh();
        });


        // Sections
        var sections = new theme.Sections();
        sections.register('header', theme.HeaderSection);
        sections.register('product', theme.Product);
        sections.register('slideshow-section', theme.SlideshowSection);
        sections.register('cart', theme.Cart);
        sections.register('instagrams', theme.Instagrams);
        sections.register('masonries', theme.Masonry);
        sections.register('productlist', theme.Productlists);
        sections.register('producttab', theme.Producttabs);
        sections.register('slickCarousels', theme.slickCarousel);
        sections.register('video', theme.Video);
        sections.register('collections-list', theme.CollectionsList);
        sections.register('parallax-image', theme.ParrallaxImage);
        sections.register('bgcollection', theme.Bgcollection);

        // Standalone modules
        $(window).on('load', theme.articleImages);
        theme.passwordModalInit();
    };

    theme.articleImages = function() {
        var $indentedRteImages = $('.rte--indented-images');
        if (!$indentedRteImages.length) {
            return;
        }

        $indentedRteImages.find('img').each(function(i, el) {
            var $el = $(el);
            var attr = $el.attr('style');

            // Check if undefined or float: none
            if (!attr || attr === 'float: none;') {
                // Add class to parent paragraph tag if image is wider than container
                if ($el.width() >= $indentedRteImages.width()) {
                    $el.parent('p').addClass('rte__image-indent');
                }
            }
        });
    };

    theme.passwordModalInit = function() {
        var $loginModal = $('#LoginModal');
        if (!$loginModal.length) {
            return;
        }

        // Initialize modal
        theme.PasswordModal = new window.Modals('LoginModal', 'login-modal', {
            focusOnOpen: '#Password'
        });

        // Open modal if errors exist
        if ($loginModal.find('.errors').length) {
            theme.PasswordModal.open();
        }
    };

    // CSS var ponyfill
    theme.cssVar = (function() {
        cssVars();
    })()

    // Ajax search https://gist.github.com/awojtczyk/53d74c8af5f893841f33979b0cdcd6fe
    theme.ajaxSearch = (function() {
        var $inputSearch = '.js-ajaxsearch',
            $resultsList = '.search-results',
            $input = $($inputSearch).find('input[name="q"]'),
            $currentAjaxRequest,
            $displayProducts = 6;

        $($inputSearch).css('position', 'relative').each(function() {
            $input.attr('autocomplete', 'off').bind('keyup change', function() {
                var term = $(this).val(),
                    form = $(this).closest('form'),
                    searchURL = '/search?type=product&q=*' + term + '*';
                if (term.length > 2 && term !== $(this).attr('data-old-term')) {
                    $(this).attr('data-old-term', term);
                    if ($currentAjaxRequest !== undefined) $currentAjaxRequest.abort();
                    $currentAjaxRequest = $.getJSON(searchURL + '&view=json', function(data) {
                        $($resultsList).empty();

                        if (data.results_count === 0) {
                            $($resultsList).html('<p class="text-center">' + theme.strings.ajaxSearchNoResult + '</p>')
                        } else {
                            $.each(data.results, function(index, item) {
                                if (index < $displayProducts) {
                                    var itemPrice = theme.Currency.formatMoney(item.price, theme.moneyFormat);
                                    var link = $('<a class="d-inline-flex ' + index + '"></a>')
                                        .attr('href', item.url)
                                        .append('<span class="image"><img src="' + item.thumbnail + '" /></span>')
                                        .append('<div class="meta"><p class="title">' + item.title + '</p>' + itemPrice + '</div>')
                                        .wrap('<div class="ajax-search-item"></div>');
                                    $($resultsList).append(link.parent());
                                    theme.updateCurrencies();
                                }
                            });
                            if (data.results_count > $displayProducts) {
                                $($resultsList).append('<a class="btn btn--full" href="' + searchURL + '">' + theme.strings.ajaxSearchViewAll + ' (' + data.results_count + ')</a>');
                            }
                        }
                        $($resultsList).addClass('active').fadeIn(200);
                    });
                }
            });
        });

        //escape when click somethings
        $(document).click(function(event) {
            var target = event.target;
            if (!$(target).is($inputSearch) && !$(target).parents().is($inputSearch)) {
                $($resultsList).slideUp(300);
            }
        });
    })();

    // Quickview https://github.com/kellyvaughn/quickview-for-shopify/blob/master/quickview.js.liquid
    theme.quickview = (function() {
        var product_handle = '',
            quickviewButtonClass = '.js-btn-quickview',
            quickviewId = '#jsQuickview',
            quickviewOption = '#jsQuickview select',
            quickviewThumb = '#qv-product-images',
            quickviewAddCartButton = '.qv-add-button',
            quickviewPrice = '.qv-product-price',
            quickviewComparePrice = '.qv-product-compare-price';

        // 1. Show quickview
        $(document).on('click', quickviewButtonClass, function() {
            var quickviewAvaible = $(this).attr("data-pavailable");
            product_handle = $(this).data('handle');
            //ResetQuickview
            $(quickviewId).removeClass().addClass('modal fade');
            $(quickviewThumb).removeClass().empty();
            $('.qv-product-options').empty();

            //Pushdata
            $(quickviewId).addClass(product_handle).data('handle', product_handle);
            jQuery.getJSON('/products/' + product_handle + '.js', function(product) {
                var title = product.title;
                var type = product.type;
                var vendor = product.vendor;
                var price = 0;
                var compare_price = 0;
                var desc = product.description.slice(0, 90);
                var images = product.images;
                var variants = product.variants;
                var options = product.options;
                var url = '/products/' + product_handle;
                $('.qv-product-title').text(title);
                $('.qv-product-type').text(type);
                $('.qv-product-description').html(desc);
                $('.qv-view-product').attr('href', url);
                $('.qv-view-type').text(type);
                $('.qv-view-vendor').text(vendor)
                if (quickviewAvaible == 'true') {
                    $(quickviewAddCartButton).prop('disabled', false).html(theme.strings.addToCart);
                } else {
                    $(quickviewAddCartButton).prop('disabled', true).html(theme.strings.soldOut);
                }
                $(product.variants).each(function(i, variants) {
                    if (variants.sku != null) {
                        $('.qv-sku').addClass("show").removeClass("hide");
                        $('.qv-view-sku').text(product.variants[0].sku);
                    } else {
                        $('.qv-sku').addClass("hide").removeClass("show");
                    }

                });
                var imageCount = $(images).length;
                $(images).each(function(i, image) {
                    image_embed = '<div><img src="' + image + '"></div>';
                    image_embed = image_embed.replace('.jpg', '_800x.jpg').replace('.png', '_800x.png');
                    $(quickviewThumb).append(image_embed);
                });
                $(quickviewThumb).slick({
                    rtl: theme.rtl,
                    'dots': true,
                    'arrows': true,
                    'respondTo': 'min',
                    'useTransform': true
                }).css('opacity', '1');

                if (product.variants[0].option1 !== "Default Title") {
                    $(options).each(function(i, option) {
                        var name = option.name;
                        var opt = name.replace(/ /g, '-').toLowerCase();
                        var selectClass = '.option.' + opt;
                        $('.qv-product-options').append('<div class="option-selection ' + opt + '"><span class="option text-uppercase font-weight-bold text-body">' + option.name + '</span><select class="option-' + i + ' option ' + opt + '"></select></div>');
                        $(option.values).each(function(i, value) {
                            $('.option.' + opt).append($('<option>', {
                                value: value,
                                text: value
                            }));
                        });
                    });
                }
                $(product.variants).each(function(i, v) {
                    if (v.inventory_quantity == 0) {
                        return true
                    } else {
                        price = theme.Currency.formatMoney(v.price, theme.moneyFormat);
                        compare_price = theme.Currency.formatMoney(v.compare_at_price, theme.moneyFormat);
                        $(quickviewPrice).html(price);
                        if (v.compare_at_price !== null) {
                            $(quickviewComparePrice).html(compare_price).show();
                        } else {
                            $(quickviewComparePrice).hide();
                        }
                        theme.updateCurrencies();
                        $('select.option-0').val(v.option1);
                        $('select.option-1').val(v.option2);
                        $('select.option-2').val(v.option3);
                        return false
                    }
                });
            });
            //addCartQuickview
        });
        // 2. Add to cart
        $(document).on('click', quickviewAddCartButton, function() {
            product_handle = $(quickviewId).data('handle');
            var qty = $('.qv-quantity').val(),
                selectedOptions = '',
                var_id = '';

            function processCart() {
                jQuery.post('/cart/add.js', {
                        quantity: qty,
                        id: var_id
                    }, null, "json").done(function(item) {
                        var htmlVariant = item.variant_title !== null ? '<i>(' + item.variant_title + ')</i>' : '';
                        var styleCart = $('.js-mini-cart').attr("data-cartmini");
                        if (styleCart != 'true') {
                            var htmlAlert = '<div class="media mt-2 alert--cart"><a class="mr-3" href="/cart"><img class="lazyload" data-src="' + item.image + '"></a><div class="media-body align-self-center"><p class="m-0 font-weight-bold">' + item.product_title + ' x ' + item.quantity + '</p>' + htmlVariant + '<div><div>';
                            theme.alert.new(theme.strings.addToCartSuccess, htmlAlert, 3000, 'notice');
                        }
                        theme.miniCart.updateElements();
                        theme.miniCart.generateCart();
                    })
                    .fail(function($xhr) {
                        var data = $xhr.responseJSON;
                        theme.alert.new('', data.description, 3000, 'warning');
                    });
            }
            $(quickviewOption).each(function(i) {
                if (selectedOptions == '') {
                    selectedOptions = $(this).val();
                } else {
                    selectedOptions = selectedOptions + ' / ' + $(this).val();
                }
            });
            jQuery.getJSON('/products/' + product_handle + '.js', function(product) {
                if (product.variants.length === 1) {
                    var_id = product.variants[0].id;
                } else {
                    $(product.variants).each(function(i, v) {
                        if (v.title == selectedOptions) {
                            var_id = v.id;
                        }
                    });
                }
                processCart();
            });
        });
        // 3. Select variants
        $(document).on('change', quickviewOption, function() {
            var selectedOptions = '';
            $(quickviewOption).each(function(i) {
                if (selectedOptions == '') {
                    selectedOptions = $(this).val();
                } else {
                    selectedOptions = selectedOptions + ' / ' + $(this).val();
                }
            });
            jQuery.getJSON('/products/' + product_handle + '.js', function(product) {
                $(product.variants).each(function(i, v) {
                    if (v.title == selectedOptions) {
                        if (v.featured_image !== null) {
                            var iSlick = v.featured_image.position - 1;
                            $(quickviewThumb).slick('slickGoTo', iSlick);
                        }
                        var price = theme.Currency.formatMoney(v.price, theme.moneyFormat);
                        var compare_price = theme.Currency.formatMoney(v.compare_at_price, theme.moneyFormat);
                        $(quickviewPrice).html(price);
                        $(quickviewComparePrice).html(compare_price);
                        if (v.sku != null) {
                            $('.qv-sku').addClass("show").removeClass("hide");
                            $('.qv-view-sku').text(v.sku);
                        } else {
                            $('.qv-sku').addClass("hide").removeClass("show");
                        }
                        if (v.compare_at_price !== null) {
                            $(quickviewComparePrice).html(compare_price).show();
                        } else {
                            $(quickviewComparePrice).hide();
                        }
                        theme.updateCurrencies();
                        if (v.inventory_management === null) {
                            $(quickviewAddCartButton).prop('disabled', false).val(theme.strings.addToCart);
                        } else {
                            if (v.inventory_quantity < 1) {
                                $(quickviewAddCartButton).prop('disabled', true).val(theme.strings.soldOut);
                            } else {
                                $(quickviewAddCartButton).prop('disabled', false).val(theme.strings.addToCart);
                            }
                        }
                    }
                });
            });
        });
    })()

    //Button add to cart (in grid item)
    theme.addCartButton = (function() {
        var buttonClass = '.js-grid-cart';
        $(document).on('click', buttonClass, function() {
            var $this = $(this);
            var id = $this.data('id');
            $this.addClass('is-loading');
            Shopify.addItem(id, 1, function(item) {
                location.href = "/cart";
                var htmlVariant = item.variant_title !== null ? '<i>(' + item.variant_title + ')</i>' : '';
                var styleCart = $('.js-mini-cart').attr("data-cartmini");
                if (styleCart != 'true') {
                    var htmlAlert = '<div class="media mt-2 alert--cart"><a class="mr-3" href="/cart"><img class="lazyload" data-src="' + item.image + '"></a><div class="media-body align-self-center"><p class="m-0 font-weight-bold">' + item.product_title + ' x ' + item.quantity + '</p>' + htmlVariant + '<div><div>';
                }
                theme.miniCart.updateElements();
                theme.miniCart.generateCart();
                setTimeout(function() {
                    styleCart != 'true' ? theme.alert.new(theme.strings.addToCartSuccess, htmlAlert, 3000, 'notice') : '';
                    $this.removeClass('is-loading');
                }, 1000);
            });
        })
    })()

    // Button add to cart (in grid item)
    //theme.addCartButton = (function(){
    //  var buttonClass = '.js-grid-cart';
    //  $(document).on('click',buttonClass,function(){
    //    var $this = $(this);
    //    var id = $this.data('id');
    //    $this.addClass('is-loading');
    //    Shopify.addItem(id,1,function(item){
    //      var htmlVariant = item.variant_title !== null ? '<i>('+item.variant_title+')</i>' : '';
    //      var styleCart = $('.js-mini-cart').attr("data-cartmini");
    //        if(styleCart != 'true'){
    //          var htmlAlert = '<div class="media mt-2 alert--cart"><a class="mr-3" href="/cart"><img class="lazyload" data-src="'+item.image+'"></a><div class="media-body align-self-center"><p class="m-0 font-weight-bold">'+item.product_title+' x '+ item.quantity +'</p>'+htmlVariant+'<div><div>';
    //        }
    //      theme.miniCart.updateElements();
    //      theme.miniCart.generateCart();
    //      setTimeout(function() {
    //        styleCart != 'true' ? theme.alert.new(theme.strings.addToCartSuccess,htmlAlert,3000,'notice'): '';
    //        $this.removeClass('is-loading');
    //      }, 1000);
    //    });
    // })
    //})()

    // Multi currencies 
    if (theme.enableCurrencies) {
        // Can be 'money_format' or 'money_with_currency_format'
        Currency.format = 'money_format';
        var shopCurrency = Shopify.currency.active;
        var cookieCurrency = Currency.cookie.read();
        // Fix for customer account pages 
        jQuery('span.money span.money').each(function() {
            jQuery(this).parent('span.money').removeClass('money');
        });
        // Add precalculated shop currency to data attribute 
        jQuery('span.money').each(function() {
            jQuery(this).attr('data-currency-' + Shopify.currency.active, jQuery(this).html());
        });
        // Select all your currencies buttons.
        var buttons = jQuery('#currencies a'),
            currentCurrencies = jQuery('.pre-currencies');
        // When the page loads.
        if (cookieCurrency == null || cookieCurrency == shopCurrency) {
            Currency.currentCurrency = shopCurrency;
        } else {
            Currency.currentCurrency = cookieCurrency;
            Currency.convertAll(shopCurrency, cookieCurrency);
            buttons.removeClass('selected');
            jQuery('#currencies a[data-currency=' + cookieCurrency + ']').addClass('selected');
            var htmlCurrently = jQuery('#currencies a[data-currency=' + cookieCurrency + ']').html();
            currentCurrencies.html(htmlCurrently);
        }
        buttons.click(function() {
            buttons.removeClass('selected');
            jQuery(this).addClass('selected');
            var newCurrency = jQuery(this).attr('data-currency');
            var htmlCurrently = jQuery(this).html();
            currentCurrencies.html(htmlCurrently);
            Currency.convertAll(Currency.currentCurrency, newCurrency);
        });
        // For product options.
        var original_selectCallback = window.selectCallback;
        var selectCallback = function(variant, selector) {
            original_selectCallback(variant, selector);
            Currency.convertAll(shopCurrency, jQuery('#currencies a.selected').attr('data-currency'));
        };
    }
    theme.updateCurrencies = function() {
        Currency.convertAll(shopCurrency, jQuery('#currencies a.selected').attr('data-currency'));
    }



    // Free shipping
    theme.freeShipping = (function() {
        var $freeShippingClass = $('.js-free-shipping'),
            $freeShippingTextClass = $('.js-free-shipping-text'),
            $free_fisrt = $freeShippingClass.attr('data-start'),
            $free_end = $freeShippingClass.attr('data-end')
        minOrderValue = parseInt($freeShippingClass.data('value')) || 0,
            $percentClass = $('.js-free-shipping .progress-bar');

        function generate(cart) {
            var priceCart = cart.total_price;
            if (priceCart >= minOrderValue) {
                $percentClass.css('width', '100%').removeClass('progress-bar-striped bg-primary');
                $freeShippingTextClass.text(theme.strings.freeShipping)
            } else {
                let percent = priceCart / minOrderValue * 100;
                let left = Shopify.formatMoney((minOrderValue - priceCart), theme.moneyFormat);
                $percentClass.css('width', percent + '%').addClass('progress-bar-striped primary');
                $freeShippingTextClass.html($free_fisrt + ' ' + left + ' ' + $free_end);
                theme.updateCurrencies();
            }
        }

        Shopify.getCart(function(cart) {
            generate(cart);
        });

        return {
            load: generate
        }
    })()

    // Shipping time - https://github.com/phstc/jquery-dateFormat
    theme.shippingTime = (function() {
        var $shippingTime = $('.js-shipping-time'),
            shippingTime = $shippingTime.data('time') || '',
            now = new Date(),
            restHour = 23 - now.getHours(),
            restMinute = 59 - now.getMinutes();
        if (shippingTime !== '') {
            var nextTime = new Date(now.getTime() + shippingTime * 86400000),
                formatTime = $.format.date(nextTime, "ddd, dd MMMM yyyy"),
                htmlShipping = 'Order in the next <b>' + restHour + '</b> hours <b>' + restMinute + '</b> minutes to get it by <b>' + formatTime + '</b>. ';
            $shippingTime.html(htmlShipping);
        }
    })()

    // Infinite scroll - https://github.com/Elkfox/Ajaxinate/blob/master/dist/ajaxinate.min.js
    theme.infiniteScroll = (function() {
        function initInfiniteScroll() {
            if ($('.AjaxinateLoop').length === 0) {
                return;
            } else {
                var endlessScroll = new Ajaxinate({
                    loadingText: '<div class="text-center"><div class="' + theme.loadingClass + '" role="status"></div></div>',
                    callback: function() {
                        theme.wishlist.load();
                        theme.compare.load();
                        theme.countdown.load();
                        theme.priceRange.load();
                        theme.tooltip.load();
                        theme.collectionView.triggerView();
                        theme.swatchCard2.load();
                    }
                });
            }
        }

        // Infinite scroll in other page (blog, list-collection)
        function initOtherPages() {
            var otherPages = new Ajaxinate({
                loadingText: '<div class="text-center"><div class="' + theme.loadingClass + '" role="status"></div></div>',
                container: '.js-pagination-content',
                pagination: '.js-pagination'
            });
        }

        document.addEventListener("DOMContentLoaded", function() {
            initInfiniteScroll();
            initOtherPages();
        });

        return {
            load: initInfiniteScroll
        }
    })()

    // Scroll to fixed
    theme.scrollToFixed = (function() {
        var window_width = $(window).width();

        if (window_width < 768) {
            $(".js-stick-parent").trigger("sticky_kit:detach");
        } else {
            make_sticky();
        }
        $(window).resize(function() {

            window_width = $(window).width();

            if (window_width < 768) {
                $(".js-stick-parent").trigger("sticky_kit:detach");
            } else {
                make_sticky();
            }
        });

        function make_sticky() {
            $('.js-stick-parent').stick_in_parent();
        }

    })()


    theme.headersidebar = (function() {
        $('#dismiss, .overlaysidebar').on('click', function() {
            // hide sidebar
            $('#sidebar').removeClass('active');
            // hide overlay
            $('.overlaysidebar').removeClass('active');
        });

        $('#sidebarCollapse').on('click', function() {
            // open sidebar
            $('#sidebar').addClass('active');
            // fade in the overlay
            $('.overlaysidebar').addClass('active');
            $('.collapse.in').toggleClass('in');
            $('a[aria-expanded=true]').attr('aria-expanded', 'false');
        });
    })()

    // Wishlist
    theme.wishlist = (function() {
        var wishlistButtonClass = '.js-btn-wishlist',
            wishlistRemoveButtonClass = '.js-remove-wishlist',
            $wishlistCount = $('.js-wishlist-count'),
            $wishlistContainer = $('.js-wishlist-content'),
            wishlistObject = JSON.parse(localStorage.getItem('localWishlist')) || [],
            wishlistPageUrl = $('.js-wishlist-link').attr('href'),
            loadNoResult = function() {
                // $wishlistContainer.html('<div class="col text-center"><div class="alert alert-warning d-inline-block">' + theme.strings.wishlistNoResult + '</div></div>');
            };

        function updateWishlist(self) {
            var productHandle = $(self).data('handle'),
                allSimilarProduct = $(wishlistButtonClass + '[data-handle="' + productHandle + '"]');
            var isAdded = $.inArray(productHandle, wishlistObject) !== -1 ? true : false;
            if (isAdded) {
                // go to wishlist page
                window.location.href = wishlistPageUrl;
            } else {
                wishlistObject.push(productHandle);
                allSimilarProduct.fadeOut('slow').fadeIn('fast').html(theme.strings.wishlistIconAdded + theme.strings.wishlistTextAdded);
                //change tooltip
                allSimilarProduct.attr('data-original-title', theme.strings.wishlistTextAdded);
                $('.tooltip-inner').text(theme.strings.wishlistTextAdded);
            }
            localStorage.setItem('localWishlist', JSON.stringify(wishlistObject));
            $wishlistCount.text(wishlistObject.length);
        };

        function loadWishlist() {
            $wishlistContainer.html('');
            //page wishlist
            if (wishlistObject.length > 0) {
                for (var i = 0; i < wishlistObject.length; i++) {
                    var productHandle = wishlistObject[i];
                    Shopify.getProduct(productHandle, function(product) {
                        var htmlProduct = '';
                        var productPrice = product.price_varies ? 'from ' + theme.Currency.formatMoney(product.price_min, theme.moneyFormat) : theme.Currency.formatMoney(product.price, theme.moneyFormat);
                        var productComparePrice = product.compare_at_price_min !== 0 ? theme.Currency.formatMoney(product.compare_at_price_min, theme.moneyFormat) : '';
                        htmlProduct += '<div class="js-wishlist-item col-md-4 col-sm-6 col-xs-6 col-12 mb-4">';
                        htmlProduct += '<div class="js-wishlist-itembox">';
                        htmlProduct += '<div class=" d-flex flex-row p-4">';
                        htmlProduct += '	<a class="d-inline-block mr-4 " href="' + product.url + '">';
                        htmlProduct += '		<img src="' + product.featured_image + '"/>';
                        htmlProduct += '	</a>';
                        htmlProduct += '	<div><a href="' + product.url + '" class="title-prouct d-block h4 text-body" >' + product.title + '</a>';
                        htmlProduct += '	<span> ' + productPrice + '</span>';
                        htmlProduct += '	 <s>' + productComparePrice + '</s></div>';
                        htmlProduct += '<button class="btn js-remove-wishlist" data-handle="' + product.handle + '">' + theme.strings.wishlistRemove + '</button>';
                        htmlProduct += '</div>';
                        htmlProduct += '</div>';
                        htmlProduct += '</div>';
                        $wishlistContainer.append(htmlProduct);
                        theme.updateCurrencies();
                    });
                }
            } else {
                loadNoResult();
            }

            //count items
            $wishlistCount.text(wishlistObject.length);

            //button text
            $(wishlistButtonClass).each(function() {
                var productHandle = $(this).data('handle');
                var iconWishlist = $.inArray(productHandle, wishlistObject) !== -1 ? theme.strings.wishlistIconAdded : theme.strings.wishlistIcon;
                var textWishlist = $.inArray(productHandle, wishlistObject) !== -1 ? theme.strings.wishlistTextAdded : theme.strings.wishlistText;
                $(this).html(iconWishlist + textWishlist).attr('title', textWishlist);
            });
        }

        $(document).on('click', wishlistButtonClass, function(event) {
            event.preventDefault();
            updateWishlist(this);
        });
        $(document).on('click', wishlistRemoveButtonClass, function() {
            var productHandle = $(this).data('handle'),
                allSimilarProduct = $(wishlistButtonClass + '[data-handle="' + productHandle + '"]');

            //update button
            allSimilarProduct.html(theme.strings.wishlistIcon + theme.strings.wishlistText);
            //update tooltip
            allSimilarProduct.attr('data-original-title', theme.strings.wishlistText);
            $('.tooltip-inner').text(theme.strings.wishlistText);
            //update Object
            wishlistObject.splice(wishlistObject.indexOf(productHandle), 1);
            localStorage.setItem('localWishlist', JSON.stringify(wishlistObject));
            // Remove element
            $(this).closest('.js-wishlist-item').fadeOut(); // or .remove()
            //count
            $wishlistCount.text(wishlistObject.length);
            if (wishlistObject.length === 0) {
                loadNoResult();
            }
        });

        loadWishlist();
        $(document).on('shopify:section:load', loadWishlist);
        return {
            load: loadWishlist
        }
    })()

    // Compare
    theme.compare = (function() {
        var compareButtonClass = '.js-btn-compare',
            compareRemoveButtonClass = '.js-remove-compare',
            $compareCount = $('.js-compare-count'),
            $compareContainer = $('.js-compare-content'),
            compareObject = JSON.parse(localStorage.getItem('localCompare')) || [],
            alertClass = 'notice';

        function updateCompare(self) {
            var productHandle = $(self).data('handle'),
                alertText = '';
            var isAdded = $.inArray(productHandle, compareObject) !== -1 ? true : false;
            if (isAdded) {
                compareObject.splice(compareObject.indexOf(productHandle), 1);
                alertText = theme.strings.compareNotifyRemoved;
                alertClass = 'notice';
            } else {
                if (compareObject.length === 4) {
                    alertText = theme.strings.compareNotifyMaximum;
                    alertClass = 'error';
                } else {
                    alertClass = 'notice';
                    compareObject.push(productHandle);
                    alertText = theme.strings.compareNotifyAdded;
                }
            }
            localStorage.setItem('localCompare', JSON.stringify(compareObject));
            theme.alert.new(theme.strings.compareText, alertText, 2000, alertClass);
            $compareCount.text(compareObject.length);
        };

        function loadCompare() {
            var compareGrid;
            $compareContainer.html('');
            //popup compare
            if (compareObject.length > 0) {
                compareGrid = compareObject.length === 1 ? 'col-md-6 col-sm-6' : 'col';
                for (var i = 0; i < compareObject.length; i++) {
                    var productHandle = compareObject[i];
                    Shopify.getProduct(productHandle, function(product) {
                        var htmlProduct = '',
                            productPrice = product.price_varies ? 'from ' + theme.Currency.formatMoney(product.price_min, theme.moneyFormat) : theme.Currency.formatMoney(product.price, theme.moneyFormat),
                            productComparePrice = product.compare_at_price_min !== 0 ? theme.Currency.formatMoney(product.compare_at_price_min, theme.moneyFormat) : '',
                            productAvailable = product.available ? theme.strings.available : theme.strings.unavailable,
                            productAvailableClass = product.available ? 'alert-success' : 'alert-danger',
                            productTypeHTML = product.type !== "" ? '<a href="/collections/types?q=' + product.type + '">' + product.type + '</a>' : '<span>' + theme.strings.none + '</span>',
                            productVendorHTML = product.vendor !== "" ? '<a href="/collections/vendors?q=' + product.vendor + '">' + product.vendor + '</a>' : '<span>' + theme.strings.none + '</span>';
                        htmlProduct += '<div class="compare-item ' + compareGrid + ' col-xs-6">';
                        htmlProduct += '	<a href="' + product.url + '">';
                        htmlProduct += '		<img src="' + Shopify.resizeImage(product.featured_image, 'x300') + '"/>';
                        htmlProduct += '	</a>';
                        htmlProduct += '	<hr /><h5 >' + product.title + '</h5>';
                        htmlProduct += '	<hr /><s>' + productComparePrice + '</s>';
                        htmlProduct += '	<span> ' + productPrice + '</span>';
                        htmlProduct += '	<hr /><span class=' + productAvailableClass + '> ' + productAvailable + '</span>';
                        htmlProduct += '	<hr />' + productTypeHTML;
                        htmlProduct += '	<hr />' + productVendorHTML;
                        htmlProduct += '  <hr /><button class="btn js-remove-compare btn-theme gradient-theme" data-handle="' + product.handle + '">' + theme.strings.compareRemove + '</button>';
                        htmlProduct += '</div>';
                        $compareContainer.append(htmlProduct);
                        theme.updateCurrencies();
                    });
                }
            } else {
                // $compareContainer.html('<div class="alert alert-warning d-inline-block">' + theme.strings.compareNoResult + '</div>');
            }

            //button text
            $(compareButtonClass).each(function() {
                var productHandle = $(this).data('handle');
                var status = $.inArray(productHandle, compareObject) !== -1 ? 'added' : '';
                $(this).removeClass('added').addClass(status);
            });

            //count items
            $compareCount.text(compareObject.length);
        }
        $(document).on('click', compareButtonClass, function(event) {
            event.preventDefault();
            updateCompare(this);
            loadCompare();
        });
        $(document).on('click', compareRemoveButtonClass, function() {
            var productHandle = $(this).data('handle');
            compareObject.splice(compareObject.indexOf(productHandle), 1);
            localStorage.setItem('localCompare', JSON.stringify(compareObject));
            loadCompare();
        });

        loadCompare();
        $(document).on('shopify:section:load', loadCompare);
        return {
            load: loadCompare
        }
    })()

    // Popup newsletter
    theme.popupNewletter = (function() {
        var $popupNewsletter = $('#jsPopupNewsletter'),
            $newsletterForm = $('#jsPopupNewsletter form'),
            date = new Date(),
            minutes = theme.timePopupNewsletter;
        minutesdelay = $popupNewsletter.attr('data-delay');
        if ($popupNewsletter.length === 1) {
            date.setTime(date.getTime() + (minutes * 60 * 1000));
            var setCookies = function() {
                $.cookie('cookiesNewsletter', 'disabled', { expires: date, path: '/' });
            };
            if ($.cookie('cookiesNewsletter') !== "disabled") {
                $(window).on('load', function() {
                    setTimeout(function() {
                        $popupNewsletter.modal('show');
                    }, minutesdelay * 1000);
                });
                $popupNewsletter.on('hidden.bs.modal', setCookies);
                $newsletterForm.submit(setCookies);
            }
        }
    })()

    // Cookie policy
    theme.cookie = (function() {
        var $policy = $('.js-cookie-policy'),
            $closeButton = $('.js-btn-ok'),
            isOk = localStorage.getItem('localCookie') || '';
        if (isOk === '') {
            $policy.fadeIn('slow');
        }
        $closeButton.on('click', function() {
            localStorage.setItem('localCookie', 'accept');
            $policy.fadeOut('slow');
        })
    })()

    // Announcement Bar
    theme.announcement = (function() {
        var $bar = $('.js-announcement-bar'),
            $closeButton = $('.js-ab-close'),
            isClosed = localStorage.getItem('localAnnouncement') || '';
        if (isClosed === '') {
            $bar.fadeIn();
            $bar.closest('.body-theme').addClass('body-announcement-bar');
        }
        $closeButton.on('click', function() {
            localStorage.setItem('localAnnouncement', 'closed');
            $bar.slideUp();
            $bar.closest('.body-theme').removeClass('body-announcement-bar');
        })
    })()

    // Open external link in new tab
    theme.exLink = (function() {
        var links = document.links;
        for (let i = 0, linksLength = links.length; i < linksLength; i++) {
            if (links[i].hostname !== window.location.hostname && $(links[i]).attr('href') !== 'javascript:void(0)') {
                links[i].target = '_blank';
            }
        }
    })()

    // Deal- countdown
    theme.countdown = (function() {
        function initCountdown() {
            $(".js-countdown").each(function() {
                var endTime = $(this).data('time'),
                    htmlLayout = "<ul class='list--inline'><li class='gradient-theme-vertical'><span class='countdown-time'>%%D%%</span><span class='countdown-text'>Days</span></li><li class='gradient-theme-vertical'><span class='countdown-time'>%%H%%</span><span class='countdown-text'>Hours</span></li><li class='gradient-theme-vertical'><span class='countdown-time'>%%M%%</span><span class='countdown-text'>Mins</span></li><li class='gradient-theme-vertical'><span class='countdown-time'>%%S%%</span><span class='countdown-text'>Secs</span></li></ul>";
                $(this).lofCountDown({
                    TargetDate: endTime,
                    DisplayFormat: htmlLayout,
                    FinishMessage: '<span class="alert alert-warning d-inline-block">' + theme.strings.countdownEndText + '</span>'
                });
            });
        }
        initCountdown();
        return {
            load: initCountdown
        }
    })()

    // Price range - Collection page
    theme.priceRange = (function() {
        function initPriceRange() {
            var min = 0,
                max = 0,
                slideRange = '#js-slider-range',
                productCard = '.js-product-card',
                slideRangeWrap = '.slider-range-wr',
                rangeMin = '.js-range-min',
                rangeMax = '.js-range-max',
                enablePriceRange = $('#js-slider-range').length === 1 ? true : false;

            if (enablePriceRange) {
                $(productCard).each(function() {
                    if (eval($(this).data('price')) > max) max = eval($(this).data('price'));
                    if (min == 0) min = eval($(this).data('price'));
                    else if (eval($(this).data('price')) < min) min = eval($(this).data('price'));
                });

                if (min === max) {
                    $(slideRangeWrap).fadeOut();
                } else {
                    $(slideRangeWrap).fadeIn();
                }

                $(slideRange).slider({
                    range: true,
                    min: min,
                    max: max,
                    values: [min, max],
                    slide: function(event, ui) {
                        var price1 = (Shopify.formatMoney(ui.values[0], theme.moneyFormat));
                        var price2 = (Shopify.formatMoney(ui.values[1], theme.moneyFormat));
                        $(rangeMin).html(price1);
                        $(rangeMax).html(price2);
                        theme.updateCurrencies();

                        // Show/Hide product when dragging
                        $(productCard).each(function() {
                            if (eval($(this).data('price')) >= ui.values[0] && eval($(this).data('price')) <= ui.values[1]) {
                                $(this).parent().fadeIn();
                            } else {
                                $(this).parent().fadeOut();
                            }
                        });
                    }
                });

                var price1 = (Shopify.formatMoney(min, theme.moneyFormat));
                var price2 = (Shopify.formatMoney(max, theme.moneyFormat));
                $(rangeMin).html(price1);
                $(rangeMax).html(price2);
                theme.updateCurrencies();

            }
        }
        initPriceRange();
        return {
            load: initPriceRange
        }
    })()

    // Collection view - Collection page
    theme.collectionView = (function() {
        var btnView = '.js-btn-view',
            btnViewActive = '.js-btn-view.active';

        $(document).on('click', btnView, function() {
            var value = $(this).data('col'),
                $gridItemCol = $('.js-col');

            $(btnView).removeClass('active');
            $(this).addClass('active');

            $gridItemCol.removeClass().addClass('js-col col-sm-6 col-12');
            if (value === 3) {
                $gridItemCol.addClass('col-lg-4');
            } else if (value === 4) {
                $gridItemCol.addClass('col-lg-3');
            } else if (value === 5) {
                $gridItemCol.addClass('col-lg-2-4');
            } else if (value === 6) {
                $gridItemCol.addClass('col-lg-2');
            };
        })

        function triggerCollectionView() {
            $(btnViewActive).trigger('click');
        }

        return {
            triggerView: triggerCollectionView
        }
    })()

    // Swath variant in card item
    theme.swatchCard = (function() {
        $(document).on('click', '.js-swatch-card-item', function() { //click or mouseover
            $(".js-swatch-card-item").removeClass("active");
            $(this).addClass("active");
            var newImage = $(this).data('image');
            var id = $(this).data('id');
            var gridItem = $(this).closest('.js-product-card');
            gridItem.find('.product-card__image').find('img').attr('srcset', newImage);
            gridItem.find('.js-grid-cart').data('id', id).attr('data-id', id);
        });
    })()

    theme.swatchCard2 = (function() {
        function initVariant(id) {
            var productJson = JSON.parse($('.customJson-' + id).html());
            var $selectorForm = $('.customform-' + id);
            var $button = $('.js-customform-addtocart-' + id);
            var $buttontext = $button.find('span');
            var $wrapObject = $selectorForm.closest('.js-product-card');
            var options = {
                $container: $selectorForm,
                enableHistoryState: false,
                product: productJson,
                singleOptionSelector: '.single-option-selector-' + id,
                originalSelectorId: '#ProductSelect-' + id
            };
            var variants = new slate.Variants(options);
            var AjaxCart = new window.AjaxCart($selectorForm);
            var _updateButton = function(evt) {
                var variant = evt.variant;
                if (variant === undefined) {
                    $button.prop('disabled', true).removeClass('btn--sold-out');
                    $buttontext.html(theme.strings.unavailable);
                } else {
                    if (variant.available) {
                        $button.removeClass('btn--sold-out').prop('disabled', false);
                        $buttontext.html(theme.strings.addToCart);
                    } else {
                        $button.prop('disabled', true).addClass('btn--sold-out');
                        $buttontext.html(theme.strings.soldOut);
                    }
                }
            }
            var _updateImage = function(evt) {
                var variant = evt.variant;
                var $mainImage = $wrapObject.find('.product-card__image').find('img');
                if (variant !== undefined && variant.featured_image !== null) {
                    var variantImage = variant.featured_image;
                    $mainImage.attr('srcset', variantImage.src);
                }
            }
            var _updatePrice = function(evt) {
                var $price = $wrapObject.find('.product-card__price');
                var variant = evt.variant;
                if (variant !== undefined) {
                    var htmlComparePrice = variant.compare_at_price !== null ? '<s class="product-card__regular-price"><span class="money">' + variant.compare_at_price + '</span></s>' : '';
                    var htmlPrice = '<span class="money">' + variant.price + '</span>' + htmlComparePrice;
                    $price.html(htmlPrice);
                    theme.updateCurrencies();
                }
            }
            variants.$container.on(
                'variantChange', _updateButton
            );
            variants.$container.on(
                'variantChange', _updateImage
            );
            variants.$container.on(
                'variantChange', _updatePrice
            );
        }

        function initForm() {
            $('.js-customform').each(function() {
                var id = $(this).data('id');
                initVariant(id);
            })
        }

        initForm();
        return {
            load: initForm
        }
    })()

    // Loading
    theme.loading = (function() {
        var $loading = $('#js-loading'),
            hasLoading = $('#js-loading').length === 0 ? false : true;
        if (hasLoading) {
            $(window).load(function() {
                $loading.fadeOut();
            });
        }
    })()

    theme.effectLeavingPage = (function() {
        window.onbeforeunload = function() {
            $('body').css('opacity', '0');
        }
    })()

    // Isotope
    theme.isotope = (function() {
        var enableIsotope = $('.enable-isotope').length === 1 ? true : false,
            $grid = $('.js-grid'),
            filter = '.js-filter-isotope';

        function initIsotope() {
            if (enableIsotope) {
                $grid.isotope({
                    itemSelector: '.grid-item',
                    percentPosition: true
                })
                $(document).on('click', filter, function() {
                    var filterValue = $(this).data('filter') === '*' ? $(this).data('filter') : '.' + $(this).data('filter');
                    $(filter).removeClass('active');
                    $(this).addClass('active');
                    $grid.isotope({
                        filter: filterValue
                    });
                });
                $(window).scroll(function() {
                    $grid.isotope('layout');
                });
                $(window).load(function() {
                    $grid.isotope('layout');
                    $(filter).first().trigger('click');
                });
            }
        }
        initIsotope();
    })()

    //aos



    // theme.Wow = (function(){
    //   new WOW().init();
    // })()




    // Masonry
    theme.Masonry = (function() {
        function Masonry(container) {
            this.$container = $(container).on('init', this._a11y.bind(this));
            var $masonry = this.$container;
            $masonry.isotope({
                itemSelector: '.grid-item',
                percentPosition: true,
                masonry: {
                    columnWidth: '.grid-sizer'
                }
            });
            $(window).load(function() {
                $masonry.isotope('layout').css('opacity', '1');
            });
            $(window).scroll(function() {
                $masonry.isotope('layout').css('opacity', '1');
            });
        }

        Masonry.prototype = _.assignIn({}, Masonry.prototype, {
            _a11y: function(event, obj) {
                var $list = obj.$list;
                var $wrapper = this.$container.parent();

                // Remove default Slick aria-live attr until slider is focused
                $list.removeAttr('aria-live');

                // When an element in the slider is focused set aria-live
                $wrapper.on('focusin', function(evt) {
                    if ($wrapper.has(evt.target).length) {
                        $list.attr('aria-live', 'polite');
                    }
                });

                // Remove aria-live
                $wrapper.on('focusout', function(evt) {
                    if ($wrapper.has(evt.target).length) {
                        $list.removeAttr('aria-live');
                    }
                });
            }
        });

        return Masonry;
    })();



    // Cross-selling
    theme.crosssell = (function() {
        var crosssellClass = '.js-crosssell',
            handles = $(crosssellClass).data('handles') || '',
            arrayHandle = handles.split(','),
            $blockCrosssell = $('.block-cross-sell'),
            variantSelectClass = '.js-cross-select',
            crossImageClass = '.cross-item-image',
            crossPriceClass = '.cross-item-money';

        function generateCrosssell() {
            for (var i = 0; i < arrayHandle.length; i++) {
                var productHandle = arrayHandle[i];
                Shopify.getProduct(productHandle, function(product) {
                    var htmlCross = '',
                        htmlOption = '',
                        firstAvailableVariant = '',
                        variantCount = product.variants.length;

                    // generate select box and check first avaiable variant
                    for (var j = 0; j < variantCount; j++) {
                        var variant = product.variants[j],
                            variantImage = variant.featured_image === null ? product.featured_image : variant.featured_image.src,
                            disabled = variant.available ? '' : 'disabled';
                        htmlOption += '<option ' + disabled + ' data-id="' + variant.id + '" data-price="' + variant.price + '" data-image="' + variantImage + '">' + variant.title + '</option>';
                        if (firstAvailableVariant === '' && variant.available) {
                            firstAvailableVariant = variant
                        }
                    }
                    var productPrice = theme.Currency.formatMoney(firstAvailableVariant.price, theme.moneyFormat),
                        productImage = firstAvailableVariant.featured_image === null ? product.featured_image : firstAvailableVariant.featured_image.src,
                        selectHide = variantCount === 1 ? 'hide' : '';

                    // generate HTML
                    htmlCross += '<div class="col cross-item ' + product.handle + '">';
                    htmlCross += '	<a class="cross-item-image" href="' + product.url + '" title="' + product.title + '"><img src="' + productImage + '" />' + theme.strings.cartIcon + '</a>';
                    htmlCross += '	<a target="_blank" href="' + product.url + '" title="' + product.title + '" class="cross-item-title">' + product.title + '</a>';
                    htmlCross += '	<span class="cross-item-money">' + productPrice + '</span>';
                    htmlCross += '	<select class="js-cross-select ' + selectHide + '" data-image="' + productImage + '" data-price="' + firstAvailableVariant.price + '" data-item="' + firstAvailableVariant.id + '">' + htmlOption + '</select>';
                    htmlCross += '</div>';
                    $(crosssellClass).append(htmlCross);
                    theme.updateCurrencies();
                });
            }
        }

        function showPopupCrosssell(lineItem) {
            //generate lineitem;
            var htmlLineItem = '';
            htmlLineItem += '<span class="alert alert-success d-inline-block mb-2">' + theme.strings.addToCartSuccess + '</span>';
            htmlLineItem += '<div><img src="' + lineItem.image + '" alt="Added Product"></div>';
            htmlLineItem += '<h4 class="cross-item-title">' + lineItem.title + '</h4>';
            htmlLineItem += '<div class="mb-2">' + theme.strings.cartQuantity + ': ' + lineItem.quantity + '</div>';
            $('.js-cross-added').hide().html(htmlLineItem).fadeIn();

            // show popup
            var $popupCrosssell = $('#jsCrosssell');
            $popupCrosssell.modal('show');
        }

        if (handles !== '') {
            $(document).on('click', crossImageClass, function(event) {
                event.preventDefault();
                var parent = $(this).closest('.cross-item'),
                    itemId = parent.find(variantSelectClass).attr('data-item');
                Shopify.addItem(itemId, 1, function(lineItem) {
                    theme.miniCart.updateElements();
                    theme.miniCart.generateCart();
                    showPopupCrosssell(lineItem);
                });
            });
            $(document).on('change', variantSelectClass, function() {
                var selectVariant = $(this).children(':selected'),
                    selectVariantId = selectVariant.data('id'),
                    parent = $(this).parent(),
                    newPrice = theme.Currency.formatMoney(selectVariant.data('price'), theme.moneyFormat);

                if (selectVariant.data('image') !== '') {
                    parent.find(crossImageClass).find('img').attr('src', selectVariant.data('image'));
                }
                $(this).attr('data-item', selectVariantId);
                parent.find(crossPriceClass).html(newPrice);
                theme.updateCurrencies();
            });
            $(document).on('shopify:section:load', generateCrosssell);
            generateCrosssell();
            $blockCrosssell.removeClass('hide');
        }
        return {
            showPopup: showPopupCrosssell
        }
    })()

    // Upsell
    theme.upsell = (function() {
        var popupUpsell = '#jsUpsell',
            $button = $('#jsUpsell .btn'),
            productUpsellId = $('#jsUpsell').data('id') || '',
            buttonAcceptClass = 'js-btn-accept',
            delayTime = $('#jsUpsell').data('delay') || 3000,
            isUpsell = $(popupUpsell).length === 1 ? true : false;
        if (isUpsell) {
            $(document).ready(function() {
                setTimeout(function() {
                    $(popupUpsell).modal('show');
                }, delayTime);
            });
            $button.on('click', function() {
                if ($(this).hasClass(buttonAcceptClass)) {
                    Shopify.addItem(productUpsellId, 1, function(item) {
                        theme.miniCart.updateElements();
                        theme.miniCart.generateCart();
                        var htmlVariant = item.variant_title !== null ? '<i>(' + item.variant_title + ')</i>' : '';
                        var htmlAlert = '<div class="media mt-2 alert--cart"><a class="mr-3" href="/cart"><img class="lazyload" data-src="' + item.image + '"></a><div class="media-body align-self-center"><p class="m-0 font-weight-bold">' + item.product_title + ' x ' + item.quantity + '</p>' + htmlVariant + '<div><div>';
                        theme.alert.new(theme.strings.addToCartSuccess, htmlAlert, 3000, 'notice');
                    })
                }
                $(popupUpsell).modal('hide');
            })
        }
    })()

    // Coupon
    theme.coupon = (function() {
        var popupCoupon = '#jsCoupon',
            $button = $('#jsCoupon .js-btn-coupon'),
            delayTime = $('#jsCoupon').data('delay') || 3000,
            isCoupon = $(popupCoupon).length === 1 ? true : false,
            isCopied = localStorage.getItem('localCoupon') || '';
        if (isCoupon && isCopied === '') {
            $(document).ready(function() {
                setTimeout(function() {
                    $(popupCoupon).modal('show');
                }, delayTime);
            });
            $button.on('click', function() {
                var copyText = document.getElementById("coupon_code");
                copyText.select();
                document.execCommand("Copy");
                $(popupCoupon).modal('hide');
                theme.alert.new('Coupon code', 'Successfully copied, now you can paste code at checkout', 4000);
                localStorage.setItem('localCoupon', 'copied');
            })
        }
    })()

    // Overwrite Shopify.onError in Shopify API
    Shopify.onError = function(t, r) {
        var e = eval("(" + t.responseText + ")");
        var mess = e.message ? e.message + "(" + e.status + "): " + e.description : "Error : " + Shopify.fullMessagesFromErrors(e).join("; ") + "."
        theme.alert.new('Alert', mess, 3000, 'warning');
    }

    // Megamenu width
    theme.fixWidthMegamenu = (function() {
        var $megamenuClass = $('.site-nav__item-mega'),
            megaDropdownClass = '.meganav';
        $megamenuClass.each(function() {
            var widthMenu = $(this).data('width') || 0;
            if (widthMenu !== 0) {
                $(this).find(megaDropdownClass).css({ 'width': widthMenu + 'px', 'margin-left': '-' + widthMenu / 2 + 'px' });
            }
        });
    })()

    // Product video
    theme.productVideo = (function() {
        var playButtonClass = '.js-play-button';
        $(document).on('click', playButtonClass, function() {
            let videoSelector = $(this).next(),
                videoObject = videoSelector.get(0);
            $(this).toggleClass('active');
            videoSelector.toggleClass('active');
            videoObject.paused ? videoObject.play() : videoObject.pause();
        })
    })()

    // Fake-viewers
    theme.fakeViewer = (function() {
        var $fakeViewClass = $('.js-fake-view'),
            minValue = $fakeViewClass.data('min'),
            maxValue = $fakeViewClass.data('max'),
            duration = $fakeViewClass.data('duration');

        function randomInRange(start, end) {
            var value = Math.floor(Math.random() * (end - start + 1) + start);
            $fakeViewClass.text(value);
        }

        if (minValue !== undefined && maxValue !== undefined) {
            randomInRange(minValue, maxValue);
            setInterval(function() {
                randomInRange(minValue, maxValue);
            }, duration);
        }

    })();

    // Product-suggest
    theme.productSuggest = (function() {
        var $productSuggestClass = $('.product-notification'),
            $closeButtonClass = $('.close-notifi'),
            duration = $productSuggestClass.data('time') || 0,
            productSuggestCookie = 'cookieSuggest';

        function SomeonePurchased() {
            if ($.cookie(productSuggestCookie) == 'closed') {
                $productSuggestClass.remove();
            }
            $closeButtonClass.on('click', function() {
                $productSuggestClass.remove();
                $.cookie(productSuggestCookie, 'closed', { expires: 1, path: '/' });
            });

            function toggleSomething() {
                if ($productSuggestClass.hasClass('active')) {
                    $productSuggestClass.removeClass('active')
                } else {
                    var arrayProducts = $('.data-product'),
                        randomProduct = Math.floor(Math.random() * arrayProducts.length),
                        Object = $(arrayProducts[randomProduct]);

                    $productSuggestClass.addClass('active');
                    $productSuggestClass.find('.product-image').attr('href', Object.data('url')).find('img').attr('src', Object.data('image'));
                    $productSuggestClass.find('.product-name').text(Object.data('title')).attr('href', Object.data('url'));
                    $productSuggestClass.find('.time-ago').text(Object.data('time'));
                    $productSuggestClass.find('.from-ago').text(Object.data('local'));
                }
            }

            if (duration !== 0) {
                setInterval(toggleSomething, duration);
            }
        }
        SomeonePurchased();
    })()


    // Stickyheader
    theme.stickyHeader = (function() {
        var stickHeaderClass = '.site-header--sticky';
        if ($(stickHeaderClass).length !== 0) {
            $(window).scroll(function() {
                if (window.pageYOffset >= 20) {
                    $(stickHeaderClass).addClass('active');
                } else {
                    $(stickHeaderClass).removeClass('active');
                }
            });
        }
    })()

    theme.PhotoSwipe = (function() {
        var initPhotoSwipeFromDOM = function(gallerySelector) {

            // parse slide data (url, title, size ...) from DOM elements 
            // (children of gallerySelector)
            var parseThumbnailElements = function(el) {
                var thumbElements = el.childNodes,
                    numNodes = thumbElements.length,
                    items = [],
                    figureEl,
                    linkEl,
                    size,
                    item;

                for (var i = 0; i < numNodes; i++) {

                    figureEl = thumbElements[i]; // <figure> element

                    // include only element nodes 
                    if (figureEl.nodeType !== 1) {
                        continue;
                    }

                    linkEl = figureEl.children[0]; // <a> element

                    size = linkEl.getAttribute('data-size').split('x');

                    // create slide object
                    item = {
                        src: linkEl.getAttribute('href'),
                        w: parseInt(size[0], 10),
                        h: parseInt(size[1], 10)
                    };



                    if (figureEl.children.length > 1) {
                        // <figcaption> content
                        item.title = figureEl.children[1].innerHTML;
                    }

                    if (linkEl.children.length > 0) {
                        // <img> thumbnail element, retrieving thumbnail url
                        item.msrc = linkEl.children[0].getAttribute('src');
                    }

                    item.el = figureEl; // save link to element for getThumbBoundsFn
                    items.push(item);
                }

                return items;
            };

            // find nearest parent element
            var closest = function closest(el, fn) {
                return el && (fn(el) ? el : closest(el.parentNode, fn));
            };

            // triggers when user clicks on thumbnail
            var onThumbnailsClick = function(e) {
                e = e || window.event;
                e.preventDefault ? e.preventDefault() : e.returnValue = false;

                var eTarget = e.target || e.srcElement;

                // find root element of slide
                var clickedListItem = closest(eTarget, function(el) {
                    return (el.tagName && el.tagName.toUpperCase() === 'FIGURE');
                });

                if (!clickedListItem) {
                    return;
                }

                // find index of clicked item by looping through all child nodes
                // alternatively, you may define index via data- attribute
                var clickedGallery = clickedListItem.parentNode,
                    childNodes = clickedListItem.parentNode.childNodes,
                    numChildNodes = childNodes.length,
                    nodeIndex = 0,
                    index;

                for (var i = 0; i < numChildNodes; i++) {
                    if (childNodes[i].nodeType !== 1) {
                        continue;
                    }

                    if (childNodes[i] === clickedListItem) {
                        index = nodeIndex;
                        break;
                    }
                    nodeIndex++;
                }



                if (index >= 0) {
                    // open PhotoSwipe if valid index found
                    openPhotoSwipe(index, clickedGallery);
                }
                return false;
            };

            // parse picture index and gallery index from URL (#&pid=1&gid=2)
            var photoswipeParseHash = function() {
                var hash = window.location.hash.substring(1),
                    params = {};

                if (hash.length < 5) {
                    return params;
                }

                var vars = hash.split('&');
                for (var i = 0; i < vars.length; i++) {
                    if (!vars[i]) {
                        continue;
                    }
                    var pair = vars[i].split('=');
                    if (pair.length < 2) {
                        continue;
                    }
                    params[pair[0]] = pair[1];
                }

                if (params.gid) {
                    params.gid = parseInt(params.gid, 10);
                }

                return params;
            };

            var openPhotoSwipe = function(index, galleryElement, disableAnimation, fromURL) {
                var pswpElement = document.querySelectorAll('.pswp')[0],
                    gallery,
                    options,
                    items;

                items = parseThumbnailElements(galleryElement);

                // define options (if needed)
                options = {
                    maxSpreadZoom: 1,
                    bgOpacity: 0.7,
                    zoomEl: true,
                    history: false,
                    zoomEl: false,
                    pinchToClose: false,
                    closeOnScroll: false,
                    // define gallery index (for URL)
                    galleryUID: galleryElement.getAttribute('data-pswp-uid'),

                };

                // PhotoSwipe opened from URL
                if (fromURL) {
                    if (options.galleryPIDs) {
                        // parse real index when custom PIDs are used 
                        // http://photoswipe.com/documentation/faq.html#custom-pid-in-url
                        for (var j = 0; j < items.length; j++) {
                            if (items[j].pid == index) {
                                options.index = j;
                                break;
                            }
                        }
                    } else {
                        // in URL indexes start from 1
                        options.index = parseInt(index, 10) - 1;
                    }
                } else {
                    options.index = parseInt(index, 10);
                }

                // exit if index not found
                if (isNaN(options.index)) {
                    return;
                }

                if (disableAnimation) {
                    options.showAnimationDuration = 0;
                }

                // Pass data to PhotoSwipe and initialize it
                gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, items, options);
                gallery.init();
            };

            // loop through all gallery elements and bind events
            var galleryElements = document.querySelectorAll(gallerySelector);

            for (var i = 0, l = galleryElements.length; i < l; i++) {
                galleryElements[i].setAttribute('data-pswp-uid', i + 1);
                galleryElements[i].onclick = onThumbnailsClick;
            }

            // Parse URL and open gallery if it contains #&pid=3&gid=1
            var hashData = photoswipeParseHash();
            if (hashData.pid && hashData.gid) {
                openPhotoSwipe(hashData.pid, galleryElements[hashData.gid - 1], true, true);
            }
        };

        // execute above function
        initPhotoSwipeFromDOM('.my-gallery');
    })()

    theme.ZoomImage = (function() {
        $(window).resize(function() {
            var width = $(window).width();
            if (width > 767) {
                ZoomImage();
            }
        });
        $(window).width(function() {
            var width = $(window).width();
            if (width > 767) {
                ZoomImage();
            }
        });

        function ZoomImage() {
            $(".zoom_image").each(function(arg, el) {
                var image = $(el).find("img");
                $(el).zoom({
                    on: 'mouseover',
                    url: image.attr("src").replace("small", "big")
                });
            });
        }
    })()

    theme.activeAccordion = (function() {
        $('.collapse').on('shown.bs.collapse', function() {
            $(this).prev().addClass('active-acc');
        });
        $('.collapse').on('hidden.bs.collapse', function() {
            $(this).prev().removeClass('active-acc');
        });
    })()


    // Anchor scroll
    theme.anchorScroll = (function() {
        $(document).on('click', 'a[href^="#"]', function(event) {
            event.preventDefault();
            var disableAnchor = $(this).hasClass('disabled-anchor');
            if (!disableAnchor) {
                $('html, body').animate({
                    scrollTop: $($.attr(this, 'href')).offset().top
                }, 500);
            }
        });
    })()

    // Product-recently-viewed
    theme.productRecentlyViewed = (function() {
        var $viewedElement = $('.js-recently-view'),
            $viewButton = $('.js-recently-view-button'),
            $content = $('.js-recently-view-content'),
            productHandle = $viewedElement.data('handle') || '',
            limit = $viewButton.data('limit') || 0,
            arrayProduct = JSON.parse(localStorage.getItem('localRecentlyViewed')) || [],
            lastProduct = arrayProduct[arrayProduct.length - 1] || '',
            isAdded = $.inArray(productHandle, arrayProduct) !== -1 ? true : false;

        function processViewed() {
            if (productHandle !== '') {
                //process last product
                if (lastProduct === productHandle && arrayProduct.length > 1) {
                    lastProduct = arrayProduct[arrayProduct.length - 2]
                }

                //move current product to last of array
                if (isAdded) {
                    arrayProduct.splice(arrayProduct.indexOf(productHandle), 1);
                }
                arrayProduct.push(productHandle);
                //remove first item if limit
                if (arrayProduct.length > limit) {
                    arrayProduct.shift()
                }
                localStorage.setItem('localRecentlyViewed', JSON.stringify(arrayProduct));
            }
        }

        function generatorProduct() {
            $content.html('');
            if (arrayProduct.length > 0) {
                //array
                for (var i = 0; i < arrayProduct.length; i++) {
                    var productHandle = arrayProduct[i];
                    Shopify.getProduct(productHandle, function(product) {
                        var htmlProduct = '';
                        var productPrice = product.price_varies ? 'from ' + theme.Currency.formatMoney(product.price_min, theme.moneyFormat) : theme.Currency.formatMoney(product.price, theme.moneyFormat);
                        var productComparePrice = product.compare_at_price_min !== 0 ? theme.Currency.formatMoney(product.compare_at_price_min, theme.moneyFormat) : '';
                        htmlProduct += '<div class="col-12 col-lg-4 js-viewed-item mb-4">';
                        htmlProduct += '	<div class="border p-3 rounded media d-flex ">';
                        htmlProduct += '	<a class="mr-3 col-4 p-0" href="' + product.url + '">';
                        htmlProduct += '		<img src="' + product.featured_image + '"/>';
                        htmlProduct += '	</a>';
                        htmlProduct += '	<div class="media-body text-left">';
                        htmlProduct += '		<h4 class="mb-2 mt-2"><a href="' + product.url + '">' + product.title + '</a></h5>';
                        htmlProduct += '	<span> ' + productPrice + '</span>';
                        htmlProduct += '	<s>' + productComparePrice + '</s>';
                        htmlProduct += '	</div>';
                        htmlProduct += '	</div>';
                        htmlProduct += '</div>';
                        $content.append(htmlProduct);
                        theme.updateCurrencies();
                    });
                }

                //last product
                Shopify.getProduct(lastProduct, function(product) {
                    $viewButton.css('background-image', 'url(' + product.featured_image + ')').addClass('active');
                })
            }
        }

        processViewed();
        generatorProduct();

    })()

    // Notice when soldout
    theme.alert = (function() {
        function createAlert(title, mess, time, type) {
            var aTitle = title || '',
                aTime = time || 2000,
                aMessage = mess || '',
                aClass = type || 'default';
            $.growl({
                title: aTitle,
                message: aMessage,
                duration: aTime,
                style: aClass,
                size: 'large'
            });
        }

        return {
            new: createAlert
        }
    })()

    // Notice when soldout
    theme.noticeSoldout = (function() {
        var $soldoutWrapFormClass = $('.js-contact-soldout'),
            $textClass = $('.js-notify-text'),
            $soldoutValueId = $('#ContactProduct');

        function noticeSoldout(variant) {
            $soldoutWrapFormClass.find('.form-success').remove()
            if (variant.available) {
                $textClass.find('span').text('');
                $soldoutWrapFormClass.addClass('hide');
            } else {
                $textClass.find('span').text(': ' + variant.name);
                $soldoutWrapFormClass.removeClass('hide');
                $soldoutValueId.val(variant.name).attr('value', variant.name);
            }
        }
        return {
            init: noticeSoldout
        }
    })()

    // Sticky cart
    theme.stickyCart = (function() {
        var $anchor = $('#js-anchor-sticky-cart'),
            $stCart = $('.sticky-cart-wr'),
            $close = $('#js-sticky-close'),
            disableStCart = localStorage.getItem('localDisableStCart') || '';
        if (disableStCart !== '') {
            $stCart.addClass('disable');
        }
        $close.on('click', function() {
            var isDisable = disableStCart !== '';
            if (isDisable) {
                localStorage.setItem('localDisableStCart', '');
            } else {
                localStorage.setItem('localDisableStCart', 'true');
            }
            $stCart.toggleClass('disable');
        })
        if ($anchor.length) {
            $(window).on('scroll', function() {
                var hT = $anchor.offset().top,
                    hH = $anchor.outerHeight(),
                    wH = $(window).height(),
                    wS = $(this).scrollTop();
                if (wS > (hT + hH - wH)) {
                    $stCart.addClass('active');
                } else {
                    $stCart.removeClass('active');
                }
            });
        }

    })()

    //Fix reload safari
    window.addEventListener("pageshow", function(evt) {
        if (evt.persisted) {
            setTimeout(function() {
                window.location.reload();
            }, 10);
        }
    }, false);

    // Back to top
    theme.backToTop = (function() {
        var backtotopClass = $('.js-back-to-top');
        $(window).scroll(function() {
            if ($(this).scrollTop() > 300) {
                backtotopClass.fadeIn('slow');
            } else {
                backtotopClass.fadeOut('slow');
            }
        });
        backtotopClass.on('click', function() {
            $('body,html').animate({ scrollTop: 0 }, 800);
        });
    })()


    // Tooltip
    theme.tooltip = (function() {
        var selector = '[data-toggle="tooltip"],[data-tooltip="true"]';

        function loadTooltip() {
            $(selector).tooltip(); //Bootstrap 4
        };
        $(document).on('click', selector, function() {
            $(this).tooltip('hide');
        });
        loadTooltip();
        return {
            load: loadTooltip
        }
    })()

    //Collections style 2
    theme.Bgcollection = (function() {
        // init Isotope
        function Bgcollection(container) {
            var $container = this.$container = $(container);
            var sectionId = $container.attr('data-section-id');
            var wrapper = this.wrapper = '.bgcollection-wrapper';
            var slider = this.slider = '#Bgcollection-' + sectionId;
            var $slider = $(slider, wrapper);
            $(".colgrid__bg--full[data-index='1']").addClass('active');
            $('.colgrid .colgrid__box').each(function() {
                var index = $(this).attr("data-index");
                $(this).hover(
                    function() {
                        $(".colgrid__bg--full[data-index='" + index + "']").addClass('active');
                    },
                    function() {
                        $(".colgrid__bg--full[data-index='" + index + "']").removeClass('active');
                    }
                );
            });
        }

        return Bgcollection;
    })();


    //Sidebar
    theme.sidebar = (function() {
        var togglebutton = '.js-toggle-filter',
            $sidebar = $('.js-sidebar');
        $(document).on('click', togglebutton, function() {
            $sidebar.toggleClass('active');
            $(this).toggleClass('active');
        })
    })()

    // Ajax filter in collection page
    theme.ajaxFilter = (function() {
        var ajaxContent = '#js-product-ajax',
            ajaxSortBy = '#js-sortby',
            ajaxFillter = '#js-fillter',
            ajaxCollectionTitle = '.js-collection-title',
            pageTitle = $(document).find("title").text(),
            jsLoading = '#js-loading';

        var apollo = {
            init: function() {
                this.initFilter();
            },
            showLoading: function() {
                $(jsLoading).show();
            },
            hideLoading: function() {
                $('body,html').animate({
                    scrollTop: $('#MainContent').offset().top - 150
                }, 600);
                setTimeout(function() {
                    $(jsLoading).hide(); //delay 500ms for better UX
                }, 500);

            },
            initFilter: function() {
                apollo.filterParams();
                apollo.filterSortby();
                apollo.sidebarMapTagEvents();
                apollo.filterMapSorting();
                apollo.filterMapPaging();
            },
            filterParams: function() {
                Shopify.queryParams = {};
                if (location.search.length) {
                    for (var aKeyValue, i = 0, aCouples = location.search.substr(1).split('&'); i < aCouples.length; i++) {
                        aKeyValue = aCouples[i].split('=');
                        if (aKeyValue.length > 1) {
                            Shopify.queryParams[decodeURIComponent(aKeyValue[0])] = decodeURIComponent(aKeyValue[1]);
                        }
                    }
                }
            },
            filterSortby: function() {
                if (Shopify.queryParams.sort_by) {
                    var sortby = Shopify.queryParams.sort_by;
                    $(ajaxSortBy).val(sortby);
                }
            },
            filterCreateUrl: function(baseLink) {
                var newQuery = $.param(Shopify.queryParams).replace(/%2B/g, '+');
                if (baseLink) {
                    if (newQuery != "") {
                        return baseLink + "?" + newQuery;
                    } else {
                        return baseLink;
                    }
                }
                return location.pathname + "?" + newQuery;
            },
            filterMapData: function(data) {
                // 1. update product grid
                $(ajaxContent).html($(ajaxContent, data.responseText).html());
                // 2. update left filter
                $(ajaxFillter).html($(ajaxFillter, data.responseText).html());
                // 3. update collection title
                $(ajaxCollectionTitle).html($(ajaxCollectionTitle, data.responseText).html());
            },
            filterAjaxClick: function(baseLink) {
                delete Shopify.queryParams.page;
                var newurl = apollo.filterCreateUrl(baseLink);
                History.pushState({
                    param: Shopify.queryParams
                }, pageTitle, newurl);
                apollo.filterGetContent(newurl);
            },
            filterGetContent: function(newurl) {
                $.ajax({
                    type: 'GET',
                    url: newurl,
                    data: {},
                    beforeSend: function() {
                        apollo.showLoading();
                    },
                    complete: function(data) {
                        apollo.filterMapData(data);
                        theme.wishlist.load();
                        theme.compare.load();
                        theme.countdown.load();
                        theme.priceRange.load();
                        theme.tooltip.load();
                        theme.collectionView.triggerView();
                        theme.swatchCard2.load();
                        theme.infiniteScroll.load();
                        apollo.hideLoading();
                    },
                    error: function(xhr, text) {
                        apollo.hideLoading();
                        alert($.parseJSON(xhr.responseText).description);
                    }
                });
            },
            sidebarMapTagEvents: function() {
                $(document).on('click', '.advanced-filter a', function(event) {
                    event.preventDefault();
                    $('.tooltip').removeClass('show');
                    var currentTags = [];
                    if (Shopify.queryParams.constraint) {
                        currentTags = Shopify.queryParams.constraint.split('+');
                    }
                    if (!$(this).parent().hasClass("active-filter")) {
                        var otherTag = $(this).parents('.catalog_filter_ul').find("li.active-filter");
                        if (otherTag.length > 0) {
                            var tagName = otherTag.data("handle");
                            if (tagName) {
                                var tagPos = currentTags.indexOf(tagName);
                                if (tagPos >= 0) {
                                    currentTags.splice(tagPos, 1);
                                }
                            }
                        }
                    }
                    var dataHandle = $(this).parent().data("handle");
                    if (dataHandle) {
                        var tagPos = currentTags.indexOf(dataHandle);
                        if (tagPos >= 0) {
                            currentTags.splice(tagPos, 1);
                        } else {
                            currentTags.push(dataHandle);
                        }
                    }
                    if (currentTags.length) {
                        Shopify.queryParams.constraint = currentTags.join('+');
                    } else {
                        delete Shopify.queryParams.constraint;
                    }
                    apollo.filterAjaxClick();
                });
                $(document).on('click', '.advanced-filter .icon', function() {
                    $(this).parent('.advanced-filter').find('a').trigger("click");
                });
            },
            filterMapSorting: function() {
                $(document).on('change', ajaxSortBy, function() {
                    Shopify.queryParams.sort_by = $(this).val();
                    apollo.filterAjaxClick();
                })
            },
            filterMapPaging: function() {
                $(document).on('click', '.js-pagination a', function() {
                    event.preventDefault();
                    var linkPage = $(this).attr("href").match(/page=\d+/g);
                    if (linkPage) {
                        Shopify.queryParams.page = parseInt(linkPage[0].match(/\d+/g));
                        if (Shopify.queryParams.page) {
                            var newurl = apollo.filterCreateUrl();
                            History.pushState({
                                param: Shopify.queryParams
                            }, pageTitle, newurl);
                            apollo.filterGetContent(newurl);
                        }
                    }
                });
            }
        }

        if ($(".template-collection")) {
            History.Adapter.bind(window, 'statechange', function() {
                var State = History.getState();
                apollo.filterParams();
            });
        }
        apollo.init();

    })(); $(theme.init);

/**
 * Currency Helpers
 * -----------------------------------------------------------------------------
 * A collection of useful functions that help with currency formatting
 *
 * Current contents
 * - formatMoney - Takes an amount in cents and returns it as a formatted dollar value.
 *
 * Alternatives
 * - Accounting.js - http://openexchangerates.github.io/accounting.js/
 *
 */

theme.Currency = (function() {
    var moneyFormat = '${{amount}}'; // eslint-disable-line camelcase

    function formatMoney(cents, format) {
        if (typeof cents === 'string') {
            cents = cents.replace('.', '');
        }
        var value = '';
        var placeholderRegex = /\{\{\s*(\w+)\s*\}\}/;
        var formatString = format || moneyFormat;

        function formatWithDelimiters(number, precision, thousands, decimal) {
            thousands = thousands || ',';
            decimal = decimal || '.';

            if (isNaN(number) || number === null) {
                return 0;
            }

            number = (number / 100.0).toFixed(precision);

            var parts = number.split('.');
            var dollarsAmount = parts[0].replace(
                /(\d)(?=(\d\d\d)+(?!\d))/g,
                '$1' + thousands
            );
            var centsAmount = parts[1] ? decimal + parts[1] : '';

            return dollarsAmount + centsAmount;
        }

        switch (formatString.match(placeholderRegex)[1]) {
            case 'amount':
                value = formatWithDelimiters(cents, 2);
                break;
            case 'amount_no_decimals':
                value = formatWithDelimiters(cents, 0);
                break;
            case 'amount_with_comma_separator':
                value = formatWithDelimiters(cents, 2, '.', ',');
                break;
            case 'amount_no_decimals_with_comma_separator':
                value = formatWithDelimiters(cents, 0, '.', ',');
                break;
            case 'amount_no_decimals_with_space_separator':
                value = formatWithDelimiters(cents, 0, ' ');
                break;
            case 'amount_with_apostrophe_separator':
                value = formatWithDelimiters(cents, 2, "'");
                break;
        }
        return formatString.replace(placeholderRegex, value);
    }

    return {
        formatMoney: formatMoney
    };
})();

/**
 * Image Helper Functions
 * -----------------------------------------------------------------------------
 * A collection of functions that help with basic image operations.
 *
 */

theme.Images = (function() {
    /**
     * Preloads an image in memory and uses the browsers cache to store it until needed.
     *
     * @param {Array} images - A list of image urls
     * @param {String} size - A shopify image size attribute
     */

    function preload(images, size) {
        if (typeof images === 'string') {
            images = [images];
        }

        for (var i = 0; i < images.length; i++) {
            var image = images[i];
            this.loadImage(this.getSizedImageUrl(image, size));
        }
    }

    /**
     * Loads and caches an image in the browsers cache.
     * @param {string} path - An image url
     */
    function loadImage(path) {
        new Image().src = path;
    }

    /**
     * Swaps the src of an image for another OR returns the imageURL to the callback function
     * @param image
     * @param element
     * @param callback
     */
    function switchImage(image, element, callback) {
        var size = this.imageSize(element.src);
        var imageUrl = this.getSizedImageUrl(image.src, size);

        if (callback) {
            callback(imageUrl, image, element); // eslint-disable-line callback-return
        } else {
            element.src = imageUrl;
        }
    }

    /**
     * +++ Useful
     * Find the Shopify image attribute size
     *
     * @param {string} src
     * @returns {null}
     */
    function imageSize(src) {
        src = src || '';

        var match = src.match(
            /.+_((?:pico|icon|thumb|small|compact|medium|large|grande)|\d{1,4}x\d{0,4}|x\d{1,4})[_\\.@]/
        );

        if (match === null) {
            return null;
        } else {
            return match[1];
        }
    }

    /**
     * +++ Useful
     * Adds a Shopify size attribute to a URL
     *
     * @param src
     * @param size
     * @returns {*}
     */
    function getSizedImageUrl(src, size) {
        if (size === null) {
            return src;
        }

        if (size === 'master') {
            return this.removeProtocol(src);
        }

        var match = src.match(
            /\.(jpg|jpeg|gif|png|bmp|bitmap|tiff|tif)(\?v=\d+)?$/i
        );

        if (match !== null) {
            var prefix = src.split(match[0]);
            var suffix = match[0];

            return this.removeProtocol(prefix[0] + '_' + size + suffix);
        }

        return null;
    }

    function removeProtocol(path) {
        return path.replace(/http(s)?:/, '');
    }

    return {
        preload: preload,
        loadImage: loadImage,
        switchImage: switchImage,
        imageSize: imageSize,
        getSizedImageUrl: getSizedImageUrl,
        removeProtocol: removeProtocol
    };
})();

/**
 * Variant Selection scripts
 * ------------------------------------------------------------------------------
 *
 * Handles change events from the variant inputs in any `cart/add` forms that may
 * exist.  Also updates the master select and triggers updates when the variants
 * price or image changes.
 *
 * @namespace variants
 */

slate.Variants = (function() {
    /**
     * Variant constructor
     *
     * @param {object} options - Settings from `product.js`
     */
    function Variants(options) {
        this.$container = options.$container;
        this.product = options.product;
        this.singleOptionSelector = options.singleOptionSelector;
        this.originalSelectorId = options.originalSelectorId;
        this.enableHistoryState = options.enableHistoryState;
        this.currentVariant = this._getVariantFromOptions();

        $(this.singleOptionSelector, this.$container).on(
            'change',
            this._onSelectChange.bind(this)
        );
    }

    Variants.prototype = _.assignIn({}, Variants.prototype, {
        /**
         * Get the currently selected options from add-to-cart form. Works with all
         * form input elements.
         *
         * @return {array} options - Values of currently selected variants
         */
        _getCurrentOptions: function() {
            var currentOptions = _.map(
                $(this.singleOptionSelector, this.$container),
                function(element) {
                    var $element = $(element);
                    var type = $element.attr('type');
                    var currentOption = {};

                    if (type === 'radio' || type === 'checkbox') {
                        if ($element[0].checked) {
                            currentOption.value = $element.val();
                            currentOption.index = $element.data('index');

                            return currentOption;
                        } else {
                            return false;
                        }
                    } else {
                        currentOption.value = $element.val();
                        currentOption.index = $element.data('index');

                        return currentOption;
                    }
                }
            );

            // remove any unchecked input values if using radio buttons or checkboxes
            currentOptions = _.compact(currentOptions);

            return currentOptions;
        },

        /**
         * Find variant based on selected values.
         *
         * @param  {array} selectedValues - Values of variant inputs
         * @return {object || undefined} found - Variant object from product.variants
         */
        _getVariantFromOptions: function() {
            var selectedValues = this._getCurrentOptions();
            var variants = this.product.variants;

            var found = _.find(variants, function(variant) {
                return selectedValues.every(function(values) {
                    return _.isEqual(variant[values.index], values.value);
                });
            });

            return found;
        },

        /**
         * Event handler for when a variant input changes.
         */
        _onSelectChange: function() {
            var variant = this._getVariantFromOptions();

            this.$container.trigger({
                type: 'variantChange',
                variant: variant
            });

            if (!variant) {
                return;
            }

            this._updateMasterSelect(variant);
            this._updateImages(variant);
            this._updatePrice(variant);
            this._updateSKU(variant);
            this.currentVariant = variant;

            if (this.enableHistoryState) {
                this._updateHistoryState(variant);
            }
        },

        /**
         * Trigger event when variant image changes
         *
         * @param  {object} variant - Currently selected variant
         * @return {event}  variantImageChange
         */
        _updateImages: function(variant) {
            var variantImage = variant.featured_image || {};
            var currentVariantImage = this.currentVariant.featured_image || {};

            if (!variant.featured_image ||
                variantImage.src === currentVariantImage.src
            ) {
                return;
            }

            this.$container.trigger({
                type: 'variantImageChange',
                variant: variant
            });
        },

        /**
         * Trigger event when variant price changes.
         *
         * @param  {object} variant - Currently selected variant
         * @return {event} variantPriceChange
         */
        _updatePrice: function(variant) {
            if (
                variant.price === this.currentVariant.price &&
                variant.compare_at_price === this.currentVariant.compare_at_price
            ) {
                return;
            }

            this.$container.trigger({
                type: 'variantPriceChange',
                variant: variant
            });
        },

        /**
         * Trigger event when variant sku changes.
         *
         * @param  {object} variant - Currently selected variant
         * @return {event} variantSKUChange
         */
        _updateSKU: function(variant) {
            if (variant.sku === this.currentVariant.sku) {
                return;
            }

            this.$container.trigger({
                type: 'variantSKUChange',
                variant: variant
            });
        },

        /**
         * Update history state for product deeplinking
         *
         * @param  {variant} variant - Currently selected variant
         * @return {k}         [description]
         */
        _updateHistoryState: function(variant) {
            if (!history.replaceState || !variant) {
                return;
            }

            var newurl =
                window.location.protocol +
                '//' +
                window.location.host +
                window.location.pathname +
                '?variant=' +
                variant.id;
            window.history.replaceState({ path: newurl }, '', newurl);
        },

        /**
         * Update hidden master select of variant change
         *
         * @param  {variant} variant - Currently selected variant
         */
        _updateMasterSelect: function(variant) {
            $(this.originalSelectorId, this.$container).val(variant.id);
        }
    });

    return Variants;
})();


/*================ MODULES ================*/
window.Drawers = (function() {
    var Drawer = function(id, position, options) {
        var defaults = {
            close: '.js-drawer-close',
            open: '.js-drawer-open-' + position,
            openClass: 'js-drawer-open',
            dirOpenClass: 'js-drawer-open-' + position
        };

        this.nodes = {
            $parent: $('body, html'),
            $page: $('.page-element'),
            $moved: $('.is-moved-by-drawer')
        };

        this.config = $.extend(defaults, options);
        this.position = position;

        this.$drawer = $('#' + id);
        this.$open = $(this.config.open);

        if (!this.$drawer.length) {
            return false;
        }

        this.drawerIsOpen = false;
        this.init();
    };

    Drawer.prototype.init = function() {
        this.$open.attr('aria-expanded', 'false');
        this.$open.on('click', $.proxy(this.open, this));
        this.$drawer.find(this.config.close).on('click', $.proxy(this.close, this));
    };

    Drawer.prototype.open = function(evt) {
        // Keep track if drawer was opened from a click, or called by another function
        var externalCall = false;

        // don't open an opened drawer
        if (this.drawerIsOpen) {
            return;
        }

        this.$open.addClass(this.config.openClass);

        // Prevent following href if link is clicked
        if (evt) {
            evt.preventDefault();
        } else {
            externalCall = true;
        }

        // Without this, the drawer opens, the click event bubbles up to $nodes.page
        // which closes the drawer.
        if (evt && evt.stopPropagation) {
            evt.stopPropagation();
            // save the source of the click, we'll focus to this on close
            this.$activeSource = $(evt.currentTarget);
        }

        if (this.drawerIsOpen && !externalCall) {
            return this.close();
        }

        // Add is-transitioning class to moved elements on open so drawer can have
        // transition for close animation
        this.nodes.$moved.addClass('is-transitioning');
        this.$drawer.prepareTransition();

        this.nodes.$parent.addClass(
            this.config.openClass + ' ' + this.config.dirOpenClass
        );
        this.drawerIsOpen = true;

        // Set focus on drawer
        slate.a11y.trapFocus({
            $container: this.$drawer,
            namespace: 'drawer_focus'
        });

        // Run function when draw opens if set
        if (
            this.config.onDrawerOpen &&
            typeof this.config.onDrawerOpen === 'function'
        ) {
            if (!externalCall) {
                this.config.onDrawerOpen();
            }
        }

        if (this.$activeSource && this.$activeSource.attr('aria-expanded')) {
            this.$activeSource.attr('aria-expanded', 'true');
        }

        this.bindEvents();
    };

    Drawer.prototype.close = function() {
        // don't close a closed drawer
        if (!this.drawerIsOpen) {
            return;
        }

        this.$open.removeClass(this.config.openClass);

        // deselect any focused form elements
        $(document.activeElement).trigger('blur');

        // Ensure closing transition is applied to moved elements, like the nav
        this.nodes.$moved.prepareTransition({ disableExisting: true });
        this.$drawer.prepareTransition({ disableExisting: true });

        this.nodes.$parent.removeClass(
            this.config.dirOpenClass + ' ' + this.config.openClass
        );

        this.drawerIsOpen = false;

        // Remove focus on drawer
        slate.a11y.removeTrapFocus({
            $container: this.$drawer,
            namespace: 'drawer_focus'
        });

        if (this.$activeSource && this.$activeSource.attr('aria-expanded')) {
            this.$activeSource.attr('aria-expanded', 'false');
        }

        this.unbindEvents();
    };

    Drawer.prototype.bindEvents = function() {
        // Lock scrolling on mobile
        this.nodes.$page.on('touchmove.drawer', function() {
            return false;
        });

        // Clicking out of drawer closes it
        this.nodes.$page.on(
            'click.drawer',
            $.proxy(function() {
                this.close();
                return false;
            }, this)
        );

        // Pressing escape closes drawer
        this.nodes.$parent.on(
            'keyup.drawer',
            $.proxy(function(evt) {
                if (evt.keyCode === 27) {
                    this.close();
                }
            }, this)
        );
    };

    Drawer.prototype.unbindEvents = function() {
        this.nodes.$page.off('.drawer');
        this.nodes.$parent.off('.drawer');
    };

    return Drawer;
})();

window.Modals = (function() {
    var Modal = function(id, name, options) {
        var defaults = {
            close: '.js-modal-close',
            open: '.js-modal-open-' + name,
            openClass: 'modal--is-active'
        };

        this.$modal = $('#' + id);

        if (!this.$modal.length) {
            return false;
        }

        this.nodes = {
            $body: $('body')
        };

        this.config = $.extend(defaults, options);

        this.modalIsOpen = false;
        this.$focusOnOpen = this.config.focusOnOpen ?
            $(this.config.focusOnOpen) :
            this.$modal;
        this.init();
    };

    Modal.prototype.init = function() {
        var $openBtn = $(this.config.open);

        // Add aria controls
        $openBtn.attr('aria-expanded', 'false');

        $(this.config.open).on('click', $.proxy(this.open, this));
        this.$modal.find(this.config.close).on('click', $.proxy(this.close, this));
    };

    Modal.prototype.open = function(evt) {
        // Keep track if modal was opened from a click, or called by another function
        var externalCall = false;

        // don't open an opened modal
        if (this.modalIsOpen) {
            return;
        }

        // Prevent following href if link is clicked
        if (evt) {
            evt.preventDefault();
        } else {
            externalCall = true;
        }

        // Without this, the modal opens, the click event bubbles up to $nodes.page
        // which closes the modal.
        if (evt && evt.stopPropagation) {
            evt.stopPropagation();
            // save the source of the click, we'll focus to this on close
            this.$activeSource = $(evt.currentTarget);
        }

        if (this.modalIsOpen && !externalCall) {
            return this.close();
        }

        this.$modal.prepareTransition().addClass(this.config.openClass);
        this.nodes.$body.addClass(this.config.openClass);

        this.modalIsOpen = true;

        // Set focus on modal
        slate.a11y.trapFocus({
            $container: this.$modal,
            namespace: 'modal_focus',
            $elementToFocus: this.$focusOnOpen
        });

        if (this.$activeSource && this.$activeSource.attr('aria-expanded')) {
            this.$activeSource.attr('aria-expanded', 'true');
        }

        this.bindEvents();
    };

    Modal.prototype.close = function() {
        // don't close a closed modal
        if (!this.modalIsOpen) {
            return;
        }

        // deselect any focused form elements
        $(document.activeElement).trigger('blur');

        this.$modal.prepareTransition().removeClass(this.config.openClass);
        this.nodes.$body.removeClass(this.config.openClass);

        this.modalIsOpen = false;

        // Remove focus on modal
        slate.a11y.removeTrapFocus({
            $container: this.$modal,
            namespace: 'modal_focus'
        });

        if (this.$activeSource && this.$activeSource.attr('aria-expanded')) {
            this.$activeSource.attr('aria-expanded', 'false').focus();
        }

        this.unbindEvents();
    };

    Modal.prototype.bindEvents = function() {
        // Pressing escape closes modal
        this.nodes.$body.on(
            'keyup.modal',
            $.proxy(function(evt) {
                if (evt.keyCode === 27) {
                    this.close();
                }
            }, this)
        );
    };

    Modal.prototype.unbindEvents = function() {
        this.nodes.$body.off('.modal');
    };

    return Modal;
})();

window.QtySelector = (function() {
    var QtySelector = function($el) {
        this.cache = {
            $body: $('body'),
            $subtotal: $('#CartSubtotal'),
            $discountTotal: $('#cartDiscountTotal'),
            $cartTable: $('.cart-table'),
            $cartTemplate: $('#CartProducts')
        };

        this.settings = {
            loadingClass: 'js-qty--is-loading',
            isCartTemplate: this.cache.$body.hasClass('template-cart'),
            // On the cart template, minimum is 0. Elsewhere min is 1
            minQty: this.cache.$body.hasClass('template-cart') ? 0 : 1
        };

        this.$el = $el;
        this.qtyUpdateTimeout;
        this.createInputs();
        this.bindEvents();
    };

    QtySelector.prototype.createInputs = function() {
        var $el = this.$el;

        var data = {
            value: $el.val(),
            key: $el.attr('id'),
            name: $el.attr('name'),
            line: $el.attr('data-line')
        };
        var source = $('#QuantityTemplate').html();
        var template = Handlebars.compile(source);

        this.$wrapper = $(template(data)).insertBefore($el);

        // Remove original number input
        $el.remove();
    };

    QtySelector.prototype.validateAvailability = function(line, quantity) {
        var product = theme.cartObject.items[line - 1]; // 0-based index in API
        var handle = product.handle; // needed for the ajax request
        var id = product.id; // needed to find right variant from ajax results

        var params = {
            type: 'GET',
            url: '/products/' + handle + '.js',
            dataType: 'json',
            success: $.proxy(function(cartProduct) {
                this.validateAvailabilityCallback(line, quantity, id, cartProduct);
            }, this)
        };

        $.ajax(params);
    };

    QtySelector.prototype.validateAvailabilityCallback = function(
        line,
        quantity,
        id,
        product
    ) {
        var quantityIsAvailable = true;

        // This returns all variants of a product.
        // Loop through them to get our desired one.
        for (var i = 0; i < product.variants.length; i++) {
            var variant = product.variants[i];
            if (variant.id === id) {
                break;
            }
        }

        // If the variant tracks inventory and does not sell when sold out
        // we can compare the requested with available quantity
        if (
            variant.inventory_management !== null &&
            variant.inventory_policy === 'deny'
        ) {
            if (variant.inventory_quantity < quantity) {

                // Set quantity to max amount available
                this.$wrapper.find('.js-qty__input').val(variant.inventory_quantity);

                quantityIsAvailable = false;
                this.$wrapper.removeClass(this.settings.loadingClass);
            }
        }

        if (quantityIsAvailable) {
            this.updateItemQuantity(line, quantity);
        }
    };

    QtySelector.prototype.validateQty = function(qty) {
        if (parseFloat(qty) === parseInt(qty, 10) && !isNaN(qty)) {
            // We have a valid number!
        } else {
            // Not a number. Default to 1.
            qty = 1;
        }
        return parseInt(qty, 10);
    };

    QtySelector.prototype.adjustQty = function(evt) {
        var $el = $(evt.currentTarget);
        var $input = $el.siblings('.js-qty__input');
        var qty = this.validateQty($input.val());
        var line = $input.attr('data-line');

        if ($el.hasClass('js-qty__adjust--minus')) {
            qty -= 1;
            if (qty <= this.settings.minQty) {
                qty = this.settings.minQty;
            }
        } else {
            qty += 1;
        }

        if (this.settings.isCartTemplate) {
            $el.parent().addClass(this.settings.loadingClass);
            this.updateCartItemPrice(line, qty);
        } else {
            $input.val(qty);
        }
    };

    QtySelector.prototype.bindEvents = function() {
        this.$wrapper
            .find('.js-qty__adjust')
            .on('click', $.proxy(this.adjustQty, this));

        // Select input text on click
        this.$wrapper.on('click', '.js-qty__input', function() {
            this.setSelectionRange(0, this.value.length);
        });

        // If the quantity changes on the cart template, update the price
        if (this.settings.isCartTemplate) {
            this.$wrapper.on(
                'change',
                '.js-qty__input',
                $.proxy(function(evt) {
                    var $input = $(evt.currentTarget);
                    var line = $input.attr('data-line');
                    var qty = this.validateQty($input.val());
                    $input.parent().addClass(this.settings.loadingClass);
                    this.updateCartItemPrice(line, qty);
                }, this)
            );
        }
    };

    QtySelector.prototype.updateCartItemPrice = function(line, qty) {
        // Update cart after short timeout so user doesn't create simultaneous ajax calls
        clearTimeout(this.qtyUpdateTimeout);
        this.qtyUpdateTimeout = setTimeout(
            $.proxy(function() {
                this.validateAvailability(line, qty);
            }, this),
            200
        );
    };

    QtySelector.prototype.updateItemQuantity = function(line, quantity) {
        var params = {
            type: 'POST',
            url: '/cart/change.js',
            data: 'quantity=' + quantity + '&line=' + line,
            dataType: 'json',
            success: $.proxy(function(cart) {
                this.updateCartItemCallback(cart);
            }, this)
        };

        $.ajax(params);
    };

    QtySelector.prototype.updateCartItemCallback = function(cart) {
        // Reload the page to show the empty cart if no items
        if (cart.item_count === 0) {
            location.reload();
            return;
        }

        // Update cart object
        theme.cartObject = cart;

        // Handlebars.js cart layout
        var data = {};
        var items = [];
        var item = {};
        var source = $('#CartProductTemplate').html();
        var template = Handlebars.compile(source);
        var prodImg;

        // Add each item to our handlebars.js data
        $.each(cart.items, function(index, cartItem) {
            /* Hack to get product image thumbnail
             *   - If image is not null
             *     - Remove file extension, add 240x240, and re-add extension
             *     - Create server relative link
             *   - A hard-coded url of no-image
             */

            if (cartItem.image === null) {
                prodImg =
                    '//cdn.shopify.com/s/assets/admin/no-image-medium-cc9732cb976dd349a0df1d39816fbcc7.gif';
            } else {
                prodImg = cartItem.image
                    .replace(/(\.[^.]*)$/, '_240x240$1')
                    .replace('http:', '');
            }

            if (cartItem.properties !== null) {
                $.each(cartItem.properties, function(key, value) {
                    if (key.charAt(0) === '_' || !value) {
                        delete cartItem.properties[key];
                    }
                });
            }

            // Create item's data object and add to 'items' array
            item = {
                key: cartItem.key,
                line: index + 1, // Shopify uses a 1+ index in the API
                url: cartItem.url,
                img: prodImg,
                name: cartItem.product_title,
                variation: cartItem.variant_title,
                properties: cartItem.properties,
                itemQty: cartItem.quantity,
                price: theme.Currency.formatMoney(cartItem.price, theme.moneyFormat),
                vendor: cartItem.vendor,
                linePrice: theme.Currency.formatMoney(
                    cartItem.line_price,
                    theme.moneyFormat
                ),
                originalLinePrice: theme.Currency.formatMoney(
                    cartItem.original_line_price,
                    theme.moneyFormat
                ),
                discounts: cartItem.discounts,
                discountsApplied: cartItem.line_price === cartItem.original_line_price ? false : true
            };

            items.push(item);
            theme.updateCurrencies();
        });

        // Gather all cart data and add to DOM
        data = {
            items: items
        };
        this.cache.$cartTemplate.empty().append(template(data));

        // Create new quantity selectors
        this.cache.$cartTable.find('input[type="number"]').each(function(i, el) {
            new QtySelector($(el));
        });

        // Update the cart subtotal
        this.cache.$subtotal.html(
            theme.Currency.formatMoney(cart.total_price, theme.moneyFormat)
        );

        // Update the cart total discounts
        if (cart.total_discount > 0) {
            this.cache.$discountTotal.html(
                theme.strings.totalCartDiscount.replace(
                    '[savings]',
                    theme.Currency.formatMoney(cart.total_discount, theme.moneyFormat)
                )
            );
        } else {
            this.cache.$discountTotal.empty();
        }

        theme.miniCart.updateElements();
        theme.updateCurrencies();
        // Set focus on cart table
        slate.a11y.pageLinkFocus(this.cache.$cartTable);
    };

    return QtySelector;
})();

/*
  Allow product to be added to cart via ajax with
  custom success and error responses.
*/
window.AjaxCart = (function() {
    var styleCart = $('.js-mini-cart').attr("data-cartmini");
    var cart = function($form) {
        this.cache = {
            $cartIconIndicator: $('.site-header__cart-indicator')
        };

        this.$form = $form;
        this.eventListeners();

        this.showNotice = false;
        if (this.$form.length) {
            this.showNotice = this.$form.hasClass('js-form--notice') ? true : false;
        }
    };

    cart.prototype.eventListeners = function() {
        if (this.$form.length) {
            this.$form.on('submit', $.proxy(this.addItemFromForm, this));
        }
    };

    cart.prototype.addItemFromForm = function(evt) {
        evt.preventDefault();

        var params = {
            type: 'POST',
            url: '/cart/add.js',
            data: this.$form.serialize(),
            dataType: 'json',
            success: $.proxy(function(lineItem) {
                //this.success(lineItem);
                window.location.href = '/cart';
            }, this),
            error: $.proxy(function(XMLHttpRequest, textStatus) {
                this.error(XMLHttpRequest, textStatus);
            }, this)
        };
        $.ajax(params);
    };

    cart.prototype.success = function(item) {
        theme.miniCart.updateElements();
        theme.miniCart.generateCart();
        if (styleCart != 'false') {
            if (this.showNotice) {
                var htmlVariant = item.variant_title !== null ? '<i>(' + item.variant_title + ')</i>' : '';
                var htmlAlert = '<div class="media mt-2 alert--cart"><a class="mr-3" href="/cart"><img class="lazyload" data-src="' + item.image + '"></a><div class="media-body align-self-center"><p class="m-0 font-weight-bold">' + item.product_title + ' x ' + item.quantity + '</p>' + htmlVariant + '<div><div>';
                theme.alert.new(theme.strings.addToCartSuccess, htmlAlert, 3000, 'notice');
            } else {
                theme.crosssell.showPopup(item);
            }
        }
    };

    // Error handling reference from Shopify.onError in api.jquery.js
    cart.prototype.error = function(XMLHttpRequest) {
        var data = JSON.parse(XMLHttpRequest.responseText);

        if (data.message) {
            theme.alert.new('', data.description, 3000, 'warning');
        }
    };

    return cart;
})();

/*================ TEMPLATES ================*/
theme.customerTemplates = (function() {
    function initEventListeners() {
        // Show reset password form
        $('#RecoverPassword').on('click', function(evt) {
            evt.preventDefault();
            toggleRecoverPasswordForm();
        });

        // Hide reset password form
        $('#HideRecoverPasswordLink').on('click', function(evt) {
            evt.preventDefault();
            toggleRecoverPasswordForm();
        });
    }

    /**
     *
     *  Show/Hide recover password form
     *
     */
    function toggleRecoverPasswordForm() {
        $('#RecoverPasswordForm').toggleClass('hide');
        $('#CustomerLoginForm').toggleClass('hide');
    }

    /**
     *
     *  Show reset password success message
     *
     */
    function resetPasswordSuccess() {
        // check if reset password form was successfully submited
        if (!$('.reset-password-success').length) {
            return;
        }

        // show success message
        $('#ResetSuccess').removeClass('hide');
    }

    /**
     *
     *  Show/hide customer address forms
     *
     */
    function customerAddressForm() {
        var $newAddressForm = $('#AddressNewForm');

        if (!$newAddressForm.length) {
            return;
        }

        // Initialize observers on address selectors, defined in shopify_common.js
        if (Shopify) {
            // eslint-disable-next-line no-new
            new Shopify.CountryProvinceSelector(
                'AddressCountryNew',
                'AddressProvinceNew', {
                    hideElement: 'AddressProvinceContainerNew'
                }
            );
        }

        // Initialize each edit form's country/province selector
        $('.address-country-option').each(function() {
            var formId = $(this).data('form-id');
            var countrySelector = 'AddressCountry_' + formId;
            var provinceSelector = 'AddressProvince_' + formId;
            var containerSelector = 'AddressProvinceContainer_' + formId;

            // eslint-disable-next-line no-new
            new Shopify.CountryProvinceSelector(countrySelector, provinceSelector, {
                hideElement: containerSelector
            });
        });

        // Toggle new/edit address forms
        $('.address-new-toggle').on('click', function() {
            $newAddressForm.toggleClass('hide');
        });

        $('.address-edit-toggle').on('click', function() {
            var formId = $(this).data('form-id');
            $('#EditAddress_' + formId).toggleClass('hide');
        });

        $('.address-delete').on('click', function() {
            var $el = $(this);
            var formId = $el.data('form-id');
            var confirmMessage = $el.data('confirm-message');

            // eslint-disable-next-line no-alert
            if (
                confirm(
                    confirmMessage || 'Are you sure you wish to delete this address?'
                )
            ) {
                Shopify.postLink('/account/addresses/' + formId, {
                    parameters: { _method: 'delete' }
                });
            }
        });
    }

    /**
     *
     *  Check URL for reset password hash
     *
     */
    function checkUrlHash() {
        var hash = window.location.hash;

        // Allow deep linking to recover password form
        if (hash === '#recover') {
            toggleRecoverPasswordForm();
        }
    }

    return {
        init: function() {
            checkUrlHash();
            initEventListeners();
            resetPasswordSuccess();
            customerAddressForm();
        }
    };
})();

/*================ SECTIONS ================*/
theme.HeaderSection = (function() {
    function Header() {
        theme.NavDrawer = new window.Drawers('NavDrawer', 'left');
    }

    return Header;
})();

theme.Product = (function() {
    var defaults = {
        smallBreakpoint: 750,
        productThumbIndex: 0,
        productThumbMax: 0,
        ajaxCart: false,
        stockSetting: false
    };

    function Product(container) {
        var $container = (this.$container = $(container));
        var sectionId = $container.attr('data-section-id');

        this.selectors = {
            originalSelectorId: '#ProductSelect-' + sectionId,
            modal: 'ProductModal',
            productZoomImage: '#ProductZoomImg',
            addToCart: '#AddToCart-' + sectionId,
            productPrice: '#ProductPrice-' + sectionId,
            comparePrice: '#ComparePrice-' + sectionId,
            addToCartText: '#AddToCartText-' + sectionId,
            SKU: '.js-variant-sku',
            productImageContainers: '.product__photo-container-' + sectionId,
            productImageWrappers: '.product__photo-wrapper-' + sectionId,
            productThumbContainers: '.product-single__thumbnail-item-' + sectionId,
            productThumbsWrapper: '.product-single__thumbnails-' + sectionId,
            productThumbs: '.product-single__thumbnail-' + sectionId,
            saleTag: '#ProductSaleTag-' + sectionId,
            productStock: '#ProductStock-' + sectionId,
            singleOptionSelector: '.single-option-selector-' + sectionId,
            shopifyPaymentButton: '.shopify-payment-button',
            availability: '.product-single__availability',
            hurrify: '.js-hurrify'
        };

        this.settings = $.extend({}, defaults, {
            sectionId: sectionId,
            ajaxCart: $container.data('ajax'),
            stockSetting: $container.data('stock'),
            enableHistoryState: $container.data('enable-history-state') || false,
            namespace: '.product-' + sectionId
        });

        // Stop parsing if we don't have the product json script tag
        if (!$('#ProductJson-' + sectionId).html()) {
            return;
        }

        this.productSingleObject = JSON.parse(
            $('#ProductJson-' + sectionId).html()
        );
        this.addVariantInfo();

        this.init();
    }

    Product.prototype = _.assignIn({}, Product.prototype, {
        init: function() {
            this._stringOverrides();
            this._initVariants();
            this._productZoomImage();
            this._productThumbSwitch();
            this._productThumbnailSlider();
            this._initQtySelector();

            if (this.settings.ajaxCart) {
                theme.AjaxCart = new window.AjaxCart(
                    $('#AddToCartForm-' + this.settings.sectionId)
                );
            }
        },

        _stringOverrides: function() {
            window.productStrings = window.productStrings || {};
            $.extend(theme.strings, window.productStrings);
        },

        addVariantInfo: function() {
            if (!this.productSingleObject || !this.settings.stockSetting) {
                return;
            }

            var variantInfo = JSON.parse(
                $('#VariantJson-' + this.settings.sectionId).html()
            );

            for (var i = 0; i < variantInfo.length; i++) {
                $.extend(this.productSingleObject.variants[i], variantInfo[i]);
            }
        },

        _initVariants: function() {
            var options = {
                $container: this.$container,
                enableHistoryState: this.settings.enableHistoryState,
                product: this.productSingleObject,
                singleOptionSelector: this.selectors.singleOptionSelector,
                originalSelectorId: this.selectors.originalSelectorId
            };

            // eslint-disable-next-line no-new
            this.variants = new slate.Variants(options);

            this.$container.on(
                'variantChange' + this.settings.namespace,
                this._updateAddToCartBtn.bind(this)
            );
            this.$container.on(
                'variantChange' + this.settings.namespace,
                this._updateStickyCart.bind(this)
            );
            this.$container.on(
                'variantPriceChange' + this.settings.namespace,
                this._updatePrice.bind(this)
            );
            this.$container.on(
                'variantSKUChange' + this.settings.namespace,
                this._updateSKU.bind(this)
            );
            this.$container.on(
                'variantImageChange' + this.settings.namespace,
                this._updateImages.bind(this)
            );
        },

        _updateStock: function(variant) {
            if (!this.settings.stockSetting) return;

            var $stock = $(this.selectors.productStock),
                $hurrify = $(this.selectors.hurrify);

            // If we don't track variant inventory, hide stock
            if (!variant || !variant.inventory_management) {
                $stock.addClass('hide');
                $hurrify.addClass('hide');
                return;
            }

            if (variant.inventory_quantity < 10 && variant.inventory_quantity > 0) {
                $stock
                    .html(
                        theme.strings.stockAvailable.replace(
                            '1',
                            variant.inventory_quantity
                        )
                    )
                    .removeClass('hide');
                $hurrify.removeClass('hide').find('.progress-bar').css('width', variant.inventory_quantity * 10 + '%');
                return;
            }

            if (variant.inventory_quantity <= 0 && variant.incoming) {
                $stock
                    .html(
                        theme.strings.willNotShipUntil.replace(
                            '[date]',
                            variant.next_incoming_date
                        )
                    )
                    .removeClass('hide');
                $hurrify.addClass('hide');
                return;
            }

            // If there's more than 10 available, hide stock
            $stock.addClass('hide');
            $hurrify.addClass('hide');
        },

        _updateIncomingInfo: function(variant) {
            if (!this.settings.stockSetting) return;

            var $stock = $(this.selectors.productStock);

            if (variant.incoming) {
                $stock
                    .html(
                        theme.strings.willBeInStockAfter.replace(
                            '[date]',
                            variant.next_incoming_date
                        )
                    )
                    .removeClass('hide');
                return;
            }

            // If there is no stock incoming, hide stock
            $stock.addClass('hide');
        },

        _updateAddToCartBtn: function(evt) {
            var variant = evt.variant;

            var cache = {
                $addToCart: $(this.selectors.addToCart),
                $addToCartText: $(this.selectors.addToCartText)
            };

            if (variant) {
                // Select a valid variant if available
                theme.noticeSoldout.init(variant);
                if (variant.available) {
                    // We have a valid product variant, so enable the submit button
                    cache.$addToCart.removeClass('btn--sold-out').prop('disabled', false);
                    cache.$addToCartText.html(theme.strings.addToCart);
                    $(this.selectors.shopifyPaymentButton, this.$container).show();
                    // Show how many items are left, if below 10
                    this._updateStock(variant);
                    //update availability - available
                    $(this.selectors.availability).find('span').text(theme.strings.available);
                } else {
                    // Variant is sold out, disable the submit button
                    cache.$addToCart.prop('disabled', true).addClass('btn--sold-out');
                    cache.$addToCartText.html(theme.strings.soldOut);
                    $(this.selectors.shopifyPaymentButton, this.$container).hide();
                    // Update when stock will be available
                    this._updateIncomingInfo(variant);
                    //update availability - soldout
                    $(this.selectors.availability).find('span').text(theme.strings.soldOut);
                }
            } else {
                cache.$addToCart.prop('disabled', true).removeClass('btn--sold-out');
                cache.$addToCartText.html(theme.strings.unavailable);
                //update availability - unavailable
                $(this.selectors.availability).find('span').text(theme.strings.unavailable);
                $(this.selectors.shopifyPaymentButton, this.$container).hide();
                // Hide stock display
                this._updateStock();
            }
        },

        _updatePrice: function(evt) {
            var variant = evt.variant;

            if (variant) {
                $(this.selectors.productPrice).html(
                    theme.Currency.formatMoney(variant.price, theme.moneyFormat)
                );

                // Update and show the product's compare price if necessary
                if (variant.compare_at_price > variant.price) {
                    $(this.selectors.comparePrice)
                        .html(
                            theme.Currency.formatMoney(
                                variant.compare_at_price,
                                theme.moneyFormat
                            )
                        )
                        .removeClass('hide');
                    $(this.selectors.saleTag).removeClass('hide');
                } else {
                    $(this.selectors.comparePrice).addClass('hide');
                    $(this.selectors.saleTag).addClass('hide');
                }

                theme.updateCurrencies();
            } else {
                $(this.selectors.comparePrice).addClass('hide');
            }
        },

        _updateSKU: function(evt) {
            var variant = evt.variant;

            if (variant) {
                $(this.selectors.SKU).html(variant.sku);
            }
        },

        _updateImages: function(evt) {
            var variant = evt.variant;

            if (variant && variant.featured_image) {
                var imageId = variant.featured_image.id;
                this.switchProductImage(imageId);
                this.setActiveThumbnail(imageId);
            }
        },
        _updateStickyCart: function(evt) {
            var variant = evt.variant,
                $stickyPrice = $('#js-sticky-price'),
                $stickyTitle = $('#js-sticky-title'),
                $stickyImage = $('#js-sticky-img'),
                $stickyButton = $('#js-sticky-btn');
            if (variant) {
                //update title
                $stickyTitle.html(' - ' + variant.title);
                //update price
                $stickyPrice.html(theme.Currency.formatMoney(variant.price, theme.moneyFormat));
                //update selectbox
                for (var i = 1; i <= 3; i++) {
                    var option = 'option' + i,
                        $selecBox = '#js-sticky-option-' + i;
                    if (variant[option] !== null) {
                        var valueOption = variant[option];
                        $($selecBox).val(valueOption);
                    }
                }
                //update button cart
                if (variant.available) {
                    $stickyButton.prop('disabled', false).removeClass('btn--sold-out');
                    $stickyButton.html(theme.strings.addToCart);
                } else {
                    $stickyButton.prop('disabled', true).addClass('btn--sold-out');
                    $stickyButton.html(theme.strings.soldOut);
                }
                //update image
                if (variant.featured_image) {
                    $stickyImage.attr('src', theme.Images.getSizedImageUrl(variant.featured_image.src, '200x'));
                }
            } else {
                //update title
                $stickyTitle.html(' - ' + theme.strings.unavailable);
                //update button cart
                $stickyButton.prop('disabled', true).removeClass('btn--sold-out');
                $stickyButton.html(theme.strings.unavailable);
            }
        },

        switchProductImage: function(imageId) {
            var $imageToShow = $(
                this.selectors.productImageContainers +
                "[data-image-id='" +
                imageId +
                "']",
                this.$container
            );
            var $imagesToHide = $(
                this.selectors.productImageContainers +
                ":not([data-image-id='" +
                imageId +
                "'])",
                this.$container
            );
            $imagesToHide.addClass('hide');
            $imageToShow.removeClass('hide');
            //Scroll to active
            topMenuHeight = $('.site-header').outerHeight();
            if (this.settings.sectionId === 'product-template-8') {
                $([document.documentElement, document.body]).animate({
                    scrollTop: $imageToShow.offset().top - topMenuHeight
                }, 500);
            }
        },

        setActiveThumbnail: function(imageId) {
            var $thumbnailToShow = $(
                this.selectors.productThumbContainers +
                "[data-image-id='" +
                imageId +
                "']",
                this.$container
            );
            var $thumbnailsToHide = $(
                this.selectors.productThumbContainers +
                ":not([data-image-id='" +
                imageId +
                "'])",
                this.$container
            );
            $thumbnailsToHide.removeClass('is-active');
            $thumbnailToShow.addClass('is-active');
            $thumbnailToShow.trigger('click');
            var $thumbnails = $(this.selectors.productThumbsWrapper, this.$container);

            // If there is a slick carousel, get the slide index, and position it into view with animation.
            if ($thumbnails.hasClass('slick-initialized')) {
                // eslint-disable-next-line shopify/jquery-dollar-sign-reference
                var currentActiveSlideIndex = $thumbnails.slick('slickCurrentSlide');
                var newActiveSlideIndex = parseInt(
                    $thumbnailToShow.attr('data-slick-index')
                );
                if (currentActiveSlideIndex !== newActiveSlideIndex) {
                    $thumbnails.slick('slickGoTo', newActiveSlideIndex, false);

                }
            }
        },

        _productZoomImage: function() {
            // The zoom image is only used on the product template, so return early
            // even if a featured product section is present.
            if (!$('.product-single ' + this.selectors.productImageContainers).length) {
                return;
            }

            var self = this;

            $(this.selectors.productImageWrappers).on(
                'click' + this.settings.namespace,
                function(evt) {
                    evt.preventDefault();
                    // Empty src before loadig new image to avoid awkward image swap
                    $(self.selectors.productZoomImage)
                        .attr('src', '')
                        .attr('src', $(this).attr('href'));
                }
            );

            this.ProductModal = new window.Modals(
                this.selectors.modal,
                'product-modal'
            );

            // Close modal if clicked, but not if the image is clicked
            this.ProductModal.$modal.on('click' + this.settings.namespace, function(
                evt
            ) {
                if (evt.target.nodeName !== 'IMG') {
                    self.ProductModal.close();
                }
            });
        },

        _productThumbSwitch: function() {
            if (!$(this.selectors.productThumbs).length) {
                return;
            }

            var self = this;

            $(this.selectors.productThumbs).on(
                'click' + this.settings.namespace,
                function(evt) {
                    evt.preventDefault();
                    var imageId = $(this)
                        .parent()
                        .data('image-id');
                    self.setActiveThumbnail(imageId);
                    self.switchProductImage(imageId);
                }
            );
            //trigger hover thumb
            // $(this.selectors.productThumbs).on('click',function(){
            //   $(this).trigger('click');
            // });
        },

        /*
          Thumbnail slider
         */
        _productThumbnailSlider: function() {
            var $productThumbsWrapper = $(this.selectors.productThumbsWrapper);
            var $productThumbs = $(this.selectors.productThumbs);
            if (!$productThumbs.length) {
                return;
            }

            if ($productThumbs.length > 1) {
                $productThumbsWrapper.on(
                    'init' + this.settings.namespace,
                    this._productSwipeInit.bind(this)
                );

                if (this.settings.sectionId === 'product-template-3' || this.settings.sectionId === 'product-template-4') {
                    $productThumbsWrapper.slick({
                        accessibility: false,
                        arrows: true,
                        dots: false,
                        infinite: false,
                        autoplay: false,
                        slidesToShow: 5,
                        slidesToScroll: 5,
                        vertical: true,
                        verticalSwiping: true,
                        responsive: [{
                            breakpoint: 992,
                            settings: {
                                vertical: false,
                                verticalSwiping: false,
                                slidesToShow: 4,
                                slidesToScroll: 4,
                                dots: false,
                            }
                        }]
                    }).css('opacity', '1');
                } else if (this.settings.sectionId === 'product-template-5') {
                    $productThumbsWrapper.slick({
                        accessibility: false,
                        arrows: true,
                        dots: false,
                        infinite: true,
                        autoplay: false,
                        slidesToShow: 2,
                        slidesToScroll: 1,
                        responsive: [{
                            breakpoint: 992,
                            settings: {
                                slidesToShow: 4,
                                slidesToScroll: 4,
                                dots: false,
                            }
                        }]
                    }).css('opacity', '1');
                } else if (this.settings.sectionId === 'product-template-7') {
                    $productThumbsWrapper.slick({
                        accessibility: false,
                        arrows: true,
                        dots: true,
                        infinite: true,
                        autoplay: false,
                        slidesToShow: 1,
                        slidesToScroll: 1,
                        responsive: [{
                            breakpoint: 992,
                            settings: {
                                slidesToShow: 1,
                                slidesToScroll: 1,
                                dots: false,
                                arrows: true,
                            }
                        }]
                    }).css('opacity', '1');
                } else if (this.settings.sectionId === 'product-template-8') {
                    var lastId,
                        topMenu = $(".product-single__thumbnails"),
                        topMenuHeight = $('.site-header').outerHeight() + 20,
                        // All list items
                        menuItems = topMenu.find(".product-single__thumbnail");


                    if ($(window).width() > 767) {
                        menuItems.click(function(e) {
                            var findid = $(this).attr('href');
                            offsetTop = $(findid).offset().top - topMenuHeight + 1;
                            $('html, body').stop().animate({
                                scrollTop: offsetTop
                            }, 200);
                            return false;
                        });
                        // Anchors corresponding to menu items
                        scrollItems = menuItems.map(function() {
                            var item = $($(this).attr('href'));
                            if (item.length) { return item; }
                        });

                        $(window).scroll(function() {
                            // Get container scroll position
                            var fromTop = $(this).scrollTop() + topMenuHeight;
                            // Get id of current scroll item
                            var cur = scrollItems.map(function() {
                                if ($(this).offset().top < fromTop)
                                    return this;
                            });
                            // Get the id of the current element
                            cur = cur[cur.length - 1];
                            var id = cur && cur.length ? cur[0].id : "";

                            if (lastId !== id) {
                                lastId = id;
                                // Set/remove active class
                                menuItems
                                    .parent().removeClass("is-active")
                                    .end().filter("[href='#" + id + "']").parent().addClass("is-active");
                            }
                        });
                    } else {
                        menuItems.click(function(e) {
                            var findid = $(this).attr('href');
                            offsetTop = $(findid).offset().top;
                            $('html, body').stop().animate({
                                scrollTop: offsetTop
                            });
                            return false;
                        });
                    }

                    $productThumbsWrapper.slick({
                        accessibility: false,
                        arrows: true,
                        dots: false,
                        infinite: false,
                        autoplay: false,
                        slidesToShow: 5,
                        slidesToScroll: 1,
                        vertical: true,
                        verticalSwiping: true,
                        responsive: [{
                            breakpoint: 992,
                            settings: {
                                vertical: false,
                                verticalSwiping: false,
                                slidesToShow: 4,
                                slidesToScroll: 4,
                                dots: true,
                            }
                        }]
                    }).css('opacity', '1');
                } else {
                    $productThumbsWrapper.slick({
                        accessibility: false,
                        arrows: true,
                        dots: false,
                        infinite: false,
                        autoplay: false,
                        slidesToShow: 4,
                        slidesToScroll: 4
                    }).css('opacity', '1');
                }

                // Show highlighted thumbnail by repositioning slider
                $productThumbsWrapper.slick(
                    'slickGoTo',
                    $productThumbsWrapper.find('.is-active').attr('data-slick-index'),
                    true
                );
            }
        },

        _productSwipeInit: function(evt, obj) {
            // Slider is initialized. Setup custom swipe events
            this.settings.productThumbIndex = obj.currentSlide;
            this.settings.productThumbMax = obj.slideCount - 1; // we need the 0-based index

            var self = this;

            $(this.selectors.productImageWrappers).on(
                'swipeleft swiperight',
                function(event) {
                    if (event.type === 'swipeleft') {
                        self._goToNextThumbnail();
                    }

                    if (event.type === 'swiperight') {
                        self._goToPrevThumbnail();
                    }

                    // Trigger click on newly requested thumbnail
                    $(
                            '.product-single__thumbnail-item[data-slick-index="' +
                            self.settings.productThumbIndex +
                            '"]'
                        )
                        .find('.product-single__thumbnail')
                        .trigger('click');

                }
            );
        },
        _goToNextThumbnail: function() {
            this.settings.productThumbIndex++;

            if (this.settings.productThumbIndex > this.settings.productThumbMax) {
                this.settings.productThumbIndex = 0;
            }

            $(this.selectors.productThumbsWrapper).slick(
                'slickGoTo',
                this.settings.productThumbIndex,
                true
            );
        },

        _goToPrevThumbnail: function() {
            this.settings.productThumbIndex--;

            if (this.settings.productThumbIndex < 0) {
                this.settings.productThumbIndex = this.settings.productThumbMax;
            }

            $(this.selectors.productThumbsWrapper).slick(
                'slickGoTo',
                this.settings.productThumbIndex,
                true
            );
        },

        _initQtySelector: function() {
            this.$container.find('.product-form__quantity').each(function(i, el) {
                // eslint-disable-next-line no-new
                new QtySelector($(el));
            });
        },

        onUnload: function() {
            $(this.selectors.productImageWrappers).off(this.settings.namespace);
            $(this.selectors.productThumbs).off(this.settings.namespace);
            $(this.selectors.productThumbs).slick('unslick');
            if (this.ProductModal) {
                this.ProductModal.$modal.off(this.settings.namespace);
            }
        }
    });

    return Product;
})();

theme.Slideshow = (function() {
    this.$slideshow = null;
    var classes = {
        slideshow: 'slideshow',
        slickActiveMobile: 'slick-active-mobile',
        controlsHover: 'slideshow__controls--hover',
        isPaused: 'is-paused'
    };

    var selectors = {
        section: '.shopify-section',
        wrapper: '#SlideshowWrapper-',
        slides: '.slideshow__slide',
        textWrapperMobile: '.slideshow__text-wrap--mobile',
        textContentMobile: '.slideshow__text-content--mobile',
        controls: '.slideshow__controls',
        dots: '.slick-dots',
        arrowLeft: '.slideshow__arrow-left',
        arrowRight: '.slideshow__arrow-right'
    };

    function slideshow(el, sectionId) {
        var $slideshow = (this.$slideshow = $(el));
        this.adaptHeight = this.$slideshow.data('adapt-height');
        this.$wrapper = this.$slideshow.closest(selectors.wrapper + sectionId);
        this.$section = this.$wrapper.closest(selectors.section);
        this.$controls = this.$wrapper.find(selectors.controls);
        this.$textWrapperMobile = this.$section.find(selectors.textWrapperMobile);
        this.autorotate = this.$slideshow.data('autorotate');
        var autoplaySpeed = this.$slideshow.data('speed');
        var loadSlideA11yString = this.$slideshow.data('slide-nav-a11y');

        this.settings = {
            rtl: theme.rtl,
            accessibility: true,
            arrows: true,
            dots: true,
            fade: (theme.rtl ? false : true),
            draggable: true,
            touchThreshold: 20,
            autoplay: this.autorotate,
            autoplaySpeed: autoplaySpeed
        };

        this.$slideshow.on('beforeChange', beforeChange.bind(this));
        this.$slideshow.on('init', slideshowA11ySetup.bind(this));

        // Add class to style mobile dots & show the correct text content for the
        // first slide on mobile when the slideshow initialises
        this.$slideshow.on(
            'init',
            function() {
                this.$mobileDots
                    .find('li:first-of-type')
                    .addClass(classes.slickActiveMobile);
                this.showMobileText(0);
            }.bind(this)
        );

        if (this.adaptHeight) {
            this.setSlideshowHeight();
            $(window).resize($.debounce(50, this.setSlideshowHeight.bind(this)));
        }

        this.$slideshow.slick(this.settings);

        // This can't be called when the slick 'init' event fires due to how slick
        // adds a11y features.
        slideshowPostInitA11ySetup.bind(this)();
    }

    function slideshowA11ySetup(event, obj) {
        var $slider = obj.$slider;
        var $list = obj.$list;
        this.$dots = this.$section.find(selectors.dots);
        this.$mobileDots = this.$dots.eq(1);

        // Remove default Slick aria-live attr until slider is focused
        $list.removeAttr('aria-live');

        //     this.$wrapper.on('keyup', keyboardNavigation.bind(this));
        //     this.$controls.on('keyup', keyboardNavigation.bind(this));
        //     this.$textWrapperMobile.on('keyup', keyboardNavigation.bind(this));

        // When an element in the slider is focused
        // pause slideshow and set aria-live.
        this.$wrapper
            .on(
                'focusin',
                function(evt) {
                    if (!this.$wrapper.has(evt.target).length) {
                        return;
                    }

                    $list.attr('aria-live', 'polite');
                    if (this.autorotate) {
                        $slider.slick('slickPause');
                    }
                }.bind(this)
            )
            .on(
                'focusout',
                function(evt) {
                    if (!this.$wrapper.has(evt.target).length) {
                        return;
                    }

                    $list.removeAttr('aria-live');
                }.bind(this)
            );

        // Add arrow key support when focused
        if (this.$dots) {
            this.$dots
                .find('a')
                .each(function() {
                    var $dot = $(this);
                    $dot.on('click keyup', function(evt) {
                        if (
                            evt.type === 'keyup' &&
                            evt.which !== slate.utils.keyboardKeys.ENTER
                        )
                            return;

                        evt.preventDefault();

                        var slideNumber = $(evt.target).data('slide-number');

                        $slider.attr('tabindex', -1).slick('slickGoTo', slideNumber);

                        if (evt.type === 'keyup') {
                            $slider.focus();
                        }
                    });
                })
                .eq(0)
                .attr('aria-current', 'true');
        }

        this.$controls
            .on('focusin', highlightControls.bind(this))
            .on('focusout', unhighlightControls.bind(this));
    }

    function slideshowPostInitA11ySetup() {
        var $slides = this.$slideshow.find(selectors.slides);

        $slides.removeAttr('role').removeAttr('aria-labelledby');
        this.$dots
            .removeAttr('role')
            .find('li')
            .removeAttr('role')
            .removeAttr('aria-selected')
            .each(function() {
                var $dot = $(this);
                var ariaControls = $dot.attr('aria-controls');
                $dot
                    .removeAttr('aria-controls')
                    .find('a')
                    .attr('aria-controls', ariaControls);
            });
    }

    function beforeChange(event, slick, currentSlide, nextSlide) {
        var $dotLinks = this.$dots.find('a');
        var $mobileDotLinks = this.$mobileDots.find('li');

        $dotLinks
            .removeAttr('aria-current')
            .eq(nextSlide)
            .attr('aria-current', 'true');

        $mobileDotLinks
            .removeClass(classes.slickActiveMobile)
            .eq(nextSlide)
            .addClass(classes.slickActiveMobile);
        this.showMobileText(nextSlide);
    }

    //   function keyboardNavigation() {
    //     if (event.keyCode === slate.utils.keyboardKeys.LEFTARROW) {
    //       this.$slideshow.slick('slickPrev');
    //     }
    //     if (event.keyCode === slate.utils.keyboardKeys.RIGHTARROW) {
    //       this.$slideshow.slick('slickNext');
    //     }
    //   }

    function highlightControls() {
        this.$controls.addClass(classes.controlsHover);
    }

    function unhighlightControls() {
        this.$controls.removeClass(classes.controlsHover);
    }

    slideshow.prototype.setSlideshowHeight = function() {
        var minAspectRatio = this.$slideshow.data('min-aspect-ratio');
        this.$slideshow.height($(document).width() / minAspectRatio);
    };

    slideshow.prototype.showMobileText = function(slideIndex) {
        var $allTextContent = this.$textWrapperMobile.find(
            selectors.textContentMobile
        );
        var currentTextContentSelector =
            selectors.textContentMobile + '-' + slideIndex;
        var $currentTextContent = this.$textWrapperMobile.find(
            currentTextContentSelector
        );
        if (!$currentTextContent.length &&
            this.$slideshow.find(selectors.slides).length === 1
        ) {
            this.$textWrapperMobile.hide();
        } else {
            this.$textWrapperMobile.show();
        }
        $allTextContent.hide();
        $currentTextContent.show();
    };

    function getSlideshowId($el) {
        return '#Slideshow-' + $el.data('id');
    }

    return slideshow;
})();

theme.slideshows = {};

theme.SlideshowSection = (function() {
    function SlideshowSection(container) {
        var $container = (this.$container = $(container));
        var sectionId = $container.attr('data-section-id');
        var slideshow = (this.slideshow = '#Slideshow-' + sectionId);

        theme.slideshows[slideshow] = new theme.Slideshow(slideshow, sectionId);
    }

    return SlideshowSection;
})();

theme.SlideshowSection.prototype = _.assignIn({},
    theme.SlideshowSection.prototype, {
        onUnload: function() {
            delete theme.slideshows[this.slideshow];
        },

        onBlockSelect: function(evt) {
            var $slideshow = $(this.slideshow);
            var adaptHeight = $slideshow.data('adapt-height');

            if (adaptHeight) {
                theme.slideshows[this.slideshow].setSlideshowHeight();
            }

            // Ignore the cloned version
            var $slide = $(
                '.slideshow__slide--' + evt.detail.blockId + ':not(.slick-cloned)'
            );
            var slideIndex = $slide.data('slick-index');

            // Go to selected slide, pause auto-rotate
            $slideshow.slick('slickGoTo', slideIndex).slick('slickPause');
        },

        onBlockDeselect: function() {
            // Resume auto-rotate
            $(this.slideshow).slick('slickPlay');
        }
    }
);

theme.slideshows = {};

theme.Cart = (function() {
    var selectors = {
        cartNote: '#CartSpecialInstructions',
        cartQtyInput: '.cart__quantity',
        cartNoCookiesClass: 'cart--no-cookies'
    };

    function Cart(container) {
        var $container = (this.$container = $(container));
        var sectionId = $container.attr('data-section-id');

        theme.cartObject = JSON.parse($('#CartJson-' + sectionId).html());

        this.init($container);
    }

    Cart.prototype = _.assignIn({}, Cart.prototype, {
        init: function($container) {
            this._initQtySelector();
            this._initCartNote();

            if (!this._cookiesEnabled()) {
                $container.addClass(selectors.cartNoCookiesClass);
            }
        },

        _initQtySelector: function() {
            $(selectors.cartQtyInput).each(function(i, el) {
                // eslint-disable-next-line no-new
                new QtySelector($(el));
            });
        },

        _initCartNote: function() {
            if (!$(selectors.cartNote).length) {
                return;
            }

            var $el = $(selectors.cartNote);
            var noteText;
            var params;
            var noteOffset = $el[0].offsetHeight - $el[0].clientHeight;

            // Auto grow the cart note if text fills it up
            $el.on('keyup input', function() {
                $(this)
                    .css('height', 'auto')
                    .css('height', $el[0].scrollHeight + noteOffset);
            });

            // Save the cart note via ajax. A safeguard in case
            // a user decides to leave the page before clicking 'Update Cart'
            $el.on(
                'change',
                $.proxy(function() {
                    noteText = $el.val();
                    params = {
                        type: 'POST',
                        url: '/cart/update.js',
                        data: 'note=' + this._attributeToString(noteText),
                        dataType: 'json'
                    };
                    $.ajax(params);
                }, this)
            );
        },

        _attributeToString: function(attr) {
            if (typeof attr !== 'string') {
                attr = String(attr);
                if (attr === 'undefined') {
                    attr = '';
                }
            }
            return $.trim(attr);
        },

        _cookiesEnabled: function() {
            var cookieEnabled = navigator.cookieEnabled;

            if (!cookieEnabled) {
                document.cookie = 'testcookie';
                cookieEnabled = document.cookie.indexOf('testcookie') !== -1;
            }
            return cookieEnabled;
        }
    });

    return Cart;
})();

// Instagrams
theme.Instagrams = (function() {
    function Instagrams(container) {
        this.$container = $(container).on('init', this._a11y.bind(this));
        //console.log(this.$container);
        this.settings = {
            style: this.$container.data('style'),
            accesstoken: this.$container.data('accesstoken'),
            userid: this.$container.data('userid'),
            limit: this.$container.data('limit'),
            resolution: this.$container.data('resolution'),
            target: this.$container.attr('id'),
            rows: this.$container.data('rows'),

            slidesToShow: this.$container.data('slidestoshow') || 1,
            infinite: this.$container.data('infinite') || false,
            arrows: this.$container.data('arrows') || false,
            draggable: this.$container.data('draggable') || false,
            dots: this.$container.data('dots') || false,
        }
        this.settings.slidesToShow1200 = (this.settings.slidesToShow - 1) > 1 ? (this.settings.slidesToShow - 1) : 1;
        this.settings.slidesToShow992 = (this.settings.slidesToShow - 2) > 1 ? (this.settings.slidesToShow - 2) : 1;
        this.settings.slidesToShow768 = (this.settings.slidesToShow - 3) > 1 ? (this.settings.slidesToShow - 3) : 1;
        this.settings.slidesToShow480 = 2;

        var _self = this;
        var $instagramSelector = $('#' + this.settings.target);
        if (this.settings.style === 'grid') {
            var afterInstagram = function() {} // blank function
        } else if (this.settings.style === 'carousel') {
            var afterInstagram = function() {
                $instagramSelector.slick({
                    slidesToShow: _self.settings.slidesToShow,
                    slidesToScroll: _self.settings.slidesToShow,
                    arrows: _self.settings.arrows,
                    dots: _self.settings.dots,
                    draggable: _self.settings.draggable,
                    infinite: _self.settings.infinite,
                    rows: _self.settings.rows,
                    responsive: [{
                            breakpoint: 1200,
                            settings: {
                                slidesToShow: _self.settings.slidesToShow1200,
                                slidesToScroll: _self.settings.slidesToShow1200,
                            }
                        },
                        {
                            breakpoint: 992,
                            settings: {
                                slidesToShow: _self.settings.slidesToShow992,
                                slidesToScroll: _self.settings.slidesToShow992,
                            }
                        },
                        {
                            breakpoint: 768,
                            settings: {
                                slidesToShow: _self.settings.slidesToShow768,
                                slidesToScroll: _self.settings.slidesToShow768,
                            }
                        },
                        {
                            breakpoint: 480,
                            settings: {
                                slidesToShow: _self.settings.slidesToShow480,
                                slidesToScroll: _self.settings.slidesToShow480,
                            }
                        }
                    ]
                })
            }
        }

        var feed = new Instafeed({
            get: 'user',
            target: this.settings.target,
            userId: this.settings.userid,
            accessToken: this.settings.accesstoken,
            limit: this.settings.limit,
            resolution: this.settings.resolution,
            template: '<div class="col hv-image-brightness"><a class="instagram-item" href="{{link}}" target="_blank" id="{{id}}"><img alt="instagram image" class="transition lazyload" data-src="{{image}}" /></a></div>',
            after: afterInstagram
        });

        feed.run();
    }

    Instagrams.prototype = _.assignIn({}, Instagrams.prototype, {
        _a11y: function(event, obj) {
            var $list = obj.$list;
            var $wrapper = this.$container.parent();

            // Remove default Slick aria-live attr until slider is focused
            $list.removeAttr('aria-live');

            // When an element in the slider is focused set aria-live
            $wrapper.on('focusin', function(evt) {
                if ($wrapper.has(evt.target).length) {
                    $list.attr('aria-live', 'polite');
                }
            });

            // Remove aria-live
            $wrapper.on('focusout', function(evt) {
                if ($wrapper.has(evt.target).length) {
                    $list.removeAttr('aria-live');
                }
            });
        }
    });

    return Instagrams;
})();

// Slick carousel
theme.slickCarousel = (function() {
    function Carousels(container) {
        this.$container = $(container).on('init', this._a11y.bind(this));
        this.settings = {
            rows: this.$container.data('rows') || 1,
            slidesToShow: this.$container.data('slidestoshow') || 1,
            slidesToScroll: this.$container.data('slidestoscroll') || 1,
            infinite: this.$container.data('infinite') || false,
            arrows: this.$container.data('arrows') || false,
            dots: this.$container.data('dots') || false,
            autoplay: this.$container.data('autoplay') || false,
            draggable: this.$container.data('draggable') || false,
            accessibility: this.$container.data('accessibility') || true,
        }
        this.settings.slidesToShow1200 = (this.settings.slidesToShow - 1) > 1 ? (this.settings.slidesToShow - 1) : 1;
        this.settings.slidesToShow992 = (this.settings.slidesToShow - 2) > 1 ? (this.settings.slidesToShow - 2) : 1;
        this.settings.slidesToShow768 = (this.settings.slidesToShow - 3) > 1 ? (this.settings.slidesToShow - 3) : 1;
        this.settings.slidesToShow480 = (this.settings.slidesToShow - 4) > 1 ? (this.settings.slidesToShow - 4) : 1;
        this.settings.slidesToScroll1200 = (this.settings.slidesToScroll - 1) > 1 ? (this.settings.slidesToScroll - 1) : 1;
        this.settings.slidesToScroll992 = (this.settings.slidesToScroll - 2) > 1 ? (this.settings.slidesToScroll - 2) : 1;
        this.settings.slidesToScroll768 = (this.settings.slidesToScroll - 3) > 1 ? (this.settings.slidesToScroll - 3) : 1;
        this.settings.slidesToScroll480 = (this.settings.slidesToScroll - 4) > 1 ? (this.settings.slidesToScroll - 4) : 1;
        this.$container.slick({
            rtl: theme.rtl,
            rows: this.settings.rows,
            slidesToShow: this.settings.slidesToShow,
            slidesToScroll: this.settings.slidesToScroll,
            arrows: this.settings.arrows,
            dots: this.settings.dots,
            autoplay: this.settings.autoplay,
            accessibility: this.settings.accessibility,
            draggable: this.settings.draggable,
            infinite: this.settings.infinite,
            adaptiveHeight: true,
            responsive: [{
                    breakpoint: 1200,
                    settings: {
                        slidesToShow: this.settings.slidesToShow1200,
                        slidesToScroll: this.settings.slidesToScroll1200
                    }
                },
                {
                    breakpoint: 992,
                    settings: {
                        slidesToShow: this.settings.slidesToShow992,
                        slidesToScroll: this.settings.slidesToScroll992
                    }
                },
                {
                    breakpoint: 768,
                    settings: {
                        slidesToShow: this.settings.slidesToShow768,
                        slidesToScroll: this.settings.slidesToScroll768
                    }
                },
                {
                    breakpoint: 480,
                    settings: {
                        slidesToShow: 1,
                        slidesToScroll: this.settings.slidesToScroll480
                    }
                }
            ]
        })
    }

    Carousels.prototype = _.assignIn({}, Carousels.prototype, {
        _a11y: function(event, obj) {
            var $list = obj.$list;
            var $wrapper = this.$container.parent();

            // Remove default Slick aria-live attr until slider is focused
            $list.removeAttr('aria-live');

            // When an element in the slider is focused set aria-live
            $wrapper.on('focusin', function(evt) {
                if ($wrapper.has(evt.target).length) {
                    $list.attr('aria-live', 'polite');
                }
            });

            // Remove aria-live
            $wrapper.on('focusout', function(evt) {
                if ($wrapper.has(evt.target).length) {
                    $list.removeAttr('aria-live');
                }
            });
        },

        _goToSlide: function(slideIndex) {
            this.$container.slick('slickGoTo', slideIndex);
        },

        onUnload: function() {
            delete this.$container;
        },

        onBlockSelect: function(evt) {
            // Ignore the cloned version
            var $slide = $(
                '.carousel__slide-wrapper--' + evt.detail.blockId + ':not(.slick-cloned)'
            );
            var slideIndex = $slide.data('slick-index');

            // Go to selected slide, pause autoplay
            this._goToSlide(slideIndex);

        }
    });

    return Carousels;
})()

// Productlists
theme.Productlists = (function() {
    function Productlists(container) {
        this.$container = $(container).on('init', this._a11y.bind(this));
        this.settings = {
            slidesToShow: this.$container.data('slidestoshow') || 1,
            rows: this.$container.data('rows') || 1,
            arrows: this.$container.data('arrows') || false,
            dots: this.$container.data('dots') || false,
            draggable: this.$container.data('draggable') || false,
            infinite: this.$container.data('infinite') || false,
        }
        this.settings.slidesToShow1200 = (this.settings.slidesToShow - 1) > 1 ? (this.settings.slidesToShow - 1) : 1;
        this.settings.slidesToShow992 = (this.settings.slidesToShow - 2) > 1 ? (this.settings.slidesToShow - 2) : 1;
        this.settings.slidesToShow768 = (this.settings.slidesToShow - 3) > 1 ? (this.settings.slidesToShow - 3) : 1;
        this.settings.slidesToShow480 = 2;
        this.$container.slick({
            rtl: theme.rtl,
            accessibility: true,
            slidesToShow: this.settings.slidesToShow,
            slidesToScroll: this.settings.slidesToShow,
            rows: this.settings.rows,
            arrows: this.settings.arrows,
            dots: this.settings.dots,
            infinite: this.settings.infinite,
            draggable: this.settings.draggable,
            responsive: [{
                    breakpoint: 1200,
                    settings: {
                        slidesToShow: this.settings.slidesToShow1200,
                        slidesToScroll: this.settings.slidesToShow1200
                    }
                },
                {
                    breakpoint: 992,
                    settings: {
                        slidesToShow: this.settings.slidesToShow992,
                        slidesToScroll: this.settings.slidesToShow992
                    }
                },
                {
                    breakpoint: 768,
                    settings: {
                        slidesToShow: this.settings.slidesToShow768,
                        slidesToScroll: this.settings.slidesToShow768
                    }
                },
                {
                    breakpoint: 480,
                    settings: {
                        slidesToShow: this.settings.slidesToShow480,
                        slidesToScroll: this.settings.slidesToShow480
                    }
                }
            ]
        }).css('opacity', '1');
    }

    Productlists.prototype = _.assignIn({}, Productlists.prototype, {
        _a11y: function(event, obj) {
            var $list = obj.$list;
            var $wrapper = this.$container.parent();

            // Remove default Slick aria-live attr until slider is focused
            $list.removeAttr('aria-live');

            // When an element in the slider is focused set aria-live
            $wrapper.on('focusin', function(evt) {
                if ($wrapper.has(evt.target).length) {
                    $list.attr('aria-live', 'polite');
                }
            });

            // Remove aria-live
            $wrapper.on('focusout', function(evt) {
                if ($wrapper.has(evt.target).length) {
                    $list.removeAttr('aria-live');
                }
            });
        },

        _goToSlide: function(slideIndex) {
            this.$container.slick('slickGoTo', slideIndex);
        },

        onUnload: function() {
            delete this.$container;
        }
    });

    return Productlists;
})();

// Producttabs
theme.Producttabs = (function() {
    function Producttabs(container) {
        var _self = this; // avoid conflict
        this.$container = $(container).on('init', this._a11y.bind(this));
        this.slickWrap = '.prdtab-content';
        this.settings = {
            slidesToShow: this.$container.data('slidestoshow') || 1,
            arrows: this.$container.data('arrows') || false,
            rows: this.$container.data('rows') || 1,
            dots: this.$container.data('dots') || false,
            draggable: this.$container.data('draggable') || false,
            infinite: this.$container.data('infinite') || false,
        }
        this.settings.slidesToShow1200 = (this.settings.slidesToShow - 1) > 1 ? (this.settings.slidesToShow - 1) : 1;
        this.settings.slidesToShow992 = (this.settings.slidesToShow - 2) > 1 ? (this.settings.slidesToShow - 2) : 1;
        this.settings.slidesToShow768 = (this.settings.slidesToShow - 3) > 1 ? (this.settings.slidesToShow - 3) : 1;
        this.settings.slidesToShow480 = 2;

        this._initSlick();
        this.$container.find('a[data-toggle="tab"]').on("shown.bs.tab", function(e) {
            _self._unSlick();
            _self._initSlick();
            theme.tooltip.load();
        })
    }

    Producttabs.prototype = _.assignIn({}, Producttabs.prototype, {
        _a11y: function(event, obj) {
            var $list = obj.$list;
            var $wrapper = this.$container.parent();

            // Remove default Slick aria-live attr until slider is focused
            $list.removeAttr('aria-live');

            // When an element in the slider is focused set aria-live
            $wrapper.on('focusin', function(evt) {
                if ($wrapper.has(evt.target).length) {
                    $list.attr('aria-live', 'polite');
                }
            });

            // Remove aria-live
            $wrapper.on('focusout', function(evt) {
                if ($wrapper.has(evt.target).length) {
                    $list.removeAttr('aria-live');
                }
            });
        },

        _getSliderSettings: function() {
            return {
                rtl: theme.rtl,
                accessibility: true,
                slidesToShow: this.settings.slidesToShow,
                slidesToScroll: this.settings.slidesToShow,
                arrows: this.settings.arrows,
                rows: this.settings.rows,
                dots: this.settings.dots,
                infinite: this.settings.infinite,
                draggable: this.settings.draggable,
                responsive: [{
                        breakpoint: 1200,
                        settings: {
                            slidesToShow: this.settings.slidesToShow1200,
                            slidesToScroll: this.settings.slidesToShow1200
                        }
                    },
                    {
                        breakpoint: 992,
                        settings: {
                            slidesToShow: this.settings.slidesToShow992,
                            slidesToScroll: this.settings.slidesToShow992
                        }
                    },
                    {
                        breakpoint: 768,
                        settings: {
                            slidesToShow: this.settings.slidesToShow768,
                            slidesToScroll: this.settings.slidesToShow768
                        }
                    },
                    {
                        breakpoint: 480,
                        settings: {
                            slidesToShow: this.settings.slidesToShow480,
                            slidesToScroll: this.settings.slidesToShow480
                        }
                    }
                ]
            }
        },

        _initSlick: function() {
            this.$container.find(this.slickWrap).slick(this._getSliderSettings()).css('opacity', '1');
        },

        _unSlick: function() {
            this.$container.find(this.slickWrap).slick('unslick');
        },

        onUnload: function() {
            delete this.$container;
        },

        onSelect: function() {
            this._unSlick();
            this._initSlick();
        },

        onBlockSelect: function(evt) {
            var navItem = $('.nav-link-' + evt.detail.blockId);
            navItem.tab('show');
            this._unSlick();
            this._initSlick();
        }
    });

    return Producttabs;
})();

theme.Video = (function() {
    var promiseYoutubeAPI;
    var promiseVimeoAPI;

    var youtube = {
        promiseAPI: function() {
            if (!promiseYoutubeAPI) {
                var tag = document.createElement('script');

                tag.src = 'https://www.youtube.com/iframe_api';
                var firstScriptTag = document.getElementsByTagName('script')[0];
                firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

                promiseYoutubeAPI = $.Deferred(function(defer) {
                    window.onYouTubeIframeAPIReady = defer.resolve;

                    setTimeout(function() {
                        defer.reject('Request for YouTube API timed out after 30 seconds.');
                    }, 30000);
                });
            }

            return promiseYoutubeAPI;
        },
        promisePlayer: function(id, options) {
            return this.promiseAPI().then(function() {
                return $.Deferred(function(defer) {
                    if (typeof window.YT === 'undefined') {
                        defer.reject(
                            "We're sorry, something went wrong. The YouTube API has not loaded correctly."
                        );
                    }

                    /* eslint-disable no-undef */
                    var player = new YT.Player(id, options); // global YT variable injected by YouTube API

                    player.addEventListener('onReady', function() {
                        defer.resolve(player);
                    });

                    setTimeout(function() {
                        defer.reject(
                            'Request for YouTube player has timed out after 30 seconds.'
                        );
                    }, 30000);
                });
            });
        }
    };

    var vimeo = {
        promiseAPI: function() {
            if (!promiseVimeoAPI) {
                promiseVimeoAPI = $.Deferred(function(defer) {
                    var tag = document.createElement('script');
                    tag.src = 'https://player.vimeo.com/api/player.js';
                    tag.onload = tag.onreadystatechange = function() {
                        if (!this.readyState || this.readyState === 'complete') {
                            defer.resolve();
                        }
                    };

                    var firstScriptTag = document.getElementsByTagName('script')[0];
                    firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

                    setTimeout(function() {
                        defer.reject('Request for Vimeo API timed out after 30 seconds.');
                    }, 30000);
                });
            }

            return promiseVimeoAPI;
        },

        promisePlayer: function(id, options) {
            return this.promiseAPI().then(function() {
                return $.Deferred(function(defer) {
                    if (typeof window.Vimeo === 'undefined') {
                        defer.reject(
                            "We're sorry, something went wrong. The Vimeo API has not loaded correctly."
                        );
                    }

                    var player = new window.Vimeo.Player(id, options);

                    setTimeout(function() {
                        defer.reject(
                            'Request for Vimeo player has timed out after 30 seconds.'
                        );
                    }, 30000);

                    player.ready().then(function() {
                        defer.resolve(player);
                    });
                });
            });
        }
    };

    var selectors = {
        loadPlayerButton: '.video-section__load-player-button',
        closePlayerButton: '.video-section__player-close',
        playerContainer: '.video-section__player',
        cover: '.video-section__cover',
        errorMessage: '.video-section__error',
        bodyOverlay: '.video-section__body-overlay',
        body: 'body'
    };
    var classes = {
        playerLoading: 'video-section--loading',
        playerLoaded: 'video-section--loaded',
        playerError: 'video-section--error',
        videoPlaying: 'video-playing'
    };

    function Video(container) {
        this.$container = $(container);
        var sectionId = this.$container.attr('data-section-id');
        this.namespace = '.' + sectionId;
        this.onLoad();
    }

    Video.prototype = _.assignIn({}, Video.prototype, {
        onLoad: function() {
            this.$container
                .on('click', selectors.loadPlayerButton, this._loadPlayer.bind(this))
                .on('click', selectors.closePlayerButton, this._closePlayer.bind(this))
                .on('click', selectors.bodyOverlay, this._closePlayer.bind(this));
        },

        _loadPlayer: function() {
            var $container = this.$container;
            var $playerContainer = $(selectors.playerContainer, $container);
            var playerType = this.$container.attr('data-video-type');

            var promiseVideoPlayer;

            if (playerType === 'youtube') {
                promiseVideoPlayer = this._loadYoutubePlayer($playerContainer[0]);
            } else if (playerType === 'vimeo') {
                promiseVideoPlayer = this._loadVimeoPlayer($playerContainer[0]);
            }

            return promiseVideoPlayer
                .then(this._onPlayerLoadReady.bind(this))
                .fail(this._onPlayerLoadError.bind(this));
        },

        _loadYoutubePlayer: function(container) {
            return youtube
                .promisePlayer(container, {
                    videoId: this.$container.attr('data-video-id'),
                    ratio: 16 / 9,
                    playerVars: {
                        modestbranding: 1,
                        autoplay: 1,
                        showinfo: 0,
                        rel: 0
                    }
                })
                .then(
                    function(player) {
                        this.player = player;
                    }.bind(this)
                );
        },

        _loadVimeoPlayer: function(container) {
            return vimeo
                .promisePlayer(container, {
                    id: this.$container.attr('data-video-id')
                })
                .then(
                    function(player) {
                        this.player = player;
                        this.player.play();
                    }.bind(this)
                );
        },

        _onPlayerLoadReady: function() {
            $(selectors.closePlayerButton, this.$container)
                .show()
                .focus();
            $(selectors.cover, this.$container).addClass(classes.playerLoaded);
            this.$container.addClass(classes.playerLoaded);

            this._setScrollPositionValues();

            $(selectors.body).addClass(classes.videoPlaying);

            $(document).on('keyup' + this.namespace, this._closeOnEscape.bind(this));
            $(window).on(
                'resize' + this.namespace,
                this._setScrollPositionValues.bind(this)
            );
            slate.a11y.trapFocus({
                $container: this.$container,
                namespace: this.namespace
            });
        },

        _onPlayerLoadError: function(err) {
            this.$container.addClass(classes.playerError);
            $(selectors.errorMessage, this.$container).text(err);
        },

        _closeOnEscape: function(evt) {
            if (evt.keyCode !== 27) {
                return;
            }

            this._closePlayer();
            $(selectors.loadPlayerButton, this.$container).focus();
        },

        _onScroll: function() {
            var scrollTop = $(window).scrollTop();

            if (
                scrollTop > this.videoTop + 0.25 * this.videoHeight ||
                scrollTop + this.windowHeight <
                this.videoBottom - 0.25 * this.videoHeight
            ) {
                // Debounce DOM edits to the next frame with requestAnimationFrame
                requestAnimationFrame(this._closePlayer.bind(this));
            }
        },

        _setScrollPositionValues: function() {
            this.videoHeight = this.$container.outerHeight(true);
            this.videoTop = this.$container.offset().top;
            this.videoBottom = this.videoTop + this.videoHeight;
            this.windowHeight = $(window).innerHeight();
        },

        _closePlayer: function() {
            $(selectors.body).removeClass(classes.videoPlaying);
            $(selectors.cover, this.$container).removeClass(classes.playerLoaded);
            this.$container.removeClass(classes.playerLoaded);
            $(selectors.closePlayerButton, this.$container).hide();

            slate.a11y.removeTrapFocus({
                $container: this.$container,
                namespace: this.namespace
            });

            if (typeof this.player.destroy === 'function') {
                this.player.destroy();
            } else if (typeof this.player.unload === 'function') {
                this.player.unload();
            }

            $(document).off(this.namespace);
            $(window).off(this.namespace);
        }
    });

    return Video;
})();

theme.CollectionsList = (function() {
    function CollectionsList(container) {
        var $container = (this.$container = $(container));
        var stretchImage = $container.is('[data-stretch-image]');

        // Early return if 'secondary image layout' is enabled
        if (stretchImage) return;

        var namespace = (this.namespace = '.' + $container.attr('data-section-id'));
        var self = this;

        self._collectionListFix();
        $(window).on(
            'resize' + namespace,
            $.debounce(250, function() {
                self._collectionListFix();
            })
        );
    }

    CollectionsList.prototype = _.assignIn({}, CollectionsList.prototype, {
        onUnload: function() {
            $(window).off(this.namespace);
        },

        _collectionListFix: function() {
            var numberRows = this.$container.find('.grid').data('number-rows');
            var $featureCards = this.$container.find('.featured-card');

            // We can exit if 'Use secondary image layout' is enabled
            if ($featureCards.is('[data-stretch-image]')) return;

            // Go through each of the rows
            for (var i = 0; i < numberRows; i++) {
                var maxWrapperHeight = 0;
                var maxHeaderHeight = 0;
                var $currentRow = $featureCards.filter(
                    "[data-row-number='" + (i + 1) + "']"
                );
                var $cardHeaders = $currentRow.find('.featured-card__header');

                // Find the max heights for each row
                $currentRow.each(function() {
                    var $cardTitle = $(this).find('.featured-card__title');
                    var $cardAction = $(this).find('.featured-card__action');
                    var $cardImageWrapper = $(this).find('.featured-card__image-wrapper');
                    var headerHeight =
                        $cardTitle.outerHeight() + $cardAction.outerHeight() + 65;
                    var wrapperHeight = $cardImageWrapper.outerHeight();
                    if (headerHeight > maxHeaderHeight) {
                        maxHeaderHeight = headerHeight;
                    }
                    if (wrapperHeight > maxWrapperHeight) {
                        maxWrapperHeight = wrapperHeight;
                    }
                });

                // Set the heights of the headers and cards for this row with padding
                $cardHeaders.outerHeight(maxHeaderHeight);
                $currentRow.height(maxWrapperHeight + maxHeaderHeight + 40);
            }
        }
    });

    return CollectionsList;
})();

theme.ParrallaxImage = (function() {
    function ParrallaxImage(container) {
        this.container = container;
        this.sectionId = $(container).attr('data-section-id');
        this.namespace = 'parallax-' + this.sectionId;
        var images = document.getElementsByClassName('thumbnail' + this.sectionId);
        new simpleParallax(images, {
            scale: 1.5,
            delay: .6,
        });
    }

    ParrallaxImage.prototype = $.extend({}, ParrallaxImage.prototype, {
        onUnload: function(evt) {
            var instance = new simpleParallax(images);
            instance.destroy();
            delete theme.ParrallaxImage[this.namespace];
        }
    });

    return ParrallaxImage;
})();

theme.init = function() {
    theme.customerTemplates.init();
    slate.rte.wrapTable();
    slate.rte.iframeReset();

    // Common a11y fixes
    slate.a11y.pageLinkFocus($(window.location.hash));

    $('.in-page-link').on('click', function(evt) {
        slate.a11y.pageLinkFocus($(evt.currentTarget.hash));
    });

    $('a[href="#"]').on('click', function(evt) {
        evt.preventDefault();
    });


    //scroll animation
    AOS.init({
        startEvent: 'DOMContentLoaded',
        offset: 30, // offset (in px) from the original trigger point
        delay: 0, // values from 0 to 3000, with step 50ms
        duration: 1000,
        once: true
    });
    window.addEventListener('load', function() {
        AOS.refresh();
    });


    // Sections
    var sections = new theme.Sections();
    sections.register('header', theme.HeaderSection);
    sections.register('product', theme.Product);
    sections.register('slideshow-section', theme.SlideshowSection);
    sections.register('cart', theme.Cart);
    sections.register('instagrams', theme.Instagrams);
    sections.register('masonries', theme.Masonry);
    sections.register('productlist', theme.Productlists);
    sections.register('producttab', theme.Producttabs);
    sections.register('slickCarousels', theme.slickCarousel);
    sections.register('video', theme.Video);
    sections.register('collections-list', theme.CollectionsList);
    sections.register('parallax-image', theme.ParrallaxImage);
    sections.register('bgcollection', theme.Bgcollection);

    // Standalone modules
    $(window).on('load', theme.articleImages);
    theme.passwordModalInit();
};

theme.articleImages = function() {
    var $indentedRteImages = $('.rte--indented-images');
    if (!$indentedRteImages.length) {
        return;
    }

    $indentedRteImages.find('img').each(function(i, el) {
        var $el = $(el);
        var attr = $el.attr('style');

        // Check if undefined or float: none
        if (!attr || attr === 'float: none;') {
            // Add class to parent paragraph tag if image is wider than container
            if ($el.width() >= $indentedRteImages.width()) {
                $el.parent('p').addClass('rte__image-indent');
            }
        }
    });
};

theme.passwordModalInit = function() {
    var $loginModal = $('#LoginModal');
    if (!$loginModal.length) {
        return;
    }

    // Initialize modal
    theme.PasswordModal = new window.Modals('LoginModal', 'login-modal', {
        focusOnOpen: '#Password'
    });

    // Open modal if errors exist
    if ($loginModal.find('.errors').length) {
        theme.PasswordModal.open();
    }
};

// CSS var ponyfill
theme.cssVar = (function() {
    cssVars();
})()

// Ajax search https://gist.github.com/awojtczyk/53d74c8af5f893841f33979b0cdcd6fe
theme.ajaxSearch = (function() {
    var $inputSearch = '.js-ajaxsearch',
        $resultsList = '.search-results',
        $input = $($inputSearch).find('input[name="q"]'),
        $currentAjaxRequest,
        $displayProducts = 6;

    $($inputSearch).css('position', 'relative').each(function() {
        $input.attr('autocomplete', 'off').bind('keyup change', function() {
            var term = $(this).val(),
                form = $(this).closest('form'),
                searchURL = '/search?type=product&q=*' + term + '*';
            if (term.length > 2 && term !== $(this).attr('data-old-term')) {
                $(this).attr('data-old-term', term);
                if ($currentAjaxRequest !== undefined) $currentAjaxRequest.abort();
                $currentAjaxRequest = $.getJSON(searchURL + '&view=json', function(data) {
                    $($resultsList).empty();

                    if (data.results_count === 0) {
                        $($resultsList).html('<p class="text-center">' + theme.strings.ajaxSearchNoResult + '</p>')
                    } else {
                        $.each(data.results, function(index, item) {
                            if (index < $displayProducts) {
                                var itemPrice = theme.Currency.formatMoney(item.price, theme.moneyFormat);
                                var link = $('<a class="d-inline-flex ' + index + '"></a>')
                                    .attr('href', item.url)
                                    .append('<span class="image"><img src="' + item.thumbnail + '" /></span>')
                                    .append('<div class="meta"><p class="title">' + item.title + '</p>' + itemPrice + '</div>')
                                    .wrap('<div class="ajax-search-item"></div>');
                                $($resultsList).append(link.parent());
                                theme.updateCurrencies();
                            }
                        });
                        if (data.results_count > $displayProducts) {
                            $($resultsList).append('<a class="btn btn--full" href="' + searchURL + '">' + theme.strings.ajaxSearchViewAll + ' (' + data.results_count + ')</a>');
                        }
                    }
                    $($resultsList).addClass('active').fadeIn(200);
                });
            }
        });
    });

    //escape when click somethings
    $(document).click(function(event) {
        var target = event.target;
        if (!$(target).is($inputSearch) && !$(target).parents().is($inputSearch)) {
            $($resultsList).slideUp(300);
        }
    });
})();

// Quickview https://github.com/kellyvaughn/quickview-for-shopify/blob/master/quickview.js.liquid
theme.quickview = (function() {
    var product_handle = '',
        quickviewButtonClass = '.js-btn-quickview',
        quickviewId = '#jsQuickview',
        quickviewOption = '#jsQuickview select',
        quickviewThumb = '#qv-product-images',
        quickviewAddCartButton = '.qv-add-button',
        quickviewPrice = '.qv-product-price',
        quickviewComparePrice = '.qv-product-compare-price';

    // 1. Show quickview
    $(document).on('click', quickviewButtonClass, function() {
        var quickviewAvaible = $(this).attr("data-pavailable");
        product_handle = $(this).data('handle');
        //ResetQuickview
        $(quickviewId).removeClass().addClass('modal fade');
        $(quickviewThumb).removeClass().empty();
        $('.qv-product-options').empty();

        //Pushdata
        $(quickviewId).addClass(product_handle).data('handle', product_handle);
        jQuery.getJSON('/products/' + product_handle + '.js', function(product) {
            var title = product.title;
            var type = product.type;
            var vendor = product.vendor;
            var price = 0;
            var compare_price = 0;
            var desc = product.description.slice(0, 90);
            var images = product.images;
            var variants = product.variants;
            var options = product.options;
            var url = '/products/' + product_handle;
            $('.qv-product-title').text(title);
            $('.qv-product-type').text(type);
            $('.qv-product-description').html(desc);
            $('.qv-view-product').attr('href', url);
            $('.qv-view-type').text(type);
            $('.qv-view-vendor').text(vendor)
            if (quickviewAvaible == 'true') {
                $(quickviewAddCartButton).prop('disabled', false).html(theme.strings.addToCart);
            } else {
                $(quickviewAddCartButton).prop('disabled', true).html(theme.strings.soldOut);
            }
            $(product.variants).each(function(i, variants) {
                if (variants.sku != null) {
                    $('.qv-sku').addClass("show").removeClass("hide");
                    $('.qv-view-sku').text(product.variants[0].sku);
                } else {
                    $('.qv-sku').addClass("hide").removeClass("show");
                }

            });
            var imageCount = $(images).length;
            $(images).each(function(i, image) {
                image_embed = '<div><img src="' + image + '"></div>';
                image_embed = image_embed.replace('.jpg', '_800x.jpg').replace('.png', '_800x.png');
                $(quickviewThumb).append(image_embed);
            });
            $(quickviewThumb).slick({
                rtl: theme.rtl,
                'dots': true,
                'arrows': true,
                'respondTo': 'min',
                'useTransform': true
            }).css('opacity', '1');

            if (product.variants[0].option1 !== "Default Title") {
                $(options).each(function(i, option) {
                    var name = option.name;
                    var opt = name.replace(/ /g, '-').toLowerCase();
                    var selectClass = '.option.' + opt;
                    $('.qv-product-options').append('<div class="option-selection ' + opt + '"><span class="option text-uppercase font-weight-bold text-body">' + option.name + '</span><select class="option-' + i + ' option ' + opt + '"></select></div>');
                    $(option.values).each(function(i, value) {
                        $('.option.' + opt).append($('<option>', {
                            value: value,
                            text: value
                        }));
                    });
                });
            }
            $(product.variants).each(function(i, v) {
                if (v.inventory_quantity == 0) {
                    return true
                } else {
                    price = theme.Currency.formatMoney(v.price, theme.moneyFormat);
                    compare_price = theme.Currency.formatMoney(v.compare_at_price, theme.moneyFormat);
                    $(quickviewPrice).html(price);
                    if (v.compare_at_price !== null) {
                        $(quickviewComparePrice).html(compare_price).show();
                    } else {
                        $(quickviewComparePrice).hide();
                    }
                    theme.updateCurrencies();
                    $('select.option-0').val(v.option1);
                    $('select.option-1').val(v.option2);
                    $('select.option-2').val(v.option3);
                    return false
                }
            });
        });
        //addCartQuickview
    });
    // 2. Add to cart
    $(document).on('click', quickviewAddCartButton, function() {
        product_handle = $(quickviewId).data('handle');
        var qty = $('.qv-quantity').val(),
            selectedOptions = '',
            var_id = '';

        function processCart() {
            jQuery.post('/cart/add.js', {
                    quantity: qty,
                    id: var_id
                }, null, "json").done(function(item) {
                    var htmlVariant = item.variant_title !== null ? '<i>(' + item.variant_title + ')</i>' : '';
                    var styleCart = $('.js-mini-cart').attr("data-cartmini");
                    if (styleCart != 'true') {
                        var htmlAlert = '<div class="media mt-2 alert--cart"><a class="mr-3" href="/cart"><img class="lazyload" data-src="' + item.image + '"></a><div class="media-body align-self-center"><p class="m-0 font-weight-bold">' + item.product_title + ' x ' + item.quantity + '</p>' + htmlVariant + '<div><div>';
                        theme.alert.new(theme.strings.addToCartSuccess, htmlAlert, 3000, 'notice');
                    }
                    theme.miniCart.updateElements();
                    theme.miniCart.generateCart();
                })
                .fail(function($xhr) {
                    var data = $xhr.responseJSON;
                    theme.alert.new('', data.description, 3000, 'warning');
                });
        }
        $(quickviewOption).each(function(i) {
            if (selectedOptions == '') {
                selectedOptions = $(this).val();
            } else {
                selectedOptions = selectedOptions + ' / ' + $(this).val();
            }
        });
        jQuery.getJSON('/products/' + product_handle + '.js', function(product) {
            if (product.variants.length === 1) {
                var_id = product.variants[0].id;
            } else {
                $(product.variants).each(function(i, v) {
                    if (v.title == selectedOptions) {
                        var_id = v.id;
                    }
                });
            }
            processCart();
        });
    });
    // 3. Select variants
    $(document).on('change', quickviewOption, function() {
        var selectedOptions = '';
        $(quickviewOption).each(function(i) {
            if (selectedOptions == '') {
                selectedOptions = $(this).val();
            } else {
                selectedOptions = selectedOptions + ' / ' + $(this).val();
            }
        });
        jQuery.getJSON('/products/' + product_handle + '.js', function(product) {
            $(product.variants).each(function(i, v) {
                if (v.title == selectedOptions) {
                    if (v.featured_image !== null) {
                        var iSlick = v.featured_image.position - 1;
                        $(quickviewThumb).slick('slickGoTo', iSlick);
                    }
                    var price = theme.Currency.formatMoney(v.price, theme.moneyFormat);
                    var compare_price = theme.Currency.formatMoney(v.compare_at_price, theme.moneyFormat);
                    $(quickviewPrice).html(price);
                    $(quickviewComparePrice).html(compare_price);
                    if (v.sku != null) {
                        $('.qv-sku').addClass("show").removeClass("hide");
                        $('.qv-view-sku').text(v.sku);
                    } else {
                        $('.qv-sku').addClass("hide").removeClass("show");
                    }
                    if (v.compare_at_price !== null) {
                        $(quickviewComparePrice).html(compare_price).show();
                    } else {
                        $(quickviewComparePrice).hide();
                    }
                    theme.updateCurrencies();
                    if (v.inventory_management === null) {
                        $(quickviewAddCartButton).prop('disabled', false).val(theme.strings.addToCart);
                    } else {
                        if (v.inventory_quantity < 1) {
                            $(quickviewAddCartButton).prop('disabled', true).val(theme.strings.soldOut);
                        } else {
                            $(quickviewAddCartButton).prop('disabled', false).val(theme.strings.addToCart);
                        }
                    }
                }
            });
        });
    });
})()

//Button add to cart (in grid item)
theme.addCartButton = (function() {
    var buttonClass = '.js-grid-cart';
    $(document).on('click', buttonClass, function() {
        var $this = $(this);
        var id = $this.data('id');
        $this.addClass('is-loading');
        Shopify.addItem(id, 1, function(item) {
            location.href = "/cart";
            var htmlVariant = item.variant_title !== null ? '<i>(' + item.variant_title + ')</i>' : '';
            var styleCart = $('.js-mini-cart').attr("data-cartmini");
            if (styleCart != 'true') {
                var htmlAlert = '<div class="media mt-2 alert--cart"><a class="mr-3" href="/cart"><img class="lazyload" data-src="' + item.image + '"></a><div class="media-body align-self-center"><p class="m-0 font-weight-bold">' + item.product_title + ' x ' + item.quantity + '</p>' + htmlVariant + '<div><div>';
            }
            theme.miniCart.updateElements();
            theme.miniCart.generateCart();
            setTimeout(function() {
                styleCart != 'true' ? theme.alert.new(theme.strings.addToCartSuccess, htmlAlert, 3000, 'notice') : '';
                $this.removeClass('is-loading');
            }, 1000);
        });
    })
})()

// Button add to cart (in grid item)
//theme.addCartButton = (function(){
//  var buttonClass = '.js-grid-cart';
//  $(document).on('click',buttonClass,function(){
//    var $this = $(this);
//    var id = $this.data('id');
//    $this.addClass('is-loading');
//    Shopify.addItem(id,1,function(item){
//      var htmlVariant = item.variant_title !== null ? '<i>('+item.variant_title+')</i>' : '';
//      var styleCart = $('.js-mini-cart').attr("data-cartmini");
//        if(styleCart != 'true'){
//          var htmlAlert = '<div class="media mt-2 alert--cart"><a class="mr-3" href="/cart"><img class="lazyload" data-src="'+item.image+'"></a><div class="media-body align-self-center"><p class="m-0 font-weight-bold">'+item.product_title+' x '+ item.quantity +'</p>'+htmlVariant+'<div><div>';
//        }
//      theme.miniCart.updateElements();
//      theme.miniCart.generateCart();
//      setTimeout(function() {
//        styleCart != 'true' ? theme.alert.new(theme.strings.addToCartSuccess,htmlAlert,3000,'notice'): '';
//        $this.removeClass('is-loading');
//      }, 1000);
//    });
// })
//})()

// Multi currencies 
if (theme.enableCurrencies) {
    // Can be 'money_format' or 'money_with_currency_format'
    Currency.format = 'money_format';
    var shopCurrency = Shopify.currency.active;
    var cookieCurrency = Currency.cookie.read();
    // Fix for customer account pages 
    jQuery('span.money span.money').each(function() {
        jQuery(this).parent('span.money').removeClass('money');
    });
    // Add precalculated shop currency to data attribute 
    jQuery('span.money').each(function() {
        jQuery(this).attr('data-currency-' + Shopify.currency.active, jQuery(this).html());
    });
    // Select all your currencies buttons.
    var buttons = jQuery('#currencies a'),
        currentCurrencies = jQuery('.pre-currencies');
    // When the page loads.
    if (cookieCurrency == null || cookieCurrency == shopCurrency) {
        Currency.currentCurrency = shopCurrency;
    } else {
        Currency.currentCurrency = cookieCurrency;
        Currency.convertAll(shopCurrency, cookieCurrency);
        buttons.removeClass('selected');
        jQuery('#currencies a[data-currency=' + cookieCurrency + ']').addClass('selected');
        var htmlCurrently = jQuery('#currencies a[data-currency=' + cookieCurrency + ']').html();
        currentCurrencies.html(htmlCurrently);
    }
    buttons.click(function() {
        buttons.removeClass('selected');
        jQuery(this).addClass('selected');
        var newCurrency = jQuery(this).attr('data-currency');
        var htmlCurrently = jQuery(this).html();
        currentCurrencies.html(htmlCurrently);
        Currency.convertAll(Currency.currentCurrency, newCurrency);
    });
    // For product options.
    var original_selectCallback = window.selectCallback;
    var selectCallback = function(variant, selector) {
        original_selectCallback(variant, selector);
        Currency.convertAll(shopCurrency, jQuery('#currencies a.selected').attr('data-currency'));
    };
}
theme.updateCurrencies = function() {
    Currency.convertAll(shopCurrency, jQuery('#currencies a.selected').attr('data-currency'));
}



// Free shipping
theme.freeShipping = (function() {
    var $freeShippingClass = $('.js-free-shipping'),
        $freeShippingTextClass = $('.js-free-shipping-text'),
        $free_fisrt = $freeShippingClass.attr('data-start'),
        $free_end = $freeShippingClass.attr('data-end')
    minOrderValue = parseInt($freeShippingClass.data('value')) || 0,
        $percentClass = $('.js-free-shipping .progress-bar');

    function generate(cart) {
        var priceCart = cart.total_price;
        if (priceCart >= minOrderValue) {
            $percentClass.css('width', '100%').removeClass('progress-bar-striped bg-primary');
            $freeShippingTextClass.text(theme.strings.freeShipping)
        } else {
            let percent = priceCart / minOrderValue * 100;
            let left = Shopify.formatMoney((minOrderValue - priceCart), theme.moneyFormat);
            $percentClass.css('width', percent + '%').addClass('progress-bar-striped primary');
            $freeShippingTextClass.html($free_fisrt + ' ' + left + ' ' + $free_end);
            theme.updateCurrencies();
        }
    }

    Shopify.getCart(function(cart) {
        generate(cart);
    });

    return {
        load: generate
    }
})()

// Shipping time - https://github.com/phstc/jquery-dateFormat
theme.shippingTime = (function() {
    var $shippingTime = $('.js-shipping-time'),
        shippingTime = $shippingTime.data('time') || '',
        now = new Date(),
        restHour = 23 - now.getHours(),
        restMinute = 59 - now.getMinutes();
    if (shippingTime !== '') {
        var nextTime = new Date(now.getTime() + shippingTime * 86400000),
            formatTime = $.format.date(nextTime, "ddd, dd MMMM yyyy"),
            htmlShipping = 'Order in the next <b>' + restHour + '</b> hours <b>' + restMinute + '</b> minutes to get it by <b>' + formatTime + '</b>. ';
        $shippingTime.html(htmlShipping);
    }
})()

// Infinite scroll - https://github.com/Elkfox/Ajaxinate/blob/master/dist/ajaxinate.min.js
theme.infiniteScroll = (function() {
    function initInfiniteScroll() {
        if ($('.AjaxinateLoop').length === 0) {
            return;
        } else {
            var endlessScroll = new Ajaxinate({
                loadingText: '<div class="text-center"><div class="' + theme.loadingClass + '" role="status"></div></div>',
                callback: function() {
                    theme.wishlist.load();
                    theme.compare.load();
                    theme.countdown.load();
                    theme.priceRange.load();
                    theme.tooltip.load();
                    theme.collectionView.triggerView();
                    theme.swatchCard2.load();
                }
            });
        }
    }

    // Infinite scroll in other page (blog, list-collection)
    function initOtherPages() {
        var otherPages = new Ajaxinate({
            loadingText: '<div class="text-center"><div class="' + theme.loadingClass + '" role="status"></div></div>',
            container: '.js-pagination-content',
            pagination: '.js-pagination'
        });
    }

    document.addEventListener("DOMContentLoaded", function() {
        initInfiniteScroll();
        initOtherPages();
    });

    return {
        load: initInfiniteScroll
    }
})()

// Scroll to fixed
theme.scrollToFixed = (function() {
    var window_width = $(window).width();

    if (window_width < 768) {
        $(".js-stick-parent").trigger("sticky_kit:detach");
    } else {
        make_sticky();
    }
    $(window).resize(function() {

        window_width = $(window).width();

        if (window_width < 768) {
            $(".js-stick-parent").trigger("sticky_kit:detach");
        } else {
            make_sticky();
        }
    });

    function make_sticky() {
        $('.js-stick-parent').stick_in_parent();
    }

})()


theme.headersidebar = (function() {
    $('#dismiss, .overlaysidebar').on('click', function() {
        // hide sidebar
        $('#sidebar').removeClass('active');
        // hide overlay
        $('.overlaysidebar').removeClass('active');
    });

    $('#sidebarCollapse').on('click', function() {
        // open sidebar
        $('#sidebar').addClass('active');
        // fade in the overlay
        $('.overlaysidebar').addClass('active');
        $('.collapse.in').toggleClass('in');
        $('a[aria-expanded=true]').attr('aria-expanded', 'false');
    });
})()

// Wishlist
theme.wishlist = (function() {
    var wishlistButtonClass = '.js-btn-wishlist',
        wishlistRemoveButtonClass = '.js-remove-wishlist',
        $wishlistCount = $('.js-wishlist-count'),
        $wishlistContainer = $('.js-wishlist-content'),
        wishlistObject = JSON.parse(localStorage.getItem('localWishlist')) || [],
        wishlistPageUrl = $('.js-wishlist-link').attr('href'),
        loadNoResult = function() {
            // $wishlistContainer.html('<div class="col text-center"><div class="alert alert-warning d-inline-block">' + theme.strings.wishlistNoResult + '</div></div>');
        };

    function updateWishlist(self) {
        var productHandle = $(self).data('handle'),
            allSimilarProduct = $(wishlistButtonClass + '[data-handle="' + productHandle + '"]');
        var isAdded = $.inArray(productHandle, wishlistObject) !== -1 ? true : false;
        if (isAdded) {
            // go to wishlist page
            window.location.href = wishlistPageUrl;
        } else {
            wishlistObject.push(productHandle);
            allSimilarProduct.fadeOut('slow').fadeIn('fast').html(theme.strings.wishlistIconAdded + theme.strings.wishlistTextAdded);
            //change tooltip
            allSimilarProduct.attr('data-original-title', theme.strings.wishlistTextAdded);
            $('.tooltip-inner').text(theme.strings.wishlistTextAdded);
        }
        localStorage.setItem('localWishlist', JSON.stringify(wishlistObject));
        $wishlistCount.text(wishlistObject.length);
    };

    function loadWishlist() {
        $wishlistContainer.html('');
        //page wishlist
        if (wishlistObject.length > 0) {
            for (var i = 0; i < wishlistObject.length; i++) {
                var productHandle = wishlistObject[i];
                Shopify.getProduct(productHandle, function(product) {
                    var htmlProduct = '';
                    var productPrice = product.price_varies ? 'from ' + theme.Currency.formatMoney(product.price_min, theme.moneyFormat) : theme.Currency.formatMoney(product.price, theme.moneyFormat);
                    var productComparePrice = product.compare_at_price_min !== 0 ? theme.Currency.formatMoney(product.compare_at_price_min, theme.moneyFormat) : '';
                    htmlProduct += '<div class="js-wishlist-item col-md-4 col-sm-6 col-xs-6 col-12 mb-4">';
                    htmlProduct += '<div class="js-wishlist-itembox">';
                    htmlProduct += '<div class=" d-flex flex-row p-4">';
                    htmlProduct += '	<a class="d-inline-block mr-4 " href="' + product.url + '">';
                    htmlProduct += '		<img src="' + product.featured_image + '"/>';
                    htmlProduct += '	</a>';
                    htmlProduct += '	<div><a href="' + product.url + '" class="title-prouct d-block h4 text-body" >' + product.title + '</a>';
                    htmlProduct += '	<span> ' + productPrice + '</span>';
                    htmlProduct += '	 <s>' + productComparePrice + '</s></div>';
                    htmlProduct += '<button class="btn js-remove-wishlist" data-handle="' + product.handle + '">' + theme.strings.wishlistRemove + '</button>';
                    htmlProduct += '</div>';
                    htmlProduct += '</div>';
                    htmlProduct += '</div>';
                    $wishlistContainer.append(htmlProduct);
                    theme.updateCurrencies();
                });
            }
        } else {
            loadNoResult();
        }

        //count items
        $wishlistCount.text(wishlistObject.length);

        //button text
        $(wishlistButtonClass).each(function() {
            var productHandle = $(this).data('handle');
            var iconWishlist = $.inArray(productHandle, wishlistObject) !== -1 ? theme.strings.wishlistIconAdded : theme.strings.wishlistIcon;
            var textWishlist = $.inArray(productHandle, wishlistObject) !== -1 ? theme.strings.wishlistTextAdded : theme.strings.wishlistText;
            $(this).html(iconWishlist + textWishlist).attr('title', textWishlist);
        });
    }

    $(document).on('click', wishlistButtonClass, function(event) {
        event.preventDefault();
        updateWishlist(this);
    });
    $(document).on('click', wishlistRemoveButtonClass, function() {
        var productHandle = $(this).data('handle'),
            allSimilarProduct = $(wishlistButtonClass + '[data-handle="' + productHandle + '"]');

        //update button
        allSimilarProduct.html(theme.strings.wishlistIcon + theme.strings.wishlistText);
        //update tooltip
        allSimilarProduct.attr('data-original-title', theme.strings.wishlistText);
        $('.tooltip-inner').text(theme.strings.wishlistText);
        //update Object
        wishlistObject.splice(wishlistObject.indexOf(productHandle), 1);
        localStorage.setItem('localWishlist', JSON.stringify(wishlistObject));
        // Remove element
        $(this).closest('.js-wishlist-item').fadeOut(); // or .remove()
        //count
        $wishlistCount.text(wishlistObject.length);
        if (wishlistObject.length === 0) {
            loadNoResult();
        }
    });

    loadWishlist();
    $(document).on('shopify:section:load', loadWishlist);
    return {
        load: loadWishlist
    }
})()

// Compare
theme.compare = (function() {
    var compareButtonClass = '.js-btn-compare',
        compareRemoveButtonClass = '.js-remove-compare',
        $compareCount = $('.js-compare-count'),
        $compareContainer = $('.js-compare-content'),
        compareObject = JSON.parse(localStorage.getItem('localCompare')) || [],
        alertClass = 'notice';

    function updateCompare(self) {
        var productHandle = $(self).data('handle'),
            alertText = '';
        var isAdded = $.inArray(productHandle, compareObject) !== -1 ? true : false;
        if (isAdded) {
            compareObject.splice(compareObject.indexOf(productHandle), 1);
            alertText = theme.strings.compareNotifyRemoved;
            alertClass = 'notice';
        } else {
            if (compareObject.length === 4) {
                alertText = theme.strings.compareNotifyMaximum;
                alertClass = 'error';
            } else {
                alertClass = 'notice';
                compareObject.push(productHandle);
                alertText = theme.strings.compareNotifyAdded;
            }
        }
        localStorage.setItem('localCompare', JSON.stringify(compareObject));
        theme.alert.new(theme.strings.compareText, alertText, 2000, alertClass);
        $compareCount.text(compareObject.length);
    };

    function loadCompare() {
        var compareGrid;
        $compareContainer.html('');
        //popup compare
        if (compareObject.length > 0) {
            compareGrid = compareObject.length === 1 ? 'col-md-6 col-sm-6' : 'col';
            for (var i = 0; i < compareObject.length; i++) {
                var productHandle = compareObject[i];
                Shopify.getProduct(productHandle, function(product) {
                    var htmlProduct = '',
                        productPrice = product.price_varies ? 'from ' + theme.Currency.formatMoney(product.price_min, theme.moneyFormat) : theme.Currency.formatMoney(product.price, theme.moneyFormat),
                        productComparePrice = product.compare_at_price_min !== 0 ? theme.Currency.formatMoney(product.compare_at_price_min, theme.moneyFormat) : '',
                        productAvailable = product.available ? theme.strings.available : theme.strings.unavailable,
                        productAvailableClass = product.available ? 'alert-success' : 'alert-danger',
                        productTypeHTML = product.type !== "" ? '<a href="/collections/types?q=' + product.type + '">' + product.type + '</a>' : '<span>' + theme.strings.none + '</span>',
                        productVendorHTML = product.vendor !== "" ? '<a href="/collections/vendors?q=' + product.vendor + '">' + product.vendor + '</a>' : '<span>' + theme.strings.none + '</span>';
                    htmlProduct += '<div class="compare-item ' + compareGrid + ' col-xs-6">';
                    htmlProduct += '	<a href="' + product.url + '">';
                    htmlProduct += '		<img src="' + Shopify.resizeImage(product.featured_image, 'x300') + '"/>';
                    htmlProduct += '	</a>';
                    htmlProduct += '	<hr /><h5 >' + product.title + '</h5>';
                    htmlProduct += '	<hr /><s>' + productComparePrice + '</s>';
                    htmlProduct += '	<span> ' + productPrice + '</span>';
                    htmlProduct += '	<hr /><span class=' + productAvailableClass + '> ' + productAvailable + '</span>';
                    htmlProduct += '	<hr />' + productTypeHTML;
                    htmlProduct += '	<hr />' + productVendorHTML;
                    htmlProduct += '  <hr /><button class="btn js-remove-compare btn-theme gradient-theme" data-handle="' + product.handle + '">' + theme.strings.compareRemove + '</button>';
                    htmlProduct += '</div>';
                    $compareContainer.append(htmlProduct);
                    theme.updateCurrencies();
                });
            }
        } else {
            // $compareContainer.html('<div class="alert alert-warning d-inline-block">' + theme.strings.compareNoResult + '</div>');
        }

        //button text
        $(compareButtonClass).each(function() {
            var productHandle = $(this).data('handle');
            var status = $.inArray(productHandle, compareObject) !== -1 ? 'added' : '';
            $(this).removeClass('added').addClass(status);
        });

        //count items
        $compareCount.text(compareObject.length);
    }
    $(document).on('click', compareButtonClass, function(event) {
        event.preventDefault();
        updateCompare(this);
        loadCompare();
    });
    $(document).on('click', compareRemoveButtonClass, function() {
        var productHandle = $(this).data('handle');
        compareObject.splice(compareObject.indexOf(productHandle), 1);
        localStorage.setItem('localCompare', JSON.stringify(compareObject));
        loadCompare();
    });

    loadCompare();
    $(document).on('shopify:section:load', loadCompare);
    return {
        load: loadCompare
    }
})()

// Popup newsletter
theme.popupNewletter = (function() {
    var $popupNewsletter = $('#jsPopupNewsletter'),
        $newsletterForm = $('#jsPopupNewsletter form'),
        date = new Date(),
        minutes = theme.timePopupNewsletter;
    minutesdelay = $popupNewsletter.attr('data-delay');
    if ($popupNewsletter.length === 1) {
        date.setTime(date.getTime() + (minutes * 60 * 1000));
        var setCookies = function() {
            $.cookie('cookiesNewsletter', 'disabled', { expires: date, path: '/' });
        };
        if ($.cookie('cookiesNewsletter') !== "disabled") {
            $(window).on('load', function() {
                setTimeout(function() {
                    $popupNewsletter.modal('show');
                }, minutesdelay * 1000);
            });
            $popupNewsletter.on('hidden.bs.modal', setCookies);
            $newsletterForm.submit(setCookies);
        }
    }
})()

// Cookie policy
theme.cookie = (function() {
    var $policy = $('.js-cookie-policy'),
        $closeButton = $('.js-btn-ok'),
        isOk = localStorage.getItem('localCookie') || '';
    if (isOk === '') {
        $policy.fadeIn('slow');
    }
    $closeButton.on('click', function() {
        localStorage.setItem('localCookie', 'accept');
        $policy.fadeOut('slow');
    })
})()

// Announcement Bar
theme.announcement = (function() {
    var $bar = $('.js-announcement-bar'),
        $closeButton = $('.js-ab-close'),
        isClosed = localStorage.getItem('localAnnouncement') || '';
    if (isClosed === '') {
        $bar.fadeIn();
        $bar.closest('.body-theme').addClass('body-announcement-bar');
    }
    $closeButton.on('click', function() {
        localStorage.setItem('localAnnouncement', 'closed');
        $bar.slideUp();
        $bar.closest('.body-theme').removeClass('body-announcement-bar');
    })
})()

// Open external link in new tab
theme.exLink = (function() {
    var links = document.links;
    for (let i = 0, linksLength = links.length; i < linksLength; i++) {
        if (links[i].hostname !== window.location.hostname && $(links[i]).attr('href') !== 'javascript:void(0)') {
            links[i].target = '_blank';
        }
    }
})()

// Deal- countdown
theme.countdown = (function() {
    function initCountdown() {
        $(".js-countdown").each(function() {
            var endTime = $(this).data('time'),
                htmlLayout = "<ul class='list--inline'><li class='gradient-theme-vertical'><span class='countdown-time'>%%D%%</span><span class='countdown-text'>Days</span></li><li class='gradient-theme-vertical'><span class='countdown-time'>%%H%%</span><span class='countdown-text'>Hours</span></li><li class='gradient-theme-vertical'><span class='countdown-time'>%%M%%</span><span class='countdown-text'>Mins</span></li><li class='gradient-theme-vertical'><span class='countdown-time'>%%S%%</span><span class='countdown-text'>Secs</span></li></ul>";
            $(this).lofCountDown({
                TargetDate: endTime,
                DisplayFormat: htmlLayout,
                FinishMessage: '<span class="alert alert-warning d-inline-block">' + theme.strings.countdownEndText + '</span>'
            });
        });
    }
    initCountdown();
    return {
        load: initCountdown
    }
})()

// Price range - Collection page
theme.priceRange = (function() {
    function initPriceRange() {
        var min = 0,
            max = 0,
            slideRange = '#js-slider-range',
            productCard = '.js-product-card',
            slideRangeWrap = '.slider-range-wr',
            rangeMin = '.js-range-min',
            rangeMax = '.js-range-max',
            enablePriceRange = $('#js-slider-range').length === 1 ? true : false;

        if (enablePriceRange) {
            $(productCard).each(function() {
                if (eval($(this).data('price')) > max) max = eval($(this).data('price'));
                if (min == 0) min = eval($(this).data('price'));
                else if (eval($(this).data('price')) < min) min = eval($(this).data('price'));
            });

            if (min === max) {
                $(slideRangeWrap).fadeOut();
            } else {
                $(slideRangeWrap).fadeIn();
            }

            $(slideRange).slider({
                range: true,
                min: min,
                max: max,
                values: [min, max],
                slide: function(event, ui) {
                    var price1 = (Shopify.formatMoney(ui.values[0], theme.moneyFormat));
                    var price2 = (Shopify.formatMoney(ui.values[1], theme.moneyFormat));
                    $(rangeMin).html(price1);
                    $(rangeMax).html(price2);
                    theme.updateCurrencies();

                    // Show/Hide product when dragging
                    $(productCard).each(function() {
                        if (eval($(this).data('price')) >= ui.values[0] && eval($(this).data('price')) <= ui.values[1]) {
                            $(this).parent().fadeIn();
                        } else {
                            $(this).parent().fadeOut();
                        }
                    });
                }
            });

            var price1 = (Shopify.formatMoney(min, theme.moneyFormat));
            var price2 = (Shopify.formatMoney(max, theme.moneyFormat));
            $(rangeMin).html(price1);
            $(rangeMax).html(price2);
            theme.updateCurrencies();

        }
    }
    initPriceRange();
    return {
        load: initPriceRange
    }
})()

// Collection view - Collection page
theme.collectionView = (function() {
    var btnView = '.js-btn-view',
        btnViewActive = '.js-btn-view.active';

    $(document).on('click', btnView, function() {
        var value = $(this).data('col'),
            $gridItemCol = $('.js-col');

        $(btnView).removeClass('active');
        $(this).addClass('active');

        $gridItemCol.removeClass().addClass('js-col col-sm-6 col-12');
        if (value === 3) {
            $gridItemCol.addClass('col-lg-4');
        } else if (value === 4) {
            $gridItemCol.addClass('col-lg-3');
        } else if (value === 5) {
            $gridItemCol.addClass('col-lg-2-4');
        } else if (value === 6) {
            $gridItemCol.addClass('col-lg-2');
        };
    })

    function triggerCollectionView() {
        $(btnViewActive).trigger('click');
    }

    return {
        triggerView: triggerCollectionView
    }
})()

// Swath variant in card item
theme.swatchCard = (function() {
    $(document).on('click', '.js-swatch-card-item', function() { //click or mouseover
        $(".js-swatch-card-item").removeClass("active");
        $(this).addClass("active");
        var newImage = $(this).data('image');
        var id = $(this).data('id');
        var gridItem = $(this).closest('.js-product-card');
        gridItem.find('.product-card__image').find('img').attr('srcset', newImage);
        gridItem.find('.js-grid-cart').data('id', id).attr('data-id', id);
    });
})()

theme.swatchCard2 = (function() {
    function initVariant(id) {
        var productJson = JSON.parse($('.customJson-' + id).html());
        var $selectorForm = $('.customform-' + id);
        var $button = $('.js-customform-addtocart-' + id);
        var $buttontext = $button.find('span');
        var $wrapObject = $selectorForm.closest('.js-product-card');
        var options = {
            $container: $selectorForm,
            enableHistoryState: false,
            product: productJson,
            singleOptionSelector: '.single-option-selector-' + id,
            originalSelectorId: '#ProductSelect-' + id
        };
        var variants = new slate.Variants(options);
        var AjaxCart = new window.AjaxCart($selectorForm);
        var _updateButton = function(evt) {
            var variant = evt.variant;
            if (variant === undefined) {
                $button.prop('disabled', true).removeClass('btn--sold-out');
                $buttontext.html(theme.strings.unavailable);
            } else {
                if (variant.available) {
                    $button.removeClass('btn--sold-out').prop('disabled', false);
                    $buttontext.html(theme.strings.addToCart);
                } else {
                    $button.prop('disabled', true).addClass('btn--sold-out');
                    $buttontext.html(theme.strings.soldOut);
                }
            }
        }
        var _updateImage = function(evt) {
            var variant = evt.variant;
            var $mainImage = $wrapObject.find('.product-card__image').find('img');
            if (variant !== undefined && variant.featured_image !== null) {
                var variantImage = variant.featured_image;
                $mainImage.attr('srcset', variantImage.src);
            }
        }
        var _updatePrice = function(evt) {
            var $price = $wrapObject.find('.product-card__price');
            var variant = evt.variant;
            if (variant !== undefined) {
                var htmlComparePrice = variant.compare_at_price !== null ? '<s class="product-card__regular-price"><span class="money">' + variant.compare_at_price + '</span></s>' : '';
                var htmlPrice = '<span class="money">' + variant.price + '</span>' + htmlComparePrice;
                $price.html(htmlPrice);
                theme.updateCurrencies();
            }
        }
        variants.$container.on(
            'variantChange', _updateButton
        );
        variants.$container.on(
            'variantChange', _updateImage
        );
        variants.$container.on(
            'variantChange', _updatePrice
        );
    }

    function initForm() {
        $('.js-customform').each(function() {
            var id = $(this).data('id');
            initVariant(id);
        })
    }

    initForm();
    return {
        load: initForm
    }
})()

// Loading
theme.loading = (function() {
    var $loading = $('#js-loading'),
        hasLoading = $('#js-loading').length === 0 ? false : true;
    if (hasLoading) {
        $(window).load(function() {
            $loading.fadeOut();
        });
    }
})()

theme.effectLeavingPage = (function() {
    window.onbeforeunload = function() {
        $('body').css('opacity', '0');
    }
})()

// Isotope
theme.isotope = (function() {
    var enableIsotope = $('.enable-isotope').length === 1 ? true : false,
        $grid = $('.js-grid'),
        filter = '.js-filter-isotope';

    function initIsotope() {
        if (enableIsotope) {
            $grid.isotope({
                itemSelector: '.grid-item',
                percentPosition: true
            })
            $(document).on('click', filter, function() {
                var filterValue = $(this).data('filter') === '*' ? $(this).data('filter') : '.' + $(this).data('filter');
                $(filter).removeClass('active');
                $(this).addClass('active');
                $grid.isotope({
                    filter: filterValue
                });
            });
            $(window).scroll(function() {
                $grid.isotope('layout');
            });
            $(window).load(function() {
                $grid.isotope('layout');
                $(filter).first().trigger('click');
            });
        }
    }
    initIsotope();
})()

//aos



// theme.Wow = (function(){
//   new WOW().init();
// })()




// Masonry
theme.Masonry = (function() {
    function Masonry(container) {
        this.$container = $(container).on('init', this._a11y.bind(this));
        var $masonry = this.$container;
        $masonry.isotope({
            itemSelector: '.grid-item',
            percentPosition: true,
            masonry: {
                columnWidth: '.grid-sizer'
            }
        });
        $(window).load(function() {
            $masonry.isotope('layout').css('opacity', '1');
        });
        $(window).scroll(function() {
            $masonry.isotope('layout').css('opacity', '1');
        });
    }

    Masonry.prototype = _.assignIn({}, Masonry.prototype, {
        _a11y: function(event, obj) {
            var $list = obj.$list;
            var $wrapper = this.$container.parent();

            // Remove default Slick aria-live attr until slider is focused
            $list.removeAttr('aria-live');

            // When an element in the slider is focused set aria-live
            $wrapper.on('focusin', function(evt) {
                if ($wrapper.has(evt.target).length) {
                    $list.attr('aria-live', 'polite');
                }
            });

            // Remove aria-live
            $wrapper.on('focusout', function(evt) {
                if ($wrapper.has(evt.target).length) {
                    $list.removeAttr('aria-live');
                }
            });
        }
    });

    return Masonry;
})();



// Cross-selling
theme.crosssell = (function() {
    var crosssellClass = '.js-crosssell',
        handles = $(crosssellClass).data('handles') || '',
        arrayHandle = handles.split(','),
        $blockCrosssell = $('.block-cross-sell'),
        variantSelectClass = '.js-cross-select',
        crossImageClass = '.cross-item-image',
        crossPriceClass = '.cross-item-money';

    function generateCrosssell() {
        for (var i = 0; i < arrayHandle.length; i++) {
            var productHandle = arrayHandle[i];
            Shopify.getProduct(productHandle, function(product) {
                var htmlCross = '',
                    htmlOption = '',
                    firstAvailableVariant = '',
                    variantCount = product.variants.length;

                // generate select box and check first avaiable variant
                for (var j = 0; j < variantCount; j++) {
                    var variant = product.variants[j],
                        variantImage = variant.featured_image === null ? product.featured_image : variant.featured_image.src,
                        disabled = variant.available ? '' : 'disabled';
                    htmlOption += '<option ' + disabled + ' data-id="' + variant.id + '" data-price="' + variant.price + '" data-image="' + variantImage + '">' + variant.title + '</option>';
                    if (firstAvailableVariant === '' && variant.available) {
                        firstAvailableVariant = variant
                    }
                }
                var productPrice = theme.Currency.formatMoney(firstAvailableVariant.price, theme.moneyFormat),
                    productImage = firstAvailableVariant.featured_image === null ? product.featured_image : firstAvailableVariant.featured_image.src,
                    selectHide = variantCount === 1 ? 'hide' : '';

                // generate HTML
                htmlCross += '<div class="col cross-item ' + product.handle + '">';
                htmlCross += '	<a class="cross-item-image" href="' + product.url + '" title="' + product.title + '"><img src="' + productImage + '" />' + theme.strings.cartIcon + '</a>';
                htmlCross += '	<a target="_blank" href="' + product.url + '" title="' + product.title + '" class="cross-item-title">' + product.title + '</a>';
                htmlCross += '	<span class="cross-item-money">' + productPrice + '</span>';
                htmlCross += '	<select class="js-cross-select ' + selectHide + '" data-image="' + productImage + '" data-price="' + firstAvailableVariant.price + '" data-item="' + firstAvailableVariant.id + '">' + htmlOption + '</select>';
                htmlCross += '</div>';
                $(crosssellClass).append(htmlCross);
                theme.updateCurrencies();
            });
        }
    }

    function showPopupCrosssell(lineItem) {
        //generate lineitem;
        var htmlLineItem = '';
        htmlLineItem += '<span class="alert alert-success d-inline-block mb-2">' + theme.strings.addToCartSuccess + '</span>';
        htmlLineItem += '<div><img src="' + lineItem.image + '" alt="Added Product"></div>';
        htmlLineItem += '<h4 class="cross-item-title">' + lineItem.title + '</h4>';
        htmlLineItem += '<div class="mb-2">' + theme.strings.cartQuantity + ': ' + lineItem.quantity + '</div>';
        $('.js-cross-added').hide().html(htmlLineItem).fadeIn();

        // show popup
        var $popupCrosssell = $('#jsCrosssell');
        $popupCrosssell.modal('show');
    }

    if (handles !== '') {
        $(document).on('click', crossImageClass, function(event) {
            event.preventDefault();
            var parent = $(this).closest('.cross-item'),
                itemId = parent.find(variantSelectClass).attr('data-item');
            Shopify.addItem(itemId, 1, function(lineItem) {
                theme.miniCart.updateElements();
                theme.miniCart.generateCart();
                showPopupCrosssell(lineItem);
            });
        });
        $(document).on('change', variantSelectClass, function() {
            var selectVariant = $(this).children(':selected'),
                selectVariantId = selectVariant.data('id'),
                parent = $(this).parent(),
                newPrice = theme.Currency.formatMoney(selectVariant.data('price'), theme.moneyFormat);

            if (selectVariant.data('image') !== '') {
                parent.find(crossImageClass).find('img').attr('src', selectVariant.data('image'));
            }
            $(this).attr('data-item', selectVariantId);
            parent.find(crossPriceClass).html(newPrice);
            theme.updateCurrencies();
        });
        $(document).on('shopify:section:load', generateCrosssell);
        generateCrosssell();
        $blockCrosssell.removeClass('hide');
    }
    return {
        showPopup: showPopupCrosssell
    }
})()

// Upsell
theme.upsell = (function() {
    var popupUpsell = '#jsUpsell',
        $button = $('#jsUpsell .btn'),
        productUpsellId = $('#jsUpsell').data('id') || '',
        buttonAcceptClass = 'js-btn-accept',
        delayTime = $('#jsUpsell').data('delay') || 3000,
        isUpsell = $(popupUpsell).length === 1 ? true : false;
    if (isUpsell) {
        $(document).ready(function() {
            setTimeout(function() {
                $(popupUpsell).modal('show');
            }, delayTime);
        });
        $button.on('click', function() {
            if ($(this).hasClass(buttonAcceptClass)) {
                Shopify.addItem(productUpsellId, 1, function(item) {
                    theme.miniCart.updateElements();
                    theme.miniCart.generateCart();
                    var htmlVariant = item.variant_title !== null ? '<i>(' + item.variant_title + ')</i>' : '';
                    var htmlAlert = '<div class="media mt-2 alert--cart"><a class="mr-3" href="/cart"><img class="lazyload" data-src="' + item.image + '"></a><div class="media-body align-self-center"><p class="m-0 font-weight-bold">' + item.product_title + ' x ' + item.quantity + '</p>' + htmlVariant + '<div><div>';
                    theme.alert.new(theme.strings.addToCartSuccess, htmlAlert, 3000, 'notice');
                })
            }
            $(popupUpsell).modal('hide');
        })
    }
})()

// Coupon
theme.coupon = (function() {
    var popupCoupon = '#jsCoupon',
        $button = $('#jsCoupon .js-btn-coupon'),
        delayTime = $('#jsCoupon').data('delay') || 3000,
        isCoupon = $(popupCoupon).length === 1 ? true : false,
        isCopied = localStorage.getItem('localCoupon') || '';
    if (isCoupon && isCopied === '') {
        $(document).ready(function() {
            setTimeout(function() {
                $(popupCoupon).modal('show');
            }, delayTime);
        });
        $button.on('click', function() {
            var copyText = document.getElementById("coupon_code");
            copyText.select();
            document.execCommand("Copy");
            $(popupCoupon).modal('hide');
            theme.alert.new('Coupon code', 'Successfully copied, now you can paste code at checkout', 4000);
            localStorage.setItem('localCoupon', 'copied');
        })
    }
})()

// Overwrite Shopify.onError in Shopify API
Shopify.onError = function(t, r) {
    var e = eval("(" + t.responseText + ")");
    var mess = e.message ? e.message + "(" + e.status + "): " + e.description : "Error : " + Shopify.fullMessagesFromErrors(e).join("; ") + "."
    theme.alert.new('Alert', mess, 3000, 'warning');
}

// Megamenu width
theme.fixWidthMegamenu = (function() {
    var $megamenuClass = $('.site-nav__item-mega'),
        megaDropdownClass = '.meganav';
    $megamenuClass.each(function() {
        var widthMenu = $(this).data('width') || 0;
        if (widthMenu !== 0) {
            $(this).find(megaDropdownClass).css({ 'width': widthMenu + 'px', 'margin-left': '-' + widthMenu / 2 + 'px' });
        }
    });
})()

// Product video
theme.productVideo = (function() {
    var playButtonClass = '.js-play-button';
    $(document).on('click', playButtonClass, function() {
        let videoSelector = $(this).next(),
            videoObject = videoSelector.get(0);
        $(this).toggleClass('active');
        videoSelector.toggleClass('active');
        videoObject.paused ? videoObject.play() : videoObject.pause();
    })
})()

// Fake-viewers
theme.fakeViewer = (function() {
    var $fakeViewClass = $('.js-fake-view'),
        minValue = $fakeViewClass.data('min'),
        maxValue = $fakeViewClass.data('max'),
        duration = $fakeViewClass.data('duration');

    function randomInRange(start, end) {
        var value = Math.floor(Math.random() * (end - start + 1) + start);
        $fakeViewClass.text(value);
    }

    if (minValue !== undefined && maxValue !== undefined) {
        randomInRange(minValue, maxValue);
        setInterval(function() {
            randomInRange(minValue, maxValue);
        }, duration);
    }

})();

// Product-suggest
theme.productSuggest = (function() {
    var $productSuggestClass = $('.product-notification'),
        $closeButtonClass = $('.close-notifi'),
        duration = $productSuggestClass.data('time') || 0,
        productSuggestCookie = 'cookieSuggest';

    function SomeonePurchased() {
        if ($.cookie(productSuggestCookie) == 'closed') {
            $productSuggestClass.remove();
        }
        $closeButtonClass.on('click', function() {
            $productSuggestClass.remove();
            $.cookie(productSuggestCookie, 'closed', { expires: 1, path: '/' });
        });

        function toggleSomething() {
            if ($productSuggestClass.hasClass('active')) {
                $productSuggestClass.removeClass('active')
            } else {
                var arrayProducts = $('.data-product'),
                    randomProduct = Math.floor(Math.random() * arrayProducts.length),
                    Object = $(arrayProducts[randomProduct]);

                $productSuggestClass.addClass('active');
                $productSuggestClass.find('.product-image').attr('href', Object.data('url')).find('img').attr('src', Object.data('image'));
                $productSuggestClass.find('.product-name').text(Object.data('title')).attr('href', Object.data('url'));
                $productSuggestClass.find('.time-ago').text(Object.data('time'));
                $productSuggestClass.find('.from-ago').text(Object.data('local'));
            }
        }

        if (duration !== 0) {
            setInterval(toggleSomething, duration);
        }
    }
    SomeonePurchased();
})()


// Stickyheader
theme.stickyHeader = (function() {
    var stickHeaderClass = '.site-header--sticky';
    if ($(stickHeaderClass).length !== 0) {
        $(window).scroll(function() {
            if (window.pageYOffset >= 20) {
                $(stickHeaderClass).addClass('active');
            } else {
                $(stickHeaderClass).removeClass('active');
            }
        });
    }
})()

theme.PhotoSwipe = (function() {
    var initPhotoSwipeFromDOM = function(gallerySelector) {

        // parse slide data (url, title, size ...) from DOM elements 
        // (children of gallerySelector)
        var parseThumbnailElements = function(el) {
            var thumbElements = el.childNodes,
                numNodes = thumbElements.length,
                items = [],
                figureEl,
                linkEl,
                size,
                item;

            for (var i = 0; i < numNodes; i++) {

                figureEl = thumbElements[i]; // <figure> element

                // include only element nodes 
                if (figureEl.nodeType !== 1) {
                    continue;
                }

                linkEl = figureEl.children[0]; // <a> element

                size = linkEl.getAttribute('data-size').split('x');

                // create slide object
                item = {
                    src: linkEl.getAttribute('href'),
                    w: parseInt(size[0], 10),
                    h: parseInt(size[1], 10)
                };



                if (figureEl.children.length > 1) {
                    // <figcaption> content
                    item.title = figureEl.children[1].innerHTML;
                }

                if (linkEl.children.length > 0) {
                    // <img> thumbnail element, retrieving thumbnail url
                    item.msrc = linkEl.children[0].getAttribute('src');
                }

                item.el = figureEl; // save link to element for getThumbBoundsFn
                items.push(item);
            }

            return items;
        };

        // find nearest parent element
        var closest = function closest(el, fn) {
            return el && (fn(el) ? el : closest(el.parentNode, fn));
        };

        // triggers when user clicks on thumbnail
        var onThumbnailsClick = function(e) {
            e = e || window.event;
            e.preventDefault ? e.preventDefault() : e.returnValue = false;

            var eTarget = e.target || e.srcElement;

            // find root element of slide
            var clickedListItem = closest(eTarget, function(el) {
                return (el.tagName && el.tagName.toUpperCase() === 'FIGURE');
            });

            if (!clickedListItem) {
                return;
            }

            // find index of clicked item by looping through all child nodes
            // alternatively, you may define index via data- attribute
            var clickedGallery = clickedListItem.parentNode,
                childNodes = clickedListItem.parentNode.childNodes,
                numChildNodes = childNodes.length,
                nodeIndex = 0,
                index;

            for (var i = 0; i < numChildNodes; i++) {
                if (childNodes[i].nodeType !== 1) {
                    continue;
                }

                if (childNodes[i] === clickedListItem) {
                    index = nodeIndex;
                    break;
                }
                nodeIndex++;
            }



            if (index >= 0) {
                // open PhotoSwipe if valid index found
                openPhotoSwipe(index, clickedGallery);
            }
            return false;
        };

        // parse picture index and gallery index from URL (#&pid=1&gid=2)
        var photoswipeParseHash = function() {
            var hash = window.location.hash.substring(1),
                params = {};

            if (hash.length < 5) {
                return params;
            }

            var vars = hash.split('&');
            for (var i = 0; i < vars.length; i++) {
                if (!vars[i]) {
                    continue;
                }
                var pair = vars[i].split('=');
                if (pair.length < 2) {
                    continue;
                }
                params[pair[0]] = pair[1];
            }

            if (params.gid) {
                params.gid = parseInt(params.gid, 10);
            }

            return params;
        };

        var openPhotoSwipe = function(index, galleryElement, disableAnimation, fromURL) {
            var pswpElement = document.querySelectorAll('.pswp')[0],
                gallery,
                options,
                items;

            items = parseThumbnailElements(galleryElement);

            // define options (if needed)
            options = {
                maxSpreadZoom: 1,
                bgOpacity: 0.7,
                zoomEl: true,
                history: false,
                zoomEl: false,
                pinchToClose: false,
                closeOnScroll: false,
                // define gallery index (for URL)
                galleryUID: galleryElement.getAttribute('data-pswp-uid'),

            };

            // PhotoSwipe opened from URL
            if (fromURL) {
                if (options.galleryPIDs) {
                    // parse real index when custom PIDs are used 
                    // http://photoswipe.com/documentation/faq.html#custom-pid-in-url
                    for (var j = 0; j < items.length; j++) {
                        if (items[j].pid == index) {
                            options.index = j;
                            break;
                        }
                    }
                } else {
                    // in URL indexes start from 1
                    options.index = parseInt(index, 10) - 1;
                }
            } else {
                options.index = parseInt(index, 10);
            }

            // exit if index not found
            if (isNaN(options.index)) {
                return;
            }

            if (disableAnimation) {
                options.showAnimationDuration = 0;
            }

            // Pass data to PhotoSwipe and initialize it
            gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, items, options);
            gallery.init();
        };

        // loop through all gallery elements and bind events
        var galleryElements = document.querySelectorAll(gallerySelector);

        for (var i = 0, l = galleryElements.length; i < l; i++) {
            galleryElements[i].setAttribute('data-pswp-uid', i + 1);
            galleryElements[i].onclick = onThumbnailsClick;
        }

        // Parse URL and open gallery if it contains #&pid=3&gid=1
        var hashData = photoswipeParseHash();
        if (hashData.pid && hashData.gid) {
            openPhotoSwipe(hashData.pid, galleryElements[hashData.gid - 1], true, true);
        }
    };

    // execute above function
    initPhotoSwipeFromDOM('.my-gallery');
})()

theme.ZoomImage = (function() {
    $(window).resize(function() {
        var width = $(window).width();
        if (width > 767) {
            ZoomImage();
        }
    });
    $(window).width(function() {
        var width = $(window).width();
        if (width > 767) {
            ZoomImage();
        }
    });

    function ZoomImage() {
        $(".zoom_image").each(function(arg, el) {
            var image = $(el).find("img");
            $(el).zoom({
                on: 'mouseover',
                url: image.attr("src").replace("small", "big")
            });
        });
    }
})()

theme.activeAccordion = (function() {
    $('.collapse').on('shown.bs.collapse', function() {
        $(this).prev().addClass('active-acc');
    });
    $('.collapse').on('hidden.bs.collapse', function() {
        $(this).prev().removeClass('active-acc');
    });
})()


// Anchor scroll
theme.anchorScroll = (function() {
    $(document).on('click', 'a[href^="#"]', function(event) {
        event.preventDefault();
        var disableAnchor = $(this).hasClass('disabled-anchor');
        if (!disableAnchor) {
            $('html, body').animate({
                scrollTop: $($.attr(this, 'href')).offset().top
            }, 500);
        }
    });
})()

// Product-recently-viewed
theme.productRecentlyViewed = (function() {
    var $viewedElement = $('.js-recently-view'),
        $viewButton = $('.js-recently-view-button'),
        $content = $('.js-recently-view-content'),
        productHandle = $viewedElement.data('handle') || '',
        limit = $viewButton.data('limit') || 0,
        arrayProduct = JSON.parse(localStorage.getItem('localRecentlyViewed')) || [],
        lastProduct = arrayProduct[arrayProduct.length - 1] || '',
        isAdded = $.inArray(productHandle, arrayProduct) !== -1 ? true : false;

    function processViewed() {
        if (productHandle !== '') {
            //process last product
            if (lastProduct === productHandle && arrayProduct.length > 1) {
                lastProduct = arrayProduct[arrayProduct.length - 2]
            }

            //move current product to last of array
            if (isAdded) {
                arrayProduct.splice(arrayProduct.indexOf(productHandle), 1);
            }
            arrayProduct.push(productHandle);
            //remove first item if limit
            if (arrayProduct.length > limit) {
                arrayProduct.shift()
            }
            localStorage.setItem('localRecentlyViewed', JSON.stringify(arrayProduct));
        }
    }

    function generatorProduct() {
        $content.html('');
        if (arrayProduct.length > 0) {
            //array
            for (var i = 0; i < arrayProduct.length; i++) {
                var productHandle = arrayProduct[i];
                Shopify.getProduct(productHandle, function(product) {
                    var htmlProduct = '';
                    var productPrice = product.price_varies ? 'from ' + theme.Currency.formatMoney(product.price_min, theme.moneyFormat) : theme.Currency.formatMoney(product.price, theme.moneyFormat);
                    var productComparePrice = product.compare_at_price_min !== 0 ? theme.Currency.formatMoney(product.compare_at_price_min, theme.moneyFormat) : '';
                    htmlProduct += '<div class="col-12 col-lg-4 js-viewed-item mb-4">';
                    htmlProduct += '	<div class="border p-3 rounded media d-flex ">';
                    htmlProduct += '	<a class="mr-3 col-4 p-0" href="' + product.url + '">';
                    htmlProduct += '		<img src="' + product.featured_image + '"/>';
                    htmlProduct += '	</a>';
                    htmlProduct += '	<div class="media-body text-left">';
                    htmlProduct += '		<h4 class="mb-2 mt-2"><a href="' + product.url + '">' + product.title + '</a></h5>';
                    htmlProduct += '	<span> ' + productPrice + '</span>';
                    htmlProduct += '	<s>' + productComparePrice + '</s>';
                    htmlProduct += '	</div>';
                    htmlProduct += '	</div>';
                    htmlProduct += '</div>';
                    $content.append(htmlProduct);
                    theme.updateCurrencies();
                });
            }

            //last product
            Shopify.getProduct(lastProduct, function(product) {
                $viewButton.css('background-image', 'url(' + product.featured_image + ')').addClass('active');
            })
        }
    }

    processViewed();
    generatorProduct();

})()

// Notice when soldout
theme.alert = (function() {
    function createAlert(title, mess, time, type) {
        var aTitle = title || '',
            aTime = time || 2000,
            aMessage = mess || '',
            aClass = type || 'default';
        $.growl({
            title: aTitle,
            message: aMessage,
            duration: aTime,
            style: aClass,
            size: 'large'
        });
    }

    return {
        new: createAlert
    }
})()

// Notice when soldout
theme.noticeSoldout = (function() {
    var $soldoutWrapFormClass = $('.js-contact-soldout'),
        $textClass = $('.js-notify-text'),
        $soldoutValueId = $('#ContactProduct');

    function noticeSoldout(variant) {
        $soldoutWrapFormClass.find('.form-success').remove()
        if (variant.available) {
            $textClass.find('span').text('');
            $soldoutWrapFormClass.addClass('hide');
        } else {
            $textClass.find('span').text(': ' + variant.name);
            $soldoutWrapFormClass.removeClass('hide');
            $soldoutValueId.val(variant.name).attr('value', variant.name);
        }
    }
    return {
        init: noticeSoldout
    }
})()

// Sticky cart
theme.stickyCart = (function() {
    var $anchor = $('#js-anchor-sticky-cart'),
        $stCart = $('.sticky-cart-wr'),
        $close = $('#js-sticky-close'),
        disableStCart = localStorage.getItem('localDisableStCart') || '';
    if (disableStCart !== '') {
        $stCart.addClass('disable');
    }
    $close.on('click', function() {
        var isDisable = disableStCart !== '';
        if (isDisable) {
            localStorage.setItem('localDisableStCart', '');
        } else {
            localStorage.setItem('localDisableStCart', 'true');
        }
        $stCart.toggleClass('disable');
    })
    if ($anchor.length) {
        $(window).on('scroll', function() {
            var hT = $anchor.offset().top,
                hH = $anchor.outerHeight(),
                wH = $(window).height(),
                wS = $(this).scrollTop();
            if (wS > (hT + hH - wH)) {
                $stCart.addClass('active');
            } else {
                $stCart.removeClass('active');
            }
        });
    }

})()

//Fix reload safari
window.addEventListener("pageshow", function(evt) {
    if (evt.persisted) {
        setTimeout(function() {
            window.location.reload();
        }, 10);
    }
}, false);

// Back to top
theme.backToTop = (function() {
    var backtotopClass = $('.js-back-to-top');
    $(window).scroll(function() {
        if ($(this).scrollTop() > 300) {
            backtotopClass.fadeIn('slow');
        } else {
            backtotopClass.fadeOut('slow');
        }
    });
    backtotopClass.on('click', function() {
        $('body,html').animate({ scrollTop: 0 }, 800);
    });
})()


// Tooltip
theme.tooltip = (function() {
    var selector = '[data-toggle="tooltip"],[data-tooltip="true"]';

    function loadTooltip() {
        $(selector).tooltip(); //Bootstrap 4
    };
    $(document).on('click', selector, function() {
        $(this).tooltip('hide');
    });
    loadTooltip();
    return {
        load: loadTooltip
    }
})()

//Collections style 2
theme.Bgcollection = (function() {
    // init Isotope
    function Bgcollection(container) {
        var $container = this.$container = $(container);
        var sectionId = $container.attr('data-section-id');
        var wrapper = this.wrapper = '.bgcollection-wrapper';
        var slider = this.slider = '#Bgcollection-' + sectionId;
        var $slider = $(slider, wrapper);
        $(".colgrid__bg--full[data-index='1']").addClass('active');
        $('.colgrid .colgrid__box').each(function() {
            var index = $(this).attr("data-index");
            $(this).hover(
                function() {
                    $(".colgrid__bg--full[data-index='" + index + "']").addClass('active');
                },
                function() {
                    $(".colgrid__bg--full[data-index='" + index + "']").removeClass('active');
                }
            );
        });
    }

    return Bgcollection;
})();


//Sidebar
theme.sidebar = (function() {
    var togglebutton = '.js-toggle-filter',
        $sidebar = $('.js-sidebar');
    $(document).on('click', togglebutton, function() {
        $sidebar.toggleClass('active');
        $(this).toggleClass('active');
    })
})()

// Ajax filter in collection page
theme.ajaxFilter = (function() {
    var ajaxContent = '#js-product-ajax',
        ajaxSortBy = '#js-sortby',
        ajaxFillter = '#js-fillter',
        ajaxCollectionTitle = '.js-collection-title',
        pageTitle = $(document).find("title").text(),
        jsLoading = '#js-loading';

    var apollo = {
        init: function() {
            this.initFilter();
        },
        showLoading: function() {
            $(jsLoading).show();
        },
        hideLoading: function() {
            $('body,html').animate({
                scrollTop: $('#MainContent').offset().top - 150
            }, 600);
            setTimeout(function() {
                $(jsLoading).hide(); //delay 500ms for better UX
            }, 500);

        },
        initFilter: function() {
            apollo.filterParams();
            apollo.filterSortby();
            apollo.sidebarMapTagEvents();
            apollo.filterMapSorting();
            apollo.filterMapPaging();
        },
        filterParams: function() {
            Shopify.queryParams = {};
            if (location.search.length) {
                for (var aKeyValue, i = 0, aCouples = location.search.substr(1).split('&'); i < aCouples.length; i++) {
                    aKeyValue = aCouples[i].split('=');
                    if (aKeyValue.length > 1) {
                        Shopify.queryParams[decodeURIComponent(aKeyValue[0])] = decodeURIComponent(aKeyValue[1]);
                    }
                }
            }
        },
        filterSortby: function() {
            if (Shopify.queryParams.sort_by) {
                var sortby = Shopify.queryParams.sort_by;
                $(ajaxSortBy).val(sortby);
            }
        },
        filterCreateUrl: function(baseLink) {
            var newQuery = $.param(Shopify.queryParams).replace(/%2B/g, '+');
            if (baseLink) {
                if (newQuery != "") {
                    return baseLink + "?" + newQuery;
                } else {
                    return baseLink;
                }
            }
            return location.pathname + "?" + newQuery;
        },
        filterMapData: function(data) {
            // 1. update product grid
            $(ajaxContent).html($(ajaxContent, data.responseText).html());
            // 2. update left filter
            $(ajaxFillter).html($(ajaxFillter, data.responseText).html());
            // 3. update collection title
            $(ajaxCollectionTitle).html($(ajaxCollectionTitle, data.responseText).html());
        },
        filterAjaxClick: function(baseLink) {
            delete Shopify.queryParams.page;
            var newurl = apollo.filterCreateUrl(baseLink);
            History.pushState({
                param: Shopify.queryParams
            }, pageTitle, newurl);
            apollo.filterGetContent(newurl);
        },
        filterGetContent: function(newurl) {
            $.ajax({
                type: 'GET',
                url: newurl,
                data: {},
                beforeSend: function() {
                    apollo.showLoading();
                },
                complete: function(data) {
                    apollo.filterMapData(data);
                    theme.wishlist.load();
                    theme.compare.load();
                    theme.countdown.load();
                    theme.priceRange.load();
                    theme.tooltip.load();
                    theme.collectionView.triggerView();
                    theme.swatchCard2.load();
                    theme.infiniteScroll.load();
                    apollo.hideLoading();
                },
                error: function(xhr, text) {
                    apollo.hideLoading();
                    alert($.parseJSON(xhr.responseText).description);
                }
            });
        },
        sidebarMapTagEvents: function() {
            $(document).on('click', '.advanced-filter a', function(event) {
                event.preventDefault();
                $('.tooltip').removeClass('show');
                var currentTags = [];
                if (Shopify.queryParams.constraint) {
                    currentTags = Shopify.queryParams.constraint.split('+');
                }
                if (!$(this).parent().hasClass("active-filter")) {
                    var otherTag = $(this).parents('.catalog_filter_ul').find("li.active-filter");
                    if (otherTag.length > 0) {
                        var tagName = otherTag.data("handle");
                        if (tagName) {
                            var tagPos = currentTags.indexOf(tagName);
                            if (tagPos >= 0) {
                                currentTags.splice(tagPos, 1);
                            }
                        }
                    }
                }
                var dataHandle = $(this).parent().data("handle");
                if (dataHandle) {
                    var tagPos = currentTags.indexOf(dataHandle);
                    if (tagPos >= 0) {
                        currentTags.splice(tagPos, 1);
                    } else {
                        currentTags.push(dataHandle);
                    }
                }
                if (currentTags.length) {
                    Shopify.queryParams.constraint = currentTags.join('+');
                } else {
                    delete Shopify.queryParams.constraint;
                }
                apollo.filterAjaxClick();
            });
            $(document).on('click', '.advanced-filter .icon', function() {
                $(this).parent('.advanced-filter').find('a').trigger("click");
            });
        },
        filterMapSorting: function() {
            $(document).on('change', ajaxSortBy, function() {
                Shopify.queryParams.sort_by = $(this).val();
                apollo.filterAjaxClick();
            })
        },
        filterMapPaging: function() {
            $(document).on('click', '.js-pagination a', function() {
                event.preventDefault();
                var linkPage = $(this).attr("href").match(/page=\d+/g);
                if (linkPage) {
                    Shopify.queryParams.page = parseInt(linkPage[0].match(/\d+/g));
                    if (Shopify.queryParams.page) {
                        var newurl = apollo.filterCreateUrl();
                        History.pushState({
                            param: Shopify.queryParams
                        }, pageTitle, newurl);
                        apollo.filterGetContent(newurl);
                    }
                }
            });
        }
    }

    if ($(".template-collection")) {
        History.Adapter.bind(window, 'statechange', function() {
            var State = History.getState();
            apollo.filterParams();
        });
    }
    apollo.init();

})();
$(theme.init);      theme.Currency = (function() {
                        var moneyFormat = '${{amount}}'; // eslint-disable-line camelcase

                        function formatMoney(cents, format) {
                            if (typeof cents === 'string') {
                                cents = cents.replace('.', '');
                            }
                            var value = '';
                            var placeholderRegex = /\{\{\s*(\w+)\s*\}\}/;
                            var formatString = format || moneyFormat;

                            function formatWithDelimiters(number, precision, thousands, decimal) {
                                thousands = thousands || ',';
                                decimal = decimal || '.';

                                if (isNaN(number) || number === null) {
                                    return 0;
                                }

                                number = (number / 100.0).toFixed(precision);

                                var parts = number.split('.');
                                var dollarsAmount = parts[0].replace(
                                    /(\d)(?=(\d\d\d)+(?!\d))/g,
                                    '$1' + thousands
                                );
                                var centsAmount = parts[1] ? decimal + parts[1] : '';

                                return dollarsAmount + centsAmount;
                            }

                            switch (formatString.match(placeholderRegex)[1]) {
                                case 'amount':
                                    value = formatWithDelimiters(cents, 2);
                                    break;
                                case 'amount_no_decimals':
                                    value = formatWithDelimiters(cents, 0);
                                    break;
                                case 'amount_with_comma_separator':
                                    value = formatWithDelimiters(cents, 2, '.', ',');
                                    break;
                                case 'amount_no_decimals_with_comma_separator':
                                    value = formatWithDelimiters(cents, 0, '.', ',');
                                    break;
                                case 'amount_no_decimals_with_space_separator':
                                    value = formatWithDelimiters(cents, 0, ' ');
                                    break;
                                case 'amount_with_apostrophe_separator':
                                    value = formatWithDelimiters(cents, 2, "'");
                                    break;
                            }
                            return formatString.replace(placeholderRegex, value);
                        }

                        return {
                            formatMoney: formatMoney
                        };
                    })();

                    /**
                     * Image Helper Functions
                     * -----------------------------------------------------------------------------
                     * A collection of functions that help with basic image operations.
                     *
                     */

                    theme.Images = (function() {
                        /**
                         * Preloads an image in memory and uses the browsers cache to store it until needed.
                         *
                         * @param {Array} images - A list of image urls
                         * @param {String} size - A shopify image size attribute
                         */

                        function preload(images, size) {
                            if (typeof images === 'string') {
                                images = [images];
                            }

                            for (var i = 0; i < images.length; i++) {
                                var image = images[i];
                                this.loadImage(this.getSizedImageUrl(image, size));
                            }
                        }

                        /**
                         * Loads and caches an image in the browsers cache.
                         * @param {string} path - An image url
                         */
                        function loadImage(path) {
                            new Image().src = path;
                        }

                        /**
                         * Swaps the src of an image for another OR returns the imageURL to the callback function
                         * @param image
                         * @param element
                         * @param callback
                         */
                        function switchImage(image, element, callback) {
                            var size = this.imageSize(element.src);
                            var imageUrl = this.getSizedImageUrl(image.src, size);

                            if (callback) {
                                callback(imageUrl, image, element); // eslint-disable-line callback-return
                            } else {
                                element.src = imageUrl;
                            }
                        }

                        /**
                         * +++ Useful
                         * Find the Shopify image attribute size
                         *
                         * @param {string} src
                         * @returns {null}
                         */
                        function imageSize(src) {
                            src = src || '';

                            var match = src.match(
                                /.+_((?:pico|icon|thumb|small|compact|medium|large|grande)|\d{1,4}x\d{0,4}|x\d{1,4})[_\\.@]/
                            );

                            if (match === null) {
                                return null;
                            } else {
                                return match[1];
                            }
                        }

                        /**
                         * +++ Useful
                         * Adds a Shopify size attribute to a URL
                         *
                         * @param src
                         * @param size
                         * @returns {*}
                         */
                        function getSizedImageUrl(src, size) {
                            if (size === null) {
                                return src;
                            }

                            if (size === 'master') {
                                return this.removeProtocol(src);
                            }

                            var match = src.match(
                                /\.(jpg|jpeg|gif|png|bmp|bitmap|tiff|tif)(\?v=\d+)?$/i
                            );

                            if (match !== null) {
                                var prefix = src.split(match[0]);
                                var suffix = match[0];

                                return this.removeProtocol(prefix[0] + '_' + size + suffix);
                            }

                            return null;
                        }

                        function removeProtocol(path) {
                            return path.replace(/http(s)?:/, '');
                        }

                        return {
                            preload: preload,
                            loadImage: loadImage,
                            switchImage: switchImage,
                            imageSize: imageSize,
                            getSizedImageUrl: getSizedImageUrl,
                            removeProtocol: removeProtocol
                        };
                    })();

                    /**
                     * Variant Selection scripts
                     * ------------------------------------------------------------------------------
                     *
                     * Handles change events from the variant inputs in any `cart/add` forms that may
                     * exist.  Also updates the master select and triggers updates when the variants
                     * price or image changes.
                     *
                     * @namespace variants
                     */

                    slate.Variants = (function() {
                        /**
                         * Variant constructor
                         *
                         * @param {object} options - Settings from `product.js`
                         */
                        function Variants(options) {
                            this.$container = options.$container;
                            this.product = options.product;
                            this.singleOptionSelector = options.singleOptionSelector;
                            this.originalSelectorId = options.originalSelectorId;
                            this.enableHistoryState = options.enableHistoryState;
                            this.currentVariant = this._getVariantFromOptions();

                            $(this.singleOptionSelector, this.$container).on(
                                'change',
                                this._onSelectChange.bind(this)
                            );
                        }

                        Variants.prototype = _.assignIn({}, Variants.prototype, {
                            /**
                             * Get the currently selected options from add-to-cart form. Works with all
                             * form input elements.
                             *
                             * @return {array} options - Values of currently selected variants
                             */
                            _getCurrentOptions: function() {
                                var currentOptions = _.map(
                                    $(this.singleOptionSelector, this.$container),
                                    function(element) {
                                        var $element = $(element);
                                        var type = $element.attr('type');
                                        var currentOption = {};

                                        if (type === 'radio' || type === 'checkbox') {
                                            if ($element[0].checked) {
                                                currentOption.value = $element.val();
                                                currentOption.index = $element.data('index');

                                                return currentOption;
                                            } else {
                                                return false;
                                            }
                                        } else {
                                            currentOption.value = $element.val();
                                            currentOption.index = $element.data('index');

                                            return currentOption;
                                        }
                                    }
                                );

                                // remove any unchecked input values if using radio buttons or checkboxes
                                currentOptions = _.compact(currentOptions);

                                return currentOptions;
                            },

                            /**
                             * Find variant based on selected values.
                             *
                             * @param  {array} selectedValues - Values of variant inputs
                             * @return {object || undefined} found - Variant object from product.variants
                             */
                            _getVariantFromOptions: function() {
                                var selectedValues = this._getCurrentOptions();
                                var variants = this.product.variants;

                                var found = _.find(variants, function(variant) {
                                    return selectedValues.every(function(values) {
                                        return _.isEqual(variant[values.index], values.value);
                                    });
                                });

                                return found;
                            },

                            /**
                             * Event handler for when a variant input changes.
                             */
                            _onSelectChange: function() {
                                var variant = this._getVariantFromOptions();

                                this.$container.trigger({
                                    type: 'variantChange',
                                    variant: variant
                                });

                                if (!variant) {
                                    return;
                                }

                                this._updateMasterSelect(variant);
                                this._updateImages(variant);
                                this._updatePrice(variant);
                                this._updateSKU(variant);
                                this.currentVariant = variant;

                                if (this.enableHistoryState) {
                                    this._updateHistoryState(variant);
                                }
                            },

                            /**
                             * Trigger event when variant image changes
                             *
                             * @param  {object} variant - Currently selected variant
                             * @return {event}  variantImageChange
                             */
                            _updateImages: function(variant) {
                                var variantImage = variant.featured_image || {};
                                var currentVariantImage = this.currentVariant.featured_image || {};

                                if (!variant.featured_image ||
                                    variantImage.src === currentVariantImage.src
                                ) {
                                    return;
                                }

                                this.$container.trigger({
                                    type: 'variantImageChange',
                                    variant: variant
                                });
                            },

                            /**
                             * Trigger event when variant price changes.
                             *
                             * @param  {object} variant - Currently selected variant
                             * @return {event} variantPriceChange
                             */
                            _updatePrice: function(variant) {
                                if (
                                    variant.price === this.currentVariant.price &&
                                    variant.compare_at_price === this.currentVariant.compare_at_price
                                ) {
                                    return;
                                }

                                this.$container.trigger({
                                    type: 'variantPriceChange',
                                    variant: variant
                                });
                            },

                            /**
                             * Trigger event when variant sku changes.
                             *
                             * @param  {object} variant - Currently selected variant
                             * @return {event} variantSKUChange
                             */
                            _updateSKU: function(variant) {
                                if (variant.sku === this.currentVariant.sku) {
                                    return;
                                }

                                this.$container.trigger({
                                    type: 'variantSKUChange',
                                    variant: variant
                                });
                            },

                            /**
                             * Update history state for product deeplinking
                             *
                             * @param  {variant} variant - Currently selected variant
                             * @return {k}         [description]
                             */
                            _updateHistoryState: function(variant) {
                                if (!history.replaceState || !variant) {
                                    return;
                                }

                                var newurl =
                                    window.location.protocol +
                                    '//' +
                                    window.location.host +
                                    window.location.pathname +
                                    '?variant=' +
                                    variant.id;
                                window.history.replaceState({ path: newurl }, '', newurl);
                            },

                            /**
                             * Update hidden master select of variant change
                             *
                             * @param  {variant} variant - Currently selected variant
                             */
                            _updateMasterSelect: function(variant) {
                                $(this.originalSelectorId, this.$container).val(variant.id);
                            }
                        });

                        return Variants;
                    })();


                    /*================ MODULES ================*/
                    window.Drawers = (function() {
                        var Drawer = function(id, position, options) {
                            var defaults = {
                                close: '.js-drawer-close',
                                open: '.js-drawer-open-' + position,
                                openClass: 'js-drawer-open',
                                dirOpenClass: 'js-drawer-open-' + position
                            };

                            this.nodes = {
                                $parent: $('body, html'),
                                $page: $('.page-element'),
                                $moved: $('.is-moved-by-drawer')
                            };

                            this.config = $.extend(defaults, options);
                            this.position = position;

                            this.$drawer = $('#' + id);
                            this.$open = $(this.config.open);

                            if (!this.$drawer.length) {
                                return false;
                            }

                            this.drawerIsOpen = false;
                            this.init();
                        };

                        Drawer.prototype.init = function() {
                            this.$open.attr('aria-expanded', 'false');
                            this.$open.on('click', $.proxy(this.open, this));
                            this.$drawer.find(this.config.close).on('click', $.proxy(this.close, this));
                        };

                        Drawer.prototype.open = function(evt) {
                            // Keep track if drawer was opened from a click, or called by another function
                            var externalCall = false;

                            // don't open an opened drawer
                            if (this.drawerIsOpen) {
                                return;
                            }

                            this.$open.addClass(this.config.openClass);

                            // Prevent following href if link is clicked
                            if (evt) {
                                evt.preventDefault();
                            } else {
                                externalCall = true;
                            }

                            // Without this, the drawer opens, the click event bubbles up to $nodes.page
                            // which closes the drawer.
                            if (evt && evt.stopPropagation) {
                                evt.stopPropagation();
                                // save the source of the click, we'll focus to this on close
                                this.$activeSource = $(evt.currentTarget);
                            }

                            if (this.drawerIsOpen && !externalCall) {
                                return this.close();
                            }

                            // Add is-transitioning class to moved elements on open so drawer can have
                            // transition for close animation
                            this.nodes.$moved.addClass('is-transitioning');
                            this.$drawer.prepareTransition();

                            this.nodes.$parent.addClass(
                                this.config.openClass + ' ' + this.config.dirOpenClass
                            );
                            this.drawerIsOpen = true;

                            // Set focus on drawer
                            slate.a11y.trapFocus({
                                $container: this.$drawer,
                                namespace: 'drawer_focus'
                            });

                            // Run function when draw opens if set
                            if (
                                this.config.onDrawerOpen &&
                                typeof this.config.onDrawerOpen === 'function'
                            ) {
                                if (!externalCall) {
                                    this.config.onDrawerOpen();
                                }
                            }

                            if (this.$activeSource && this.$activeSource.attr('aria-expanded')) {
                                this.$activeSource.attr('aria-expanded', 'true');
                            }

                            this.bindEvents();
                        };

                        Drawer.prototype.close = function() {
                            // don't close a closed drawer
                            if (!this.drawerIsOpen) {
                                return;
                            }

                            this.$open.removeClass(this.config.openClass);

                            // deselect any focused form elements
                            $(document.activeElement).trigger('blur');

                            // Ensure closing transition is applied to moved elements, like the nav
                            this.nodes.$moved.prepareTransition({ disableExisting: true });
                            this.$drawer.prepareTransition({ disableExisting: true });

                            this.nodes.$parent.removeClass(
                                this.config.dirOpenClass + ' ' + this.config.openClass
                            );

                            this.drawerIsOpen = false;

                            // Remove focus on drawer
                            slate.a11y.removeTrapFocus({
                                $container: this.$drawer,
                                namespace: 'drawer_focus'
                            });

                            if (this.$activeSource && this.$activeSource.attr('aria-expanded')) {
                                this.$activeSource.attr('aria-expanded', 'false');
                            }

                            this.unbindEvents();
                        };

                        Drawer.prototype.bindEvents = function() {
                            // Lock scrolling on mobile
                            this.nodes.$page.on('touchmove.drawer', function() {
                                return false;
                            });

                            // Clicking out of drawer closes it
                            this.nodes.$page.on(
                                'click.drawer',
                                $.proxy(function() {
                                    this.close();
                                    return false;
                                }, this)
                            );

                            // Pressing escape closes drawer
                            this.nodes.$parent.on(
                                'keyup.drawer',
                                $.proxy(function(evt) {
                                    if (evt.keyCode === 27) {
                                        this.close();
                                    }
                                }, this)
                            );
                        };

                        Drawer.prototype.unbindEvents = function() {
                            this.nodes.$page.off('.drawer');
                            this.nodes.$parent.off('.drawer');
                        };

                        return Drawer;
                    })();

                    window.Modals = (function() {
                        var Modal = function(id, name, options) {
                            var defaults = {
                                close: '.js-modal-close',
                                open: '.js-modal-open-' + name,
                                openClass: 'modal--is-active'
                            };

                            this.$modal = $('#' + id);

                            if (!this.$modal.length) {
                                return false;
                            }

                            this.nodes = {
                                $body: $('body')
                            };

                            this.config = $.extend(defaults, options);

                            this.modalIsOpen = false;
                            this.$focusOnOpen = this.config.focusOnOpen ?
                                $(this.config.focusOnOpen) :
                                this.$modal;
                            this.init();
                        };

                        Modal.prototype.init = function() {
                            var $openBtn = $(this.config.open);

                            // Add aria controls
                            $openBtn.attr('aria-expanded', 'false');

                            $(this.config.open).on('click', $.proxy(this.open, this));
                            this.$modal.find(this.config.close).on('click', $.proxy(this.close, this));
                        };

                        Modal.prototype.open = function(evt) {
                            // Keep track if modal was opened from a click, or called by another function
                            var externalCall = false;

                            // don't open an opened modal
                            if (this.modalIsOpen) {
                                return;
                            }

                            // Prevent following href if link is clicked
                            if (evt) {
                                evt.preventDefault();
                            } else {
                                externalCall = true;
                            }

                            // Without this, the modal opens, the click event bubbles up to $nodes.page
                            // which closes the modal.
                            if (evt && evt.stopPropagation) {
                                evt.stopPropagation();
                                // save the source of the click, we'll focus to this on close
                                this.$activeSource = $(evt.currentTarget);
                            }

                            if (this.modalIsOpen && !externalCall) {
                                return this.close();
                            }

                            this.$modal.prepareTransition().addClass(this.config.openClass);
                            this.nodes.$body.addClass(this.config.openClass);

                            this.modalIsOpen = true;

                            // Set focus on modal
                            slate.a11y.trapFocus({
                                $container: this.$modal,
                                namespace: 'modal_focus',
                                $elementToFocus: this.$focusOnOpen
                            });

                            if (this.$activeSource && this.$activeSource.attr('aria-expanded')) {
                                this.$activeSource.attr('aria-expanded', 'true');
                            }

                            this.bindEvents();
                        };

                        Modal.prototype.close = function() {
                            // don't close a closed modal
                            if (!this.modalIsOpen) {
                                return;
                            }

                            // deselect any focused form elements
                            $(document.activeElement).trigger('blur');

                            this.$modal.prepareTransition().removeClass(this.config.openClass);
                            this.nodes.$body.removeClass(this.config.openClass);

                            this.modalIsOpen = false;

                            // Remove focus on modal
                            slate.a11y.removeTrapFocus({
                                $container: this.$modal,
                                namespace: 'modal_focus'
                            });

                            if (this.$activeSource && this.$activeSource.attr('aria-expanded')) {
                                this.$activeSource.attr('aria-expanded', 'false').focus();
                            }

                            this.unbindEvents();
                        };

                        Modal.prototype.bindEvents = function() {
                            // Pressing escape closes modal
                            this.nodes.$body.on(
                                'keyup.modal',
                                $.proxy(function(evt) {
                                    if (evt.keyCode === 27) {
                                        this.close();
                                    }
                                }, this)
                            );
                        };

                        Modal.prototype.unbindEvents = function() {
                            this.nodes.$body.off('.modal');
                        };

                        return Modal;
                    })();

                    window.QtySelector = (function() {
                        var QtySelector = function($el) {
                            this.cache = {
                                $body: $('body'),
                                $subtotal: $('#CartSubtotal'),
                                $discountTotal: $('#cartDiscountTotal'),
                                $cartTable: $('.cart-table'),
                                $cartTemplate: $('#CartProducts')
                            };

                            this.settings = {
                                loadingClass: 'js-qty--is-loading',
                                isCartTemplate: this.cache.$body.hasClass('template-cart'),
                                // On the cart template, minimum is 0. Elsewhere min is 1
                                minQty: this.cache.$body.hasClass('template-cart') ? 0 : 1
                            };

                            this.$el = $el;
                            this.qtyUpdateTimeout;
                            this.createInputs();
                            this.bindEvents();
                        };

                        QtySelector.prototype.createInputs = function() {
                            var $el = this.$el;

                            var data = {
                                value: $el.val(),
                                key: $el.attr('id'),
                                name: $el.attr('name'),
                                line: $el.attr('data-line')
                            };
                            var source = $('#QuantityTemplate').html();
                            var template = Handlebars.compile(source);

                            this.$wrapper = $(template(data)).insertBefore($el);

                            // Remove original number input
                            $el.remove();
                        };

                        QtySelector.prototype.validateAvailability = function(line, quantity) {
                            var product = theme.cartObject.items[line - 1]; // 0-based index in API
                            var handle = product.handle; // needed for the ajax request
                            var id = product.id; // needed to find right variant from ajax results

                            var params = {
                                type: 'GET',
                                url: '/products/' + handle + '.js',
                                dataType: 'json',
                                success: $.proxy(function(cartProduct) {
                                    this.validateAvailabilityCallback(line, quantity, id, cartProduct);
                                }, this)
                            };

                            $.ajax(params);
                        };

                        QtySelector.prototype.validateAvailabilityCallback = function(
                            line,
                            quantity,
                            id,
                            product
                        ) {
                            var quantityIsAvailable = true;

                            // This returns all variants of a product.
                            // Loop through them to get our desired one.
                            for (var i = 0; i < product.variants.length; i++) {
                                var variant = product.variants[i];
                                if (variant.id === id) {
                                    break;
                                }
                            }

                            // If the variant tracks inventory and does not sell when sold out
                            // we can compare the requested with available quantity
                            if (
                                variant.inventory_management !== null &&
                                variant.inventory_policy === 'deny'
                            ) {
                                if (variant.inventory_quantity < quantity) {

                                    // Set quantity to max amount available
                                    this.$wrapper.find('.js-qty__input').val(variant.inventory_quantity);

                                    quantityIsAvailable = false;
                                    this.$wrapper.removeClass(this.settings.loadingClass);
                                }
                            }

                            if (quantityIsAvailable) {
                                this.updateItemQuantity(line, quantity);
                            }
                        };

                        QtySelector.prototype.validateQty = function(qty) {
                            if (parseFloat(qty) === parseInt(qty, 10) && !isNaN(qty)) {
                                // We have a valid number!
                            } else {
                                // Not a number. Default to 1.
                                qty = 1;
                            }
                            return parseInt(qty, 10);
                        };

                        QtySelector.prototype.adjustQty = function(evt) {
                            var $el = $(evt.currentTarget);
                            var $input = $el.siblings('.js-qty__input');
                            var qty = this.validateQty($input.val());
                            var line = $input.attr('data-line');

                            if ($el.hasClass('js-qty__adjust--minus')) {
                                qty -= 1;
                                if (qty <= this.settings.minQty) {
                                    qty = this.settings.minQty;
                                }
                            } else {
                                qty += 1;
                            }

                            if (this.settings.isCartTemplate) {
                                $el.parent().addClass(this.settings.loadingClass);
                                this.updateCartItemPrice(line, qty);
                            } else {
                                $input.val(qty);
                            }
                        };

                        QtySelector.prototype.bindEvents = function() {
                            this.$wrapper
                                .find('.js-qty__adjust')
                                .on('click', $.proxy(this.adjustQty, this));

                            // Select input text on click
                            this.$wrapper.on('click', '.js-qty__input', function() {
                                this.setSelectionRange(0, this.value.length);
                            });

                            // If the quantity changes on the cart template, update the price
                            if (this.settings.isCartTemplate) {
                                this.$wrapper.on(
                                    'change',
                                    '.js-qty__input',
                                    $.proxy(function(evt) {
                                        var $input = $(evt.currentTarget);
                                        var line = $input.attr('data-line');
                                        var qty = this.validateQty($input.val());
                                        $input.parent().addClass(this.settings.loadingClass);
                                        this.updateCartItemPrice(line, qty);
                                    }, this)
                                );
                            }
                        };

                        QtySelector.prototype.updateCartItemPrice = function(line, qty) {
                            // Update cart after short timeout so user doesn't create simultaneous ajax calls
                            clearTimeout(this.qtyUpdateTimeout);
                            this.qtyUpdateTimeout = setTimeout(
                                $.proxy(function() {
                                    this.validateAvailability(line, qty);
                                }, this),
                                200
                            );
                        };

                        QtySelector.prototype.updateItemQuantity = function(line, quantity) {
                            var params = {
                                type: 'POST',
                                url: '/cart/change.js',
                                data: 'quantity=' + quantity + '&line=' + line,
                                dataType: 'json',
                                success: $.proxy(function(cart) {
                                    this.updateCartItemCallback(cart);
                                }, this)
                            };

                            $.ajax(params);
                        };

                        QtySelector.prototype.updateCartItemCallback = function(cart) {
                            // Reload the page to show the empty cart if no items
                            if (cart.item_count === 0) {
                                location.reload();
                                return;
                            }

                            // Update cart object
                            theme.cartObject = cart;

                            // Handlebars.js cart layout
                            var data = {};
                            var items = [];
                            var item = {};
                            var source = $('#CartProductTemplate').html();
                            var template = Handlebars.compile(source);
                            var prodImg;

                            // Add each item to our handlebars.js data
                            $.each(cart.items, function(index, cartItem) {
                                /* Hack to get product image thumbnail
                                 *   - If image is not null
                                 *     - Remove file extension, add 240x240, and re-add extension
                                 *     - Create server relative link
                                 *   - A hard-coded url of no-image
                                 */

                                if (cartItem.image === null) {
                                    prodImg =
                                        '//cdn.shopify.com/s/assets/admin/no-image-medium-cc9732cb976dd349a0df1d39816fbcc7.gif';
                                } else {
                                    prodImg = cartItem.image
                                        .replace(/(\.[^.]*)$/, '_240x240$1')
                                        .replace('http:', '');
                                }

                                if (cartItem.properties !== null) {
                                    $.each(cartItem.properties, function(key, value) {
                                        if (key.charAt(0) === '_' || !value) {
                                            delete cartItem.properties[key];
                                        }
                                    });
                                }

                                // Create item's data object and add to 'items' array
                                item = {
                                    key: cartItem.key,
                                    line: index + 1, // Shopify uses a 1+ index in the API
                                    url: cartItem.url,
                                    img: prodImg,
                                    name: cartItem.product_title,
                                    variation: cartItem.variant_title,
                                    properties: cartItem.properties,
                                    itemQty: cartItem.quantity,
                                    price: theme.Currency.formatMoney(cartItem.price, theme.moneyFormat),
                                    vendor: cartItem.vendor,
                                    linePrice: theme.Currency.formatMoney(
                                        cartItem.line_price,
                                        theme.moneyFormat
                                    ),
                                    originalLinePrice: theme.Currency.formatMoney(
                                        cartItem.original_line_price,
                                        theme.moneyFormat
                                    ),
                                    discounts: cartItem.discounts,
                                    discountsApplied: cartItem.line_price === cartItem.original_line_price ? false : true
                                };

                                items.push(item);
                                theme.updateCurrencies();
                            });

                            // Gather all cart data and add to DOM
                            data = {
                                items: items
                            };
                            this.cache.$cartTemplate.empty().append(template(data));

                            // Create new quantity selectors
                            this.cache.$cartTable.find('input[type="number"]').each(function(i, el) {
                                new QtySelector($(el));
                            });

                            // Update the cart subtotal
                            this.cache.$subtotal.html(
                                theme.Currency.formatMoney(cart.total_price, theme.moneyFormat)
                            );

                            // Update the cart total discounts
                            if (cart.total_discount > 0) {
                                this.cache.$discountTotal.html(
                                    theme.strings.totalCartDiscount.replace(
                                        '[savings]',
                                        theme.Currency.formatMoney(cart.total_discount, theme.moneyFormat)
                                    )
                                );
                            } else {
                                this.cache.$discountTotal.empty();
                            }

                            theme.miniCart.updateElements();
                            theme.updateCurrencies();
                            // Set focus on cart table
                            slate.a11y.pageLinkFocus(this.cache.$cartTable);
                        };

                        return QtySelector;
                    })();

                    /*
                      Allow product to be added to cart via ajax with
                      custom success and error responses.
                    */
                    window.AjaxCart = (function() {
                        var styleCart = $('.js-mini-cart').attr("data-cartmini");
                        var cart = function($form) {
                            this.cache = {
                                $cartIconIndicator: $('.site-header__cart-indicator')
                            };

                            this.$form = $form;
                            this.eventListeners();

                            this.showNotice = false;
                            if (this.$form.length) {
                                this.showNotice = this.$form.hasClass('js-form--notice') ? true : false;
                            }
                        };

                        cart.prototype.eventListeners = function() {
                            if (this.$form.length) {
                                this.$form.on('submit', $.proxy(this.addItemFromForm, this));
                            }
                        };

                        cart.prototype.addItemFromForm = function(evt) {
                            evt.preventDefault();

                            var params = {
                                type: 'POST',
                                url: '/cart/add.js',
                                data: this.$form.serialize(),
                                dataType: 'json',
                                success: $.proxy(function(lineItem) {
                                    //this.success(lineItem);
                                    window.location.href = '/cart';
                                }, this),
                                error: $.proxy(function(XMLHttpRequest, textStatus) {
                                    this.error(XMLHttpRequest, textStatus);
                                }, this)
                            };
                            $.ajax(params);
                        };

                        cart.prototype.success = function(item) {
                            theme.miniCart.updateElements();
                            theme.miniCart.generateCart();
                            if (styleCart != 'false') {
                                if (this.showNotice) {
                                    var htmlVariant = item.variant_title !== null ? '<i>(' + item.variant_title + ')</i>' : '';
                                    var htmlAlert = '<div class="media mt-2 alert--cart"><a class="mr-3" href="/cart"><img class="lazyload" data-src="' + item.image + '"></a><div class="media-body align-self-center"><p class="m-0 font-weight-bold">' + item.product_title + ' x ' + item.quantity + '</p>' + htmlVariant + '<div><div>';
                                    theme.alert.new(theme.strings.addToCartSuccess, htmlAlert, 3000, 'notice');
                                } else {
                                    theme.crosssell.showPopup(item);
                                }
                            }
                        };

                        // Error handling reference from Shopify.onError in api.jquery.js
                        cart.prototype.error = function(XMLHttpRequest) {
                            var data = JSON.parse(XMLHttpRequest.responseText);

                            if (data.message) {
                                theme.alert.new('', data.description, 3000, 'warning');
                            }
                        };

                        return cart;
                    })();

                    /*================ TEMPLATES ================*/
                    theme.customerTemplates = (function() {
                        function initEventListeners() {
                            // Show reset password form
                            $('#RecoverPassword').on('click', function(evt) {
                                evt.preventDefault();
                                toggleRecoverPasswordForm();
                            });

                            // Hide reset password form
                            $('#HideRecoverPasswordLink').on('click', function(evt) {
                                evt.preventDefault();
                                toggleRecoverPasswordForm();
                            });
                        }

                        /**
                         *
                         *  Show/Hide recover password form
                         *
                         */
                        function toggleRecoverPasswordForm() {
                            $('#RecoverPasswordForm').toggleClass('hide');
                            $('#CustomerLoginForm').toggleClass('hide');
                        }

                        /**
                         *
                         *  Show reset password success message
                         *
                         */
                        function resetPasswordSuccess() {
                            // check if reset password form was successfully submited
                            if (!$('.reset-password-success').length) {
                                return;
                            }

                            // show success message
                            $('#ResetSuccess').removeClass('hide');
                        }

                        /**
                         *
                         *  Show/hide customer address forms
                         *
                         */
                        function customerAddressForm() {
                            var $newAddressForm = $('#AddressNewForm');

                            if (!$newAddressForm.length) {
                                return;
                            }

                            // Initialize observers on address selectors, defined in shopify_common.js
                            if (Shopify) {
                                // eslint-disable-next-line no-new
                                new Shopify.CountryProvinceSelector(
                                    'AddressCountryNew',
                                    'AddressProvinceNew', {
                                        hideElement: 'AddressProvinceContainerNew'
                                    }
                                );
                            }

                            // Initialize each edit form's country/province selector
                            $('.address-country-option').each(function() {
                                var formId = $(this).data('form-id');
                                var countrySelector = 'AddressCountry_' + formId;
                                var provinceSelector = 'AddressProvince_' + formId;
                                var containerSelector = 'AddressProvinceContainer_' + formId;

                                // eslint-disable-next-line no-new
                                new Shopify.CountryProvinceSelector(countrySelector, provinceSelector, {
                                    hideElement: containerSelector
                                });
                            });

                            // Toggle new/edit address forms
                            $('.address-new-toggle').on('click', function() {
                                $newAddressForm.toggleClass('hide');
                            });

                            $('.address-edit-toggle').on('click', function() {
                                var formId = $(this).data('form-id');
                                $('#EditAddress_' + formId).toggleClass('hide');
                            });

                            $('.address-delete').on('click', function() {
                                var $el = $(this);
                                var formId = $el.data('form-id');
                                var confirmMessage = $el.data('confirm-message');

                                // eslint-disable-next-line no-alert
                                if (
                                    confirm(
                                        confirmMessage || 'Are you sure you wish to delete this address?'
                                    )
                                ) {
                                    Shopify.postLink('/account/addresses/' + formId, {
                                        parameters: { _method: 'delete' }
                                    });
                                }
                            });
                        }

                        /**
                         *
                         *  Check URL for reset password hash
                         *
                         */
                        function checkUrlHash() {
                            var hash = window.location.hash;

                            // Allow deep linking to recover password form
                            if (hash === '#recover') {
                                toggleRecoverPasswordForm();
                            }
                        }

                        return {
                            init: function() {
                                checkUrlHash();
                                initEventListeners();
                                resetPasswordSuccess();
                                customerAddressForm();
                            }
                        };
                    })();

                    /*================ SECTIONS ================*/
                    theme.HeaderSection = (function() {
                        function Header() {
                            theme.NavDrawer = new window.Drawers('NavDrawer', 'left');
                        }

                        return Header;
                    })();

                    theme.Product = (function() {
                        var defaults = {
                            smallBreakpoint: 750,
                            productThumbIndex: 0,
                            productThumbMax: 0,
                            ajaxCart: false,
                            stockSetting: false
                        };

                        function Product(container) {
                            var $container = (this.$container = $(container));
                            var sectionId = $container.attr('data-section-id');

                            this.selectors = {
                                originalSelectorId: '#ProductSelect-' + sectionId,
                                modal: 'ProductModal',
                                productZoomImage: '#ProductZoomImg',
                                addToCart: '#AddToCart-' + sectionId,
                                productPrice: '#ProductPrice-' + sectionId,
                                comparePrice: '#ComparePrice-' + sectionId,
                                addToCartText: '#AddToCartText-' + sectionId,
                                SKU: '.js-variant-sku',
                                productImageContainers: '.product__photo-container-' + sectionId,
                                productImageWrappers: '.product__photo-wrapper-' + sectionId,
                                productThumbContainers: '.product-single__thumbnail-item-' + sectionId,
                                productThumbsWrapper: '.product-single__thumbnails-' + sectionId,
                                productThumbs: '.product-single__thumbnail-' + sectionId,
                                saleTag: '#ProductSaleTag-' + sectionId,
                                productStock: '#ProductStock-' + sectionId,
                                singleOptionSelector: '.single-option-selector-' + sectionId,
                                shopifyPaymentButton: '.shopify-payment-button',
                                availability: '.product-single__availability',
                                hurrify: '.js-hurrify'
                            };

                            this.settings = $.extend({}, defaults, {
                                sectionId: sectionId,
                                ajaxCart: $container.data('ajax'),
                                stockSetting: $container.data('stock'),
                                enableHistoryState: $container.data('enable-history-state') || false,
                                namespace: '.product-' + sectionId
                            });

                            // Stop parsing if we don't have the product json script tag
                            if (!$('#ProductJson-' + sectionId).html()) {
                                return;
                            }

                            this.productSingleObject = JSON.parse(
                                $('#ProductJson-' + sectionId).html()
                            );
                            this.addVariantInfo();

                            this.init();
                        }

                        Product.prototype = _.assignIn({}, Product.prototype, {
                            init: function() {
                                this._stringOverrides();
                                this._initVariants();
                                this._productZoomImage();
                                this._productThumbSwitch();
                                this._productThumbnailSlider();
                                this._initQtySelector();

                                if (this.settings.ajaxCart) {
                                    theme.AjaxCart = new window.AjaxCart(
                                        $('#AddToCartForm-' + this.settings.sectionId)
                                    );
                                }
                            },

                            _stringOverrides: function() {
                                window.productStrings = window.productStrings || {};
                                $.extend(theme.strings, window.productStrings);
                            },

                            addVariantInfo: function() {
                                if (!this.productSingleObject || !this.settings.stockSetting) {
                                    return;
                                }

                                var variantInfo = JSON.parse(
                                    $('#VariantJson-' + this.settings.sectionId).html()
                                );

                                for (var i = 0; i < variantInfo.length; i++) {
                                    $.extend(this.productSingleObject.variants[i], variantInfo[i]);
                                }
                            },

                            _initVariants: function() {
                                var options = {
                                    $container: this.$container,
                                    enableHistoryState: this.settings.enableHistoryState,
                                    product: this.productSingleObject,
                                    singleOptionSelector: this.selectors.singleOptionSelector,
                                    originalSelectorId: this.selectors.originalSelectorId
                                };

                                // eslint-disable-next-line no-new
                                this.variants = new slate.Variants(options);

                                this.$container.on(
                                    'variantChange' + this.settings.namespace,
                                    this._updateAddToCartBtn.bind(this)
                                );
                                this.$container.on(
                                    'variantChange' + this.settings.namespace,
                                    this._updateStickyCart.bind(this)
                                );
                                this.$container.on(
                                    'variantPriceChange' + this.settings.namespace,
                                    this._updatePrice.bind(this)
                                );
                                this.$container.on(
                                    'variantSKUChange' + this.settings.namespace,
                                    this._updateSKU.bind(this)
                                );
                                this.$container.on(
                                    'variantImageChange' + this.settings.namespace,
                                    this._updateImages.bind(this)
                                );
                            },

                            _updateStock: function(variant) {
                                if (!this.settings.stockSetting) return;

                                var $stock = $(this.selectors.productStock),
                                    $hurrify = $(this.selectors.hurrify);

                                // If we don't track variant inventory, hide stock
                                if (!variant || !variant.inventory_management) {
                                    $stock.addClass('hide');
                                    $hurrify.addClass('hide');
                                    return;
                                }

                                if (variant.inventory_quantity < 10 && variant.inventory_quantity > 0) {
                                    $stock
                                        .html(
                                            theme.strings.stockAvailable.replace(
                                                '1',
                                                variant.inventory_quantity
                                            )
                                        )
                                        .removeClass('hide');
                                    $hurrify.removeClass('hide').find('.progress-bar').css('width', variant.inventory_quantity * 10 + '%');
                                    return;
                                }

                                if (variant.inventory_quantity <= 0 && variant.incoming) {
                                    $stock
                                        .html(
                                            theme.strings.willNotShipUntil.replace(
                                                '[date]',
                                                variant.next_incoming_date
                                            )
                                        )
                                        .removeClass('hide');
                                    $hurrify.addClass('hide');
                                    return;
                                }

                                // If there's more than 10 available, hide stock
                                $stock.addClass('hide');
                                $hurrify.addClass('hide');
                            },

                            _updateIncomingInfo: function(variant) {
                                if (!this.settings.stockSetting) return;

                                var $stock = $(this.selectors.productStock);

                                if (variant.incoming) {
                                    $stock
                                        .html(
                                            theme.strings.willBeInStockAfter.replace(
                                                '[date]',
                                                variant.next_incoming_date
                                            )
                                        )
                                        .removeClass('hide');
                                    return;
                                }

                                // If there is no stock incoming, hide stock
                                $stock.addClass('hide');
                            },

                            _updateAddToCartBtn: function(evt) {
                                var variant = evt.variant;

                                var cache = {
                                    $addToCart: $(this.selectors.addToCart),
                                    $addToCartText: $(this.selectors.addToCartText)
                                };

                                if (variant) {
                                    // Select a valid variant if available
                                    theme.noticeSoldout.init(variant);
                                    if (variant.available) {
                                        // We have a valid product variant, so enable the submit button
                                        cache.$addToCart.removeClass('btn--sold-out').prop('disabled', false);
                                        cache.$addToCartText.html(theme.strings.addToCart);
                                        $(this.selectors.shopifyPaymentButton, this.$container).show();
                                        // Show how many items are left, if below 10
                                        this._updateStock(variant);
                                        //update availability - available
                                        $(this.selectors.availability).find('span').text(theme.strings.available);
                                    } else {
                                        // Variant is sold out, disable the submit button
                                        cache.$addToCart.prop('disabled', true).addClass('btn--sold-out');
                                        cache.$addToCartText.html(theme.strings.soldOut);
                                        $(this.selectors.shopifyPaymentButton, this.$container).hide();
                                        // Update when stock will be available
                                        this._updateIncomingInfo(variant);
                                        //update availability - soldout
                                        $(this.selectors.availability).find('span').text(theme.strings.soldOut);
                                    }
                                } else {
                                    cache.$addToCart.prop('disabled', true).removeClass('btn--sold-out');
                                    cache.$addToCartText.html(theme.strings.unavailable);
                                    //update availability - unavailable
                                    $(this.selectors.availability).find('span').text(theme.strings.unavailable);
                                    $(this.selectors.shopifyPaymentButton, this.$container).hide();
                                    // Hide stock display
                                    this._updateStock();
                                }
                            },

                            _updatePrice: function(evt) {
                                var variant = evt.variant;

                                if (variant) {
                                    $(this.selectors.productPrice).html(
                                        theme.Currency.formatMoney(variant.price, theme.moneyFormat)
                                    );

                                    // Update and show the product's compare price if necessary
                                    if (variant.compare_at_price > variant.price) {
                                        $(this.selectors.comparePrice)
                                            .html(
                                                theme.Currency.formatMoney(
                                                    variant.compare_at_price,
                                                    theme.moneyFormat
                                                )
                                            )
                                            .removeClass('hide');
                                        $(this.selectors.saleTag).removeClass('hide');
                                    } else {
                                        $(this.selectors.comparePrice).addClass('hide');
                                        $(this.selectors.saleTag).addClass('hide');
                                    }

                                    theme.updateCurrencies();
                                } else {
                                    $(this.selectors.comparePrice).addClass('hide');
                                }
                            },

                            _updateSKU: function(evt) {
                                var variant = evt.variant;

                                if (variant) {
                                    $(this.selectors.SKU).html(variant.sku);
                                }
                            },

                            _updateImages: function(evt) {
                                var variant = evt.variant;

                                if (variant && variant.featured_image) {
                                    var imageId = variant.featured_image.id;
                                    this.switchProductImage(imageId);
                                    this.setActiveThumbnail(imageId);
                                }
                            },
                            _updateStickyCart: function(evt) {
                                var variant = evt.variant,
                                    $stickyPrice = $('#js-sticky-price'),
                                    $stickyTitle = $('#js-sticky-title'),
                                    $stickyImage = $('#js-sticky-img'),
                                    $stickyButton = $('#js-sticky-btn');
                                if (variant) {
                                    //update title
                                    $stickyTitle.html(' - ' + variant.title);
                                    //update price
                                    $stickyPrice.html(theme.Currency.formatMoney(variant.price, theme.moneyFormat));
                                    //update selectbox
                                    for (var i = 1; i <= 3; i++) {
                                        var option = 'option' + i,
                                            $selecBox = '#js-sticky-option-' + i;
                                        if (variant[option] !== null) {
                                            var valueOption = variant[option];
                                            $($selecBox).val(valueOption);
                                        }
                                    }
                                    //update button cart
                                    if (variant.available) {
                                        $stickyButton.prop('disabled', false).removeClass('btn--sold-out');
                                        $stickyButton.html(theme.strings.addToCart);
                                    } else {
                                        $stickyButton.prop('disabled', true).addClass('btn--sold-out');
                                        $stickyButton.html(theme.strings.soldOut);
                                    }
                                    //update image
                                    if (variant.featured_image) {
                                        $stickyImage.attr('src', theme.Images.getSizedImageUrl(variant.featured_image.src, '200x'));
                                    }
                                } else {
                                    //update title
                                    $stickyTitle.html(' - ' + theme.strings.unavailable);
                                    //update button cart
                                    $stickyButton.prop('disabled', true).removeClass('btn--sold-out');
                                    $stickyButton.html(theme.strings.unavailable);
                                }
                            },

                            switchProductImage: function(imageId) {
                                var $imageToShow = $(
                                    this.selectors.productImageContainers +
                                    "[data-image-id='" +
                                    imageId +
                                    "']",
                                    this.$container
                                );
                                var $imagesToHide = $(
                                    this.selectors.productImageContainers +
                                    ":not([data-image-id='" +
                                    imageId +
                                    "'])",
                                    this.$container
                                );
                                $imagesToHide.addClass('hide');
                                $imageToShow.removeClass('hide');
                                //Scroll to active
                                topMenuHeight = $('.site-header').outerHeight();
                                if (this.settings.sectionId === 'product-template-8') {
                                    $([document.documentElement, document.body]).animate({
                                        scrollTop: $imageToShow.offset().top - topMenuHeight
                                    }, 500);
                                }
                            },

                            setActiveThumbnail: function(imageId) {
                                var $thumbnailToShow = $(
                                    this.selectors.productThumbContainers +
                                    "[data-image-id='" +
                                    imageId +
                                    "']",
                                    this.$container
                                );
                                var $thumbnailsToHide = $(
                                    this.selectors.productThumbContainers +
                                    ":not([data-image-id='" +
                                    imageId +
                                    "'])",
                                    this.$container
                                );
                                $thumbnailsToHide.removeClass('is-active');
                                $thumbnailToShow.addClass('is-active');
                                $thumbnailToShow.trigger('click');
                                var $thumbnails = $(this.selectors.productThumbsWrapper, this.$container);

                                // If there is a slick carousel, get the slide index, and position it into view with animation.
                                if ($thumbnails.hasClass('slick-initialized')) {
                                    // eslint-disable-next-line shopify/jquery-dollar-sign-reference
                                    var currentActiveSlideIndex = $thumbnails.slick('slickCurrentSlide');
                                    var newActiveSlideIndex = parseInt(
                                        $thumbnailToShow.attr('data-slick-index')
                                    );
                                    if (currentActiveSlideIndex !== newActiveSlideIndex) {
                                        $thumbnails.slick('slickGoTo', newActiveSlideIndex, false);

                                    }
                                }
                            },

                            _productZoomImage: function() {
                                // The zoom image is only used on the product template, so return early
                                // even if a featured product section is present.
                                if (!$('.product-single ' + this.selectors.productImageContainers).length) {
                                    return;
                                }

                                var self = this;

                                $(this.selectors.productImageWrappers).on(
                                    'click' + this.settings.namespace,
                                    function(evt) {
                                        evt.preventDefault();
                                        // Empty src before loadig new image to avoid awkward image swap
                                        $(self.selectors.productZoomImage)
                                            .attr('src', '')
                                            .attr('src', $(this).attr('href'));
                                    }
                                );

                                this.ProductModal = new window.Modals(
                                    this.selectors.modal,
                                    'product-modal'
                                );

                                // Close modal if clicked, but not if the image is clicked
                                this.ProductModal.$modal.on('click' + this.settings.namespace, function(
                                    evt
                                ) {
                                    if (evt.target.nodeName !== 'IMG') {
                                        self.ProductModal.close();
                                    }
                                });
                            },

                            _productThumbSwitch: function() {
                                if (!$(this.selectors.productThumbs).length) {
                                    return;
                                }

                                var self = this;

                                $(this.selectors.productThumbs).on(
                                    'click' + this.settings.namespace,
                                    function(evt) {
                                        evt.preventDefault();
                                        var imageId = $(this)
                                            .parent()
                                            .data('image-id');
                                        self.setActiveThumbnail(imageId);
                                        self.switchProductImage(imageId);
                                    }
                                );
                                //trigger hover thumb
                                // $(this.selectors.productThumbs).on('click',function(){
                                //   $(this).trigger('click');
                                // });
                            },

                            /*
                              Thumbnail slider
                             */
                            _productThumbnailSlider: function() {
                                var $productThumbsWrapper = $(this.selectors.productThumbsWrapper);
                                var $productThumbs = $(this.selectors.productThumbs);
                                if (!$productThumbs.length) {
                                    return;
                                }

                                if ($productThumbs.length > 1) {
                                    $productThumbsWrapper.on(
                                        'init' + this.settings.namespace,
                                        this._productSwipeInit.bind(this)
                                    );

                                    if (this.settings.sectionId === 'product-template-3' || this.settings.sectionId === 'product-template-4') {
                                        $productThumbsWrapper.slick({
                                            accessibility: false,
                                            arrows: true,
                                            dots: false,
                                            infinite: false,
                                            autoplay: false,
                                            slidesToShow: 5,
                                            slidesToScroll: 5,
                                            vertical: true,
                                            verticalSwiping: true,
                                            responsive: [{
                                                breakpoint: 992,
                                                settings: {
                                                    vertical: false,
                                                    verticalSwiping: false,
                                                    slidesToShow: 4,
                                                    slidesToScroll: 4,
                                                    dots: false,
                                                }
                                            }]
                                        }).css('opacity', '1');
                                    } else if (this.settings.sectionId === 'product-template-5') {
                                        $productThumbsWrapper.slick({
                                            accessibility: false,
                                            arrows: true,
                                            dots: false,
                                            infinite: true,
                                            autoplay: false,
                                            slidesToShow: 2,
                                            slidesToScroll: 1,
                                            responsive: [{
                                                breakpoint: 992,
                                                settings: {
                                                    slidesToShow: 4,
                                                    slidesToScroll: 4,
                                                    dots: false,
                                                }
                                            }]
                                        }).css('opacity', '1');
                                    } else if (this.settings.sectionId === 'product-template-7') {
                                        $productThumbsWrapper.slick({
                                            accessibility: false,
                                            arrows: true,
                                            dots: true,
                                            infinite: true,
                                            autoplay: false,
                                            slidesToShow: 1,
                                            slidesToScroll: 1,
                                            responsive: [{
                                                breakpoint: 992,
                                                settings: {
                                                    slidesToShow: 1,
                                                    slidesToScroll: 1,
                                                    dots: false,
                                                    arrows: true,
                                                }
                                            }]
                                        }).css('opacity', '1');
                                    } else if (this.settings.sectionId === 'product-template-8') {
                                        var lastId,
                                            topMenu = $(".product-single__thumbnails"),
                                            topMenuHeight = $('.site-header').outerHeight() + 20,
                                            // All list items
                                            menuItems = topMenu.find(".product-single__thumbnail");


                                        if ($(window).width() > 767) {
                                            menuItems.click(function(e) {
                                                var findid = $(this).attr('href');
                                                offsetTop = $(findid).offset().top - topMenuHeight + 1;
                                                $('html, body').stop().animate({
                                                    scrollTop: offsetTop
                                                }, 200);
                                                return false;
                                            });
                                            // Anchors corresponding to menu items
                                            scrollItems = menuItems.map(function() {
                                                var item = $($(this).attr('href'));
                                                if (item.length) { return item; }
                                            });

                                            $(window).scroll(function() {
                                                // Get container scroll position
                                                var fromTop = $(this).scrollTop() + topMenuHeight;
                                                // Get id of current scroll item
                                                var cur = scrollItems.map(function() {
                                                    if ($(this).offset().top < fromTop)
                                                        return this;
                                                });
                                                // Get the id of the current element
                                                cur = cur[cur.length - 1];
                                                var id = cur && cur.length ? cur[0].id : "";

                                                if (lastId !== id) {
                                                    lastId = id;
                                                    // Set/remove active class
                                                    menuItems
                                                        .parent().removeClass("is-active")
                                                        .end().filter("[href='#" + id + "']").parent().addClass("is-active");
                                                }
                                            });
                                        } else {
                                            menuItems.click(function(e) {
                                                var findid = $(this).attr('href');
                                                offsetTop = $(findid).offset().top;
                                                $('html, body').stop().animate({
                                                    scrollTop: offsetTop
                                                });
                                                return false;
                                            });
                                        }

                                        $productThumbsWrapper.slick({
                                            accessibility: false,
                                            arrows: true,
                                            dots: false,
                                            infinite: false,
                                            autoplay: false,
                                            slidesToShow: 5,
                                            slidesToScroll: 1,
                                            vertical: true,
                                            verticalSwiping: true,
                                            responsive: [{
                                                breakpoint: 992,
                                                settings: {
                                                    vertical: false,
                                                    verticalSwiping: false,
                                                    slidesToShow: 4,
                                                    slidesToScroll: 4,
                                                    dots: true,
                                                }
                                            }]
                                        }).css('opacity', '1');
                                    } else {
                                        $productThumbsWrapper.slick({
                                            accessibility: false,
                                            arrows: true,
                                            dots: false,
                                            infinite: false,
                                            autoplay: false,
                                            slidesToShow: 4,
                                            slidesToScroll: 4
                                        }).css('opacity', '1');
                                    }

                                    // Show highlighted thumbnail by repositioning slider
                                    $productThumbsWrapper.slick(
                                        'slickGoTo',
                                        $productThumbsWrapper.find('.is-active').attr('data-slick-index'),
                                        true
                                    );
                                }
                            },

                            _productSwipeInit: function(evt, obj) {
                                // Slider is initialized. Setup custom swipe events
                                this.settings.productThumbIndex = obj.currentSlide;
                                this.settings.productThumbMax = obj.slideCount - 1; // we need the 0-based index

                                var self = this;

                                $(this.selectors.productImageWrappers).on(
                                    'swipeleft swiperight',
                                    function(event) {
                                        if (event.type === 'swipeleft') {
                                            self._goToNextThumbnail();
                                        }

                                        if (event.type === 'swiperight') {
                                            self._goToPrevThumbnail();
                                        }

                                        // Trigger click on newly requested thumbnail
                                        $(
                                                '.product-single__thumbnail-item[data-slick-index="' +
                                                self.settings.productThumbIndex +
                                                '"]'
                                            )
                                            .find('.product-single__thumbnail')
                                            .trigger('click');

                                    }
                                );
                            },
                            _goToNextThumbnail: function() {
                                this.settings.productThumbIndex++;

                                if (this.settings.productThumbIndex > this.settings.productThumbMax) {
                                    this.settings.productThumbIndex = 0;
                                }

                                $(this.selectors.productThumbsWrapper).slick(
                                    'slickGoTo',
                                    this.settings.productThumbIndex,
                                    true
                                );
                            },

                            _goToPrevThumbnail: function() {
                                this.settings.productThumbIndex--;

                                if (this.settings.productThumbIndex < 0) {
                                    this.settings.productThumbIndex = this.settings.productThumbMax;
                                }

                                $(this.selectors.productThumbsWrapper).slick(
                                    'slickGoTo',
                                    this.settings.productThumbIndex,
                                    true
                                );
                            },

                            _initQtySelector: function() {
                                this.$container.find('.product-form__quantity').each(function(i, el) {
                                    // eslint-disable-next-line no-new
                                    new QtySelector($(el));
                                });
                            },

                            onUnload: function() {
                                $(this.selectors.productImageWrappers).off(this.settings.namespace);
                                $(this.selectors.productThumbs).off(this.settings.namespace);
                                $(this.selectors.productThumbs).slick('unslick');
                                if (this.ProductModal) {
                                    this.ProductModal.$modal.off(this.settings.namespace);
                                }
                            }
                        });

                        return Product;
                    })();

                    theme.Slideshow = (function() {
                        this.$slideshow = null;
                        var classes = {
                            slideshow: 'slideshow',
                            slickActiveMobile: 'slick-active-mobile',
                            controlsHover: 'slideshow__controls--hover',
                            isPaused: 'is-paused'
                        };

                        var selectors = {
                            section: '.shopify-section',
                            wrapper: '#SlideshowWrapper-',
                            slides: '.slideshow__slide',
                            textWrapperMobile: '.slideshow__text-wrap--mobile',
                            textContentMobile: '.slideshow__text-content--mobile',
                            controls: '.slideshow__controls',
                            dots: '.slick-dots',
                            arrowLeft: '.slideshow__arrow-left',
                            arrowRight: '.slideshow__arrow-right'
                        };

                        function slideshow(el, sectionId) {
                            var $slideshow = (this.$slideshow = $(el));
                            this.adaptHeight = this.$slideshow.data('adapt-height');
                            this.$wrapper = this.$slideshow.closest(selectors.wrapper + sectionId);
                            this.$section = this.$wrapper.closest(selectors.section);
                            this.$controls = this.$wrapper.find(selectors.controls);
                            this.$textWrapperMobile = this.$section.find(selectors.textWrapperMobile);
                            this.autorotate = this.$slideshow.data('autorotate');
                            var autoplaySpeed = this.$slideshow.data('speed');
                            var loadSlideA11yString = this.$slideshow.data('slide-nav-a11y');

                            this.settings = {
                                rtl: theme.rtl,
                                accessibility: true,
                                arrows: true,
                                dots: true,
                                fade: (theme.rtl ? false : true),
                                draggable: true,
                                touchThreshold: 20,
                                autoplay: this.autorotate,
                                autoplaySpeed: autoplaySpeed
                            };

                            this.$slideshow.on('beforeChange', beforeChange.bind(this));
                            this.$slideshow.on('init', slideshowA11ySetup.bind(this));

                            // Add class to style mobile dots & show the correct text content for the
                            // first slide on mobile when the slideshow initialises
                            this.$slideshow.on(
                                'init',
                                function() {
                                    this.$mobileDots
                                        .find('li:first-of-type')
                                        .addClass(classes.slickActiveMobile);
                                    this.showMobileText(0);
                                }.bind(this)
                            );

                            if (this.adaptHeight) {
                                this.setSlideshowHeight();
                                $(window).resize($.debounce(50, this.setSlideshowHeight.bind(this)));
                            }

                            this.$slideshow.slick(this.settings);

                            // This can't be called when the slick 'init' event fires due to how slick
                            // adds a11y features.
                            slideshowPostInitA11ySetup.bind(this)();
                        }

                        function slideshowA11ySetup(event, obj) {
                            var $slider = obj.$slider;
                            var $list = obj.$list;
                            this.$dots = this.$section.find(selectors.dots);
                            this.$mobileDots = this.$dots.eq(1);

                            // Remove default Slick aria-live attr until slider is focused
                            $list.removeAttr('aria-live');

                            //     this.$wrapper.on('keyup', keyboardNavigation.bind(this));
                            //     this.$controls.on('keyup', keyboardNavigation.bind(this));
                            //     this.$textWrapperMobile.on('keyup', keyboardNavigation.bind(this));

                            // When an element in the slider is focused
                            // pause slideshow and set aria-live.
                            this.$wrapper
                                .on(
                                    'focusin',
                                    function(evt) {
                                        if (!this.$wrapper.has(evt.target).length) {
                                            return;
                                        }

                                        $list.attr('aria-live', 'polite');
                                        if (this.autorotate) {
                                            $slider.slick('slickPause');
                                        }
                                    }.bind(this)
                                )
                                .on(
                                    'focusout',
                                    function(evt) {
                                        if (!this.$wrapper.has(evt.target).length) {
                                            return;
                                        }

                                        $list.removeAttr('aria-live');
                                    }.bind(this)
                                );

                            // Add arrow key support when focused
                            if (this.$dots) {
                                this.$dots
                                    .find('a')
                                    .each(function() {
                                        var $dot = $(this);
                                        $dot.on('click keyup', function(evt) {
                                            if (
                                                evt.type === 'keyup' &&
                                                evt.which !== slate.utils.keyboardKeys.ENTER
                                            )
                                                return;

                                            evt.preventDefault();

                                            var slideNumber = $(evt.target).data('slide-number');

                                            $slider.attr('tabindex', -1).slick('slickGoTo', slideNumber);

                                            if (evt.type === 'keyup') {
                                                $slider.focus();
                                            }
                                        });
                                    })
                                    .eq(0)
                                    .attr('aria-current', 'true');
                            }

                            this.$controls
                                .on('focusin', highlightControls.bind(this))
                                .on('focusout', unhighlightControls.bind(this));
                        }

                        function slideshowPostInitA11ySetup() {
                            var $slides = this.$slideshow.find(selectors.slides);

                            $slides.removeAttr('role').removeAttr('aria-labelledby');
                            this.$dots
                                .removeAttr('role')
                                .find('li')
                                .removeAttr('role')
                                .removeAttr('aria-selected')
                                .each(function() {
                                    var $dot = $(this);
                                    var ariaControls = $dot.attr('aria-controls');
                                    $dot
                                        .removeAttr('aria-controls')
                                        .find('a')
                                        .attr('aria-controls', ariaControls);
                                });
                        }

                        function beforeChange(event, slick, currentSlide, nextSlide) {
                            var $dotLinks = this.$dots.find('a');
                            var $mobileDotLinks = this.$mobileDots.find('li');

                            $dotLinks
                                .removeAttr('aria-current')
                                .eq(nextSlide)
                                .attr('aria-current', 'true');

                            $mobileDotLinks
                                .removeClass(classes.slickActiveMobile)
                                .eq(nextSlide)
                                .addClass(classes.slickActiveMobile);
                            this.showMobileText(nextSlide);
                        }

                        //   function keyboardNavigation() {
                        //     if (event.keyCode === slate.utils.keyboardKeys.LEFTARROW) {
                        //       this.$slideshow.slick('slickPrev');
                        //     }
                        //     if (event.keyCode === slate.utils.keyboardKeys.RIGHTARROW) {
                        //       this.$slideshow.slick('slickNext');
                        //     }
                        //   }

                        function highlightControls() {
                            this.$controls.addClass(classes.controlsHover);
                        }

                        function unhighlightControls() {
                            this.$controls.removeClass(classes.controlsHover);
                        }

                        slideshow.prototype.setSlideshowHeight = function() {
                            var minAspectRatio = this.$slideshow.data('min-aspect-ratio');
                            this.$slideshow.height($(document).width() / minAspectRatio);
                        };

                        slideshow.prototype.showMobileText = function(slideIndex) {
                            var $allTextContent = this.$textWrapperMobile.find(
                                selectors.textContentMobile
                            );
                            var currentTextContentSelector =
                                selectors.textContentMobile + '-' + slideIndex;
                            var $currentTextContent = this.$textWrapperMobile.find(
                                currentTextContentSelector
                            );
                            if (!$currentTextContent.length &&
                                this.$slideshow.find(selectors.slides).length === 1
                            ) {
                                this.$textWrapperMobile.hide();
                            } else {
                                this.$textWrapperMobile.show();
                            }
                            $allTextContent.hide();
                            $currentTextContent.show();
                        };

                        function getSlideshowId($el) {
                            return '#Slideshow-' + $el.data('id');
                        }

                        return slideshow;
                    })();

                    theme.slideshows = {};

                    theme.SlideshowSection = (function() {
                        function SlideshowSection(container) {
                            var $container = (this.$container = $(container));
                            var sectionId = $container.attr('data-section-id');
                            var slideshow = (this.slideshow = '#Slideshow-' + sectionId);

                            theme.slideshows[slideshow] = new theme.Slideshow(slideshow, sectionId);
                        }

                        return SlideshowSection;
                    })();

                    theme.SlideshowSection.prototype = _.assignIn({},
                        theme.SlideshowSection.prototype, {
                            onUnload: function() {
                                delete theme.slideshows[this.slideshow];
                            },

                            onBlockSelect: function(evt) {
                                var $slideshow = $(this.slideshow);
                                var adaptHeight = $slideshow.data('adapt-height');

                                if (adaptHeight) {
                                    theme.slideshows[this.slideshow].setSlideshowHeight();
                                }

                                // Ignore the cloned version
                                var $slide = $(
                                    '.slideshow__slide--' + evt.detail.blockId + ':not(.slick-cloned)'
                                );
                                var slideIndex = $slide.data('slick-index');

                                // Go to selected slide, pause auto-rotate
                                $slideshow.slick('slickGoTo', slideIndex).slick('slickPause');
                            },

                            onBlockDeselect: function() {
                                // Resume auto-rotate
                                $(this.slideshow).slick('slickPlay');
                            }
                        }
                    );

                    theme.slideshows = {};

                    theme.Cart = (function() {
                        var selectors = {
                            cartNote: '#CartSpecialInstructions',
                            cartQtyInput: '.cart__quantity',
                            cartNoCookiesClass: 'cart--no-cookies'
                        };

                        function Cart(container) {
                            var $container = (this.$container = $(container));
                            var sectionId = $container.attr('data-section-id');

                            theme.cartObject = JSON.parse($('#CartJson-' + sectionId).html());

                            this.init($container);
                        }

                        Cart.prototype = _.assignIn({}, Cart.prototype, {
                            init: function($container) {
                                this._initQtySelector();
                                this._initCartNote();

                                if (!this._cookiesEnabled()) {
                                    $container.addClass(selectors.cartNoCookiesClass);
                                }
                            },

                            _initQtySelector: function() {
                                $(selectors.cartQtyInput).each(function(i, el) {
                                    // eslint-disable-next-line no-new
                                    new QtySelector($(el));
                                });
                            },

                            _initCartNote: function() {
                                if (!$(selectors.cartNote).length) {
                                    return;
                                }

                                var $el = $(selectors.cartNote);
                                var noteText;
                                var params;
                                var noteOffset = $el[0].offsetHeight - $el[0].clientHeight;

                                // Auto grow the cart note if text fills it up
                                $el.on('keyup input', function() {
                                    $(this)
                                        .css('height', 'auto')
                                        .css('height', $el[0].scrollHeight + noteOffset);
                                });

                                // Save the cart note via ajax. A safeguard in case
                                // a user decides to leave the page before clicking 'Update Cart'
                                $el.on(
                                    'change',
                                    $.proxy(function() {
                                        noteText = $el.val();
                                        params = {
                                            type: 'POST',
                                            url: '/cart/update.js',
                                            data: 'note=' + this._attributeToString(noteText),
                                            dataType: 'json'
                                        };
                                        $.ajax(params);
                                    }, this)
                                );
                            },

                            _attributeToString: function(attr) {
                                if (typeof attr !== 'string') {
                                    attr = String(attr);
                                    if (attr === 'undefined') {
                                        attr = '';
                                    }
                                }
                                return $.trim(attr);
                            },

                            _cookiesEnabled: function() {
                                var cookieEnabled = navigator.cookieEnabled;

                                if (!cookieEnabled) {
                                    document.cookie = 'testcookie';
                                    cookieEnabled = document.cookie.indexOf('testcookie') !== -1;
                                }
                                return cookieEnabled;
                            }
                        });

                        return Cart;
                    })();

                    // Instagrams
                    theme.Instagrams = (function() {
                        function Instagrams(container) {
                            this.$container = $(container).on('init', this._a11y.bind(this));
                            //console.log(this.$container);
                            this.settings = {
                                style: this.$container.data('style'),
                                accesstoken: this.$container.data('accesstoken'),
                                userid: this.$container.data('userid'),
                                limit: this.$container.data('limit'),
                                resolution: this.$container.data('resolution'),
                                target: this.$container.attr('id'),
                                rows: this.$container.data('rows'),

                                slidesToShow: this.$container.data('slidestoshow') || 1,
                                infinite: this.$container.data('infinite') || false,
                                arrows: this.$container.data('arrows') || false,
                                draggable: this.$container.data('draggable') || false,
                                dots: this.$container.data('dots') || false,
                            }
                            this.settings.slidesToShow1200 = (this.settings.slidesToShow - 1) > 1 ? (this.settings.slidesToShow - 1) : 1;
                            this.settings.slidesToShow992 = (this.settings.slidesToShow - 2) > 1 ? (this.settings.slidesToShow - 2) : 1;
                            this.settings.slidesToShow768 = (this.settings.slidesToShow - 3) > 1 ? (this.settings.slidesToShow - 3) : 1;
                            this.settings.slidesToShow480 = 2;

                            var _self = this;
                            var $instagramSelector = $('#' + this.settings.target);
                            if (this.settings.style === 'grid') {
                                var afterInstagram = function() {} // blank function
                            } else if (this.settings.style === 'carousel') {
                                var afterInstagram = function() {
                                    $instagramSelector.slick({
                                        slidesToShow: _self.settings.slidesToShow,
                                        slidesToScroll: _self.settings.slidesToShow,
                                        arrows: _self.settings.arrows,
                                        dots: _self.settings.dots,
                                        draggable: _self.settings.draggable,
                                        infinite: _self.settings.infinite,
                                        rows: _self.settings.rows,
                                        responsive: [{
                                                breakpoint: 1200,
                                                settings: {
                                                    slidesToShow: _self.settings.slidesToShow1200,
                                                    slidesToScroll: _self.settings.slidesToShow1200,
                                                }
                                            },
                                            {
                                                breakpoint: 992,
                                                settings: {
                                                    slidesToShow: _self.settings.slidesToShow992,
                                                    slidesToScroll: _self.settings.slidesToShow992,
                                                }
                                            },
                                            {
                                                breakpoint: 768,
                                                settings: {
                                                    slidesToShow: _self.settings.slidesToShow768,
                                                    slidesToScroll: _self.settings.slidesToShow768,
                                                }
                                            },
                                            {
                                                breakpoint: 480,
                                                settings: {
                                                    slidesToShow: _self.settings.slidesToShow480,
                                                    slidesToScroll: _self.settings.slidesToShow480,
                                                }
                                            }
                                        ]
                                    })
                                }
                            }

                            var feed = new Instafeed({
                                get: 'user',
                                target: this.settings.target,
                                userId: this.settings.userid,
                                accessToken: this.settings.accesstoken,
                                limit: this.settings.limit,
                                resolution: this.settings.resolution,
                                template: '<div class="col hv-image-brightness"><a class="instagram-item" href="{{link}}" target="_blank" id="{{id}}"><img alt="instagram image" class="transition lazyload" data-src="{{image}}" /></a></div>',
                                after: afterInstagram
                            });

                            feed.run();
                        }

                        Instagrams.prototype = _.assignIn({}, Instagrams.prototype, {
                            _a11y: function(event, obj) {
                                var $list = obj.$list;
                                var $wrapper = this.$container.parent();

                                // Remove default Slick aria-live attr until slider is focused
                                $list.removeAttr('aria-live');

                                // When an element in the slider is focused set aria-live
                                $wrapper.on('focusin', function(evt) {
                                    if ($wrapper.has(evt.target).length) {
                                        $list.attr('aria-live', 'polite');
                                    }
                                });

                                // Remove aria-live
                                $wrapper.on('focusout', function(evt) {
                                    if ($wrapper.has(evt.target).length) {
                                        $list.removeAttr('aria-live');
                                    }
                                });
                            }
                        });

                        return Instagrams;
                    })();

                    // Slick carousel
                    theme.slickCarousel = (function() {
                        function Carousels(container) {
                            this.$container = $(container).on('init', this._a11y.bind(this));
                            this.settings = {
                                rows: this.$container.data('rows') || 1,
                                slidesToShow: this.$container.data('slidestoshow') || 1,
                                slidesToScroll: this.$container.data('slidestoscroll') || 1,
                                infinite: this.$container.data('infinite') || false,
                                arrows: this.$container.data('arrows') || false,
                                dots: this.$container.data('dots') || false,
                                autoplay: this.$container.data('autoplay') || false,
                                draggable: this.$container.data('draggable') || false,
                                accessibility: this.$container.data('accessibility') || true,
                            }
                            this.settings.slidesToShow1200 = (this.settings.slidesToShow - 1) > 1 ? (this.settings.slidesToShow - 1) : 1;
                            this.settings.slidesToShow992 = (this.settings.slidesToShow - 2) > 1 ? (this.settings.slidesToShow - 2) : 1;
                            this.settings.slidesToShow768 = (this.settings.slidesToShow - 3) > 1 ? (this.settings.slidesToShow - 3) : 1;
                            this.settings.slidesToShow480 = (this.settings.slidesToShow - 4) > 1 ? (this.settings.slidesToShow - 4) : 1;
                            this.settings.slidesToScroll1200 = (this.settings.slidesToScroll - 1) > 1 ? (this.settings.slidesToScroll - 1) : 1;
                            this.settings.slidesToScroll992 = (this.settings.slidesToScroll - 2) > 1 ? (this.settings.slidesToScroll - 2) : 1;
                            this.settings.slidesToScroll768 = (this.settings.slidesToScroll - 3) > 1 ? (this.settings.slidesToScroll - 3) : 1;
                            this.settings.slidesToScroll480 = (this.settings.slidesToScroll - 4) > 1 ? (this.settings.slidesToScroll - 4) : 1;
                            this.$container.slick({
                                rtl: theme.rtl,
                                rows: this.settings.rows,
                                slidesToShow: this.settings.slidesToShow,
                                slidesToScroll: this.settings.slidesToScroll,
                                arrows: this.settings.arrows,
                                dots: this.settings.dots,
                                autoplay: this.settings.autoplay,
                                accessibility: this.settings.accessibility,
                                draggable: this.settings.draggable,
                                infinite: this.settings.infinite,
                                adaptiveHeight: true,
                                responsive: [{
                                        breakpoint: 1200,
                                        settings: {
                                            slidesToShow: this.settings.slidesToShow1200,
                                            slidesToScroll: this.settings.slidesToScroll1200
                                        }
                                    },
                                    {
                                        breakpoint: 992,
                                        settings: {
                                            slidesToShow: this.settings.slidesToShow992,
                                            slidesToScroll: this.settings.slidesToScroll992
                                        }
                                    },
                                    {
                                        breakpoint: 768,
                                        settings: {
                                            slidesToShow: this.settings.slidesToShow768,
                                            slidesToScroll: this.settings.slidesToScroll768
                                        }
                                    },
                                    {
                                        breakpoint: 480,
                                        settings: {
                                            slidesToShow: 1,
                                            slidesToScroll: this.settings.slidesToScroll480
                                        }
                                    }
                                ]
                            })
                        }

                        Carousels.prototype = _.assignIn({}, Carousels.prototype, {
                            _a11y: function(event, obj) {
                                var $list = obj.$list;
                                var $wrapper = this.$container.parent();

                                // Remove default Slick aria-live attr until slider is focused
                                $list.removeAttr('aria-live');

                                // When an element in the slider is focused set aria-live
                                $wrapper.on('focusin', function(evt) {
                                    if ($wrapper.has(evt.target).length) {
                                        $list.attr('aria-live', 'polite');
                                    }
                                });

                                // Remove aria-live
                                $wrapper.on('focusout', function(evt) {
                                    if ($wrapper.has(evt.target).length) {
                                        $list.removeAttr('aria-live');
                                    }
                                });
                            },

                            _goToSlide: function(slideIndex) {
                                this.$container.slick('slickGoTo', slideIndex);
                            },

                            onUnload: function() {
                                delete this.$container;
                            },

                            onBlockSelect: function(evt) {
                                // Ignore the cloned version
                                var $slide = $(
                                    '.carousel__slide-wrapper--' + evt.detail.blockId + ':not(.slick-cloned)'
                                );
                                var slideIndex = $slide.data('slick-index');

                                // Go to selected slide, pause autoplay
                                this._goToSlide(slideIndex);

                            }
                        });

                        return Carousels;
                    })()

                    // Productlists
                    theme.Productlists = (function() {
                        function Productlists(container) {
                            this.$container = $(container).on('init', this._a11y.bind(this));
                            this.settings = {
                                slidesToShow: this.$container.data('slidestoshow') || 1,
                                rows: this.$container.data('rows') || 1,
                                arrows: this.$container.data('arrows') || false,
                                dots: this.$container.data('dots') || false,
                                draggable: this.$container.data('draggable') || false,
                                infinite: this.$container.data('infinite') || false,
                            }
                            this.settings.slidesToShow1200 = (this.settings.slidesToShow - 1) > 1 ? (this.settings.slidesToShow - 1) : 1;
                            this.settings.slidesToShow992 = (this.settings.slidesToShow - 2) > 1 ? (this.settings.slidesToShow - 2) : 1;
                            this.settings.slidesToShow768 = (this.settings.slidesToShow - 3) > 1 ? (this.settings.slidesToShow - 3) : 1;
                            this.settings.slidesToShow480 = 2;
                            this.$container.slick({
                                rtl: theme.rtl,
                                accessibility: true,
                                slidesToShow: this.settings.slidesToShow,
                                slidesToScroll: this.settings.slidesToShow,
                                rows: this.settings.rows,
                                arrows: this.settings.arrows,
                                dots: this.settings.dots,
                                infinite: this.settings.infinite,
                                draggable: this.settings.draggable,
                                responsive: [{
                                        breakpoint: 1200,
                                        settings: {
                                            slidesToShow: this.settings.slidesToShow1200,
                                            slidesToScroll: this.settings.slidesToShow1200
                                        }
                                    },
                                    {
                                        breakpoint: 992,
                                        settings: {
                                            slidesToShow: this.settings.slidesToShow992,
                                            slidesToScroll: this.settings.slidesToShow992
                                        }
                                    },
                                    {
                                        breakpoint: 768,
                                        settings: {
                                            slidesToShow: this.settings.slidesToShow768,
                                            slidesToScroll: this.settings.slidesToShow768
                                        }
                                    },
                                    {
                                        breakpoint: 480,
                                        settings: {
                                            slidesToShow: this.settings.slidesToShow480,
                                            slidesToScroll: this.settings.slidesToShow480
                                        }
                                    }
                                ]
                            }).css('opacity', '1');
                        }

                        Productlists.prototype = _.assignIn({}, Productlists.prototype, {
                            _a11y: function(event, obj) {
                                var $list = obj.$list;
                                var $wrapper = this.$container.parent();

                                // Remove default Slick aria-live attr until slider is focused
                                $list.removeAttr('aria-live');

                                // When an element in the slider is focused set aria-live
                                $wrapper.on('focusin', function(evt) {
                                    if ($wrapper.has(evt.target).length) {
                                        $list.attr('aria-live', 'polite');
                                    }
                                });

                                // Remove aria-live
                                $wrapper.on('focusout', function(evt) {
                                    if ($wrapper.has(evt.target).length) {
                                        $list.removeAttr('aria-live');
                                    }
                                });
                            },

                            _goToSlide: function(slideIndex) {
                                this.$container.slick('slickGoTo', slideIndex);
                            },

                            onUnload: function() {
                                delete this.$container;
                            }
                        });

                        return Productlists;
                    })();

                    // Producttabs
                    theme.Producttabs = (function() {
                        function Producttabs(container) {
                            var _self = this; // avoid conflict
                            this.$container = $(container).on('init', this._a11y.bind(this));
                            this.slickWrap = '.prdtab-content';
                            this.settings = {
                                slidesToShow: this.$container.data('slidestoshow') || 1,
                                arrows: this.$container.data('arrows') || false,
                                rows: this.$container.data('rows') || 1,
                                dots: this.$container.data('dots') || false,
                                draggable: this.$container.data('draggable') || false,
                                infinite: this.$container.data('infinite') || false,
                            }
                            this.settings.slidesToShow1200 = (this.settings.slidesToShow - 1) > 1 ? (this.settings.slidesToShow - 1) : 1;
                            this.settings.slidesToShow992 = (this.settings.slidesToShow - 2) > 1 ? (this.settings.slidesToShow - 2) : 1;
                            this.settings.slidesToShow768 = (this.settings.slidesToShow - 3) > 1 ? (this.settings.slidesToShow - 3) : 1;
                            this.settings.slidesToShow480 = 2;

                            this._initSlick();
                            this.$container.find('a[data-toggle="tab"]').on("shown.bs.tab", function(e) {
                                _self._unSlick();
                                _self._initSlick();
                                theme.tooltip.load();
                            })
                        }

                        Producttabs.prototype = _.assignIn({}, Producttabs.prototype, {
                            _a11y: function(event, obj) {
                                var $list = obj.$list;
                                var $wrapper = this.$container.parent();

                                // Remove default Slick aria-live attr until slider is focused
                                $list.removeAttr('aria-live');

                                // When an element in the slider is focused set aria-live
                                $wrapper.on('focusin', function(evt) {
                                    if ($wrapper.has(evt.target).length) {
                                        $list.attr('aria-live', 'polite');
                                    }
                                });

                                // Remove aria-live
                                $wrapper.on('focusout', function(evt) {
                                    if ($wrapper.has(evt.target).length) {
                                        $list.removeAttr('aria-live');
                                    }
                                });
                            },

                            _getSliderSettings: function() {
                                return {
                                    rtl: theme.rtl,
                                    accessibility: true,
                                    slidesToShow: this.settings.slidesToShow,
                                    slidesToScroll: this.settings.slidesToShow,
                                    arrows: this.settings.arrows,
                                    rows: this.settings.rows,
                                    dots: this.settings.dots,
                                    infinite: this.settings.infinite,
                                    draggable: this.settings.draggable,
                                    responsive: [{
                                            breakpoint: 1200,
                                            settings: {
                                                slidesToShow: this.settings.slidesToShow1200,
                                                slidesToScroll: this.settings.slidesToShow1200
                                            }
                                        },
                                        {
                                            breakpoint: 992,
                                            settings: {
                                                slidesToShow: this.settings.slidesToShow992,
                                                slidesToScroll: this.settings.slidesToShow992
                                            }
                                        },
                                        {
                                            breakpoint: 768,
                                            settings: {
                                                slidesToShow: this.settings.slidesToShow768,
                                                slidesToScroll: this.settings.slidesToShow768
                                            }
                                        },
                                        {
                                            breakpoint: 480,
                                            settings: {
                                                slidesToShow: this.settings.slidesToShow480,
                                                slidesToScroll: this.settings.slidesToShow480
                                            }
                                        }
                                    ]
                                }
                            },

                            _initSlick: function() {
                                this.$container.find(this.slickWrap).slick(this._getSliderSettings()).css('opacity', '1');
                            },

                            _unSlick: function() {
                                this.$container.find(this.slickWrap).slick('unslick');
                            },

                            onUnload: function() {
                                delete this.$container;
                            },

                            onSelect: function() {
                                this._unSlick();
                                this._initSlick();
                            },

                            onBlockSelect: function(evt) {
                                var navItem = $('.nav-link-' + evt.detail.blockId);
                                navItem.tab('show');
                                this._unSlick();
                                this._initSlick();
                            }
                        });

                        return Producttabs;
                    })();

                    theme.Video = (function() {
                        var promiseYoutubeAPI;
                        var promiseVimeoAPI;

                        var youtube = {
                            promiseAPI: function() {
                                if (!promiseYoutubeAPI) {
                                    var tag = document.createElement('script');

                                    tag.src = 'https://www.youtube.com/iframe_api';
                                    var firstScriptTag = document.getElementsByTagName('script')[0];
                                    firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

                                    promiseYoutubeAPI = $.Deferred(function(defer) {
                                        window.onYouTubeIframeAPIReady = defer.resolve;

                                        setTimeout(function() {
                                            defer.reject('Request for YouTube API timed out after 30 seconds.');
                                        }, 30000);
                                    });
                                }

                                return promiseYoutubeAPI;
                            },
                            promisePlayer: function(id, options) {
                                return this.promiseAPI().then(function() {
                                    return $.Deferred(function(defer) {
                                        if (typeof window.YT === 'undefined') {
                                            defer.reject(
                                                "We're sorry, something went wrong. The YouTube API has not loaded correctly."
                                            );
                                        }

                                        /* eslint-disable no-undef */
                                        var player = new YT.Player(id, options); // global YT variable injected by YouTube API

                                        player.addEventListener('onReady', function() {
                                            defer.resolve(player);
                                        });

                                        setTimeout(function() {
                                            defer.reject(
                                                'Request for YouTube player has timed out after 30 seconds.'
                                            );
                                        }, 30000);
                                    });
                                });
                            }
                        };

                        var vimeo = {
                            promiseAPI: function() {
                                if (!promiseVimeoAPI) {
                                    promiseVimeoAPI = $.Deferred(function(defer) {
                                        var tag = document.createElement('script');
                                        tag.src = 'https://player.vimeo.com/api/player.js';
                                        tag.onload = tag.onreadystatechange = function() {
                                            if (!this.readyState || this.readyState === 'complete') {
                                                defer.resolve();
                                            }
                                        };

                                        var firstScriptTag = document.getElementsByTagName('script')[0];
                                        firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

                                        setTimeout(function() {
                                            defer.reject('Request for Vimeo API timed out after 30 seconds.');
                                        }, 30000);
                                    });
                                }

                                return promiseVimeoAPI;
                            },

                            promisePlayer: function(id, options) {
                                return this.promiseAPI().then(function() {
                                    return $.Deferred(function(defer) {
                                        if (typeof window.Vimeo === 'undefined') {
                                            defer.reject(
                                                "We're sorry, something went wrong. The Vimeo API has not loaded correctly."
                                            );
                                        }

                                        var player = new window.Vimeo.Player(id, options);

                                        setTimeout(function() {
                                            defer.reject(
                                                'Request for Vimeo player has timed out after 30 seconds.'
                                            );
                                        }, 30000);

                                        player.ready().then(function() {
                                            defer.resolve(player);
                                        });
                                    });
                                });
                            }
                        };

                        var selectors = {
                            loadPlayerButton: '.video-section__load-player-button',
                            closePlayerButton: '.video-section__player-close',
                            playerContainer: '.video-section__player',
                            cover: '.video-section__cover',
                            errorMessage: '.video-section__error',
                            bodyOverlay: '.video-section__body-overlay',
                            body: 'body'
                        };
                        var classes = {
                            playerLoading: 'video-section--loading',
                            playerLoaded: 'video-section--loaded',
                            playerError: 'video-section--error',
                            videoPlaying: 'video-playing'
                        };

                        function Video(container) {
                            this.$container = $(container);
                            var sectionId = this.$container.attr('data-section-id');
                            this.namespace = '.' + sectionId;
                            this.onLoad();
                        }

                        Video.prototype = _.assignIn({}, Video.prototype, {
                            onLoad: function() {
                                this.$container
                                    .on('click', selectors.loadPlayerButton, this._loadPlayer.bind(this))
                                    .on('click', selectors.closePlayerButton, this._closePlayer.bind(this))
                                    .on('click', selectors.bodyOverlay, this._closePlayer.bind(this));
                            },

                            _loadPlayer: function() {
                                var $container = this.$container;
                                var $playerContainer = $(selectors.playerContainer, $container);
                                var playerType = this.$container.attr('data-video-type');

                                var promiseVideoPlayer;

                                if (playerType === 'youtube') {
                                    promiseVideoPlayer = this._loadYoutubePlayer($playerContainer[0]);
                                } else if (playerType === 'vimeo') {
                                    promiseVideoPlayer = this._loadVimeoPlayer($playerContainer[0]);
                                }

                                return promiseVideoPlayer
                                    .then(this._onPlayerLoadReady.bind(this))
                                    .fail(this._onPlayerLoadError.bind(this));
                            },

                            _loadYoutubePlayer: function(container) {
                                return youtube
                                    .promisePlayer(container, {
                                        videoId: this.$container.attr('data-video-id'),
                                        ratio: 16 / 9,
                                        playerVars: {
                                            modestbranding: 1,
                                            autoplay: 1,
                                            showinfo: 0,
                                            rel: 0
                                        }
                                    })
                                    .then(
                                        function(player) {
                                            this.player = player;
                                        }.bind(this)
                                    );
                            },

                            _loadVimeoPlayer: function(container) {
                                return vimeo
                                    .promisePlayer(container, {
                                        id: this.$container.attr('data-video-id')
                                    })
                                    .then(
                                        function(player) {
                                            this.player = player;
                                            this.player.play();
                                        }.bind(this)
                                    );
                            },

                            _onPlayerLoadReady: function() {
                                $(selectors.closePlayerButton, this.$container)
                                    .show()
                                    .focus();
                                $(selectors.cover, this.$container).addClass(classes.playerLoaded);
                                this.$container.addClass(classes.playerLoaded);

                                this._setScrollPositionValues();

                                $(selectors.body).addClass(classes.videoPlaying);

                                $(document).on('keyup' + this.namespace, this._closeOnEscape.bind(this));
                                $(window).on(
                                    'resize' + this.namespace,
                                    this._setScrollPositionValues.bind(this)
                                );
                                slate.a11y.trapFocus({
                                    $container: this.$container,
                                    namespace: this.namespace
                                });
                            },

                            _onPlayerLoadError: function(err) {
                                this.$container.addClass(classes.playerError);
                                $(selectors.errorMessage, this.$container).text(err);
                            },

                            _closeOnEscape: function(evt) {
                                if (evt.keyCode !== 27) {
                                    return;
                                }

                                this._closePlayer();
                                $(selectors.loadPlayerButton, this.$container).focus();
                            },

                            _onScroll: function() {
                                var scrollTop = $(window).scrollTop();

                                if (
                                    scrollTop > this.videoTop + 0.25 * this.videoHeight ||
                                    scrollTop + this.windowHeight <
                                    this.videoBottom - 0.25 * this.videoHeight
                                ) {
                                    // Debounce DOM edits to the next frame with requestAnimationFrame
                                    requestAnimationFrame(this._closePlayer.bind(this));
                                }
                            },

                            _setScrollPositionValues: function() {
                                this.videoHeight = this.$container.outerHeight(true);
                                this.videoTop = this.$container.offset().top;
                                this.videoBottom = this.videoTop + this.videoHeight;
                                this.windowHeight = $(window).innerHeight();
                            },

                            _closePlayer: function() {
                                $(selectors.body).removeClass(classes.videoPlaying);
                                $(selectors.cover, this.$container).removeClass(classes.playerLoaded);
                                this.$container.removeClass(classes.playerLoaded);
                                $(selectors.closePlayerButton, this.$container).hide();

                                slate.a11y.removeTrapFocus({
                                    $container: this.$container,
                                    namespace: this.namespace
                                });

                                if (typeof this.player.destroy === 'function') {
                                    this.player.destroy();
                                } else if (typeof this.player.unload === 'function') {
                                    this.player.unload();
                                }

                                $(document).off(this.namespace);
                                $(window).off(this.namespace);
                            }
                        });

                        return Video;
                    })();

                    theme.CollectionsList = (function() {
                        function CollectionsList(container) {
                            var $container = (this.$container = $(container));
                            var stretchImage = $container.is('[data-stretch-image]');

                            // Early return if 'secondary image layout' is enabled
                            if (stretchImage) return;

                            var namespace = (this.namespace = '.' + $container.attr('data-section-id'));
                            var self = this;

                            self._collectionListFix();
                            $(window).on(
                                'resize' + namespace,
                                $.debounce(250, function() {
                                    self._collectionListFix();
                                })
                            );
                        }

                        CollectionsList.prototype = _.assignIn({}, CollectionsList.prototype, {
                            onUnload: function() {
                                $(window).off(this.namespace);
                            },

                            _collectionListFix: function() {
                                var numberRows = this.$container.find('.grid').data('number-rows');
                                var $featureCards = this.$container.find('.featured-card');

                                // We can exit if 'Use secondary image layout' is enabled
                                if ($featureCards.is('[data-stretch-image]')) return;

                                // Go through each of the rows
                                for (var i = 0; i < numberRows; i++) {
                                    var maxWrapperHeight = 0;
                                    var maxHeaderHeight = 0;
                                    var $currentRow = $featureCards.filter(
                                        "[data-row-number='" + (i + 1) + "']"
                                    );
                                    var $cardHeaders = $currentRow.find('.featured-card__header');

                                    // Find the max heights for each row
                                    $currentRow.each(function() {
                                        var $cardTitle = $(this).find('.featured-card__title');
                                        var $cardAction = $(this).find('.featured-card__action');
                                        var $cardImageWrapper = $(this).find('.featured-card__image-wrapper');
                                        var headerHeight =
                                            $cardTitle.outerHeight() + $cardAction.outerHeight() + 65;
                                        var wrapperHeight = $cardImageWrapper.outerHeight();
                                        if (headerHeight > maxHeaderHeight) {
                                            maxHeaderHeight = headerHeight;
                                        }
                                        if (wrapperHeight > maxWrapperHeight) {
                                            maxWrapperHeight = wrapperHeight;
                                        }
                                    });

                                    // Set the heights of the headers and cards for this row with padding
                                    $cardHeaders.outerHeight(maxHeaderHeight);
                                    $currentRow.height(maxWrapperHeight + maxHeaderHeight + 40);
                                }
                            }
                        });

                        return CollectionsList;
                    })();

                    theme.ParrallaxImage = (function() {
                        function ParrallaxImage(container) {
                            this.container = container;
                            this.sectionId = $(container).attr('data-section-id');
                            this.namespace = 'parallax-' + this.sectionId;
                            var images = document.getElementsByClassName('thumbnail' + this.sectionId);
                            new simpleParallax(images, {
                                scale: 1.5,
                                delay: .6,
                            });
                        }

                        ParrallaxImage.prototype = $.extend({}, ParrallaxImage.prototype, {
                            onUnload: function(evt) {
                                var instance = new simpleParallax(images);
                                instance.destroy();
                                delete theme.ParrallaxImage[this.namespace];
                            }
                        });

                        return ParrallaxImage;
                    })();

                    theme.init = function() {
                        theme.customerTemplates.init();
                        slate.rte.wrapTable();
                        slate.rte.iframeReset();

                        // Common a11y fixes
                        slate.a11y.pageLinkFocus($(window.location.hash));

                        $('.in-page-link').on('click', function(evt) {
                            slate.a11y.pageLinkFocus($(evt.currentTarget.hash));
                        });

                        $('a[href="#"]').on('click', function(evt) {
                            evt.preventDefault();
                        });


                        //scroll animation
                        AOS.init({
                            startEvent: 'DOMContentLoaded',
                            offset: 30, // offset (in px) from the original trigger point
                            delay: 0, // values from 0 to 3000, with step 50ms
                            duration: 1000,
                            once: true
                        });
                        window.addEventListener('load', function() {
                            AOS.refresh();
                        });


                        // Sections
                        var sections = new theme.Sections();
                        sections.register('header', theme.HeaderSection);
                        sections.register('product', theme.Product);
                        sections.register('slideshow-section', theme.SlideshowSection);
                        sections.register('cart', theme.Cart);
                        sections.register('instagrams', theme.Instagrams);
                        sections.register('masonries', theme.Masonry);
                        sections.register('productlist', theme.Productlists);
                        sections.register('producttab', theme.Producttabs);
                        sections.register('slickCarousels', theme.slickCarousel);
                        sections.register('video', theme.Video);
                        sections.register('collections-list', theme.CollectionsList);
                        sections.register('parallax-image', theme.ParrallaxImage);
                        sections.register('bgcollection', theme.Bgcollection);

                        // Standalone modules
                        $(window).on('load', theme.articleImages);
                        theme.passwordModalInit();
                    };

                    theme.articleImages = function() {
                        var $indentedRteImages = $('.rte--indented-images');
                        if (!$indentedRteImages.length) {
                            return;
                        }

                        $indentedRteImages.find('img').each(function(i, el) {
                            var $el = $(el);
                            var attr = $el.attr('style');

                            // Check if undefined or float: none
                            if (!attr || attr === 'float: none;') {
                                // Add class to parent paragraph tag if image is wider than container
                                if ($el.width() >= $indentedRteImages.width()) {
                                    $el.parent('p').addClass('rte__image-indent');
                                }
                            }
                        });
                    };

                    theme.passwordModalInit = function() {
                        var $loginModal = $('#LoginModal');
                        if (!$loginModal.length) {
                            return;
                        }

                        // Initialize modal
                        theme.PasswordModal = new window.Modals('LoginModal', 'login-modal', {
                            focusOnOpen: '#Password'
                        });

                        // Open modal if errors exist
                        if ($loginModal.find('.errors').length) {
                            theme.PasswordModal.open();
                        }
                    };

                    // CSS var ponyfill
                    theme.cssVar = (function() {
                        cssVars();
                    })()

                    // Ajax search https://gist.github.com/awojtczyk/53d74c8af5f893841f33979b0cdcd6fe
                    theme.ajaxSearch = (function() {
                        var $inputSearch = '.js-ajaxsearch',
                            $resultsList = '.search-results',
                            $input = $($inputSearch).find('input[name="q"]'),
                            $currentAjaxRequest,
                            $displayProducts = 6;

                        $($inputSearch).css('position', 'relative').each(function() {
                            $input.attr('autocomplete', 'off').bind('keyup change', function() {
                                var term = $(this).val(),
                                    form = $(this).closest('form'),
                                    searchURL = '/search?type=product&q=*' + term + '*';
                                if (term.length > 2 && term !== $(this).attr('data-old-term')) {
                                    $(this).attr('data-old-term', term);
                                    if ($currentAjaxRequest !== undefined) $currentAjaxRequest.abort();
                                    $currentAjaxRequest = $.getJSON(searchURL + '&view=json', function(data) {
                                        $($resultsList).empty();

                                        if (data.results_count === 0) {
                                            $($resultsList).html('<p class="text-center">' + theme.strings.ajaxSearchNoResult + '</p>')
                                        } else {
                                            $.each(data.results, function(index, item) {
                                                if (index < $displayProducts) {
                                                    var itemPrice = theme.Currency.formatMoney(item.price, theme.moneyFormat);
                                                    var link = $('<a class="d-inline-flex ' + index + '"></a>')
                                                        .attr('href', item.url)
                                                        .append('<span class="image"><img src="' + item.thumbnail + '" /></span>')
                                                        .append('<div class="meta"><p class="title">' + item.title + '</p>' + itemPrice + '</div>')
                                                        .wrap('<div class="ajax-search-item"></div>');
                                                    $($resultsList).append(link.parent());
                                                    theme.updateCurrencies();
                                                }
                                            });
                                            if (data.results_count > $displayProducts) {
                                                $($resultsList).append('<a class="btn btn--full" href="' + searchURL + '">' + theme.strings.ajaxSearchViewAll + ' (' + data.results_count + ')</a>');
                                            }
                                        }
                                        $($resultsList).addClass('active').fadeIn(200);
                                    });
                                }
                            });
                        });

                        //escape when click somethings
                        $(document).click(function(event) {
                            var target = event.target;
                            if (!$(target).is($inputSearch) && !$(target).parents().is($inputSearch)) {
                                $($resultsList).slideUp(300);
                            }
                        });
                    })();

                    // Quickview https://github.com/kellyvaughn/quickview-for-shopify/blob/master/quickview.js.liquid
                    theme.quickview = (function() {
                        var product_handle = '',
                            quickviewButtonClass = '.js-btn-quickview',
                            quickviewId = '#jsQuickview',
                            quickviewOption = '#jsQuickview select',
                            quickviewThumb = '#qv-product-images',
                            quickviewAddCartButton = '.qv-add-button',
                            quickviewPrice = '.qv-product-price',
                            quickviewComparePrice = '.qv-product-compare-price';

                        // 1. Show quickview
                        $(document).on('click', quickviewButtonClass, function() {
                            var quickviewAvaible = $(this).attr("data-pavailable");
                            product_handle = $(this).data('handle');
                            //ResetQuickview
                            $(quickviewId).removeClass().addClass('modal fade');
                            $(quickviewThumb).removeClass().empty();
                            $('.qv-product-options').empty();

                            //Pushdata
                            $(quickviewId).addClass(product_handle).data('handle', product_handle);
                            jQuery.getJSON('/products/' + product_handle + '.js', function(product) {
                                var title = product.title;
                                var type = product.type;
                                var vendor = product.vendor;
                                var price = 0;
                                var compare_price = 0;
                                var desc = product.description.slice(0, 90);
                                var images = product.images;
                                var variants = product.variants;
                                var options = product.options;
                                var url = '/products/' + product_handle;
                                $('.qv-product-title').text(title);
                                $('.qv-product-type').text(type);
                                $('.qv-product-description').html(desc);
                                $('.qv-view-product').attr('href', url);
                                $('.qv-view-type').text(type);
                                $('.qv-view-vendor').text(vendor)
                                if (quickviewAvaible == 'true') {
                                    $(quickviewAddCartButton).prop('disabled', false).html(theme.strings.addToCart);
                                } else {
                                    $(quickviewAddCartButton).prop('disabled', true).html(theme.strings.soldOut);
                                }
                                $(product.variants).each(function(i, variants) {
                                    if (variants.sku != null) {
                                        $('.qv-sku').addClass("show").removeClass("hide");
                                        $('.qv-view-sku').text(product.variants[0].sku);
                                    } else {
                                        $('.qv-sku').addClass("hide").removeClass("show");
                                    }

                                });
                                var imageCount = $(images).length;
                                $(images).each(function(i, image) {
                                    image_embed = '<div><img src="' + image + '"></div>';
                                    image_embed = image_embed.replace('.jpg', '_800x.jpg').replace('.png', '_800x.png');
                                    $(quickviewThumb).append(image_embed);
                                });
                                $(quickviewThumb).slick({
                                    rtl: theme.rtl,
                                    'dots': true,
                                    'arrows': true,
                                    'respondTo': 'min',
                                    'useTransform': true
                                }).css('opacity', '1');

                                if (product.variants[0].option1 !== "Default Title") {
                                    $(options).each(function(i, option) {
                                        var name = option.name;
                                        var opt = name.replace(/ /g, '-').toLowerCase();
                                        var selectClass = '.option.' + opt;
                                        $('.qv-product-options').append('<div class="option-selection ' + opt + '"><span class="option text-uppercase font-weight-bold text-body">' + option.name + '</span><select class="option-' + i + ' option ' + opt + '"></select></div>');
                                        $(option.values).each(function(i, value) {
                                            $('.option.' + opt).append($('<option>', {
                                                value: value,
                                                text: value
                                            }));
                                        });
                                    });
                                }
                                $(product.variants).each(function(i, v) {
                                    if (v.inventory_quantity == 0) {
                                        return true
                                    } else {
                                        price = theme.Currency.formatMoney(v.price, theme.moneyFormat);
                                        compare_price = theme.Currency.formatMoney(v.compare_at_price, theme.moneyFormat);
                                        $(quickviewPrice).html(price);
                                        if (v.compare_at_price !== null) {
                                            $(quickviewComparePrice).html(compare_price).show();
                                        } else {
                                            $(quickviewComparePrice).hide();
                                        }
                                        theme.updateCurrencies();
                                        $('select.option-0').val(v.option1);
                                        $('select.option-1').val(v.option2);
                                        $('select.option-2').val(v.option3);
                                        return false
                                    }
                                });
                            });
                            //addCartQuickview
                        });
                        // 2. Add to cart
                        $(document).on('click', quickviewAddCartButton, function() {
                            product_handle = $(quickviewId).data('handle');
                            var qty = $('.qv-quantity').val(),
                                selectedOptions = '',
                                var_id = '';

                            function processCart() {
                                jQuery.post('/cart/add.js', {
                                        quantity: qty,
                                        id: var_id
                                    }, null, "json").done(function(item) {
                                        var htmlVariant = item.variant_title !== null ? '<i>(' + item.variant_title + ')</i>' : '';
                                        var styleCart = $('.js-mini-cart').attr("data-cartmini");
                                        if (styleCart != 'true') {
                                            var htmlAlert = '<div class="media mt-2 alert--cart"><a class="mr-3" href="/cart"><img class="lazyload" data-src="' + item.image + '"></a><div class="media-body align-self-center"><p class="m-0 font-weight-bold">' + item.product_title + ' x ' + item.quantity + '</p>' + htmlVariant + '<div><div>';
                                            theme.alert.new(theme.strings.addToCartSuccess, htmlAlert, 3000, 'notice');
                                        }
                                        theme.miniCart.updateElements();
                                        theme.miniCart.generateCart();
                                    })
                                    .fail(function($xhr) {
                                        var data = $xhr.responseJSON;
                                        theme.alert.new('', data.description, 3000, 'warning');
                                    });
                            }
                            $(quickviewOption).each(function(i) {
                                if (selectedOptions == '') {
                                    selectedOptions = $(this).val();
                                } else {
                                    selectedOptions = selectedOptions + ' / ' + $(this).val();
                                }
                            });
                            jQuery.getJSON('/products/' + product_handle + '.js', function(product) {
                                if (product.variants.length === 1) {
                                    var_id = product.variants[0].id;
                                } else {
                                    $(product.variants).each(function(i, v) {
                                        if (v.title == selectedOptions) {
                                            var_id = v.id;
                                        }
                                    });
                                }
                                processCart();
                            });
                        });
                        // 3. Select variants
                        $(document).on('change', quickviewOption, function() {
                            var selectedOptions = '';
                            $(quickviewOption).each(function(i) {
                                if (selectedOptions == '') {
                                    selectedOptions = $(this).val();
                                } else {
                                    selectedOptions = selectedOptions + ' / ' + $(this).val();
                                }
                            });
                            jQuery.getJSON('/products/' + product_handle + '.js', function(product) {
                                $(product.variants).each(function(i, v) {
                                    if (v.title == selectedOptions) {
                                        if (v.featured_image !== null) {
                                            var iSlick = v.featured_image.position - 1;
                                            $(quickviewThumb).slick('slickGoTo', iSlick);
                                        }
                                        var price = theme.Currency.formatMoney(v.price, theme.moneyFormat);
                                        var compare_price = theme.Currency.formatMoney(v.compare_at_price, theme.moneyFormat);
                                        $(quickviewPrice).html(price);
                                        $(quickviewComparePrice).html(compare_price);
                                        if (v.sku != null) {
                                            $('.qv-sku').addClass("show").removeClass("hide");
                                            $('.qv-view-sku').text(v.sku);
                                        } else {
                                            $('.qv-sku').addClass("hide").removeClass("show");
                                        }
                                        if (v.compare_at_price !== null) {
                                            $(quickviewComparePrice).html(compare_price).show();
                                        } else {
                                            $(quickviewComparePrice).hide();
                                        }
                                        theme.updateCurrencies();
                                        if (v.inventory_management === null) {
                                            $(quickviewAddCartButton).prop('disabled', false).val(theme.strings.addToCart);
                                        } else {
                                            if (v.inventory_quantity < 1) {
                                                $(quickviewAddCartButton).prop('disabled', true).val(theme.strings.soldOut);
                                            } else {
                                                $(quickviewAddCartButton).prop('disabled', false).val(theme.strings.addToCart);
                                            }
                                        }
                                    }
                                });
                            });
                        });
                    })()

                    //Button add to cart (in grid item)
                    theme.addCartButton = (function() {
                        var buttonClass = '.js-grid-cart';
                        $(document).on('click', buttonClass, function() {
                            var $this = $(this);
                            var id = $this.data('id');
                            $this.addClass('is-loading');
                            Shopify.addItem(id, 1, function(item) {
                                location.href = "/cart";
                                var htmlVariant = item.variant_title !== null ? '<i>(' + item.variant_title + ')</i>' : '';
                                var styleCart = $('.js-mini-cart').attr("data-cartmini");
                                if (styleCart != 'true') {
                                    var htmlAlert = '<div class="media mt-2 alert--cart"><a class="mr-3" href="/cart"><img class="lazyload" data-src="' + item.image + '"></a><div class="media-body align-self-center"><p class="m-0 font-weight-bold">' + item.product_title + ' x ' + item.quantity + '</p>' + htmlVariant + '<div><div>';
                                }
                                theme.miniCart.updateElements();
                                theme.miniCart.generateCart();
                                setTimeout(function() {
                                    styleCart != 'true' ? theme.alert.new(theme.strings.addToCartSuccess, htmlAlert, 3000, 'notice') : '';
                                    $this.removeClass('is-loading');
                                }, 1000);
                            });
                        })
                    })()

                    // Button add to cart (in grid item)
                    //theme.addCartButton = (function(){
                    //  var buttonClass = '.js-grid-cart';
                    //  $(document).on('click',buttonClass,function(){
                    //    var $this = $(this);
                    //    var id = $this.data('id');
                    //    $this.addClass('is-loading');
                    //    Shopify.addItem(id,1,function(item){
                    //      var htmlVariant = item.variant_title !== null ? '<i>('+item.variant_title+')</i>' : '';
                    //      var styleCart = $('.js-mini-cart').attr("data-cartmini");
                    //        if(styleCart != 'true'){
                    //          var htmlAlert = '<div class="media mt-2 alert--cart"><a class="mr-3" href="/cart"><img class="lazyload" data-src="'+item.image+'"></a><div class="media-body align-self-center"><p class="m-0 font-weight-bold">'+item.product_title+' x '+ item.quantity +'</p>'+htmlVariant+'<div><div>';
                    //        }
                    //      theme.miniCart.updateElements();
                    //      theme.miniCart.generateCart();
                    //      setTimeout(function() {
                    //        styleCart != 'true' ? theme.alert.new(theme.strings.addToCartSuccess,htmlAlert,3000,'notice'): '';
                    //        $this.removeClass('is-loading');
                    //      }, 1000);
                    //    });
                    // })
                    //})()

                    // Multi currencies 
                    if (theme.enableCurrencies) {
                        // Can be 'money_format' or 'money_with_currency_format'
                        Currency.format = 'money_format';
                        var shopCurrency = Shopify.currency.active;
                        var cookieCurrency = Currency.cookie.read();
                        // Fix for customer account pages 
                        jQuery('span.money span.money').each(function() {
                            jQuery(this).parent('span.money').removeClass('money');
                        });
                        // Add precalculated shop currency to data attribute 
                        jQuery('span.money').each(function() {
                            jQuery(this).attr('data-currency-' + Shopify.currency.active, jQuery(this).html());
                        });
                        // Select all your currencies buttons.
                        var buttons = jQuery('#currencies a'),
                            currentCurrencies = jQuery('.pre-currencies');
                        // When the page loads.
                        if (cookieCurrency == null || cookieCurrency == shopCurrency) {
                            Currency.currentCurrency = shopCurrency;
                        } else {
                            Currency.currentCurrency = cookieCurrency;
                            Currency.convertAll(shopCurrency, cookieCurrency);
                            buttons.removeClass('selected');
                            jQuery('#currencies a[data-currency=' + cookieCurrency + ']').addClass('selected');
                            var htmlCurrently = jQuery('#currencies a[data-currency=' + cookieCurrency + ']').html();
                            currentCurrencies.html(htmlCurrently);
                        }
                        buttons.click(function() {
                            buttons.removeClass('selected');
                            jQuery(this).addClass('selected');
                            var newCurrency = jQuery(this).attr('data-currency');
                            var htmlCurrently = jQuery(this).html();
                            currentCurrencies.html(htmlCurrently);
                            Currency.convertAll(Currency.currentCurrency, newCurrency);
                        });
                        // For product options.
                        var original_selectCallback = window.selectCallback;
                        var selectCallback = function(variant, selector) {
                            original_selectCallback(variant, selector);
                            Currency.convertAll(shopCurrency, jQuery('#currencies a.selected').attr('data-currency'));
                        };
                    }
                    theme.updateCurrencies = function() {
                        Currency.convertAll(shopCurrency, jQuery('#currencies a.selected').attr('data-currency'));
                    }



                    // Free shipping
                    theme.freeShipping = (function() {
                        var $freeShippingClass = $('.js-free-shipping'),
                            $freeShippingTextClass = $('.js-free-shipping-text'),
                            $free_fisrt = $freeShippingClass.attr('data-start'),
                            $free_end = $freeShippingClass.attr('data-end')
                        minOrderValue = parseInt($freeShippingClass.data('value')) || 0,
                            $percentClass = $('.js-free-shipping .progress-bar');

                        function generate(cart) {
                            var priceCart = cart.total_price;
                            if (priceCart >= minOrderValue) {
                                $percentClass.css('width', '100%').removeClass('progress-bar-striped bg-primary');
                                $freeShippingTextClass.text(theme.strings.freeShipping)
                            } else {
                                let percent = priceCart / minOrderValue * 100;
                                let left = Shopify.formatMoney((minOrderValue - priceCart), theme.moneyFormat);
                                $percentClass.css('width', percent + '%').addClass('progress-bar-striped primary');
                                $freeShippingTextClass.html($free_fisrt + ' ' + left + ' ' + $free_end);
                                theme.updateCurrencies();
                            }
                        }

                        Shopify.getCart(function(cart) {
                            generate(cart);
                        });

                        return {
                            load: generate
                        }
                    })()

                    // Shipping time - https://github.com/phstc/jquery-dateFormat
                    theme.shippingTime = (function() {
                        var $shippingTime = $('.js-shipping-time'),
                            shippingTime = $shippingTime.data('time') || '',
                            now = new Date(),
                            restHour = 23 - now.getHours(),
                            restMinute = 59 - now.getMinutes();
                        if (shippingTime !== '') {
                            var nextTime = new Date(now.getTime() + shippingTime * 86400000),
                                formatTime = $.format.date(nextTime, "ddd, dd MMMM yyyy"),
                                htmlShipping = 'Order in the next <b>' + restHour + '</b> hours <b>' + restMinute + '</b> minutes to get it by <b>' + formatTime + '</b>. ';
                            $shippingTime.html(htmlShipping);
                        }
                    })()

                    // Infinite scroll - https://github.com/Elkfox/Ajaxinate/blob/master/dist/ajaxinate.min.js
                    theme.infiniteScroll = (function() {
                        function initInfiniteScroll() {
                            if ($('.AjaxinateLoop').length === 0) {
                                return;
                            } else {
                                var endlessScroll = new Ajaxinate({
                                    loadingText: '<div class="text-center"><div class="' + theme.loadingClass + '" role="status"></div></div>',
                                    callback: function() {
                                        theme.wishlist.load();
                                        theme.compare.load();
                                        theme.countdown.load();
                                        theme.priceRange.load();
                                        theme.tooltip.load();
                                        theme.collectionView.triggerView();
                                        theme.swatchCard2.load();
                                    }
                                });
                            }
                        }

                        // Infinite scroll in other page (blog, list-collection)
                        function initOtherPages() {
                            var otherPages = new Ajaxinate({
                                loadingText: '<div class="text-center"><div class="' + theme.loadingClass + '" role="status"></div></div>',
                                container: '.js-pagination-content',
                                pagination: '.js-pagination'
                            });
                        }

                        document.addEventListener("DOMContentLoaded", function() {
                            initInfiniteScroll();
                            initOtherPages();
                        });

                        return {
                            load: initInfiniteScroll
                        }
                    })()

                    // Scroll to fixed
                    theme.scrollToFixed = (function() {
                        var window_width = $(window).width();

                        if (window_width < 768) {
                            $(".js-stick-parent").trigger("sticky_kit:detach");
                        } else {
                            make_sticky();
                        }
                        $(window).resize(function() {

                            window_width = $(window).width();

                            if (window_width < 768) {
                                $(".js-stick-parent").trigger("sticky_kit:detach");
                            } else {
                                make_sticky();
                            }
                        });

                        function make_sticky() {
                            $('.js-stick-parent').stick_in_parent();
                        }

                    })()


                    theme.headersidebar = (function() {
                        $('#dismiss, .overlaysidebar').on('click', function() {
                            // hide sidebar
                            $('#sidebar').removeClass('active');
                            // hide overlay
                            $('.overlaysidebar').removeClass('active');
                        });

                        $('#sidebarCollapse').on('click', function() {
                            // open sidebar
                            $('#sidebar').addClass('active');
                            // fade in the overlay
                            $('.overlaysidebar').addClass('active');
                            $('.collapse.in').toggleClass('in');
                            $('a[aria-expanded=true]').attr('aria-expanded', 'false');
                        });
                    })()

                    // Wishlist
                    theme.wishlist = (function() {
                        var wishlistButtonClass = '.js-btn-wishlist',
                            wishlistRemoveButtonClass = '.js-remove-wishlist',
                            $wishlistCount = $('.js-wishlist-count'),
                            $wishlistContainer = $('.js-wishlist-content'),
                            wishlistObject = JSON.parse(localStorage.getItem('localWishlist')) || [],
                            wishlistPageUrl = $('.js-wishlist-link').attr('href'),
                            loadNoResult = function() {
                                // $wishlistContainer.html('<div class="col text-center"><div class="alert alert-warning d-inline-block">' + theme.strings.wishlistNoResult + '</div></div>');
                            };

                        function updateWishlist(self) {
                            var productHandle = $(self).data('handle'),
                                allSimilarProduct = $(wishlistButtonClass + '[data-handle="' + productHandle + '"]');
                            var isAdded = $.inArray(productHandle, wishlistObject) !== -1 ? true : false;
                            if (isAdded) {
                                // go to wishlist page
                                window.location.href = wishlistPageUrl;
                            } else {
                                wishlistObject.push(productHandle);
                                allSimilarProduct.fadeOut('slow').fadeIn('fast').html(theme.strings.wishlistIconAdded + theme.strings.wishlistTextAdded);
                                //change tooltip
                                allSimilarProduct.attr('data-original-title', theme.strings.wishlistTextAdded);
                                $('.tooltip-inner').text(theme.strings.wishlistTextAdded);
                            }
                            localStorage.setItem('localWishlist', JSON.stringify(wishlistObject));
                            $wishlistCount.text(wishlistObject.length);
                        };

                        function loadWishlist() {
                            $wishlistContainer.html('');
                            //page wishlist
                            if (wishlistObject.length > 0) {
                                for (var i = 0; i < wishlistObject.length; i++) {
                                    var productHandle = wishlistObject[i];
                                    Shopify.getProduct(productHandle, function(product) {
                                        var htmlProduct = '';
                                        var productPrice = product.price_varies ? 'from ' + theme.Currency.formatMoney(product.price_min, theme.moneyFormat) : theme.Currency.formatMoney(product.price, theme.moneyFormat);
                                        var productComparePrice = product.compare_at_price_min !== 0 ? theme.Currency.formatMoney(product.compare_at_price_min, theme.moneyFormat) : '';
                                        htmlProduct += '<div class="js-wishlist-item col-md-4 col-sm-6 col-xs-6 col-12 mb-4">';
                                        htmlProduct += '<div class="js-wishlist-itembox">';
                                        htmlProduct += '<div class=" d-flex flex-row p-4">';
                                        htmlProduct += '	<a class="d-inline-block mr-4 " href="' + product.url + '">';
                                        htmlProduct += '		<img src="' + product.featured_image + '"/>';
                                        htmlProduct += '	</a>';
                                        htmlProduct += '	<div><a href="' + product.url + '" class="title-prouct d-block h4 text-body" >' + product.title + '</a>';
                                        htmlProduct += '	<span> ' + productPrice + '</span>';
                                        htmlProduct += '	 <s>' + productComparePrice + '</s></div>';
                                        htmlProduct += '<button class="btn js-remove-wishlist" data-handle="' + product.handle + '">' + theme.strings.wishlistRemove + '</button>';
                                        htmlProduct += '</div>';
                                        htmlProduct += '</div>';
                                        htmlProduct += '</div>';
                                        $wishlistContainer.append(htmlProduct);
                                        theme.updateCurrencies();
                                    });
                                }
                            } else {
                                loadNoResult();
                            }

                            //count items
                            $wishlistCount.text(wishlistObject.length);

                            //button text
                            $(wishlistButtonClass).each(function() {
                                var productHandle = $(this).data('handle');
                                var iconWishlist = $.inArray(productHandle, wishlistObject) !== -1 ? theme.strings.wishlistIconAdded : theme.strings.wishlistIcon;
                                var textWishlist = $.inArray(productHandle, wishlistObject) !== -1 ? theme.strings.wishlistTextAdded : theme.strings.wishlistText;
                                $(this).html(iconWishlist + textWishlist).attr('title', textWishlist);
                            });
                        }

                        $(document).on('click', wishlistButtonClass, function(event) {
                            event.preventDefault();
                            updateWishlist(this);
                        });
                        $(document).on('click', wishlistRemoveButtonClass, function() {
                            var productHandle = $(this).data('handle'),
                                allSimilarProduct = $(wishlistButtonClass + '[data-handle="' + productHandle + '"]');

                            //update button
                            allSimilarProduct.html(theme.strings.wishlistIcon + theme.strings.wishlistText);
                            //update tooltip
                            allSimilarProduct.attr('data-original-title', theme.strings.wishlistText);
                            $('.tooltip-inner').text(theme.strings.wishlistText);
                            //update Object
                            wishlistObject.splice(wishlistObject.indexOf(productHandle), 1);
                            localStorage.setItem('localWishlist', JSON.stringify(wishlistObject));
                            // Remove element
                            $(this).closest('.js-wishlist-item').fadeOut(); // or .remove()
                            //count
                            $wishlistCount.text(wishlistObject.length);
                            if (wishlistObject.length === 0) {
                                loadNoResult();
                            }
                        });

                        loadWishlist();
                        $(document).on('shopify:section:load', loadWishlist);
                        return {
                            load: loadWishlist
                        }
                    })()

                    // Compare
                    theme.compare = (function() {
                        var compareButtonClass = '.js-btn-compare',
                            compareRemoveButtonClass = '.js-remove-compare',
                            $compareCount = $('.js-compare-count'),
                            $compareContainer = $('.js-compare-content'),
                            compareObject = JSON.parse(localStorage.getItem('localCompare')) || [],
                            alertClass = 'notice';

                        function updateCompare(self) {
                            var productHandle = $(self).data('handle'),
                                alertText = '';
                            var isAdded = $.inArray(productHandle, compareObject) !== -1 ? true : false;
                            if (isAdded) {
                                compareObject.splice(compareObject.indexOf(productHandle), 1);
                                alertText = theme.strings.compareNotifyRemoved;
                                alertClass = 'notice';
                            } else {
                                if (compareObject.length === 4) {
                                    alertText = theme.strings.compareNotifyMaximum;
                                    alertClass = 'error';
                                } else {
                                    alertClass = 'notice';
                                    compareObject.push(productHandle);
                                    alertText = theme.strings.compareNotifyAdded;
                                }
                            }
                            localStorage.setItem('localCompare', JSON.stringify(compareObject));
                            theme.alert.new(theme.strings.compareText, alertText, 2000, alertClass);
                            $compareCount.text(compareObject.length);
                        };

                        function loadCompare() {
                            var compareGrid;
                            $compareContainer.html('');
                            //popup compare
                            if (compareObject.length > 0) {
                                compareGrid = compareObject.length === 1 ? 'col-md-6 col-sm-6' : 'col';
                                for (var i = 0; i < compareObject.length; i++) {
                                    var productHandle = compareObject[i];
                                    Shopify.getProduct(productHandle, function(product) {
                                        var htmlProduct = '',
                                            productPrice = product.price_varies ? 'from ' + theme.Currency.formatMoney(product.price_min, theme.moneyFormat) : theme.Currency.formatMoney(product.price, theme.moneyFormat),
                                            productComparePrice = product.compare_at_price_min !== 0 ? theme.Currency.formatMoney(product.compare_at_price_min, theme.moneyFormat) : '',
                                            productAvailable = product.available ? theme.strings.available : theme.strings.unavailable,
                                            productAvailableClass = product.available ? 'alert-success' : 'alert-danger',
                                            productTypeHTML = product.type !== "" ? '<a href="/collections/types?q=' + product.type + '">' + product.type + '</a>' : '<span>' + theme.strings.none + '</span>',
                                            productVendorHTML = product.vendor !== "" ? '<a href="/collections/vendors?q=' + product.vendor + '">' + product.vendor + '</a>' : '<span>' + theme.strings.none + '</span>';
                                        htmlProduct += '<div class="compare-item ' + compareGrid + ' col-xs-6">';
                                        htmlProduct += '	<a href="' + product.url + '">';
                                        htmlProduct += '		<img src="' + Shopify.resizeImage(product.featured_image, 'x300') + '"/>';
                                        htmlProduct += '	</a>';
                                        htmlProduct += '	<hr /><h5 >' + product.title + '</h5>';
                                        htmlProduct += '	<hr /><s>' + productComparePrice + '</s>';
                                        htmlProduct += '	<span> ' + productPrice + '</span>';
                                        htmlProduct += '	<hr /><span class=' + productAvailableClass + '> ' + productAvailable + '</span>';
                                        htmlProduct += '	<hr />' + productTypeHTML;
                                        htmlProduct += '	<hr />' + productVendorHTML;
                                        htmlProduct += '  <hr /><button class="btn js-remove-compare btn-theme gradient-theme" data-handle="' + product.handle + '">' + theme.strings.compareRemove + '</button>';
                                        htmlProduct += '</div>';
                                        $compareContainer.append(htmlProduct);
                                        theme.updateCurrencies();
                                    });
                                }
                            } else {
                                // $compareContainer.html('<div class="alert alert-warning d-inline-block">' + theme.strings.compareNoResult + '</div>');
                            }

                            //button text
                            $(compareButtonClass).each(function() {
                                var productHandle = $(this).data('handle');
                                var status = $.inArray(productHandle, compareObject) !== -1 ? 'added' : '';
                                $(this).removeClass('added').addClass(status);
                            });

                            //count items
                            $compareCount.text(compareObject.length);
                        }
                        $(document).on('click', compareButtonClass, function(event) {
                            event.preventDefault();
                            updateCompare(this);
                            loadCompare();
                        });
                        $(document).on('click', compareRemoveButtonClass, function() {
                            var productHandle = $(this).data('handle');
                            compareObject.splice(compareObject.indexOf(productHandle), 1);
                            localStorage.setItem('localCompare', JSON.stringify(compareObject));
                            loadCompare();
                        });

                        loadCompare();
                        $(document).on('shopify:section:load', loadCompare);
                        return {
                            load: loadCompare
                        }
                    })()

                    // Popup newsletter
                    theme.popupNewletter = (function() {
                        var $popupNewsletter = $('#jsPopupNewsletter'),
                            $newsletterForm = $('#jsPopupNewsletter form'),
                            date = new Date(),
                            minutes = theme.timePopupNewsletter;
                        minutesdelay = $popupNewsletter.attr('data-delay');
                        if ($popupNewsletter.length === 1) {
                            date.setTime(date.getTime() + (minutes * 60 * 1000));
                            var setCookies = function() {
                                $.cookie('cookiesNewsletter', 'disabled', { expires: date, path: '/' });
                            };
                            if ($.cookie('cookiesNewsletter') !== "disabled") {
                                $(window).on('load', function() {
                                    setTimeout(function() {
                                        $popupNewsletter.modal('show');
                                    }, minutesdelay * 1000);
                                });
                                $popupNewsletter.on('hidden.bs.modal', setCookies);
                                $newsletterForm.submit(setCookies);
                            }
                        }
                    })()

                    // Cookie policy
                    theme.cookie = (function() {
                        var $policy = $('.js-cookie-policy'),
                            $closeButton = $('.js-btn-ok'),
                            isOk = localStorage.getItem('localCookie') || '';
                        if (isOk === '') {
                            $policy.fadeIn('slow');
                        }
                        $closeButton.on('click', function() {
                            localStorage.setItem('localCookie', 'accept');
                            $policy.fadeOut('slow');
                        })
                    })()

                    // Announcement Bar
                    theme.announcement = (function() {
                        var $bar = $('.js-announcement-bar'),
                            $closeButton = $('.js-ab-close'),
                            isClosed = localStorage.getItem('localAnnouncement') || '';
                        if (isClosed === '') {
                            $bar.fadeIn();
                            $bar.closest('.body-theme').addClass('body-announcement-bar');
                        }
                        $closeButton.on('click', function() {
                            localStorage.setItem('localAnnouncement', 'closed');
                            $bar.slideUp();
                            $bar.closest('.body-theme').removeClass('body-announcement-bar');
                        })
                    })()

                    // Open external link in new tab
                    theme.exLink = (function() {
                        var links = document.links;
                        for (let i = 0, linksLength = links.length; i < linksLength; i++) {
                            if (links[i].hostname !== window.location.hostname && $(links[i]).attr('href') !== 'javascript:void(0)') {
                                links[i].target = '_blank';
                            }
                        }
                    })()

                    // Deal- countdown
                    theme.countdown = (function() {
                        function initCountdown() {
                            $(".js-countdown").each(function() {
                                var endTime = $(this).data('time'),
                                    htmlLayout = "<ul class='list--inline'><li class='gradient-theme-vertical'><span class='countdown-time'>%%D%%</span><span class='countdown-text'>Days</span></li><li class='gradient-theme-vertical'><span class='countdown-time'>%%H%%</span><span class='countdown-text'>Hours</span></li><li class='gradient-theme-vertical'><span class='countdown-time'>%%M%%</span><span class='countdown-text'>Mins</span></li><li class='gradient-theme-vertical'><span class='countdown-time'>%%S%%</span><span class='countdown-text'>Secs</span></li></ul>";
                                $(this).lofCountDown({
                                    TargetDate: endTime,
                                    DisplayFormat: htmlLayout,
                                    FinishMessage: '<span class="alert alert-warning d-inline-block">' + theme.strings.countdownEndText + '</span>'
                                });
                            });
                        }
                        initCountdown();
                        return {
                            load: initCountdown
                        }
                    })()

                    // Price range - Collection page
                    theme.priceRange = (function() {
                        function initPriceRange() {
                            var min = 0,
                                max = 0,
                                slideRange = '#js-slider-range',
                                productCard = '.js-product-card',
                                slideRangeWrap = '.slider-range-wr',
                                rangeMin = '.js-range-min',
                                rangeMax = '.js-range-max',
                                enablePriceRange = $('#js-slider-range').length === 1 ? true : false;

                            if (enablePriceRange) {
                                $(productCard).each(function() {
                                    if (eval($(this).data('price')) > max) max = eval($(this).data('price'));
                                    if (min == 0) min = eval($(this).data('price'));
                                    else if (eval($(this).data('price')) < min) min = eval($(this).data('price'));
                                });

                                if (min === max) {
                                    $(slideRangeWrap).fadeOut();
                                } else {
                                    $(slideRangeWrap).fadeIn();
                                }

                                $(slideRange).slider({
                                    range: true,
                                    min: min,
                                    max: max,
                                    values: [min, max],
                                    slide: function(event, ui) {
                                        var price1 = (Shopify.formatMoney(ui.values[0], theme.moneyFormat));
                                        var price2 = (Shopify.formatMoney(ui.values[1], theme.moneyFormat));
                                        $(rangeMin).html(price1);
                                        $(rangeMax).html(price2);
                                        theme.updateCurrencies();

                                        // Show/Hide product when dragging
                                        $(productCard).each(function() {
                                            if (eval($(this).data('price')) >= ui.values[0] && eval($(this).data('price')) <= ui.values[1]) {
                                                $(this).parent().fadeIn();
                                            } else {
                                                $(this).parent().fadeOut();
                                            }
                                        });
                                    }
                                });

                                var price1 = (Shopify.formatMoney(min, theme.moneyFormat));
                                var price2 = (Shopify.formatMoney(max, theme.moneyFormat));
                                $(rangeMin).html(price1);
                                $(rangeMax).html(price2);
                                theme.updateCurrencies();

                            }
                        }
                        initPriceRange();
                        return {
                            load: initPriceRange
                        }
                    })()

                    // Collection view - Collection page
                    theme.collectionView = (function() {
                        var btnView = '.js-btn-view',
                            btnViewActive = '.js-btn-view.active';

                        $(document).on('click', btnView, function() {
                            var value = $(this).data('col'),
                                $gridItemCol = $('.js-col');

                            $(btnView).removeClass('active');
                            $(this).addClass('active');

                            $gridItemCol.removeClass().addClass('js-col col-sm-6 col-12');
                            if (value === 3) {
                                $gridItemCol.addClass('col-lg-4');
                            } else if (value === 4) {
                                $gridItemCol.addClass('col-lg-3');
                            } else if (value === 5) {
                                $gridItemCol.addClass('col-lg-2-4');
                            } else if (value === 6) {
                                $gridItemCol.addClass('col-lg-2');
                            };
                        })

                        function triggerCollectionView() {
                            $(btnViewActive).trigger('click');
                        }

                        return {
                            triggerView: triggerCollectionView
                        }
                    })()

                    // Swath variant in card item
                    theme.swatchCard = (function() {
                        $(document).on('click', '.js-swatch-card-item', function() { //click or mouseover
                            $(".js-swatch-card-item").removeClass("active");
                            $(this).addClass("active");
                            var newImage = $(this).data('image');
                            var id = $(this).data('id');
                            var gridItem = $(this).closest('.js-product-card');
                            gridItem.find('.product-card__image').find('img').attr('srcset', newImage);
                            gridItem.find('.js-grid-cart').data('id', id).attr('data-id', id);
                        });
                    })()

                    theme.swatchCard2 = (function() {
                        function initVariant(id) {
                            var productJson = JSON.parse($('.customJson-' + id).html());
                            var $selectorForm = $('.customform-' + id);
                            var $button = $('.js-customform-addtocart-' + id);
                            var $buttontext = $button.find('span');
                            var $wrapObject = $selectorForm.closest('.js-product-card');
                            var options = {
                                $container: $selectorForm,
                                enableHistoryState: false,
                                product: productJson,
                                singleOptionSelector: '.single-option-selector-' + id,
                                originalSelectorId: '#ProductSelect-' + id
                            };
                            var variants = new slate.Variants(options);
                            var AjaxCart = new window.AjaxCart($selectorForm);
                            var _updateButton = function(evt) {
                                var variant = evt.variant;
                                if (variant === undefined) {
                                    $button.prop('disabled', true).removeClass('btn--sold-out');
                                    $buttontext.html(theme.strings.unavailable);
                                } else {
                                    if (variant.available) {
                                        $button.removeClass('btn--sold-out').prop('disabled', false);
                                        $buttontext.html(theme.strings.addToCart);
                                    } else {
                                        $button.prop('disabled', true).addClass('btn--sold-out');
                                        $buttontext.html(theme.strings.soldOut);
                                    }
                                }
                            }
                            var _updateImage = function(evt) {
                                var variant = evt.variant;
                                var $mainImage = $wrapObject.find('.product-card__image').find('img');
                                if (variant !== undefined && variant.featured_image !== null) {
                                    var variantImage = variant.featured_image;
                                    $mainImage.attr('srcset', variantImage.src);
                                }
                            }
                            var _updatePrice = function(evt) {
                                var $price = $wrapObject.find('.product-card__price');
                                var variant = evt.variant;
                                if (variant !== undefined) {
                                    var htmlComparePrice = variant.compare_at_price !== null ? '<s class="product-card__regular-price"><span class="money">' + variant.compare_at_price + '</span></s>' : '';
                                    var htmlPrice = '<span class="money">' + variant.price + '</span>' + htmlComparePrice;
                                    $price.html(htmlPrice);
                                    theme.updateCurrencies();
                                }
                            }
                            variants.$container.on(
                                'variantChange', _updateButton
                            );
                            variants.$container.on(
                                'variantChange', _updateImage
                            );
                            variants.$container.on(
                                'variantChange', _updatePrice
                            );
                        }

                        function initForm() {
                            $('.js-customform').each(function() {
                                var id = $(this).data('id');
                                initVariant(id);
                            })
                        }

                        initForm();
                        return {
                            load: initForm
                        }
                    })()

                    // Loading
                    theme.loading = (function() {
                        var $loading = $('#js-loading'),
                            hasLoading = $('#js-loading').length === 0 ? false : true;
                        if (hasLoading) {
                            $(window).load(function() {
                                $loading.fadeOut();
                            });
                        }
                    })()

                    theme.effectLeavingPage = (function() {
                        window.onbeforeunload = function() {
                            $('body').css('opacity', '0');
                        }
                    })()

                    // Isotope
                    theme.isotope = (function() {
                        var enableIsotope = $('.enable-isotope').length === 1 ? true : false,
                            $grid = $('.js-grid'),
                            filter = '.js-filter-isotope';

                        function initIsotope() {
                            if (enableIsotope) {
                                $grid.isotope({
                                    itemSelector: '.grid-item',
                                    percentPosition: true
                                })
                                $(document).on('click', filter, function() {
                                    var filterValue = $(this).data('filter') === '*' ? $(this).data('filter') : '.' + $(this).data('filter');
                                    $(filter).removeClass('active');
                                    $(this).addClass('active');
                                    $grid.isotope({
                                        filter: filterValue
                                    });
                                });
                                $(window).scroll(function() {
                                    $grid.isotope('layout');
                                });
                                $(window).load(function() {
                                    $grid.isotope('layout');
                                    $(filter).first().trigger('click');
                                });
                            }
                        }
                        initIsotope();
                    })()

                    //aos



                    // theme.Wow = (function(){
                    //   new WOW().init();
                    // })()




                    // Masonry
                    theme.Masonry = (function() {
                        function Masonry(container) {
                            this.$container = $(container).on('init', this._a11y.bind(this));
                            var $masonry = this.$container;
                            $masonry.isotope({
                                itemSelector: '.grid-item',
                                percentPosition: true,
                                masonry: {
                                    columnWidth: '.grid-sizer'
                                }
                            });
                            $(window).load(function() {
                                $masonry.isotope('layout').css('opacity', '1');
                            });
                            $(window).scroll(function() {
                                $masonry.isotope('layout').css('opacity', '1');
                            });
                        }

                        Masonry.prototype = _.assignIn({}, Masonry.prototype, {
                            _a11y: function(event, obj) {
                                var $list = obj.$list;
                                var $wrapper = this.$container.parent();

                                // Remove default Slick aria-live attr until slider is focused
                                $list.removeAttr('aria-live');

                                // When an element in the slider is focused set aria-live
                                $wrapper.on('focusin', function(evt) {
                                    if ($wrapper.has(evt.target).length) {
                                        $list.attr('aria-live', 'polite');
                                    }
                                });

                                // Remove aria-live
                                $wrapper.on('focusout', function(evt) {
                                    if ($wrapper.has(evt.target).length) {
                                        $list.removeAttr('aria-live');
                                    }
                                });
                            }
                        });

                        return Masonry;
                    })();



                    // Cross-selling
                    theme.crosssell = (function() {
                        var crosssellClass = '.js-crosssell',
                            handles = $(crosssellClass).data('handles') || '',
                            arrayHandle = handles.split(','),
                            $blockCrosssell = $('.block-cross-sell'),
                            variantSelectClass = '.js-cross-select',
                            crossImageClass = '.cross-item-image',
                            crossPriceClass = '.cross-item-money';

                        function generateCrosssell() {
                            for (var i = 0; i < arrayHandle.length; i++) {
                                var productHandle = arrayHandle[i];
                                Shopify.getProduct(productHandle, function(product) {
                                    var htmlCross = '',
                                        htmlOption = '',
                                        firstAvailableVariant = '',
                                        variantCount = product.variants.length;

                                    // generate select box and check first avaiable variant
                                    for (var j = 0; j < variantCount; j++) {
                                        var variant = product.variants[j],
                                            variantImage = variant.featured_image === null ? product.featured_image : variant.featured_image.src,
                                            disabled = variant.available ? '' : 'disabled';
                                        htmlOption += '<option ' + disabled + ' data-id="' + variant.id + '" data-price="' + variant.price + '" data-image="' + variantImage + '">' + variant.title + '</option>';
                                        if (firstAvailableVariant === '' && variant.available) {
                                            firstAvailableVariant = variant
                                        }
                                    }
                                    var productPrice = theme.Currency.formatMoney(firstAvailableVariant.price, theme.moneyFormat),
                                        productImage = firstAvailableVariant.featured_image === null ? product.featured_image : firstAvailableVariant.featured_image.src,
                                        selectHide = variantCount === 1 ? 'hide' : '';

                                    // generate HTML
                                    htmlCross += '<div class="col cross-item ' + product.handle + '">';
                                    htmlCross += '	<a class="cross-item-image" href="' + product.url + '" title="' + product.title + '"><img src="' + productImage + '" />' + theme.strings.cartIcon + '</a>';
                                    htmlCross += '	<a target="_blank" href="' + product.url + '" title="' + product.title + '" class="cross-item-title">' + product.title + '</a>';
                                    htmlCross += '	<span class="cross-item-money">' + productPrice + '</span>';
                                    htmlCross += '	<select class="js-cross-select ' + selectHide + '" data-image="' + productImage + '" data-price="' + firstAvailableVariant.price + '" data-item="' + firstAvailableVariant.id + '">' + htmlOption + '</select>';
                                    htmlCross += '</div>';
                                    $(crosssellClass).append(htmlCross);
                                    theme.updateCurrencies();
                                });
                            }
                        }

                        function showPopupCrosssell(lineItem) {
                            //generate lineitem;
                            var htmlLineItem = '';
                            htmlLineItem += '<span class="alert alert-success d-inline-block mb-2">' + theme.strings.addToCartSuccess + '</span>';
                            htmlLineItem += '<div><img src="' + lineItem.image + '" alt="Added Product"></div>';
                            htmlLineItem += '<h4 class="cross-item-title">' + lineItem.title + '</h4>';
                            htmlLineItem += '<div class="mb-2">' + theme.strings.cartQuantity + ': ' + lineItem.quantity + '</div>';
                            $('.js-cross-added').hide().html(htmlLineItem).fadeIn();

                            // show popup
                            var $popupCrosssell = $('#jsCrosssell');
                            $popupCrosssell.modal('show');
                        }

                        if (handles !== '') {
                            $(document).on('click', crossImageClass, function(event) {
                                event.preventDefault();
                                var parent = $(this).closest('.cross-item'),
                                    itemId = parent.find(variantSelectClass).attr('data-item');
                                Shopify.addItem(itemId, 1, function(lineItem) {
                                    theme.miniCart.updateElements();
                                    theme.miniCart.generateCart();
                                    showPopupCrosssell(lineItem);
                                });
                            });
                            $(document).on('change', variantSelectClass, function() {
                                var selectVariant = $(this).children(':selected'),
                                    selectVariantId = selectVariant.data('id'),
                                    parent = $(this).parent(),
                                    newPrice = theme.Currency.formatMoney(selectVariant.data('price'), theme.moneyFormat);

                                if (selectVariant.data('image') !== '') {
                                    parent.find(crossImageClass).find('img').attr('src', selectVariant.data('image'));
                                }
                                $(this).attr('data-item', selectVariantId);
                                parent.find(crossPriceClass).html(newPrice);
                                theme.updateCurrencies();
                            });
                            $(document).on('shopify:section:load', generateCrosssell);
                            generateCrosssell();
                            $blockCrosssell.removeClass('hide');
                        }
                        return {
                            showPopup: showPopupCrosssell
                        }
                    })()

                    // Upsell
                    theme.upsell = (function() {
                        var popupUpsell = '#jsUpsell',
                            $button = $('#jsUpsell .btn'),
                            productUpsellId = $('#jsUpsell').data('id') || '',
                            buttonAcceptClass = 'js-btn-accept',
                            delayTime = $('#jsUpsell').data('delay') || 3000,
                            isUpsell = $(popupUpsell).length === 1 ? true : false;
                        if (isUpsell) {
                            $(document).ready(function() {
                                setTimeout(function() {
                                    $(popupUpsell).modal('show');
                                }, delayTime);
                            });
                            $button.on('click', function() {
                                if ($(this).hasClass(buttonAcceptClass)) {
                                    Shopify.addItem(productUpsellId, 1, function(item) {
                                        theme.miniCart.updateElements();
                                        theme.miniCart.generateCart();
                                        var htmlVariant = item.variant_title !== null ? '<i>(' + item.variant_title + ')</i>' : '';
                                        var htmlAlert = '<div class="media mt-2 alert--cart"><a class="mr-3" href="/cart"><img class="lazyload" data-src="' + item.image + '"></a><div class="media-body align-self-center"><p class="m-0 font-weight-bold">' + item.product_title + ' x ' + item.quantity + '</p>' + htmlVariant + '<div><div>';
                                        theme.alert.new(theme.strings.addToCartSuccess, htmlAlert, 3000, 'notice');
                                    })
                                }
                                $(popupUpsell).modal('hide');
                            })
                        }
                    })()

                    // Coupon
                    theme.coupon = (function() {
                        var popupCoupon = '#jsCoupon',
                            $button = $('#jsCoupon .js-btn-coupon'),
                            delayTime = $('#jsCoupon').data('delay') || 3000,
                            isCoupon = $(popupCoupon).length === 1 ? true : false,
                            isCopied = localStorage.getItem('localCoupon') || '';
                        if (isCoupon && isCopied === '') {
                            $(document).ready(function() {
                                setTimeout(function() {
                                    $(popupCoupon).modal('show');
                                }, delayTime);
                            });
                            $button.on('click', function() {
                                var copyText = document.getElementById("coupon_code");
                                copyText.select();
                                document.execCommand("Copy");
                                $(popupCoupon).modal('hide');
                                theme.alert.new('Coupon code', 'Successfully copied, now you can paste code at checkout', 4000);
                                localStorage.setItem('localCoupon', 'copied');
                            })
                        }
                    })()

                    // Overwrite Shopify.onError in Shopify API
                    Shopify.onError = function(t, r) {
                        var e = eval("(" + t.responseText + ")");
                        var mess = e.message ? e.message + "(" + e.status + "): " + e.description : "Error : " + Shopify.fullMessagesFromErrors(e).join("; ") + "."
                        theme.alert.new('Alert', mess, 3000, 'warning');
                    }

                    // Megamenu width
                    theme.fixWidthMegamenu = (function() {
                        var $megamenuClass = $('.site-nav__item-mega'),
                            megaDropdownClass = '.meganav';
                        $megamenuClass.each(function() {
                            var widthMenu = $(this).data('width') || 0;
                            if (widthMenu !== 0) {
                                $(this).find(megaDropdownClass).css({ 'width': widthMenu + 'px', 'margin-left': '-' + widthMenu / 2 + 'px' });
                            }
                        });
                    })()

                    // Product video
                    theme.productVideo = (function() {
                        var playButtonClass = '.js-play-button';
                        $(document).on('click', playButtonClass, function() {
                            let videoSelector = $(this).next(),
                                videoObject = videoSelector.get(0);
                            $(this).toggleClass('active');
                            videoSelector.toggleClass('active');
                            videoObject.paused ? videoObject.play() : videoObject.pause();
                        })
                    })()

                    // Fake-viewers
                    theme.fakeViewer = (function() {
                        var $fakeViewClass = $('.js-fake-view'),
                            minValue = $fakeViewClass.data('min'),
                            maxValue = $fakeViewClass.data('max'),
                            duration = $fakeViewClass.data('duration');

                        function randomInRange(start, end) {
                            var value = Math.floor(Math.random() * (end - start + 1) + start);
                            $fakeViewClass.text(value);
                        }

                        if (minValue !== undefined && maxValue !== undefined) {
                            randomInRange(minValue, maxValue);
                            setInterval(function() {
                                randomInRange(minValue, maxValue);
                            }, duration);
                        }

                    })();

                    // Product-suggest
                    theme.productSuggest = (function() {
                        var $productSuggestClass = $('.product-notification'),
                            $closeButtonClass = $('.close-notifi'),
                            duration = $productSuggestClass.data('time') || 0,
                            productSuggestCookie = 'cookieSuggest';

                        function SomeonePurchased() {
                            if ($.cookie(productSuggestCookie) == 'closed') {
                                $productSuggestClass.remove();
                            }
                            $closeButtonClass.on('click', function() {
                                $productSuggestClass.remove();
                                $.cookie(productSuggestCookie, 'closed', { expires: 1, path: '/' });
                            });

                            function toggleSomething() {
                                if ($productSuggestClass.hasClass('active')) {
                                    $productSuggestClass.removeClass('active')
                                } else {
                                    var arrayProducts = $('.data-product'),
                                        randomProduct = Math.floor(Math.random() * arrayProducts.length),
                                        Object = $(arrayProducts[randomProduct]);

                                    $productSuggestClass.addClass('active');
                                    $productSuggestClass.find('.product-image').attr('href', Object.data('url')).find('img').attr('src', Object.data('image'));
                                    $productSuggestClass.find('.product-name').text(Object.data('title')).attr('href', Object.data('url'));
                                    $productSuggestClass.find('.time-ago').text(Object.data('time'));
                                    $productSuggestClass.find('.from-ago').text(Object.data('local'));
                                }
                            }

                            if (duration !== 0) {
                                setInterval(toggleSomething, duration);
                            }
                        }
                        SomeonePurchased();
                    })()


                    // Stickyheader
                    theme.stickyHeader = (function() {
                        var stickHeaderClass = '.site-header--sticky';
                        if ($(stickHeaderClass).length !== 0) {
                            $(window).scroll(function() {
                                if (window.pageYOffset >= 20) {
                                    $(stickHeaderClass).addClass('active');
                                } else {
                                    $(stickHeaderClass).removeClass('active');
                                }
                            });
                        }
                    })()

                    theme.PhotoSwipe = (function() {
                        var initPhotoSwipeFromDOM = function(gallerySelector) {

                            // parse slide data (url, title, size ...) from DOM elements 
                            // (children of gallerySelector)
                            var parseThumbnailElements = function(el) {
                                var thumbElements = el.childNodes,
                                    numNodes = thumbElements.length,
                                    items = [],
                                    figureEl,
                                    linkEl,
                                    size,
                                    item;

                                for (var i = 0; i < numNodes; i++) {

                                    figureEl = thumbElements[i]; // <figure> element

                                    // include only element nodes 
                                    if (figureEl.nodeType !== 1) {
                                        continue;
                                    }

                                    linkEl = figureEl.children[0]; // <a> element

                                    size = linkEl.getAttribute('data-size').split('x');

                                    // create slide object
                                    item = {
                                        src: linkEl.getAttribute('href'),
                                        w: parseInt(size[0], 10),
                                        h: parseInt(size[1], 10)
                                    };



                                    if (figureEl.children.length > 1) {
                                        // <figcaption> content
                                        item.title = figureEl.children[1].innerHTML;
                                    }

                                    if (linkEl.children.length > 0) {
                                        // <img> thumbnail element, retrieving thumbnail url
                                        item.msrc = linkEl.children[0].getAttribute('src');
                                    }

                                    item.el = figureEl; // save link to element for getThumbBoundsFn
                                    items.push(item);
                                }

                                return items;
                            };

                            // find nearest parent element
                            var closest = function closest(el, fn) {
                                return el && (fn(el) ? el : closest(el.parentNode, fn));
                            };

                            // triggers when user clicks on thumbnail
                            var onThumbnailsClick = function(e) {
                                e = e || window.event;
                                e.preventDefault ? e.preventDefault() : e.returnValue = false;

                                var eTarget = e.target || e.srcElement;

                                // find root element of slide
                                var clickedListItem = closest(eTarget, function(el) {
                                    return (el.tagName && el.tagName.toUpperCase() === 'FIGURE');
                                });

                                if (!clickedListItem) {
                                    return;
                                }

                                // find index of clicked item by looping through all child nodes
                                // alternatively, you may define index via data- attribute
                                var clickedGallery = clickedListItem.parentNode,
                                    childNodes = clickedListItem.parentNode.childNodes,
                                    numChildNodes = childNodes.length,
                                    nodeIndex = 0,
                                    index;

                                for (var i = 0; i < numChildNodes; i++) {
                                    if (childNodes[i].nodeType !== 1) {
                                        continue;
                                    }

                                    if (childNodes[i] === clickedListItem) {
                                        index = nodeIndex;
                                        break;
                                    }
                                    nodeIndex++;
                                }



                                if (index >= 0) {
                                    // open PhotoSwipe if valid index found
                                    openPhotoSwipe(index, clickedGallery);
                                }
                                return false;
                            };

                            // parse picture index and gallery index from URL (#&pid=1&gid=2)
                            var photoswipeParseHash = function() {
                                var hash = window.location.hash.substring(1),
                                    params = {};

                                if (hash.length < 5) {
                                    return params;
                                }

                                var vars = hash.split('&');
                                for (var i = 0; i < vars.length; i++) {
                                    if (!vars[i]) {
                                        continue;
                                    }
                                    var pair = vars[i].split('=');
                                    if (pair.length < 2) {
                                        continue;
                                    }
                                    params[pair[0]] = pair[1];
                                }

                                if (params.gid) {
                                    params.gid = parseInt(params.gid, 10);
                                }

                                return params;
                            };

                            var openPhotoSwipe = function(index, galleryElement, disableAnimation, fromURL) {
                                var pswpElement = document.querySelectorAll('.pswp')[0],
                                    gallery,
                                    options,
                                    items;

                                items = parseThumbnailElements(galleryElement);

                                // define options (if needed)
                                options = {
                                    maxSpreadZoom: 1,
                                    bgOpacity: 0.7,
                                    zoomEl: true,
                                    history: false,
                                    zoomEl: false,
                                    pinchToClose: false,
                                    closeOnScroll: false,
                                    // define gallery index (for URL)
                                    galleryUID: galleryElement.getAttribute('data-pswp-uid'),

                                };

                                // PhotoSwipe opened from URL
                                if (fromURL) {
                                    if (options.galleryPIDs) {
                                        // parse real index when custom PIDs are used 
                                        // http://photoswipe.com/documentation/faq.html#custom-pid-in-url
                                        for (var j = 0; j < items.length; j++) {
                                            if (items[j].pid == index) {
                                                options.index = j;
                                                break;
                                            }
                                        }
                                    } else {
                                        // in URL indexes start from 1
                                        options.index = parseInt(index, 10) - 1;
                                    }
                                } else {
                                    options.index = parseInt(index, 10);
                                }

                                // exit if index not found
                                if (isNaN(options.index)) {
                                    return;
                                }

                                if (disableAnimation) {
                                    options.showAnimationDuration = 0;
                                }

                                // Pass data to PhotoSwipe and initialize it
                                gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, items, options);
                                gallery.init();
                            };

                            // loop through all gallery elements and bind events
                            var galleryElements = document.querySelectorAll(gallerySelector);

                            for (var i = 0, l = galleryElements.length; i < l; i++) {
                                galleryElements[i].setAttribute('data-pswp-uid', i + 1);
                                galleryElements[i].onclick = onThumbnailsClick;
                            }

                            // Parse URL and open gallery if it contains #&pid=3&gid=1
                            var hashData = photoswipeParseHash();
                            if (hashData.pid && hashData.gid) {
                                openPhotoSwipe(hashData.pid, galleryElements[hashData.gid - 1], true, true);
                            }
                        };

                        // execute above function
                        initPhotoSwipeFromDOM('.my-gallery');
                    })()

                    theme.ZoomImage = (function() {
                        $(window).resize(function() {
                            var width = $(window).width();
                            if (width > 767) {
                                ZoomImage();
                            }
                        });
                        $(window).width(function() {
                            var width = $(window).width();
                            if (width > 767) {
                                ZoomImage();
                            }
                        });

                        function ZoomImage() {
                            $(".zoom_image").each(function(arg, el) {
                                var image = $(el).find("img");
                                $(el).zoom({
                                    on: 'mouseover',
                                    url: image.attr("src").replace("small", "big")
                                });
                            });
                        }
                    })()

                    theme.activeAccordion = (function() {
                        $('.collapse').on('shown.bs.collapse', function() {
                            $(this).prev().addClass('active-acc');
                        });
                        $('.collapse').on('hidden.bs.collapse', function() {
                            $(this).prev().removeClass('active-acc');
                        });
                    })()


                    // Anchor scroll
                    theme.anchorScroll = (function() {
                        $(document).on('click', 'a[href^="#"]', function(event) {
                            event.preventDefault();
                            var disableAnchor = $(this).hasClass('disabled-anchor');
                            if (!disableAnchor) {
                                $('html, body').animate({
                                    scrollTop: $($.attr(this, 'href')).offset().top
                                }, 500);
                            }
                        });
                    })()

                    // Product-recently-viewed
                    theme.productRecentlyViewed = (function() {
                        var $viewedElement = $('.js-recently-view'),
                            $viewButton = $('.js-recently-view-button'),
                            $content = $('.js-recently-view-content'),
                            productHandle = $viewedElement.data('handle') || '',
                            limit = $viewButton.data('limit') || 0,
                            arrayProduct = JSON.parse(localStorage.getItem('localRecentlyViewed')) || [],
                            lastProduct = arrayProduct[arrayProduct.length - 1] || '',
                            isAdded = $.inArray(productHandle, arrayProduct) !== -1 ? true : false;

                        function processViewed() {
                            if (productHandle !== '') {
                                //process last product
                                if (lastProduct === productHandle && arrayProduct.length > 1) {
                                    lastProduct = arrayProduct[arrayProduct.length - 2]
                                }

                                //move current product to last of array
                                if (isAdded) {
                                    arrayProduct.splice(arrayProduct.indexOf(productHandle), 1);
                                }
                                arrayProduct.push(productHandle);
                                //remove first item if limit
                                if (arrayProduct.length > limit) {
                                    arrayProduct.shift()
                                }
                                localStorage.setItem('localRecentlyViewed', JSON.stringify(arrayProduct));
                            }
                        }

                        function generatorProduct() {
                            $content.html('');
                            if (arrayProduct.length > 0) {
                                //array
                                for (var i = 0; i < arrayProduct.length; i++) {
                                    var productHandle = arrayProduct[i];
                                    Shopify.getProduct(productHandle, function(product) {
                                        var htmlProduct = '';
                                        var productPrice = product.price_varies ? 'from ' + theme.Currency.formatMoney(product.price_min, theme.moneyFormat) : theme.Currency.formatMoney(product.price, theme.moneyFormat);
                                        var productComparePrice = product.compare_at_price_min !== 0 ? theme.Currency.formatMoney(product.compare_at_price_min, theme.moneyFormat) : '';
                                        htmlProduct += '<div class="col-12 col-lg-4 js-viewed-item mb-4">';
                                        htmlProduct += '	<div class="border p-3 rounded media d-flex ">';
                                        htmlProduct += '	<a class="mr-3 col-4 p-0" href="' + product.url + '">';
                                        htmlProduct += '		<img src="' + product.featured_image + '"/>';
                                        htmlProduct += '	</a>';
                                        htmlProduct += '	<div class="media-body text-left">';
                                        htmlProduct += '		<h4 class="mb-2 mt-2"><a href="' + product.url + '">' + product.title + '</a></h5>';
                                        htmlProduct += '	<span> ' + productPrice + '</span>';
                                        htmlProduct += '	<s>' + productComparePrice + '</s>';
                                        htmlProduct += '	</div>';
                                        htmlProduct += '	</div>';
                                        htmlProduct += '</div>';
                                        $content.append(htmlProduct);
                                        theme.updateCurrencies();
                                    });
                                }

                                //last product
                                Shopify.getProduct(lastProduct, function(product) {
                                    $viewButton.css('background-image', 'url(' + product.featured_image + ')').addClass('active');
                                })
                            }
                        }

                        processViewed();
                        generatorProduct();

                    })()

                    // Notice when soldout
                    theme.alert = (function() {
                        function createAlert(title, mess, time, type) {
                            var aTitle = title || '',
                                aTime = time || 2000,
                                aMessage = mess || '',
                                aClass = type || 'default';
                            $.growl({
                                title: aTitle,
                                message: aMessage,
                                duration: aTime,
                                style: aClass,
                                size: 'large'
                            });
                        }

                        return {
                            new: createAlert
                        }
                    })()

                    // Notice when soldout
                    theme.noticeSoldout = (function() {
                        var $soldoutWrapFormClass = $('.js-contact-soldout'),
                            $textClass = $('.js-notify-text'),
                            $soldoutValueId = $('#ContactProduct');

                        function noticeSoldout(variant) {
                            $soldoutWrapFormClass.find('.form-success').remove()
                            if (variant.available) {
                                $textClass.find('span').text('');
                                $soldoutWrapFormClass.addClass('hide');
                            } else {
                                $textClass.find('span').text(': ' + variant.name);
                                $soldoutWrapFormClass.removeClass('hide');
                                $soldoutValueId.val(variant.name).attr('value', variant.name);
                            }
                        }
                        return {
                            init: noticeSoldout
                        }
                    })()

                    // Sticky cart
                    theme.stickyCart = (function() {
                        var $anchor = $('#js-anchor-sticky-cart'),
                            $stCart = $('.sticky-cart-wr'),
                            $close = $('#js-sticky-close'),
                            disableStCart = localStorage.getItem('localDisableStCart') || '';
                        if (disableStCart !== '') {
                            $stCart.addClass('disable');
                        }
                        $close.on('click', function() {
                            var isDisable = disableStCart !== '';
                            if (isDisable) {
                                localStorage.setItem('localDisableStCart', '');
                            } else {
                                localStorage.setItem('localDisableStCart', 'true');
                            }
                            $stCart.toggleClass('disable');
                        })
                        if ($anchor.length) {
                            $(window).on('scroll', function() {
                                var hT = $anchor.offset().top,
                                    hH = $anchor.outerHeight(),
                                    wH = $(window).height(),
                                    wS = $(this).scrollTop();
                                if (wS > (hT + hH - wH)) {
                                    $stCart.addClass('active');
                                } else {
                                    $stCart.removeClass('active');
                                }
                            });
                        }

                    })()

                    //Fix reload safari
                    window.addEventListener("pageshow", function(evt) {
                        if (evt.persisted) {
                            setTimeout(function() {
                                window.location.reload();
                            }, 10);
                        }
                    }, false);

                    // Back to top
                    theme.backToTop = (function() {
                        var backtotopClass = $('.js-back-to-top');
                        $(window).scroll(function() {
                            if ($(this).scrollTop() > 300) {
                                backtotopClass.fadeIn('slow');
                            } else {
                                backtotopClass.fadeOut('slow');
                            }
                        });
                        backtotopClass.on('click', function() {
                            $('body,html').animate({ scrollTop: 0 }, 800);
                        });
                    })()


                    // Tooltip
                    theme.tooltip = (function() {
                        var selector = '[data-toggle="tooltip"],[data-tooltip="true"]';

                        function loadTooltip() {
                            $(selector).tooltip(); //Bootstrap 4
                        };
                        $(document).on('click', selector, function() {
                            $(this).tooltip('hide');
                        });
                        loadTooltip();
                        return {
                            load: loadTooltip
                        }
                    })()

                    //Collections style 2
                    theme.Bgcollection = (function() {
                        // init Isotope
                        function Bgcollection(container) {
                            var $container = this.$container = $(container);
                            var sectionId = $container.attr('data-section-id');
                            var wrapper = this.wrapper = '.bgcollection-wrapper';
                            var slider = this.slider = '#Bgcollection-' + sectionId;
                            var $slider = $(slider, wrapper);
                            $(".colgrid__bg--full[data-index='1']").addClass('active');
                            $('.colgrid .colgrid__box').each(function() {
                                var index = $(this).attr("data-index");
                                $(this).hover(
                                    function() {
                                        $(".colgrid__bg--full[data-index='" + index + "']").addClass('active');
                                    },
                                    function() {
                                        $(".colgrid__bg--full[data-index='" + index + "']").removeClass('active');
                                    }
                                );
                            });
                        }

                        return Bgcollection;
                    })();


                    //Sidebar
                    theme.sidebar = (function() {
                        var togglebutton = '.js-toggle-filter',
                            $sidebar = $('.js-sidebar');
                        $(document).on('click', togglebutton, function() {
                            $sidebar.toggleClass('active');
                            $(this).toggleClass('active');
                        })
                    })()

                    // Ajax filter in collection page
                    theme.ajaxFilter = (function() {
                        var ajaxContent = '#js-product-ajax',
                            ajaxSortBy = '#js-sortby',
                            ajaxFillter = '#js-fillter',
                            ajaxCollectionTitle = '.js-collection-title',
                            pageTitle = $(document).find("title").text(),
                            jsLoading = '#js-loading';

                        var apollo = {
                            init: function() {
                                this.initFilter();
                            },
                            showLoading: function() {
                                $(jsLoading).show();
                            },
                            hideLoading: function() {
                                $('body,html').animate({
                                    scrollTop: $('#MainContent').offset().top - 150
                                }, 600);
                                setTimeout(function() {
                                    $(jsLoading).hide(); //delay 500ms for better UX
                                }, 500);

                            },
                            initFilter: function() {
                                apollo.filterParams();
                                apollo.filterSortby();
                                apollo.sidebarMapTagEvents();
                                apollo.filterMapSorting();
                                apollo.filterMapPaging();
                            },
                            filterParams: function() {
                                Shopify.queryParams = {};
                                if (location.search.length) {
                                    for (var aKeyValue, i = 0, aCouples = location.search.substr(1).split('&'); i < aCouples.length; i++) {
                                        aKeyValue = aCouples[i].split('=');
                                        if (aKeyValue.length > 1) {
                                            Shopify.queryParams[decodeURIComponent(aKeyValue[0])] = decodeURIComponent(aKeyValue[1]);
                                        }
                                    }
                                }
                            },
                            filterSortby: function() {
                                if (Shopify.queryParams.sort_by) {
                                    var sortby = Shopify.queryParams.sort_by;
                                    $(ajaxSortBy).val(sortby);
                                }
                            },
                            filterCreateUrl: function(baseLink) {
                                var newQuery = $.param(Shopify.queryParams).replace(/%2B/g, '+');
                                if (baseLink) {
                                    if (newQuery != "") {
                                        return baseLink + "?" + newQuery;
                                    } else {
                                        return baseLink;
                                    }
                                }
                                return location.pathname + "?" + newQuery;
                            },
                            filterMapData: function(data) {
                                // 1. update product grid
                                $(ajaxContent).html($(ajaxContent, data.responseText).html());
                                // 2. update left filter
                                $(ajaxFillter).html($(ajaxFillter, data.responseText).html());
                                // 3. update collection title
                                $(ajaxCollectionTitle).html($(ajaxCollectionTitle, data.responseText).html());
                            },
                            filterAjaxClick: function(baseLink) {
                                delete Shopify.queryParams.page;
                                var newurl = apollo.filterCreateUrl(baseLink);
                                History.pushState({
                                    param: Shopify.queryParams
                                }, pageTitle, newurl);
                                apollo.filterGetContent(newurl);
                            },
                            filterGetContent: function(newurl) {
                                $.ajax({
                                    type: 'GET',
                                    url: newurl,
                                    data: {},
                                    beforeSend: function() {
                                        apollo.showLoading();
                                    },
                                    complete: function(data) {
                                        apollo.filterMapData(data);
                                        theme.wishlist.load();
                                        theme.compare.load();
                                        theme.countdown.load();
                                        theme.priceRange.load();
                                        theme.tooltip.load();
                                        theme.collectionView.triggerView();
                                        theme.swatchCard2.load();
                                        theme.infiniteScroll.load();
                                        apollo.hideLoading();
                                    },
                                    error: function(xhr, text) {
                                        apollo.hideLoading();
                                        alert($.parseJSON(xhr.responseText).description);
                                    }
                                });
                            },
                            sidebarMapTagEvents: function() {
                                $(document).on('click', '.advanced-filter a', function(event) {
                                    event.preventDefault();
                                    $('.tooltip').removeClass('show');
                                    var currentTags = [];
                                    if (Shopify.queryParams.constraint) {
                                        currentTags = Shopify.queryParams.constraint.split('+');
                                    }
                                    if (!$(this).parent().hasClass("active-filter")) {
                                        var otherTag = $(this).parents('.catalog_filter_ul').find("li.active-filter");
                                        if (otherTag.length > 0) {
                                            var tagName = otherTag.data("handle");
                                            if (tagName) {
                                                var tagPos = currentTags.indexOf(tagName);
                                                if (tagPos >= 0) {
                                                    currentTags.splice(tagPos, 1);
                                                }
                                            }
                                        }
                                    }
                                    var dataHandle = $(this).parent().data("handle");
                                    if (dataHandle) {
                                        var tagPos = currentTags.indexOf(dataHandle);
                                        if (tagPos >= 0) {
                                            currentTags.splice(tagPos, 1);
                                        } else {
                                            currentTags.push(dataHandle);
                                        }
                                    }
                                    if (currentTags.length) {
                                        Shopify.queryParams.constraint = currentTags.join('+');
                                    } else {
                                        delete Shopify.queryParams.constraint;
                                    }
                                    apollo.filterAjaxClick();
                                });
                                $(document).on('click', '.advanced-filter .icon', function() {
                                    $(this).parent('.advanced-filter').find('a').trigger("click");
                                });
                            },
                            filterMapSorting: function() {
                                $(document).on('change', ajaxSortBy, function() {
                                    Shopify.queryParams.sort_by = $(this).val();
                                    apollo.filterAjaxClick();
                                })
                            },
                            filterMapPaging: function() {
                                $(document).on('click', '.js-pagination a', function() {
                                    event.preventDefault();
                                    var linkPage = $(this).attr("href").match(/page=\d+/g);
                                    if (linkPage) {
                                        Shopify.queryParams.page = parseInt(linkPage[0].match(/\d+/g));
                                        if (Shopify.queryParams.page) {
                                            var newurl = apollo.filterCreateUrl();
                                            History.pushState({
                                                param: Shopify.queryParams
                                            }, pageTitle, newurl);
                                            apollo.filterGetContent(newurl);
                                        }
                                    }
                                });
                            }
                        }

                        if ($(".template-collection")) {
                            History.Adapter.bind(window, 'statechange', function() {
                                var State = History.getState();
                                apollo.filterParams();
                            });
                        }
                        apollo.init();

                    })(); $(theme.init);

/**
 * Currency Helpers
 * -----------------------------------------------------------------------------
 * A collection of useful functions that help with currency formatting
 *
 * Current contents
 * - formatMoney - Takes an amount in cents and returns it as a formatted dollar value.
 *
 * Alternatives
 * - Accounting.js - http://openexchangerates.github.io/accounting.js/
 *
 */

theme.Currency = (function() {
    var moneyFormat = '${{amount}}'; // eslint-disable-line camelcase

    function formatMoney(cents, format) {
        if (typeof cents === 'string') {
            cents = cents.replace('.', '');
        }
        var value = '';
        var placeholderRegex = /\{\{\s*(\w+)\s*\}\}/;
        var formatString = format || moneyFormat;

        function formatWithDelimiters(number, precision, thousands, decimal) {
            thousands = thousands || ',';
            decimal = decimal || '.';

            if (isNaN(number) || number === null) {
                return 0;
            }

            number = (number / 100.0).toFixed(precision);

            var parts = number.split('.');
            var dollarsAmount = parts[0].replace(
                /(\d)(?=(\d\d\d)+(?!\d))/g,
                '$1' + thousands
            );
            var centsAmount = parts[1] ? decimal + parts[1] : '';

            return dollarsAmount + centsAmount;
        }

        switch (formatString.match(placeholderRegex)[1]) {
            case 'amount':
                value = formatWithDelimiters(cents, 2);
                break;
            case 'amount_no_decimals':
                value = formatWithDelimiters(cents, 0);
                break;
            case 'amount_with_comma_separator':
                value = formatWithDelimiters(cents, 2, '.', ',');
                break;
            case 'amount_no_decimals_with_comma_separator':
                value = formatWithDelimiters(cents, 0, '.', ',');
                break;
            case 'amount_no_decimals_with_space_separator':
                value = formatWithDelimiters(cents, 0, ' ');
                break;
            case 'amount_with_apostrophe_separator':
                value = formatWithDelimiters(cents, 2, "'");
                break;
        }
        return formatString.replace(placeholderRegex, value);
    }

    return {
        formatMoney: formatMoney
    };
})();

/**
 * Image Helper Functions
 * -----------------------------------------------------------------------------
 * A collection of functions that help with basic image operations.
 *
 */

theme.Images = (function() {
    /**
     * Preloads an image in memory and uses the browsers cache to store it until needed.
     *
     * @param {Array} images - A list of image urls
     * @param {String} size - A shopify image size attribute
     */

    function preload(images, size) {
        if (typeof images === 'string') {
            images = [images];
        }

        for (var i = 0; i < images.length; i++) {
            var image = images[i];
            this.loadImage(this.getSizedImageUrl(image, size));
        }
    }

    /**
     * Loads and caches an image in the browsers cache.
     * @param {string} path - An image url
     */
    function loadImage(path) {
        new Image().src = path;
    }

    /**
     * Swaps the src of an image for another OR returns the imageURL to the callback function
     * @param image
     * @param element
     * @param callback
     */
    function switchImage(image, element, callback) {
        var size = this.imageSize(element.src);
        var imageUrl = this.getSizedImageUrl(image.src, size);

        if (callback) {
            callback(imageUrl, image, element); // eslint-disable-line callback-return
        } else {
            element.src = imageUrl;
        }
    }

    /**
     * +++ Useful
     * Find the Shopify image attribute size
     *
     * @param {string} src
     * @returns {null}
     */
    function imageSize(src) {
        src = src || '';

        var match = src.match(
            /.+_((?:pico|icon|thumb|small|compact|medium|large|grande)|\d{1,4}x\d{0,4}|x\d{1,4})[_\\.@]/
        );

        if (match === null) {
            return null;
        } else {
            return match[1];
        }
    }

    /**
     * +++ Useful
     * Adds a Shopify size attribute to a URL
     *
     * @param src
     * @param size
     * @returns {*}
     */
    function getSizedImageUrl(src, size) {
        if (size === null) {
            return src;
        }

        if (size === 'master') {
            return this.removeProtocol(src);
        }

        var match = src.match(
            /\.(jpg|jpeg|gif|png|bmp|bitmap|tiff|tif)(\?v=\d+)?$/i
        );

        if (match !== null) {
            var prefix = src.split(match[0]);
            var suffix = match[0];

            return this.removeProtocol(prefix[0] + '_' + size + suffix);
        }

        return null;
    }

    function removeProtocol(path) {
        return path.replace(/http(s)?:/, '');
    }

    return {
        preload: preload,
        loadImage: loadImage,
        switchImage: switchImage,
        imageSize: imageSize,
        getSizedImageUrl: getSizedImageUrl,
        removeProtocol: removeProtocol
    };
})();

/**
 * Variant Selection scripts
 * ------------------------------------------------------------------------------
 *
 * Handles change events from the variant inputs in any `cart/add` forms that may
 * exist.  Also updates the master select and triggers updates when the variants
 * price or image changes.
 *
 * @namespace variants
 */

slate.Variants = (function() {
    /**
     * Variant constructor
     *
     * @param {object} options - Settings from `product.js`
     */
    function Variants(options) {
        this.$container = options.$container;
        this.product = options.product;
        this.singleOptionSelector = options.singleOptionSelector;
        this.originalSelectorId = options.originalSelectorId;
        this.enableHistoryState = options.enableHistoryState;
        this.currentVariant = this._getVariantFromOptions();

        $(this.singleOptionSelector, this.$container).on(
            'change',
            this._onSelectChange.bind(this)
        );
    }

    Variants.prototype = _.assignIn({}, Variants.prototype, {
        /**
         * Get the currently selected options from add-to-cart form. Works with all
         * form input elements.
         *
         * @return {array} options - Values of currently selected variants
         */
        _getCurrentOptions: function() {
            var currentOptions = _.map(
                $(this.singleOptionSelector, this.$container),
                function(element) {
                    var $element = $(element);
                    var type = $element.attr('type');
                    var currentOption = {};

                    if (type === 'radio' || type === 'checkbox') {
                        if ($element[0].checked) {
                            currentOption.value = $element.val();
                            currentOption.index = $element.data('index');

                            return currentOption;
                        } else {
                            return false;
                        }
                    } else {
                        currentOption.value = $element.val();
                        currentOption.index = $element.data('index');

                        return currentOption;
                    }
                }
            );

            // remove any unchecked input values if using radio buttons or checkboxes
            currentOptions = _.compact(currentOptions);

            return currentOptions;
        },

        /**
         * Find variant based on selected values.
         *
         * @param  {array} selectedValues - Values of variant inputs
         * @return {object || undefined} found - Variant object from product.variants
         */
        _getVariantFromOptions: function() {
            var selectedValues = this._getCurrentOptions();
            var variants = this.product.variants;

            var found = _.find(variants, function(variant) {
                return selectedValues.every(function(values) {
                    return _.isEqual(variant[values.index], values.value);
                });
            });

            return found;
        },

        /**
         * Event handler for when a variant input changes.
         */
        _onSelectChange: function() {
            var variant = this._getVariantFromOptions();

            this.$container.trigger({
                type: 'variantChange',
                variant: variant
            });

            if (!variant) {
                return;
            }

            this._updateMasterSelect(variant);
            this._updateImages(variant);
            this._updatePrice(variant);
            this._updateSKU(variant);
            this.currentVariant = variant;

            if (this.enableHistoryState) {
                this._updateHistoryState(variant);
            }
        },

        /**
         * Trigger event when variant image changes
         *
         * @param  {object} variant - Currently selected variant
         * @return {event}  variantImageChange
         */
        _updateImages: function(variant) {
            var variantImage = variant.featured_image || {};
            var currentVariantImage = this.currentVariant.featured_image || {};

            if (!variant.featured_image ||
                variantImage.src === currentVariantImage.src
            ) {
                return;
            }

            this.$container.trigger({
                type: 'variantImageChange',
                variant: variant
            });
        },

        /**
         * Trigger event when variant price changes.
         *
         * @param  {object} variant - Currently selected variant
         * @return {event} variantPriceChange
         */
        _updatePrice: function(variant) {
            if (
                variant.price === this.currentVariant.price &&
                variant.compare_at_price === this.currentVariant.compare_at_price
            ) {
                return;
            }

            this.$container.trigger({
                type: 'variantPriceChange',
                variant: variant
            });
        },

        /**
         * Trigger event when variant sku changes.
         *
         * @param  {object} variant - Currently selected variant
         * @return {event} variantSKUChange
         */
        _updateSKU: function(variant) {
            if (variant.sku === this.currentVariant.sku) {
                return;
            }

            this.$container.trigger({
                type: 'variantSKUChange',
                variant: variant
            });
        },

        /**
         * Update history state for product deeplinking
         *
         * @param  {variant} variant - Currently selected variant
         * @return {k}         [description]
         */
        _updateHistoryState: function(variant) {
            if (!history.replaceState || !variant) {
                return;
            }

            var newurl =
                window.location.protocol +
                '//' +
                window.location.host +
                window.location.pathname +
                '?variant=' +
                variant.id;
            window.history.replaceState({ path: newurl }, '', newurl);
        },

        /**
         * Update hidden master select of variant change
         *
         * @param  {variant} variant - Currently selected variant
         */
        _updateMasterSelect: function(variant) {
            $(this.originalSelectorId, this.$container).val(variant.id);
        }
    });

    return Variants;
})();


/*================ MODULES ================*/
window.Drawers = (function() {
    var Drawer = function(id, position, options) {
        var defaults = {
            close: '.js-drawer-close',
            open: '.js-drawer-open-' + position,
            openClass: 'js-drawer-open',
            dirOpenClass: 'js-drawer-open-' + position
        };

        this.nodes = {
            $parent: $('body, html'),
            $page: $('.page-element'),
            $moved: $('.is-moved-by-drawer')
        };

        this.config = $.extend(defaults, options);
        this.position = position;

        this.$drawer = $('#' + id);
        this.$open = $(this.config.open);

        if (!this.$drawer.length) {
            return false;
        }

        this.drawerIsOpen = false;
        this.init();
    };

    Drawer.prototype.init = function() {
        this.$open.attr('aria-expanded', 'false');
        this.$open.on('click', $.proxy(this.open, this));
        this.$drawer.find(this.config.close).on('click', $.proxy(this.close, this));
    };

    Drawer.prototype.open = function(evt) {
        // Keep track if drawer was opened from a click, or called by another function
        var externalCall = false;

        // don't open an opened drawer
        if (this.drawerIsOpen) {
            return;
        }

        this.$open.addClass(this.config.openClass);

        // Prevent following href if link is clicked
        if (evt) {
            evt.preventDefault();
        } else {
            externalCall = true;
        }

        // Without this, the drawer opens, the click event bubbles up to $nodes.page
        // which closes the drawer.
        if (evt && evt.stopPropagation) {
            evt.stopPropagation();
            // save the source of the click, we'll focus to this on close
            this.$activeSource = $(evt.currentTarget);
        }

        if (this.drawerIsOpen && !externalCall) {
            return this.close();
        }

        // Add is-transitioning class to moved elements on open so drawer can have
        // transition for close animation
        this.nodes.$moved.addClass('is-transitioning');
        this.$drawer.prepareTransition();

        this.nodes.$parent.addClass(
            this.config.openClass + ' ' + this.config.dirOpenClass
        );
        this.drawerIsOpen = true;

        // Set focus on drawer
        slate.a11y.trapFocus({
            $container: this.$drawer,
            namespace: 'drawer_focus'
        });

        // Run function when draw opens if set
        if (
            this.config.onDrawerOpen &&
            typeof this.config.onDrawerOpen === 'function'
        ) {
            if (!externalCall) {
                this.config.onDrawerOpen();
            }
        }

        if (this.$activeSource && this.$activeSource.attr('aria-expanded')) {
            this.$activeSource.attr('aria-expanded', 'true');
        }

        this.bindEvents();
    };

    Drawer.prototype.close = function() {
        // don't close a closed drawer
        if (!this.drawerIsOpen) {
            return;
        }

        this.$open.removeClass(this.config.openClass);

        // deselect any focused form elements
        $(document.activeElement).trigger('blur');

        // Ensure closing transition is applied to moved elements, like the nav
        this.nodes.$moved.prepareTransition({ disableExisting: true });
        this.$drawer.prepareTransition({ disableExisting: true });

        this.nodes.$parent.removeClass(
            this.config.dirOpenClass + ' ' + this.config.openClass
        );

        this.drawerIsOpen = false;

        // Remove focus on drawer
        slate.a11y.removeTrapFocus({
            $container: this.$drawer,
            namespace: 'drawer_focus'
        });

        if (this.$activeSource && this.$activeSource.attr('aria-expanded')) {
            this.$activeSource.attr('aria-expanded', 'false');
        }

        this.unbindEvents();
    };

    Drawer.prototype.bindEvents = function() {
        // Lock scrolling on mobile
        this.nodes.$page.on('touchmove.drawer', function() {
            return false;
        });

        // Clicking out of drawer closes it
        this.nodes.$page.on(
            'click.drawer',
            $.proxy(function() {
                this.close();
                return false;
            }, this)
        );

        // Pressing escape closes drawer
        this.nodes.$parent.on(
            'keyup.drawer',
            $.proxy(function(evt) {
                if (evt.keyCode === 27) {
                    this.close();
                }
            }, this)
        );
    };

    Drawer.prototype.unbindEvents = function() {
        this.nodes.$page.off('.drawer');
        this.nodes.$parent.off('.drawer');
    };

    return Drawer;
})();

window.Modals = (function() {
    var Modal = function(id, name, options) {
        var defaults = {
            close: '.js-modal-close',
            open: '.js-modal-open-' + name,
            openClass: 'modal--is-active'
        };

        this.$modal = $('#' + id);

        if (!this.$modal.length) {
            return false;
        }

        this.nodes = {
            $body: $('body')
        };

        this.config = $.extend(defaults, options);

        this.modalIsOpen = false;
        this.$focusOnOpen = this.config.focusOnOpen ?
            $(this.config.focusOnOpen) :
            this.$modal;
        this.init();
    };

    Modal.prototype.init = function() {
        var $openBtn = $(this.config.open);

        // Add aria controls
        $openBtn.attr('aria-expanded', 'false');

        $(this.config.open).on('click', $.proxy(this.open, this));
        this.$modal.find(this.config.close).on('click', $.proxy(this.close, this));
    };

    Modal.prototype.open = function(evt) {
        // Keep track if modal was opened from a click, or called by another function
        var externalCall = false;

        // don't open an opened modal
        if (this.modalIsOpen) {
            return;
        }

        // Prevent following href if link is clicked
        if (evt) {
            evt.preventDefault();
        } else {
            externalCall = true;
        }

        // Without this, the modal opens, the click event bubbles up to $nodes.page
        // which closes the modal.
        if (evt && evt.stopPropagation) {
            evt.stopPropagation();
            // save the source of the click, we'll focus to this on close
            this.$activeSource = $(evt.currentTarget);
        }

        if (this.modalIsOpen && !externalCall) {
            return this.close();
        }

        this.$modal.prepareTransition().addClass(this.config.openClass);
        this.nodes.$body.addClass(this.config.openClass);

        this.modalIsOpen = true;

        // Set focus on modal
        slate.a11y.trapFocus({
            $container: this.$modal,
            namespace: 'modal_focus',
            $elementToFocus: this.$focusOnOpen
        });

        if (this.$activeSource && this.$activeSource.attr('aria-expanded')) {
            this.$activeSource.attr('aria-expanded', 'true');
        }

        this.bindEvents();
    };

    Modal.prototype.close = function() {
        // don't close a closed modal
        if (!this.modalIsOpen) {
            return;
        }

        // deselect any focused form elements
        $(document.activeElement).trigger('blur');

        this.$modal.prepareTransition().removeClass(this.config.openClass);
        this.nodes.$body.removeClass(this.config.openClass);

        this.modalIsOpen = false;

        // Remove focus on modal
        slate.a11y.removeTrapFocus({
            $container: this.$modal,
            namespace: 'modal_focus'
        });

        if (this.$activeSource && this.$activeSource.attr('aria-expanded')) {
            this.$activeSource.attr('aria-expanded', 'false').focus();
        }

        this.unbindEvents();
    };

    Modal.prototype.bindEvents = function() {
        // Pressing escape closes modal
        this.nodes.$body.on(
            'keyup.modal',
            $.proxy(function(evt) {
                if (evt.keyCode === 27) {
                    this.close();
                }
            }, this)
        );
    };

    Modal.prototype.unbindEvents = function() {
        this.nodes.$body.off('.modal');
    };

    return Modal;
})();

window.QtySelector = (function() {
    var QtySelector = function($el) {
        this.cache = {
            $body: $('body'),
            $subtotal: $('#CartSubtotal'),
            $discountTotal: $('#cartDiscountTotal'),
            $cartTable: $('.cart-table'),
            $cartTemplate: $('#CartProducts')
        };

        this.settings = {
            loadingClass: 'js-qty--is-loading',
            isCartTemplate: this.cache.$body.hasClass('template-cart'),
            // On the cart template, minimum is 0. Elsewhere min is 1
            minQty: this.cache.$body.hasClass('template-cart') ? 0 : 1
        };

        this.$el = $el;
        this.qtyUpdateTimeout;
        this.createInputs();
        this.bindEvents();
    };

    QtySelector.prototype.createInputs = function() {
        var $el = this.$el;

        var data = {
            value: $el.val(),
            key: $el.attr('id'),
            name: $el.attr('name'),
            line: $el.attr('data-line')
        };
        var source = $('#QuantityTemplate').html();
        var template = Handlebars.compile(source);

        this.$wrapper = $(template(data)).insertBefore($el);

        // Remove original number input
        $el.remove();
    };

    QtySelector.prototype.validateAvailability = function(line, quantity) {
        var product = theme.cartObject.items[line - 1]; // 0-based index in API
        var handle = product.handle; // needed for the ajax request
        var id = product.id; // needed to find right variant from ajax results

        var params = {
            type: 'GET',
            url: '/products/' + handle + '.js',
            dataType: 'json',
            success: $.proxy(function(cartProduct) {
                this.validateAvailabilityCallback(line, quantity, id, cartProduct);
            }, this)
        };

        $.ajax(params);
    };

    QtySelector.prototype.validateAvailabilityCallback = function(
        line,
        quantity,
        id,
        product
    ) {
        var quantityIsAvailable = true;

        // This returns all variants of a product.
        // Loop through them to get our desired one.
        for (var i = 0; i < product.variants.length; i++) {
            var variant = product.variants[i];
            if (variant.id === id) {
                break;
            }
        }

        // If the variant tracks inventory and does not sell when sold out
        // we can compare the requested with available quantity
        if (
            variant.inventory_management !== null &&
            variant.inventory_policy === 'deny'
        ) {
            if (variant.inventory_quantity < quantity) {

                // Set quantity to max amount available
                this.$wrapper.find('.js-qty__input').val(variant.inventory_quantity);

                quantityIsAvailable = false;
                this.$wrapper.removeClass(this.settings.loadingClass);
            }
        }

        if (quantityIsAvailable) {
            this.updateItemQuantity(line, quantity);
        }
    };

    QtySelector.prototype.validateQty = function(qty) {
        if (parseFloat(qty) === parseInt(qty, 10) && !isNaN(qty)) {
            // We have a valid number!
        } else {
            // Not a number. Default to 1.
            qty = 1;
        }
        return parseInt(qty, 10);
    };

    QtySelector.prototype.adjustQty = function(evt) {
        var $el = $(evt.currentTarget);
        var $input = $el.siblings('.js-qty__input');
        var qty = this.validateQty($input.val());
        var line = $input.attr('data-line');

        if ($el.hasClass('js-qty__adjust--minus')) {
            qty -= 1;
            if (qty <= this.settings.minQty) {
                qty = this.settings.minQty;
            }
        } else {
            qty += 1;
        }

        if (this.settings.isCartTemplate) {
            $el.parent().addClass(this.settings.loadingClass);
            this.updateCartItemPrice(line, qty);
        } else {
            $input.val(qty);
        }
    };

    QtySelector.prototype.bindEvents = function() {
        this.$wrapper
            .find('.js-qty__adjust')
            .on('click', $.proxy(this.adjustQty, this));

        // Select input text on click
        this.$wrapper.on('click', '.js-qty__input', function() {
            this.setSelectionRange(0, this.value.length);
        });

        // If the quantity changes on the cart template, update the price
        if (this.settings.isCartTemplate) {
            this.$wrapper.on(
                'change',
                '.js-qty__input',
                $.proxy(function(evt) {
                    var $input = $(evt.currentTarget);
                    var line = $input.attr('data-line');
                    var qty = this.validateQty($input.val());
                    $input.parent().addClass(this.settings.loadingClass);
                    this.updateCartItemPrice(line, qty);
                }, this)
            );
        }
    };

    QtySelector.prototype.updateCartItemPrice = function(line, qty) {
        // Update cart after short timeout so user doesn't create simultaneous ajax calls
        clearTimeout(this.qtyUpdateTimeout);
        this.qtyUpdateTimeout = setTimeout(
            $.proxy(function() {
                this.validateAvailability(line, qty);
            }, this),
            200
        );
    };

    QtySelector.prototype.updateItemQuantity = function(line, quantity) {
        var params = {
            type: 'POST',
            url: '/cart/change.js',
            data: 'quantity=' + quantity + '&line=' + line,
            dataType: 'json',
            success: $.proxy(function(cart) {
                this.updateCartItemCallback(cart);
            }, this)
        };

        $.ajax(params);
    };

    QtySelector.prototype.updateCartItemCallback = function(cart) {
        // Reload the page to show the empty cart if no items
        if (cart.item_count === 0) {
            location.reload();
            return;
        }

        // Update cart object
        theme.cartObject = cart;

        // Handlebars.js cart layout
        var data = {};
        var items = [];
        var item = {};
        var source = $('#CartProductTemplate').html();
        var template = Handlebars.compile(source);
        var prodImg;

        // Add each item to our handlebars.js data
        $.each(cart.items, function(index, cartItem) {
            /* Hack to get product image thumbnail
             *   - If image is not null
             *     - Remove file extension, add 240x240, and re-add extension
             *     - Create server relative link
             *   - A hard-coded url of no-image
             */

            if (cartItem.image === null) {
                prodImg =
                    '//cdn.shopify.com/s/assets/admin/no-image-medium-cc9732cb976dd349a0df1d39816fbcc7.gif';
            } else {
                prodImg = cartItem.image
                    .replace(/(\.[^.]*)$/, '_240x240$1')
                    .replace('http:', '');
            }

            if (cartItem.properties !== null) {
                $.each(cartItem.properties, function(key, value) {
                    if (key.charAt(0) === '_' || !value) {
                        delete cartItem.properties[key];
                    }
                });
            }

            // Create item's data object and add to 'items' array
            item = {
                key: cartItem.key,
                line: index + 1, // Shopify uses a 1+ index in the API
                url: cartItem.url,
                img: prodImg,
                name: cartItem.product_title,
                variation: cartItem.variant_title,
                properties: cartItem.properties,
                itemQty: cartItem.quantity,
                price: theme.Currency.formatMoney(cartItem.price, theme.moneyFormat),
                vendor: cartItem.vendor,
                linePrice: theme.Currency.formatMoney(
                    cartItem.line_price,
                    theme.moneyFormat
                ),
                originalLinePrice: theme.Currency.formatMoney(
                    cartItem.original_line_price,
                    theme.moneyFormat
                ),
                discounts: cartItem.discounts,
                discountsApplied: cartItem.line_price === cartItem.original_line_price ? false : true
            };

            items.push(item);
            theme.updateCurrencies();
        });

        // Gather all cart data and add to DOM
        data = {
            items: items
        };
        this.cache.$cartTemplate.empty().append(template(data));

        // Create new quantity selectors
        this.cache.$cartTable.find('input[type="number"]').each(function(i, el) {
            new QtySelector($(el));
        });

        // Update the cart subtotal
        this.cache.$subtotal.html(
            theme.Currency.formatMoney(cart.total_price, theme.moneyFormat)
        );

        // Update the cart total discounts
        if (cart.total_discount > 0) {
            this.cache.$discountTotal.html(
                theme.strings.totalCartDiscount.replace(
                    '[savings]',
                    theme.Currency.formatMoney(cart.total_discount, theme.moneyFormat)
                )
            );
        } else {
            this.cache.$discountTotal.empty();
        }

        theme.miniCart.updateElements();
        theme.updateCurrencies();
        // Set focus on cart table
        slate.a11y.pageLinkFocus(this.cache.$cartTable);
    };

    return QtySelector;
})();

/*
  Allow product to be added to cart via ajax with
  custom success and error responses.
*/
window.AjaxCart = (function() {
    var styleCart = $('.js-mini-cart').attr("data-cartmini");
    var cart = function($form) {
        this.cache = {
            $cartIconIndicator: $('.site-header__cart-indicator')
        };

        this.$form = $form;
        this.eventListeners();

        this.showNotice = false;
        if (this.$form.length) {
            this.showNotice = this.$form.hasClass('js-form--notice') ? true : false;
        }
    };

    cart.prototype.eventListeners = function() {
        if (this.$form.length) {
            this.$form.on('submit', $.proxy(this.addItemFromForm, this));
        }
    };

    cart.prototype.addItemFromForm = function(evt) {
        evt.preventDefault();

        var params = {
            type: 'POST',
            url: '/cart/add.js',
            data: this.$form.serialize(),
            dataType: 'json',
            success: $.proxy(function(lineItem) {
                //this.success(lineItem);
                window.location.href = '/cart';
            }, this),
            error: $.proxy(function(XMLHttpRequest, textStatus) {
                this.error(XMLHttpRequest, textStatus);
            }, this)
        };
        $.ajax(params);
    };

    cart.prototype.success = function(item) {
        theme.miniCart.updateElements();
        theme.miniCart.generateCart();
        if (styleCart != 'false') {
            if (this.showNotice) {
                var htmlVariant = item.variant_title !== null ? '<i>(' + item.variant_title + ')</i>' : '';
                var htmlAlert = '<div class="media mt-2 alert--cart"><a class="mr-3" href="/cart"><img class="lazyload" data-src="' + item.image + '"></a><div class="media-body align-self-center"><p class="m-0 font-weight-bold">' + item.product_title + ' x ' + item.quantity + '</p>' + htmlVariant + '<div><div>';
                theme.alert.new(theme.strings.addToCartSuccess, htmlAlert, 3000, 'notice');
            } else {
                theme.crosssell.showPopup(item);
            }
        }
    };

    // Error handling reference from Shopify.onError in api.jquery.js
    cart.prototype.error = function(XMLHttpRequest) {
        var data = JSON.parse(XMLHttpRequest.responseText);

        if (data.message) {
            theme.alert.new('', data.description, 3000, 'warning');
        }
    };

    return cart;
})();

/*================ TEMPLATES ================*/
theme.customerTemplates = (function() {
    function initEventListeners() {
        // Show reset password form
        $('#RecoverPassword').on('click', function(evt) {
            evt.preventDefault();
            toggleRecoverPasswordForm();
        });

        // Hide reset password form
        $('#HideRecoverPasswordLink').on('click', function(evt) {
            evt.preventDefault();
            toggleRecoverPasswordForm();
        });
    }

    /**
     *
     *  Show/Hide recover password form
     *
     */
    function toggleRecoverPasswordForm() {
        $('#RecoverPasswordForm').toggleClass('hide');
        $('#CustomerLoginForm').toggleClass('hide');
    }

    /**
     *
     *  Show reset password success message
     *
     */
    function resetPasswordSuccess() {
        // check if reset password form was successfully submited
        if (!$('.reset-password-success').length) {
            return;
        }

        // show success message
        $('#ResetSuccess').removeClass('hide');
    }

    /**
     *
     *  Show/hide customer address forms
     *
     */
    function customerAddressForm() {
        var $newAddressForm = $('#AddressNewForm');

        if (!$newAddressForm.length) {
            return;
        }

        // Initialize observers on address selectors, defined in shopify_common.js
        if (Shopify) {
            // eslint-disable-next-line no-new
            new Shopify.CountryProvinceSelector(
                'AddressCountryNew',
                'AddressProvinceNew', {
                    hideElement: 'AddressProvinceContainerNew'
                }
            );
        }

        // Initialize each edit form's country/province selector
        $('.address-country-option').each(function() {
            var formId = $(this).data('form-id');
            var countrySelector = 'AddressCountry_' + formId;
            var provinceSelector = 'AddressProvince_' + formId;
            var containerSelector = 'AddressProvinceContainer_' + formId;

            // eslint-disable-next-line no-new
            new Shopify.CountryProvinceSelector(countrySelector, provinceSelector, {
                hideElement: containerSelector
            });
        });

        // Toggle new/edit address forms
        $('.address-new-toggle').on('click', function() {
            $newAddressForm.toggleClass('hide');
        });

        $('.address-edit-toggle').on('click', function() {
            var formId = $(this).data('form-id');
            $('#EditAddress_' + formId).toggleClass('hide');
        });

        $('.address-delete').on('click', function() {
            var $el = $(this);
            var formId = $el.data('form-id');
            var confirmMessage = $el.data('confirm-message');

            // eslint-disable-next-line no-alert
            if (
                confirm(
                    confirmMessage || 'Are you sure you wish to delete this address?'
                )
            ) {
                Shopify.postLink('/account/addresses/' + formId, {
                    parameters: { _method: 'delete' }
                });
            }
        });
    }

    /**
     *
     *  Check URL for reset password hash
     *
     */
    function checkUrlHash() {
        var hash = window.location.hash;

        // Allow deep linking to recover password form
        if (hash === '#recover') {
            toggleRecoverPasswordForm();
        }
    }

    return {
        init: function() {
            checkUrlHash();
            initEventListeners();
            resetPasswordSuccess();
            customerAddressForm();
        }
    };
})();

/*================ SECTIONS ================*/
theme.HeaderSection = (function() {
    function Header() {
        theme.NavDrawer = new window.Drawers('NavDrawer', 'left');
    }

    return Header;
})();

theme.Product = (function() {
    var defaults = {
        smallBreakpoint: 750,
        productThumbIndex: 0,
        productThumbMax: 0,
        ajaxCart: false,
        stockSetting: false
    };

    function Product(container) {
        var $container = (this.$container = $(container));
        var sectionId = $container.attr('data-section-id');

        this.selectors = {
            originalSelectorId: '#ProductSelect-' + sectionId,
            modal: 'ProductModal',
            productZoomImage: '#ProductZoomImg',
            addToCart: '#AddToCart-' + sectionId,
            productPrice: '#ProductPrice-' + sectionId,
            comparePrice: '#ComparePrice-' + sectionId,
            addToCartText: '#AddToCartText-' + sectionId,
            SKU: '.js-variant-sku',
            productImageContainers: '.product__photo-container-' + sectionId,
            productImageWrappers: '.product__photo-wrapper-' + sectionId,
            productThumbContainers: '.product-single__thumbnail-item-' + sectionId,
            productThumbsWrapper: '.product-single__thumbnails-' + sectionId,
            productThumbs: '.product-single__thumbnail-' + sectionId,
            saleTag: '#ProductSaleTag-' + sectionId,
            productStock: '#ProductStock-' + sectionId,
            singleOptionSelector: '.single-option-selector-' + sectionId,
            shopifyPaymentButton: '.shopify-payment-button',
            availability: '.product-single__availability',
            hurrify: '.js-hurrify'
        };

        this.settings = $.extend({}, defaults, {
            sectionId: sectionId,
            ajaxCart: $container.data('ajax'),
            stockSetting: $container.data('stock'),
            enableHistoryState: $container.data('enable-history-state') || false,
            namespace: '.product-' + sectionId
        });

        // Stop parsing if we don't have the product json script tag
        if (!$('#ProductJson-' + sectionId).html()) {
            return;
        }

        this.productSingleObject = JSON.parse(
            $('#ProductJson-' + sectionId).html()
        );
        this.addVariantInfo();

        this.init();
    }

    Product.prototype = _.assignIn({}, Product.prototype, {
        init: function() {
            this._stringOverrides();
            this._initVariants();
            this._productZoomImage();
            this._productThumbSwitch();
            this._productThumbnailSlider();
            this._initQtySelector();

            if (this.settings.ajaxCart) {
                theme.AjaxCart = new window.AjaxCart(
                    $('#AddToCartForm-' + this.settings.sectionId)
                );
            }
        },

        _stringOverrides: function() {
            window.productStrings = window.productStrings || {};
            $.extend(theme.strings, window.productStrings);
        },

        addVariantInfo: function() {
            if (!this.productSingleObject || !this.settings.stockSetting) {
                return;
            }

            var variantInfo = JSON.parse(
                $('#VariantJson-' + this.settings.sectionId).html()
            );

            for (var i = 0; i < variantInfo.length; i++) {
                $.extend(this.productSingleObject.variants[i], variantInfo[i]);
            }
        },

        _initVariants: function() {
            var options = {
                $container: this.$container,
                enableHistoryState: this.settings.enableHistoryState,
                product: this.productSingleObject,
                singleOptionSelector: this.selectors.singleOptionSelector,
                originalSelectorId: this.selectors.originalSelectorId
            };

            // eslint-disable-next-line no-new
            this.variants = new slate.Variants(options);

            this.$container.on(
                'variantChange' + this.settings.namespace,
                this._updateAddToCartBtn.bind(this)
            );
            this.$container.on(
                'variantChange' + this.settings.namespace,
                this._updateStickyCart.bind(this)
            );
            this.$container.on(
                'variantPriceChange' + this.settings.namespace,
                this._updatePrice.bind(this)
            );
            this.$container.on(
                'variantSKUChange' + this.settings.namespace,
                this._updateSKU.bind(this)
            );
            this.$container.on(
                'variantImageChange' + this.settings.namespace,
                this._updateImages.bind(this)
            );
        },

        _updateStock: function(variant) {
            if (!this.settings.stockSetting) return;

            var $stock = $(this.selectors.productStock),
                $hurrify = $(this.selectors.hurrify);

            // If we don't track variant inventory, hide stock
            if (!variant || !variant.inventory_management) {
                $stock.addClass('hide');
                $hurrify.addClass('hide');
                return;
            }

            if (variant.inventory_quantity < 10 && variant.inventory_quantity > 0) {
                $stock
                    .html(
                        theme.strings.stockAvailable.replace(
                            '1',
                            variant.inventory_quantity
                        )
                    )
                    .removeClass('hide');
                $hurrify.removeClass('hide').find('.progress-bar').css('width', variant.inventory_quantity * 10 + '%');
                return;
            }

            if (variant.inventory_quantity <= 0 && variant.incoming) {
                $stock
                    .html(
                        theme.strings.willNotShipUntil.replace(
                            '[date]',
                            variant.next_incoming_date
                        )
                    )
                    .removeClass('hide');
                $hurrify.addClass('hide');
                return;
            }

            // If there's more than 10 available, hide stock
            $stock.addClass('hide');
            $hurrify.addClass('hide');
        },

        _updateIncomingInfo: function(variant) {
            if (!this.settings.stockSetting) return;

            var $stock = $(this.selectors.productStock);

            if (variant.incoming) {
                $stock
                    .html(
                        theme.strings.willBeInStockAfter.replace(
                            '[date]',
                            variant.next_incoming_date
                        )
                    )
                    .removeClass('hide');
                return;
            }

            // If there is no stock incoming, hide stock
            $stock.addClass('hide');
        },

        _updateAddToCartBtn: function(evt) {
            var variant = evt.variant;

            var cache = {
                $addToCart: $(this.selectors.addToCart),
                $addToCartText: $(this.selectors.addToCartText)
            };

            if (variant) {
                // Select a valid variant if available
                theme.noticeSoldout.init(variant);
                if (variant.available) {
                    // We have a valid product variant, so enable the submit button
                    cache.$addToCart.removeClass('btn--sold-out').prop('disabled', false);
                    cache.$addToCartText.html(theme.strings.addToCart);
                    $(this.selectors.shopifyPaymentButton, this.$container).show();
                    // Show how many items are left, if below 10
                    this._updateStock(variant);
                    //update availability - available
                    $(this.selectors.availability).find('span').text(theme.strings.available);
                } else {
                    // Variant is sold out, disable the submit button
                    cache.$addToCart.prop('disabled', true).addClass('btn--sold-out');
                    cache.$addToCartText.html(theme.strings.soldOut);
                    $(this.selectors.shopifyPaymentButton, this.$container).hide();
                    // Update when stock will be available
                    this._updateIncomingInfo(variant);
                    //update availability - soldout
                    $(this.selectors.availability).find('span').text(theme.strings.soldOut);
                }
            } else {
                cache.$addToCart.prop('disabled', true).removeClass('btn--sold-out');
                cache.$addToCartText.html(theme.strings.unavailable);
                //update availability - unavailable
                $(this.selectors.availability).find('span').text(theme.strings.unavailable);
                $(this.selectors.shopifyPaymentButton, this.$container).hide();
                // Hide stock display
                this._updateStock();
            }
        },

        _updatePrice: function(evt) {
            var variant = evt.variant;

            if (variant) {
                $(this.selectors.productPrice).html(
                    theme.Currency.formatMoney(variant.price, theme.moneyFormat)
                );

                // Update and show the product's compare price if necessary
                if (variant.compare_at_price > variant.price) {
                    $(this.selectors.comparePrice)
                        .html(
                            theme.Currency.formatMoney(
                                variant.compare_at_price,
                                theme.moneyFormat
                            )
                        )
                        .removeClass('hide');
                    $(this.selectors.saleTag).removeClass('hide');
                } else {
                    $(this.selectors.comparePrice).addClass('hide');
                    $(this.selectors.saleTag).addClass('hide');
                }

                theme.updateCurrencies();
            } else {
                $(this.selectors.comparePrice).addClass('hide');
            }
        },

        _updateSKU: function(evt) {
            var variant = evt.variant;

            if (variant) {
                $(this.selectors.SKU).html(variant.sku);
            }
        },

        _updateImages: function(evt) {
            var variant = evt.variant;

            if (variant && variant.featured_image) {
                var imageId = variant.featured_image.id;
                this.switchProductImage(imageId);
                this.setActiveThumbnail(imageId);
            }
        },
        _updateStickyCart: function(evt) {
            var variant = evt.variant,
                $stickyPrice = $('#js-sticky-price'),
                $stickyTitle = $('#js-sticky-title'),
                $stickyImage = $('#js-sticky-img'),
                $stickyButton = $('#js-sticky-btn');
            if (variant) {
                //update title
                $stickyTitle.html(' - ' + variant.title);
                //update price
                $stickyPrice.html(theme.Currency.formatMoney(variant.price, theme.moneyFormat));
                //update selectbox
                for (var i = 1; i <= 3; i++) {
                    var option = 'option' + i,
                        $selecBox = '#js-sticky-option-' + i;
                    if (variant[option] !== null) {
                        var valueOption = variant[option];
                        $($selecBox).val(valueOption);
                    }
                }
                //update button cart
                if (variant.available) {
                    $stickyButton.prop('disabled', false).removeClass('btn--sold-out');
                    $stickyButton.html(theme.strings.addToCart);
                } else {
                    $stickyButton.prop('disabled', true).addClass('btn--sold-out');
                    $stickyButton.html(theme.strings.soldOut);
                }
                //update image
                if (variant.featured_image) {
                    $stickyImage.attr('src', theme.Images.getSizedImageUrl(variant.featured_image.src, '200x'));
                }
            } else {
                //update title
                $stickyTitle.html(' - ' + theme.strings.unavailable);
                //update button cart
                $stickyButton.prop('disabled', true).removeClass('btn--sold-out');
                $stickyButton.html(theme.strings.unavailable);
            }
        },

        switchProductImage: function(imageId) {
            var $imageToShow = $(
                this.selectors.productImageContainers +
                "[data-image-id='" +
                imageId +
                "']",
                this.$container
            );
            var $imagesToHide = $(
                this.selectors.productImageContainers +
                ":not([data-image-id='" +
                imageId +
                "'])",
                this.$container
            );
            $imagesToHide.addClass('hide');
            $imageToShow.removeClass('hide');
            //Scroll to active
            topMenuHeight = $('.site-header').outerHeight();
            if (this.settings.sectionId === 'product-template-8') {
                $([document.documentElement, document.body]).animate({
                    scrollTop: $imageToShow.offset().top - topMenuHeight
                }, 500);
            }
        },

        setActiveThumbnail: function(imageId) {
            var $thumbnailToShow = $(
                this.selectors.productThumbContainers +
                "[data-image-id='" +
                imageId +
                "']",
                this.$container
            );
            var $thumbnailsToHide = $(
                this.selectors.productThumbContainers +
                ":not([data-image-id='" +
                imageId +
                "'])",
                this.$container
            );
            $thumbnailsToHide.removeClass('is-active');
            $thumbnailToShow.addClass('is-active');
            $thumbnailToShow.trigger('click');
            var $thumbnails = $(this.selectors.productThumbsWrapper, this.$container);

            // If there is a slick carousel, get the slide index, and position it into view with animation.
            if ($thumbnails.hasClass('slick-initialized')) {
                // eslint-disable-next-line shopify/jquery-dollar-sign-reference
                var currentActiveSlideIndex = $thumbnails.slick('slickCurrentSlide');
                var newActiveSlideIndex = parseInt(
                    $thumbnailToShow.attr('data-slick-index')
                );
                if (currentActiveSlideIndex !== newActiveSlideIndex) {
                    $thumbnails.slick('slickGoTo', newActiveSlideIndex, false);

                }
            }
        },

        _productZoomImage: function() {
            // The zoom image is only used on the product template, so return early
            // even if a featured product section is present.
            if (!$('.product-single ' + this.selectors.productImageContainers).length) {
                return;
            }

            var self = this;

            $(this.selectors.productImageWrappers).on(
                'click' + this.settings.namespace,
                function(evt) {
                    evt.preventDefault();
                    // Empty src before loadig new image to avoid awkward image swap
                    $(self.selectors.productZoomImage)
                        .attr('src', '')
                        .attr('src', $(this).attr('href'));
                }
            );

            this.ProductModal = new window.Modals(
                this.selectors.modal,
                'product-modal'
            );

            // Close modal if clicked, but not if the image is clicked
            this.ProductModal.$modal.on('click' + this.settings.namespace, function(
                evt
            ) {
                if (evt.target.nodeName !== 'IMG') {
                    self.ProductModal.close();
                }
            });
        },

        _productThumbSwitch: function() {
            if (!$(this.selectors.productThumbs).length) {
                return;
            }

            var self = this;

            $(this.selectors.productThumbs).on(
                'click' + this.settings.namespace,
                function(evt) {
                    evt.preventDefault();
                    var imageId = $(this)
                        .parent()
                        .data('image-id');
                    self.setActiveThumbnail(imageId);
                    self.switchProductImage(imageId);
                }
            );
            //trigger hover thumb
            // $(this.selectors.productThumbs).on('click',function(){
            //   $(this).trigger('click');
            // });
        },

        /*
          Thumbnail slider
         */
        _productThumbnailSlider: function() {
            var $productThumbsWrapper = $(this.selectors.productThumbsWrapper);
            var $productThumbs = $(this.selectors.productThumbs);
            if (!$productThumbs.length) {
                return;
            }

            if ($productThumbs.length > 1) {
                $productThumbsWrapper.on(
                    'init' + this.settings.namespace,
                    this._productSwipeInit.bind(this)
                );

                if (this.settings.sectionId === 'product-template-3' || this.settings.sectionId === 'product-template-4') {
                    $productThumbsWrapper.slick({
                        accessibility: false,
                        arrows: true,
                        dots: false,
                        infinite: false,
                        autoplay: false,
                        slidesToShow: 5,
                        slidesToScroll: 5,
                        vertical: true,
                        verticalSwiping: true,
                        responsive: [{
                            breakpoint: 992,
                            settings: {
                                vertical: false,
                                verticalSwiping: false,
                                slidesToShow: 4,
                                slidesToScroll: 4,
                                dots: false,
                            }
                        }]
                    }).css('opacity', '1');
                } else if (this.settings.sectionId === 'product-template-5') {
                    $productThumbsWrapper.slick({
                        accessibility: false,
                        arrows: true,
                        dots: false,
                        infinite: true,
                        autoplay: false,
                        slidesToShow: 2,
                        slidesToScroll: 1,
                        responsive: [{
                            breakpoint: 992,
                            settings: {
                                slidesToShow: 4,
                                slidesToScroll: 4,
                                dots: false,
                            }
                        }]
                    }).css('opacity', '1');
                } else if (this.settings.sectionId === 'product-template-7') {
                    $productThumbsWrapper.slick({
                        accessibility: false,
                        arrows: true,
                        dots: true,
                        infinite: true,
                        autoplay: false,
                        slidesToShow: 1,
                        slidesToScroll: 1,
                        responsive: [{
                            breakpoint: 992,
                            settings: {
                                slidesToShow: 1,
                                slidesToScroll: 1,
                                dots: false,
                                arrows: true,
                            }
                        }]
                    }).css('opacity', '1');
                } else if (this.settings.sectionId === 'product-template-8') {
                    var lastId,
                        topMenu = $(".product-single__thumbnails"),
                        topMenuHeight = $('.site-header').outerHeight() + 20,
                        // All list items
                        menuItems = topMenu.find(".product-single__thumbnail");


                    if ($(window).width() > 767) {
                        menuItems.click(function(e) {
                            var findid = $(this).attr('href');
                            offsetTop = $(findid).offset().top - topMenuHeight + 1;
                            $('html, body').stop().animate({
                                scrollTop: offsetTop
                            }, 200);
                            return false;
                        });
                        // Anchors corresponding to menu items
                        scrollItems = menuItems.map(function() {
                            var item = $($(this).attr('href'));
                            if (item.length) { return item; }
                        });

                        $(window).scroll(function() {
                            // Get container scroll position
                            var fromTop = $(this).scrollTop() + topMenuHeight;
                            // Get id of current scroll item
                            var cur = scrollItems.map(function() {
                                if ($(this).offset().top < fromTop)
                                    return this;
                            });
                            // Get the id of the current element
                            cur = cur[cur.length - 1];
                            var id = cur && cur.length ? cur[0].id : "";

                            if (lastId !== id) {
                                lastId = id;
                                // Set/remove active class
                                menuItems
                                    .parent().removeClass("is-active")
                                    .end().filter("[href='#" + id + "']").parent().addClass("is-active");
                            }
                        });
                    } else {
                        menuItems.click(function(e) {
                            var findid = $(this).attr('href');
                            offsetTop = $(findid).offset().top;
                            $('html, body').stop().animate({
                                scrollTop: offsetTop
                            });
                            return false;
                        });
                    }

                    $productThumbsWrapper.slick({
                        accessibility: false,
                        arrows: true,
                        dots: false,
                        infinite: false,
                        autoplay: false,
                        slidesToShow: 5,
                        slidesToScroll: 1,
                        vertical: true,
                        verticalSwiping: true,
                        responsive: [{
                            breakpoint: 992,
                            settings: {
                                vertical: false,
                                verticalSwiping: false,
                                slidesToShow: 4,
                                slidesToScroll: 4,
                                dots: true,
                            }
                        }]
                    }).css('opacity', '1');
                } else {
                    $productThumbsWrapper.slick({
                        accessibility: false,
                        arrows: true,
                        dots: false,
                        infinite: false,
                        autoplay: false,
                        slidesToShow: 4,
                        slidesToScroll: 4
                    }).css('opacity', '1');
                }

                // Show highlighted thumbnail by repositioning slider
                $productThumbsWrapper.slick(
                    'slickGoTo',
                    $productThumbsWrapper.find('.is-active').attr('data-slick-index'),
                    true
                );
            }
        },

        _productSwipeInit: function(evt, obj) {
            // Slider is initialized. Setup custom swipe events
            this.settings.productThumbIndex = obj.currentSlide;
            this.settings.productThumbMax = obj.slideCount - 1; // we need the 0-based index

            var self = this;

            $(this.selectors.productImageWrappers).on(
                'swipeleft swiperight',
                function(event) {
                    if (event.type === 'swipeleft') {
                        self._goToNextThumbnail();
                    }

                    if (event.type === 'swiperight') {
                        self._goToPrevThumbnail();
                    }

                    // Trigger click on newly requested thumbnail
                    $(
                            '.product-single__thumbnail-item[data-slick-index="' +
                            self.settings.productThumbIndex +
                            '"]'
                        )
                        .find('.product-single__thumbnail')
                        .trigger('click');

                }
            );
        },
        _goToNextThumbnail: function() {
            this.settings.productThumbIndex++;

            if (this.settings.productThumbIndex > this.settings.productThumbMax) {
                this.settings.productThumbIndex = 0;
            }

            $(this.selectors.productThumbsWrapper).slick(
                'slickGoTo',
                this.settings.productThumbIndex,
                true
            );
        },

        _goToPrevThumbnail: function() {
            this.settings.productThumbIndex--;

            if (this.settings.productThumbIndex < 0) {
                this.settings.productThumbIndex = this.settings.productThumbMax;
            }

            $(this.selectors.productThumbsWrapper).slick(
                'slickGoTo',
                this.settings.productThumbIndex,
                true
            );
        },

        _initQtySelector: function() {
            this.$container.find('.product-form__quantity').each(function(i, el) {
                // eslint-disable-next-line no-new
                new QtySelector($(el));
            });
        },

        onUnload: function() {
            $(this.selectors.productImageWrappers).off(this.settings.namespace);
            $(this.selectors.productThumbs).off(this.settings.namespace);
            $(this.selectors.productThumbs).slick('unslick');
            if (this.ProductModal) {
                this.ProductModal.$modal.off(this.settings.namespace);
            }
        }
    });

    return Product;
})();

theme.Slideshow = (function() {
    this.$slideshow = null;
    var classes = {
        slideshow: 'slideshow',
        slickActiveMobile: 'slick-active-mobile',
        controlsHover: 'slideshow__controls--hover',
        isPaused: 'is-paused'
    };

    var selectors = {
        section: '.shopify-section',
        wrapper: '#SlideshowWrapper-',
        slides: '.slideshow__slide',
        textWrapperMobile: '.slideshow__text-wrap--mobile',
        textContentMobile: '.slideshow__text-content--mobile',
        controls: '.slideshow__controls',
        dots: '.slick-dots',
        arrowLeft: '.slideshow__arrow-left',
        arrowRight: '.slideshow__arrow-right'
    };

    function slideshow(el, sectionId) {
        var $slideshow = (this.$slideshow = $(el));
        this.adaptHeight = this.$slideshow.data('adapt-height');
        this.$wrapper = this.$slideshow.closest(selectors.wrapper + sectionId);
        this.$section = this.$wrapper.closest(selectors.section);
        this.$controls = this.$wrapper.find(selectors.controls);
        this.$textWrapperMobile = this.$section.find(selectors.textWrapperMobile);
        this.autorotate = this.$slideshow.data('autorotate');
        var autoplaySpeed = this.$slideshow.data('speed');
        var loadSlideA11yString = this.$slideshow.data('slide-nav-a11y');

        this.settings = {
            rtl: theme.rtl,
            accessibility: true,
            arrows: true,
            dots: true,
            fade: (theme.rtl ? false : true),
            draggable: true,
            touchThreshold: 20,
            autoplay: this.autorotate,
            autoplaySpeed: autoplaySpeed
        };

        this.$slideshow.on('beforeChange', beforeChange.bind(this));
        this.$slideshow.on('init', slideshowA11ySetup.bind(this));

        // Add class to style mobile dots & show the correct text content for the
        // first slide on mobile when the slideshow initialises
        this.$slideshow.on(
            'init',
            function() {
                this.$mobileDots
                    .find('li:first-of-type')
                    .addClass(classes.slickActiveMobile);
                this.showMobileText(0);
            }.bind(this)
        );

        if (this.adaptHeight) {
            this.setSlideshowHeight();
            $(window).resize($.debounce(50, this.setSlideshowHeight.bind(this)));
        }

        this.$slideshow.slick(this.settings);

        // This can't be called when the slick 'init' event fires due to how slick
        // adds a11y features.
        slideshowPostInitA11ySetup.bind(this)();
    }

    function slideshowA11ySetup(event, obj) {
        var $slider = obj.$slider;
        var $list = obj.$list;
        this.$dots = this.$section.find(selectors.dots);
        this.$mobileDots = this.$dots.eq(1);

        // Remove default Slick aria-live attr until slider is focused
        $list.removeAttr('aria-live');

        //     this.$wrapper.on('keyup', keyboardNavigation.bind(this));
        //     this.$controls.on('keyup', keyboardNavigation.bind(this));
        //     this.$textWrapperMobile.on('keyup', keyboardNavigation.bind(this));

        // When an element in the slider is focused
        // pause slideshow and set aria-live.
        this.$wrapper
            .on(
                'focusin',
                function(evt) {
                    if (!this.$wrapper.has(evt.target).length) {
                        return;
                    }

                    $list.attr('aria-live', 'polite');
                    if (this.autorotate) {
                        $slider.slick('slickPause');
                    }
                }.bind(this)
            )
            .on(
                'focusout',
                function(evt) {
                    if (!this.$wrapper.has(evt.target).length) {
                        return;
                    }

                    $list.removeAttr('aria-live');
                }.bind(this)
            );

        // Add arrow key support when focused
        if (this.$dots) {
            this.$dots
                .find('a')
                .each(function() {
                    var $dot = $(this);
                    $dot.on('click keyup', function(evt) {
                        if (
                            evt.type === 'keyup' &&
                            evt.which !== slate.utils.keyboardKeys.ENTER
                        )
                            return;

                        evt.preventDefault();

                        var slideNumber = $(evt.target).data('slide-number');

                        $slider.attr('tabindex', -1).slick('slickGoTo', slideNumber);

                        if (evt.type === 'keyup') {
                            $slider.focus();
                        }
                    });
                })
                .eq(0)
                .attr('aria-current', 'true');
        }

        this.$controls
            .on('focusin', highlightControls.bind(this))
            .on('focusout', unhighlightControls.bind(this));
    }

    function slideshowPostInitA11ySetup() {
        var $slides = this.$slideshow.find(selectors.slides);

        $slides.removeAttr('role').removeAttr('aria-labelledby');
        this.$dots
            .removeAttr('role')
            .find('li')
            .removeAttr('role')
            .removeAttr('aria-selected')
            .each(function() {
                var $dot = $(this);
                var ariaControls = $dot.attr('aria-controls');
                $dot
                    .removeAttr('aria-controls')
                    .find('a')
                    .attr('aria-controls', ariaControls);
            });
    }

    function beforeChange(event, slick, currentSlide, nextSlide) {
        var $dotLinks = this.$dots.find('a');
        var $mobileDotLinks = this.$mobileDots.find('li');

        $dotLinks
            .removeAttr('aria-current')
            .eq(nextSlide)
            .attr('aria-current', 'true');

        $mobileDotLinks
            .removeClass(classes.slickActiveMobile)
            .eq(nextSlide)
            .addClass(classes.slickActiveMobile);
        this.showMobileText(nextSlide);
    }

    //   function keyboardNavigation() {
    //     if (event.keyCode === slate.utils.keyboardKeys.LEFTARROW) {
    //       this.$slideshow.slick('slickPrev');
    //     }
    //     if (event.keyCode === slate.utils.keyboardKeys.RIGHTARROW) {
    //       this.$slideshow.slick('slickNext');
    //     }
    //   }

    function highlightControls() {
        this.$controls.addClass(classes.controlsHover);
    }

    function unhighlightControls() {
        this.$controls.removeClass(classes.controlsHover);
    }

    slideshow.prototype.setSlideshowHeight = function() {
        var minAspectRatio = this.$slideshow.data('min-aspect-ratio');
        this.$slideshow.height($(document).width() / minAspectRatio);
    };

    slideshow.prototype.showMobileText = function(slideIndex) {
        var $allTextContent = this.$textWrapperMobile.find(
            selectors.textContentMobile
        );
        var currentTextContentSelector =
            selectors.textContentMobile + '-' + slideIndex;
        var $currentTextContent = this.$textWrapperMobile.find(
            currentTextContentSelector
        );
        if (!$currentTextContent.length &&
            this.$slideshow.find(selectors.slides).length === 1
        ) {
            this.$textWrapperMobile.hide();
        } else {
            this.$textWrapperMobile.show();
        }
        $allTextContent.hide();
        $currentTextContent.show();
    };

    function getSlideshowId($el) {
        return '#Slideshow-' + $el.data('id');
    }

    return slideshow;
})();

theme.slideshows = {};

theme.SlideshowSection = (function() {
    function SlideshowSection(container) {
        var $container = (this.$container = $(container));
        var sectionId = $container.attr('data-section-id');
        var slideshow = (this.slideshow = '#Slideshow-' + sectionId);

        theme.slideshows[slideshow] = new theme.Slideshow(slideshow, sectionId);
    }

    return SlideshowSection;
})();

theme.SlideshowSection.prototype = _.assignIn({},
    theme.SlideshowSection.prototype, {
        onUnload: function() {
            delete theme.slideshows[this.slideshow];
        },

        onBlockSelect: function(evt) {
            var $slideshow = $(this.slideshow);
            var adaptHeight = $slideshow.data('adapt-height');

            if (adaptHeight) {
                theme.slideshows[this.slideshow].setSlideshowHeight();
            }

            // Ignore the cloned version
            var $slide = $(
                '.slideshow__slide--' + evt.detail.blockId + ':not(.slick-cloned)'
            );
            var slideIndex = $slide.data('slick-index');

            // Go to selected slide, pause auto-rotate
            $slideshow.slick('slickGoTo', slideIndex).slick('slickPause');
        },

        onBlockDeselect: function() {
            // Resume auto-rotate
            $(this.slideshow).slick('slickPlay');
        }
    }
);

theme.slideshows = {};

theme.Cart = (function() {
    var selectors = {
        cartNote: '#CartSpecialInstructions',
        cartQtyInput: '.cart__quantity',
        cartNoCookiesClass: 'cart--no-cookies'
    };

    function Cart(container) {
        var $container = (this.$container = $(container));
        var sectionId = $container.attr('data-section-id');

        theme.cartObject = JSON.parse($('#CartJson-' + sectionId).html());

        this.init($container);
    }

    Cart.prototype = _.assignIn({}, Cart.prototype, {
        init: function($container) {
            this._initQtySelector();
            this._initCartNote();

            if (!this._cookiesEnabled()) {
                $container.addClass(selectors.cartNoCookiesClass);
            }
        },

        _initQtySelector: function() {
            $(selectors.cartQtyInput).each(function(i, el) {
                // eslint-disable-next-line no-new
                new QtySelector($(el));
            });
        },

        _initCartNote: function() {
            if (!$(selectors.cartNote).length) {
                return;
            }

            var $el = $(selectors.cartNote);
            var noteText;
            var params;
            var noteOffset = $el[0].offsetHeight - $el[0].clientHeight;

            // Auto grow the cart note if text fills it up
            $el.on('keyup input', function() {
                $(this)
                    .css('height', 'auto')
                    .css('height', $el[0].scrollHeight + noteOffset);
            });

            // Save the cart note via ajax. A safeguard in case
            // a user decides to leave the page before clicking 'Update Cart'
            $el.on(
                'change',
                $.proxy(function() {
                    noteText = $el.val();
                    params = {
                        type: 'POST',
                        url: '/cart/update.js',
                        data: 'note=' + this._attributeToString(noteText),
                        dataType: 'json'
                    };
                    $.ajax(params);
                }, this)
            );
        },

        _attributeToString: function(attr) {
            if (typeof attr !== 'string') {
                attr = String(attr);
                if (attr === 'undefined') {
                    attr = '';
                }
            }
            return $.trim(attr);
        },

        _cookiesEnabled: function() {
            var cookieEnabled = navigator.cookieEnabled;

            if (!cookieEnabled) {
                document.cookie = 'testcookie';
                cookieEnabled = document.cookie.indexOf('testcookie') !== -1;
            }
            return cookieEnabled;
        }
    });

    return Cart;
})();

// Instagrams
theme.Instagrams = (function() {
    function Instagrams(container) {
        this.$container = $(container).on('init', this._a11y.bind(this));
        //console.log(this.$container);
        this.settings = {
            style: this.$container.data('style'),
            accesstoken: this.$container.data('accesstoken'),
            userid: this.$container.data('userid'),
            limit: this.$container.data('limit'),
            resolution: this.$container.data('resolution'),
            target: this.$container.attr('id'),
            rows: this.$container.data('rows'),

            slidesToShow: this.$container.data('slidestoshow') || 1,
            infinite: this.$container.data('infinite') || false,
            arrows: this.$container.data('arrows') || false,
            draggable: this.$container.data('draggable') || false,
            dots: this.$container.data('dots') || false,
        }
        this.settings.slidesToShow1200 = (this.settings.slidesToShow - 1) > 1 ? (this.settings.slidesToShow - 1) : 1;
        this.settings.slidesToShow992 = (this.settings.slidesToShow - 2) > 1 ? (this.settings.slidesToShow - 2) : 1;
        this.settings.slidesToShow768 = (this.settings.slidesToShow - 3) > 1 ? (this.settings.slidesToShow - 3) : 1;
        this.settings.slidesToShow480 = 2;

        var _self = this;
        var $instagramSelector = $('#' + this.settings.target);
        if (this.settings.style === 'grid') {
            var afterInstagram = function() {} // blank function
        } else if (this.settings.style === 'carousel') {
            var afterInstagram = function() {
                $instagramSelector.slick({
                    slidesToShow: _self.settings.slidesToShow,
                    slidesToScroll: _self.settings.slidesToShow,
                    arrows: _self.settings.arrows,
                    dots: _self.settings.dots,
                    draggable: _self.settings.draggable,
                    infinite: _self.settings.infinite,
                    rows: _self.settings.rows,
                    responsive: [{
                            breakpoint: 1200,
                            settings: {
                                slidesToShow: _self.settings.slidesToShow1200,
                                slidesToScroll: _self.settings.slidesToShow1200,
                            }
                        },
                        {
                            breakpoint: 992,
                            settings: {
                                slidesToShow: _self.settings.slidesToShow992,
                                slidesToScroll: _self.settings.slidesToShow992,
                            }
                        },
                        {
                            breakpoint: 768,
                            settings: {
                                slidesToShow: _self.settings.slidesToShow768,
                                slidesToScroll: _self.settings.slidesToShow768,
                            }
                        },
                        {
                            breakpoint: 480,
                            settings: {
                                slidesToShow: _self.settings.slidesToShow480,
                                slidesToScroll: _self.settings.slidesToShow480,
                            }
                        }
                    ]
                })
            }
        }

        var feed = new Instafeed({
            get: 'user',
            target: this.settings.target,
            userId: this.settings.userid,
            accessToken: this.settings.accesstoken,
            limit: this.settings.limit,
            resolution: this.settings.resolution,
            template: '<div class="col hv-image-brightness"><a class="instagram-item" href="{{link}}" target="_blank" id="{{id}}"><img alt="instagram image" class="transition lazyload" data-src="{{image}}" /></a></div>',
            after: afterInstagram
        });

        feed.run();
    }

    Instagrams.prototype = _.assignIn({}, Instagrams.prototype, {
        _a11y: function(event, obj) {
            var $list = obj.$list;
            var $wrapper = this.$container.parent();

            // Remove default Slick aria-live attr until slider is focused
            $list.removeAttr('aria-live');

            // When an element in the slider is focused set aria-live
            $wrapper.on('focusin', function(evt) {
                if ($wrapper.has(evt.target).length) {
                    $list.attr('aria-live', 'polite');
                }
            });

            // Remove aria-live
            $wrapper.on('focusout', function(evt) {
                if ($wrapper.has(evt.target).length) {
                    $list.removeAttr('aria-live');
                }
            });
        }
    });

    return Instagrams;
})();

// Slick carousel
theme.slickCarousel = (function() {
    function Carousels(container) {
        this.$container = $(container).on('init', this._a11y.bind(this));
        this.settings = {
            rows: this.$container.data('rows') || 1,
            slidesToShow: this.$container.data('slidestoshow') || 1,
            slidesToScroll: this.$container.data('slidestoscroll') || 1,
            infinite: this.$container.data('infinite') || false,
            arrows: this.$container.data('arrows') || false,
            dots: this.$container.data('dots') || false,
            autoplay: this.$container.data('autoplay') || false,
            draggable: this.$container.data('draggable') || false,
            accessibility: this.$container.data('accessibility') || true,
        }
        this.settings.slidesToShow1200 = (this.settings.slidesToShow - 1) > 1 ? (this.settings.slidesToShow - 1) : 1;
        this.settings.slidesToShow992 = (this.settings.slidesToShow - 2) > 1 ? (this.settings.slidesToShow - 2) : 1;
        this.settings.slidesToShow768 = (this.settings.slidesToShow - 3) > 1 ? (this.settings.slidesToShow - 3) : 1;
        this.settings.slidesToShow480 = (this.settings.slidesToShow - 4) > 1 ? (this.settings.slidesToShow - 4) : 1;
        this.settings.slidesToScroll1200 = (this.settings.slidesToScroll - 1) > 1 ? (this.settings.slidesToScroll - 1) : 1;
        this.settings.slidesToScroll992 = (this.settings.slidesToScroll - 2) > 1 ? (this.settings.slidesToScroll - 2) : 1;
        this.settings.slidesToScroll768 = (this.settings.slidesToScroll - 3) > 1 ? (this.settings.slidesToScroll - 3) : 1;
        this.settings.slidesToScroll480 = (this.settings.slidesToScroll - 4) > 1 ? (this.settings.slidesToScroll - 4) : 1;
        this.$container.slick({
            rtl: theme.rtl,
            rows: this.settings.rows,
            slidesToShow: this.settings.slidesToShow,
            slidesToScroll: this.settings.slidesToScroll,
            arrows: this.settings.arrows,
            dots: this.settings.dots,
            autoplay: this.settings.autoplay,
            accessibility: this.settings.accessibility,
            draggable: this.settings.draggable,
            infinite: this.settings.infinite,
            adaptiveHeight: true,
            responsive: [{
                    breakpoint: 1200,
                    settings: {
                        slidesToShow: this.settings.slidesToShow1200,
                        slidesToScroll: this.settings.slidesToScroll1200
                    }
                },
                {
                    breakpoint: 992,
                    settings: {
                        slidesToShow: this.settings.slidesToShow992,
                        slidesToScroll: this.settings.slidesToScroll992
                    }
                },
                {
                    breakpoint: 768,
                    settings: {
                        slidesToShow: this.settings.slidesToShow768,
                        slidesToScroll: this.settings.slidesToScroll768
                    }
                },
                {
                    breakpoint: 480,
                    settings: {
                        slidesToShow: 1,
                        slidesToScroll: this.settings.slidesToScroll480
                    }
                }
            ]
        })
    }

    Carousels.prototype = _.assignIn({}, Carousels.prototype, {
        _a11y: function(event, obj) {
            var $list = obj.$list;
            var $wrapper = this.$container.parent();

            // Remove default Slick aria-live attr until slider is focused
            $list.removeAttr('aria-live');

            // When an element in the slider is focused set aria-live
            $wrapper.on('focusin', function(evt) {
                if ($wrapper.has(evt.target).length) {
                    $list.attr('aria-live', 'polite');
                }
            });

            // Remove aria-live
            $wrapper.on('focusout', function(evt) {
                if ($wrapper.has(evt.target).length) {
                    $list.removeAttr('aria-live');
                }
            });
        },

        _goToSlide: function(slideIndex) {
            this.$container.slick('slickGoTo', slideIndex);
        },

        onUnload: function() {
            delete this.$container;
        },

        onBlockSelect: function(evt) {
            // Ignore the cloned version
            var $slide = $(
                '.carousel__slide-wrapper--' + evt.detail.blockId + ':not(.slick-cloned)'
            );
            var slideIndex = $slide.data('slick-index');

            // Go to selected slide, pause autoplay
            this._goToSlide(slideIndex);

        }
    });

    return Carousels;
})()

// Productlists
theme.Productlists = (function() {
    function Productlists(container) {
        this.$container = $(container).on('init', this._a11y.bind(this));
        this.settings = {
            slidesToShow: this.$container.data('slidestoshow') || 1,
            rows: this.$container.data('rows') || 1,
            arrows: this.$container.data('arrows') || false,
            dots: this.$container.data('dots') || false,
            draggable: this.$container.data('draggable') || false,
            infinite: this.$container.data('infinite') || false,
        }
        this.settings.slidesToShow1200 = (this.settings.slidesToShow - 1) > 1 ? (this.settings.slidesToShow - 1) : 1;
        this.settings.slidesToShow992 = (this.settings.slidesToShow - 2) > 1 ? (this.settings.slidesToShow - 2) : 1;
        this.settings.slidesToShow768 = (this.settings.slidesToShow - 3) > 1 ? (this.settings.slidesToShow - 3) : 1;
        this.settings.slidesToShow480 = 2;
        this.$container.slick({
            rtl: theme.rtl,
            accessibility: true,
            slidesToShow: this.settings.slidesToShow,
            slidesToScroll: this.settings.slidesToShow,
            rows: this.settings.rows,
            arrows: this.settings.arrows,
            dots: this.settings.dots,
            infinite: this.settings.infinite,
            draggable: this.settings.draggable,
            responsive: [{
                    breakpoint: 1200,
                    settings: {
                        slidesToShow: this.settings.slidesToShow1200,
                        slidesToScroll: this.settings.slidesToShow1200
                    }
                },
                {
                    breakpoint: 992,
                    settings: {
                        slidesToShow: this.settings.slidesToShow992,
                        slidesToScroll: this.settings.slidesToShow992
                    }
                },
                {
                    breakpoint: 768,
                    settings: {
                        slidesToShow: this.settings.slidesToShow768,
                        slidesToScroll: this.settings.slidesToShow768
                    }
                },
                {
                    breakpoint: 480,
                    settings: {
                        slidesToShow: this.settings.slidesToShow480,
                        slidesToScroll: this.settings.slidesToShow480
                    }
                }
            ]
        }).css('opacity', '1');
    }

    Productlists.prototype = _.assignIn({}, Productlists.prototype, {
        _a11y: function(event, obj) {
            var $list = obj.$list;
            var $wrapper = this.$container.parent();

            // Remove default Slick aria-live attr until slider is focused
            $list.removeAttr('aria-live');

            // When an element in the slider is focused set aria-live
            $wrapper.on('focusin', function(evt) {
                if ($wrapper.has(evt.target).length) {
                    $list.attr('aria-live', 'polite');
                }
            });

            // Remove aria-live
            $wrapper.on('focusout', function(evt) {
                if ($wrapper.has(evt.target).length) {
                    $list.removeAttr('aria-live');
                }
            });
        },

        _goToSlide: function(slideIndex) {
            this.$container.slick('slickGoTo', slideIndex);
        },

        onUnload: function() {
            delete this.$container;
        }
    });

    return Productlists;
})();

// Producttabs
theme.Producttabs = (function() {
    function Producttabs(container) {
        var _self = this; // avoid conflict
        this.$container = $(container).on('init', this._a11y.bind(this));
        this.slickWrap = '.prdtab-content';
        this.settings = {
            slidesToShow: this.$container.data('slidestoshow') || 1,
            arrows: this.$container.data('arrows') || false,
            rows: this.$container.data('rows') || 1,
            dots: this.$container.data('dots') || false,
            draggable: this.$container.data('draggable') || false,
            infinite: this.$container.data('infinite') || false,
        }
        this.settings.slidesToShow1200 = (this.settings.slidesToShow - 1) > 1 ? (this.settings.slidesToShow - 1) : 1;
        this.settings.slidesToShow992 = (this.settings.slidesToShow - 2) > 1 ? (this.settings.slidesToShow - 2) : 1;
        this.settings.slidesToShow768 = (this.settings.slidesToShow - 3) > 1 ? (this.settings.slidesToShow - 3) : 1;
        this.settings.slidesToShow480 = 2;

        this._initSlick();
        this.$container.find('a[data-toggle="tab"]').on("shown.bs.tab", function(e) {
            _self._unSlick();
            _self._initSlick();
            theme.tooltip.load();
        })
    }

    Producttabs.prototype = _.assignIn({}, Producttabs.prototype, {
        _a11y: function(event, obj) {
            var $list = obj.$list;
            var $wrapper = this.$container.parent();

            // Remove default Slick aria-live attr until slider is focused
            $list.removeAttr('aria-live');

            // When an element in the slider is focused set aria-live
            $wrapper.on('focusin', function(evt) {
                if ($wrapper.has(evt.target).length) {
                    $list.attr('aria-live', 'polite');
                }
            });

            // Remove aria-live
            $wrapper.on('focusout', function(evt) {
                if ($wrapper.has(evt.target).length) {
                    $list.removeAttr('aria-live');
                }
            });
        },

        _getSliderSettings: function() {
            return {
                rtl: theme.rtl,
                accessibility: true,
                slidesToShow: this.settings.slidesToShow,
                slidesToScroll: this.settings.slidesToShow,
                arrows: this.settings.arrows,
                rows: this.settings.rows,
                dots: this.settings.dots,
                infinite: this.settings.infinite,
                draggable: this.settings.draggable,
                responsive: [{
                        breakpoint: 1200,
                        settings: {
                            slidesToShow: this.settings.slidesToShow1200,
                            slidesToScroll: this.settings.slidesToShow1200
                        }
                    },
                    {
                        breakpoint: 992,
                        settings: {
                            slidesToShow: this.settings.slidesToShow992,
                            slidesToScroll: this.settings.slidesToShow992
                        }
                    },
                    {
                        breakpoint: 768,
                        settings: {
                            slidesToShow: this.settings.slidesToShow768,
                            slidesToScroll: this.settings.slidesToShow768
                        }
                    },
                    {
                        breakpoint: 480,
                        settings: {
                            slidesToShow: this.settings.slidesToShow480,
                            slidesToScroll: this.settings.slidesToShow480
                        }
                    }
                ]
            }
        },

        _initSlick: function() {
            this.$container.find(this.slickWrap).slick(this._getSliderSettings()).css('opacity', '1');
        },

        _unSlick: function() {
            this.$container.find(this.slickWrap).slick('unslick');
        },

        onUnload: function() {
            delete this.$container;
        },

        onSelect: function() {
            this._unSlick();
            this._initSlick();
        },

        onBlockSelect: function(evt) {
            var navItem = $('.nav-link-' + evt.detail.blockId);
            navItem.tab('show');
            this._unSlick();
            this._initSlick();
        }
    });

    return Producttabs;
})();

theme.Video = (function() {
    var promiseYoutubeAPI;
    var promiseVimeoAPI;

    var youtube = {
        promiseAPI: function() {
            if (!promiseYoutubeAPI) {
                var tag = document.createElement('script');

                tag.src = 'https://www.youtube.com/iframe_api';
                var firstScriptTag = document.getElementsByTagName('script')[0];
                firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

                promiseYoutubeAPI = $.Deferred(function(defer) {
                    window.onYouTubeIframeAPIReady = defer.resolve;

                    setTimeout(function() {
                        defer.reject('Request for YouTube API timed out after 30 seconds.');
                    }, 30000);
                });
            }

            return promiseYoutubeAPI;
        },
        promisePlayer: function(id, options) {
            return this.promiseAPI().then(function() {
                return $.Deferred(function(defer) {
                    if (typeof window.YT === 'undefined') {
                        defer.reject(
                            "We're sorry, something went wrong. The YouTube API has not loaded correctly."
                        );
                    }

                    /* eslint-disable no-undef */
                    var player = new YT.Player(id, options); // global YT variable injected by YouTube API

                    player.addEventListener('onReady', function() {
                        defer.resolve(player);
                    });

                    setTimeout(function() {
                        defer.reject(
                            'Request for YouTube player has timed out after 30 seconds.'
                        );
                    }, 30000);
                });
            });
        }
    };

    var vimeo = {
        promiseAPI: function() {
            if (!promiseVimeoAPI) {
                promiseVimeoAPI = $.Deferred(function(defer) {
                    var tag = document.createElement('script');
                    tag.src = 'https://player.vimeo.com/api/player.js';
                    tag.onload = tag.onreadystatechange = function() {
                        if (!this.readyState || this.readyState === 'complete') {
                            defer.resolve();
                        }
                    };

                    var firstScriptTag = document.getElementsByTagName('script')[0];
                    firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

                    setTimeout(function() {
                        defer.reject('Request for Vimeo API timed out after 30 seconds.');
                    }, 30000);
                });
            }

            return promiseVimeoAPI;
        },

        promisePlayer: function(id, options) {
            return this.promiseAPI().then(function() {
                return $.Deferred(function(defer) {
                    if (typeof window.Vimeo === 'undefined') {
                        defer.reject(
                            "We're sorry, something went wrong. The Vimeo API has not loaded correctly."
                        );
                    }

                    var player = new window.Vimeo.Player(id, options);

                    setTimeout(function() {
                        defer.reject(
                            'Request for Vimeo player has timed out after 30 seconds.'
                        );
                    }, 30000);

                    player.ready().then(function() {
                        defer.resolve(player);
                    });
                });
            });
        }
    };

    var selectors = {
        loadPlayerButton: '.video-section__load-player-button',
        closePlayerButton: '.video-section__player-close',
        playerContainer: '.video-section__player',
        cover: '.video-section__cover',
        errorMessage: '.video-section__error',
        bodyOverlay: '.video-section__body-overlay',
        body: 'body'
    };
    var classes = {
        playerLoading: 'video-section--loading',
        playerLoaded: 'video-section--loaded',
        playerError: 'video-section--error',
        videoPlaying: 'video-playing'
    };

    function Video(container) {
        this.$container = $(container);
        var sectionId = this.$container.attr('data-section-id');
        this.namespace = '.' + sectionId;
        this.onLoad();
    }

    Video.prototype = _.assignIn({}, Video.prototype, {
        onLoad: function() {
            this.$container
                .on('click', selectors.loadPlayerButton, this._loadPlayer.bind(this))
                .on('click', selectors.closePlayerButton, this._closePlayer.bind(this))
                .on('click', selectors.bodyOverlay, this._closePlayer.bind(this));
        },

        _loadPlayer: function() {
            var $container = this.$container;
            var $playerContainer = $(selectors.playerContainer, $container);
            var playerType = this.$container.attr('data-video-type');

            var promiseVideoPlayer;

            if (playerType === 'youtube') {
                promiseVideoPlayer = this._loadYoutubePlayer($playerContainer[0]);
            } else if (playerType === 'vimeo') {
                promiseVideoPlayer = this._loadVimeoPlayer($playerContainer[0]);
            }

            return promiseVideoPlayer
                .then(this._onPlayerLoadReady.bind(this))
                .fail(this._onPlayerLoadError.bind(this));
        },

        _loadYoutubePlayer: function(container) {
            return youtube
                .promisePlayer(container, {
                    videoId: this.$container.attr('data-video-id'),
                    ratio: 16 / 9,
                    playerVars: {
                        modestbranding: 1,
                        autoplay: 1,
                        showinfo: 0,
                        rel: 0
                    }
                })
                .then(
                    function(player) {
                        this.player = player;
                    }.bind(this)
                );
        },

        _loadVimeoPlayer: function(container) {
            return vimeo
                .promisePlayer(container, {
                    id: this.$container.attr('data-video-id')
                })
                .then(
                    function(player) {
                        this.player = player;
                        this.player.play();
                    }.bind(this)
                );
        },

        _onPlayerLoadReady: function() {
            $(selectors.closePlayerButton, this.$container)
                .show()
                .focus();
            $(selectors.cover, this.$container).addClass(classes.playerLoaded);
            this.$container.addClass(classes.playerLoaded);

            this._setScrollPositionValues();

            $(selectors.body).addClass(classes.videoPlaying);

            $(document).on('keyup' + this.namespace, this._closeOnEscape.bind(this));
            $(window).on(
                'resize' + this.namespace,
                this._setScrollPositionValues.bind(this)
            );
            slate.a11y.trapFocus({
                $container: this.$container,
                namespace: this.namespace
            });
        },

        _onPlayerLoadError: function(err) {
            this.$container.addClass(classes.playerError);
            $(selectors.errorMessage, this.$container).text(err);
        },

        _closeOnEscape: function(evt) {
            if (evt.keyCode !== 27) {
                return;
            }

            this._closePlayer();
            $(selectors.loadPlayerButton, this.$container).focus();
        },

        _onScroll: function() {
            var scrollTop = $(window).scrollTop();

            if (
                scrollTop > this.videoTop + 0.25 * this.videoHeight ||
                scrollTop + this.windowHeight <
                this.videoBottom - 0.25 * this.videoHeight
            ) {
                // Debounce DOM edits to the next frame with requestAnimationFrame
                requestAnimationFrame(this._closePlayer.bind(this));
            }
        },

        _setScrollPositionValues: function() {
            this.videoHeight = this.$container.outerHeight(true);
            this.videoTop = this.$container.offset().top;
            this.videoBottom = this.videoTop + this.videoHeight;
            this.windowHeight = $(window).innerHeight();
        },

        _closePlayer: function() {
            $(selectors.body).removeClass(classes.videoPlaying);
            $(selectors.cover, this.$container).removeClass(classes.playerLoaded);
            this.$container.removeClass(classes.playerLoaded);
            $(selectors.closePlayerButton, this.$container).hide();

            slate.a11y.removeTrapFocus({
                $container: this.$container,
                namespace: this.namespace
            });

            if (typeof this.player.destroy === 'function') {
                this.player.destroy();
            } else if (typeof this.player.unload === 'function') {
                this.player.unload();
            }

            $(document).off(this.namespace);
            $(window).off(this.namespace);
        }
    });

    return Video;
})();

theme.CollectionsList = (function() {
    function CollectionsList(container) {
        var $container = (this.$container = $(container));
        var stretchImage = $container.is('[data-stretch-image]');

        // Early return if 'secondary image layout' is enabled
        if (stretchImage) return;

        var namespace = (this.namespace = '.' + $container.attr('data-section-id'));
        var self = this;

        self._collectionListFix();
        $(window).on(
            'resize' + namespace,
            $.debounce(250, function() {
                self._collectionListFix();
            })
        );
    }

    CollectionsList.prototype = _.assignIn({}, CollectionsList.prototype, {
        onUnload: function() {
            $(window).off(this.namespace);
        },

        _collectionListFix: function() {
            var numberRows = this.$container.find('.grid').data('number-rows');
            var $featureCards = this.$container.find('.featured-card');

            // We can exit if 'Use secondary image layout' is enabled
            if ($featureCards.is('[data-stretch-image]')) return;

            // Go through each of the rows
            for (var i = 0; i < numberRows; i++) {
                var maxWrapperHeight = 0;
                var maxHeaderHeight = 0;
                var $currentRow = $featureCards.filter(
                    "[data-row-number='" + (i + 1) + "']"
                );
                var $cardHeaders = $currentRow.find('.featured-card__header');

                // Find the max heights for each row
                $currentRow.each(function() {
                    var $cardTitle = $(this).find('.featured-card__title');
                    var $cardAction = $(this).find('.featured-card__action');
                    var $cardImageWrapper = $(this).find('.featured-card__image-wrapper');
                    var headerHeight =
                        $cardTitle.outerHeight() + $cardAction.outerHeight() + 65;
                    var wrapperHeight = $cardImageWrapper.outerHeight();
                    if (headerHeight > maxHeaderHeight) {
                        maxHeaderHeight = headerHeight;
                    }
                    if (wrapperHeight > maxWrapperHeight) {
                        maxWrapperHeight = wrapperHeight;
                    }
                });

                // Set the heights of the headers and cards for this row with padding
                $cardHeaders.outerHeight(maxHeaderHeight);
                $currentRow.height(maxWrapperHeight + maxHeaderHeight + 40);
            }
        }
    });

    return CollectionsList;
})();

theme.ParrallaxImage = (function() {
    function ParrallaxImage(container) {
        this.container = container;
        this.sectionId = $(container).attr('data-section-id');
        this.namespace = 'parallax-' + this.sectionId;
        var images = document.getElementsByClassName('thumbnail' + this.sectionId);
        new simpleParallax(images, {
            scale: 1.5,
            delay: .6,
        });
    }

    ParrallaxImage.prototype = $.extend({}, ParrallaxImage.prototype, {
        onUnload: function(evt) {
            var instance = new simpleParallax(images);
            instance.destroy();
            delete theme.ParrallaxImage[this.namespace];
        }
    });

    return ParrallaxImage;
})();

theme.init = function() {
    theme.customerTemplates.init();
    slate.rte.wrapTable();
    slate.rte.iframeReset();

    // Common a11y fixes
    slate.a11y.pageLinkFocus($(window.location.hash));

    $('.in-page-link').on('click', function(evt) {
        slate.a11y.pageLinkFocus($(evt.currentTarget.hash));
    });

    $('a[href="#"]').on('click', function(evt) {
        evt.preventDefault();
    });


    //scroll animation
    AOS.init({
        startEvent: 'DOMContentLoaded',
        offset: 30, // offset (in px) from the original trigger point
        delay: 0, // values from 0 to 3000, with step 50ms
        duration: 1000,
        once: true
    });
    window.addEventListener('load', function() {
        AOS.refresh();
    });


    // Sections
    var sections = new theme.Sections();
    sections.register('header', theme.HeaderSection);
    sections.register('product', theme.Product);
    sections.register('slideshow-section', theme.SlideshowSection);
    sections.register('cart', theme.Cart);
    sections.register('instagrams', theme.Instagrams);
    sections.register('masonries', theme.Masonry);
    sections.register('productlist', theme.Productlists);
    sections.register('producttab', theme.Producttabs);
    sections.register('slickCarousels', theme.slickCarousel);
    sections.register('video', theme.Video);
    sections.register('collections-list', theme.CollectionsList);
    sections.register('parallax-image', theme.ParrallaxImage);
    sections.register('bgcollection', theme.Bgcollection);

    // Standalone modules
    $(window).on('load', theme.articleImages);
    theme.passwordModalInit();
};

theme.articleImages = function() {
    var $indentedRteImages = $('.rte--indented-images');
    if (!$indentedRteImages.length) {
        return;
    }

    $indentedRteImages.find('img').each(function(i, el) {
        var $el = $(el);
        var attr = $el.attr('style');

        // Check if undefined or float: none
        if (!attr || attr === 'float: none;') {
            // Add class to parent paragraph tag if image is wider than container
            if ($el.width() >= $indentedRteImages.width()) {
                $el.parent('p').addClass('rte__image-indent');
            }
        }
    });
};

theme.passwordModalInit = function() {
    var $loginModal = $('#LoginModal');
    if (!$loginModal.length) {
        return;
    }

    // Initialize modal
    theme.PasswordModal = new window.Modals('LoginModal', 'login-modal', {
        focusOnOpen: '#Password'
    });

    // Open modal if errors exist
    if ($loginModal.find('.errors').length) {
        theme.PasswordModal.open();
    }
};

// CSS var ponyfill
theme.cssVar = (function() {
    cssVars();
})()

// Ajax search https://gist.github.com/awojtczyk/53d74c8af5f893841f33979b0cdcd6fe
theme.ajaxSearch = (function() {
    var $inputSearch = '.js-ajaxsearch',
        $resultsList = '.search-results',
        $input = $($inputSearch).find('input[name="q"]'),
        $currentAjaxRequest,
        $displayProducts = 6;

    $($inputSearch).css('position', 'relative').each(function() {
        $input.attr('autocomplete', 'off').bind('keyup change', function() {
            var term = $(this).val(),
                form = $(this).closest('form'),
                searchURL = '/search?type=product&q=*' + term + '*';
            if (term.length > 2 && term !== $(this).attr('data-old-term')) {
                $(this).attr('data-old-term', term);
                if ($currentAjaxRequest !== undefined) $currentAjaxRequest.abort();
                $currentAjaxRequest = $.getJSON(searchURL + '&view=json', function(data) {
                    $($resultsList).empty();

                    if (data.results_count === 0) {
                        $($resultsList).html('<p class="text-center">' + theme.strings.ajaxSearchNoResult + '</p>')
                    } else {
                        $.each(data.results, function(index, item) {
                            if (index < $displayProducts) {
                                var itemPrice = theme.Currency.formatMoney(item.price, theme.moneyFormat);
                                var link = $('<a class="d-inline-flex ' + index + '"></a>')
                                    .attr('href', item.url)
                                    .append('<span class="image"><img src="' + item.thumbnail + '" /></span>')
                                    .append('<div class="meta"><p class="title">' + item.title + '</p>' + itemPrice + '</div>')
                                    .wrap('<div class="ajax-search-item"></div>');
                                $($resultsList).append(link.parent());
                                theme.updateCurrencies();
                            }
                        });
                        if (data.results_count > $displayProducts) {
                            $($resultsList).append('<a class="btn btn--full" href="' + searchURL + '">' + theme.strings.ajaxSearchViewAll + ' (' + data.results_count + ')</a>');
                        }
                    }
                    $($resultsList).addClass('active').fadeIn(200);
                });
            }
        });
    });

    //escape when click somethings
    $(document).click(function(event) {
        var target = event.target;
        if (!$(target).is($inputSearch) && !$(target).parents().is($inputSearch)) {
            $($resultsList).slideUp(300);
        }
    });
})();

// Quickview https://github.com/kellyvaughn/quickview-for-shopify/blob/master/quickview.js.liquid
theme.quickview = (function() {
    var product_handle = '',
        quickviewButtonClass = '.js-btn-quickview',
        quickviewId = '#jsQuickview',
        quickviewOption = '#jsQuickview select',
        quickviewThumb = '#qv-product-images',
        quickviewAddCartButton = '.qv-add-button',
        quickviewPrice = '.qv-product-price',
        quickviewComparePrice = '.qv-product-compare-price';

    // 1. Show quickview
    $(document).on('click', quickviewButtonClass, function() {
        var quickviewAvaible = $(this).attr("data-pavailable");
        product_handle = $(this).data('handle');
        //ResetQuickview
        $(quickviewId).removeClass().addClass('modal fade');
        $(quickviewThumb).removeClass().empty();
        $('.qv-product-options').empty();

        //Pushdata
        $(quickviewId).addClass(product_handle).data('handle', product_handle);
        jQuery.getJSON('/products/' + product_handle + '.js', function(product) {
            var title = product.title;
            var type = product.type;
            var vendor = product.vendor;
            var price = 0;
            var compare_price = 0;
            var desc = product.description.slice(0, 90);
            var images = product.images;
            var variants = product.variants;
            var options = product.options;
            var url = '/products/' + product_handle;
            $('.qv-product-title').text(title);
            $('.qv-product-type').text(type);
            $('.qv-product-description').html(desc);
            $('.qv-view-product').attr('href', url);
            $('.qv-view-type').text(type);
            $('.qv-view-vendor').text(vendor)
            if (quickviewAvaible == 'true') {
                $(quickviewAddCartButton).prop('disabled', false).html(theme.strings.addToCart);
            } else {
                $(quickviewAddCartButton).prop('disabled', true).html(theme.strings.soldOut);
            }
            $(product.variants).each(function(i, variants) {
                if (variants.sku != null) {
                    $('.qv-sku').addClass("show").removeClass("hide");
                    $('.qv-view-sku').text(product.variants[0].sku);
                } else {
                    $('.qv-sku').addClass("hide").removeClass("show");
                }

            });
            var imageCount = $(images).length;
            $(images).each(function(i, image) {
                image_embed = '<div><img src="' + image + '"></div>';
                image_embed = image_embed.replace('.jpg', '_800x.jpg').replace('.png', '_800x.png');
                $(quickviewThumb).append(image_embed);
            });
            $(quickviewThumb).slick({
                rtl: theme.rtl,
                'dots': true,
                'arrows': true,
                'respondTo': 'min',
                'useTransform': true
            }).css('opacity', '1');

            if (product.variants[0].option1 !== "Default Title") {
                $(options).each(function(i, option) {
                    var name = option.name;
                    var opt = name.replace(/ /g, '-').toLowerCase();
                    var selectClass = '.option.' + opt;
                    $('.qv-product-options').append('<div class="option-selection ' + opt + '"><span class="option text-uppercase font-weight-bold text-body">' + option.name + '</span><select class="option-' + i + ' option ' + opt + '"></select></div>');
                    $(option.values).each(function(i, value) {
                        $('.option.' + opt).append($('<option>', {
                            value: value,
                            text: value
                        }));
                    });
                });
            }
            $(product.variants).each(function(i, v) {
                if (v.inventory_quantity == 0) {
                    return true
                } else {
                    price = theme.Currency.formatMoney(v.price, theme.moneyFormat);
                    compare_price = theme.Currency.formatMoney(v.compare_at_price, theme.moneyFormat);
                    $(quickviewPrice).html(price);
                    if (v.compare_at_price !== null) {
                        $(quickviewComparePrice).html(compare_price).show();
                    } else {
                        $(quickviewComparePrice).hide();
                    }
                    theme.updateCurrencies();
                    $('select.option-0').val(v.option1);
                    $('select.option-1').val(v.option2);
                    $('select.option-2').val(v.option3);
                    return false
                }
            });
        });
        //addCartQuickview
    });
    // 2. Add to cart
    $(document).on('click', quickviewAddCartButton, function() {
        product_handle = $(quickviewId).data('handle');
        var qty = $('.qv-quantity').val(),
            selectedOptions = '',
            var_id = '';

        function processCart() {
            jQuery.post('/cart/add.js', {
                    quantity: qty,
                    id: var_id
                }, null, "json").done(function(item) {
                    var htmlVariant = item.variant_title !== null ? '<i>(' + item.variant_title + ')</i>' : '';
                    var styleCart = $('.js-mini-cart').attr("data-cartmini");
                    if (styleCart != 'true') {
                        var htmlAlert = '<div class="media mt-2 alert--cart"><a class="mr-3" href="/cart"><img class="lazyload" data-src="' + item.image + '"></a><div class="media-body align-self-center"><p class="m-0 font-weight-bold">' + item.product_title + ' x ' + item.quantity + '</p>' + htmlVariant + '<div><div>';
                        theme.alert.new(theme.strings.addToCartSuccess, htmlAlert, 3000, 'notice');
                    }
                    theme.miniCart.updateElements();
                    theme.miniCart.generateCart();
                })
                .fail(function($xhr) {
                    var data = $xhr.responseJSON;
                    theme.alert.new('', data.description, 3000, 'warning');
                });
        }
        $(quickviewOption).each(function(i) {
            if (selectedOptions == '') {
                selectedOptions = $(this).val();
            } else {
                selectedOptions = selectedOptions + ' / ' + $(this).val();
            }
        });
        jQuery.getJSON('/products/' + product_handle + '.js', function(product) {
            if (product.variants.length === 1) {
                var_id = product.variants[0].id;
            } else {
                $(product.variants).each(function(i, v) {
                    if (v.title == selectedOptions) {
                        var_id = v.id;
                    }
                });
            }
            processCart();
        });
    });
    // 3. Select variants
    $(document).on('change', quickviewOption, function() {
        var selectedOptions = '';
        $(quickviewOption).each(function(i) {
            if (selectedOptions == '') {
                selectedOptions = $(this).val();
            } else {
                selectedOptions = selectedOptions + ' / ' + $(this).val();
            }
        });
        jQuery.getJSON('/products/' + product_handle + '.js', function(product) {
            $(product.variants).each(function(i, v) {
                if (v.title == selectedOptions) {
                    if (v.featured_image !== null) {
                        var iSlick = v.featured_image.position - 1;
                        $(quickviewThumb).slick('slickGoTo', iSlick);
                    }
                    var price = theme.Currency.formatMoney(v.price, theme.moneyFormat);
                    var compare_price = theme.Currency.formatMoney(v.compare_at_price, theme.moneyFormat);
                    $(quickviewPrice).html(price);
                    $(quickviewComparePrice).html(compare_price);
                    if (v.sku != null) {
                        $('.qv-sku').addClass("show").removeClass("hide");
                        $('.qv-view-sku').text(v.sku);
                    } else {
                        $('.qv-sku').addClass("hide").removeClass("show");
                    }
                    if (v.compare_at_price !== null) {
                        $(quickviewComparePrice).html(compare_price).show();
                    } else {
                        $(quickviewComparePrice).hide();
                    }
                    theme.updateCurrencies();
                    if (v.inventory_management === null) {
                        $(quickviewAddCartButton).prop('disabled', false).val(theme.strings.addToCart);
                    } else {
                        if (v.inventory_quantity < 1) {
                            $(quickviewAddCartButton).prop('disabled', true).val(theme.strings.soldOut);
                        } else {
                            $(quickviewAddCartButton).prop('disabled', false).val(theme.strings.addToCart);
                        }
                    }
                }
            });
        });
    });
})()

//Button add to cart (in grid item)
theme.addCartButton = (function() {
    var buttonClass = '.js-grid-cart';
    $(document).on('click', buttonClass, function() {
        var $this = $(this);
        var id = $this.data('id');
        $this.addClass('is-loading');
        Shopify.addItem(id, 1, function(item) {
            location.href = "/cart";
            var htmlVariant = item.variant_title !== null ? '<i>(' + item.variant_title + ')</i>' : '';
            var styleCart = $('.js-mini-cart').attr("data-cartmini");
            if (styleCart != 'true') {
                var htmlAlert = '<div class="media mt-2 alert--cart"><a class="mr-3" href="/cart"><img class="lazyload" data-src="' + item.image + '"></a><div class="media-body align-self-center"><p class="m-0 font-weight-bold">' + item.product_title + ' x ' + item.quantity + '</p>' + htmlVariant + '<div><div>';
            }
            theme.miniCart.updateElements();
            theme.miniCart.generateCart();
            setTimeout(function() {
                styleCart != 'true' ? theme.alert.new(theme.strings.addToCartSuccess, htmlAlert, 3000, 'notice') : '';
                $this.removeClass('is-loading');
            }, 1000);
        });
    })
})()

// Button add to cart (in grid item)
//theme.addCartButton = (function(){
//  var buttonClass = '.js-grid-cart';
//  $(document).on('click',buttonClass,function(){
//    var $this = $(this);
//    var id = $this.data('id');
//    $this.addClass('is-loading');
//    Shopify.addItem(id,1,function(item){
//      var htmlVariant = item.variant_title !== null ? '<i>('+item.variant_title+')</i>' : '';
//      var styleCart = $('.js-mini-cart').attr("data-cartmini");
//        if(styleCart != 'true'){
//          var htmlAlert = '<div class="media mt-2 alert--cart"><a class="mr-3" href="/cart"><img class="lazyload" data-src="'+item.image+'"></a><div class="media-body align-self-center"><p class="m-0 font-weight-bold">'+item.product_title+' x '+ item.quantity +'</p>'+htmlVariant+'<div><div>';
//        }
//      theme.miniCart.updateElements();
//      theme.miniCart.generateCart();
//      setTimeout(function() {
//        styleCart != 'true' ? theme.alert.new(theme.strings.addToCartSuccess,htmlAlert,3000,'notice'): '';
//        $this.removeClass('is-loading');
//      }, 1000);
//    });
// })
//})()

// Multi currencies 
if (theme.enableCurrencies) {
    // Can be 'money_format' or 'money_with_currency_format'
    Currency.format = 'money_format';
    var shopCurrency = Shopify.currency.active;
    var cookieCurrency = Currency.cookie.read();
    // Fix for customer account pages 
    jQuery('span.money span.money').each(function() {
        jQuery(this).parent('span.money').removeClass('money');
    });
    // Add precalculated shop currency to data attribute 
    jQuery('span.money').each(function() {
        jQuery(this).attr('data-currency-' + Shopify.currency.active, jQuery(this).html());
    });
    // Select all your currencies buttons.
    var buttons = jQuery('#currencies a'),
        currentCurrencies = jQuery('.pre-currencies');
    // When the page loads.
    if (cookieCurrency == null || cookieCurrency == shopCurrency) {
        Currency.currentCurrency = shopCurrency;
    } else {
        Currency.currentCurrency = cookieCurrency;
        Currency.convertAll(shopCurrency, cookieCurrency);
        buttons.removeClass('selected');
        jQuery('#currencies a[data-currency=' + cookieCurrency + ']').addClass('selected');
        var htmlCurrently = jQuery('#currencies a[data-currency=' + cookieCurrency + ']').html();
        currentCurrencies.html(htmlCurrently);
    }
    buttons.click(function() {
        buttons.removeClass('selected');
        jQuery(this).addClass('selected');
        var newCurrency = jQuery(this).attr('data-currency');
        var htmlCurrently = jQuery(this).html();
        currentCurrencies.html(htmlCurrently);
        Currency.convertAll(Currency.currentCurrency, newCurrency);
    });
    // For product options.
    var original_selectCallback = window.selectCallback;
    var selectCallback = function(variant, selector) {
        original_selectCallback(variant, selector);
        Currency.convertAll(shopCurrency, jQuery('#currencies a.selected').attr('data-currency'));
    };
}
theme.updateCurrencies = function() {
    Currency.convertAll(shopCurrency, jQuery('#currencies a.selected').attr('data-currency'));
}



// Free shipping
theme.freeShipping = (function() {
    var $freeShippingClass = $('.js-free-shipping'),
        $freeShippingTextClass = $('.js-free-shipping-text'),
        $free_fisrt = $freeShippingClass.attr('data-start'),
        $free_end = $freeShippingClass.attr('data-end')
    minOrderValue = parseInt($freeShippingClass.data('value')) || 0,
        $percentClass = $('.js-free-shipping .progress-bar');

    function generate(cart) {
        var priceCart = cart.total_price;
        if (priceCart >= minOrderValue) {
            $percentClass.css('width', '100%').removeClass('progress-bar-striped bg-primary');
            $freeShippingTextClass.text(theme.strings.freeShipping)
        } else {
            let percent = priceCart / minOrderValue * 100;
            let left = Shopify.formatMoney((minOrderValue - priceCart), theme.moneyFormat);
            $percentClass.css('width', percent + '%').addClass('progress-bar-striped primary');
            $freeShippingTextClass.html($free_fisrt + ' ' + left + ' ' + $free_end);
            theme.updateCurrencies();
        }
    }

    Shopify.getCart(function(cart) {
        generate(cart);
    });

    return {
        load: generate
    }
})()

// Shipping time - https://github.com/phstc/jquery-dateFormat
theme.shippingTime = (function() {
    var $shippingTime = $('.js-shipping-time'),
        shippingTime = $shippingTime.data('time') || '',
        now = new Date(),
        restHour = 23 - now.getHours(),
        restMinute = 59 - now.getMinutes();
    if (shippingTime !== '') {
        var nextTime = new Date(now.getTime() + shippingTime * 86400000),
            formatTime = $.format.date(nextTime, "ddd, dd MMMM yyyy"),
            htmlShipping = 'Order in the next <b>' + restHour + '</b> hours <b>' + restMinute + '</b> minutes to get it by <b>' + formatTime + '</b>. ';
        $shippingTime.html(htmlShipping);
    }
})()

// Infinite scroll - https://github.com/Elkfox/Ajaxinate/blob/master/dist/ajaxinate.min.js
theme.infiniteScroll = (function() {
    function initInfiniteScroll() {
        if ($('.AjaxinateLoop').length === 0) {
            return;
        } else {
            var endlessScroll = new Ajaxinate({
                loadingText: '<div class="text-center"><div class="' + theme.loadingClass + '" role="status"></div></div>',
                callback: function() {
                    theme.wishlist.load();
                    theme.compare.load();
                    theme.countdown.load();
                    theme.priceRange.load();
                    theme.tooltip.load();
                    theme.collectionView.triggerView();
                    theme.swatchCard2.load();
                }
            });
        }
    }

    // Infinite scroll in other page (blog, list-collection)
    function initOtherPages() {
        var otherPages = new Ajaxinate({
            loadingText: '<div class="text-center"><div class="' + theme.loadingClass + '" role="status"></div></div>',
            container: '.js-pagination-content',
            pagination: '.js-pagination'
        });
    }

    document.addEventListener("DOMContentLoaded", function() {
        initInfiniteScroll();
        initOtherPages();
    });

    return {
        load: initInfiniteScroll
    }
})()

// Scroll to fixed
theme.scrollToFixed = (function() {
    var window_width = $(window).width();

    if (window_width < 768) {
        $(".js-stick-parent").trigger("sticky_kit:detach");
    } else {
        make_sticky();
    }
    $(window).resize(function() {

        window_width = $(window).width();

        if (window_width < 768) {
            $(".js-stick-parent").trigger("sticky_kit:detach");
        } else {
            make_sticky();
        }
    });

    function make_sticky() {
        $('.js-stick-parent').stick_in_parent();
    }

})()


theme.headersidebar = (function() {
    $('#dismiss, .overlaysidebar').on('click', function() {
        // hide sidebar
        $('#sidebar').removeClass('active');
        // hide overlay
        $('.overlaysidebar').removeClass('active');
    });

    $('#sidebarCollapse').on('click', function() {
        // open sidebar
        $('#sidebar').addClass('active');
        // fade in the overlay
        $('.overlaysidebar').addClass('active');
        $('.collapse.in').toggleClass('in');
        $('a[aria-expanded=true]').attr('aria-expanded', 'false');
    });
})()

// Wishlist
theme.wishlist = (function() {
    var wishlistButtonClass = '.js-btn-wishlist',
        wishlistRemoveButtonClass = '.js-remove-wishlist',
        $wishlistCount = $('.js-wishlist-count'),
        $wishlistContainer = $('.js-wishlist-content'),
        wishlistObject = JSON.parse(localStorage.getItem('localWishlist')) || [],
        wishlistPageUrl = $('.js-wishlist-link').attr('href'),
        loadNoResult = function() {
            // $wishlistContainer.html('<div class="col text-center"><div class="alert alert-warning d-inline-block">' + theme.strings.wishlistNoResult + '</div></div>');
        };

    function updateWishlist(self) {
        var productHandle = $(self).data('handle'),
            allSimilarProduct = $(wishlistButtonClass + '[data-handle="' + productHandle + '"]');
        var isAdded = $.inArray(productHandle, wishlistObject) !== -1 ? true : false;
        if (isAdded) {
            // go to wishlist page
            window.location.href = wishlistPageUrl;
        } else {
            wishlistObject.push(productHandle);
            allSimilarProduct.fadeOut('slow').fadeIn('fast').html(theme.strings.wishlistIconAdded + theme.strings.wishlistTextAdded);
            //change tooltip
            allSimilarProduct.attr('data-original-title', theme.strings.wishlistTextAdded);
            $('.tooltip-inner').text(theme.strings.wishlistTextAdded);
        }
        localStorage.setItem('localWishlist', JSON.stringify(wishlistObject));
        $wishlistCount.text(wishlistObject.length);
    };

    function loadWishlist() {
        $wishlistContainer.html('');
        //page wishlist
        if (wishlistObject.length > 0) {
            for (var i = 0; i < wishlistObject.length; i++) {
                var productHandle = wishlistObject[i];
                Shopify.getProduct(productHandle, function(product) {
                    var htmlProduct = '';
                    var productPrice = product.price_varies ? 'from ' + theme.Currency.formatMoney(product.price_min, theme.moneyFormat) : theme.Currency.formatMoney(product.price, theme.moneyFormat);
                    var productComparePrice = product.compare_at_price_min !== 0 ? theme.Currency.formatMoney(product.compare_at_price_min, theme.moneyFormat) : '';
                    htmlProduct += '<div class="js-wishlist-item col-md-4 col-sm-6 col-xs-6 col-12 mb-4">';
                    htmlProduct += '<div class="js-wishlist-itembox">';
                    htmlProduct += '<div class=" d-flex flex-row p-4">';
                    htmlProduct += '	<a class="d-inline-block mr-4 " href="' + product.url + '">';
                    htmlProduct += '		<img src="' + product.featured_image + '"/>';
                    htmlProduct += '	</a>';
                    htmlProduct += '	<div><a href="' + product.url + '" class="title-prouct d-block h4 text-body" >' + product.title + '</a>';
                    htmlProduct += '	<span> ' + productPrice + '</span>';
                    htmlProduct += '	 <s>' + productComparePrice + '</s></div>';
                    htmlProduct += '<button class="btn js-remove-wishlist" data-handle="' + product.handle + '">' + theme.strings.wishlistRemove + '</button>';
                    htmlProduct += '</div>';
                    htmlProduct += '</div>';
                    htmlProduct += '</div>';
                    $wishlistContainer.append(htmlProduct);
                    theme.updateCurrencies();
                });
            }
        } else {
            loadNoResult();
        }

        //count items
        $wishlistCount.text(wishlistObject.length);

        //button text
        $(wishlistButtonClass).each(function() {
            var productHandle = $(this).data('handle');
            var iconWishlist = $.inArray(productHandle, wishlistObject) !== -1 ? theme.strings.wishlistIconAdded : theme.strings.wishlistIcon;
            var textWishlist = $.inArray(productHandle, wishlistObject) !== -1 ? theme.strings.wishlistTextAdded : theme.strings.wishlistText;
            $(this).html(iconWishlist + textWishlist).attr('title', textWishlist);
        });
    }

    $(document).on('click', wishlistButtonClass, function(event) {
        event.preventDefault();
        updateWishlist(this);
    });
    $(document).on('click', wishlistRemoveButtonClass, function() {
        var productHandle = $(this).data('handle'),
            allSimilarProduct = $(wishlistButtonClass + '[data-handle="' + productHandle + '"]');

        //update button
        allSimilarProduct.html(theme.strings.wishlistIcon + theme.strings.wishlistText);
        //update tooltip
        allSimilarProduct.attr('data-original-title', theme.strings.wishlistText);
        $('.tooltip-inner').text(theme.strings.wishlistText);
        //update Object
        wishlistObject.splice(wishlistObject.indexOf(productHandle), 1);
        localStorage.setItem('localWishlist', JSON.stringify(wishlistObject));
        // Remove element
        $(this).closest('.js-wishlist-item').fadeOut(); // or .remove()
        //count
        $wishlistCount.text(wishlistObject.length);
        if (wishlistObject.length === 0) {
            loadNoResult();
        }
    });

    loadWishlist();
    $(document).on('shopify:section:load', loadWishlist);
    return {
        load: loadWishlist
    }
})()

// Compare
theme.compare = (function() {
    var compareButtonClass = '.js-btn-compare',
        compareRemoveButtonClass = '.js-remove-compare',
        $compareCount = $('.js-compare-count'),
        $compareContainer = $('.js-compare-content'),
        compareObject = JSON.parse(localStorage.getItem('localCompare')) || [],
        alertClass = 'notice';

    function updateCompare(self) {
        var productHandle = $(self).data('handle'),
            alertText = '';
        var isAdded = $.inArray(productHandle, compareObject) !== -1 ? true : false;
        if (isAdded) {
            compareObject.splice(compareObject.indexOf(productHandle), 1);
            alertText = theme.strings.compareNotifyRemoved;
            alertClass = 'notice';
        } else {
            if (compareObject.length === 4) {
                alertText = theme.strings.compareNotifyMaximum;
                alertClass = 'error';
            } else {
                alertClass = 'notice';
                compareObject.push(productHandle);
                alertText = theme.strings.compareNotifyAdded;
            }
        }
        localStorage.setItem('localCompare', JSON.stringify(compareObject));
        theme.alert.new(theme.strings.compareText, alertText, 2000, alertClass);
        $compareCount.text(compareObject.length);
    };

    function loadCompare() {
        var compareGrid;
        $compareContainer.html('');
        //popup compare
        if (compareObject.length > 0) {
            compareGrid = compareObject.length === 1 ? 'col-md-6 col-sm-6' : 'col';
            for (var i = 0; i < compareObject.length; i++) {
                var productHandle = compareObject[i];
                Shopify.getProduct(productHandle, function(product) {
                    var htmlProduct = '',
                        productPrice = product.price_varies ? 'from ' + theme.Currency.formatMoney(product.price_min, theme.moneyFormat) : theme.Currency.formatMoney(product.price, theme.moneyFormat),
                        productComparePrice = product.compare_at_price_min !== 0 ? theme.Currency.formatMoney(product.compare_at_price_min, theme.moneyFormat) : '',
                        productAvailable = product.available ? theme.strings.available : theme.strings.unavailable,
                        productAvailableClass = product.available ? 'alert-success' : 'alert-danger',
                        productTypeHTML = product.type !== "" ? '<a href="/collections/types?q=' + product.type + '">' + product.type + '</a>' : '<span>' + theme.strings.none + '</span>',
                        productVendorHTML = product.vendor !== "" ? '<a href="/collections/vendors?q=' + product.vendor + '">' + product.vendor + '</a>' : '<span>' + theme.strings.none + '</span>';
                    htmlProduct += '<div class="compare-item ' + compareGrid + ' col-xs-6">';
                    htmlProduct += '	<a href="' + product.url + '">';
                    htmlProduct += '		<img src="' + Shopify.resizeImage(product.featured_image, 'x300') + '"/>';
                    htmlProduct += '	</a>';
                    htmlProduct += '	<hr /><h5 >' + product.title + '</h5>';
                    htmlProduct += '	<hr /><s>' + productComparePrice + '</s>';
                    htmlProduct += '	<span> ' + productPrice + '</span>';
                    htmlProduct += '	<hr /><span class=' + productAvailableClass + '> ' + productAvailable + '</span>';
                    htmlProduct += '	<hr />' + productTypeHTML;
                    htmlProduct += '	<hr />' + productVendorHTML;
                    htmlProduct += '  <hr /><button class="btn js-remove-compare btn-theme gradient-theme" data-handle="' + product.handle + '">' + theme.strings.compareRemove + '</button>';
                    htmlProduct += '</div>';
                    $compareContainer.append(htmlProduct);
                    theme.updateCurrencies();
                });
            }
        } else {
            // $compareContainer.html('<div class="alert alert-warning d-inline-block">' + theme.strings.compareNoResult + '</div>');
        }

        //button text
        $(compareButtonClass).each(function() {
            var productHandle = $(this).data('handle');
            var status = $.inArray(productHandle, compareObject) !== -1 ? 'added' : '';
            $(this).removeClass('added').addClass(status);
        });

        //count items
        $compareCount.text(compareObject.length);
    }
    $(document).on('click', compareButtonClass, function(event) {
        event.preventDefault();
        updateCompare(this);
        loadCompare();
    });
    $(document).on('click', compareRemoveButtonClass, function() {
        var productHandle = $(this).data('handle');
        compareObject.splice(compareObject.indexOf(productHandle), 1);
        localStorage.setItem('localCompare', JSON.stringify(compareObject));
        loadCompare();
    });

    loadCompare();
    $(document).on('shopify:section:load', loadCompare);
    return {
        load: loadCompare
    }
})()

// Popup newsletter
theme.popupNewletter = (function() {
    var $popupNewsletter = $('#jsPopupNewsletter'),
        $newsletterForm = $('#jsPopupNewsletter form'),
        date = new Date(),
        minutes = theme.timePopupNewsletter;
    minutesdelay = $popupNewsletter.attr('data-delay');
    if ($popupNewsletter.length === 1) {
        date.setTime(date.getTime() + (minutes * 60 * 1000));
        var setCookies = function() {
            $.cookie('cookiesNewsletter', 'disabled', { expires: date, path: '/' });
        };
        if ($.cookie('cookiesNewsletter') !== "disabled") {
            $(window).on('load', function() {
                setTimeout(function() {
                    $popupNewsletter.modal('show');
                }, minutesdelay * 1000);
            });
            $popupNewsletter.on('hidden.bs.modal', setCookies);
            $newsletterForm.submit(setCookies);
        }
    }
})()

// Cookie policy
theme.cookie = (function() {
    var $policy = $('.js-cookie-policy'),
        $closeButton = $('.js-btn-ok'),
        isOk = localStorage.getItem('localCookie') || '';
    if (isOk === '') {
        $policy.fadeIn('slow');
    }
    $closeButton.on('click', function() {
        localStorage.setItem('localCookie', 'accept');
        $policy.fadeOut('slow');
    })
})()

// Announcement Bar
theme.announcement = (function() {
    var $bar = $('.js-announcement-bar'),
        $closeButton = $('.js-ab-close'),
        isClosed = localStorage.getItem('localAnnouncement') || '';
    if (isClosed === '') {
        $bar.fadeIn();
        $bar.closest('.body-theme').addClass('body-announcement-bar');
    }
    $closeButton.on('click', function() {
        localStorage.setItem('localAnnouncement', 'closed');
        $bar.slideUp();
        $bar.closest('.body-theme').removeClass('body-announcement-bar');
    })
})()

// Open external link in new tab
theme.exLink = (function() {
    var links = document.links;
    for (let i = 0, linksLength = links.length; i < linksLength; i++) {
        if (links[i].hostname !== window.location.hostname && $(links[i]).attr('href') !== 'javascript:void(0)') {
            links[i].target = '_blank';
        }
    }
})()

// Deal- countdown
theme.countdown = (function() {
    function initCountdown() {
        $(".js-countdown").each(function() {
            var endTime = $(this).data('time'),
                htmlLayout = "<ul class='list--inline'><li class='gradient-theme-vertical'><span class='countdown-time'>%%D%%</span><span class='countdown-text'>Days</span></li><li class='gradient-theme-vertical'><span class='countdown-time'>%%H%%</span><span class='countdown-text'>Hours</span></li><li class='gradient-theme-vertical'><span class='countdown-time'>%%M%%</span><span class='countdown-text'>Mins</span></li><li class='gradient-theme-vertical'><span class='countdown-time'>%%S%%</span><span class='countdown-text'>Secs</span></li></ul>";
            $(this).lofCountDown({
                TargetDate: endTime,
                DisplayFormat: htmlLayout,
                FinishMessage: '<span class="alert alert-warning d-inline-block">' + theme.strings.countdownEndText + '</span>'
            });
        });
    }
    initCountdown();
    return {
        load: initCountdown
    }
})()

// Price range - Collection page
theme.priceRange = (function() {
    function initPriceRange() {
        var min = 0,
            max = 0,
            slideRange = '#js-slider-range',
            productCard = '.js-product-card',
            slideRangeWrap = '.slider-range-wr',
            rangeMin = '.js-range-min',
            rangeMax = '.js-range-max',
            enablePriceRange = $('#js-slider-range').length === 1 ? true : false;

        if (enablePriceRange) {
            $(productCard).each(function() {
                if (eval($(this).data('price')) > max) max = eval($(this).data('price'));
                if (min == 0) min = eval($(this).data('price'));
                else if (eval($(this).data('price')) < min) min = eval($(this).data('price'));
            });

            if (min === max) {
                $(slideRangeWrap).fadeOut();
            } else {
                $(slideRangeWrap).fadeIn();
            }

            $(slideRange).slider({
                range: true,
                min: min,
                max: max,
                values: [min, max],
                slide: function(event, ui) {
                    var price1 = (Shopify.formatMoney(ui.values[0], theme.moneyFormat));
                    var price2 = (Shopify.formatMoney(ui.values[1], theme.moneyFormat));
                    $(rangeMin).html(price1);
                    $(rangeMax).html(price2);
                    theme.updateCurrencies();

                    // Show/Hide product when dragging
                    $(productCard).each(function() {
                        if (eval($(this).data('price')) >= ui.values[0] && eval($(this).data('price')) <= ui.values[1]) {
                            $(this).parent().fadeIn();
                        } else {
                            $(this).parent().fadeOut();
                        }
                    });
                }
            });

            var price1 = (Shopify.formatMoney(min, theme.moneyFormat));
            var price2 = (Shopify.formatMoney(max, theme.moneyFormat));
            $(rangeMin).html(price1);
            $(rangeMax).html(price2);
            theme.updateCurrencies();

        }
    }
    initPriceRange();
    return {
        load: initPriceRange
    }
})()

// Collection view - Collection page
theme.collectionView = (function() {
    var btnView = '.js-btn-view',
        btnViewActive = '.js-btn-view.active';

    $(document).on('click', btnView, function() {
        var value = $(this).data('col'),
            $gridItemCol = $('.js-col');

        $(btnView).removeClass('active');
        $(this).addClass('active');

        $gridItemCol.removeClass().addClass('js-col col-sm-6 col-12');
        if (value === 3) {
            $gridItemCol.addClass('col-lg-4');
        } else if (value === 4) {
            $gridItemCol.addClass('col-lg-3');
        } else if (value === 5) {
            $gridItemCol.addClass('col-lg-2-4');
        } else if (value === 6) {
            $gridItemCol.addClass('col-lg-2');
        };
    })

    function triggerCollectionView() {
        $(btnViewActive).trigger('click');
    }

    return {
        triggerView: triggerCollectionView
    }
})()

// Swath variant in card item
theme.swatchCard = (function() {
    $(document).on('click', '.js-swatch-card-item', function() { //click or mouseover
        $(".js-swatch-card-item").removeClass("active");
        $(this).addClass("active");
        var newImage = $(this).data('image');
        var id = $(this).data('id');
        var gridItem = $(this).closest('.js-product-card');
        gridItem.find('.product-card__image').find('img').attr('srcset', newImage);
        gridItem.find('.js-grid-cart').data('id', id).attr('data-id', id);
    });
})()

theme.swatchCard2 = (function() {
    function initVariant(id) {
        var productJson = JSON.parse($('.customJson-' + id).html());
        var $selectorForm = $('.customform-' + id);
        var $button = $('.js-customform-addtocart-' + id);
        var $buttontext = $button.find('span');
        var $wrapObject = $selectorForm.closest('.js-product-card');
        var options = {
            $container: $selectorForm,
            enableHistoryState: false,
            product: productJson,
            singleOptionSelector: '.single-option-selector-' + id,
            originalSelectorId: '#ProductSelect-' + id
        };
        var variants = new slate.Variants(options);
        var AjaxCart = new window.AjaxCart($selectorForm);
        var _updateButton = function(evt) {
            var variant = evt.variant;
            if (variant === undefined) {
                $button.prop('disabled', true).removeClass('btn--sold-out');
                $buttontext.html(theme.strings.unavailable);
            } else {
                if (variant.available) {
                    $button.removeClass('btn--sold-out').prop('disabled', false);
                    $buttontext.html(theme.strings.addToCart);
                } else {
                    $button.prop('disabled', true).addClass('btn--sold-out');
                    $buttontext.html(theme.strings.soldOut);
                }
            }
        }
        var _updateImage = function(evt) {
            var variant = evt.variant;
            var $mainImage = $wrapObject.find('.product-card__image').find('img');
            if (variant !== undefined && variant.featured_image !== null) {
                var variantImage = variant.featured_image;
                $mainImage.attr('srcset', variantImage.src);
            }
        }
        var _updatePrice = function(evt) {
            var $price = $wrapObject.find('.product-card__price');
            var variant = evt.variant;
            if (variant !== undefined) {
                var htmlComparePrice = variant.compare_at_price !== null ? '<s class="product-card__regular-price"><span class="money">' + variant.compare_at_price + '</span></s>' : '';
                var htmlPrice = '<span class="money">' + variant.price + '</span>' + htmlComparePrice;
                $price.html(htmlPrice);
                theme.updateCurrencies();
            }
        }
        variants.$container.on(
            'variantChange', _updateButton
        );
        variants.$container.on(
            'variantChange', _updateImage
        );
        variants.$container.on(
            'variantChange', _updatePrice
        );
    }

    function initForm() {
        $('.js-customform').each(function() {
            var id = $(this).data('id');
            initVariant(id);
        })
    }

    initForm();
    return {
        load: initForm
    }
})()

// Loading
theme.loading = (function() {
    var $loading = $('#js-loading'),
        hasLoading = $('#js-loading').length === 0 ? false : true;
    if (hasLoading) {
        $(window).load(function() {
            $loading.fadeOut();
        });
    }
})()

theme.effectLeavingPage = (function() {
    window.onbeforeunload = function() {
        $('body').css('opacity', '0');
    }
})()

// Isotope
theme.isotope = (function() {
    var enableIsotope = $('.enable-isotope').length === 1 ? true : false,
        $grid = $('.js-grid'),
        filter = '.js-filter-isotope';

    function initIsotope() {
        if (enableIsotope) {
            $grid.isotope({
                itemSelector: '.grid-item',
                percentPosition: true
            })
            $(document).on('click', filter, function() {
                var filterValue = $(this).data('filter') === '*' ? $(this).data('filter') : '.' + $(this).data('filter');
                $(filter).removeClass('active');
                $(this).addClass('active');
                $grid.isotope({
                    filter: filterValue
                });
            });
            $(window).scroll(function() {
                $grid.isotope('layout');
            });
            $(window).load(function() {
                $grid.isotope('layout');
                $(filter).first().trigger('click');
            });
        }
    }
    initIsotope();
})()

//aos



// theme.Wow = (function(){
//   new WOW().init();
// })()




// Masonry
theme.Masonry = (function() {
    function Masonry(container) {
        this.$container = $(container).on('init', this._a11y.bind(this));
        var $masonry = this.$container;
        $masonry.isotope({
            itemSelector: '.grid-item',
            percentPosition: true,
            masonry: {
                columnWidth: '.grid-sizer'
            }
        });
        $(window).load(function() {
            $masonry.isotope('layout').css('opacity', '1');
        });
        $(window).scroll(function() {
            $masonry.isotope('layout').css('opacity', '1');
        });
    }

    Masonry.prototype = _.assignIn({}, Masonry.prototype, {
        _a11y: function(event, obj) {
            var $list = obj.$list;
            var $wrapper = this.$container.parent();

            // Remove default Slick aria-live attr until slider is focused
            $list.removeAttr('aria-live');

            // When an element in the slider is focused set aria-live
            $wrapper.on('focusin', function(evt) {
                if ($wrapper.has(evt.target).length) {
                    $list.attr('aria-live', 'polite');
                }
            });

            // Remove aria-live
            $wrapper.on('focusout', function(evt) {
                if ($wrapper.has(evt.target).length) {
                    $list.removeAttr('aria-live');
                }
            });
        }
    });

    return Masonry;
})();



// Cross-selling
theme.crosssell = (function() {
    var crosssellClass = '.js-crosssell',
        handles = $(crosssellClass).data('handles') || '',
        arrayHandle = handles.split(','),
        $blockCrosssell = $('.block-cross-sell'),
        variantSelectClass = '.js-cross-select',
        crossImageClass = '.cross-item-image',
        crossPriceClass = '.cross-item-money';

    function generateCrosssell() {
        for (var i = 0; i < arrayHandle.length; i++) {
            var productHandle = arrayHandle[i];
            Shopify.getProduct(productHandle, function(product) {
                var htmlCross = '',
                    htmlOption = '',
                    firstAvailableVariant = '',
                    variantCount = product.variants.length;

                // generate select box and check first avaiable variant
                for (var j = 0; j < variantCount; j++) {
                    var variant = product.variants[j],
                        variantImage = variant.featured_image === null ? product.featured_image : variant.featured_image.src,
                        disabled = variant.available ? '' : 'disabled';
                    htmlOption += '<option ' + disabled + ' data-id="' + variant.id + '" data-price="' + variant.price + '" data-image="' + variantImage + '">' + variant.title + '</option>';
                    if (firstAvailableVariant === '' && variant.available) {
                        firstAvailableVariant = variant
                    }
                }
                var productPrice = theme.Currency.formatMoney(firstAvailableVariant.price, theme.moneyFormat),
                    productImage = firstAvailableVariant.featured_image === null ? product.featured_image : firstAvailableVariant.featured_image.src,
                    selectHide = variantCount === 1 ? 'hide' : '';

                // generate HTML
                htmlCross += '<div class="col cross-item ' + product.handle + '">';
                htmlCross += '	<a class="cross-item-image" href="' + product.url + '" title="' + product.title + '"><img src="' + productImage + '" />' + theme.strings.cartIcon + '</a>';
                htmlCross += '	<a target="_blank" href="' + product.url + '" title="' + product.title + '" class="cross-item-title">' + product.title + '</a>';
                htmlCross += '	<span class="cross-item-money">' + productPrice + '</span>';
                htmlCross += '	<select class="js-cross-select ' + selectHide + '" data-image="' + productImage + '" data-price="' + firstAvailableVariant.price + '" data-item="' + firstAvailableVariant.id + '">' + htmlOption + '</select>';
                htmlCross += '</div>';
                $(crosssellClass).append(htmlCross);
                theme.updateCurrencies();
            });
        }
    }

    function showPopupCrosssell(lineItem) {
        //generate lineitem;
        var htmlLineItem = '';
        htmlLineItem += '<span class="alert alert-success d-inline-block mb-2">' + theme.strings.addToCartSuccess + '</span>';
        htmlLineItem += '<div><img src="' + lineItem.image + '" alt="Added Product"></div>';
        htmlLineItem += '<h4 class="cross-item-title">' + lineItem.title + '</h4>';
        htmlLineItem += '<div class="mb-2">' + theme.strings.cartQuantity + ': ' + lineItem.quantity + '</div>';
        $('.js-cross-added').hide().html(htmlLineItem).fadeIn();

        // show popup
        var $popupCrosssell = $('#jsCrosssell');
        $popupCrosssell.modal('show');
    }

    if (handles !== '') {
        $(document).on('click', crossImageClass, function(event) {
            event.preventDefault();
            var parent = $(this).closest('.cross-item'),
                itemId = parent.find(variantSelectClass).attr('data-item');
            Shopify.addItem(itemId, 1, function(lineItem) {
                theme.miniCart.updateElements();
                theme.miniCart.generateCart();
                showPopupCrosssell(lineItem);
            });
        });
        $(document).on('change', variantSelectClass, function() {
            var selectVariant = $(this).children(':selected'),
                selectVariantId = selectVariant.data('id'),
                parent = $(this).parent(),
                newPrice = theme.Currency.formatMoney(selectVariant.data('price'), theme.moneyFormat);

            if (selectVariant.data('image') !== '') {
                parent.find(crossImageClass).find('img').attr('src', selectVariant.data('image'));
            }
            $(this).attr('data-item', selectVariantId);
            parent.find(crossPriceClass).html(newPrice);
            theme.updateCurrencies();
        });
        $(document).on('shopify:section:load', generateCrosssell);
        generateCrosssell();
        $blockCrosssell.removeClass('hide');
    }
    return {
        showPopup: showPopupCrosssell
    }
})()

// Upsell
theme.upsell = (function() {
    var popupUpsell = '#jsUpsell',
        $button = $('#jsUpsell .btn'),
        productUpsellId = $('#jsUpsell').data('id') || '',
        buttonAcceptClass = 'js-btn-accept',
        delayTime = $('#jsUpsell').data('delay') || 3000,
        isUpsell = $(popupUpsell).length === 1 ? true : false;
    if (isUpsell) {
        $(document).ready(function() {
            setTimeout(function() {
                $(popupUpsell).modal('show');
            }, delayTime);
        });
        $button.on('click', function() {
            if ($(this).hasClass(buttonAcceptClass)) {
                Shopify.addItem(productUpsellId, 1, function(item) {
                    theme.miniCart.updateElements();
                    theme.miniCart.generateCart();
                    var htmlVariant = item.variant_title !== null ? '<i>(' + item.variant_title + ')</i>' : '';
                    var htmlAlert = '<div class="media mt-2 alert--cart"><a class="mr-3" href="/cart"><img class="lazyload" data-src="' + item.image + '"></a><div class="media-body align-self-center"><p class="m-0 font-weight-bold">' + item.product_title + ' x ' + item.quantity + '</p>' + htmlVariant + '<div><div>';
                    theme.alert.new(theme.strings.addToCartSuccess, htmlAlert, 3000, 'notice');
                })
            }
            $(popupUpsell).modal('hide');
        })
    }
})()

// Coupon
theme.coupon = (function() {
    var popupCoupon = '#jsCoupon',
        $button = $('#jsCoupon .js-btn-coupon'),
        delayTime = $('#jsCoupon').data('delay') || 3000,
        isCoupon = $(popupCoupon).length === 1 ? true : false,
        isCopied = localStorage.getItem('localCoupon') || '';
    if (isCoupon && isCopied === '') {
        $(document).ready(function() {
            setTimeout(function() {
                $(popupCoupon).modal('show');
            }, delayTime);
        });
        $button.on('click', function() {
            var copyText = document.getElementById("coupon_code");
            copyText.select();
            document.execCommand("Copy");
            $(popupCoupon).modal('hide');
            theme.alert.new('Coupon code', 'Successfully copied, now you can paste code at checkout', 4000);
            localStorage.setItem('localCoupon', 'copied');
        })
    }
})()

// Overwrite Shopify.onError in Shopify API
Shopify.onError = function(t, r) {
    var e = eval("(" + t.responseText + ")");
    var mess = e.message ? e.message + "(" + e.status + "): " + e.description : "Error : " + Shopify.fullMessagesFromErrors(e).join("; ") + "."
    theme.alert.new('Alert', mess, 3000, 'warning');
}

// Megamenu width
theme.fixWidthMegamenu = (function() {
    var $megamenuClass = $('.site-nav__item-mega'),
        megaDropdownClass = '.meganav';
    $megamenuClass.each(function() {
        var widthMenu = $(this).data('width') || 0;
        if (widthMenu !== 0) {
            $(this).find(megaDropdownClass).css({ 'width': widthMenu + 'px', 'margin-left': '-' + widthMenu / 2 + 'px' });
        }
    });
})()

// Product video
theme.productVideo = (function() {
    var playButtonClass = '.js-play-button';
    $(document).on('click', playButtonClass, function() {
        let videoSelector = $(this).next(),
            videoObject = videoSelector.get(0);
        $(this).toggleClass('active');
        videoSelector.toggleClass('active');
        videoObject.paused ? videoObject.play() : videoObject.pause();
    })
})()

// Fake-viewers
theme.fakeViewer = (function() {
    var $fakeViewClass = $('.js-fake-view'),
        minValue = $fakeViewClass.data('min'),
        maxValue = $fakeViewClass.data('max'),
        duration = $fakeViewClass.data('duration');

    function randomInRange(start, end) {
        var value = Math.floor(Math.random() * (end - start + 1) + start);
        $fakeViewClass.text(value);
    }

    if (minValue !== undefined && maxValue !== undefined) {
        randomInRange(minValue, maxValue);
        setInterval(function() {
            randomInRange(minValue, maxValue);
        }, duration);
    }

})();

// Product-suggest
theme.productSuggest = (function() {
    var $productSuggestClass = $('.product-notification'),
        $closeButtonClass = $('.close-notifi'),
        duration = $productSuggestClass.data('time') || 0,
        productSuggestCookie = 'cookieSuggest';

    function SomeonePurchased() {
        if ($.cookie(productSuggestCookie) == 'closed') {
            $productSuggestClass.remove();
        }
        $closeButtonClass.on('click', function() {
            $productSuggestClass.remove();
            $.cookie(productSuggestCookie, 'closed', { expires: 1, path: '/' });
        });

        function toggleSomething() {
            if ($productSuggestClass.hasClass('active')) {
                $productSuggestClass.removeClass('active')
            } else {
                var arrayProducts = $('.data-product'),
                    randomProduct = Math.floor(Math.random() * arrayProducts.length),
                    Object = $(arrayProducts[randomProduct]);

                $productSuggestClass.addClass('active');
                $productSuggestClass.find('.product-image').attr('href', Object.data('url')).find('img').attr('src', Object.data('image'));
                $productSuggestClass.find('.product-name').text(Object.data('title')).attr('href', Object.data('url'));
                $productSuggestClass.find('.time-ago').text(Object.data('time'));
                $productSuggestClass.find('.from-ago').text(Object.data('local'));
            }
        }

        if (duration !== 0) {
            setInterval(toggleSomething, duration);
        }
    }
    SomeonePurchased();
})()


// Stickyheader
theme.stickyHeader = (function() {
    var stickHeaderClass = '.site-header--sticky';
    if ($(stickHeaderClass).length !== 0) {
        $(window).scroll(function() {
            if (window.pageYOffset >= 20) {
                $(stickHeaderClass).addClass('active');
            } else {
                $(stickHeaderClass).removeClass('active');
            }
        });
    }
})()

theme.PhotoSwipe = (function() {
    var initPhotoSwipeFromDOM = function(gallerySelector) {

        // parse slide data (url, title, size ...) from DOM elements 
        // (children of gallerySelector)
        var parseThumbnailElements = function(el) {
            var thumbElements = el.childNodes,
                numNodes = thumbElements.length,
                items = [],
                figureEl,
                linkEl,
                size,
                item;

            for (var i = 0; i < numNodes; i++) {

                figureEl = thumbElements[i]; // <figure> element

                // include only element nodes 
                if (figureEl.nodeType !== 1) {
                    continue;
                }

                linkEl = figureEl.children[0]; // <a> element

                size = linkEl.getAttribute('data-size').split('x');

                // create slide object
                item = {
                    src: linkEl.getAttribute('href'),
                    w: parseInt(size[0], 10),
                    h: parseInt(size[1], 10)
                };



                if (figureEl.children.length > 1) {
                    // <figcaption> content
                    item.title = figureEl.children[1].innerHTML;
                }

                if (linkEl.children.length > 0) {
                    // <img> thumbnail element, retrieving thumbnail url
                    item.msrc = linkEl.children[0].getAttribute('src');
                }

                item.el = figureEl; // save link to element for getThumbBoundsFn
                items.push(item);
            }

            return items;
        };

        // find nearest parent element
        var closest = function closest(el, fn) {
            return el && (fn(el) ? el : closest(el.parentNode, fn));
        };

        // triggers when user clicks on thumbnail
        var onThumbnailsClick = function(e) {
            e = e || window.event;
            e.preventDefault ? e.preventDefault() : e.returnValue = false;

            var eTarget = e.target || e.srcElement;

            // find root element of slide
            var clickedListItem = closest(eTarget, function(el) {
                return (el.tagName && el.tagName.toUpperCase() === 'FIGURE');
            });

            if (!clickedListItem) {
                return;
            }

            // find index of clicked item by looping through all child nodes
            // alternatively, you may define index via data- attribute
            var clickedGallery = clickedListItem.parentNode,
                childNodes = clickedListItem.parentNode.childNodes,
                numChildNodes = childNodes.length,
                nodeIndex = 0,
                index;

            for (var i = 0; i < numChildNodes; i++) {
                if (childNodes[i].nodeType !== 1) {
                    continue;
                }

                if (childNodes[i] === clickedListItem) {
                    index = nodeIndex;
                    break;
                }
                nodeIndex++;
            }



            if (index >= 0) {
                // open PhotoSwipe if valid index found
                openPhotoSwipe(index, clickedGallery);
            }
            return false;
        };

        // parse picture index and gallery index from URL (#&pid=1&gid=2)
        var photoswipeParseHash = function() {
            var hash = window.location.hash.substring(1),
                params = {};

            if (hash.length < 5) {
                return params;
            }

            var vars = hash.split('&');
            for (var i = 0; i < vars.length; i++) {
                if (!vars[i]) {
                    continue;
                }
                var pair = vars[i].split('=');
                if (pair.length < 2) {
                    continue;
                }
                params[pair[0]] = pair[1];
            }

            if (params.gid) {
                params.gid = parseInt(params.gid, 10);
            }

            return params;
        };

        var openPhotoSwipe = function(index, galleryElement, disableAnimation, fromURL) {
            var pswpElement = document.querySelectorAll('.pswp')[0],
                gallery,
                options,
                items;

            items = parseThumbnailElements(galleryElement);

            // define options (if needed)
            options = {
                maxSpreadZoom: 1,
                bgOpacity: 0.7,
                zoomEl: true,
                history: false,
                zoomEl: false,
                pinchToClose: false,
                closeOnScroll: false,
                // define gallery index (for URL)
                galleryUID: galleryElement.getAttribute('data-pswp-uid'),

            };

            // PhotoSwipe opened from URL
            if (fromURL) {
                if (options.galleryPIDs) {
                    // parse real index when custom PIDs are used 
                    // http://photoswipe.com/documentation/faq.html#custom-pid-in-url
                    for (var j = 0; j < items.length; j++) {
                        if (items[j].pid == index) {
                            options.index = j;
                            break;
                        }
                    }
                } else {
                    // in URL indexes start from 1
                    options.index = parseInt(index, 10) - 1;
                }
            } else {
                options.index = parseInt(index, 10);
            }

            // exit if index not found
            if (isNaN(options.index)) {
                return;
            }

            if (disableAnimation) {
                options.showAnimationDuration = 0;
            }

            // Pass data to PhotoSwipe and initialize it
            gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, items, options);
            gallery.init();
        };

        // loop through all gallery elements and bind events
        var galleryElements = document.querySelectorAll(gallerySelector);

        for (var i = 0, l = galleryElements.length; i < l; i++) {
            galleryElements[i].setAttribute('data-pswp-uid', i + 1);
            galleryElements[i].onclick = onThumbnailsClick;
        }

        // Parse URL and open gallery if it contains #&pid=3&gid=1
        var hashData = photoswipeParseHash();
        if (hashData.pid && hashData.gid) {
            openPhotoSwipe(hashData.pid, galleryElements[hashData.gid - 1], true, true);
        }
    };

    // execute above function
    initPhotoSwipeFromDOM('.my-gallery');
})()

theme.ZoomImage = (function() {
    $(window).resize(function() {
        var width = $(window).width();
        if (width > 767) {
            ZoomImage();
        }
    });
    $(window).width(function() {
        var width = $(window).width();
        if (width > 767) {
            ZoomImage();
        }
    });

    function ZoomImage() {
        $(".zoom_image").each(function(arg, el) {
            var image = $(el).find("img");
            $(el).zoom({
                on: 'mouseover',
                url: image.attr("src").replace("small", "big")
            });
        });
    }
})()

theme.activeAccordion = (function() {
    $('.collapse').on('shown.bs.collapse', function() {
        $(this).prev().addClass('active-acc');
    });
    $('.collapse').on('hidden.bs.collapse', function() {
        $(this).prev().removeClass('active-acc');
    });
})()


// Anchor scroll
theme.anchorScroll = (function() {
    $(document).on('click', 'a[href^="#"]', function(event) {
        event.preventDefault();
        var disableAnchor = $(this).hasClass('disabled-anchor');
        if (!disableAnchor) {
            $('html, body').animate({
                scrollTop: $($.attr(this, 'href')).offset().top
            }, 500);
        }
    });
})()

// Product-recently-viewed
theme.productRecentlyViewed = (function() {
    var $viewedElement = $('.js-recently-view'),
        $viewButton = $('.js-recently-view-button'),
        $content = $('.js-recently-view-content'),
        productHandle = $viewedElement.data('handle') || '',
        limit = $viewButton.data('limit') || 0,
        arrayProduct = JSON.parse(localStorage.getItem('localRecentlyViewed')) || [],
        lastProduct = arrayProduct[arrayProduct.length - 1] || '',
        isAdded = $.inArray(productHandle, arrayProduct) !== -1 ? true : false;

    function processViewed() {
        if (productHandle !== '') {
            //process last product
            if (lastProduct === productHandle && arrayProduct.length > 1) {
                lastProduct = arrayProduct[arrayProduct.length - 2]
            }

            //move current product to last of array
            if (isAdded) {
                arrayProduct.splice(arrayProduct.indexOf(productHandle), 1);
            }
            arrayProduct.push(productHandle);
            //remove first item if limit
            if (arrayProduct.length > limit) {
                arrayProduct.shift()
            }
            localStorage.setItem('localRecentlyViewed', JSON.stringify(arrayProduct));
        }
    }

    function generatorProduct() {
        $content.html('');
        if (arrayProduct.length > 0) {
            //array
            for (var i = 0; i < arrayProduct.length; i++) {
                var productHandle = arrayProduct[i];
                Shopify.getProduct(productHandle, function(product) {
                    var htmlProduct = '';
                    var productPrice = product.price_varies ? 'from ' + theme.Currency.formatMoney(product.price_min, theme.moneyFormat) : theme.Currency.formatMoney(product.price, theme.moneyFormat);
                    var productComparePrice = product.compare_at_price_min !== 0 ? theme.Currency.formatMoney(product.compare_at_price_min, theme.moneyFormat) : '';
                    htmlProduct += '<div class="col-12 col-lg-4 js-viewed-item mb-4">';
                    htmlProduct += '	<div class="border p-3 rounded media d-flex ">';
                    htmlProduct += '	<a class="mr-3 col-4 p-0" href="' + product.url + '">';
                    htmlProduct += '		<img src="' + product.featured_image + '"/>';
                    htmlProduct += '	</a>';
                    htmlProduct += '	<div class="media-body text-left">';
                    htmlProduct += '		<h4 class="mb-2 mt-2"><a href="' + product.url + '">' + product.title + '</a></h5>';
                    htmlProduct += '	<span> ' + productPrice + '</span>';
                    htmlProduct += '	<s>' + productComparePrice + '</s>';
                    htmlProduct += '	</div>';
                    htmlProduct += '	</div>';
                    htmlProduct += '</div>';
                    $content.append(htmlProduct);
                    theme.updateCurrencies();
                });
            }

            //last product
            Shopify.getProduct(lastProduct, function(product) {
                $viewButton.css('background-image', 'url(' + product.featured_image + ')').addClass('active');
            })
        }
    }

    processViewed();
    generatorProduct();

})()

// Notice when soldout
theme.alert = (function() {
    function createAlert(title, mess, time, type) {
        var aTitle = title || '',
            aTime = time || 2000,
            aMessage = mess || '',
            aClass = type || 'default';
        $.growl({
            title: aTitle,
            message: aMessage,
            duration: aTime,
            style: aClass,
            size: 'large'
        });
    }

    return {
        new: createAlert
    }
})()

// Notice when soldout
theme.noticeSoldout = (function() {
    var $soldoutWrapFormClass = $('.js-contact-soldout'),
        $textClass = $('.js-notify-text'),
        $soldoutValueId = $('#ContactProduct');

    function noticeSoldout(variant) {
        $soldoutWrapFormClass.find('.form-success').remove()
        if (variant.available) {
            $textClass.find('span').text('');
            $soldoutWrapFormClass.addClass('hide');
        } else {
            $textClass.find('span').text(': ' + variant.name);
            $soldoutWrapFormClass.removeClass('hide');
            $soldoutValueId.val(variant.name).attr('value', variant.name);
        }
    }
    return {
        init: noticeSoldout
    }
})()

// Sticky cart
theme.stickyCart = (function() {
    var $anchor = $('#js-anchor-sticky-cart'),
        $stCart = $('.sticky-cart-wr'),
        $close = $('#js-sticky-close'),
        disableStCart = localStorage.getItem('localDisableStCart') || '';
    if (disableStCart !== '') {
        $stCart.addClass('disable');
    }
    $close.on('click', function() {
        var isDisable = disableStCart !== '';
        if (isDisable) {
            localStorage.setItem('localDisableStCart', '');
        } else {
            localStorage.setItem('localDisableStCart', 'true');
        }
        $stCart.toggleClass('disable');
    })
    if ($anchor.length) {
        $(window).on('scroll', function() {
            var hT = $anchor.offset().top,
                hH = $anchor.outerHeight(),
                wH = $(window).height(),
                wS = $(this).scrollTop();
            if (wS > (hT + hH - wH)) {
                $stCart.addClass('active');
            } else {
                $stCart.removeClass('active');
            }
        });
    }

})()

//Fix reload safari
window.addEventListener("pageshow", function(evt) {
    if (evt.persisted) {
        setTimeout(function() {
            window.location.reload();
        }, 10);
    }
}, false);

// Back to top
theme.backToTop = (function() {
    var backtotopClass = $('.js-back-to-top');
    $(window).scroll(function() {
        if ($(this).scrollTop() > 300) {
            backtotopClass.fadeIn('slow');
        } else {
            backtotopClass.fadeOut('slow');
        }
    });
    backtotopClass.on('click', function() {
        $('body,html').animate({ scrollTop: 0 }, 800);
    });
})()


// Tooltip
theme.tooltip = (function() {
    var selector = '[data-toggle="tooltip"],[data-tooltip="true"]';

    function loadTooltip() {
        $(selector).tooltip(); //Bootstrap 4
    };
    $(document).on('click', selector, function() {
        $(this).tooltip('hide');
    });
    loadTooltip();
    return {
        load: loadTooltip
    }
})()

//Collections style 2
theme.Bgcollection = (function() {
    // init Isotope
    function Bgcollection(container) {
        var $container = this.$container = $(container);
        var sectionId = $container.attr('data-section-id');
        var wrapper = this.wrapper = '.bgcollection-wrapper';
        var slider = this.slider = '#Bgcollection-' + sectionId;
        var $slider = $(slider, wrapper);
        $(".colgrid__bg--full[data-index='1']").addClass('active');
        $('.colgrid .colgrid__box').each(function() {
            var index = $(this).attr("data-index");
            $(this).hover(
                function() {
                    $(".colgrid__bg--full[data-index='" + index + "']").addClass('active');
                },
                function() {
                    $(".colgrid__bg--full[data-index='" + index + "']").removeClass('active');
                }
            );
        });
    }

    return Bgcollection;
})();


//Sidebar
theme.sidebar = (function() {
    var togglebutton = '.js-toggle-filter',
        $sidebar = $('.js-sidebar');
    $(document).on('click', togglebutton, function() {
        $sidebar.toggleClass('active');
        $(this).toggleClass('active');
    })
})()

// Ajax filter in collection page
theme.ajaxFilter = (function() {
    var ajaxContent = '#js-product-ajax',
        ajaxSortBy = '#js-sortby',
        ajaxFillter = '#js-fillter',
        ajaxCollectionTitle = '.js-collection-title',
        pageTitle = $(document).find("title").text(),
        jsLoading = '#js-loading';

    var apollo = {
        init: function() {
            this.initFilter();
        },
        showLoading: function() {
            $(jsLoading).show();
        },
        hideLoading: function() {
            $('body,html').animate({
                scrollTop: $('#MainContent').offset().top - 150
            }, 600);
            setTimeout(function() {
                $(jsLoading).hide(); //delay 500ms for better UX
            }, 500);

        },
        initFilter: function() {
            apollo.filterParams();
            apollo.filterSortby();
            apollo.sidebarMapTagEvents();
            apollo.filterMapSorting();
            apollo.filterMapPaging();
        },
        filterParams: function() {
            Shopify.queryParams = {};
            if (location.search.length) {
                for (var aKeyValue, i = 0, aCouples = location.search.substr(1).split('&'); i < aCouples.length; i++) {
                    aKeyValue = aCouples[i].split('=');
                    if (aKeyValue.length > 1) {
                        Shopify.queryParams[decodeURIComponent(aKeyValue[0])] = decodeURIComponent(aKeyValue[1]);
                    }
                }
            }
        },
        filterSortby: function() {
            if (Shopify.queryParams.sort_by) {
                var sortby = Shopify.queryParams.sort_by;
                $(ajaxSortBy).val(sortby);
            }
        },
        filterCreateUrl: function(baseLink) {
            var newQuery = $.param(Shopify.queryParams).replace(/%2B/g, '+');
            if (baseLink) {
                if (newQuery != "") {
                    return baseLink + "?" + newQuery;
                } else {
                    return baseLink;
                }
            }
            return location.pathname + "?" + newQuery;
        },
        filterMapData: function(data) {
            // 1. update product grid
            $(ajaxContent).html($(ajaxContent, data.responseText).html());
            // 2. update left filter
            $(ajaxFillter).html($(ajaxFillter, data.responseText).html());
            // 3. update collection title
            $(ajaxCollectionTitle).html($(ajaxCollectionTitle, data.responseText).html());
        },
        filterAjaxClick: function(baseLink) {
            delete Shopify.queryParams.page;
            var newurl = apollo.filterCreateUrl(baseLink);
            History.pushState({
                param: Shopify.queryParams
            }, pageTitle, newurl);
            apollo.filterGetContent(newurl);
        },
        filterGetContent: function(newurl) {
            $.ajax({
                type: 'GET',
                url: newurl,
                data: {},
                beforeSend: function() {
                    apollo.showLoading();
                },
                complete: function(data) {
                    apollo.filterMapData(data);
                    theme.wishlist.load();
                    theme.compare.load();
                    theme.countdown.load();
                    theme.priceRange.load();
                    theme.tooltip.load();
                    theme.collectionView.triggerView();
                    theme.swatchCard2.load();
                    theme.infiniteScroll.load();
                    apollo.hideLoading();
                },
                error: function(xhr, text) {
                    apollo.hideLoading();
                    alert($.parseJSON(xhr.responseText).description);
                }
            });
        },
        sidebarMapTagEvents: function() {
            $(document).on('click', '.advanced-filter a', function(event) {
                event.preventDefault();
                $('.tooltip').removeClass('show');
                var currentTags = [];
                if (Shopify.queryParams.constraint) {
                    currentTags = Shopify.queryParams.constraint.split('+');
                }
                if (!$(this).parent().hasClass("active-filter")) {
                    var otherTag = $(this).parents('.catalog_filter_ul').find("li.active-filter");
                    if (otherTag.length > 0) {
                        var tagName = otherTag.data("handle");
                        if (tagName) {
                            var tagPos = currentTags.indexOf(tagName);
                            if (tagPos >= 0) {
                                currentTags.splice(tagPos, 1);
                            }
                        }
                    }
                }
                var dataHandle = $(this).parent().data("handle");
                if (dataHandle) {
                    var tagPos = currentTags.indexOf(dataHandle);
                    if (tagPos >= 0) {
                        currentTags.splice(tagPos, 1);
                    } else {
                        currentTags.push(dataHandle);
                    }
                }
                if (currentTags.length) {
                    Shopify.queryParams.constraint = currentTags.join('+');
                } else {
                    delete Shopify.queryParams.constraint;
                }
                apollo.filterAjaxClick();
            });
            $(document).on('click', '.advanced-filter .icon', function() {
                $(this).parent('.advanced-filter').find('a').trigger("click");
            });
        },
        filterMapSorting: function() {
            $(document).on('change', ajaxSortBy, function() {
                Shopify.queryParams.sort_by = $(this).val();
                apollo.filterAjaxClick();
            })
        },
        filterMapPaging: function() {
            $(document).on('click', '.js-pagination a', function() {
                event.preventDefault();
                var linkPage = $(this).attr("href").match(/page=\d+/g);
                if (linkPage) {
                    Shopify.queryParams.page = parseInt(linkPage[0].match(/\d+/g));
                    if (Shopify.queryParams.page) {
                        var newurl = apollo.filterCreateUrl();
                        History.pushState({
                            param: Shopify.queryParams
                        }, pageTitle, newurl);
                        apollo.filterGetContent(newurl);
                    }
                }
            });
        }
    }

    if ($(".template-collection")) {
        History.Adapter.bind(window, 'statechange', function() {
            var State = History.getState();
            apollo.filterParams();
        });
    }
    apollo.init();

})();
$(theme.init);

/**
 * Currency Helpers
 * -----------------------------------------------------------------------------
 * A collection of useful functions that help with currency formatting
 *
 * Current contents
 * - formatMoney - Takes an amount in cents and returns it as a formatted dollar value.
 *
 * Alternatives
 * - Accounting.js - http://openexchangerates.github.io/accounting.js/
 *
 */

theme.Currency = (function() {
    var moneyFormat = '${{amount}}'; // eslint-disable-line camelcase

    function formatMoney(cents, format) {
        if (typeof cents === 'string') {
            cents = cents.replace('.', '');
        }
        var value = '';
        var placeholderRegex = /\{\{\s*(\w+)\s*\}\}/;
        var formatString = format || moneyFormat;

        function formatWithDelimiters(number, precision, thousands, decimal) {
            thousands = thousands || ',';
            decimal = decimal || '.';

            if (isNaN(number) || number === null) {
                return 0;
            }

            number = (number / 100.0).toFixed(precision);

            var parts = number.split('.');
            var dollarsAmount = parts[0].replace(
                /(\d)(?=(\d\d\d)+(?!\d))/g,
                '$1' + thousands
            );
            var centsAmount = parts[1] ? decimal + parts[1] : '';

            return dollarsAmount + centsAmount;
        }

        switch (formatString.match(placeholderRegex)[1]) {
            case 'amount':
                value = formatWithDelimiters(cents, 2);
                break;
            case 'amount_no_decimals':
                value = formatWithDelimiters(cents, 0);
                break;
            case 'amount_with_comma_separator':
                value = formatWithDelimiters(cents, 2, '.', ',');
                break;
            case 'amount_no_decimals_with_comma_separator':
                value = formatWithDelimiters(cents, 0, '.', ',');
                break;
            case 'amount_no_decimals_with_space_separator':
                value = formatWithDelimiters(cents, 0, ' ');
                break;
            case 'amount_with_apostrophe_separator':
                value = formatWithDelimiters(cents, 2, "'");
                break;
        }
        return formatString.replace(placeholderRegex, value);
    }

    return {
        formatMoney: formatMoney
    };
})();

/**
 * Image Helper Functions
 * -----------------------------------------------------------------------------
 * A collection of functions that help with basic image operations.
 *
 */

theme.Images = (function() {
    /**
     * Preloads an image in memory and uses the browsers cache to store it until needed.
     *
     * @param {Array} images - A list of image urls
     * @param {String} size - A shopify image size attribute
     */

    function preload(images, size) {
        if (typeof images === 'string') {
            images = [images];
        }

        for (var i = 0; i < images.length; i++) {
            var image = images[i];
            this.loadImage(this.getSizedImageUrl(image, size));
        }
    }

    /**
     * Loads and caches an image in the browsers cache.
     * @param {string} path - An image url
     */
    function loadImage(path) {
        new Image().src = path;
    }

    /**
     * Swaps the src of an image for another OR returns the imageURL to the callback function
     * @param image
     * @param element
     * @param callback
     */
    function switchImage(image, element, callback) {
        var size = this.imageSize(element.src);
        var imageUrl = this.getSizedImageUrl(image.src, size);

        if (callback) {
            callback(imageUrl, image, element); // eslint-disable-line callback-return
        } else {
            element.src = imageUrl;
        }
    }

    /**
     * +++ Useful
     * Find the Shopify image attribute size
     *
     * @param {string} src
     * @returns {null}
     */
    function imageSize(src) {
        src = src || '';

        var match = src.match(
            /.+_((?:pico|icon|thumb|small|compact|medium|large|grande)|\d{1,4}x\d{0,4}|x\d{1,4})[_\\.@]/
        );

        if (match === null) {
            return null;
        } else {
            return match[1];
        }
    }

    /**
     * +++ Useful
     * Adds a Shopify size attribute to a URL
     *
     * @param src
     * @param size
     * @returns {*}
     */
    function getSizedImageUrl(src, size) {
        if (size === null) {
            return src;
        }

        if (size === 'master') {
            return this.removeProtocol(src);
        }

        var match = src.match(
            /\.(jpg|jpeg|gif|png|bmp|bitmap|tiff|tif)(\?v=\d+)?$/i
        );

        if (match !== null) {
            var prefix = src.split(match[0]);
            var suffix = match[0];

            return this.removeProtocol(prefix[0] + '_' + size + suffix);
        }

        return null;
    }

    function removeProtocol(path) {
        return path.replace(/http(s)?:/, '');
    }

    return {
        preload: preload,
        loadImage: loadImage,
        switchImage: switchImage,
        imageSize: imageSize,
        getSizedImageUrl: getSizedImageUrl,
        removeProtocol: removeProtocol
    };
})();

/**
 * Variant Selection scripts
 * ------------------------------------------------------------------------------
 *
 * Handles change events from the variant inputs in any `cart/add` forms that may
 * exist.  Also updates the master select and triggers updates when the variants
 * price or image changes.
 *
 * @namespace variants
 */

slate.Variants = (function() {
    /**
     * Variant constructor
     *
     * @param {object} options - Settings from `product.js`
     */
    function Variants(options) {
        this.$container = options.$container;
        this.product = options.product;
        this.singleOptionSelector = options.singleOptionSelector;
        this.originalSelectorId = options.originalSelectorId;
        this.enableHistoryState = options.enableHistoryState;
        this.currentVariant = this._getVariantFromOptions();

        $(this.singleOptionSelector, this.$container).on(
            'change',
            this._onSelectChange.bind(this)
        );
    }

    Variants.prototype = _.assignIn({}, Variants.prototype, {
        /**
         * Get the currently selected options from add-to-cart form. Works with all
         * form input elements.
         *
         * @return {array} options - Values of currently selected variants
         */
        _getCurrentOptions: function() {
            var currentOptions = _.map(
                $(this.singleOptionSelector, this.$container),
                function(element) {
                    var $element = $(element);
                    var type = $element.attr('type');
                    var currentOption = {};

                    if (type === 'radio' || type === 'checkbox') {
                        if ($element[0].checked) {
                            currentOption.value = $element.val();
                            currentOption.index = $element.data('index');

                            return currentOption;
                        } else {
                            return false;
                        }
                    } else {
                        currentOption.value = $element.val();
                        currentOption.index = $element.data('index');

                        return currentOption;
                    }
                }
            );

            // remove any unchecked input values if using radio buttons or checkboxes
            currentOptions = _.compact(currentOptions);

            return currentOptions;
        },

        /**
         * Find variant based on selected values.
         *
         * @param  {array} selectedValues - Values of variant inputs
         * @return {object || undefined} found - Variant object from product.variants
         */
        _getVariantFromOptions: function() {
            var selectedValues = this._getCurrentOptions();
            var variants = this.product.variants;

            var found = _.find(variants, function(variant) {
                return selectedValues.every(function(values) {
                    return _.isEqual(variant[values.index], values.value);
                });
            });

            return found;
        },

        /**
         * Event handler for when a variant input changes.
         */
        _onSelectChange: function() {
            var variant = this._getVariantFromOptions();

            this.$container.trigger({
                type: 'variantChange',
                variant: variant
            });

            if (!variant) {
                return;
            }

            this._updateMasterSelect(variant);
            this._updateImages(variant);
            this._updatePrice(variant);
            this._updateSKU(variant);
            this.currentVariant = variant;

            if (this.enableHistoryState) {
                this._updateHistoryState(variant);
            }
        },

        /**
         * Trigger event when variant image changes
         *
         * @param  {object} variant - Currently selected variant
         * @return {event}  variantImageChange
         */
        _updateImages: function(variant) {
            var variantImage = variant.featured_image || {};
            var currentVariantImage = this.currentVariant.featured_image || {};

            if (!variant.featured_image ||
                variantImage.src === currentVariantImage.src
            ) {
                return;
            }

            this.$container.trigger({
                type: 'variantImageChange',
                variant: variant
            });
        },

        /**
         * Trigger event when variant price changes.
         *
         * @param  {object} variant - Currently selected variant
         * @return {event} variantPriceChange
         */
        _updatePrice: function(variant) {
            if (
                variant.price === this.currentVariant.price &&
                variant.compare_at_price === this.currentVariant.compare_at_price
            ) {
                return;
            }

            this.$container.trigger({
                type: 'variantPriceChange',
                variant: variant
            });
        },

        /**
         * Trigger event when variant sku changes.
         *
         * @param  {object} variant - Currently selected variant
         * @return {event} variantSKUChange
         */
        _updateSKU: function(variant) {
            if (variant.sku === this.currentVariant.sku) {
                return;
            }

            this.$container.trigger({
                type: 'variantSKUChange',
                variant: variant
            });
        },

        /**
         * Update history state for product deeplinking
         *
         * @param  {variant} variant - Currently selected variant
         * @return {k}         [description]
         */
        _updateHistoryState: function(variant) {
            if (!history.replaceState || !variant) {
                return;
            }

            var newurl =
                window.location.protocol +
                '//' +
                window.location.host +
                window.location.pathname +
                '?variant=' +
                variant.id;
            window.history.replaceState({ path: newurl }, '', newurl);
        },

        /**
         * Update hidden master select of variant change
         *
         * @param  {variant} variant - Currently selected variant
         */
        _updateMasterSelect: function(variant) {
            $(this.originalSelectorId, this.$container).val(variant.id);
        }
    });

    return Variants;
})();


/*================ MODULES ================*/
window.Drawers = (function() {
    var Drawer = function(id, position, options) {
        var defaults = {
            close: '.js-drawer-close',
            open: '.js-drawer-open-' + position,
            openClass: 'js-drawer-open',
            dirOpenClass: 'js-drawer-open-' + position
        };

        this.nodes = {
            $parent: $('body, html'),
            $page: $('.page-element'),
            $moved: $('.is-moved-by-drawer')
        };

        this.config = $.extend(defaults, options);
        this.position = position;

        this.$drawer = $('#' + id);
        this.$open = $(this.config.open);

        if (!this.$drawer.length) {
            return false;
        }

        this.drawerIsOpen = false;
        this.init();
    };

    Drawer.prototype.init = function() {
        this.$open.attr('aria-expanded', 'false');
        this.$open.on('click', $.proxy(this.open, this));
        this.$drawer.find(this.config.close).on('click', $.proxy(this.close, this));
    };

    Drawer.prototype.open = function(evt) {
        // Keep track if drawer was opened from a click, or called by another function
        var externalCall = false;

        // don't open an opened drawer
        if (this.drawerIsOpen) {
            return;
        }

        this.$open.addClass(this.config.openClass);

        // Prevent following href if link is clicked
        if (evt) {
            evt.preventDefault();
        } else {
            externalCall = true;
        }

        // Without this, the drawer opens, the click event bubbles up to $nodes.page
        // which closes the drawer.
        if (evt && evt.stopPropagation) {
            evt.stopPropagation();
            // save the source of the click, we'll focus to this on close
            this.$activeSource = $(evt.currentTarget);
        }

        if (this.drawerIsOpen && !externalCall) {
            return this.close();
        }

        // Add is-transitioning class to moved elements on open so drawer can have
        // transition for close animation
        this.nodes.$moved.addClass('is-transitioning');
        this.$drawer.prepareTransition();

        this.nodes.$parent.addClass(
            this.config.openClass + ' ' + this.config.dirOpenClass
        );
        this.drawerIsOpen = true;

        // Set focus on drawer
        slate.a11y.trapFocus({
            $container: this.$drawer,
            namespace: 'drawer_focus'
        });

        // Run function when draw opens if set
        if (
            this.config.onDrawerOpen &&
            typeof this.config.onDrawerOpen === 'function'
        ) {
            if (!externalCall) {
                this.config.onDrawerOpen();
            }
        }

        if (this.$activeSource && this.$activeSource.attr('aria-expanded')) {
            this.$activeSource.attr('aria-expanded', 'true');
        }

        this.bindEvents();
    };

    Drawer.prototype.close = function() {
        // don't close a closed drawer
        if (!this.drawerIsOpen) {
            return;
        }

        this.$open.removeClass(this.config.openClass);

        // deselect any focused form elements
        $(document.activeElement).trigger('blur');

        // Ensure closing transition is applied to moved elements, like the nav
        this.nodes.$moved.prepareTransition({ disableExisting: true });
        this.$drawer.prepareTransition({ disableExisting: true });

        this.nodes.$parent.removeClass(
            this.config.dirOpenClass + ' ' + this.config.openClass
        );

        this.drawerIsOpen = false;

        // Remove focus on drawer
        slate.a11y.removeTrapFocus({
            $container: this.$drawer,
            namespace: 'drawer_focus'
        });

        if (this.$activeSource && this.$activeSource.attr('aria-expanded')) {
            this.$activeSource.attr('aria-expanded', 'false');
        }

        this.unbindEvents();
    };

    Drawer.prototype.bindEvents = function() {
        // Lock scrolling on mobile
        this.nodes.$page.on('touchmove.drawer', function() {
            return false;
        });

        // Clicking out of drawer closes it
        this.nodes.$page.on(
            'click.drawer',
            $.proxy(function() {
                this.close();
                return false;
            }, this)
        );

        // Pressing escape closes drawer
        this.nodes.$parent.on(
            'keyup.drawer',
            $.proxy(function(evt) {
                if (evt.keyCode === 27) {
                    this.close();
                }
            }, this)
        );
    };

    Drawer.prototype.unbindEvents = function() {
        this.nodes.$page.off('.drawer');
        this.nodes.$parent.off('.drawer');
    };

    return Drawer;
})();

window.Modals = (function() {
    var Modal = function(id, name, options) {
        var defaults = {
            close: '.js-modal-close',
            open: '.js-modal-open-' + name,
            openClass: 'modal--is-active'
        };

        this.$modal = $('#' + id);

        if (!this.$modal.length) {
            return false;
        }

        this.nodes = {
            $body: $('body')
        };

        this.config = $.extend(defaults, options);

        this.modalIsOpen = false;
        this.$focusOnOpen = this.config.focusOnOpen ?
            $(this.config.focusOnOpen) :
            this.$modal;
        this.init();
    };

    Modal.prototype.init = function() {
        var $openBtn = $(this.config.open);

        // Add aria controls
        $openBtn.attr('aria-expanded', 'false');

        $(this.config.open).on('click', $.proxy(this.open, this));
        this.$modal.find(this.config.close).on('click', $.proxy(this.close, this));
    };

    Modal.prototype.open = function(evt) {
        // Keep track if modal was opened from a click, or called by another function
        var externalCall = false;

        // don't open an opened modal
        if (this.modalIsOpen) {
            return;
        }

        // Prevent following href if link is clicked
        if (evt) {
            evt.preventDefault();
        } else {
            externalCall = true;
        }

        // Without this, the modal opens, the click event bubbles up to $nodes.page
        // which closes the modal.
        if (evt && evt.stopPropagation) {
            evt.stopPropagation();
            // save the source of the click, we'll focus to this on close
            this.$activeSource = $(evt.currentTarget);
        }

        if (this.modalIsOpen && !externalCall) {
            return this.close();
        }

        this.$modal.prepareTransition().addClass(this.config.openClass);
        this.nodes.$body.addClass(this.config.openClass);

        this.modalIsOpen = true;

        // Set focus on modal
        slate.a11y.trapFocus({
            $container: this.$modal,
            namespace: 'modal_focus',
            $elementToFocus: this.$focusOnOpen
        });

        if (this.$activeSource && this.$activeSource.attr('aria-expanded')) {
            this.$activeSource.attr('aria-expanded', 'true');
        }

        this.bindEvents();
    };

    Modal.prototype.close = function() {
        // don't close a closed modal
        if (!this.modalIsOpen) {
            return;
        }

        // deselect any focused form elements
        $(document.activeElement).trigger('blur');

        this.$modal.prepareTransition().removeClass(this.config.openClass);
        this.nodes.$body.removeClass(this.config.openClass);

        this.modalIsOpen = false;

        // Remove focus on modal
        slate.a11y.removeTrapFocus({
            $container: this.$modal,
            namespace: 'modal_focus'
        });

        if (this.$activeSource && this.$activeSource.attr('aria-expanded')) {
            this.$activeSource.attr('aria-expanded', 'false').focus();
        }

        this.unbindEvents();
    };

    Modal.prototype.bindEvents = function() {
        // Pressing escape closes modal
        this.nodes.$body.on(
            'keyup.modal',
            $.proxy(function(evt) {
                if (evt.keyCode === 27) {
                    this.close();
                }
            }, this)
        );
    };

    Modal.prototype.unbindEvents = function() {
        this.nodes.$body.off('.modal');
    };

    return Modal;
})();

window.QtySelector = (function() {
    var QtySelector = function($el) {
        this.cache = {
            $body: $('body'),
            $subtotal: $('#CartSubtotal'),
            $discountTotal: $('#cartDiscountTotal'),
            $cartTable: $('.cart-table'),
            $cartTemplate: $('#CartProducts')
        };

        this.settings = {
            loadingClass: 'js-qty--is-loading',
            isCartTemplate: this.cache.$body.hasClass('template-cart'),
            // On the cart template, minimum is 0. Elsewhere min is 1
            minQty: this.cache.$body.hasClass('template-cart') ? 0 : 1
        };

        this.$el = $el;
        this.qtyUpdateTimeout;
        this.createInputs();
        this.bindEvents();
    };

    QtySelector.prototype.createInputs = function() {
        var $el = this.$el;

        var data = {
            value: $el.val(),
            key: $el.attr('id'),
            name: $el.attr('name'),
            line: $el.attr('data-line')
        };
        var source = $('#QuantityTemplate').html();
        var template = Handlebars.compile(source);

        this.$wrapper = $(template(data)).insertBefore($el);

        // Remove original number input
        $el.remove();
    };

    QtySelector.prototype.validateAvailability = function(line, quantity) {
        var product = theme.cartObject.items[line - 1]; // 0-based index in API
        var handle = product.handle; // needed for the ajax request
        var id = product.id; // needed to find right variant from ajax results

        var params = {
            type: 'GET',
            url: '/products/' + handle + '.js',
            dataType: 'json',
            success: $.proxy(function(cartProduct) {
                this.validateAvailabilityCallback(line, quantity, id, cartProduct);
            }, this)
        };

        $.ajax(params);
    };

    QtySelector.prototype.validateAvailabilityCallback = function(
        line,
        quantity,
        id,
        product
    ) {
        var quantityIsAvailable = true;

        // This returns all variants of a product.
        // Loop through them to get our desired one.
        for (var i = 0; i < product.variants.length; i++) {
            var variant = product.variants[i];
            if (variant.id === id) {
                break;
            }
        }

        // If the variant tracks inventory and does not sell when sold out
        // we can compare the requested with available quantity
        if (
            variant.inventory_management !== null &&
            variant.inventory_policy === 'deny'
        ) {
            if (variant.inventory_quantity < quantity) {

                // Set quantity to max amount available
                this.$wrapper.find('.js-qty__input').val(variant.inventory_quantity);

                quantityIsAvailable = false;
                this.$wrapper.removeClass(this.settings.loadingClass);
            }
        }

        if (quantityIsAvailable) {
            this.updateItemQuantity(line, quantity);
        }
    };

    QtySelector.prototype.validateQty = function(qty) {
        if (parseFloat(qty) === parseInt(qty, 10) && !isNaN(qty)) {
            // We have a valid number!
        } else {
            // Not a number. Default to 1.
            qty = 1;
        }
        return parseInt(qty, 10);
    };

    QtySelector.prototype.adjustQty = function(evt) {
        var $el = $(evt.currentTarget);
        var $input = $el.siblings('.js-qty__input');
        var qty = this.validateQty($input.val());
        var line = $input.attr('data-line');

        if ($el.hasClass('js-qty__adjust--minus')) {
            qty -= 1;
            if (qty <= this.settings.minQty) {
                qty = this.settings.minQty;
            }
        } else {
            qty += 1;
        }

        if (this.settings.isCartTemplate) {
            $el.parent().addClass(this.settings.loadingClass);
            this.updateCartItemPrice(line, qty);
        } else {
            $input.val(qty);
        }
    };

    QtySelector.prototype.bindEvents = function() {
        this.$wrapper
            .find('.js-qty__adjust')
            .on('click', $.proxy(this.adjustQty, this));

        // Select input text on click
        this.$wrapper.on('click', '.js-qty__input', function() {
            this.setSelectionRange(0, this.value.length);
        });

        // If the quantity changes on the cart template, update the price
        if (this.settings.isCartTemplate) {
            this.$wrapper.on(
                'change',
                '.js-qty__input',
                $.proxy(function(evt) {
                    var $input = $(evt.currentTarget);
                    var line = $input.attr('data-line');
                    var qty = this.validateQty($input.val());
                    $input.parent().addClass(this.settings.loadingClass);
                    this.updateCartItemPrice(line, qty);
                }, this)
            );
        }
    };

    QtySelector.prototype.updateCartItemPrice = function(line, qty) {
        // Update cart after short timeout so user doesn't create simultaneous ajax calls
        clearTimeout(this.qtyUpdateTimeout);
        this.qtyUpdateTimeout = setTimeout(
            $.proxy(function() {
                this.validateAvailability(line, qty);
            }, this),
            200
        );
    };

    QtySelector.prototype.updateItemQuantity = function(line, quantity) {
        var params = {
            type: 'POST',
            url: '/cart/change.js',
            data: 'quantity=' + quantity + '&line=' + line,
            dataType: 'json',
            success: $.proxy(function(cart) {
                this.updateCartItemCallback(cart);
            }, this)
        };

        $.ajax(params);
    };

    QtySelector.prototype.updateCartItemCallback = function(cart) {
        // Reload the page to show the empty cart if no items
        if (cart.item_count === 0) {
            location.reload();
            return;
        }

        // Update cart object
        theme.cartObject = cart;

        // Handlebars.js cart layout
        var data = {};
        var items = [];
        var item = {};
        var source = $('#CartProductTemplate').html();
        var template = Handlebars.compile(source);
        var prodImg;

        // Add each item to our handlebars.js data
        $.each(cart.items, function(index, cartItem) {
            /* Hack to get product image thumbnail
             *   - If image is not null
             *     - Remove file extension, add 240x240, and re-add extension
             *     - Create server relative link
             *   - A hard-coded url of no-image
             */

            if (cartItem.image === null) {
                prodImg =
                    '//cdn.shopify.com/s/assets/admin/no-image-medium-cc9732cb976dd349a0df1d39816fbcc7.gif';
            } else {
                prodImg = cartItem.image
                    .replace(/(\.[^.]*)$/, '_240x240$1')
                    .replace('http:', '');
            }

            if (cartItem.properties !== null) {
                $.each(cartItem.properties, function(key, value) {
                    if (key.charAt(0) === '_' || !value) {
                        delete cartItem.properties[key];
                    }
                });
            }

            // Create item's data object and add to 'items' array
            item = {
                key: cartItem.key,
                line: index + 1, // Shopify uses a 1+ index in the API
                url: cartItem.url,
                img: prodImg,
                name: cartItem.product_title,
                variation: cartItem.variant_title,
                properties: cartItem.properties,
                itemQty: cartItem.quantity,
                price: theme.Currency.formatMoney(cartItem.price, theme.moneyFormat),
                vendor: cartItem.vendor,
                linePrice: theme.Currency.formatMoney(
                    cartItem.line_price,
                    theme.moneyFormat
                ),
                originalLinePrice: theme.Currency.formatMoney(
                    cartItem.original_line_price,
                    theme.moneyFormat
                ),
                discounts: cartItem.discounts,
                discountsApplied: cartItem.line_price === cartItem.original_line_price ? false : true
            };

            items.push(item);
            theme.updateCurrencies();
        });

        // Gather all cart data and add to DOM
        data = {
            items: items
        };
        this.cache.$cartTemplate.empty().append(template(data));

        // Create new quantity selectors
        this.cache.$cartTable.find('input[type="number"]').each(function(i, el) {
            new QtySelector($(el));
        });

        // Update the cart subtotal
        this.cache.$subtotal.html(
            theme.Currency.formatMoney(cart.total_price, theme.moneyFormat)
        );

        // Update the cart total discounts
        if (cart.total_discount > 0) {
            this.cache.$discountTotal.html(
                theme.strings.totalCartDiscount.replace(
                    '[savings]',
                    theme.Currency.formatMoney(cart.total_discount, theme.moneyFormat)
                )
            );
        } else {
            this.cache.$discountTotal.empty();
        }

        theme.miniCart.updateElements();
        theme.updateCurrencies();
        // Set focus on cart table
        slate.a11y.pageLinkFocus(this.cache.$cartTable);
    };

    return QtySelector;
})();

/*
  Allow product to be added to cart via ajax with
  custom success and error responses.
*/
window.AjaxCart = (function() {
    var styleCart = $('.js-mini-cart').attr("data-cartmini");
    var cart = function($form) {
        this.cache = {
            $cartIconIndicator: $('.site-header__cart-indicator')
        };

        this.$form = $form;
        this.eventListeners();

        this.showNotice = false;
        if (this.$form.length) {
            this.showNotice = this.$form.hasClass('js-form--notice') ? true : false;
        }
    };

    cart.prototype.eventListeners = function() {
        if (this.$form.length) {
            this.$form.on('submit', $.proxy(this.addItemFromForm, this));
        }
    };

    cart.prototype.addItemFromForm = function(evt) {
        evt.preventDefault();

        var params = {
            type: 'POST',
            url: '/cart/add.js',
            data: this.$form.serialize(),
            dataType: 'json',
            success: $.proxy(function(lineItem) {
                //this.success(lineItem);
                window.location.href = '/cart';
            }, this),
            error: $.proxy(function(XMLHttpRequest, textStatus) {
                this.error(XMLHttpRequest, textStatus);
            }, this)
        };
        $.ajax(params);
    };

    cart.prototype.success = function(item) {
        theme.miniCart.updateElements();
        theme.miniCart.generateCart();
        if (styleCart != 'false') {
            if (this.showNotice) {
                var htmlVariant = item.variant_title !== null ? '<i>(' + item.variant_title + ')</i>' : '';
                var htmlAlert = '<div class="media mt-2 alert--cart"><a class="mr-3" href="/cart"><img class="lazyload" data-src="' + item.image + '"></a><div class="media-body align-self-center"><p class="m-0 font-weight-bold">' + item.product_title + ' x ' + item.quantity + '</p>' + htmlVariant + '<div><div>';
                theme.alert.new(theme.strings.addToCartSuccess, htmlAlert, 3000, 'notice');
            } else {
                theme.crosssell.showPopup(item);
            }
        }
    };

    // Error handling reference from Shopify.onError in api.jquery.js
    cart.prototype.error = function(XMLHttpRequest) {
        var data = JSON.parse(XMLHttpRequest.responseText);

        if (data.message) {
            theme.alert.new('', data.description, 3000, 'warning');
        }
    };

    return cart;
})();

/*================ TEMPLATES ================*/
theme.customerTemplates = (function() {
    function initEventListeners() {
        // Show reset password form
        $('#RecoverPassword').on('click', function(evt) {
            evt.preventDefault();
            toggleRecoverPasswordForm();
        });

        // Hide reset password form
        $('#HideRecoverPasswordLink').on('click', function(evt) {
            evt.preventDefault();
            toggleRecoverPasswordForm();
        });
    }

    /**
     *
     *  Show/Hide recover password form
     *
     */
    function toggleRecoverPasswordForm() {
        $('#RecoverPasswordForm').toggleClass('hide');
        $('#CustomerLoginForm').toggleClass('hide');
    }

    /**
     *
     *  Show reset password success message
     *
     */
    function resetPasswordSuccess() {
        // check if reset password form was successfully submited
        if (!$('.reset-password-success').length) {
            return;
        }

        // show success message
        $('#ResetSuccess').removeClass('hide');
    }

    /**
     *
     *  Show/hide customer address forms
     *
     */
    function customerAddressForm() {
        var $newAddressForm = $('#AddressNewForm');

        if (!$newAddressForm.length) {
            return;
        }

        // Initialize observers on address selectors, defined in shopify_common.js
        if (Shopify) {
            // eslint-disable-next-line no-new
            new Shopify.CountryProvinceSelector(
                'AddressCountryNew',
                'AddressProvinceNew', {
                    hideElement: 'AddressProvinceContainerNew'
                }
            );
        }

        // Initialize each edit form's country/province selector
        $('.address-country-option').each(function() {
            var formId = $(this).data('form-id');
            var countrySelector = 'AddressCountry_' + formId;
            var provinceSelector = 'AddressProvince_' + formId;
            var containerSelector = 'AddressProvinceContainer_' + formId;

            // eslint-disable-next-line no-new
            new Shopify.CountryProvinceSelector(countrySelector, provinceSelector, {
                hideElement: containerSelector
            });
        });

        // Toggle new/edit address forms
        $('.address-new-toggle').on('click', function() {
            $newAddressForm.toggleClass('hide');
        });

        $('.address-edit-toggle').on('click', function() {
            var formId = $(this).data('form-id');
            $('#EditAddress_' + formId).toggleClass('hide');
        });

        $('.address-delete').on('click', function() {
            var $el = $(this);
            var formId = $el.data('form-id');
            var confirmMessage = $el.data('confirm-message');

            // eslint-disable-next-line no-alert
            if (
                confirm(
                    confirmMessage || 'Are you sure you wish to delete this address?'
                )
            ) {
                Shopify.postLink('/account/addresses/' + formId, {
                    parameters: { _method: 'delete' }
                });
            }
        });
    }

    /**
     *
     *  Check URL for reset password hash
     *
     */
    function checkUrlHash() {
        var hash = window.location.hash;

        // Allow deep linking to recover password form
        if (hash === '#recover') {
            toggleRecoverPasswordForm();
        }
    }

    return {
        init: function() {
            checkUrlHash();
            initEventListeners();
            resetPasswordSuccess();
            customerAddressForm();
        }
    };
})();

/*================ SECTIONS ================*/
theme.HeaderSection = (function() {
    function Header() {
        theme.NavDrawer = new window.Drawers('NavDrawer', 'left');
    }

    return Header;
})();

theme.Product = (function() {
    var defaults = {
        smallBreakpoint: 750,
        productThumbIndex: 0,
        productThumbMax: 0,
        ajaxCart: false,
        stockSetting: false
    };

    function Product(container) {
        var $container = (this.$container = $(container));
        var sectionId = $container.attr('data-section-id');

        this.selectors = {
            originalSelectorId: '#ProductSelect-' + sectionId,
            modal: 'ProductModal',
            productZoomImage: '#ProductZoomImg',
            addToCart: '#AddToCart-' + sectionId,
            productPrice: '#ProductPrice-' + sectionId,
            comparePrice: '#ComparePrice-' + sectionId,
            addToCartText: '#AddToCartText-' + sectionId,
            SKU: '.js-variant-sku',
            productImageContainers: '.product__photo-container-' + sectionId,
            productImageWrappers: '.product__photo-wrapper-' + sectionId,
            productThumbContainers: '.product-single__thumbnail-item-' + sectionId,
            productThumbsWrapper: '.product-single__thumbnails-' + sectionId,
            productThumbs: '.product-single__thumbnail-' + sectionId,
            saleTag: '#ProductSaleTag-' + sectionId,
            productStock: '#ProductStock-' + sectionId,
            singleOptionSelector: '.single-option-selector-' + sectionId,
            shopifyPaymentButton: '.shopify-payment-button',
            availability: '.product-single__availability',
            hurrify: '.js-hurrify'
        };

        this.settings = $.extend({}, defaults, {
            sectionId: sectionId,
            ajaxCart: $container.data('ajax'),
            stockSetting: $container.data('stock'),
            enableHistoryState: $container.data('enable-history-state') || false,
            namespace: '.product-' + sectionId
        });

        // Stop parsing if we don't have the product json script tag
        if (!$('#ProductJson-' + sectionId).html()) {
            return;
        }

        this.productSingleObject = JSON.parse(
            $('#ProductJson-' + sectionId).html()
        );
        this.addVariantInfo();

        this.init();
    }

    Product.prototype = _.assignIn({}, Product.prototype, {
        init: function() {
            this._stringOverrides();
            this._initVariants();
            this._productZoomImage();
            this._productThumbSwitch();
            this._productThumbnailSlider();
            this._initQtySelector();

            if (this.settings.ajaxCart) {
                theme.AjaxCart = new window.AjaxCart(
                    $('#AddToCartForm-' + this.settings.sectionId)
                );
            }
        },

        _stringOverrides: function() {
            window.productStrings = window.productStrings || {};
            $.extend(theme.strings, window.productStrings);
        },

        addVariantInfo: function() {
            if (!this.productSingleObject || !this.settings.stockSetting) {
                return;
            }

            var variantInfo = JSON.parse(
                $('#VariantJson-' + this.settings.sectionId).html()
            );

            for (var i = 0; i < variantInfo.length; i++) {
                $.extend(this.productSingleObject.variants[i], variantInfo[i]);
            }
        },

        _initVariants: function() {
            var options = {
                $container: this.$container,
                enableHistoryState: this.settings.enableHistoryState,
                product: this.productSingleObject,
                singleOptionSelector: this.selectors.singleOptionSelector,
                originalSelectorId: this.selectors.originalSelectorId
            };

            // eslint-disable-next-line no-new
            this.variants = new slate.Variants(options);

            this.$container.on(
                'variantChange' + this.settings.namespace,
                this._updateAddToCartBtn.bind(this)
            );
            this.$container.on(
                'variantChange' + this.settings.namespace,
                this._updateStickyCart.bind(this)
            );
            this.$container.on(
                'variantPriceChange' + this.settings.namespace,
                this._updatePrice.bind(this)
            );
            this.$container.on(
                'variantSKUChange' + this.settings.namespace,
                this._updateSKU.bind(this)
            );
            this.$container.on(
                'variantImageChange' + this.settings.namespace,
                this._updateImages.bind(this)
            );
        },

        _updateStock: function(variant) {
            if (!this.settings.stockSetting) return;

            var $stock = $(this.selectors.productStock),
                $hurrify = $(this.selectors.hurrify);

            // If we don't track variant inventory, hide stock
            if (!variant || !variant.inventory_management) {
                $stock.addClass('hide');
                $hurrify.addClass('hide');
                return;
            }

            if (variant.inventory_quantity < 10 && variant.inventory_quantity > 0) {
                $stock
                    .html(
                        theme.strings.stockAvailable.replace(
                            '1',
                            variant.inventory_quantity
                        )
                    )
                    .removeClass('hide');
                $hurrify.removeClass('hide').find('.progress-bar').css('width', variant.inventory_quantity * 10 + '%');
                return;
            }

            if (variant.inventory_quantity <= 0 && variant.incoming) {
                $stock
                    .html(
                        theme.strings.willNotShipUntil.replace(
                            '[date]',
                            variant.next_incoming_date
                        )
                    )
                    .removeClass('hide');
                $hurrify.addClass('hide');
                return;
            }

            // If there's more than 10 available, hide stock
            $stock.addClass('hide');
            $hurrify.addClass('hide');
        },

        _updateIncomingInfo: function(variant) {
            if (!this.settings.stockSetting) return;

            var $stock = $(this.selectors.productStock);

            if (variant.incoming) {
                $stock
                    .html(
                        theme.strings.willBeInStockAfter.replace(
                            '[date]',
                            variant.next_incoming_date
                        )
                    )
                    .removeClass('hide');
                return;
            }

            // If there is no stock incoming, hide stock
            $stock.addClass('hide');
        },

        _updateAddToCartBtn: function(evt) {
            var variant = evt.variant;

            var cache = {
                $addToCart: $(this.selectors.addToCart),
                $addToCartText: $(this.selectors.addToCartText)
            };

            if (variant) {
                // Select a valid variant if available
                theme.noticeSoldout.init(variant);
                if (variant.available) {
                    // We have a valid product variant, so enable the submit button
                    cache.$addToCart.removeClass('btn--sold-out').prop('disabled', false);
                    cache.$addToCartText.html(theme.strings.addToCart);
                    $(this.selectors.shopifyPaymentButton, this.$container).show();
                    // Show how many items are left, if below 10
                    this._updateStock(variant);
                    //update availability - available
                    $(this.selectors.availability).find('span').text(theme.strings.available);
                } else {
                    // Variant is sold out, disable the submit button
                    cache.$addToCart.prop('disabled', true).addClass('btn--sold-out');
                    cache.$addToCartText.html(theme.strings.soldOut);
                    $(this.selectors.shopifyPaymentButton, this.$container).hide();
                    // Update when stock will be available
                    this._updateIncomingInfo(variant);
                    //update availability - soldout
                    $(this.selectors.availability).find('span').text(theme.strings.soldOut);
                }
            } else {
                cache.$addToCart.prop('disabled', true).removeClass('btn--sold-out');
                cache.$addToCartText.html(theme.strings.unavailable);
                //update availability - unavailable
                $(this.selectors.availability).find('span').text(theme.strings.unavailable);
                $(this.selectors.shopifyPaymentButton, this.$container).hide();
                // Hide stock display
                this._updateStock();
            }
        },

        _updatePrice: function(evt) {
            var variant = evt.variant;

            if (variant) {
                $(this.selectors.productPrice).html(
                    theme.Currency.formatMoney(variant.price, theme.moneyFormat)
                );

                // Update and show the product's compare price if necessary
                if (variant.compare_at_price > variant.price) {
                    $(this.selectors.comparePrice)
                        .html(
                            theme.Currency.formatMoney(
                                variant.compare_at_price,
                                theme.moneyFormat
                            )
                        )
                        .removeClass('hide');
                    $(this.selectors.saleTag).removeClass('hide');
                } else {
                    $(this.selectors.comparePrice).addClass('hide');
                    $(this.selectors.saleTag).addClass('hide');
                }

                theme.updateCurrencies();
            } else {
                $(this.selectors.comparePrice).addClass('hide');
            }
        },

        _updateSKU: function(evt) {
            var variant = evt.variant;

            if (variant) {
                $(this.selectors.SKU).html(variant.sku);
            }
        },

        _updateImages: function(evt) {
            var variant = evt.variant;

            if (variant && variant.featured_image) {
                var imageId = variant.featured_image.id;
                this.switchProductImage(imageId);
                this.setActiveThumbnail(imageId);
            }
        },
        _updateStickyCart: function(evt) {
            var variant = evt.variant,
                $stickyPrice = $('#js-sticky-price'),
                $stickyTitle = $('#js-sticky-title'),
                $stickyImage = $('#js-sticky-img'),
                $stickyButton = $('#js-sticky-btn');
            if (variant) {
                //update title
                $stickyTitle.html(' - ' + variant.title);
                //update price
                $stickyPrice.html(theme.Currency.formatMoney(variant.price, theme.moneyFormat));
                //update selectbox
                for (var i = 1; i <= 3; i++) {
                    var option = 'option' + i,
                        $selecBox = '#js-sticky-option-' + i;
                    if (variant[option] !== null) {
                        var valueOption = variant[option];
                        $($selecBox).val(valueOption);
                    }
                }
                //update button cart
                if (variant.available) {
                    $stickyButton.prop('disabled', false).removeClass('btn--sold-out');
                    $stickyButton.html(theme.strings.addToCart);
                } else {
                    $stickyButton.prop('disabled', true).addClass('btn--sold-out');
                    $stickyButton.html(theme.strings.soldOut);
                }
                //update image
                if (variant.featured_image) {
                    $stickyImage.attr('src', theme.Images.getSizedImageUrl(variant.featured_image.src, '200x'));
                }
            } else {
                //update title
                $stickyTitle.html(' - ' + theme.strings.unavailable);
                //update button cart
                $stickyButton.prop('disabled', true).removeClass('btn--sold-out');
                $stickyButton.html(theme.strings.unavailable);
            }
        },

        switchProductImage: function(imageId) {
            var $imageToShow = $(
                this.selectors.productImageContainers +
                "[data-image-id='" +
                imageId +
                "']",
                this.$container
            );
            var $imagesToHide = $(
                this.selectors.productImageContainers +
                ":not([data-image-id='" +
                imageId +
                "'])",
                this.$container
            );
            $imagesToHide.addClass('hide');
            $imageToShow.removeClass('hide');
            //Scroll to active
            topMenuHeight = $('.site-header').outerHeight();
            if (this.settings.sectionId === 'product-template-8') {
                $([document.documentElement, document.body]).animate({
                    scrollTop: $imageToShow.offset().top - topMenuHeight
                }, 500);
            }
        },

        setActiveThumbnail: function(imageId) {
            var $thumbnailToShow = $(
                this.selectors.productThumbContainers +
                "[data-image-id='" +
                imageId +
                "']",
                this.$container
            );
            var $thumbnailsToHide = $(
                this.selectors.productThumbContainers +
                ":not([data-image-id='" +
                imageId +
                "'])",
                this.$container
            );
            $thumbnailsToHide.removeClass('is-active');
            $thumbnailToShow.addClass('is-active');
            $thumbnailToShow.trigger('click');
            var $thumbnails = $(this.selectors.productThumbsWrapper, this.$container);

            // If there is a slick carousel, get the slide index, and position it into view with animation.
            if ($thumbnails.hasClass('slick-initialized')) {
                // eslint-disable-next-line shopify/jquery-dollar-sign-reference
                var currentActiveSlideIndex = $thumbnails.slick('slickCurrentSlide');
                var newActiveSlideIndex = parseInt(
                    $thumbnailToShow.attr('data-slick-index')
                );
                if (currentActiveSlideIndex !== newActiveSlideIndex) {
                    $thumbnails.slick('slickGoTo', newActiveSlideIndex, false);

                }
            }
        },

        _productZoomImage: function() {
            // The zoom image is only used on the product template, so return early
            // even if a featured product section is present.
            if (!$('.product-single ' + this.selectors.productImageContainers).length) {
                return;
            }

            var self = this;

            $(this.selectors.productImageWrappers).on(
                'click' + this.settings.namespace,
                function(evt) {
                    evt.preventDefault();
                    // Empty src before loadig new image to avoid awkward image swap
                    $(self.selectors.productZoomImage)
                        .attr('src', '')
                        .attr('src', $(this).attr('href'));
                }
            );

            this.ProductModal = new window.Modals(
                this.selectors.modal,
                'product-modal'
            );

            // Close modal if clicked, but not if the image is clicked
            this.ProductModal.$modal.on('click' + this.settings.namespace, function(
                evt
            ) {
                if (evt.target.nodeName !== 'IMG') {
                    self.ProductModal.close();
                }
            });
        },

        _productThumbSwitch: function() {
            if (!$(this.selectors.productThumbs).length) {
                return;
            }

            var self = this;

            $(this.selectors.productThumbs).on(
                'click' + this.settings.namespace,
                function(evt) {
                    evt.preventDefault();
                    var imageId = $(this)
                        .parent()
                        .data('image-id');
                    self.setActiveThumbnail(imageId);
                    self.switchProductImage(imageId);
                }
            );
            //trigger hover thumb
            // $(this.selectors.productThumbs).on('click',function(){
            //   $(this).trigger('click');
            // });
        },

        /*
          Thumbnail slider
         */
        _productThumbnailSlider: function() {
            var $productThumbsWrapper = $(this.selectors.productThumbsWrapper);
            var $productThumbs = $(this.selectors.productThumbs);
            if (!$productThumbs.length) {
                return;
            }

            if ($productThumbs.length > 1) {
                $productThumbsWrapper.on(
                    'init' + this.settings.namespace,
                    this._productSwipeInit.bind(this)
                );

                if (this.settings.sectionId === 'product-template-3' || this.settings.sectionId === 'product-template-4') {
                    $productThumbsWrapper.slick({
                        accessibility: false,
                        arrows: true,
                        dots: false,
                        infinite: false,
                        autoplay: false,
                        slidesToShow: 5,
                        slidesToScroll: 5,
                        vertical: true,
                        verticalSwiping: true,
                        responsive: [{
                            breakpoint: 992,
                            settings: {
                                vertical: false,
                                verticalSwiping: false,
                                slidesToShow: 4,
                                slidesToScroll: 4,
                                dots: false,
                            }
                        }]
                    }).css('opacity', '1');
                } else if (this.settings.sectionId === 'product-template-5') {
                    $productThumbsWrapper.slick({
                        accessibility: false,
                        arrows: true,
                        dots: false,
                        infinite: true,
                        autoplay: false,
                        slidesToShow: 2,
                        slidesToScroll: 1,
                        responsive: [{
                            breakpoint: 992,
                            settings: {
                                slidesToShow: 4,
                                slidesToScroll: 4,
                                dots: false,
                            }
                        }]
                    }).css('opacity', '1');
                } else if (this.settings.sectionId === 'product-template-7') {
                    $productThumbsWrapper.slick({
                        accessibility: false,
                        arrows: true,
                        dots: true,
                        infinite: true,
                        autoplay: false,
                        slidesToShow: 1,
                        slidesToScroll: 1,
                        responsive: [{
                            breakpoint: 992,
                            settings: {
                                slidesToShow: 1,
                                slidesToScroll: 1,
                                dots: false,
                                arrows: true,
                            }
                        }]
                    }).css('opacity', '1');
                } else if (this.settings.sectionId === 'product-template-8') {
                    var lastId,
                        topMenu = $(".product-single__thumbnails"),
                        topMenuHeight = $('.site-header').outerHeight() + 20,
                        // All list items
                        menuItems = topMenu.find(".product-single__thumbnail");


                    if ($(window).width() > 767) {
                        menuItems.click(function(e) {
                            var findid = $(this).attr('href');
                            offsetTop = $(findid).offset().top - topMenuHeight + 1;
                            $('html, body').stop().animate({
                                scrollTop: offsetTop
                            }, 200);
                            return false;
                        });
                        // Anchors corresponding to menu items
                        scrollItems = menuItems.map(function() {
                            var item = $($(this).attr('href'));
                            if (item.length) { return item; }
                        });

                        $(window).scroll(function() {
                            // Get container scroll position
                            var fromTop = $(this).scrollTop() + topMenuHeight;
                            // Get id of current scroll item
                            var cur = scrollItems.map(function() {
                                if ($(this).offset().top < fromTop)
                                    return this;
                            });
                            // Get the id of the current element
                            cur = cur[cur.length - 1];
                            var id = cur && cur.length ? cur[0].id : "";

                            if (lastId !== id) {
                                lastId = id;
                                // Set/remove active class
                                menuItems
                                    .parent().removeClass("is-active")
                                    .end().filter("[href='#" + id + "']").parent().addClass("is-active");
                            }
                        });
                    } else {
                        menuItems.click(function(e) {
                            var findid = $(this).attr('href');
                            offsetTop = $(findid).offset().top;
                            $('html, body').stop().animate({
                                scrollTop: offsetTop
                            });
                            return false;
                        });
                    }

                    $productThumbsWrapper.slick({
                        accessibility: false,
                        arrows: true,
                        dots: false,
                        infinite: false,
                        autoplay: false,
                        slidesToShow: 5,
                        slidesToScroll: 1,
                        vertical: true,
                        verticalSwiping: true,
                        responsive: [{
                            breakpoint: 992,
                            settings: {
                                vertical: false,
                                verticalSwiping: false,
                                slidesToShow: 4,
                                slidesToScroll: 4,
                                dots: true,
                            }
                        }]
                    }).css('opacity', '1');
                } else {
                    $productThumbsWrapper.slick({
                        accessibility: false,
                        arrows: true,
                        dots: false,
                        infinite: false,
                        autoplay: false,
                        slidesToShow: 4,
                        slidesToScroll: 4
                    }).css('opacity', '1');
                }

                // Show highlighted thumbnail by repositioning slider
                $productThumbsWrapper.slick(
                    'slickGoTo',
                    $productThumbsWrapper.find('.is-active').attr('data-slick-index'),
                    true
                );
            }
        },

        _productSwipeInit: function(evt, obj) {
            // Slider is initialized. Setup custom swipe events
            this.settings.productThumbIndex = obj.currentSlide;
            this.settings.productThumbMax = obj.slideCount - 1; // we need the 0-based index

            var self = this;

            $(this.selectors.productImageWrappers).on(
                'swipeleft swiperight',
                function(event) {
                    if (event.type === 'swipeleft') {
                        self._goToNextThumbnail();
                    }

                    if (event.type === 'swiperight') {
                        self._goToPrevThumbnail();
                    }

                    // Trigger click on newly requested thumbnail
                    $(
                            '.product-single__thumbnail-item[data-slick-index="' +
                            self.settings.productThumbIndex +
                            '"]'
                        )
                        .find('.product-single__thumbnail')
                        .trigger('click');

                }
            );
        },
        _goToNextThumbnail: function() {
            this.settings.productThumbIndex++;

            if (this.settings.productThumbIndex > this.settings.productThumbMax) {
                this.settings.productThumbIndex = 0;
            }

            $(this.selectors.productThumbsWrapper).slick(
                'slickGoTo',
                this.settings.productThumbIndex,
                true
            );
        },

        _goToPrevThumbnail: function() {
            this.settings.productThumbIndex--;

            if (this.settings.productThumbIndex < 0) {
                this.settings.productThumbIndex = this.settings.productThumbMax;
            }

            $(this.selectors.productThumbsWrapper).slick(
                'slickGoTo',
                this.settings.productThumbIndex,
                true
            );
        },

        _initQtySelector: function() {
            this.$container.find('.product-form__quantity').each(function(i, el) {
                // eslint-disable-next-line no-new
                new QtySelector($(el));
            });
        },

        onUnload: function() {
            $(this.selectors.productImageWrappers).off(this.settings.namespace);
            $(this.selectors.productThumbs).off(this.settings.namespace);
            $(this.selectors.productThumbs).slick('unslick');
            if (this.ProductModal) {
                this.ProductModal.$modal.off(this.settings.namespace);
            }
        }
    });

    return Product;
})();

theme.Slideshow = (function() {
    this.$slideshow = null;
    var classes = {
        slideshow: 'slideshow',
        slickActiveMobile: 'slick-active-mobile',
        controlsHover: 'slideshow__controls--hover',
        isPaused: 'is-paused'
    };

    var selectors = {
        section: '.shopify-section',
        wrapper: '#SlideshowWrapper-',
        slides: '.slideshow__slide',
        textWrapperMobile: '.slideshow__text-wrap--mobile',
        textContentMobile: '.slideshow__text-content--mobile',
        controls: '.slideshow__controls',
        dots: '.slick-dots',
        arrowLeft: '.slideshow__arrow-left',
        arrowRight: '.slideshow__arrow-right'
    };

    function slideshow(el, sectionId) {
        var $slideshow = (this.$slideshow = $(el));
        this.adaptHeight = this.$slideshow.data('adapt-height');
        this.$wrapper = this.$slideshow.closest(selectors.wrapper + sectionId);
        this.$section = this.$wrapper.closest(selectors.section);
        this.$controls = this.$wrapper.find(selectors.controls);
        this.$textWrapperMobile = this.$section.find(selectors.textWrapperMobile);
        this.autorotate = this.$slideshow.data('autorotate');
        var autoplaySpeed = this.$slideshow.data('speed');
        var loadSlideA11yString = this.$slideshow.data('slide-nav-a11y');

        this.settings = {
            rtl: theme.rtl,
            accessibility: true,
            arrows: true,
            dots: true,
            fade: (theme.rtl ? false : true),
            draggable: true,
            touchThreshold: 20,
            autoplay: this.autorotate,
            autoplaySpeed: autoplaySpeed
        };

        this.$slideshow.on('beforeChange', beforeChange.bind(this));
        this.$slideshow.on('init', slideshowA11ySetup.bind(this));

        // Add class to style mobile dots & show the correct text content for the
        // first slide on mobile when the slideshow initialises
        this.$slideshow.on(
            'init',
            function() {
                this.$mobileDots
                    .find('li:first-of-type')
                    .addClass(classes.slickActiveMobile);
                this.showMobileText(0);
            }.bind(this)
        );

        if (this.adaptHeight) {
            this.setSlideshowHeight();
            $(window).resize($.debounce(50, this.setSlideshowHeight.bind(this)));
        }

        this.$slideshow.slick(this.settings);

        // This can't be called when the slick 'init' event fires due to how slick
        // adds a11y features.
        slideshowPostInitA11ySetup.bind(this)();
    }

    function slideshowA11ySetup(event, obj) {
        var $slider = obj.$slider;
        var $list = obj.$list;
        this.$dots = this.$section.find(selectors.dots);
        this.$mobileDots = this.$dots.eq(1);

        // Remove default Slick aria-live attr until slider is focused
        $list.removeAttr('aria-live');

        //     this.$wrapper.on('keyup', keyboardNavigation.bind(this));
        //     this.$controls.on('keyup', keyboardNavigation.bind(this));
        //     this.$textWrapperMobile.on('keyup', keyboardNavigation.bind(this));

        // When an element in the slider is focused
        // pause slideshow and set aria-live.
        this.$wrapper
            .on(
                'focusin',
                function(evt) {
                    if (!this.$wrapper.has(evt.target).length) {
                        return;
                    }

                    $list.attr('aria-live', 'polite');
                    if (this.autorotate) {
                        $slider.slick('slickPause');
                    }
                }.bind(this)
            )
            .on(
                'focusout',
                function(evt) {
                    if (!this.$wrapper.has(evt.target).length) {
                        return;
                    }

                    $list.removeAttr('aria-live');
                }.bind(this)
            );

        // Add arrow key support when focused
        if (this.$dots) {
            this.$dots
                .find('a')
                .each(function() {
                    var $dot = $(this);
                    $dot.on('click keyup', function(evt) {
                        if (
                            evt.type === 'keyup' &&
                            evt.which !== slate.utils.keyboardKeys.ENTER
                        )
                            return;

                        evt.preventDefault();

                        var slideNumber = $(evt.target).data('slide-number');

                        $slider.attr('tabindex', -1).slick('slickGoTo', slideNumber);

                        if (evt.type === 'keyup') {
                            $slider.focus();
                        }
                    });
                })
                .eq(0)
                .attr('aria-current', 'true');
        }

        this.$controls
            .on('focusin', highlightControls.bind(this))
            .on('focusout', unhighlightControls.bind(this));
    }

    function slideshowPostInitA11ySetup() {
        var $slides = this.$slideshow.find(selectors.slides);

        $slides.removeAttr('role').removeAttr('aria-labelledby');
        this.$dots
            .removeAttr('role')
            .find('li')
            .removeAttr('role')
            .removeAttr('aria-selected')
            .each(function() {
                var $dot = $(this);
                var ariaControls = $dot.attr('aria-controls');
                $dot
                    .removeAttr('aria-controls')
                    .find('a')
                    .attr('aria-controls', ariaControls);
            });
    }

    function beforeChange(event, slick, currentSlide, nextSlide) {
        var $dotLinks = this.$dots.find('a');
        var $mobileDotLinks = this.$mobileDots.find('li');

        $dotLinks
            .removeAttr('aria-current')
            .eq(nextSlide)
            .attr('aria-current', 'true');

        $mobileDotLinks
            .removeClass(classes.slickActiveMobile)
            .eq(nextSlide)
            .addClass(classes.slickActiveMobile);
        this.showMobileText(nextSlide);
    }

    //   function keyboardNavigation() {
    //     if (event.keyCode === slate.utils.keyboardKeys.LEFTARROW) {
    //       this.$slideshow.slick('slickPrev');
    //     }
    //     if (event.keyCode === slate.utils.keyboardKeys.RIGHTARROW) {
    //       this.$slideshow.slick('slickNext');
    //     }
    //   }

    function highlightControls() {
        this.$controls.addClass(classes.controlsHover);
    }

    function unhighlightControls() {
        this.$controls.removeClass(classes.controlsHover);
    }

    slideshow.prototype.setSlideshowHeight = function() {
        var minAspectRatio = this.$slideshow.data('min-aspect-ratio');
        this.$slideshow.height($(document).width() / minAspectRatio);
    };

    slideshow.prototype.showMobileText = function(slideIndex) {
        var $allTextContent = this.$textWrapperMobile.find(
            selectors.textContentMobile
        );
        var currentTextContentSelector =
            selectors.textContentMobile + '-' + slideIndex;
        var $currentTextContent = this.$textWrapperMobile.find(
            currentTextContentSelector
        );
        if (!$currentTextContent.length &&
            this.$slideshow.find(selectors.slides).length === 1
        ) {
            this.$textWrapperMobile.hide();
        } else {
            this.$textWrapperMobile.show();
        }
        $allTextContent.hide();
        $currentTextContent.show();
    };

    function getSlideshowId($el) {
        return '#Slideshow-' + $el.data('id');
    }

    return slideshow;
})();

theme.slideshows = {};

theme.SlideshowSection = (function() {
    function SlideshowSection(container) {
        var $container = (this.$container = $(container));
        var sectionId = $container.attr('data-section-id');
        var slideshow = (this.slideshow = '#Slideshow-' + sectionId);

        theme.slideshows[slideshow] = new theme.Slideshow(slideshow, sectionId);
    }

    return SlideshowSection;
})();

theme.SlideshowSection.prototype = _.assignIn({},
    theme.SlideshowSection.prototype, {
        onUnload: function() {
            delete theme.slideshows[this.slideshow];
        },

        onBlockSelect: function(evt) {
            var $slideshow = $(this.slideshow);
            var adaptHeight = $slideshow.data('adapt-height');

            if (adaptHeight) {
                theme.slideshows[this.slideshow].setSlideshowHeight();
            }

            // Ignore the cloned version
            var $slide = $(
                '.slideshow__slide--' + evt.detail.blockId + ':not(.slick-cloned)'
            );
            var slideIndex = $slide.data('slick-index');

            // Go to selected slide, pause auto-rotate
            $slideshow.slick('slickGoTo', slideIndex).slick('slickPause');
        },

        onBlockDeselect: function() {
            // Resume auto-rotate
            $(this.slideshow).slick('slickPlay');
        }
    }
);

theme.slideshows = {};

theme.Cart = (function() {
    var selectors = {
        cartNote: '#CartSpecialInstructions',
        cartQtyInput: '.cart__quantity',
        cartNoCookiesClass: 'cart--no-cookies'
    };

    function Cart(container) {
        var $container = (this.$container = $(container));
        var sectionId = $container.attr('data-section-id');

        theme.cartObject = JSON.parse($('#CartJson-' + sectionId).html());

        this.init($container);
    }

    Cart.prototype = _.assignIn({}, Cart.prototype, {
        init: function($container) {
            this._initQtySelector();
            this._initCartNote();

            if (!this._cookiesEnabled()) {
                $container.addClass(selectors.cartNoCookiesClass);
            }
        },

        _initQtySelector: function() {
            $(selectors.cartQtyInput).each(function(i, el) {
                // eslint-disable-next-line no-new
                new QtySelector($(el));
            });
        },

        _initCartNote: function() {
            if (!$(selectors.cartNote).length) {
                return;
            }

            var $el = $(selectors.cartNote);
            var noteText;
            var params;
            var noteOffset = $el[0].offsetHeight - $el[0].clientHeight;

            // Auto grow the cart note if text fills it up
            $el.on('keyup input', function() {
                $(this)
                    .css('height', 'auto')
                    .css('height', $el[0].scrollHeight + noteOffset);
            });

            // Save the cart note via ajax. A safeguard in case
            // a user decides to leave the page before clicking 'Update Cart'
            $el.on(
                'change',
                $.proxy(function() {
                    noteText = $el.val();
                    params = {
                        type: 'POST',
                        url: '/cart/update.js',
                        data: 'note=' + this._attributeToString(noteText),
                        dataType: 'json'
                    };
                    $.ajax(params);
                }, this)
            );
        },

        _attributeToString: function(attr) {
            if (typeof attr !== 'string') {
                attr = String(attr);
                if (attr === 'undefined') {
                    attr = '';
                }
            }
            return $.trim(attr);
        },

        _cookiesEnabled: function() {
            var cookieEnabled = navigator.cookieEnabled;

            if (!cookieEnabled) {
                document.cookie = 'testcookie';
                cookieEnabled = document.cookie.indexOf('testcookie') !== -1;
            }
            return cookieEnabled;
        }
    });

    return Cart;
})();

// Instagrams
theme.Instagrams = (function() {
    function Instagrams(container) {
        this.$container = $(container).on('init', this._a11y.bind(this));
        //console.log(this.$container);
        this.settings = {
            style: this.$container.data('style'),
            accesstoken: this.$container.data('accesstoken'),
            userid: this.$container.data('userid'),
            limit: this.$container.data('limit'),
            resolution: this.$container.data('resolution'),
            target: this.$container.attr('id'),
            rows: this.$container.data('rows'),

            slidesToShow: this.$container.data('slidestoshow') || 1,
            infinite: this.$container.data('infinite') || false,
            arrows: this.$container.data('arrows') || false,
            draggable: this.$container.data('draggable') || false,
            dots: this.$container.data('dots') || false,
        }
        this.settings.slidesToShow1200 = (this.settings.slidesToShow - 1) > 1 ? (this.settings.slidesToShow - 1) : 1;
        this.settings.slidesToShow992 = (this.settings.slidesToShow - 2) > 1 ? (this.settings.slidesToShow - 2) : 1;
        this.settings.slidesToShow768 = (this.settings.slidesToShow - 3) > 1 ? (this.settings.slidesToShow - 3) : 1;
        this.settings.slidesToShow480 = 2;

        var _self = this;
        var $instagramSelector = $('#' + this.settings.target);
        if (this.settings.style === 'grid') {
            var afterInstagram = function() {} // blank function
        } else if (this.settings.style === 'carousel') {
            var afterInstagram = function() {
                $instagramSelector.slick({
                    slidesToShow: _self.settings.slidesToShow,
                    slidesToScroll: _self.settings.slidesToShow,
                    arrows: _self.settings.arrows,
                    dots: _self.settings.dots,
                    draggable: _self.settings.draggable,
                    infinite: _self.settings.infinite,
                    rows: _self.settings.rows,
                    responsive: [{
                            breakpoint: 1200,
                            settings: {
                                slidesToShow: _self.settings.slidesToShow1200,
                                slidesToScroll: _self.settings.slidesToShow1200,
                            }
                        },
                        {
                            breakpoint: 992,
                            settings: {
                                slidesToShow: _self.settings.slidesToShow992,
                                slidesToScroll: _self.settings.slidesToShow992,
                            }
                        },
                        {
                            breakpoint: 768,
                            settings: {
                                slidesToShow: _self.settings.slidesToShow768,
                                slidesToScroll: _self.settings.slidesToShow768,
                            }
                        },
                        {
                            breakpoint: 480,
                            settings: {
                                slidesToShow: _self.settings.slidesToShow480,
                                slidesToScroll: _self.settings.slidesToShow480,
                            }
                        }
                    ]
                })
            }
        }

        var feed = new Instafeed({
            get: 'user',
            target: this.settings.target,
            userId: this.settings.userid,
            accessToken: this.settings.accesstoken,
            limit: this.settings.limit,
            resolution: this.settings.resolution,
            template: '<div class="col hv-image-brightness"><a class="instagram-item" href="{{link}}" target="_blank" id="{{id}}"><img alt="instagram image" class="transition lazyload" data-src="{{image}}" /></a></div>',
            after: afterInstagram
        });

        feed.run();
    }

    Instagrams.prototype = _.assignIn({}, Instagrams.prototype, {
        _a11y: function(event, obj) {
            var $list = obj.$list;
            var $wrapper = this.$container.parent();

            // Remove default Slick aria-live attr until slider is focused
            $list.removeAttr('aria-live');

            // When an element in the slider is focused set aria-live
            $wrapper.on('focusin', function(evt) {
                if ($wrapper.has(evt.target).length) {
                    $list.attr('aria-live', 'polite');
                }
            });

            // Remove aria-live
            $wrapper.on('focusout', function(evt) {
                if ($wrapper.has(evt.target).length) {
                    $list.removeAttr('aria-live');
                }
            });
        }
    });

    return Instagrams;
})();

// Slick carousel
theme.slickCarousel = (function() {
    function Carousels(container) {
        this.$container = $(container).on('init', this._a11y.bind(this));
        this.settings = {
            rows: this.$container.data('rows') || 1,
            slidesToShow: this.$container.data('slidestoshow') || 1,
            slidesToScroll: this.$container.data('slidestoscroll') || 1,
            infinite: this.$container.data('infinite') || false,
            arrows: this.$container.data('arrows') || false,
            dots: this.$container.data('dots') || false,
            autoplay: this.$container.data('autoplay') || false,
            draggable: this.$container.data('draggable') || false,
            accessibility: this.$container.data('accessibility') || true,
        }
        this.settings.slidesToShow1200 = (this.settings.slidesToShow - 1) > 1 ? (this.settings.slidesToShow - 1) : 1;
        this.settings.slidesToShow992 = (this.settings.slidesToShow - 2) > 1 ? (this.settings.slidesToShow - 2) : 1;
        this.settings.slidesToShow768 = (this.settings.slidesToShow - 3) > 1 ? (this.settings.slidesToShow - 3) : 1;
        this.settings.slidesToShow480 = (this.settings.slidesToShow - 4) > 1 ? (this.settings.slidesToShow - 4) : 1;
        this.settings.slidesToScroll1200 = (this.settings.slidesToScroll - 1) > 1 ? (this.settings.slidesToScroll - 1) : 1;
        this.settings.slidesToScroll992 = (this.settings.slidesToScroll - 2) > 1 ? (this.settings.slidesToScroll - 2) : 1;
        this.settings.slidesToScroll768 = (this.settings.slidesToScroll - 3) > 1 ? (this.settings.slidesToScroll - 3) : 1;
        this.settings.slidesToScroll480 = (this.settings.slidesToScroll - 4) > 1 ? (this.settings.slidesToScroll - 4) : 1;
        this.$container.slick({
            rtl: theme.rtl,
            rows: this.settings.rows,
            slidesToShow: this.settings.slidesToShow,
            slidesToScroll: this.settings.slidesToScroll,
            arrows: this.settings.arrows,
            dots: this.settings.dots,
            autoplay: this.settings.autoplay,
            accessibility: this.settings.accessibility,
            draggable: this.settings.draggable,
            infinite: this.settings.infinite,
            adaptiveHeight: true,
            responsive: [{
                    breakpoint: 1200,
                    settings: {
                        slidesToShow: this.settings.slidesToShow1200,
                        slidesToScroll: this.settings.slidesToScroll1200
                    }
                },
                {
                    breakpoint: 992,
                    settings: {
                        slidesToShow: this.settings.slidesToShow992,
                        slidesToScroll: this.settings.slidesToScroll992
                    }
                },
                {
                    breakpoint: 768,
                    settings: {
                        slidesToShow: this.settings.slidesToShow768,
                        slidesToScroll: this.settings.slidesToScroll768
                    }
                },
                {
                    breakpoint: 480,
                    settings: {
                        slidesToShow: 1,
                        slidesToScroll: this.settings.slidesToScroll480
                    }
                }
            ]
        })
    }

    Carousels.prototype = _.assignIn({}, Carousels.prototype, {
        _a11y: function(event, obj) {
            var $list = obj.$list;
            var $wrapper = this.$container.parent();

            // Remove default Slick aria-live attr until slider is focused
            $list.removeAttr('aria-live');

            // When an element in the slider is focused set aria-live
            $wrapper.on('focusin', function(evt) {
                if ($wrapper.has(evt.target).length) {
                    $list.attr('aria-live', 'polite');
                }
            });

            // Remove aria-live
            $wrapper.on('focusout', function(evt) {
                if ($wrapper.has(evt.target).length) {
                    $list.removeAttr('aria-live');
                }
            });
        },

        _goToSlide: function(slideIndex) {
            this.$container.slick('slickGoTo', slideIndex);
        },

        onUnload: function() {
            delete this.$container;
        },

        onBlockSelect: function(evt) {
            // Ignore the cloned version
            var $slide = $(
                '.carousel__slide-wrapper--' + evt.detail.blockId + ':not(.slick-cloned)'
            );
            var slideIndex = $slide.data('slick-index');

            // Go to selected slide, pause autoplay
            this._goToSlide(slideIndex);

        }
    });

    return Carousels;
})()

// Productlists
theme.Productlists = (function() {
    function Productlists(container) {
        this.$container = $(container).on('init', this._a11y.bind(this));
        this.settings = {
            slidesToShow: this.$container.data('slidestoshow') || 1,
            rows: this.$container.data('rows') || 1,
            arrows: this.$container.data('arrows') || false,
            dots: this.$container.data('dots') || false,
            draggable: this.$container.data('draggable') || false,
            infinite: this.$container.data('infinite') || false,
        }
        this.settings.slidesToShow1200 = (this.settings.slidesToShow - 1) > 1 ? (this.settings.slidesToShow - 1) : 1;
        this.settings.slidesToShow992 = (this.settings.slidesToShow - 2) > 1 ? (this.settings.slidesToShow - 2) : 1;
        this.settings.slidesToShow768 = (this.settings.slidesToShow - 3) > 1 ? (this.settings.slidesToShow - 3) : 1;
        this.settings.slidesToShow480 = 2;
        this.$container.slick({
            rtl: theme.rtl,
            accessibility: true,
            slidesToShow: this.settings.slidesToShow,
            slidesToScroll: this.settings.slidesToShow,
            rows: this.settings.rows,
            arrows: this.settings.arrows,
            dots: this.settings.dots,
            infinite: this.settings.infinite,
            draggable: this.settings.draggable,
            responsive: [{
                    breakpoint: 1200,
                    settings: {
                        slidesToShow: this.settings.slidesToShow1200,
                        slidesToScroll: this.settings.slidesToShow1200
                    }
                },
                {
                    breakpoint: 992,
                    settings: {
                        slidesToShow: this.settings.slidesToShow992,
                        slidesToScroll: this.settings.slidesToShow992
                    }
                },
                {
                    breakpoint: 768,
                    settings: {
                        slidesToShow: this.settings.slidesToShow768,
                        slidesToScroll: this.settings.slidesToShow768
                    }
                },
                {
                    breakpoint: 480,
                    settings: {
                        slidesToShow: this.settings.slidesToShow480,
                        slidesToScroll: this.settings.slidesToShow480
                    }
                }
            ]
        }).css('opacity', '1');
    }

    Productlists.prototype = _.assignIn({}, Productlists.prototype, {
        _a11y: function(event, obj) {
            var $list = obj.$list;
            var $wrapper = this.$container.parent();

            // Remove default Slick aria-live attr until slider is focused
            $list.removeAttr('aria-live');

            // When an element in the slider is focused set aria-live
            $wrapper.on('focusin', function(evt) {
                if ($wrapper.has(evt.target).length) {
                    $list.attr('aria-live', 'polite');
                }
            });

            // Remove aria-live
            $wrapper.on('focusout', function(evt) {
                if ($wrapper.has(evt.target).length) {
                    $list.removeAttr('aria-live');
                }
            });
        },

        _goToSlide: function(slideIndex) {
            this.$container.slick('slickGoTo', slideIndex);
        },

        onUnload: function() {
            delete this.$container;
        }
    });

    return Productlists;
})();

// Producttabs
theme.Producttabs = (function() {
    function Producttabs(container) {
        var _self = this; // avoid conflict
        this.$container = $(container).on('init', this._a11y.bind(this));
        this.slickWrap = '.prdtab-content';
        this.settings = {
            slidesToShow: this.$container.data('slidestoshow') || 1,
            arrows: this.$container.data('arrows') || false,
            rows: this.$container.data('rows') || 1,
            dots: this.$container.data('dots') || false,
            draggable: this.$container.data('draggable') || false,
            infinite: this.$container.data('infinite') || false,
        }
        this.settings.slidesToShow1200 = (this.settings.slidesToShow - 1) > 1 ? (this.settings.slidesToShow - 1) : 1;
        this.settings.slidesToShow992 = (this.settings.slidesToShow - 2) > 1 ? (this.settings.slidesToShow - 2) : 1;
        this.settings.slidesToShow768 = (this.settings.slidesToShow - 3) > 1 ? (this.settings.slidesToShow - 3) : 1;
        this.settings.slidesToShow480 = 2;

        this._initSlick();
        this.$container.find('a[data-toggle="tab"]').on("shown.bs.tab", function(e) {
            _self._unSlick();
            _self._initSlick();
            theme.tooltip.load();
        })
    }

    Producttabs.prototype = _.assignIn({}, Producttabs.prototype, {
        _a11y: function(event, obj) {
            var $list = obj.$list;
            var $wrapper = this.$container.parent();

            // Remove default Slick aria-live attr until slider is focused
            $list.removeAttr('aria-live');

            // When an element in the slider is focused set aria-live
            $wrapper.on('focusin', function(evt) {
                if ($wrapper.has(evt.target).length) {
                    $list.attr('aria-live', 'polite');
                }
            });

            // Remove aria-live
            $wrapper.on('focusout', function(evt) {
                if ($wrapper.has(evt.target).length) {
                    $list.removeAttr('aria-live');
                }
            });
        },

        _getSliderSettings: function() {
            return {
                rtl: theme.rtl,
                accessibility: true,
                slidesToShow: this.settings.slidesToShow,
                slidesToScroll: this.settings.slidesToShow,
                arrows: this.settings.arrows,
                rows: this.settings.rows,
                dots: this.settings.dots,
                infinite: this.settings.infinite,
                draggable: this.settings.draggable,
                responsive: [{
                        breakpoint: 1200,
                        settings: {
                            slidesToShow: this.settings.slidesToShow1200,
                            slidesToScroll: this.settings.slidesToShow1200
                        }
                    },
                    {
                        breakpoint: 992,
                        settings: {
                            slidesToShow: this.settings.slidesToShow992,
                            slidesToScroll: this.settings.slidesToShow992
                        }
                    },
                    {
                        breakpoint: 768,
                        settings: {
                            slidesToShow: this.settings.slidesToShow768,
                            slidesToScroll: this.settings.slidesToShow768
                        }
                    },
                    {
                        breakpoint: 480,
                        settings: {
                            slidesToShow: this.settings.slidesToShow480,
                            slidesToScroll: this.settings.slidesToShow480
                        }
                    }
                ]
            }
        },

        _initSlick: function() {
            this.$container.find(this.slickWrap).slick(this._getSliderSettings()).css('opacity', '1');
        },

        _unSlick: function() {
            this.$container.find(this.slickWrap).slick('unslick');
        },

        onUnload: function() {
            delete this.$container;
        },

        onSelect: function() {
            this._unSlick();
            this._initSlick();
        },

        onBlockSelect: function(evt) {
            var navItem = $('.nav-link-' + evt.detail.blockId);
            navItem.tab('show');
            this._unSlick();
            this._initSlick();
        }
    });

    return Producttabs;
})();

theme.Video = (function() {
    var promiseYoutubeAPI;
    var promiseVimeoAPI;

    var youtube = {
        promiseAPI: function() {
            if (!promiseYoutubeAPI) {
                var tag = document.createElement('script');

                tag.src = 'https://www.youtube.com/iframe_api';
                var firstScriptTag = document.getElementsByTagName('script')[0];
                firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

                promiseYoutubeAPI = $.Deferred(function(defer) {
                    window.onYouTubeIframeAPIReady = defer.resolve;

                    setTimeout(function() {
                        defer.reject('Request for YouTube API timed out after 30 seconds.');
                    }, 30000);
                });
            }

            return promiseYoutubeAPI;
        },
        promisePlayer: function(id, options) {
            return this.promiseAPI().then(function() {
                return $.Deferred(function(defer) {
                    if (typeof window.YT === 'undefined') {
                        defer.reject(
                            "We're sorry, something went wrong. The YouTube API has not loaded correctly."
                        );
                    }

                    /* eslint-disable no-undef */
                    var player = new YT.Player(id, options); // global YT variable injected by YouTube API

                    player.addEventListener('onReady', function() {
                        defer.resolve(player);
                    });

                    setTimeout(function() {
                        defer.reject(
                            'Request for YouTube player has timed out after 30 seconds.'
                        );
                    }, 30000);
                });
            });
        }
    };

    var vimeo = {
        promiseAPI: function() {
            if (!promiseVimeoAPI) {
                promiseVimeoAPI = $.Deferred(function(defer) {
                    var tag = document.createElement('script');
                    tag.src = 'https://player.vimeo.com/api/player.js';
                    tag.onload = tag.onreadystatechange = function() {
                        if (!this.readyState || this.readyState === 'complete') {
                            defer.resolve();
                        }
                    };

                    var firstScriptTag = document.getElementsByTagName('script')[0];
                    firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

                    setTimeout(function() {
                        defer.reject('Request for Vimeo API timed out after 30 seconds.');
                    }, 30000);
                });
            }

            return promiseVimeoAPI;
        },

        promisePlayer: function(id, options) {
            return this.promiseAPI().then(function() {
                return $.Deferred(function(defer) {
                    if (typeof window.Vimeo === 'undefined') {
                        defer.reject(
                            "We're sorry, something went wrong. The Vimeo API has not loaded correctly."
                        );
                    }

                    var player = new window.Vimeo.Player(id, options);

                    setTimeout(function() {
                        defer.reject(
                            'Request for Vimeo player has timed out after 30 seconds.'
                        );
                    }, 30000);

                    player.ready().then(function() {
                        defer.resolve(player);
                    });
                });
            });
        }
    };

    var selectors = {
        loadPlayerButton: '.video-section__load-player-button',
        closePlayerButton: '.video-section__player-close',
        playerContainer: '.video-section__player',
        cover: '.video-section__cover',
        errorMessage: '.video-section__error',
        bodyOverlay: '.video-section__body-overlay',
        body: 'body'
    };
    var classes = {
        playerLoading: 'video-section--loading',
        playerLoaded: 'video-section--loaded',
        playerError: 'video-section--error',
        videoPlaying: 'video-playing'
    };

    function Video(container) {
        this.$container = $(container);
        var sectionId = this.$container.attr('data-section-id');
        this.namespace = '.' + sectionId;
        this.onLoad();
    }

    Video.prototype = _.assignIn({}, Video.prototype, {
        onLoad: function() {
            this.$container
                .on('click', selectors.loadPlayerButton, this._loadPlayer.bind(this))
                .on('click', selectors.closePlayerButton, this._closePlayer.bind(this))
                .on('click', selectors.bodyOverlay, this._closePlayer.bind(this));
        },

        _loadPlayer: function() {
            var $container = this.$container;
            var $playerContainer = $(selectors.playerContainer, $container);
            var playerType = this.$container.attr('data-video-type');

            var promiseVideoPlayer;

            if (playerType === 'youtube') {
                promiseVideoPlayer = this._loadYoutubePlayer($playerContainer[0]);
            } else if (playerType === 'vimeo') {
                promiseVideoPlayer = this._loadVimeoPlayer($playerContainer[0]);
            }

            return promiseVideoPlayer
                .then(this._onPlayerLoadReady.bind(this))
                .fail(this._onPlayerLoadError.bind(this));
        },

        _loadYoutubePlayer: function(container) {
            return youtube
                .promisePlayer(container, {
                    videoId: this.$container.attr('data-video-id'),
                    ratio: 16 / 9,
                    playerVars: {
                        modestbranding: 1,
                        autoplay: 1,
                        showinfo: 0,
                        rel: 0
                    }
                })
                .then(
                    function(player) {
                        this.player = player;
                    }.bind(this)
                );
        },

        _loadVimeoPlayer: function(container) {
            return vimeo
                .promisePlayer(container, {
                    id: this.$container.attr('data-video-id')
                })
                .then(
                    function(player) {
                        this.player = player;
                        this.player.play();
                    }.bind(this)
                );
        },

        _onPlayerLoadReady: function() {
            $(selectors.closePlayerButton, this.$container)
                .show()
                .focus();
            $(selectors.cover, this.$container).addClass(classes.playerLoaded);
            this.$container.addClass(classes.playerLoaded);

            this._setScrollPositionValues();

            $(selectors.body).addClass(classes.videoPlaying);

            $(document).on('keyup' + this.namespace, this._closeOnEscape.bind(this));
            $(window).on(
                'resize' + this.namespace,
                this._setScrollPositionValues.bind(this)
            );
            slate.a11y.trapFocus({
                $container: this.$container,
                namespace: this.namespace
            });
        },

        _onPlayerLoadError: function(err) {
            this.$container.addClass(classes.playerError);
            $(selectors.errorMessage, this.$container).text(err);
        },

        _closeOnEscape: function(evt) {
            if (evt.keyCode !== 27) {
                return;
            }

            this._closePlayer();
            $(selectors.loadPlayerButton, this.$container).focus();
        },

        _onScroll: function() {
            var scrollTop = $(window).scrollTop();

            if (
                scrollTop > this.videoTop + 0.25 * this.videoHeight ||
                scrollTop + this.windowHeight <
                this.videoBottom - 0.25 * this.videoHeight
            ) {
                // Debounce DOM edits to the next frame with requestAnimationFrame
                requestAnimationFrame(this._closePlayer.bind(this));
            }
        },

        _setScrollPositionValues: function() {
            this.videoHeight = this.$container.outerHeight(true);
            this.videoTop = this.$container.offset().top;
            this.videoBottom = this.videoTop + this.videoHeight;
            this.windowHeight = $(window).innerHeight();
        },

        _closePlayer: function() {
            $(selectors.body).removeClass(classes.videoPlaying);
            $(selectors.cover, this.$container).removeClass(classes.playerLoaded);
            this.$container.removeClass(classes.playerLoaded);
            $(selectors.closePlayerButton, this.$container).hide();

            slate.a11y.removeTrapFocus({
                $container: this.$container,
                namespace: this.namespace
            });

            if (typeof this.player.destroy === 'function') {
                this.player.destroy();
            } else if (typeof this.player.unload === 'function') {
                this.player.unload();
            }

            $(document).off(this.namespace);
            $(window).off(this.namespace);
        }
    });

    return Video;
})();

theme.CollectionsList = (function() {
    function CollectionsList(container) {
        var $container = (this.$container = $(container));
        var stretchImage = $container.is('[data-stretch-image]');

        // Early return if 'secondary image layout' is enabled
        if (stretchImage) return;

        var namespace = (this.namespace = '.' + $container.attr('data-section-id'));
        var self = this;

        self._collectionListFix();
        $(window).on(
            'resize' + namespace,
            $.debounce(250, function() {
                self._collectionListFix();
            })
        );
    }

    CollectionsList.prototype = _.assignIn({}, CollectionsList.prototype, {
        onUnload: function() {
            $(window).off(this.namespace);
        },

        _collectionListFix: function() {
            var numberRows = this.$container.find('.grid').data('number-rows');
            var $featureCards = this.$container.find('.featured-card');

            // We can exit if 'Use secondary image layout' is enabled
            if ($featureCards.is('[data-stretch-image]')) return;

            // Go through each of the rows
            for (var i = 0; i < numberRows; i++) {
                var maxWrapperHeight = 0;
                var maxHeaderHeight = 0;
                var $currentRow = $featureCards.filter(
                    "[data-row-number='" + (i + 1) + "']"
                );
                var $cardHeaders = $currentRow.find('.featured-card__header');

                // Find the max heights for each row
                $currentRow.each(function() {
                    var $cardTitle = $(this).find('.featured-card__title');
                    var $cardAction = $(this).find('.featured-card__action');
                    var $cardImageWrapper = $(this).find('.featured-card__image-wrapper');
                    var headerHeight =
                        $cardTitle.outerHeight() + $cardAction.outerHeight() + 65;
                    var wrapperHeight = $cardImageWrapper.outerHeight();
                    if (headerHeight > maxHeaderHeight) {
                        maxHeaderHeight = headerHeight;
                    }
                    if (wrapperHeight > maxWrapperHeight) {
                        maxWrapperHeight = wrapperHeight;
                    }
                });

                // Set the heights of the headers and cards for this row with padding
                $cardHeaders.outerHeight(maxHeaderHeight);
                $currentRow.height(maxWrapperHeight + maxHeaderHeight + 40);
            }
        }
    });

    return CollectionsList;
})();

theme.ParrallaxImage = (function() {
    function ParrallaxImage(container) {
        this.container = container;
        this.sectionId = $(container).attr('data-section-id');
        this.namespace = 'parallax-' + this.sectionId;
        var images = document.getElementsByClassName('thumbnail' + this.sectionId);
        new simpleParallax(images, {
            scale: 1.5,
            delay: .6,
        });
    }

    ParrallaxImage.prototype = $.extend({}, ParrallaxImage.prototype, {
        onUnload: function(evt) {
            var instance = new simpleParallax(images);
            instance.destroy();
            delete theme.ParrallaxImage[this.namespace];
        }
    });

    return ParrallaxImage;
})();

theme.init = function() {
    theme.customerTemplates.init();
    slate.rte.wrapTable();
    slate.rte.iframeReset();

    // Common a11y fixes
    slate.a11y.pageLinkFocus($(window.location.hash));

    $('.in-page-link').on('click', function(evt) {
        slate.a11y.pageLinkFocus($(evt.currentTarget.hash));
    });

    $('a[href="#"]').on('click', function(evt) {
        evt.preventDefault();
    });


    //scroll animation
    AOS.init({
        startEvent: 'DOMContentLoaded',
        offset: 30, // offset (in px) from the original trigger point
        delay: 0, // values from 0 to 3000, with step 50ms
        duration: 1000,
        once: true
    });
    window.addEventListener('load', function() {
        AOS.refresh();
    });


    // Sections
    var sections = new theme.Sections();
    sections.register('header', theme.HeaderSection);
    sections.register('product', theme.Product);
    sections.register('slideshow-section', theme.SlideshowSection);
    sections.register('cart', theme.Cart);
    sections.register('instagrams', theme.Instagrams);
    sections.register('masonries', theme.Masonry);
    sections.register('productlist', theme.Productlists);
    sections.register('producttab', theme.Producttabs);
    sections.register('slickCarousels', theme.slickCarousel);
    sections.register('video', theme.Video);
    sections.register('collections-list', theme.CollectionsList);
    sections.register('parallax-image', theme.ParrallaxImage);
    sections.register('bgcollection', theme.Bgcollection);

    // Standalone modules
    $(window).on('load', theme.articleImages);
    theme.passwordModalInit();
};

theme.articleImages = function() {
    var $indentedRteImages = $('.rte--indented-images');
    if (!$indentedRteImages.length) {
        return;
    }

    $indentedRteImages.find('img').each(function(i, el) {
        var $el = $(el);
        var attr = $el.attr('style');

        // Check if undefined or float: none
        if (!attr || attr === 'float: none;') {
            // Add class to parent paragraph tag if image is wider than container
            if ($el.width() >= $indentedRteImages.width()) {
                $el.parent('p').addClass('rte__image-indent');
            }
        }
    });
};

theme.passwordModalInit = function() {
    var $loginModal = $('#LoginModal');
    if (!$loginModal.length) {
        return;
    }

    // Initialize modal
    theme.PasswordModal = new window.Modals('LoginModal', 'login-modal', {
        focusOnOpen: '#Password'
    });

    // Open modal if errors exist
    if ($loginModal.find('.errors').length) {
        theme.PasswordModal.open();
    }
};

// CSS var ponyfill
theme.cssVar = (function() {
    cssVars();
})()

// Ajax search https://gist.github.com/awojtczyk/53d74c8af5f893841f33979b0cdcd6fe
theme.ajaxSearch = (function() {
    var $inputSearch = '.js-ajaxsearch',
        $resultsList = '.search-results',
        $input = $($inputSearch).find('input[name="q"]'),
        $currentAjaxRequest,
        $displayProducts = 6;

    $($inputSearch).css('position', 'relative').each(function() {
        $input.attr('autocomplete', 'off').bind('keyup change', function() {
            var term = $(this).val(),
                form = $(this).closest('form'),
                searchURL = '/search?type=product&q=*' + term + '*';
            if (term.length > 2 && term !== $(this).attr('data-old-term')) {
                $(this).attr('data-old-term', term);
                if ($currentAjaxRequest !== undefined) $currentAjaxRequest.abort();
                $currentAjaxRequest = $.getJSON(searchURL + '&view=json', function(data) {
                    $($resultsList).empty();

                    if (data.results_count === 0) {
                        $($resultsList).html('<p class="text-center">' + theme.strings.ajaxSearchNoResult + '</p>')
                    } else {
                        $.each(data.results, function(index, item) {
                            if (index < $displayProducts) {
                                var itemPrice = theme.Currency.formatMoney(item.price, theme.moneyFormat);
                                var link = $('<a class="d-inline-flex ' + index + '"></a>')
                                    .attr('href', item.url)
                                    .append('<span class="image"><img src="' + item.thumbnail + '" /></span>')
                                    .append('<div class="meta"><p class="title">' + item.title + '</p>' + itemPrice + '</div>')
                                    .wrap('<div class="ajax-search-item"></div>');
                                $($resultsList).append(link.parent());
                                theme.updateCurrencies();
                            }
                        });
                        if (data.results_count > $displayProducts) {
                            $($resultsList).append('<a class="btn btn--full" href="' + searchURL + '">' + theme.strings.ajaxSearchViewAll + ' (' + data.results_count + ')</a>');
                        }
                    }
                    $($resultsList).addClass('active').fadeIn(200);
                });
            }
        });
    });

    //escape when click somethings
    $(document).click(function(event) {
        var target = event.target;
        if (!$(target).is($inputSearch) && !$(target).parents().is($inputSearch)) {
            $($resultsList).slideUp(300);
        }
    });
})();

// Quickview https://github.com/kellyvaughn/quickview-for-shopify/blob/master/quickview.js.liquid
theme.quickview = (function() {
    var product_handle = '',
        quickviewButtonClass = '.js-btn-quickview',
        quickviewId = '#jsQuickview',
        quickviewOption = '#jsQuickview select',
        quickviewThumb = '#qv-product-images',
        quickviewAddCartButton = '.qv-add-button',
        quickviewPrice = '.qv-product-price',
        quickviewComparePrice = '.qv-product-compare-price';

    // 1. Show quickview
    $(document).on('click', quickviewButtonClass, function() {
        var quickviewAvaible = $(this).attr("data-pavailable");
        product_handle = $(this).data('handle');
        //ResetQuickview
        $(quickviewId).removeClass().addClass('modal fade');
        $(quickviewThumb).removeClass().empty();
        $('.qv-product-options').empty();

        //Pushdata
        $(quickviewId).addClass(product_handle).data('handle', product_handle);
        jQuery.getJSON('/products/' + product_handle + '.js', function(product) {
            var title = product.title;
            var type = product.type;
            var vendor = product.vendor;
            var price = 0;
            var compare_price = 0;
            var desc = product.description.slice(0, 90);
            var images = product.images;
            var variants = product.variants;
            var options = product.options;
            var url = '/products/' + product_handle;
            $('.qv-product-title').text(title);
            $('.qv-product-type').text(type);
            $('.qv-product-description').html(desc);
            $('.qv-view-product').attr('href', url);
            $('.qv-view-type').text(type);
            $('.qv-view-vendor').text(vendor)
            if (quickviewAvaible == 'true') {
                $(quickviewAddCartButton).prop('disabled', false).html(theme.strings.addToCart);
            } else {
                $(quickviewAddCartButton).prop('disabled', true).html(theme.strings.soldOut);
            }
            $(product.variants).each(function(i, variants) {
                if (variants.sku != null) {
                    $('.qv-sku').addClass("show").removeClass("hide");
                    $('.qv-view-sku').text(product.variants[0].sku);
                } else {
                    $('.qv-sku').addClass("hide").removeClass("show");
                }

            });
            var imageCount = $(images).length;
            $(images).each(function(i, image) {
                image_embed = '<div><img src="' + image + '"></div>';
                image_embed = image_embed.replace('.jpg', '_800x.jpg').replace('.png', '_800x.png');
                $(quickviewThumb).append(image_embed);
            });
            $(quickviewThumb).slick({
                rtl: theme.rtl,
                'dots': true,
                'arrows': true,
                'respondTo': 'min',
                'useTransform': true
            }).css('opacity', '1');

            if (product.variants[0].option1 !== "Default Title") {
                $(options).each(function(i, option) {
                    var name = option.name;
                    var opt = name.replace(/ /g, '-').toLowerCase();
                    var selectClass = '.option.' + opt;
                    $('.qv-product-options').append('<div class="option-selection ' + opt + '"><span class="option text-uppercase font-weight-bold text-body">' + option.name + '</span><select class="option-' + i + ' option ' + opt + '"></select></div>');
                    $(option.values).each(function(i, value) {
                        $('.option.' + opt).append($('<option>', {
                            value: value,
                            text: value
                        }));
                    });
                });
            }
            $(product.variants).each(function(i, v) {
                if (v.inventory_quantity == 0) {
                    return true
                } else {
                    price = theme.Currency.formatMoney(v.price, theme.moneyFormat);
                    compare_price = theme.Currency.formatMoney(v.compare_at_price, theme.moneyFormat);
                    $(quickviewPrice).html(price);
                    if (v.compare_at_price !== null) {
                        $(quickviewComparePrice).html(compare_price).show();
                    } else {
                        $(quickviewComparePrice).hide();
                    }
                    theme.updateCurrencies();
                    $('select.option-0').val(v.option1);
                    $('select.option-1').val(v.option2);
                    $('select.option-2').val(v.option3);
                    return false
                }
            });
        });
        //addCartQuickview
    });
    // 2. Add to cart
    $(document).on('click', quickviewAddCartButton, function() {
        product_handle = $(quickviewId).data('handle');
        var qty = $('.qv-quantity').val(),
            selectedOptions = '',
            var_id = '';

        function processCart() {
            jQuery.post('/cart/add.js', {
                    quantity: qty,
                    id: var_id
                }, null, "json").done(function(item) {
                    var htmlVariant = item.variant_title !== null ? '<i>(' + item.variant_title + ')</i>' : '';
                    var styleCart = $('.js-mini-cart').attr("data-cartmini");
                    if (styleCart != 'true') {
                        var htmlAlert = '<div class="media mt-2 alert--cart"><a class="mr-3" href="/cart"><img class="lazyload" data-src="' + item.image + '"></a><div class="media-body align-self-center"><p class="m-0 font-weight-bold">' + item.product_title + ' x ' + item.quantity + '</p>' + htmlVariant + '<div><div>';
                        theme.alert.new(theme.strings.addToCartSuccess, htmlAlert, 3000, 'notice');
                    }
                    theme.miniCart.updateElements();
                    theme.miniCart.generateCart();
                })
                .fail(function($xhr) {
                    var data = $xhr.responseJSON;
                    theme.alert.new('', data.description, 3000, 'warning');
                });
        }
        $(quickviewOption).each(function(i) {
            if (selectedOptions == '') {
                selectedOptions = $(this).val();
            } else {
                selectedOptions = selectedOptions + ' / ' + $(this).val();
            }
        });
        jQuery.getJSON('/products/' + product_handle + '.js', function(product) {
            if (product.variants.length === 1) {
                var_id = product.variants[0].id;
            } else {
                $(product.variants).each(function(i, v) {
                    if (v.title == selectedOptions) {
                        var_id = v.id;
                    }
                });
            }
            processCart();
        });
    });
    // 3. Select variants
    $(document).on('change', quickviewOption, function() {
        var selectedOptions = '';
        $(quickviewOption).each(function(i) {
            if (selectedOptions == '') {
                selectedOptions = $(this).val();
            } else {
                selectedOptions = selectedOptions + ' / ' + $(this).val();
            }
        });
        jQuery.getJSON('/products/' + product_handle + '.js', function(product) {
            $(product.variants).each(function(i, v) {
                if (v.title == selectedOptions) {
                    if (v.featured_image !== null) {
                        var iSlick = v.featured_image.position - 1;
                        $(quickviewThumb).slick('slickGoTo', iSlick);
                    }
                    var price = theme.Currency.formatMoney(v.price, theme.moneyFormat);
                    var compare_price = theme.Currency.formatMoney(v.compare_at_price, theme.moneyFormat);
                    $(quickviewPrice).html(price);
                    $(quickviewComparePrice).html(compare_price);
                    if (v.sku != null) {
                        $('.qv-sku').addClass("show").removeClass("hide");
                        $('.qv-view-sku').text(v.sku);
                    } else {
                        $('.qv-sku').addClass("hide").removeClass("show");
                    }
                    if (v.compare_at_price !== null) {
                        $(quickviewComparePrice).html(compare_price).show();
                    } else {
                        $(quickviewComparePrice).hide();
                    }
                    theme.updateCurrencies();
                    if (v.inventory_management === null) {
                        $(quickviewAddCartButton).prop('disabled', false).val(theme.strings.addToCart);
                    } else {
                        if (v.inventory_quantity < 1) {
                            $(quickviewAddCartButton).prop('disabled', true).val(theme.strings.soldOut);
                        } else {
                            $(quickviewAddCartButton).prop('disabled', false).val(theme.strings.addToCart);
                        }
                    }
                }
            });
        });
    });
})()

//Button add to cart (in grid item)
theme.addCartButton = (function() {
    var buttonClass = '.js-grid-cart';
    $(document).on('click', buttonClass, function() {
        var $this = $(this);
        var id = $this.data('id');
        $this.addClass('is-loading');
        Shopify.addItem(id, 1, function(item) {
            location.href = "/cart";
            var htmlVariant = item.variant_title !== null ? '<i>(' + item.variant_title + ')</i>' : '';
            var styleCart = $('.js-mini-cart').attr("data-cartmini");
            if (styleCart != 'true') {
                var htmlAlert = '<div class="media mt-2 alert--cart"><a class="mr-3" href="/cart"><img class="lazyload" data-src="' + item.image + '"></a><div class="media-body align-self-center"><p class="m-0 font-weight-bold">' + item.product_title + ' x ' + item.quantity + '</p>' + htmlVariant + '<div><div>';
            }
            theme.miniCart.updateElements();
            theme.miniCart.generateCart();
            setTimeout(function() {
                styleCart != 'true' ? theme.alert.new(theme.strings.addToCartSuccess, htmlAlert, 3000, 'notice') : '';
                $this.removeClass('is-loading');
            }, 1000);
        });
    })
})()

// Button add to cart (in grid item)
//theme.addCartButton = (function(){
//  var buttonClass = '.js-grid-cart';
//  $(document).on('click',buttonClass,function(){
//    var $this = $(this);
//    var id = $this.data('id');
//    $this.addClass('is-loading');
//    Shopify.addItem(id,1,function(item){
//      var htmlVariant = item.variant_title !== null ? '<i>('+item.variant_title+')</i>' : '';
//      var styleCart = $('.js-mini-cart').attr("data-cartmini");
//        if(styleCart != 'true'){
//          var htmlAlert = '<div class="media mt-2 alert--cart"><a class="mr-3" href="/cart"><img class="lazyload" data-src="'+item.image+'"></a><div class="media-body align-self-center"><p class="m-0 font-weight-bold">'+item.product_title+' x '+ item.quantity +'</p>'+htmlVariant+'<div><div>';
//        }
//      theme.miniCart.updateElements();
//      theme.miniCart.generateCart();
//      setTimeout(function() {
//        styleCart != 'true' ? theme.alert.new(theme.strings.addToCartSuccess,htmlAlert,3000,'notice'): '';
//        $this.removeClass('is-loading');
//      }, 1000);
//    });
// })
//})()

// Multi currencies 
if (theme.enableCurrencies) {
    // Can be 'money_format' or 'money_with_currency_format'
    Currency.format = 'money_format';
    var shopCurrency = Shopify.currency.active;
    var cookieCurrency = Currency.cookie.read();
    // Fix for customer account pages 
    jQuery('span.money span.money').each(function() {
        jQuery(this).parent('span.money').removeClass('money');
    });
    // Add precalculated shop currency to data attribute 
    jQuery('span.money').each(function() {
        jQuery(this).attr('data-currency-' + Shopify.currency.active, jQuery(this).html());
    });
    // Select all your currencies buttons.
    var buttons = jQuery('#currencies a'),
        currentCurrencies = jQuery('.pre-currencies');
    // When the page loads.
    if (cookieCurrency == null || cookieCurrency == shopCurrency) {
        Currency.currentCurrency = shopCurrency;
    } else {
        Currency.currentCurrency = cookieCurrency;
        Currency.convertAll(shopCurrency, cookieCurrency);
        buttons.removeClass('selected');
        jQuery('#currencies a[data-currency=' + cookieCurrency + ']').addClass('selected');
        var htmlCurrently = jQuery('#currencies a[data-currency=' + cookieCurrency + ']').html();
        currentCurrencies.html(htmlCurrently);
    }
    buttons.click(function() {
        buttons.removeClass('selected');
        jQuery(this).addClass('selected');
        var newCurrency = jQuery(this).attr('data-currency');
        var htmlCurrently = jQuery(this).html();
        currentCurrencies.html(htmlCurrently);
        Currency.convertAll(Currency.currentCurrency, newCurrency);
    });
    // For product options.
    var original_selectCallback = window.selectCallback;
    var selectCallback = function(variant, selector) {
        original_selectCallback(variant, selector);
        Currency.convertAll(shopCurrency, jQuery('#currencies a.selected').attr('data-currency'));
    };
}
theme.updateCurrencies = function() {
    Currency.convertAll(shopCurrency, jQuery('#currencies a.selected').attr('data-currency'));
}



// Free shipping
theme.freeShipping = (function() {
    var $freeShippingClass = $('.js-free-shipping'),
        $freeShippingTextClass = $('.js-free-shipping-text'),
        $free_fisrt = $freeShippingClass.attr('data-start'),
        $free_end = $freeShippingClass.attr('data-end')
    minOrderValue = parseInt($freeShippingClass.data('value')) || 0,
        $percentClass = $('.js-free-shipping .progress-bar');

    function generate(cart) {
        var priceCart = cart.total_price;
        if (priceCart >= minOrderValue) {
            $percentClass.css('width', '100%').removeClass('progress-bar-striped bg-primary');
            $freeShippingTextClass.text(theme.strings.freeShipping)
        } else {
            let percent = priceCart / minOrderValue * 100;
            let left = Shopify.formatMoney((minOrderValue - priceCart), theme.moneyFormat);
            $percentClass.css('width', percent + '%').addClass('progress-bar-striped primary');
            $freeShippingTextClass.html($free_fisrt + ' ' + left + ' ' + $free_end);
            theme.updateCurrencies();
        }
    }

    Shopify.getCart(function(cart) {
        generate(cart);
    });

    return {
        load: generate
    }
})()

// Shipping time - https://github.com/phstc/jquery-dateFormat
theme.shippingTime = (function() {
    var $shippingTime = $('.js-shipping-time'),
        shippingTime = $shippingTime.data('time') || '',
        now = new Date(),
        restHour = 23 - now.getHours(),
        restMinute = 59 - now.getMinutes();
    if (shippingTime !== '') {
        var nextTime = new Date(now.getTime() + shippingTime * 86400000),
            formatTime = $.format.date(nextTime, "ddd, dd MMMM yyyy"),
            htmlShipping = 'Order in the next <b>' + restHour + '</b> hours <b>' + restMinute + '</b> minutes to get it by <b>' + formatTime + '</b>. ';
        $shippingTime.html(htmlShipping);
    }
})()

// Infinite scroll - https://github.com/Elkfox/Ajaxinate/blob/master/dist/ajaxinate.min.js
theme.infiniteScroll = (function() {
    function initInfiniteScroll() {
        if ($('.AjaxinateLoop').length === 0) {
            return;
        } else {
            var endlessScroll = new Ajaxinate({
                loadingText: '<div class="text-center"><div class="' + theme.loadingClass + '" role="status"></div></div>',
                callback: function() {
                    theme.wishlist.load();
                    theme.compare.load();
                    theme.countdown.load();
                    theme.priceRange.load();
                    theme.tooltip.load();
                    theme.collectionView.triggerView();
                    theme.swatchCard2.load();
                }
            });
        }
    }

    // Infinite scroll in other page (blog, list-collection)
    function initOtherPages() {
        var otherPages = new Ajaxinate({
            loadingText: '<div class="text-center"><div class="' + theme.loadingClass + '" role="status"></div></div>',
            container: '.js-pagination-content',
            pagination: '.js-pagination'
        });
    }

    document.addEventListener("DOMContentLoaded", function() {
        initInfiniteScroll();
        initOtherPages();
    });

    return {
        load: initInfiniteScroll
    }
})()

// Scroll to fixed
theme.scrollToFixed = (function() {
    var window_width = $(window).width();

    if (window_width < 768) {
        $(".js-stick-parent").trigger("sticky_kit:detach");
    } else {
        make_sticky();
    }
    $(window).resize(function() {

        window_width = $(window).width();

        if (window_width < 768) {
            $(".js-stick-parent").trigger("sticky_kit:detach");
        } else {
            make_sticky();
        }
    });

    function make_sticky() {
        $('.js-stick-parent').stick_in_parent();
    }

})()


theme.headersidebar = (function() {
    $('#dismiss, .overlaysidebar').on('click', function() {
        // hide sidebar
        $('#sidebar').removeClass('active');
        // hide overlay
        $('.overlaysidebar').removeClass('active');
    });

    $('#sidebarCollapse').on('click', function() {
        // open sidebar
        $('#sidebar').addClass('active');
        // fade in the overlay
        $('.overlaysidebar').addClass('active');
        $('.collapse.in').toggleClass('in');
        $('a[aria-expanded=true]').attr('aria-expanded', 'false');
    });
})()

// Wishlist
theme.wishlist = (function() {
    var wishlistButtonClass = '.js-btn-wishlist',
        wishlistRemoveButtonClass = '.js-remove-wishlist',
        $wishlistCount = $('.js-wishlist-count'),
        $wishlistContainer = $('.js-wishlist-content'),
        wishlistObject = JSON.parse(localStorage.getItem('localWishlist')) || [],
        wishlistPageUrl = $('.js-wishlist-link').attr('href'),
        loadNoResult = function() {
            // $wishlistContainer.html('<div class="col text-center"><div class="alert alert-warning d-inline-block">' + theme.strings.wishlistNoResult + '</div></div>');
        };

    function updateWishlist(self) {
        var productHandle = $(self).data('handle'),
            allSimilarProduct = $(wishlistButtonClass + '[data-handle="' + productHandle + '"]');
        var isAdded = $.inArray(productHandle, wishlistObject) !== -1 ? true : false;
        if (isAdded) {
            // go to wishlist page
            window.location.href = wishlistPageUrl;
        } else {
            wishlistObject.push(productHandle);
            allSimilarProduct.fadeOut('slow').fadeIn('fast').html(theme.strings.wishlistIconAdded + theme.strings.wishlistTextAdded);
            //change tooltip
            allSimilarProduct.attr('data-original-title', theme.strings.wishlistTextAdded);
            $('.tooltip-inner').text(theme.strings.wishlistTextAdded);
        }
        localStorage.setItem('localWishlist', JSON.stringify(wishlistObject));
        $wishlistCount.text(wishlistObject.length);
    };

    function loadWishlist() {
        $wishlistContainer.html('');
        //page wishlist
        if (wishlistObject.length > 0) {
            for (var i = 0; i < wishlistObject.length; i++) {
                var productHandle = wishlistObject[i];
                Shopify.getProduct(productHandle, function(product) {
                    var htmlProduct = '';
                    var productPrice = product.price_varies ? 'from ' + theme.Currency.formatMoney(product.price_min, theme.moneyFormat) : theme.Currency.formatMoney(product.price, theme.moneyFormat);
                    var productComparePrice = product.compare_at_price_min !== 0 ? theme.Currency.formatMoney(product.compare_at_price_min, theme.moneyFormat) : '';
                    htmlProduct += '<div class="js-wishlist-item col-md-4 col-sm-6 col-xs-6 col-12 mb-4">';
                    htmlProduct += '<div class="js-wishlist-itembox">';
                    htmlProduct += '<div class=" d-flex flex-row p-4">';
                    htmlProduct += '	<a class="d-inline-block mr-4 " href="' + product.url + '">';
                    htmlProduct += '		<img src="' + product.featured_image + '"/>';
                    htmlProduct += '	</a>';
                    htmlProduct += '	<div><a href="' + product.url + '" class="title-prouct d-block h4 text-body" >' + product.title + '</a>';
                    htmlProduct += '	<span> ' + productPrice + '</span>';
                    htmlProduct += '	 <s>' + productComparePrice + '</s></div>';
                    htmlProduct += '<button class="btn js-remove-wishlist" data-handle="' + product.handle + '">' + theme.strings.wishlistRemove + '</button>';
                    htmlProduct += '</div>';
                    htmlProduct += '</div>';
                    htmlProduct += '</div>';
                    $wishlistContainer.append(htmlProduct);
                    theme.updateCurrencies();
                });
            }
        } else {
            loadNoResult();
        }

        //count items
        $wishlistCount.text(wishlistObject.length);

        //button text
        $(wishlistButtonClass).each(function() {
            var productHandle = $(this).data('handle');
            var iconWishlist = $.inArray(productHandle, wishlistObject) !== -1 ? theme.strings.wishlistIconAdded : theme.strings.wishlistIcon;
            var textWishlist = $.inArray(productHandle, wishlistObject) !== -1 ? theme.strings.wishlistTextAdded : theme.strings.wishlistText;
            $(this).html(iconWishlist + textWishlist).attr('title', textWishlist);
        });
    }

    $(document).on('click', wishlistButtonClass, function(event) {
        event.preventDefault();
        updateWishlist(this);
    });
    $(document).on('click', wishlistRemoveButtonClass, function() {
        var productHandle = $(this).data('handle'),
            allSimilarProduct = $(wishlistButtonClass + '[data-handle="' + productHandle + '"]');

        //update button
        allSimilarProduct.html(theme.strings.wishlistIcon + theme.strings.wishlistText);
        //update tooltip
        allSimilarProduct.attr('data-original-title', theme.strings.wishlistText);
        $('.tooltip-inner').text(theme.strings.wishlistText);
        //update Object
        wishlistObject.splice(wishlistObject.indexOf(productHandle), 1);
        localStorage.setItem('localWishlist', JSON.stringify(wishlistObject));
        // Remove element
        $(this).closest('.js-wishlist-item').fadeOut(); // or .remove()
        //count
        $wishlistCount.text(wishlistObject.length);
        if (wishlistObject.length === 0) {
            loadNoResult();
        }
    });

    loadWishlist();
    $(document).on('shopify:section:load', loadWishlist);
    return {
        load: loadWishlist
    }
})()

// Compare
theme.compare = (function() {
    var compareButtonClass = '.js-btn-compare',
        compareRemoveButtonClass = '.js-remove-compare',
        $compareCount = $('.js-compare-count'),
        $compareContainer = $('.js-compare-content'),
        compareObject = JSON.parse(localStorage.getItem('localCompare')) || [],
        alertClass = 'notice';

    function updateCompare(self) {
        var productHandle = $(self).data('handle'),
            alertText = '';
        var isAdded = $.inArray(productHandle, compareObject) !== -1 ? true : false;
        if (isAdded) {
            compareObject.splice(compareObject.indexOf(productHandle), 1);
            alertText = theme.strings.compareNotifyRemoved;
            alertClass = 'notice';
        } else {
            if (compareObject.length === 4) {
                alertText = theme.strings.compareNotifyMaximum;
                alertClass = 'error';
            } else {
                alertClass = 'notice';
                compareObject.push(productHandle);
                alertText = theme.strings.compareNotifyAdded;
            }
        }
        localStorage.setItem('localCompare', JSON.stringify(compareObject));
        theme.alert.new(theme.strings.compareText, alertText, 2000, alertClass);
        $compareCount.text(compareObject.length);
    };

    function loadCompare() {
        var compareGrid;
        $compareContainer.html('');
        //popup compare
        if (compareObject.length > 0) {
            compareGrid = compareObject.length === 1 ? 'col-md-6 col-sm-6' : 'col';
            for (var i = 0; i < compareObject.length; i++) {
                var productHandle = compareObject[i];
                Shopify.getProduct(productHandle, function(product) {
                    var htmlProduct = '',
                        productPrice = product.price_varies ? 'from ' + theme.Currency.formatMoney(product.price_min, theme.moneyFormat) : theme.Currency.formatMoney(product.price, theme.moneyFormat),
                        productComparePrice = product.compare_at_price_min !== 0 ? theme.Currency.formatMoney(product.compare_at_price_min, theme.moneyFormat) : '',
                        productAvailable = product.available ? theme.strings.available : theme.strings.unavailable,
                        productAvailableClass = product.available ? 'alert-success' : 'alert-danger',
                        productTypeHTML = product.type !== "" ? '<a href="/collections/types?q=' + product.type + '">' + product.type + '</a>' : '<span>' + theme.strings.none + '</span>',
                        productVendorHTML = product.vendor !== "" ? '<a href="/collections/vendors?q=' + product.vendor + '">' + product.vendor + '</a>' : '<span>' + theme.strings.none + '</span>';
                    htmlProduct += '<div class="compare-item ' + compareGrid + ' col-xs-6">';
                    htmlProduct += '	<a href="' + product.url + '">';
                    htmlProduct += '		<img src="' + Shopify.resizeImage(product.featured_image, 'x300') + '"/>';
                    htmlProduct += '	</a>';
                    htmlProduct += '	<hr /><h5 >' + product.title + '</h5>';
                    htmlProduct += '	<hr /><s>' + productComparePrice + '</s>';
                    htmlProduct += '	<span> ' + productPrice + '</span>';
                    htmlProduct += '	<hr /><span class=' + productAvailableClass + '> ' + productAvailable + '</span>';
                    htmlProduct += '	<hr />' + productTypeHTML;
                    htmlProduct += '	<hr />' + productVendorHTML;
                    htmlProduct += '  <hr /><button class="btn js-remove-compare btn-theme gradient-theme" data-handle="' + product.handle + '">' + theme.strings.compareRemove + '</button>';
                    htmlProduct += '</div>';
                    $compareContainer.append(htmlProduct);
                    theme.updateCurrencies();
                });
            }
        } else {
            $compareContainer.html('<div class="alert alert-warning d-inline-block">' + theme.strings.compareNoResult + '</div>');
        }

        //button text
        $(compareButtonClass).each(function() {
            var productHandle = $(this).data('handle');
            var status = $.inArray(productHandle, compareObject) !== -1 ? 'added' : '';
            $(this).removeClass('added').addClass(status);
        });

        //count items
        $compareCount.text(compareObject.length);
    }
    $(document).on('click', compareButtonClass, function(event) {
        event.preventDefault();
        updateCompare(this);
        loadCompare();
    });
    $(document).on('click', compareRemoveButtonClass, function() {
        var productHandle = $(this).data('handle');
        compareObject.splice(compareObject.indexOf(productHandle), 1);
        localStorage.setItem('localCompare', JSON.stringify(compareObject));
        loadCompare();
    });

    loadCompare();
    $(document).on('shopify:section:load', loadCompare);
    return {
        load: loadCompare
    }
})()

// Popup newsletter
theme.popupNewletter = (function() {
    var $popupNewsletter = $('#jsPopupNewsletter'),
        $newsletterForm = $('#jsPopupNewsletter form'),
        date = new Date(),
        minutes = theme.timePopupNewsletter;
    minutesdelay = $popupNewsletter.attr('data-delay');
    if ($popupNewsletter.length === 1) {
        date.setTime(date.getTime() + (minutes * 60 * 1000));
        var setCookies = function() {
            $.cookie('cookiesNewsletter', 'disabled', { expires: date, path: '/' });
        };
        if ($.cookie('cookiesNewsletter') !== "disabled") {
            $(window).on('load', function() {
                setTimeout(function() {
                    $popupNewsletter.modal('show');
                }, minutesdelay * 1000);
            });
            $popupNewsletter.on('hidden.bs.modal', setCookies);
            $newsletterForm.submit(setCookies);
        }
    }
})()

// Cookie policy
theme.cookie = (function() {
    var $policy = $('.js-cookie-policy'),
        $closeButton = $('.js-btn-ok'),
        isOk = localStorage.getItem('localCookie') || '';
    if (isOk === '') {
        $policy.fadeIn('slow');
    }
    $closeButton.on('click', function() {
        localStorage.setItem('localCookie', 'accept');
        $policy.fadeOut('slow');
    })
})()

// Announcement Bar
theme.announcement = (function() {
    var $bar = $('.js-announcement-bar'),
        $closeButton = $('.js-ab-close'),
        isClosed = localStorage.getItem('localAnnouncement') || '';
    if (isClosed === '') {
        $bar.fadeIn();
        $bar.closest('.body-theme').addClass('body-announcement-bar');
    }
    $closeButton.on('click', function() {
        localStorage.setItem('localAnnouncement', 'closed');
        $bar.slideUp();
        $bar.closest('.body-theme').removeClass('body-announcement-bar');
    })
})()

// Open external link in new tab
theme.exLink = (function() {
    var links = document.links;
    for (let i = 0, linksLength = links.length; i < linksLength; i++) {
        if (links[i].hostname !== window.location.hostname && $(links[i]).attr('href') !== 'javascript:void(0)') {
            links[i].target = '_blank';
        }
    }
})()

// Deal- countdown
theme.countdown = (function() {
    function initCountdown() {
        $(".js-countdown").each(function() {
            var endTime = $(this).data('time'),
                htmlLayout = "<ul class='list--inline'><li class='gradient-theme-vertical'><span class='countdown-time'>%%D%%</span><span class='countdown-text'>Days</span></li><li class='gradient-theme-vertical'><span class='countdown-time'>%%H%%</span><span class='countdown-text'>Hours</span></li><li class='gradient-theme-vertical'><span class='countdown-time'>%%M%%</span><span class='countdown-text'>Mins</span></li><li class='gradient-theme-vertical'><span class='countdown-time'>%%S%%</span><span class='countdown-text'>Secs</span></li></ul>";
            $(this).lofCountDown({
                TargetDate: endTime,
                DisplayFormat: htmlLayout,
                FinishMessage: '<span class="alert alert-warning d-inline-block">' + theme.strings.countdownEndText + '</span>'
            });
        });
    }
    initCountdown();
    return {
        load: initCountdown
    }
})()

// Price range - Collection page
theme.priceRange = (function() {
    function initPriceRange() {
        var min = 0,
            max = 0,
            slideRange = '#js-slider-range',
            productCard = '.js-product-card',
            slideRangeWrap = '.slider-range-wr',
            rangeMin = '.js-range-min',
            rangeMax = '.js-range-max',
            enablePriceRange = $('#js-slider-range').length === 1 ? true : false;

        if (enablePriceRange) {
            $(productCard).each(function() {
                if (eval($(this).data('price')) > max) max = eval($(this).data('price'));
                if (min == 0) min = eval($(this).data('price'));
                else if (eval($(this).data('price')) < min) min = eval($(this).data('price'));
            });

            if (min === max) {
                $(slideRangeWrap).fadeOut();
            } else {
                $(slideRangeWrap).fadeIn();
            }

            $(slideRange).slider({
                range: true,
                min: min,
                max: max,
                values: [min, max],
                slide: function(event, ui) {
                    var price1 = (Shopify.formatMoney(ui.values[0], theme.moneyFormat));
                    var price2 = (Shopify.formatMoney(ui.values[1], theme.moneyFormat));
                    $(rangeMin).html(price1);
                    $(rangeMax).html(price2);
                    theme.updateCurrencies();

                    // Show/Hide product when dragging
                    $(productCard).each(function() {
                        if (eval($(this).data('price')) >= ui.values[0] && eval($(this).data('price')) <= ui.values[1]) {
                            $(this).parent().fadeIn();
                        } else {
                            $(this).parent().fadeOut();
                        }
                    });
                }
            });

            var price1 = (Shopify.formatMoney(min, theme.moneyFormat));
            var price2 = (Shopify.formatMoney(max, theme.moneyFormat));
            $(rangeMin).html(price1);
            $(rangeMax).html(price2);
            theme.updateCurrencies();

        }
    }
    initPriceRange();
    return {
        load: initPriceRange
    }
})()

// Collection view - Collection page
theme.collectionView = (function() {
    var btnView = '.js-btn-view',
        btnViewActive = '.js-btn-view.active';

    $(document).on('click', btnView, function() {
        var value = $(this).data('col'),
            $gridItemCol = $('.js-col');

        $(btnView).removeClass('active');
        $(this).addClass('active');

        $gridItemCol.removeClass().addClass('js-col col-sm-6 col-12');
        if (value === 3) {
            $gridItemCol.addClass('col-lg-4');
        } else if (value === 4) {
            $gridItemCol.addClass('col-lg-3');
        } else if (value === 5) {
            $gridItemCol.addClass('col-lg-2-4');
        } else if (value === 6) {
            $gridItemCol.addClass('col-lg-2');
        };
    })

    function triggerCollectionView() {
        $(btnViewActive).trigger('click');
    }

    return {
        triggerView: triggerCollectionView
    }
})()

// Swath variant in card item
theme.swatchCard = (function() {
    $(document).on('click', '.js-swatch-card-item', function() { //click or mouseover
        $(".js-swatch-card-item").removeClass("active");
        $(this).addClass("active");
        var newImage = $(this).data('image');
        var id = $(this).data('id');
        var gridItem = $(this).closest('.js-product-card');
        gridItem.find('.product-card__image').find('img').attr('srcset', newImage);
        gridItem.find('.js-grid-cart').data('id', id).attr('data-id', id);
    });
})()

theme.swatchCard2 = (function() {
    function initVariant(id) {
        var productJson = JSON.parse($('.customJson-' + id).html());
        var $selectorForm = $('.customform-' + id);
        var $button = $('.js-customform-addtocart-' + id);
        var $buttontext = $button.find('span');
        var $wrapObject = $selectorForm.closest('.js-product-card');
        var options = {
            $container: $selectorForm,
            enableHistoryState: false,
            product: productJson,
            singleOptionSelector: '.single-option-selector-' + id,
            originalSelectorId: '#ProductSelect-' + id
        };
        var variants = new slate.Variants(options);
        var AjaxCart = new window.AjaxCart($selectorForm);
        var _updateButton = function(evt) {
            var variant = evt.variant;
            if (variant === undefined) {
                $button.prop('disabled', true).removeClass('btn--sold-out');
                $buttontext.html(theme.strings.unavailable);
            } else {
                if (variant.available) {
                    $button.removeClass('btn--sold-out').prop('disabled', false);
                    $buttontext.html(theme.strings.addToCart);
                } else {
                    $button.prop('disabled', true).addClass('btn--sold-out');
                    $buttontext.html(theme.strings.soldOut);
                }
            }
        }
        var _updateImage = function(evt) {
            var variant = evt.variant;
            var $mainImage = $wrapObject.find('.product-card__image').find('img');
            if (variant !== undefined && variant.featured_image !== null) {
                var variantImage = variant.featured_image;
                $mainImage.attr('srcset', variantImage.src);
            }
        }
        var _updatePrice = function(evt) {
            var $price = $wrapObject.find('.product-card__price');
            var variant = evt.variant;
            if (variant !== undefined) {
                var htmlComparePrice = variant.compare_at_price !== null ? '<s class="product-card__regular-price"><span class="money">' + variant.compare_at_price + '</span></s>' : '';
                var htmlPrice = '<span class="money">' + variant.price + '</span>' + htmlComparePrice;
                $price.html(htmlPrice);
                theme.updateCurrencies();
            }
        }
        variants.$container.on(
            'variantChange', _updateButton
        );
        variants.$container.on(
            'variantChange', _updateImage
        );
        variants.$container.on(
            'variantChange', _updatePrice
        );
    }

    function initForm() {
        $('.js-customform').each(function() {
            var id = $(this).data('id');
            initVariant(id);
        })
    }

    initForm();
    return {
        load: initForm
    }
})()

// Loading
theme.loading = (function() {
    var $loading = $('#js-loading'),
        hasLoading = $('#js-loading').length === 0 ? false : true;
    if (hasLoading) {
        $(window).load(function() {
            $loading.fadeOut();
        });
    }
})()

theme.effectLeavingPage = (function() {
    window.onbeforeunload = function() {
        $('body').css('opacity', '0');
    }
})()

// Isotope
theme.isotope = (function() {
    var enableIsotope = $('.enable-isotope').length === 1 ? true : false,
        $grid = $('.js-grid'),
        filter = '.js-filter-isotope';

    function initIsotope() {
        if (enableIsotope) {
            $grid.isotope({
                itemSelector: '.grid-item',
                percentPosition: true
            })
            $(document).on('click', filter, function() {
                var filterValue = $(this).data('filter') === '*' ? $(this).data('filter') : '.' + $(this).data('filter');
                $(filter).removeClass('active');
                $(this).addClass('active');
                $grid.isotope({
                    filter: filterValue
                });
            });
            $(window).scroll(function() {
                $grid.isotope('layout');
            });
            $(window).load(function() {
                $grid.isotope('layout');
                $(filter).first().trigger('click');
            });
        }
    }
    initIsotope();
})()

//aos



// theme.Wow = (function(){
//   new WOW().init();
// })()




// Masonry
theme.Masonry = (function() {
    function Masonry(container) {
        this.$container = $(container).on('init', this._a11y.bind(this));
        var $masonry = this.$container;
        $masonry.isotope({
            itemSelector: '.grid-item',
            percentPosition: true,
            masonry: {
                columnWidth: '.grid-sizer'
            }
        });
        $(window).load(function() {
            $masonry.isotope('layout').css('opacity', '1');
        });
        $(window).scroll(function() {
            $masonry.isotope('layout').css('opacity', '1');
        });
    }

    Masonry.prototype = _.assignIn({}, Masonry.prototype, {
        _a11y: function(event, obj) {
            var $list = obj.$list;
            var $wrapper = this.$container.parent();

            // Remove default Slick aria-live attr until slider is focused
            $list.removeAttr('aria-live');

            // When an element in the slider is focused set aria-live
            $wrapper.on('focusin', function(evt) {
                if ($wrapper.has(evt.target).length) {
                    $list.attr('aria-live', 'polite');
                }
            });

            // Remove aria-live
            $wrapper.on('focusout', function(evt) {
                if ($wrapper.has(evt.target).length) {
                    $list.removeAttr('aria-live');
                }
            });
        }
    });

    return Masonry;
})();



// Cross-selling
theme.crosssell = (function() {
    var crosssellClass = '.js-crosssell',
        handles = $(crosssellClass).data('handles') || '',
        arrayHandle = handles.split(','),
        $blockCrosssell = $('.block-cross-sell'),
        variantSelectClass = '.js-cross-select',
        crossImageClass = '.cross-item-image',
        crossPriceClass = '.cross-item-money';

    function generateCrosssell() {
        for (var i = 0; i < arrayHandle.length; i++) {
            var productHandle = arrayHandle[i];
            Shopify.getProduct(productHandle, function(product) {
                var htmlCross = '',
                    htmlOption = '',
                    firstAvailableVariant = '',
                    variantCount = product.variants.length;

                // generate select box and check first avaiable variant
                for (var j = 0; j < variantCount; j++) {
                    var variant = product.variants[j],
                        variantImage = variant.featured_image === null ? product.featured_image : variant.featured_image.src,
                        disabled = variant.available ? '' : 'disabled';
                    htmlOption += '<option ' + disabled + ' data-id="' + variant.id + '" data-price="' + variant.price + '" data-image="' + variantImage + '">' + variant.title + '</option>';
                    if (firstAvailableVariant === '' && variant.available) {
                        firstAvailableVariant = variant
                    }
                }
                var productPrice = theme.Currency.formatMoney(firstAvailableVariant.price, theme.moneyFormat),
                    productImage = firstAvailableVariant.featured_image === null ? product.featured_image : firstAvailableVariant.featured_image.src,
                    selectHide = variantCount === 1 ? 'hide' : '';

                // generate HTML
                htmlCross += '<div class="col cross-item ' + product.handle + '">';
                htmlCross += '	<a class="cross-item-image" href="' + product.url + '" title="' + product.title + '"><img src="' + productImage + '" />' + theme.strings.cartIcon + '</a>';
                htmlCross += '	<a target="_blank" href="' + product.url + '" title="' + product.title + '" class="cross-item-title">' + product.title + '</a>';
                htmlCross += '	<span class="cross-item-money">' + productPrice + '</span>';
                htmlCross += '	<select class="js-cross-select ' + selectHide + '" data-image="' + productImage + '" data-price="' + firstAvailableVariant.price + '" data-item="' + firstAvailableVariant.id + '">' + htmlOption + '</select>';
                htmlCross += '</div>';
                $(crosssellClass).append(htmlCross);
                theme.updateCurrencies();
            });
        }
    }

    function showPopupCrosssell(lineItem) {
        //generate lineitem;
        var htmlLineItem = '';
        htmlLineItem += '<span class="alert alert-success d-inline-block mb-2">' + theme.strings.addToCartSuccess + '</span>';
        htmlLineItem += '<div><img src="' + lineItem.image + '" alt="Added Product"></div>';
        htmlLineItem += '<h4 class="cross-item-title">' + lineItem.title + '</h4>';
        htmlLineItem += '<div class="mb-2">' + theme.strings.cartQuantity + ': ' + lineItem.quantity + '</div>';
        $('.js-cross-added').hide().html(htmlLineItem).fadeIn();

        // show popup
        var $popupCrosssell = $('#jsCrosssell');
        $popupCrosssell.modal('show');
    }

    if (handles !== '') {
        $(document).on('click', crossImageClass, function(event) {
            event.preventDefault();
            var parent = $(this).closest('.cross-item'),
                itemId = parent.find(variantSelectClass).attr('data-item');
            Shopify.addItem(itemId, 1, function(lineItem) {
                theme.miniCart.updateElements();
                theme.miniCart.generateCart();
                showPopupCrosssell(lineItem);
            });
        });
        $(document).on('change', variantSelectClass, function() {
            var selectVariant = $(this).children(':selected'),
                selectVariantId = selectVariant.data('id'),
                parent = $(this).parent(),
                newPrice = theme.Currency.formatMoney(selectVariant.data('price'), theme.moneyFormat);

            if (selectVariant.data('image') !== '') {
                parent.find(crossImageClass).find('img').attr('src', selectVariant.data('image'));
            }
            $(this).attr('data-item', selectVariantId);
            parent.find(crossPriceClass).html(newPrice);
            theme.updateCurrencies();
        });
        $(document).on('shopify:section:load', generateCrosssell);
        generateCrosssell();
        $blockCrosssell.removeClass('hide');
    }
    return {
        showPopup: showPopupCrosssell
    }
})()

// Upsell
theme.upsell = (function() {
    var popupUpsell = '#jsUpsell',
        $button = $('#jsUpsell .btn'),
        productUpsellId = $('#jsUpsell').data('id') || '',
        buttonAcceptClass = 'js-btn-accept',
        delayTime = $('#jsUpsell').data('delay') || 3000,
        isUpsell = $(popupUpsell).length === 1 ? true : false;
    if (isUpsell) {
        $(document).ready(function() {
            setTimeout(function() {
                $(popupUpsell).modal('show');
            }, delayTime);
        });
        $button.on('click', function() {
            if ($(this).hasClass(buttonAcceptClass)) {
                Shopify.addItem(productUpsellId, 1, function(item) {
                    theme.miniCart.updateElements();
                    theme.miniCart.generateCart();
                    var htmlVariant = item.variant_title !== null ? '<i>(' + item.variant_title + ')</i>' : '';
                    var htmlAlert = '<div class="media mt-2 alert--cart"><a class="mr-3" href="/cart"><img class="lazyload" data-src="' + item.image + '"></a><div class="media-body align-self-center"><p class="m-0 font-weight-bold">' + item.product_title + ' x ' + item.quantity + '</p>' + htmlVariant + '<div><div>';
                    theme.alert.new(theme.strings.addToCartSuccess, htmlAlert, 3000, 'notice');
                })
            }
            $(popupUpsell).modal('hide');
        })
    }
})()

// Coupon
theme.coupon = (function() {
    var popupCoupon = '#jsCoupon',
        $button = $('#jsCoupon .js-btn-coupon'),
        delayTime = $('#jsCoupon').data('delay') || 3000,
        isCoupon = $(popupCoupon).length === 1 ? true : false,
        isCopied = localStorage.getItem('localCoupon') || '';
    if (isCoupon && isCopied === '') {
        $(document).ready(function() {
            setTimeout(function() {
                $(popupCoupon).modal('show');
            }, delayTime);
        });
        $button.on('click', function() {
            var copyText = document.getElementById("coupon_code");
            copyText.select();
            document.execCommand("Copy");
            $(popupCoupon).modal('hide');
            theme.alert.new('Coupon code', 'Successfully copied, now you can paste code at checkout', 4000);
            localStorage.setItem('localCoupon', 'copied');
        })
    }
})()

// Overwrite Shopify.onError in Shopify API
Shopify.onError = function(t, r) {
    var e = eval("(" + t.responseText + ")");
    var mess = e.message ? e.message + "(" + e.status + "): " + e.description : "Error : " + Shopify.fullMessagesFromErrors(e).join("; ") + "."
    theme.alert.new('Alert', mess, 3000, 'warning');
}

// Megamenu width
theme.fixWidthMegamenu = (function() {
    var $megamenuClass = $('.site-nav__item-mega'),
        megaDropdownClass = '.meganav';
    $megamenuClass.each(function() {
        var widthMenu = $(this).data('width') || 0;
        if (widthMenu !== 0) {
            $(this).find(megaDropdownClass).css({ 'width': widthMenu + 'px', 'margin-left': '-' + widthMenu / 2 + 'px' });
        }
    });
})()

// Product video
theme.productVideo = (function() {
    var playButtonClass = '.js-play-button';
    $(document).on('click', playButtonClass, function() {
        let videoSelector = $(this).next(),
            videoObject = videoSelector.get(0);
        $(this).toggleClass('active');
        videoSelector.toggleClass('active');
        videoObject.paused ? videoObject.play() : videoObject.pause();
    })
})()

// Fake-viewers
theme.fakeViewer = (function() {
    var $fakeViewClass = $('.js-fake-view'),
        minValue = $fakeViewClass.data('min'),
        maxValue = $fakeViewClass.data('max'),
        duration = $fakeViewClass.data('duration');

    function randomInRange(start, end) {
        var value = Math.floor(Math.random() * (end - start + 1) + start);
        $fakeViewClass.text(value);
    }

    if (minValue !== undefined && maxValue !== undefined) {
        randomInRange(minValue, maxValue);
        setInterval(function() {
            randomInRange(minValue, maxValue);
        }, duration);
    }

})();

// Product-suggest
theme.productSuggest = (function() {
    var $productSuggestClass = $('.product-notification'),
        $closeButtonClass = $('.close-notifi'),
        duration = $productSuggestClass.data('time') || 0,
        productSuggestCookie = 'cookieSuggest';

    function SomeonePurchased() {
        if ($.cookie(productSuggestCookie) == 'closed') {
            $productSuggestClass.remove();
        }
        $closeButtonClass.on('click', function() {
            $productSuggestClass.remove();
            $.cookie(productSuggestCookie, 'closed', { expires: 1, path: '/' });
        });

        function toggleSomething() {
            if ($productSuggestClass.hasClass('active')) {
                $productSuggestClass.removeClass('active')
            } else {
                var arrayProducts = $('.data-product'),
                    randomProduct = Math.floor(Math.random() * arrayProducts.length),
                    Object = $(arrayProducts[randomProduct]);

                $productSuggestClass.addClass('active');
                $productSuggestClass.find('.product-image').attr('href', Object.data('url')).find('img').attr('src', Object.data('image'));
                $productSuggestClass.find('.product-name').text(Object.data('title')).attr('href', Object.data('url'));
                $productSuggestClass.find('.time-ago').text(Object.data('time'));
                $productSuggestClass.find('.from-ago').text(Object.data('local'));
            }
        }

        if (duration !== 0) {
            setInterval(toggleSomething, duration);
        }
    }
    SomeonePurchased();
})()


// Stickyheader
theme.stickyHeader = (function() {
    var stickHeaderClass = '.site-header--sticky';
    if ($(stickHeaderClass).length !== 0) {
        $(window).scroll(function() {
            if (window.pageYOffset >= 20) {
                $(stickHeaderClass).addClass('active');
            } else {
                $(stickHeaderClass).removeClass('active');
            }
        });
    }
})()

theme.PhotoSwipe = (function() {
    var initPhotoSwipeFromDOM = function(gallerySelector) {

        // parse slide data (url, title, size ...) from DOM elements 
        // (children of gallerySelector)
        var parseThumbnailElements = function(el) {
            var thumbElements = el.childNodes,
                numNodes = thumbElements.length,
                items = [],
                figureEl,
                linkEl,
                size,
                item;

            for (var i = 0; i < numNodes; i++) {

                figureEl = thumbElements[i]; // <figure> element

                // include only element nodes 
                if (figureEl.nodeType !== 1) {
                    continue;
                }

                linkEl = figureEl.children[0]; // <a> element

                size = linkEl.getAttribute('data-size').split('x');

                // create slide object
                item = {
                    src: linkEl.getAttribute('href'),
                    w: parseInt(size[0], 10),
                    h: parseInt(size[1], 10)
                };



                if (figureEl.children.length > 1) {
                    // <figcaption> content
                    item.title = figureEl.children[1].innerHTML;
                }

                if (linkEl.children.length > 0) {
                    // <img> thumbnail element, retrieving thumbnail url
                    item.msrc = linkEl.children[0].getAttribute('src');
                }

                item.el = figureEl; // save link to element for getThumbBoundsFn
                items.push(item);
            }

            return items;
        };

        // find nearest parent element
        var closest = function closest(el, fn) {
            return el && (fn(el) ? el : closest(el.parentNode, fn));
        };

        // triggers when user clicks on thumbnail
        var onThumbnailsClick = function(e) {
            e = e || window.event;
            e.preventDefault ? e.preventDefault() : e.returnValue = false;

            var eTarget = e.target || e.srcElement;

            // find root element of slide
            var clickedListItem = closest(eTarget, function(el) {
                return (el.tagName && el.tagName.toUpperCase() === 'FIGURE');
            });

            if (!clickedListItem) {
                return;
            }

            // find index of clicked item by looping through all child nodes
            // alternatively, you may define index via data- attribute
            var clickedGallery = clickedListItem.parentNode,
                childNodes = clickedListItem.parentNode.childNodes,
                numChildNodes = childNodes.length,
                nodeIndex = 0,
                index;

            for (var i = 0; i < numChildNodes; i++) {
                if (childNodes[i].nodeType !== 1) {
                    continue;
                }

                if (childNodes[i] === clickedListItem) {
                    index = nodeIndex;
                    break;
                }
                nodeIndex++;
            }



            if (index >= 0) {
                // open PhotoSwipe if valid index found
                openPhotoSwipe(index, clickedGallery);
            }
            return false;
        };

        // parse picture index and gallery index from URL (#&pid=1&gid=2)
        var photoswipeParseHash = function() {
            var hash = window.location.hash.substring(1),
                params = {};

            if (hash.length < 5) {
                return params;
            }

            var vars = hash.split('&');
            for (var i = 0; i < vars.length; i++) {
                if (!vars[i]) {
                    continue;
                }
                var pair = vars[i].split('=');
                if (pair.length < 2) {
                    continue;
                }
                params[pair[0]] = pair[1];
            }

            if (params.gid) {
                params.gid = parseInt(params.gid, 10);
            }

            return params;
        };

        var openPhotoSwipe = function(index, galleryElement, disableAnimation, fromURL) {
            var pswpElement = document.querySelectorAll('.pswp')[0],
                gallery,
                options,
                items;

            items = parseThumbnailElements(galleryElement);

            // define options (if needed)
            options = {
                maxSpreadZoom: 1,
                bgOpacity: 0.7,
                zoomEl: true,
                history: false,
                zoomEl: false,
                pinchToClose: false,
                closeOnScroll: false,
                // define gallery index (for URL)
                galleryUID: galleryElement.getAttribute('data-pswp-uid'),

            };

            // PhotoSwipe opened from URL
            if (fromURL) {
                if (options.galleryPIDs) {
                    // parse real index when custom PIDs are used 
                    // http://photoswipe.com/documentation/faq.html#custom-pid-in-url
                    for (var j = 0; j < items.length; j++) {
                        if (items[j].pid == index) {
                            options.index = j;
                            break;
                        }
                    }
                } else {
                    // in URL indexes start from 1
                    options.index = parseInt(index, 10) - 1;
                }
            } else {
                options.index = parseInt(index, 10);
            }

            // exit if index not found
            if (isNaN(options.index)) {
                return;
            }

            if (disableAnimation) {
                options.showAnimationDuration = 0;
            }

            // Pass data to PhotoSwipe and initialize it
            gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, items, options);
            gallery.init();
        };

        // loop through all gallery elements and bind events
        var galleryElements = document.querySelectorAll(gallerySelector);

        for (var i = 0, l = galleryElements.length; i < l; i++) {
            galleryElements[i].setAttribute('data-pswp-uid', i + 1);
            galleryElements[i].onclick = onThumbnailsClick;
        }

        // Parse URL and open gallery if it contains #&pid=3&gid=1
        var hashData = photoswipeParseHash();
        if (hashData.pid && hashData.gid) {
            openPhotoSwipe(hashData.pid, galleryElements[hashData.gid - 1], true, true);
        }
    };

    // execute above function
    initPhotoSwipeFromDOM('.my-gallery');
})()

theme.ZoomImage = (function() {
    $(window).resize(function() {
        var width = $(window).width();
        if (width > 767) {
            ZoomImage();
        }
    });
    $(window).width(function() {
        var width = $(window).width();
        if (width > 767) {
            ZoomImage();
        }
    });

    function ZoomImage() {
        $(".zoom_image").each(function(arg, el) {
            var image = $(el).find("img");
            $(el).zoom({
                on: 'mouseover',
                url: image.attr("src").replace("small", "big")
            });
        });
    }
})()

theme.activeAccordion = (function() {
    $('.collapse').on('shown.bs.collapse', function() {
        $(this).prev().addClass('active-acc');
    });
    $('.collapse').on('hidden.bs.collapse', function() {
        $(this).prev().removeClass('active-acc');
    });
})()


// Anchor scroll
theme.anchorScroll = (function() {
    $(document).on('click', 'a[href^="#"]', function(event) {
        event.preventDefault();
        var disableAnchor = $(this).hasClass('disabled-anchor');
        if (!disableAnchor) {
            $('html, body').animate({
                scrollTop: $($.attr(this, 'href')).offset().top
            }, 500);
        }
    });
})()

// Product-recently-viewed
theme.productRecentlyViewed = (function() {
    var $viewedElement = $('.js-recently-view'),
        $viewButton = $('.js-recently-view-button'),
        $content = $('.js-recently-view-content'),
        productHandle = $viewedElement.data('handle') || '',
        limit = $viewButton.data('limit') || 0,
        arrayProduct = JSON.parse(localStorage.getItem('localRecentlyViewed')) || [],
        lastProduct = arrayProduct[arrayProduct.length - 1] || '',
        isAdded = $.inArray(productHandle, arrayProduct) !== -1 ? true : false;

    function processViewed() {
        if (productHandle !== '') {
            //process last product
            if (lastProduct === productHandle && arrayProduct.length > 1) {
                lastProduct = arrayProduct[arrayProduct.length - 2]
            }

            //move current product to last of array
            if (isAdded) {
                arrayProduct.splice(arrayProduct.indexOf(productHandle), 1);
            }
            arrayProduct.push(productHandle);
            //remove first item if limit
            if (arrayProduct.length > limit) {
                arrayProduct.shift()
            }
            localStorage.setItem('localRecentlyViewed', JSON.stringify(arrayProduct));
        }
    }

    function generatorProduct() {
        $content.html('');
        if (arrayProduct.length > 0) {
            //array
            for (var i = 0; i < arrayProduct.length; i++) {
                var productHandle = arrayProduct[i];
                Shopify.getProduct(productHandle, function(product) {
                    var htmlProduct = '';
                    var productPrice = product.price_varies ? 'from ' + theme.Currency.formatMoney(product.price_min, theme.moneyFormat) : theme.Currency.formatMoney(product.price, theme.moneyFormat);
                    var productComparePrice = product.compare_at_price_min !== 0 ? theme.Currency.formatMoney(product.compare_at_price_min, theme.moneyFormat) : '';
                    htmlProduct += '<div class="col-12 col-lg-4 js-viewed-item mb-4">';
                    htmlProduct += '	<div class="border p-3 rounded media d-flex ">';
                    htmlProduct += '	<a class="mr-3 col-4 p-0" href="' + product.url + '">';
                    htmlProduct += '		<img src="' + product.featured_image + '"/>';
                    htmlProduct += '	</a>';
                    htmlProduct += '	<div class="media-body text-left">';
                    htmlProduct += '		<h4 class="mb-2 mt-2"><a href="' + product.url + '">' + product.title + '</a></h5>';
                    htmlProduct += '	<span> ' + productPrice + '</span>';
                    htmlProduct += '	<s>' + productComparePrice + '</s>';
                    htmlProduct += '	</div>';
                    htmlProduct += '	</div>';
                    htmlProduct += '</div>';
                    $content.append(htmlProduct);
                    theme.updateCurrencies();
                });
            }

            //last product
            Shopify.getProduct(lastProduct, function(product) {
                $viewButton.css('background-image', 'url(' + product.featured_image + ')').addClass('active');
            })
        }
    }

    processViewed();
    generatorProduct();

})()

// Notice when soldout
theme.alert = (function() {
    function createAlert(title, mess, time, type) {
        var aTitle = title || '',
            aTime = time || 2000,
            aMessage = mess || '',
            aClass = type || 'default';
        $.growl({
            title: aTitle,
            message: aMessage,
            duration: aTime,
            style: aClass,
            size: 'large'
        });
    }

    return {
        new: createAlert
    }
})()

// Notice when soldout
theme.noticeSoldout = (function() {
    var $soldoutWrapFormClass = $('.js-contact-soldout'),
        $textClass = $('.js-notify-text'),
        $soldoutValueId = $('#ContactProduct');

    function noticeSoldout(variant) {
        $soldoutWrapFormClass.find('.form-success').remove()
        if (variant.available) {
            $textClass.find('span').text('');
            $soldoutWrapFormClass.addClass('hide');
        } else {
            $textClass.find('span').text(': ' + variant.name);
            $soldoutWrapFormClass.removeClass('hide');
            $soldoutValueId.val(variant.name).attr('value', variant.name);
        }
    }
    return {
        init: noticeSoldout
    }
})()

// Sticky cart
theme.stickyCart = (function() {
    var $anchor = $('#js-anchor-sticky-cart'),
        $stCart = $('.sticky-cart-wr'),
        $close = $('#js-sticky-close'),
        disableStCart = localStorage.getItem('localDisableStCart') || '';
    if (disableStCart !== '') {
        $stCart.addClass('disable');
    }
    $close.on('click', function() {
        var isDisable = disableStCart !== '';
        if (isDisable) {
            localStorage.setItem('localDisableStCart', '');
        } else {
            localStorage.setItem('localDisableStCart', 'true');
        }
        $stCart.toggleClass('disable');
    })
    if ($anchor.length) {
        $(window).on('scroll', function() {
            var hT = $anchor.offset().top,
                hH = $anchor.outerHeight(),
                wH = $(window).height(),
                wS = $(this).scrollTop();
            if (wS > (hT + hH - wH)) {
                $stCart.addClass('active');
            } else {
                $stCart.removeClass('active');
            }
        });
    }

})()

//Fix reload safari
window.addEventListener("pageshow", function(evt) {
    if (evt.persisted) {
        setTimeout(function() {
            window.location.reload();
        }, 10);
    }
}, false);

// Back to top
theme.backToTop = (function() {
    var backtotopClass = $('.js-back-to-top');
    $(window).scroll(function() {
        if ($(this).scrollTop() > 300) {
            backtotopClass.fadeIn('slow');
        } else {
            backtotopClass.fadeOut('slow');
        }
    });
    backtotopClass.on('click', function() {
        $('body,html').animate({ scrollTop: 0 }, 800);
    });
})()


// Tooltip
theme.tooltip = (function() {
    var selector = '[data-toggle="tooltip"],[data-tooltip="true"]';

    function loadTooltip() {
        $(selector).tooltip(); //Bootstrap 4
    };
    $(document).on('click', selector, function() {
        $(this).tooltip('hide');
    });
    loadTooltip();
    return {
        load: loadTooltip
    }
})()

//Collections style 2
theme.Bgcollection = (function() {
    // init Isotope
    function Bgcollection(container) {
        var $container = this.$container = $(container);
        var sectionId = $container.attr('data-section-id');
        var wrapper = this.wrapper = '.bgcollection-wrapper';
        var slider = this.slider = '#Bgcollection-' + sectionId;
        var $slider = $(slider, wrapper);
        $(".colgrid__bg--full[data-index='1']").addClass('active');
        $('.colgrid .colgrid__box').each(function() {
            var index = $(this).attr("data-index");
            $(this).hover(
                function() {
                    $(".colgrid__bg--full[data-index='" + index + "']").addClass('active');
                },
                function() {
                    $(".colgrid__bg--full[data-index='" + index + "']").removeClass('active');
                }
            );
        });
    }

    return Bgcollection;
})();


//Sidebar
theme.sidebar = (function() {
    var togglebutton = '.js-toggle-filter',
        $sidebar = $('.js-sidebar');
    $(document).on('click', togglebutton, function() {
        $sidebar.toggleClass('active');
        $(this).toggleClass('active');
    })
})()

// Ajax filter in collection page
theme.ajaxFilter = (function() {
    var ajaxContent = '#js-product-ajax',
        ajaxSortBy = '#js-sortby',
        ajaxFillter = '#js-fillter',
        ajaxCollectionTitle = '.js-collection-title',
        pageTitle = $(document).find("title").text(),
        jsLoading = '#js-loading';

    var apollo = {
        init: function() {
            this.initFilter();
        },
        showLoading: function() {
            $(jsLoading).show();
        },
        hideLoading: function() {
            $('body,html').animate({
                scrollTop: $('#MainContent').offset().top - 150
            }, 600);
            setTimeout(function() {
                $(jsLoading).hide(); //delay 500ms for better UX
            }, 500);

        },
        initFilter: function() {
            apollo.filterParams();
            apollo.filterSortby();
            apollo.sidebarMapTagEvents();
            apollo.filterMapSorting();
            apollo.filterMapPaging();
        },
        filterParams: function() {
            Shopify.queryParams = {};
            if (location.search.length) {
                for (var aKeyValue, i = 0, aCouples = location.search.substr(1).split('&'); i < aCouples.length; i++) {
                    aKeyValue = aCouples[i].split('=');
                    if (aKeyValue.length > 1) {
                        Shopify.queryParams[decodeURIComponent(aKeyValue[0])] = decodeURIComponent(aKeyValue[1]);
                    }
                }
            }
        },
        filterSortby: function() {
            if (Shopify.queryParams.sort_by) {
                var sortby = Shopify.queryParams.sort_by;
                $(ajaxSortBy).val(sortby);
            }
        },
        filterCreateUrl: function(baseLink) {
            var newQuery = $.param(Shopify.queryParams).replace(/%2B/g, '+');
            if (baseLink) {
                if (newQuery != "") {
                    return baseLink + "?" + newQuery;
                } else {
                    return baseLink;
                }
            }
            return location.pathname + "?" + newQuery;
        },
        filterMapData: function(data) {
            // 1. update product grid
            $(ajaxContent).html($(ajaxContent, data.responseText).html());
            // 2. update left filter
            $(ajaxFillter).html($(ajaxFillter, data.responseText).html());
            // 3. update collection title
            $(ajaxCollectionTitle).html($(ajaxCollectionTitle, data.responseText).html());
        },
        filterAjaxClick: function(baseLink) {
            delete Shopify.queryParams.page;
            var newurl = apollo.filterCreateUrl(baseLink);
            History.pushState({
                param: Shopify.queryParams
            }, pageTitle, newurl);
            apollo.filterGetContent(newurl);
        },
        filterGetContent: function(newurl) {
            $.ajax({
                type: 'GET',
                url: newurl,
                data: {},
                beforeSend: function() {
                    apollo.showLoading();
                },
                complete: function(data) {
                    apollo.filterMapData(data);
                    theme.wishlist.load();
                    theme.compare.load();
                    theme.countdown.load();
                    theme.priceRange.load();
                    theme.tooltip.load();
                    theme.collectionView.triggerView();
                    theme.swatchCard2.load();
                    theme.infiniteScroll.load();
                    apollo.hideLoading();
                },
                error: function(xhr, text) {
                    apollo.hideLoading();
                    alert($.parseJSON(xhr.responseText).description);
                }
            });
        },
        sidebarMapTagEvents: function() {
            $(document).on('click', '.advanced-filter a', function(event) {
                event.preventDefault();
                $('.tooltip').removeClass('show');
                var currentTags = [];
                if (Shopify.queryParams.constraint) {
                    currentTags = Shopify.queryParams.constraint.split('+');
                }
                if (!$(this).parent().hasClass("active-filter")) {
                    var otherTag = $(this).parents('.catalog_filter_ul').find("li.active-filter");
                    if (otherTag.length > 0) {
                        var tagName = otherTag.data("handle");
                        if (tagName) {
                            var tagPos = currentTags.indexOf(tagName);
                            if (tagPos >= 0) {
                                currentTags.splice(tagPos, 1);
                            }
                        }
                    }
                }
                var dataHandle = $(this).parent().data("handle");
                if (dataHandle) {
                    var tagPos = currentTags.indexOf(dataHandle);
                    if (tagPos >= 0) {
                        currentTags.splice(tagPos, 1);
                    } else {
                        currentTags.push(dataHandle);
                    }
                }
                if (currentTags.length) {
                    Shopify.queryParams.constraint = currentTags.join('+');
                } else {
                    delete Shopify.queryParams.constraint;
                }
                apollo.filterAjaxClick();
            });
            $(document).on('click', '.advanced-filter .icon', function() {
                $(this).parent('.advanced-filter').find('a').trigger("click");
            });
        },
        filterMapSorting: function() {
            $(document).on('change', ajaxSortBy, function() {
                Shopify.queryParams.sort_by = $(this).val();
                apollo.filterAjaxClick();
            })
        },
        filterMapPaging: function() {
            $(document).on('click', '.js-pagination a', function() {
                event.preventDefault();
                var linkPage = $(this).attr("href").match(/page=\d+/g);
                if (linkPage) {
                    Shopify.queryParams.page = parseInt(linkPage[0].match(/\d+/g));
                    if (Shopify.queryParams.page) {
                        var newurl = apollo.filterCreateUrl();
                        History.pushState({
                            param: Shopify.queryParams
                        }, pageTitle, newurl);
                        apollo.filterGetContent(newurl);
                    }
                }
            });
        }
    }

    if ($(".template-collection")) {
        History.Adapter.bind(window, 'statechange', function() {
            var State = History.getState();
            apollo.filterParams();
        });
    }
    apollo.init();

})();
$(theme.init);  var htmlAlert = '<div class="media mt-2 alert--cart"><a class="mr-3" href="/cart"><img class="lazyload" data-src="' + item.image + '"></a><div class="media-body align-self-center"><p class="m-0 font-weight-bold">' + item.product_title + ' x ' + item.quantity + '</p>' + htmlVariant + '<div><div>';
                theme.alert.new(theme.strings.addToCartSuccess, htmlAlert, 3000, 'notice');
            } else {
                theme.crosssell.showPopup(item);
            }
        }
    };

    // Error handling reference from Shopify.onError in api.jquery.js
    cart.prototype.error = function(XMLHttpRequest) {
        var data = JSON.parse(XMLHttpRequest.responseText);

        if (data.message) {
            theme.alert.new('', data.description, 3000, 'warning');
        }
    };

    return cart;
})();

/*================ TEMPLATES ================*/
theme.customerTemplates = (function() {
    function initEventListeners() {
        // Show reset password form
        $('#RecoverPassword').on('click', function(evt) {
            evt.preventDefault();
            toggleRecoverPasswordForm();
        });

        // Hide reset password form
        $('#HideRecoverPasswordLink').on('click', function(evt) {
            evt.preventDefault();
            toggleRecoverPasswordForm();
        });
    }

    /**
     *
     *  Show/Hide recover password form
     *
     */
    function toggleRecoverPasswordForm() {
        $('#RecoverPasswordForm').toggleClass('hide');
        $('#CustomerLoginForm').toggleClass('hide');
    }

    /**
     *
     *  Show reset password success message
     *
     */
    function resetPasswordSuccess() {
        // check if reset password form was successfully submited
        if (!$('.reset-password-success').length) {
            return;
        }

        // show success message
        $('#ResetSuccess').removeClass('hide');
    }

    /**
     *
     *  Show/hide customer address forms
     *
     */
    function customerAddressForm() {
        var $newAddressForm = $('#AddressNewForm');

        if (!$newAddressForm.length) {
            return;
        }

        // Initialize observers on address selectors, defined in shopify_common.js
        if (Shopify) {
            // eslint-disable-next-line no-new
            new Shopify.CountryProvinceSelector(
                'AddressCountryNew',
                'AddressProvinceNew', {
                    hideElement: 'AddressProvinceContainerNew'
                }
            );
        }

        // Initialize each edit form's country/province selector
        $('.address-country-option').each(function() {
            var formId = $(this).data('form-id');
            var countrySelector = 'AddressCountry_' + formId;
            var provinceSelector = 'AddressProvince_' + formId;
            var containerSelector = 'AddressProvinceContainer_' + formId;

            // eslint-disable-next-line no-new
            new Shopify.CountryProvinceSelector(countrySelector, provinceSelector, {
                hideElement: containerSelector
            });
        });

        // Toggle new/edit address forms
        $('.address-new-toggle').on('click', function() {
            $newAddressForm.toggleClass('hide');
        });

        $('.address-edit-toggle').on('click', function() {
            var formId = $(this).data('form-id');
            $('#EditAddress_' + formId).toggleClass('hide');
        });

        $('.address-delete').on('click', function() {
            var $el = $(this);
            var formId = $el.data('form-id');
            var confirmMessage = $el.data('confirm-message');

            // eslint-disable-next-line no-alert
            if (
                confirm(
                    confirmMessage || 'Are you sure you wish to delete this address?'
                )
            ) {
                Shopify.postLink('/account/addresses/' + formId, {
                    parameters: { _method: 'delete' }
                });
            }
        });
    }

    /**
     *
     *  Check URL for reset password hash
     *
     */
    function checkUrlHash() {
        var hash = window.location.hash;

        // Allow deep linking to recover password form
        if (hash === '#recover') {
            toggleRecoverPasswordForm();
        }
    }

    return {
        init: function() {
            checkUrlHash();
            initEventListeners();
            resetPasswordSuccess();
            customerAddressForm();
        }
    };
})();

/*================ SECTIONS ================*/
theme.HeaderSection = (function() {
    function Header() {
        theme.NavDrawer = new window.Drawers('NavDrawer', 'left');
    }

    return Header;
})();

theme.Product = (function() {
    var defaults = {
        smallBreakpoint: 750,
        productThumbIndex: 0,
        productThumbMax: 0,
        ajaxCart: false,
        stockSetting: false
    };

    function Product(container) {
        var $container = (this.$container = $(container));
        var sectionId = $container.attr('data-section-id');

        this.selectors = {
            originalSelectorId: '#ProductSelect-' + sectionId,
            modal: 'ProductModal',
            productZoomImage: '#ProductZoomImg',
            addToCart: '#AddToCart-' + sectionId,
            productPrice: '#ProductPrice-' + sectionId,
            comparePrice: '#ComparePrice-' + sectionId,
            addToCartText: '#AddToCartText-' + sectionId,
            SKU: '.js-variant-sku',
            productImageContainers: '.product__photo-container-' + sectionId,
            productImageWrappers: '.product__photo-wrapper-' + sectionId,
            productThumbContainers: '.product-single__thumbnail-item-' + sectionId,
            productThumbsWrapper: '.product-single__thumbnails-' + sectionId,
            productThumbs: '.product-single__thumbnail-' + sectionId,
            saleTag: '#ProductSaleTag-' + sectionId,
            productStock: '#ProductStock-' + sectionId,
            singleOptionSelector: '.single-option-selector-' + sectionId,
            shopifyPaymentButton: '.shopify-payment-button',
            availability: '.product-single__availability',
            hurrify: '.js-hurrify'
        };

        this.settings = $.extend({}, defaults, {
            sectionId: sectionId,
            ajaxCart: $container.data('ajax'),
            stockSetting: $container.data('stock'),
            enableHistoryState: $container.data('enable-history-state') || false,
            namespace: '.product-' + sectionId
        });

        // Stop parsing if we don't have the product json script tag
        if (!$('#ProductJson-' + sectionId).html()) {
            return;
        }

        this.productSingleObject = JSON.parse(
            $('#ProductJson-' + sectionId).html()
        );
        this.addVariantInfo();

        this.init();
    }

    Product.prototype = _.assignIn({}, Product.prototype, {
        init: function() {
            this._stringOverrides();
            this._initVariants();
            this._productZoomImage();
            this._productThumbSwitch();
            this._productThumbnailSlider();
            this._initQtySelector();

            if (this.settings.ajaxCart) {
                theme.AjaxCart = new window.AjaxCart(
                    $('#AddToCartForm-' + this.settings.sectionId)
                );
            }
        },

        _stringOverrides: function() {
            window.productStrings = window.productStrings || {};
            $.extend(theme.strings, window.productStrings);
        },

        addVariantInfo: function() {
            if (!this.productSingleObject || !this.settings.stockSetting) {
                return;
            }

            var variantInfo = JSON.parse(
                $('#VariantJson-' + this.settings.sectionId).html()
            );

            for (var i = 0; i < variantInfo.length; i++) {
                $.extend(this.productSingleObject.variants[i], variantInfo[i]);
            }
        },

        _initVariants: function() {
            var options = {
                $container: this.$container,
                enableHistoryState: this.settings.enableHistoryState,
                product: this.productSingleObject,
                singleOptionSelector: this.selectors.singleOptionSelector,
                originalSelectorId: this.selectors.originalSelectorId
            };

            // eslint-disable-next-line no-new
            this.variants = new slate.Variants(options);

            this.$container.on(
                'variantChange' + this.settings.namespace,
                this._updateAddToCartBtn.bind(this)
            );
            this.$container.on(
                'variantChange' + this.settings.namespace,
                this._updateStickyCart.bind(this)
            );
            this.$container.on(
                'variantPriceChange' + this.settings.namespace,
                this._updatePrice.bind(this)
            );
            this.$container.on(
                'variantSKUChange' + this.settings.namespace,
                this._updateSKU.bind(this)
            );
            this.$container.on(
                'variantImageChange' + this.settings.namespace,
                this._updateImages.bind(this)
            );
        },

        _updateStock: function(variant) {
            if (!this.settings.stockSetting) return;

            var $stock = $(this.selectors.productStock),
                $hurrify = $(this.selectors.hurrify);

            // If we don't track variant inventory, hide stock
            if (!variant || !variant.inventory_management) {
                $stock.addClass('hide');
                $hurrify.addClass('hide');
                return;
            }

            if (variant.inventory_quantity < 10 && variant.inventory_quantity > 0) {
                $stock
                    .html(
                        theme.strings.stockAvailable.replace(
                            '1',
                            variant.inventory_quantity
                        )
                    )
                    .removeClass('hide');
                $hurrify.removeClass('hide').find('.progress-bar').css('width', variant.inventory_quantity * 10 + '%');
                return;
            }

            if (variant.inventory_quantity <= 0 && variant.incoming) {
                $stock
                    .html(
                        theme.strings.willNotShipUntil.replace(
                            '[date]',
                            variant.next_incoming_date
                        )
                    )
                    .removeClass('hide');
                $hurrify.addClass('hide');
                return;
            }

            // If there's more than 10 available, hide stock
            $stock.addClass('hide');
            $hurrify.addClass('hide');
        },

        _updateIncomingInfo: function(variant) {
            if (!this.settings.stockSetting) return;

            var $stock = $(this.selectors.productStock);

            if (variant.incoming) {
                $stock
                    .html(
                        theme.strings.willBeInStockAfter.replace(
                            '[date]',
                            variant.next_incoming_date
                        )
                    )
                    .removeClass('hide');
                return;
            }

            // If there is no stock incoming, hide stock
            $stock.addClass('hide');
        },

        _updateAddToCartBtn: function(evt) {
            var variant = evt.variant;

            var cache = {
                $addToCart: $(this.selectors.addToCart),
                $addToCartText: $(this.selectors.addToCartText)
            };

            if (variant) {
                // Select a valid variant if available
                theme.noticeSoldout.init(variant);
                if (variant.available) {
                    // We have a valid product variant, so enable the submit button
                    cache.$addToCart.removeClass('btn--sold-out').prop('disabled', false);
                    cache.$addToCartText.html(theme.strings.addToCart);
                    $(this.selectors.shopifyPaymentButton, this.$container).show();
                    // Show how many items are left, if below 10
                    this._updateStock(variant);
                    //update availability - available
                    $(this.selectors.availability).find('span').text(theme.strings.available);
                } else {
                    // Variant is sold out, disable the submit button
                    cache.$addToCart.prop('disabled', true).addClass('btn--sold-out');
                    cache.$addToCartText.html(theme.strings.soldOut);
                    $(this.selectors.shopifyPaymentButton, this.$container).hide();
                    // Update when stock will be available
                    this._updateIncomingInfo(variant);
                    //update availability - soldout
                    $(this.selectors.availability).find('span').text(theme.strings.soldOut);
                }
            } else {
                cache.$addToCart.prop('disabled', true).removeClass('btn--sold-out');
                cache.$addToCartText.html(theme.strings.unavailable);
                //update availability - unavailable
                $(this.selectors.availability).find('span').text(theme.strings.unavailable);
                $(this.selectors.shopifyPaymentButton, this.$container).hide();
                // Hide stock display
                this._updateStock();
            }
        },

        _updatePrice: function(evt) {
            var variant = evt.variant;

            if (variant) {
                $(this.selectors.productPrice).html(
                    theme.Currency.formatMoney(variant.price, theme.moneyFormat)
                );

                // Update and show the product's compare price if necessary
                if (variant.compare_at_price > variant.price) {
                    $(this.selectors.comparePrice)
                        .html(
                            theme.Currency.formatMoney(
                                variant.compare_at_price,
                                theme.moneyFormat
                            )
                        )
                        .removeClass('hide');
                    $(this.selectors.saleTag).removeClass('hide');
                } else {
                    $(this.selectors.comparePrice).addClass('hide');
                    $(this.selectors.saleTag).addClass('hide');
                }

                theme.updateCurrencies();
            } else {
                $(this.selectors.comparePrice).addClass('hide');
            }
        },

        _updateSKU: function(evt) {
            var variant = evt.variant;

            if (variant) {
                $(this.selectors.SKU).html(variant.sku);
            }
        },

        _updateImages: function(evt) {
            var variant = evt.variant;

            if (variant && variant.featured_image) {
                var imageId = variant.featured_image.id;
                this.switchProductImage(imageId);
                this.setActiveThumbnail(imageId);
            }
        },
        _updateStickyCart: function(evt) {
            var variant = evt.variant,
                $stickyPrice = $('#js-sticky-price'),
                $stickyTitle = $('#js-sticky-title'),
                $stickyImage = $('#js-sticky-img'),
                $stickyButton = $('#js-sticky-btn');
            if (variant) {
                //update title
                $stickyTitle.html(' - ' + variant.title);
                //update price
                $stickyPrice.html(theme.Currency.formatMoney(variant.price, theme.moneyFormat));
                //update selectbox
                for (var i = 1; i <= 3; i++) {
                    var option = 'option' + i,
                        $selecBox = '#js-sticky-option-' + i;
                    if (variant[option] !== null) {
                        var valueOption = variant[option];
                        $($selecBox).val(valueOption);
                    }
                }
                //update button cart
                if (variant.available) {
                    $stickyButton.prop('disabled', false).removeClass('btn--sold-out');
                    $stickyButton.html(theme.strings.addToCart);
                } else {
                    $stickyButton.prop('disabled', true).addClass('btn--sold-out');
                    $stickyButton.html(theme.strings.soldOut);
                }
                //update image
                if (variant.featured_image) {
                    $stickyImage.attr('src', theme.Images.getSizedImageUrl(variant.featured_image.src, '200x'));
                }
            } else {
                //update title
                $stickyTitle.html(' - ' + theme.strings.unavailable);
                //update button cart
                $stickyButton.prop('disabled', true).removeClass('btn--sold-out');
                $stickyButton.html(theme.strings.unavailable);
            }
        },

        switchProductImage: function(imageId) {
            var $imageToShow = $(
                this.selectors.productImageContainers +
                "[data-image-id='" +
                imageId +
                "']",
                this.$container
            );
            var $imagesToHide = $(
                this.selectors.productImageContainers +
                ":not([data-image-id='" +
                imageId +
                "'])",
                this.$container
            );
            $imagesToHide.addClass('hide');
            $imageToShow.removeClass('hide');
            //Scroll to active
            topMenuHeight = $('.site-header').outerHeight();
            if (this.settings.sectionId === 'product-template-8') {
                $([document.documentElement, document.body]).animate({
                    scrollTop: $imageToShow.offset().top - topMenuHeight
                }, 500);
            }
        },

        setActiveThumbnail: function(imageId) {
            var $thumbnailToShow = $(
                this.selectors.productThumbContainers +
                "[data-image-id='" +
                imageId +
                "']",
                this.$container
            );
            var $thumbnailsToHide = $(
                this.selectors.productThumbContainers +
                ":not([data-image-id='" +
                imageId +
                "'])",
                this.$container
            );
            $thumbnailsToHide.removeClass('is-active');
            $thumbnailToShow.addClass('is-active');
            $thumbnailToShow.trigger('click');
            var $thumbnails = $(this.selectors.productThumbsWrapper, this.$container);

            // If there is a slick carousel, get the slide index, and position it into view with animation.
            if ($thumbnails.hasClass('slick-initialized')) {
                // eslint-disable-next-line shopify/jquery-dollar-sign-reference
                var currentActiveSlideIndex = $thumbnails.slick('slickCurrentSlide');
                var newActiveSlideIndex = parseInt(
                    $thumbnailToShow.attr('data-slick-index')
                );
                if (currentActiveSlideIndex !== newActiveSlideIndex) {
                    $thumbnails.slick('slickGoTo', newActiveSlideIndex, false);

                }
            }
        },

        _productZoomImage: function() {
            // The zoom image is only used on the product template, so return early
            // even if a featured product section is present.
            if (!$('.product-single ' + this.selectors.productImageContainers).length) {
                return;
            }

            var self = this;

            $(this.selectors.productImageWrappers).on(
                'click' + this.settings.namespace,
                function(evt) {
                    evt.preventDefault();
                    // Empty src before loadig new image to avoid awkward image swap
                    $(self.selectors.productZoomImage)
                        .attr('src', '')
                        .attr('src', $(this).attr('href'));
                }
            );

            this.ProductModal = new window.Modals(
                this.selectors.modal,
                'product-modal'
            );

            // Close modal if clicked, but not if the image is clicked
            this.ProductModal.$modal.on('click' + this.settings.namespace, function(
                evt
            ) {
                if (evt.target.nodeName !== 'IMG') {
                    self.ProductModal.close();
                }
            });
        },

        _productThumbSwitch: function() {
            if (!$(this.selectors.productThumbs).length) {
                return;
            }

            var self = this;

            $(this.selectors.productThumbs).on(
                'click' + this.settings.namespace,
                function(evt) {
                    evt.preventDefault();
                    var imageId = $(this)
                        .parent()
                        .data('image-id');
                    self.setActiveThumbnail(imageId);
                    self.switchProductImage(imageId);
                }
            );
            //trigger hover thumb
            // $(this.selectors.productThumbs).on('click',function(){
            //   $(this).trigger('click');
            // });
        },

        /*
          Thumbnail slider
         */
        _productThumbnailSlider: function() {
            var $productThumbsWrapper = $(this.selectors.productThumbsWrapper);
            var $productThumbs = $(this.selectors.productThumbs);
            if (!$productThumbs.length) {
                return;
            }

            if ($productThumbs.length > 1) {
                $productThumbsWrapper.on(
                    'init' + this.settings.namespace,
                    this._productSwipeInit.bind(this)
                );

                if (this.settings.sectionId === 'product-template-3' || this.settings.sectionId === 'product-template-4') {
                    $productThumbsWrapper.slick({
                        accessibility: false,
                        arrows: true,
                        dots: false,
                        infinite: false,
                        autoplay: false,
                        slidesToShow: 5,
                        slidesToScroll: 5,
                        vertical: true,
                        verticalSwiping: true,
                        responsive: [{
                            breakpoint: 992,
                            settings: {
                                vertical: false,
                                verticalSwiping: false,
                                slidesToShow: 4,
                                slidesToScroll: 4,
                                dots: false,
                            }
                        }]
                    }).css('opacity', '1');
                } else if (this.settings.sectionId === 'product-template-5') {
                    $productThumbsWrapper.slick({
                        accessibility: false,
                        arrows: true,
                        dots: false,
                        infinite: true,
                        autoplay: false,
                        slidesToShow: 2,
                        slidesToScroll: 1,
                        responsive: [{
                            breakpoint: 992,
                            settings: {
                                slidesToShow: 4,
                                slidesToScroll: 4,
                                dots: false,
                            }
                        }]
                    }).css('opacity', '1');
                } else if (this.settings.sectionId === 'product-template-7') {
                    $productThumbsWrapper.slick({
                        accessibility: false,
                        arrows: true,
                        dots: true,
                        infinite: true,
                        autoplay: false,
                        slidesToShow: 1,
                        slidesToScroll: 1,
                        responsive: [{
                            breakpoint: 992,
                            settings: {
                                slidesToShow: 1,
                                slidesToScroll: 1,
                                dots: false,
                                arrows: true,
                            }
                        }]
                    }).css('opacity', '1');
                } else if (this.settings.sectionId === 'product-template-8') {
                    var lastId,
                        topMenu = $(".product-single__thumbnails"),
                        topMenuHeight = $('.site-header').outerHeight() + 20,
                        // All list items
                        menuItems = topMenu.find(".product-single__thumbnail");


                    if ($(window).width() > 767) {
                        menuItems.click(function(e) {
                            var findid = $(this).attr('href');
                            offsetTop = $(findid).offset().top - topMenuHeight + 1;
                            $('html, body').stop().animate({
                                scrollTop: offsetTop
                            }, 200);
                            return false;
                        });
                        // Anchors corresponding to menu items
                        scrollItems = menuItems.map(function() {
                            var item = $($(this).attr('href'));
                            if (item.length) { return item; }
                        });

                        $(window).scroll(function() {
                            // Get container scroll position
                            var fromTop = $(this).scrollTop() + topMenuHeight;
                            // Get id of current scroll item
                            var cur = scrollItems.map(function() {
                                if ($(this).offset().top < fromTop)
                                    return this;
                            });
                            // Get the id of the current element
                            cur = cur[cur.length - 1];
                            var id = cur && cur.length ? cur[0].id : "";

                            if (lastId !== id) {
                                lastId = id;
                                // Set/remove active class
                                menuItems
                                    .parent().removeClass("is-active")
                                    .end().filter("[href='#" + id + "']").parent().addClass("is-active");
                            }
                        });
                    } else {
                        menuItems.click(function(e) {
                            var findid = $(this).attr('href');
                            offsetTop = $(findid).offset().top;
                            $('html, body').stop().animate({
                                scrollTop: offsetTop
                            });
                            return false;
                        });
                    }

                    $productThumbsWrapper.slick({
                        accessibility: false,
                        arrows: true,
                        dots: false,
                        infinite: false,
                        autoplay: false,
                        slidesToShow: 5,
                        slidesToScroll: 1,
                        vertical: true,
                        verticalSwiping: true,
                        responsive: [{
                            breakpoint: 992,
                            settings: {
                                vertical: false,
                                verticalSwiping: false,
                                slidesToShow: 4,
                                slidesToScroll: 4,
                                dots: true,
                            }
                        }]
                    }).css('opacity', '1');
                } else {
                    $productThumbsWrapper.slick({
                        accessibility: false,
                        arrows: true,
                        dots: false,
                        infinite: false,
                        autoplay: false,
                        slidesToShow: 4,
                        slidesToScroll: 4
                    }).css('opacity', '1');
                }

                // Show highlighted thumbnail by repositioning slider
                $productThumbsWrapper.slick(
                    'slickGoTo',
                    $productThumbsWrapper.find('.is-active').attr('data-slick-index'),
                    true
                );
            }
        },

        _productSwipeInit: function(evt, obj) {
            // Slider is initialized. Setup custom swipe events
            this.settings.productThumbIndex = obj.currentSlide;
            this.settings.productThumbMax = obj.slideCount - 1; // we need the 0-based index

            var self = this;

            $(this.selectors.productImageWrappers).on(
                'swipeleft swiperight',
                function(event) {
                    if (event.type === 'swipeleft') {
                        self._goToNextThumbnail();
                    }

                    if (event.type === 'swiperight') {
                        self._goToPrevThumbnail();
                    }

                    // Trigger click on newly requested thumbnail
                    $(
                            '.product-single__thumbnail-item[data-slick-index="' +
                            self.settings.productThumbIndex +
                            '"]'
                        )
                        .find('.product-single__thumbnail')
                        .trigger('click');

                }
            );
        },
        _goToNextThumbnail: function() {
            this.settings.productThumbIndex++;

            if (this.settings.productThumbIndex > this.settings.productThumbMax) {
                this.settings.productThumbIndex = 0;
            }

            $(this.selectors.productThumbsWrapper).slick(
                'slickGoTo',
                this.settings.productThumbIndex,
                true
            );
        },

        _goToPrevThumbnail: function() {
            this.settings.productThumbIndex--;

            if (this.settings.productThumbIndex < 0) {
                this.settings.productThumbIndex = this.settings.productThumbMax;
            }

            $(this.selectors.productThumbsWrapper).slick(
                'slickGoTo',
                this.settings.productThumbIndex,
                true
            );
        },

        _initQtySelector: function() {
            this.$container.find('.product-form__quantity').each(function(i, el) {
                // eslint-disable-next-line no-new
                new QtySelector($(el));
            });
        },

        onUnload: function() {
            $(this.selectors.productImageWrappers).off(this.settings.namespace);
            $(this.selectors.productThumbs).off(this.settings.namespace);
            $(this.selectors.productThumbs).slick('unslick');
            if (this.ProductModal) {
                this.ProductModal.$modal.off(this.settings.namespace);
            }
        }
    });

    return Product;
})();

theme.Slideshow = (function() {
    this.$slideshow = null;
    var classes = {
        slideshow: 'slideshow',
        slickActiveMobile: 'slick-active-mobile',
        controlsHover: 'slideshow__controls--hover',
        isPaused: 'is-paused'
    };

    var selectors = {
        section: '.shopify-section',
        wrapper: '#SlideshowWrapper-',
        slides: '.slideshow__slide',
        textWrapperMobile: '.slideshow__text-wrap--mobile',
        textContentMobile: '.slideshow__text-content--mobile',
        controls: '.slideshow__controls',
        dots: '.slick-dots',
        arrowLeft: '.slideshow__arrow-left',
        arrowRight: '.slideshow__arrow-right'
    };

    function slideshow(el, sectionId) {
        var $slideshow = (this.$slideshow = $(el));
        this.adaptHeight = this.$slideshow.data('adapt-height');
        this.$wrapper = this.$slideshow.closest(selectors.wrapper + sectionId);
        this.$section = this.$wrapper.closest(selectors.section);
        this.$controls = this.$wrapper.find(selectors.controls);
        this.$textWrapperMobile = this.$section.find(selectors.textWrapperMobile);
        this.autorotate = this.$slideshow.data('autorotate');
        var autoplaySpeed = this.$slideshow.data('speed');
        var loadSlideA11yString = this.$slideshow.data('slide-nav-a11y');

        this.settings = {
            rtl: theme.rtl,
            accessibility: true,
            arrows: true,
            dots: true,
            fade: (theme.rtl ? false : true),
            draggable: true,
            touchThreshold: 20,
            autoplay: this.autorotate,
            autoplaySpeed: autoplaySpeed
        };

        this.$slideshow.on('beforeChange', beforeChange.bind(this));
        this.$slideshow.on('init', slideshowA11ySetup.bind(this));

        // Add class to style mobile dots & show the correct text content for the
        // first slide on mobile when the slideshow initialises
        this.$slideshow.on(
            'init',
            function() {
                this.$mobileDots
                    .find('li:first-of-type')
                    .addClass(classes.slickActiveMobile);
                this.showMobileText(0);
            }.bind(this)
        );

        if (this.adaptHeight) {
            this.setSlideshowHeight();
            $(window).resize($.debounce(50, this.setSlideshowHeight.bind(this)));
        }

        this.$slideshow.slick(this.settings);

        // This can't be called when the slick 'init' event fires due to how slick
        // adds a11y features.
        slideshowPostInitA11ySetup.bind(this)();
    }

    function slideshowA11ySetup(event, obj) {
        var $slider = obj.$slider;
        var $list = obj.$list;
        this.$dots = this.$section.find(selectors.dots);
        this.$mobileDots = this.$dots.eq(1);

        // Remove default Slick aria-live attr until slider is focused
        $list.removeAttr('aria-live');

        //     this.$wrapper.on('keyup', keyboardNavigation.bind(this));
        //     this.$controls.on('keyup', keyboardNavigation.bind(this));
        //     this.$textWrapperMobile.on('keyup', keyboardNavigation.bind(this));

        // When an element in the slider is focused
        // pause slideshow and set aria-live.
        this.$wrapper
            .on(
                'focusin',
                function(evt) {
                    if (!this.$wrapper.has(evt.target).length) {
                        return;
                    }

                    $list.attr('aria-live', 'polite');
                    if (this.autorotate) {
                        $slider.slick('slickPause');
                    }
                }.bind(this)
            )
            .on(
                'focusout',
                function(evt) {
                    if (!this.$wrapper.has(evt.target).length) {
                        return;
                    }

                    $list.removeAttr('aria-live');
                }.bind(this)
            );

        // Add arrow key support when focused
        if (this.$dots) {
            this.$dots
                .find('a')
                .each(function() {
                    var $dot = $(this);
                    $dot.on('click keyup', function(evt) {
                        if (
                            evt.type === 'keyup' &&
                            evt.which !== slate.utils.keyboardKeys.ENTER
                        )
                            return;

                        evt.preventDefault();

                        var slideNumber = $(evt.target).data('slide-number');

                        $slider.attr('tabindex', -1).slick('slickGoTo', slideNumber);

                        if (evt.type === 'keyup') {
                            $slider.focus();
                        }
                    });
                })
                .eq(0)
                .attr('aria-current', 'true');
        }

        this.$controls
            .on('focusin', highlightControls.bind(this))
            .on('focusout', unhighlightControls.bind(this));
    }

    function slideshowPostInitA11ySetup() {
        var $slides = this.$slideshow.find(selectors.slides);

        $slides.removeAttr('role').removeAttr('aria-labelledby');
        this.$dots
            .removeAttr('role')
            .find('li')
            .removeAttr('role')
            .removeAttr('aria-selected')
            .each(function() {
                var $dot = $(this);
                var ariaControls = $dot.attr('aria-controls');
                $dot
                    .removeAttr('aria-controls')
                    .find('a')
                    .attr('aria-controls', ariaControls);
            });
    }

    function beforeChange(event, slick, currentSlide, nextSlide) {
        var $dotLinks = this.$dots.find('a');
        var $mobileDotLinks = this.$mobileDots.find('li');

        $dotLinks
            .removeAttr('aria-current')
            .eq(nextSlide)
            .attr('aria-current', 'true');

        $mobileDotLinks
            .removeClass(classes.slickActiveMobile)
            .eq(nextSlide)
            .addClass(classes.slickActiveMobile);
        this.showMobileText(nextSlide);
    }

    //   function keyboardNavigation() {
    //     if (event.keyCode === slate.utils.keyboardKeys.LEFTARROW) {
    //       this.$slideshow.slick('slickPrev');
    //     }
    //     if (event.keyCode === slate.utils.keyboardKeys.RIGHTARROW) {
    //       this.$slideshow.slick('slickNext');
    //     }
    //   }

    function highlightControls() {
        this.$controls.addClass(classes.controlsHover);
    }

    function unhighlightControls() {
        this.$controls.removeClass(classes.controlsHover);
    }

    slideshow.prototype.setSlideshowHeight = function() {
        var minAspectRatio = this.$slideshow.data('min-aspect-ratio');
        this.$slideshow.height($(document).width() / minAspectRatio);
    };

    slideshow.prototype.showMobileText = function(slideIndex) {
        var $allTextContent = this.$textWrapperMobile.find(
            selectors.textContentMobile
        );
        var currentTextContentSelector =
            selectors.textContentMobile + '-' + slideIndex;
        var $currentTextContent = this.$textWrapperMobile.find(
            currentTextContentSelector
        );
        if (!$currentTextContent.length &&
            this.$slideshow.find(selectors.slides).length === 1
        ) {
            this.$textWrapperMobile.hide();
        } else {
            this.$textWrapperMobile.show();
        }
        $allTextContent.hide();
        $currentTextContent.show();
    };

    function getSlideshowId($el) {
        return '#Slideshow-' + $el.data('id');
    }

    return slideshow;
})();

theme.slideshows = {};

theme.SlideshowSection = (function() {
    function SlideshowSection(container) {
        var $container = (this.$container = $(container));
        var sectionId = $container.attr('data-section-id');
        var slideshow = (this.slideshow = '#Slideshow-' + sectionId);

        theme.slideshows[slideshow] = new theme.Slideshow(slideshow, sectionId);
    }

    return SlideshowSection;
})();

theme.SlideshowSection.prototype = _.assignIn({},
    theme.SlideshowSection.prototype, {
        onUnload: function() {
            delete theme.slideshows[this.slideshow];
        },

        onBlockSelect: function(evt) {
            var $slideshow = $(this.slideshow);
            var adaptHeight = $slideshow.data('adapt-height');

            if (adaptHeight) {
                theme.slideshows[this.slideshow].setSlideshowHeight();
            }

            // Ignore the cloned version
            var $slide = $(
                '.slideshow__slide--' + evt.detail.blockId + ':not(.slick-cloned)'
            );
            var slideIndex = $slide.data('slick-index');

            // Go to selected slide, pause auto-rotate
            $slideshow.slick('slickGoTo', slideIndex).slick('slickPause');
        },

        onBlockDeselect: function() {
            // Resume auto-rotate
            $(this.slideshow).slick('slickPlay');
        }
    }
);

theme.slideshows = {};

theme.Cart = (function() {
    var selectors = {
        cartNote: '#CartSpecialInstructions',
        cartQtyInput: '.cart__quantity',
        cartNoCookiesClass: 'cart--no-cookies'
    };

    function Cart(container) {
        var $container = (this.$container = $(container));
        var sectionId = $container.attr('data-section-id');

        theme.cartObject = JSON.parse($('#CartJson-' + sectionId).html());

        this.init($container);
    }

    Cart.prototype = _.assignIn({}, Cart.prototype, {
        init: function($container) {
            this._initQtySelector();
            this._initCartNote();

            if (!this._cookiesEnabled()) {
                $container.addClass(selectors.cartNoCookiesClass);
            }
        },

        _initQtySelector: function() {
            $(selectors.cartQtyInput).each(function(i, el) {
                // eslint-disable-next-line no-new
                new QtySelector($(el));
            });
        },

        _initCartNote: function() {
            if (!$(selectors.cartNote).length) {
                return;
            }

            var $el = $(selectors.cartNote);
            var noteText;
            var params;
            var noteOffset = $el[0].offsetHeight - $el[0].clientHeight;

            // Auto grow the cart note if text fills it up
            $el.on('keyup input', function() {
                $(this)
                    .css('height', 'auto')
                    .css('height', $el[0].scrollHeight + noteOffset);
            });

            // Save the cart note via ajax. A safeguard in case
            // a user decides to leave the page before clicking 'Update Cart'
            $el.on(
                'change',
                $.proxy(function() {
                    noteText = $el.val();
                    params = {
                        type: 'POST',
                        url: '/cart/update.js',
                        data: 'note=' + this._attributeToString(noteText),
                        dataType: 'json'
                    };
                    $.ajax(params);
                }, this)
            );
        },

        _attributeToString: function(attr) {
            if (typeof attr !== 'string') {
                attr = String(attr);
                if (attr === 'undefined') {
                    attr = '';
                }
            }
            return $.trim(attr);
        },

        _cookiesEnabled: function() {
            var cookieEnabled = navigator.cookieEnabled;

            if (!cookieEnabled) {
                document.cookie = 'testcookie';
                cookieEnabled = document.cookie.indexOf('testcookie') !== -1;
            }
            return cookieEnabled;
        }
    });

    return Cart;
})();

// Instagrams
theme.Instagrams = (function() {
    function Instagrams(container) {
        this.$container = $(container).on('init', this._a11y.bind(this));
        //console.log(this.$container);
        this.settings = {
            style: this.$container.data('style'),
            accesstoken: this.$container.data('accesstoken'),
            userid: this.$container.data('userid'),
            limit: this.$container.data('limit'),
            resolution: this.$container.data('resolution'),
            target: this.$container.attr('id'),
            rows: this.$container.data('rows'),

            slidesToShow: this.$container.data('slidestoshow') || 1,
            infinite: this.$container.data('infinite') || false,
            arrows: this.$container.data('arrows') || false,
            draggable: this.$container.data('draggable') || false,
            dots: this.$container.data('dots') || false,
        }
        this.settings.slidesToShow1200 = (this.settings.slidesToShow - 1) > 1 ? (this.settings.slidesToShow - 1) : 1;
        this.settings.slidesToShow992 = (this.settings.slidesToShow - 2) > 1 ? (this.settings.slidesToShow - 2) : 1;
        this.settings.slidesToShow768 = (this.settings.slidesToShow - 3) > 1 ? (this.settings.slidesToShow - 3) : 1;
        this.settings.slidesToShow480 = 2;

        var _self = this;
        var $instagramSelector = $('#' + this.settings.target);
        if (this.settings.style === 'grid') {
            var afterInstagram = function() {} // blank function
        } else if (this.settings.style === 'carousel') {
            var afterInstagram = function() {
                $instagramSelector.slick({
                    slidesToShow: _self.settings.slidesToShow,
                    slidesToScroll: _self.settings.slidesToShow,
                    arrows: _self.settings.arrows,
                    dots: _self.settings.dots,
                    draggable: _self.settings.draggable,
                    infinite: _self.settings.infinite,
                    rows: _self.settings.rows,
                    responsive: [{
                            breakpoint: 1200,
                            settings: {
                                slidesToShow: _self.settings.slidesToShow1200,
                                slidesToScroll: _self.settings.slidesToShow1200,
                            }
                        },
                        {
                            breakpoint: 992,
                            settings: {
                                slidesToShow: _self.settings.slidesToShow992,
                                slidesToScroll: _self.settings.slidesToShow992,
                            }
                        },
                        {
                            breakpoint: 768,
                            settings: {
                                slidesToShow: _self.settings.slidesToShow768,
                                slidesToScroll: _self.settings.slidesToShow768,
                            }
                        },
                        {
                            breakpoint: 480,
                            settings: {
                                slidesToShow: _self.settings.slidesToShow480,
                                slidesToScroll: _self.settings.slidesToShow480,
                            }
                        }
                    ]
                })
            }
        }

        var feed = new Instafeed({
            get: 'user',
            target: this.settings.target,
            userId: this.settings.userid,
            accessToken: this.settings.accesstoken,
            limit: this.settings.limit,
            resolution: this.settings.resolution,
            template: '<div class="col hv-image-brightness"><a class="instagram-item" href="{{link}}" target="_blank" id="{{id}}"><img alt="instagram image" class="transition lazyload" data-src="{{image}}" /></a></div>',
            after: afterInstagram
        });

        feed.run();
    }

    Instagrams.prototype = _.assignIn({}, Instagrams.prototype, {
        _a11y: function(event, obj) {
            var $list = obj.$list;
            var $wrapper = this.$container.parent();

            // Remove default Slick aria-live attr until slider is focused
            $list.removeAttr('aria-live');

            // When an element in the slider is focused set aria-live
            $wrapper.on('focusin', function(evt) {
                if ($wrapper.has(evt.target).length) {
                    $list.attr('aria-live', 'polite');
                }
            });

            // Remove aria-live
            $wrapper.on('focusout', function(evt) {
                if ($wrapper.has(evt.target).length) {
                    $list.removeAttr('aria-live');
                }
            });
        }
    });

    return Instagrams;
})();

// Slick carousel
theme.slickCarousel = (function() {
    function Carousels(container) {
        this.$container = $(container).on('init', this._a11y.bind(this));
        this.settings = {
            rows: this.$container.data('rows') || 1,
            slidesToShow: this.$container.data('slidestoshow') || 1,
            slidesToScroll: this.$container.data('slidestoscroll') || 1,
            infinite: this.$container.data('infinite') || false,
            arrows: this.$container.data('arrows') || false,
            dots: this.$container.data('dots') || false,
            autoplay: this.$container.data('autoplay') || false,
            draggable: this.$container.data('draggable') || false,
            accessibility: this.$container.data('accessibility') || true,
        }
        this.settings.slidesToShow1200 = (this.settings.slidesToShow - 1) > 1 ? (this.settings.slidesToShow - 1) : 1;
        this.settings.slidesToShow992 = (this.settings.slidesToShow - 2) > 1 ? (this.settings.slidesToShow - 2) : 1;
        this.settings.slidesToShow768 = (this.settings.slidesToShow - 3) > 1 ? (this.settings.slidesToShow - 3) : 1;
        this.settings.slidesToShow480 = (this.settings.slidesToShow - 4) > 1 ? (this.settings.slidesToShow - 4) : 1;
        this.settings.slidesToScroll1200 = (this.settings.slidesToScroll - 1) > 1 ? (this.settings.slidesToScroll - 1) : 1;
        this.settings.slidesToScroll992 = (this.settings.slidesToScroll - 2) > 1 ? (this.settings.slidesToScroll - 2) : 1;
        this.settings.slidesToScroll768 = (this.settings.slidesToScroll - 3) > 1 ? (this.settings.slidesToScroll - 3) : 1;
        this.settings.slidesToScroll480 = (this.settings.slidesToScroll - 4) > 1 ? (this.settings.slidesToScroll - 4) : 1;
        this.$container.slick({
            rtl: theme.rtl,
            rows: this.settings.rows,
            slidesToShow: this.settings.slidesToShow,
            slidesToScroll: this.settings.slidesToScroll,
            arrows: this.settings.arrows,
            dots: this.settings.dots,
            autoplay: this.settings.autoplay,
            accessibility: this.settings.accessibility,
            draggable: this.settings.draggable,
            infinite: this.settings.infinite,
            adaptiveHeight: true,
            responsive: [{
                    breakpoint: 1200,
                    settings: {
                        slidesToShow: this.settings.slidesToShow1200,
                        slidesToScroll: this.settings.slidesToScroll1200
                    }
                },
                {
                    breakpoint: 992,
                    settings: {
                        slidesToShow: this.settings.slidesToShow992,
                        slidesToScroll: this.settings.slidesToScroll992
                    }
                },
                {
                    breakpoint: 768,
                    settings: {
                        slidesToShow: this.settings.slidesToShow768,
                        slidesToScroll: this.settings.slidesToScroll768
                    }
                },
                {
                    breakpoint: 480,
                    settings: {
                        slidesToShow: 1,
                        slidesToScroll: this.settings.slidesToScroll480
                    }
                }
            ]
        })
    }

    Carousels.prototype = _.assignIn({}, Carousels.prototype, {
        _a11y: function(event, obj) {
            var $list = obj.$list;
            var $wrapper = this.$container.parent();

            // Remove default Slick aria-live attr until slider is focused
            $list.removeAttr('aria-live');

            // When an element in the slider is focused set aria-live
            $wrapper.on('focusin', function(evt) {
                if ($wrapper.has(evt.target).length) {
                    $list.attr('aria-live', 'polite');
                }
            });

            // Remove aria-live
            $wrapper.on('focusout', function(evt) {
                if ($wrapper.has(evt.target).length) {
                    $list.removeAttr('aria-live');
                }
            });
        },

        _goToSlide: function(slideIndex) {
            this.$container.slick('slickGoTo', slideIndex);
        },

        onUnload: function() {
            delete this.$container;
        },

        onBlockSelect: function(evt) {
            // Ignore the cloned version
            var $slide = $(
                '.carousel__slide-wrapper--' + evt.detail.blockId + ':not(.slick-cloned)'
            );
            var slideIndex = $slide.data('slick-index');

            // Go to selected slide, pause autoplay
            this._goToSlide(slideIndex);

        }
    });

    return Carousels;
})()

// Productlists
theme.Productlists = (function() {
    function Productlists(container) {
        this.$container = $(container).on('init', this._a11y.bind(this));
        this.settings = {
            slidesToShow: this.$container.data('slidestoshow') || 1,
            rows: this.$container.data('rows') || 1,
            arrows: this.$container.data('arrows') || false,
            dots: this.$container.data('dots') || false,
            draggable: this.$container.data('draggable') || false,
            infinite: this.$container.data('infinite') || false,
        }
        this.settings.slidesToShow1200 = (this.settings.slidesToShow - 1) > 1 ? (this.settings.slidesToShow - 1) : 1;
        this.settings.slidesToShow992 = (this.settings.slidesToShow - 2) > 1 ? (this.settings.slidesToShow - 2) : 1;
        this.settings.slidesToShow768 = (this.settings.slidesToShow - 3) > 1 ? (this.settings.slidesToShow - 3) : 1;
        this.settings.slidesToShow480 = 2;
        this.$container.slick({
            rtl: theme.rtl,
            accessibility: true,
            slidesToShow: this.settings.slidesToShow,
            slidesToScroll: this.settings.slidesToShow,
            rows: this.settings.rows,
            arrows: this.settings.arrows,
            dots: this.settings.dots,
            infinite: this.settings.infinite,
            draggable: this.settings.draggable,
            responsive: [{
                    breakpoint: 1200,
                    settings: {
                        slidesToShow: this.settings.slidesToShow1200,
                        slidesToScroll: this.settings.slidesToShow1200
                    }
                },
                {
                    breakpoint: 992,
                    settings: {
                        slidesToShow: this.settings.slidesToShow992,
                        slidesToScroll: this.settings.slidesToShow992
                    }
                },
                {
                    breakpoint: 768,
                    settings: {
                        slidesToShow: this.settings.slidesToShow768,
                        slidesToScroll: this.settings.slidesToShow768
                    }
                },
                {
                    breakpoint: 480,
                    settings: {
                        slidesToShow: this.settings.slidesToShow480,
                        slidesToScroll: this.settings.slidesToShow480
                    }
                }
            ]
        }).css('opacity', '1');
    }

    Productlists.prototype = _.assignIn({}, Productlists.prototype, {
        _a11y: function(event, obj) {
            var $list = obj.$list;
            var $wrapper = this.$container.parent();

            // Remove default Slick aria-live attr until slider is focused
            $list.removeAttr('aria-live');

            // When an element in the slider is focused set aria-live
            $wrapper.on('focusin', function(evt) {
                if ($wrapper.has(evt.target).length) {
                    $list.attr('aria-live', 'polite');
                }
            });

            // Remove aria-live
            $wrapper.on('focusout', function(evt) {
                if ($wrapper.has(evt.target).length) {
                    $list.removeAttr('aria-live');
                }
            });
        },

        _goToSlide: function(slideIndex) {
            this.$container.slick('slickGoTo', slideIndex);
        },

        onUnload: function() {
            delete this.$container;
        }
    });

    return Productlists;
})();

// Producttabs
theme.Producttabs = (function() {
    function Producttabs(container) {
        var _self = this; // avoid conflict
        this.$container = $(container).on('init', this._a11y.bind(this));
        this.slickWrap = '.prdtab-content';
        this.settings = {
            slidesToShow: this.$container.data('slidestoshow') || 1,
            arrows: this.$container.data('arrows') || false,
            rows: this.$container.data('rows') || 1,
            dots: this.$container.data('dots') || false,
            draggable: this.$container.data('draggable') || false,
            infinite: this.$container.data('infinite') || false,
        }
        this.settings.slidesToShow1200 = (this.settings.slidesToShow - 1) > 1 ? (this.settings.slidesToShow - 1) : 1;
        this.settings.slidesToShow992 = (this.settings.slidesToShow - 2) > 1 ? (this.settings.slidesToShow - 2) : 1;
        this.settings.slidesToShow768 = (this.settings.slidesToShow - 3) > 1 ? (this.settings.slidesToShow - 3) : 1;
        this.settings.slidesToShow480 = 2;

        this._initSlick();
        this.$container.find('a[data-toggle="tab"]').on("shown.bs.tab", function(e) {
            _self._unSlick();
            _self._initSlick();
            theme.tooltip.load();
        })
    }

    Producttabs.prototype = _.assignIn({}, Producttabs.prototype, {
        _a11y: function(event, obj) {
            var $list = obj.$list;
            var $wrapper = this.$container.parent();

            // Remove default Slick aria-live attr until slider is focused
            $list.removeAttr('aria-live');

            // When an element in the slider is focused set aria-live
            $wrapper.on('focusin', function(evt) {
                if ($wrapper.has(evt.target).length) {
                    $list.attr('aria-live', 'polite');
                }
            });

            // Remove aria-live
            $wrapper.on('focusout', function(evt) {
                if ($wrapper.has(evt.target).length) {
                    $list.removeAttr('aria-live');
                }
            });
        },

        _getSliderSettings: function() {
            return {
                rtl: theme.rtl,
                accessibility: true,
                slidesToShow: this.settings.slidesToShow,
                slidesToScroll: this.settings.slidesToShow,
                arrows: this.settings.arrows,
                rows: this.settings.rows,
                dots: this.settings.dots,
                infinite: this.settings.infinite,
                draggable: this.settings.draggable,
                responsive: [{
                        breakpoint: 1200,
                        settings: {
                            slidesToShow: this.settings.slidesToShow1200,
                            slidesToScroll: this.settings.slidesToShow1200
                        }
                    },
                    {
                        breakpoint: 992,
                        settings: {
                            slidesToShow: this.settings.slidesToShow992,
                            slidesToScroll: this.settings.slidesToShow992
                        }
                    },
                    {
                        breakpoint: 768,
                        settings: {
                            slidesToShow: this.settings.slidesToShow768,
                            slidesToScroll: this.settings.slidesToShow768
                        }
                    },
                    {
                        breakpoint: 480,
                        settings: {
                            slidesToShow: this.settings.slidesToShow480,
                            slidesToScroll: this.settings.slidesToShow480
                        }
                    }
                ]
            }
        },

        _initSlick: function() {
            this.$container.find(this.slickWrap).slick(this._getSliderSettings()).css('opacity', '1');
        },

        _unSlick: function() {
            this.$container.find(this.slickWrap).slick('unslick');
        },

        onUnload: function() {
            delete this.$container;
        },

        onSelect: function() {
            this._unSlick();
            this._initSlick();
        },

        onBlockSelect: function(evt) {
            var navItem = $('.nav-link-' + evt.detail.blockId);
            navItem.tab('show');
            this._unSlick();
            this._initSlick();
        }
    });

    return Producttabs;
})();

theme.Video = (function() {
    var promiseYoutubeAPI;
    var promiseVimeoAPI;

    var youtube = {
        promiseAPI: function() {
            if (!promiseYoutubeAPI) {
                var tag = document.createElement('script');

                tag.src = 'https://www.youtube.com/iframe_api';
                var firstScriptTag = document.getElementsByTagName('script')[0];
                firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

                promiseYoutubeAPI = $.Deferred(function(defer) {
                    window.onYouTubeIframeAPIReady = defer.resolve;

                    setTimeout(function() {
                        defer.reject('Request for YouTube API timed out after 30 seconds.');
                    }, 30000);
                });
            }

            return promiseYoutubeAPI;
        },
        promisePlayer: function(id, options) {
            return this.promiseAPI().then(function() {
                return $.Deferred(function(defer) {
                    if (typeof window.YT === 'undefined') {
                        defer.reject(
                            "We're sorry, something went wrong. The YouTube API has not loaded correctly."
                        );
                    }

                    /* eslint-disable no-undef */
                    var player = new YT.Player(id, options); // global YT variable injected by YouTube API

                    player.addEventListener('onReady', function() {
                        defer.resolve(player);
                    });

                    setTimeout(function() {
                        defer.reject(
                            'Request for YouTube player has timed out after 30 seconds.'
                        );
                    }, 30000);
                });
            });
        }
    };

    var vimeo = {
        promiseAPI: function() {
            if (!promiseVimeoAPI) {
                promiseVimeoAPI = $.Deferred(function(defer) {
                    var tag = document.createElement('script');
                    tag.src = 'https://player.vimeo.com/api/player.js';
                    tag.onload = tag.onreadystatechange = function() {
                        if (!this.readyState || this.readyState === 'complete') {
                            defer.resolve();
                        }
                    };

                    var firstScriptTag = document.getElementsByTagName('script')[0];
                    firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

                    setTimeout(function() {
                        defer.reject('Request for Vimeo API timed out after 30 seconds.');
                    }, 30000);
                });
            }

            return promiseVimeoAPI;
        },

        promisePlayer: function(id, options) {
            return this.promiseAPI().then(function() {
                return $.Deferred(function(defer) {
                    if (typeof window.Vimeo === 'undefined') {
                        defer.reject(
                            "We're sorry, something went wrong. The Vimeo API has not loaded correctly."
                        );
                    }

                    var player = new window.Vimeo.Player(id, options);

                    setTimeout(function() {
                        defer.reject(
                            'Request for Vimeo player has timed out after 30 seconds.'
                        );
                    }, 30000);

                    player.ready().then(function() {
                        defer.resolve(player);
                    });
                });
            });
        }
    };

    var selectors = {
        loadPlayerButton: '.video-section__load-player-button',
        closePlayerButton: '.video-section__player-close',
        playerContainer: '.video-section__player',
        cover: '.video-section__cover',
        errorMessage: '.video-section__error',
        bodyOverlay: '.video-section__body-overlay',
        body: 'body'
    };
    var classes = {
        playerLoading: 'video-section--loading',
        playerLoaded: 'video-section--loaded',
        playerError: 'video-section--error',
        videoPlaying: 'video-playing'
    };

    function Video(container) {
        this.$container = $(container);
        var sectionId = this.$container.attr('data-section-id');
        this.namespace = '.' + sectionId;
        this.onLoad();
    }

    Video.prototype = _.assignIn({}, Video.prototype, {
        onLoad: function() {
            this.$container
                .on('click', selectors.loadPlayerButton, this._loadPlayer.bind(this))
                .on('click', selectors.closePlayerButton, this._closePlayer.bind(this))
                .on('click', selectors.bodyOverlay, this._closePlayer.bind(this));
        },

        _loadPlayer: function() {
            var $container = this.$container;
            var $playerContainer = $(selectors.playerContainer, $container);
            var playerType = this.$container.attr('data-video-type');

            var promiseVideoPlayer;

            if (playerType === 'youtube') {
                promiseVideoPlayer = this._loadYoutubePlayer($playerContainer[0]);
            } else if (playerType === 'vimeo') {
                promiseVideoPlayer = this._loadVimeoPlayer($playerContainer[0]);
            }

            return promiseVideoPlayer
                .then(this._onPlayerLoadReady.bind(this))
                .fail(this._onPlayerLoadError.bind(this));
        },

        _loadYoutubePlayer: function(container) {
            return youtube
                .promisePlayer(container, {
                    videoId: this.$container.attr('data-video-id'),
                    ratio: 16 / 9,
                    playerVars: {
                        modestbranding: 1,
                        autoplay: 1,
                        showinfo: 0,
                        rel: 0
                    }
                })
                .then(
                    function(player) {
                        this.player = player;
                    }.bind(this)
                );
        },

        _loadVimeoPlayer: function(container) {
            return vimeo
                .promisePlayer(container, {
                    id: this.$container.attr('data-video-id')
                })
                .then(
                    function(player) {
                        this.player = player;
                        this.player.play();
                    }.bind(this)
                );
        },

        _onPlayerLoadReady: function() {
            $(selectors.closePlayerButton, this.$container)
                .show()
                .focus();
            $(selectors.cover, this.$container).addClass(classes.playerLoaded);
            this.$container.addClass(classes.playerLoaded);

            this._setScrollPositionValues();

            $(selectors.body).addClass(classes.videoPlaying);

            $(document).on('keyup' + this.namespace, this._closeOnEscape.bind(this));
            $(window).on(
                'resize' + this.namespace,
                this._setScrollPositionValues.bind(this)
            );
            slate.a11y.trapFocus({
                $container: this.$container,
                namespace: this.namespace
            });
        },

        _onPlayerLoadError: function(err) {
            this.$container.addClass(classes.playerError);
            $(selectors.errorMessage, this.$container).text(err);
        },

        _closeOnEscape: function(evt) {
            if (evt.keyCode !== 27) {
                return;
            }

            this._closePlayer();
            $(selectors.loadPlayerButton, this.$container).focus();
        },

        _onScroll: function() {
            var scrollTop = $(window).scrollTop();

            if (
                scrollTop > this.videoTop + 0.25 * this.videoHeight ||
                scrollTop + this.windowHeight <
                this.videoBottom - 0.25 * this.videoHeight
            ) {
                // Debounce DOM edits to the next frame with requestAnimationFrame
                requestAnimationFrame(this._closePlayer.bind(this));
            }
        },

        _setScrollPositionValues: function() {
            this.videoHeight = this.$container.outerHeight(true);
            this.videoTop = this.$container.offset().top;
            this.videoBottom = this.videoTop + this.videoHeight;
            this.windowHeight = $(window).innerHeight();
        },

        _closePlayer: function() {
            $(selectors.body).removeClass(classes.videoPlaying);
            $(selectors.cover, this.$container).removeClass(classes.playerLoaded);
            this.$container.removeClass(classes.playerLoaded);
            $(selectors.closePlayerButton, this.$container).hide();

            slate.a11y.removeTrapFocus({
                $container: this.$container,
                namespace: this.namespace
            });

            if (typeof this.player.destroy === 'function') {
                this.player.destroy();
            } else if (typeof this.player.unload === 'function') {
                this.player.unload();
            }

            $(document).off(this.namespace);
            $(window).off(this.namespace);
        }
    });

    return Video;
})();

theme.CollectionsList = (function() {
    function CollectionsList(container) {
        var $container = (this.$container = $(container));
        var stretchImage = $container.is('[data-stretch-image]');

        // Early return if 'secondary image layout' is enabled
        if (stretchImage) return;

        var namespace = (this.namespace = '.' + $container.attr('data-section-id'));
        var self = this;

        self._collectionListFix();
        $(window).on(
            'resize' + namespace,
            $.debounce(250, function() {
                self._collectionListFix();
            })
        );
    }

    CollectionsList.prototype = _.assignIn({}, CollectionsList.prototype, {
        onUnload: function() {
            $(window).off(this.namespace);
        },

        _collectionListFix: function() {
            var numberRows = this.$container.find('.grid').data('number-rows');
            var $featureCards = this.$container.find('.featured-card');

            // We can exit if 'Use secondary image layout' is enabled
            if ($featureCards.is('[data-stretch-image]')) return;

            // Go through each of the rows
            for (var i = 0; i < numberRows; i++) {
                var maxWrapperHeight = 0;
                var maxHeaderHeight = 0;
                var $currentRow = $featureCards.filter(
                    "[data-row-number='" + (i + 1) + "']"
                );
                var $cardHeaders = $currentRow.find('.featured-card__header');

                // Find the max heights for each row
                $currentRow.each(function() {
                    var $cardTitle = $(this).find('.featured-card__title');
                    var $cardAction = $(this).find('.featured-card__action');
                    var $cardImageWrapper = $(this).find('.featured-card__image-wrapper');
                    var headerHeight =
                        $cardTitle.outerHeight() + $cardAction.outerHeight() + 65;
                    var wrapperHeight = $cardImageWrapper.outerHeight();
                    if (headerHeight > maxHeaderHeight) {
                        maxHeaderHeight = headerHeight;
                    }
                    if (wrapperHeight > maxWrapperHeight) {
                        maxWrapperHeight = wrapperHeight;
                    }
                });

                // Set the heights of the headers and cards for this row with padding
                $cardHeaders.outerHeight(maxHeaderHeight);
                $currentRow.height(maxWrapperHeight + maxHeaderHeight + 40);
            }
        }
    });

    return CollectionsList;
})();

theme.ParrallaxImage = (function() {
    function ParrallaxImage(container) {
        this.container = container;
        this.sectionId = $(container).attr('data-section-id');
        this.namespace = 'parallax-' + this.sectionId;
        var images = document.getElementsByClassName('thumbnail' + this.sectionId);
        new simpleParallax(images, {
            scale: 1.5,
            delay: .6,
        });
    }

    ParrallaxImage.prototype = $.extend({}, ParrallaxImage.prototype, {
        onUnload: function(evt) {
            var instance = new simpleParallax(images);
            instance.destroy();
            delete theme.ParrallaxImage[this.namespace];
        }
    });

    return ParrallaxImage;
})();

theme.init = function() {
    theme.customerTemplates.init();
    slate.rte.wrapTable();
    slate.rte.iframeReset();

    // Common a11y fixes
    slate.a11y.pageLinkFocus($(window.location.hash));

    $('.in-page-link').on('click', function(evt) {
        slate.a11y.pageLinkFocus($(evt.currentTarget.hash));
    });

    $('a[href="#"]').on('click', function(evt) {
        evt.preventDefault();
    });


    //scroll animation
    AOS.init({
        startEvent: 'DOMContentLoaded',
        offset: 30, // offset (in px) from the original trigger point
        delay: 0, // values from 0 to 3000, with step 50ms
        duration: 1000,
        once: true
    });
    window.addEventListener('load', function() {
        AOS.refresh();
    });


    // Sections
    var sections = new theme.Sections();
    sections.register('header', theme.HeaderSection);
    sections.register('product', theme.Product);
    sections.register('slideshow-section', theme.SlideshowSection);
    sections.register('cart', theme.Cart);
    sections.register('instagrams', theme.Instagrams);
    sections.register('masonries', theme.Masonry);
    sections.register('productlist', theme.Productlists);
    sections.register('producttab', theme.Producttabs);
    sections.register('slickCarousels', theme.slickCarousel);
    sections.register('video', theme.Video);
    sections.register('collections-list', theme.CollectionsList);
    sections.register('parallax-image', theme.ParrallaxImage);
    sections.register('bgcollection', theme.Bgcollection);

    // Standalone modules
    $(window).on('load', theme.articleImages);
    theme.passwordModalInit();
};

theme.articleImages = function() {
    var $indentedRteImages = $('.rte--indented-images');
    if (!$indentedRteImages.length) {
        return;
    }

    $indentedRteImages.find('img').each(function(i, el) {
        var $el = $(el);
        var attr = $el.attr('style');

        // Check if undefined or float: none
        if (!attr || attr === 'float: none;') {
            // Add class to parent paragraph tag if image is wider than container
            if ($el.width() >= $indentedRteImages.width()) {
                $el.parent('p').addClass('rte__image-indent');
            }
        }
    });
};

theme.passwordModalInit = function() {
    var $loginModal = $('#LoginModal');
    if (!$loginModal.length) {
        return;
    }

    // Initialize modal
    theme.PasswordModal = new window.Modals('LoginModal', 'login-modal', {
        focusOnOpen: '#Password'
    });

    // Open modal if errors exist
    if ($loginModal.find('.errors').length) {
        theme.PasswordModal.open();
    }
};

// CSS var ponyfill
theme.cssVar = (function() {
    cssVars();
})()

// Ajax search https://gist.github.com/awojtczyk/53d74c8af5f893841f33979b0cdcd6fe
theme.ajaxSearch = (function() {
    var $inputSearch = '.js-ajaxsearch',
        $resultsList = '.search-results',
        $input = $($inputSearch).find('input[name="q"]'),
        $currentAjaxRequest,
        $displayProducts = 6;

    $($inputSearch).css('position', 'relative').each(function() {
        $input.attr('autocomplete', 'off').bind('keyup change', function() {
            var term = $(this).val(),
                form = $(this).closest('form'),
                searchURL = '/search?type=product&q=*' + term + '*';
            if (term.length > 2 && term !== $(this).attr('data-old-term')) {
                $(this).attr('data-old-term', term);
                if ($currentAjaxRequest !== undefined) $currentAjaxRequest.abort();
                $currentAjaxRequest = $.getJSON(searchURL + '&view=json', function(data) {
                    $($resultsList).empty();

                    if (data.results_count === 0) {
                        $($resultsList).html('<p class="text-center">' + theme.strings.ajaxSearchNoResult + '</p>')
                    } else {
                        $.each(data.results, function(index, item) {
                            if (index < $displayProducts) {
                                var itemPrice = theme.Currency.formatMoney(item.price, theme.moneyFormat);
                                var link = $('<a class="d-inline-flex ' + index + '"></a>')
                                    .attr('href', item.url)
                                    .append('<span class="image"><img src="' + item.thumbnail + '" /></span>')
                                    .append('<div class="meta"><p class="title">' + item.title + '</p>' + itemPrice + '</div>')
                                    .wrap('<div class="ajax-search-item"></div>');
                                $($resultsList).append(link.parent());
                                theme.updateCurrencies();
                            }
                        });
                        if (data.results_count > $displayProducts) {
                            $($resultsList).append('<a class="btn btn--full" href="' + searchURL + '">' + theme.strings.ajaxSearchViewAll + ' (' + data.results_count + ')</a>');
                        }
                    }
                    $($resultsList).addClass('active').fadeIn(200);
                });
            }
        });
    });

    //escape when click somethings
    $(document).click(function(event) {
        var target = event.target;
        if (!$(target).is($inputSearch) && !$(target).parents().is($inputSearch)) {
            $($resultsList).slideUp(300);
        }
    });
})();

// Quickview https://github.com/kellyvaughn/quickview-for-shopify/blob/master/quickview.js.liquid
theme.quickview = (function() {
    var product_handle = '',
        quickviewButtonClass = '.js-btn-quickview',
        quickviewId = '#jsQuickview',
        quickviewOption = '#jsQuickview select',
        quickviewThumb = '#qv-product-images',
        quickviewAddCartButton = '.qv-add-button',
        quickviewPrice = '.qv-product-price',
        quickviewComparePrice = '.qv-product-compare-price';

    // 1. Show quickview
    $(document).on('click', quickviewButtonClass, function() {
        var quickviewAvaible = $(this).attr("data-pavailable");
        product_handle = $(this).data('handle');
        //ResetQuickview
        $(quickviewId).removeClass().addClass('modal fade');
        $(quickviewThumb).removeClass().empty();
        $('.qv-product-options').empty();

        //Pushdata
        $(quickviewId).addClass(product_handle).data('handle', product_handle);
        jQuery.getJSON('/products/' + product_handle + '.js', function(product) {
            var title = product.title;
            var type = product.type;
            var vendor = product.vendor;
            var price = 0;
            var compare_price = 0;
            var desc = product.description.slice(0, 90);
            var images = product.images;
            var variants = product.variants;
            var options = product.options;
            var url = '/products/' + product_handle;
            $('.qv-product-title').text(title);
            $('.qv-product-type').text(type);
            $('.qv-product-description').html(desc);
            $('.qv-view-product').attr('href', url);
            $('.qv-view-type').text(type);
            $('.qv-view-vendor').text(vendor)
            if (quickviewAvaible == 'true') {
                $(quickviewAddCartButton).prop('disabled', false).html(theme.strings.addToCart);
            } else {
                $(quickviewAddCartButton).prop('disabled', true).html(theme.strings.soldOut);
            }
            $(product.variants).each(function(i, variants) {
                if (variants.sku != null) {
                    $('.qv-sku').addClass("show").removeClass("hide");
                    $('.qv-view-sku').text(product.variants[0].sku);
                } else {
                    $('.qv-sku').addClass("hide").removeClass("show");
                }

            });
            var imageCount = $(images).length;
            $(images).each(function(i, image) {
                image_embed = '<div><img src="' + image + '"></div>';
                image_embed = image_embed.replace('.jpg', '_800x.jpg').replace('.png', '_800x.png');
                $(quickviewThumb).append(image_embed);
            });
            $(quickviewThumb).slick({
                rtl: theme.rtl,
                'dots': true,
                'arrows': true,
                'respondTo': 'min',
                'useTransform': true
            }).css('opacity', '1');

            if (product.variants[0].option1 !== "Default Title") {
                $(options).each(function(i, option) {
                    var name = option.name;
                    var opt = name.replace(/ /g, '-').toLowerCase();
                    var selectClass = '.option.' + opt;
                    $('.qv-product-options').append('<div class="option-selection ' + opt + '"><span class="option text-uppercase font-weight-bold text-body">' + option.name + '</span><select class="option-' + i + ' option ' + opt + '"></select></div>');
                    $(option.values).each(function(i, value) {
                        $('.option.' + opt).append($('<option>', {
                            value: value,
                            text: value
                        }));
                    });
                });
            }
            $(product.variants).each(function(i, v) {
                if (v.inventory_quantity == 0) {
                    return true
                } else {
                    price = theme.Currency.formatMoney(v.price, theme.moneyFormat);
                    compare_price = theme.Currency.formatMoney(v.compare_at_price, theme.moneyFormat);
                    $(quickviewPrice).html(price);
                    if (v.compare_at_price !== null) {
                        $(quickviewComparePrice).html(compare_price).show();
                    } else {
                        $(quickviewComparePrice).hide();
                    }
                    theme.updateCurrencies();
                    $('select.option-0').val(v.option1);
                    $('select.option-1').val(v.option2);
                    $('select.option-2').val(v.option3);
                    return false
                }
            });
        });
        //addCartQuickview
    });
    // 2. Add to cart
    $(document).on('click', quickviewAddCartButton, function() {
        product_handle = $(quickviewId).data('handle');
        var qty = $('.qv-quantity').val(),
            selectedOptions = '',
            var_id = '';

        function processCart() {
            jQuery.post('/cart/add.js', {
                    quantity: qty,
                    id: var_id
                }, null, "json").done(function(item) {
                    var htmlVariant = item.variant_title !== null ? '<i>(' + item.variant_title + ')</i>' : '';
                    var styleCart = $('.js-mini-cart').attr("data-cartmini");
                    if (styleCart != 'true') {
                        var htmlAlert = '<div class="media mt-2 alert--cart"><a class="mr-3" href="/cart"><img class="lazyload" data-src="' + item.image + '"></a><div class="media-body align-self-center"><p class="m-0 font-weight-bold">' + item.product_title + ' x ' + item.quantity + '</p>' + htmlVariant + '<div><div>';
                        theme.alert.new(theme.strings.addToCartSuccess, htmlAlert, 3000, 'notice');
                    }
                    theme.miniCart.updateElements();
                    theme.miniCart.generateCart();
                })
                .fail(function($xhr) {
                    var data = $xhr.responseJSON;
                    theme.alert.new('', data.description, 3000, 'warning');
                });
        }
        $(quickviewOption).each(function(i) {
            if (selectedOptions == '') {
                selectedOptions = $(this).val();
            } else {
                selectedOptions = selectedOptions + ' / ' + $(this).val();
            }
        });
        jQuery.getJSON('/products/' + product_handle + '.js', function(product) {
            if (product.variants.length === 1) {
                var_id = product.variants[0].id;
            } else {
                $(product.variants).each(function(i, v) {
                    if (v.title == selectedOptions) {
                        var_id = v.id;
                    }
                });
            }
            processCart();
        });
    });
    // 3. Select variants
    $(document).on('change', quickviewOption, function() {
        var selectedOptions = '';
        $(quickviewOption).each(function(i) {
            if (selectedOptions == '') {
                selectedOptions = $(this).val();
            } else {
                selectedOptions = selectedOptions + ' / ' + $(this).val();
            }
        });
        jQuery.getJSON('/products/' + product_handle + '.js', function(product) {
            $(product.variants).each(function(i, v) {
                if (v.title == selectedOptions) {
                    if (v.featured_image !== null) {
                        var iSlick = v.featured_image.position - 1;
                        $(quickviewThumb).slick('slickGoTo', iSlick);
                    }
                    var price = theme.Currency.formatMoney(v.price, theme.moneyFormat);
                    var compare_price = theme.Currency.formatMoney(v.compare_at_price, theme.moneyFormat);
                    $(quickviewPrice).html(price);
                    $(quickviewComparePrice).html(compare_price);
                    if (v.sku != null) {
                        $('.qv-sku').addClass("show").removeClass("hide");
                        $('.qv-view-sku').text(v.sku);
                    } else {
                        $('.qv-sku').addClass("hide").removeClass("show");
                    }
                    if (v.compare_at_price !== null) {
                        $(quickviewComparePrice).html(compare_price).show();
                    } else {
                        $(quickviewComparePrice).hide();
                    }
                    theme.updateCurrencies();
                    if (v.inventory_management === null) {
                        $(quickviewAddCartButton).prop('disabled', false).val(theme.strings.addToCart);
                    } else {
                        if (v.inventory_quantity < 1) {
                            $(quickviewAddCartButton).prop('disabled', true).val(theme.strings.soldOut);
                        } else {
                            $(quickviewAddCartButton).prop('disabled', false).val(theme.strings.addToCart);
                        }
                    }
                }
            });
        });
    });
})()

//Button add to cart (in grid item)
theme.addCartButton = (function() {
    var buttonClass = '.js-grid-cart';
    $(document).on('click', buttonClass, function() {
        var $this = $(this);
        var id = $this.data('id');
        $this.addClass('is-loading');
        Shopify.addItem(id, 1, function(item) {
            location.href = "/cart";
            var htmlVariant = item.variant_title !== null ? '<i>(' + item.variant_title + ')</i>' : '';
            var styleCart = $('.js-mini-cart').attr("data-cartmini");
            if (styleCart != 'true') {
                var htmlAlert = '<div class="media mt-2 alert--cart"><a class="mr-3" href="/cart"><img class="lazyload" data-src="' + item.image + '"></a><div class="media-body align-self-center"><p class="m-0 font-weight-bold">' + item.product_title + ' x ' + item.quantity + '</p>' + htmlVariant + '<div><div>';
            }
            theme.miniCart.updateElements();
            theme.miniCart.generateCart();
            setTimeout(function() {
                styleCart != 'true' ? theme.alert.new(theme.strings.addToCartSuccess, htmlAlert, 3000, 'notice') : '';
                $this.removeClass('is-loading');
            }, 1000);
        });
    })
})()

// Button add to cart (in grid item)
//theme.addCartButton = (function(){
//  var buttonClass = '.js-grid-cart';
//  $(document).on('click',buttonClass,function(){
//    var $this = $(this);
//    var id = $this.data('id');
//    $this.addClass('is-loading');
//    Shopify.addItem(id,1,function(item){
//      var htmlVariant = item.variant_title !== null ? '<i>('+item.variant_title+')</i>' : '';
//      var styleCart = $('.js-mini-cart').attr("data-cartmini");
//        if(styleCart != 'true'){
//          var htmlAlert = '<div class="media mt-2 alert--cart"><a class="mr-3" href="/cart"><img class="lazyload" data-src="'+item.image+'"></a><div class="media-body align-self-center"><p class="m-0 font-weight-bold">'+item.product_title+' x '+ item.quantity +'</p>'+htmlVariant+'<div><div>';
//        }
//      theme.miniCart.updateElements();
//      theme.miniCart.generateCart();
//      setTimeout(function() {
//        styleCart != 'true' ? theme.alert.new(theme.strings.addToCartSuccess,htmlAlert,3000,'notice'): '';
//        $this.removeClass('is-loading');
//      }, 1000);
//    });
// })
//})()

// Multi currencies 
if (theme.enableCurrencies) {
    // Can be 'money_format' or 'money_with_currency_format'
    Currency.format = 'money_format';
    var shopCurrency = Shopify.currency.active;
    var cookieCurrency = Currency.cookie.read();
    // Fix for customer account pages 
    jQuery('span.money span.money').each(function() {
        jQuery(this).parent('span.money').removeClass('money');
    });
    // Add precalculated shop currency to data attribute 
    jQuery('span.money').each(function() {
        jQuery(this).attr('data-currency-' + Shopify.currency.active, jQuery(this).html());
    });
    // Select all your currencies buttons.
    var buttons = jQuery('#currencies a'),
        currentCurrencies = jQuery('.pre-currencies');
    // When the page loads.
    if (cookieCurrency == null || cookieCurrency == shopCurrency) {
        Currency.currentCurrency = shopCurrency;
    } else {
        Currency.currentCurrency = cookieCurrency;
        Currency.convertAll(shopCurrency, cookieCurrency);
        buttons.removeClass('selected');
        jQuery('#currencies a[data-currency=' + cookieCurrency + ']').addClass('selected');
        var htmlCurrently = jQuery('#currencies a[data-currency=' + cookieCurrency + ']').html();
        currentCurrencies.html(htmlCurrently);
    }
    buttons.click(function() {
        buttons.removeClass('selected');
        jQuery(this).addClass('selected');
        var newCurrency = jQuery(this).attr('data-currency');
        var htmlCurrently = jQuery(this).html();
        currentCurrencies.html(htmlCurrently);
        Currency.convertAll(Currency.currentCurrency, newCurrency);
    });
    // For product options.
    var original_selectCallback = window.selectCallback;
    var selectCallback = function(variant, selector) {
        original_selectCallback(variant, selector);
        Currency.convertAll(shopCurrency, jQuery('#currencies a.selected').attr('data-currency'));
    };
}
theme.updateCurrencies = function() {
    Currency.convertAll(shopCurrency, jQuery('#currencies a.selected').attr('data-currency'));
}



// Free shipping
theme.freeShipping = (function() {
    var $freeShippingClass = $('.js-free-shipping'),
        $freeShippingTextClass = $('.js-free-shipping-text'),
        $free_fisrt = $freeShippingClass.attr('data-start'),
        $free_end = $freeShippingClass.attr('data-end')
    minOrderValue = parseInt($freeShippingClass.data('value')) || 0,
        $percentClass = $('.js-free-shipping .progress-bar');

    function generate(cart) {
        var priceCart = cart.total_price;
        if (priceCart >= minOrderValue) {
            $percentClass.css('width', '100%').removeClass('progress-bar-striped bg-primary');
            $freeShippingTextClass.text(theme.strings.freeShipping)
        } else {
            let percent = priceCart / minOrderValue * 100;
            let left = Shopify.formatMoney((minOrderValue - priceCart), theme.moneyFormat);
            $percentClass.css('width', percent + '%').addClass('progress-bar-striped primary');
            $freeShippingTextClass.html($free_fisrt + ' ' + left + ' ' + $free_end);
            theme.updateCurrencies();
        }
    }

    Shopify.getCart(function(cart) {
        generate(cart);
    });

    return {
        load: generate
    }
})()

// Shipping time - https://github.com/phstc/jquery-dateFormat
theme.shippingTime = (function() {
    var $shippingTime = $('.js-shipping-time'),
        shippingTime = $shippingTime.data('time') || '',
        now = new Date(),
        restHour = 23 - now.getHours(),
        restMinute = 59 - now.getMinutes();
    if (shippingTime !== '') {
        var nextTime = new Date(now.getTime() + shippingTime * 86400000),
            formatTime = $.format.date(nextTime, "ddd, dd MMMM yyyy"),
            htmlShipping = 'Order in the next <b>' + restHour + '</b> hours <b>' + restMinute + '</b> minutes to get it by <b>' + formatTime + '</b>. ';
        $shippingTime.html(htmlShipping);
    }
})()

// Infinite scroll - https://github.com/Elkfox/Ajaxinate/blob/master/dist/ajaxinate.min.js
theme.infiniteScroll = (function() {
    function initInfiniteScroll() {
        if ($('.AjaxinateLoop').length === 0) {
            return;
        } else {
            var endlessScroll = new Ajaxinate({
                loadingText: '<div class="text-center"><div class="' + theme.loadingClass + '" role="status"></div></div>',
                callback: function() {
                    theme.wishlist.load();
                    theme.compare.load();
                    theme.countdown.load();
                    theme.priceRange.load();
                    theme.tooltip.load();
                    theme.collectionView.triggerView();
                    theme.swatchCard2.load();
                }
            });
        }
    }

    // Infinite scroll in other page (blog, list-collection)
    function initOtherPages() {
        var otherPages = new Ajaxinate({
            loadingText: '<div class="text-center"><div class="' + theme.loadingClass + '" role="status"></div></div>',
            container: '.js-pagination-content',
            pagination: '.js-pagination'
        });
    }

    document.addEventListener("DOMContentLoaded", function() {
        initInfiniteScroll();
        initOtherPages();
    });

    return {
        load: initInfiniteScroll
    }
})()

// Scroll to fixed
theme.scrollToFixed = (function() {
    var window_width = $(window).width();

    if (window_width < 768) {
        $(".js-stick-parent").trigger("sticky_kit:detach");
    } else {
        make_sticky();
    }
    $(window).resize(function() {

        window_width = $(window).width();

        if (window_width < 768) {
            $(".js-stick-parent").trigger("sticky_kit:detach");
        } else {
            make_sticky();
        }
    });

    function make_sticky() {
        $('.js-stick-parent').stick_in_parent();
    }

})()


theme.headersidebar = (function() {
    $('#dismiss, .overlaysidebar').on('click', function() {
        // hide sidebar
        $('#sidebar').removeClass('active');
        // hide overlay
        $('.overlaysidebar').removeClass('active');
    });

    $('#sidebarCollapse').on('click', function() {
        // open sidebar
        $('#sidebar').addClass('active');
        // fade in the overlay
        $('.overlaysidebar').addClass('active');
        $('.collapse.in').toggleClass('in');
        $('a[aria-expanded=true]').attr('aria-expanded', 'false');
    });
})()

// Wishlist
theme.wishlist = (function() {
    var wishlistButtonClass = '.js-btn-wishlist',
        wishlistRemoveButtonClass = '.js-remove-wishlist',
        $wishlistCount = $('.js-wishlist-count'),
        $wishlistContainer = $('.js-wishlist-content'),
        wishlistObject = JSON.parse(localStorage.getItem('localWishlist')) || [],
        wishlistPageUrl = $('.js-wishlist-link').attr('href'),
        loadNoResult = function() {
            // $wishlistContainer.html('<div class="col text-center"><div class="alert alert-warning d-inline-block">' + theme.strings.wishlistNoResult + '</div></div>');
        };

    function updateWishlist(self) {
        var productHandle = $(self).data('handle'),
            allSimilarProduct = $(wishlistButtonClass + '[data-handle="' + productHandle + '"]');
        var isAdded = $.inArray(productHandle, wishlistObject) !== -1 ? true : false;
        if (isAdded) {
            // go to wishlist page
            window.location.href = wishlistPageUrl;
        } else {
            wishlistObject.push(productHandle);
            allSimilarProduct.fadeOut('slow').fadeIn('fast').html(theme.strings.wishlistIconAdded + theme.strings.wishlistTextAdded);
            //change tooltip
            allSimilarProduct.attr('data-original-title', theme.strings.wishlistTextAdded);
            $('.tooltip-inner').text(theme.strings.wishlistTextAdded);
        }
        localStorage.setItem('localWishlist', JSON.stringify(wishlistObject));
        $wishlistCount.text(wishlistObject.length);
    };

    function loadWishlist() {
        $wishlistContainer.html('');
        //page wishlist
        if (wishlistObject.length > 0) {
            for (var i = 0; i < wishlistObject.length; i++) {
                var productHandle = wishlistObject[i];
                Shopify.getProduct(productHandle, function(product) {
                    var htmlProduct = '';
                    var productPrice = product.price_varies ? 'from ' + theme.Currency.formatMoney(product.price_min, theme.moneyFormat) : theme.Currency.formatMoney(product.price, theme.moneyFormat);
                    var productComparePrice = product.compare_at_price_min !== 0 ? theme.Currency.formatMoney(product.compare_at_price_min, theme.moneyFormat) : '';
                    htmlProduct += '<div class="js-wishlist-item col-md-4 col-sm-6 col-xs-6 col-12 mb-4">';
                    htmlProduct += '<div class="js-wishlist-itembox">';
                    htmlProduct += '<div class=" d-flex flex-row p-4">';
                    htmlProduct += '	<a class="d-inline-block mr-4 " href="' + product.url + '">';
                    htmlProduct += '		<img src="' + product.featured_image + '"/>';
                    htmlProduct += '	</a>';
                    htmlProduct += '	<div><a href="' + product.url + '" class="title-prouct d-block h4 text-body" >' + product.title + '</a>';
                    htmlProduct += '	<span> ' + productPrice + '</span>';
                    htmlProduct += '	 <s>' + productComparePrice + '</s></div>';
                    htmlProduct += '<button class="btn js-remove-wishlist" data-handle="' + product.handle + '">' + theme.strings.wishlistRemove + '</button>';
                    htmlProduct += '</div>';
                    htmlProduct += '</div>';
                    htmlProduct += '</div>';
                    $wishlistContainer.append(htmlProduct);
                    theme.updateCurrencies();
                });
            }
        } else {
            loadNoResult();
        }

        //count items
        $wishlistCount.text(wishlistObject.length);

        //button text
        $(wishlistButtonClass).each(function() {
            var productHandle = $(this).data('handle');
            var iconWishlist = $.inArray(productHandle, wishlistObject) !== -1 ? theme.strings.wishlistIconAdded : theme.strings.wishlistIcon;
            var textWishlist = $.inArray(productHandle, wishlistObject) !== -1 ? theme.strings.wishlistTextAdded : theme.strings.wishlistText;
            $(this).html(iconWishlist + textWishlist).attr('title', textWishlist);
        });
    }

    $(document).on('click', wishlistButtonClass, function(event) {
        event.preventDefault();
        updateWishlist(this);
    });
    $(document).on('click', wishlistRemoveButtonClass, function() {
        var productHandle = $(this).data('handle'),
            allSimilarProduct = $(wishlistButtonClass + '[data-handle="' + productHandle + '"]');

        //update button
        allSimilarProduct.html(theme.strings.wishlistIcon + theme.strings.wishlistText);
        //update tooltip
        allSimilarProduct.attr('data-original-title', theme.strings.wishlistText);
        $('.tooltip-inner').text(theme.strings.wishlistText);
        //update Object
        wishlistObject.splice(wishlistObject.indexOf(productHandle), 1);
        localStorage.setItem('localWishlist', JSON.stringify(wishlistObject));
        // Remove element
        $(this).closest('.js-wishlist-item').fadeOut(); // or .remove()
        //count
        $wishlistCount.text(wishlistObject.length);
        if (wishlistObject.length === 0) {
            loadNoResult();
        }
    });

    loadWishlist();
    $(document).on('shopify:section:load', loadWishlist);
    return {
        load: loadWishlist
    }
})()

// Compare
theme.compare = (function() {
    var compareButtonClass = '.js-btn-compare',
        compareRemoveButtonClass = '.js-remove-compare',
        $compareCount = $('.js-compare-count'),
        $compareContainer = $('.js-compare-content'),
        compareObject = JSON.parse(localStorage.getItem('localCompare')) || [],
        alertClass = 'notice';

    function updateCompare(self) {
        var productHandle = $(self).data('handle'),
            alertText = '';
        var isAdded = $.inArray(productHandle, compareObject) !== -1 ? true : false;
        if (isAdded) {
            compareObject.splice(compareObject.indexOf(productHandle), 1);
            alertText = theme.strings.compareNotifyRemoved;
            alertClass = 'notice';
        } else {
            if (compareObject.length === 4) {
                alertText = theme.strings.compareNotifyMaximum;
                alertClass = 'error';
            } else {
                alertClass = 'notice';
                compareObject.push(productHandle);
                alertText = theme.strings.compareNotifyAdded;
            }
        }
        localStorage.setItem('localCompare', JSON.stringify(compareObject));
        theme.alert.new(theme.strings.compareText, alertText, 2000, alertClass);
        $compareCount.text(compareObject.length);
    };

    function loadCompare() {
        var compareGrid;
        $compareContainer.html('');
        //popup compare
        if (compareObject.length > 0) {
            compareGrid = compareObject.length === 1 ? 'col-md-6 col-sm-6' : 'col';
            for (var i = 0; i < compareObject.length; i++) {
                var productHandle = compareObject[i];
                Shopify.getProduct(productHandle, function(product) {
                    var htmlProduct = '',
                        productPrice = product.price_varies ? 'from ' + theme.Currency.formatMoney(product.price_min, theme.moneyFormat) : theme.Currency.formatMoney(product.price, theme.moneyFormat),
                        productComparePrice = product.compare_at_price_min !== 0 ? theme.Currency.formatMoney(product.compare_at_price_min, theme.moneyFormat) : '',
                        productAvailable = product.available ? theme.strings.available : theme.strings.unavailable,
                        productAvailableClass = product.available ? 'alert-success' : 'alert-danger',
                        productTypeHTML = product.type !== "" ? '<a href="/collections/types?q=' + product.type + '">' + product.type + '</a>' : '<span>' + theme.strings.none + '</span>',
                        productVendorHTML = product.vendor !== "" ? '<a href="/collections/vendors?q=' + product.vendor + '">' + product.vendor + '</a>' : '<span>' + theme.strings.none + '</span>';
                    htmlProduct += '<div class="compare-item ' + compareGrid + ' col-xs-6">';
                    htmlProduct += '	<a href="' + product.url + '">';
                    htmlProduct += '		<img src="' + Shopify.resizeImage(product.featured_image, 'x300') + '"/>';
                    htmlProduct += '	</a>';
                    htmlProduct += '	<hr /><h5 >' + product.title + '</h5>';
                    htmlProduct += '	<hr /><s>' + productComparePrice + '</s>';
                    htmlProduct += '	<span> ' + productPrice + '</span>';
                    htmlProduct += '	<hr /><span class=' + productAvailableClass + '> ' + productAvailable + '</span>';
                    htmlProduct += '	<hr />' + productTypeHTML;
                    htmlProduct += '	<hr />' + productVendorHTML;
                    htmlProduct += '  <hr /><button class="btn js-remove-compare btn-theme gradient-theme" data-handle="' + product.handle + '">' + theme.strings.compareRemove + '</button>';
                    htmlProduct += '</div>';
                    $compareContainer.append(htmlProduct);
                    theme.updateCurrencies();
                });
            }
        } else {
            $compareContainer.html('<div class="alert alert-warning d-inline-block">' + theme.strings.compareNoResult + '</div>');
        }

        //button text
        $(compareButtonClass).each(function() {
            var productHandle = $(this).data('handle');
            var status = $.inArray(productHandle, compareObject) !== -1 ? 'added' : '';
            $(this).removeClass('added').addClass(status);
        });

        //count items
        $compareCount.text(compareObject.length);
    }
    $(document).on('click', compareButtonClass, function(event) {
        event.preventDefault();
        updateCompare(this);
        loadCompare();
    });
    $(document).on('click', compareRemoveButtonClass, function() {
        var productHandle = $(this).data('handle');
        compareObject.splice(compareObject.indexOf(productHandle), 1);
        localStorage.setItem('localCompare', JSON.stringify(compareObject));
        loadCompare();
    });

    loadCompare();
    $(document).on('shopify:section:load', loadCompare);
    return {
        load: loadCompare
    }
})()

// Popup newsletter
theme.popupNewletter = (function() {
    var $popupNewsletter = $('#jsPopupNewsletter'),
        $newsletterForm = $('#jsPopupNewsletter form'),
        date = new Date(),
        minutes = theme.timePopupNewsletter;
    minutesdelay = $popupNewsletter.attr('data-delay');
    if ($popupNewsletter.length === 1) {
        date.setTime(date.getTime() + (minutes * 60 * 1000));
        var setCookies = function() {
            $.cookie('cookiesNewsletter', 'disabled', { expires: date, path: '/' });
        };
        if ($.cookie('cookiesNewsletter') !== "disabled") {
            $(window).on('load', function() {
                setTimeout(function() {
                    $popupNewsletter.modal('show');
                }, minutesdelay * 1000);
            });
            $popupNewsletter.on('hidden.bs.modal', setCookies);
            $newsletterForm.submit(setCookies);
        }
    }
})()

// Cookie policy
theme.cookie = (function() {
    var $policy = $('.js-cookie-policy'),
        $closeButton = $('.js-btn-ok'),
        isOk = localStorage.getItem('localCookie') || '';
    if (isOk === '') {
        $policy.fadeIn('slow');
    }
    $closeButton.on('click', function() {
        localStorage.setItem('localCookie', 'accept');
        $policy.fadeOut('slow');
    })
})()

// Announcement Bar
theme.announcement = (function() {
    var $bar = $('.js-announcement-bar'),
        $closeButton = $('.js-ab-close'),
        isClosed = localStorage.getItem('localAnnouncement') || '';
    if (isClosed === '') {
        $bar.fadeIn();
        $bar.closest('.body-theme').addClass('body-announcement-bar');
    }
    $closeButton.on('click', function() {
        localStorage.setItem('localAnnouncement', 'closed');
        $bar.slideUp();
        $bar.closest('.body-theme').removeClass('body-announcement-bar');
    })
})()

// Open external link in new tab
theme.exLink = (function() {
    var links = document.links;
    for (let i = 0, linksLength = links.length; i < linksLength; i++) {
        if (links[i].hostname !== window.location.hostname && $(links[i]).attr('href') !== 'javascript:void(0)') {
            links[i].target = '_blank';
        }
    }
})()

// Deal- countdown
theme.countdown = (function() {
    function initCountdown() {
        $(".js-countdown").each(function() {
            var endTime = $(this).data('time'),
                htmlLayout = "<ul class='list--inline'><li class='gradient-theme-vertical'><span class='countdown-time'>%%D%%</span><span class='countdown-text'>Days</span></li><li class='gradient-theme-vertical'><span class='countdown-time'>%%H%%</span><span class='countdown-text'>Hours</span></li><li class='gradient-theme-vertical'><span class='countdown-time'>%%M%%</span><span class='countdown-text'>Mins</span></li><li class='gradient-theme-vertical'><span class='countdown-time'>%%S%%</span><span class='countdown-text'>Secs</span></li></ul>";
            $(this).lofCountDown({
                TargetDate: endTime,
                DisplayFormat: htmlLayout,
                FinishMessage: '<span class="alert alert-warning d-inline-block">' + theme.strings.countdownEndText + '</span>'
            });
        });
    }
    initCountdown();
    return {
        load: initCountdown
    }
})()

// Price range - Collection page
theme.priceRange = (function() {
    function initPriceRange() {
        var min = 0,
            max = 0,
            slideRange = '#js-slider-range',
            productCard = '.js-product-card',
            slideRangeWrap = '.slider-range-wr',
            rangeMin = '.js-range-min',
            rangeMax = '.js-range-max',
            enablePriceRange = $('#js-slider-range').length === 1 ? true : false;

        if (enablePriceRange) {
            $(productCard).each(function() {
                if (eval($(this).data('price')) > max) max = eval($(this).data('price'));
                if (min == 0) min = eval($(this).data('price'));
                else if (eval($(this).data('price')) < min) min = eval($(this).data('price'));
            });

            if (min === max) {
                $(slideRangeWrap).fadeOut();
            } else {
                $(slideRangeWrap).fadeIn();
            }

            $(slideRange).slider({
                range: true,
                min: min,
                max: max,
                values: [min, max],
                slide: function(event, ui) {
                    var price1 = (Shopify.formatMoney(ui.values[0], theme.moneyFormat));
                    var price2 = (Shopify.formatMoney(ui.values[1], theme.moneyFormat));
                    $(rangeMin).html(price1);
                    $(rangeMax).html(price2);
                    theme.updateCurrencies();

                    // Show/Hide product when dragging
                    $(productCard).each(function() {
                        if (eval($(this).data('price')) >= ui.values[0] && eval($(this).data('price')) <= ui.values[1]) {
                            $(this).parent().fadeIn();
                        } else {
                            $(this).parent().fadeOut();
                        }
                    });
                }
            });

            var price1 = (Shopify.formatMoney(min, theme.moneyFormat));
            var price2 = (Shopify.formatMoney(max, theme.moneyFormat));
            $(rangeMin).html(price1);
            $(rangeMax).html(price2);
            theme.updateCurrencies();

        }
    }
    initPriceRange();
    return {
        load: initPriceRange
    }
})()

// Collection view - Collection page
theme.collectionView = (function() {
    var btnView = '.js-btn-view',
        btnViewActive = '.js-btn-view.active';

    $(document).on('click', btnView, function() {
        var value = $(this).data('col'),
            $gridItemCol = $('.js-col');

        $(btnView).removeClass('active');
        $(this).addClass('active');

        $gridItemCol.removeClass().addClass('js-col col-sm-6 col-12');
        if (value === 3) {
            $gridItemCol.addClass('col-lg-4');
        } else if (value === 4) {
            $gridItemCol.addClass('col-lg-3');
        } else if (value === 5) {
            $gridItemCol.addClass('col-lg-2-4');
        } else if (value === 6) {
            $gridItemCol.addClass('col-lg-2');
        };
    })

    function triggerCollectionView() {
        $(btnViewActive).trigger('click');
    }

    return {
        triggerView: triggerCollectionView
    }
})()

// Swath variant in card item
theme.swatchCard = (function() {
    $(document).on('click', '.js-swatch-card-item', function() { //click or mouseover
        $(".js-swatch-card-item").removeClass("active");
        $(this).addClass("active");
        var newImage = $(this).data('image');
        var id = $(this).data('id');
        var gridItem = $(this).closest('.js-product-card');
        gridItem.find('.product-card__image').find('img').attr('srcset', newImage);
        gridItem.find('.js-grid-cart').data('id', id).attr('data-id', id);
    });
})()

theme.swatchCard2 = (function() {
    function initVariant(id) {
        var productJson = JSON.parse($('.customJson-' + id).html());
        var $selectorForm = $('.customform-' + id);
        var $button = $('.js-customform-addtocart-' + id);
        var $buttontext = $button.find('span');
        var $wrapObject = $selectorForm.closest('.js-product-card');
        var options = {
            $container: $selectorForm,
            enableHistoryState: false,
            product: productJson,
            singleOptionSelector: '.single-option-selector-' + id,
            originalSelectorId: '#ProductSelect-' + id
        };
        var variants = new slate.Variants(options);
        var AjaxCart = new window.AjaxCart($selectorForm);
        var _updateButton = function(evt) {
            var variant = evt.variant;
            if (variant === undefined) {
                $button.prop('disabled', true).removeClass('btn--sold-out');
                $buttontext.html(theme.strings.unavailable);
            } else {
                if (variant.available) {
                    $button.removeClass('btn--sold-out').prop('disabled', false);
                    $buttontext.html(theme.strings.addToCart);
                } else {
                    $button.prop('disabled', true).addClass('btn--sold-out');
                    $buttontext.html(theme.strings.soldOut);
                }
            }
        }
        var _updateImage = function(evt) {
            var variant = evt.variant;
            var $mainImage = $wrapObject.find('.product-card__image').find('img');
            if (variant !== undefined && variant.featured_image !== null) {
                var variantImage = variant.featured_image;
                $mainImage.attr('srcset', variantImage.src);
            }
        }
        var _updatePrice = function(evt) {
            var $price = $wrapObject.find('.product-card__price');
            var variant = evt.variant;
            if (variant !== undefined) {
                var htmlComparePrice = variant.compare_at_price !== null ? '<s class="product-card__regular-price"><span class="money">' + variant.compare_at_price + '</span></s>' : '';
                var htmlPrice = '<span class="money">' + variant.price + '</span>' + htmlComparePrice;
                $price.html(htmlPrice);
                theme.updateCurrencies();
            }
        }
        variants.$container.on(
            'variantChange', _updateButton
        );
        variants.$container.on(
            'variantChange', _updateImage
        );
        variants.$container.on(
            'variantChange', _updatePrice
        );
    }

    function initForm() {
        $('.js-customform').each(function() {
            var id = $(this).data('id');
            initVariant(id);
        })
    }

    initForm();
    return {
        load: initForm
    }
})()

// Loading
theme.loading = (function() {
    var $loading = $('#js-loading'),
        hasLoading = $('#js-loading').length === 0 ? false : true;
    if (hasLoading) {
        $(window).load(function() {
            $loading.fadeOut();
        });
    }
})()

theme.effectLeavingPage = (function() {
    window.onbeforeunload = function() {
        $('body').css('opacity', '0');
    }
})()

// Isotope
theme.isotope = (function() {
    var enableIsotope = $('.enable-isotope').length === 1 ? true : false,
        $grid = $('.js-grid'),
        filter = '.js-filter-isotope';

    function initIsotope() {
        if (enableIsotope) {
            $grid.isotope({
                itemSelector: '.grid-item',
                percentPosition: true
            })
            $(document).on('click', filter, function() {
                var filterValue = $(this).data('filter') === '*' ? $(this).data('filter') : '.' + $(this).data('filter');
                $(filter).removeClass('active');
                $(this).addClass('active');
                $grid.isotope({
                    filter: filterValue
                });
            });
            $(window).scroll(function() {
                $grid.isotope('layout');
            });
            $(window).load(function() {
                $grid.isotope('layout');
                $(filter).first().trigger('click');
            });
        }
    }
    initIsotope();
})()

//aos



// theme.Wow = (function(){
//   new WOW().init();
// })()




// Masonry
theme.Masonry = (function() {
    function Masonry(container) {
        this.$container = $(container).on('init', this._a11y.bind(this));
        var $masonry = this.$container;
        $masonry.isotope({
            itemSelector: '.grid-item',
            percentPosition: true,
            masonry: {
                columnWidth: '.grid-sizer'
            }
        });
        $(window).load(function() {
            $masonry.isotope('layout').css('opacity', '1');
        });
        $(window).scroll(function() {
            $masonry.isotope('layout').css('opacity', '1');
        });
    }

    Masonry.prototype = _.assignIn({}, Masonry.prototype, {
        _a11y: function(event, obj) {
            var $list = obj.$list;
            var $wrapper = this.$container.parent();

            // Remove default Slick aria-live attr until slider is focused
            $list.removeAttr('aria-live');

            // When an element in the slider is focused set aria-live
            $wrapper.on('focusin', function(evt) {
                if ($wrapper.has(evt.target).length) {
                    $list.attr('aria-live', 'polite');
                }
            });

            // Remove aria-live
            $wrapper.on('focusout', function(evt) {
                if ($wrapper.has(evt.target).length) {
                    $list.removeAttr('aria-live');
                }
            });
        }
    });

    return Masonry;
})();



// Cross-selling
theme.crosssell = (function() {
    var crosssellClass = '.js-crosssell',
        handles = $(crosssellClass).data('handles') || '',
        arrayHandle = handles.split(','),
        $blockCrosssell = $('.block-cross-sell'),
        variantSelectClass = '.js-cross-select',
        crossImageClass = '.cross-item-image',
        crossPriceClass = '.cross-item-money';

    function generateCrosssell() {
        for (var i = 0; i < arrayHandle.length; i++) {
            var productHandle = arrayHandle[i];
            Shopify.getProduct(productHandle, function(product) {
                var htmlCross = '',
                    htmlOption = '',
                    firstAvailableVariant = '',
                    variantCount = product.variants.length;

                // generate select box and check first avaiable variant
                for (var j = 0; j < variantCount; j++) {
                    var variant = product.variants[j],
                        variantImage = variant.featured_image === null ? product.featured_image : variant.featured_image.src,
                        disabled = variant.available ? '' : 'disabled';
                    htmlOption += '<option ' + disabled + ' data-id="' + variant.id + '" data-price="' + variant.price + '" data-image="' + variantImage + '">' + variant.title + '</option>';
                    if (firstAvailableVariant === '' && variant.available) {
                        firstAvailableVariant = variant
                    }
                }
                var productPrice = theme.Currency.formatMoney(firstAvailableVariant.price, theme.moneyFormat),
                    productImage = firstAvailableVariant.featured_image === null ? product.featured_image : firstAvailableVariant.featured_image.src,
                    selectHide = variantCount === 1 ? 'hide' : '';

                // generate HTML
                htmlCross += '<div class="col cross-item ' + product.handle + '">';
                htmlCross += '	<a class="cross-item-image" href="' + product.url + '" title="' + product.title + '"><img src="' + productImage + '" />' + theme.strings.cartIcon + '</a>';
                htmlCross += '	<a target="_blank" href="' + product.url + '" title="' + product.title + '" class="cross-item-title">' + product.title + '</a>';
                htmlCross += '	<span class="cross-item-money">' + productPrice + '</span>';
                htmlCross += '	<select class="js-cross-select ' + selectHide + '" data-image="' + productImage + '" data-price="' + firstAvailableVariant.price + '" data-item="' + firstAvailableVariant.id + '">' + htmlOption + '</select>';
                htmlCross += '</div>';
                $(crosssellClass).append(htmlCross);
                theme.updateCurrencies();
            });
        }
    }

    function showPopupCrosssell(lineItem) {
        //generate lineitem;
        var htmlLineItem = '';
        htmlLineItem += '<span class="alert alert-success d-inline-block mb-2">' + theme.strings.addToCartSuccess + '</span>';
        htmlLineItem += '<div><img src="' + lineItem.image + '" alt="Added Product"></div>';
        htmlLineItem += '<h4 class="cross-item-title">' + lineItem.title + '</h4>';
        htmlLineItem += '<div class="mb-2">' + theme.strings.cartQuantity + ': ' + lineItem.quantity + '</div>';
        $('.js-cross-added').hide().html(htmlLineItem).fadeIn();

        // show popup
        var $popupCrosssell = $('#jsCrosssell');
        $popupCrosssell.modal('show');
    }

    if (handles !== '') {
        $(document).on('click', crossImageClass, function(event) {
            event.preventDefault();
            var parent = $(this).closest('.cross-item'),
                itemId = parent.find(variantSelectClass).attr('data-item');
            Shopify.addItem(itemId, 1, function(lineItem) {
                theme.miniCart.updateElements();
                theme.miniCart.generateCart();
                showPopupCrosssell(lineItem);
            });
        });
        $(document).on('change', variantSelectClass, function() {
            var selectVariant = $(this).children(':selected'),
                selectVariantId = selectVariant.data('id'),
                parent = $(this).parent(),
                newPrice = theme.Currency.formatMoney(selectVariant.data('price'), theme.moneyFormat);

            if (selectVariant.data('image') !== '') {
                parent.find(crossImageClass).find('img').attr('src', selectVariant.data('image'));
            }
            $(this).attr('data-item', selectVariantId);
            parent.find(crossPriceClass).html(newPrice);
            theme.updateCurrencies();
        });
        $(document).on('shopify:section:load', generateCrosssell);
        generateCrosssell();
        $blockCrosssell.removeClass('hide');
    }
    return {
        showPopup: showPopupCrosssell
    }
})()

// Upsell
theme.upsell = (function() {
    var popupUpsell = '#jsUpsell',
        $button = $('#jsUpsell .btn'),
        productUpsellId = $('#jsUpsell').data('id') || '',
        buttonAcceptClass = 'js-btn-accept',
        delayTime = $('#jsUpsell').data('delay') || 3000,
        isUpsell = $(popupUpsell).length === 1 ? true : false;
    if (isUpsell) {
        $(document).ready(function() {
            setTimeout(function() {
                $(popupUpsell).modal('show');
            }, delayTime);
        });
        $button.on('click', function() {
            if ($(this).hasClass(buttonAcceptClass)) {
                Shopify.addItem(productUpsellId, 1, function(item) {
                    theme.miniCart.updateElements();
                    theme.miniCart.generateCart();
                    var htmlVariant = item.variant_title !== null ? '<i>(' + item.variant_title + ')</i>' : '';
                    var htmlAlert = '<div class="media mt-2 alert--cart"><a class="mr-3" href="/cart"><img class="lazyload" data-src="' + item.image + '"></a><div class="media-body align-self-center"><p class="m-0 font-weight-bold">' + item.product_title + ' x ' + item.quantity + '</p>' + htmlVariant + '<div><div>';
                    theme.alert.new(theme.strings.addToCartSuccess, htmlAlert, 3000, 'notice');
                })
            }
            $(popupUpsell).modal('hide');
        })
    }
})()

// Coupon
theme.coupon = (function() {
    var popupCoupon = '#jsCoupon',
        $button = $('#jsCoupon .js-btn-coupon'),
        delayTime = $('#jsCoupon').data('delay') || 3000,
        isCoupon = $(popupCoupon).length === 1 ? true : false,
        isCopied = localStorage.getItem('localCoupon') || '';
    if (isCoupon && isCopied === '') {
        $(document).ready(function() {
            setTimeout(function() {
                $(popupCoupon).modal('show');
            }, delayTime);
        });
        $button.on('click', function() {
            var copyText = document.getElementById("coupon_code");
            copyText.select();
            document.execCommand("Copy");
            $(popupCoupon).modal('hide');
            theme.alert.new('Coupon code', 'Successfully copied, now you can paste code at checkout', 4000);
            localStorage.setItem('localCoupon', 'copied');
        })
    }
})()

// Overwrite Shopify.onError in Shopify API
Shopify.onError = function(t, r) {
    var e = eval("(" + t.responseText + ")");
    var mess = e.message ? e.message + "(" + e.status + "): " + e.description : "Error : " + Shopify.fullMessagesFromErrors(e).join("; ") + "."
    theme.alert.new('Alert', mess, 3000, 'warning');
}

// Megamenu width
theme.fixWidthMegamenu = (function() {
    var $megamenuClass = $('.site-nav__item-mega'),
        megaDropdownClass = '.meganav';
    $megamenuClass.each(function() {
        var widthMenu = $(this).data('width') || 0;
        if (widthMenu !== 0) {
            $(this).find(megaDropdownClass).css({ 'width': widthMenu + 'px', 'margin-left': '-' + widthMenu / 2 + 'px' });
        }
    });
})()

// Product video
theme.productVideo = (function() {
    var playButtonClass = '.js-play-button';
    $(document).on('click', playButtonClass, function() {
        let videoSelector = $(this).next(),
            videoObject = videoSelector.get(0);
        $(this).toggleClass('active');
        videoSelector.toggleClass('active');
        videoObject.paused ? videoObject.play() : videoObject.pause();
    })
})()

// Fake-viewers
theme.fakeViewer = (function() {
    var $fakeViewClass = $('.js-fake-view'),
        minValue = $fakeViewClass.data('min'),
        maxValue = $fakeViewClass.data('max'),
        duration = $fakeViewClass.data('duration');

    function randomInRange(start, end) {
        var value = Math.floor(Math.random() * (end - start + 1) + start);
        $fakeViewClass.text(value);
    }

    if (minValue !== undefined && maxValue !== undefined) {
        randomInRange(minValue, maxValue);
        setInterval(function() {
            randomInRange(minValue, maxValue);
        }, duration);
    }

})();

// Product-suggest
theme.productSuggest = (function() {
    var $productSuggestClass = $('.product-notification'),
        $closeButtonClass = $('.close-notifi'),
        duration = $productSuggestClass.data('time') || 0,
        productSuggestCookie = 'cookieSuggest';

    function SomeonePurchased() {
        if ($.cookie(productSuggestCookie) == 'closed') {
            $productSuggestClass.remove();
        }
        $closeButtonClass.on('click', function() {
            $productSuggestClass.remove();
            $.cookie(productSuggestCookie, 'closed', { expires: 1, path: '/' });
        });

        function toggleSomething() {
            if ($productSuggestClass.hasClass('active')) {
                $productSuggestClass.removeClass('active')
            } else {
                var arrayProducts = $('.data-product'),
                    randomProduct = Math.floor(Math.random() * arrayProducts.length),
                    Object = $(arrayProducts[randomProduct]);

                $productSuggestClass.addClass('active');
                $productSuggestClass.find('.product-image').attr('href', Object.data('url')).find('img').attr('src', Object.data('image'));
                $productSuggestClass.find('.product-name').text(Object.data('title')).attr('href', Object.data('url'));
                $productSuggestClass.find('.time-ago').text(Object.data('time'));
                $productSuggestClass.find('.from-ago').text(Object.data('local'));
            }
        }

        if (duration !== 0) {
            setInterval(toggleSomething, duration);
        }
    }
    SomeonePurchased();
})()


// Stickyheader
theme.stickyHeader = (function() {
    var stickHeaderClass = '.site-header--sticky';
    if ($(stickHeaderClass).length !== 0) {
        $(window).scroll(function() {
            if (window.pageYOffset >= 20) {
                $(stickHeaderClass).addClass('active');
            } else {
                $(stickHeaderClass).removeClass('active');
            }
        });
    }
})()

theme.PhotoSwipe = (function() {
    var initPhotoSwipeFromDOM = function(gallerySelector) {

        // parse slide data (url, title, size ...) from DOM elements 
        // (children of gallerySelector)
        var parseThumbnailElements = function(el) {
            var thumbElements = el.childNodes,
                numNodes = thumbElements.length,
                items = [],
                figureEl,
                linkEl,
                size,
                item;

            for (var i = 0; i < numNodes; i++) {

                figureEl = thumbElements[i]; // <figure> element

                // include only element nodes 
                if (figureEl.nodeType !== 1) {
                    continue;
                }

                linkEl = figureEl.children[0]; // <a> element

                size = linkEl.getAttribute('data-size').split('x');

                // create slide object
                item = {
                    src: linkEl.getAttribute('href'),
                    w: parseInt(size[0], 10),
                    h: parseInt(size[1], 10)
                };



                if (figureEl.children.length > 1) {
                    // <figcaption> content
                    item.title = figureEl.children[1].innerHTML;
                }

                if (linkEl.children.length > 0) {
                    // <img> thumbnail element, retrieving thumbnail url
                    item.msrc = linkEl.children[0].getAttribute('src');
                }

                item.el = figureEl; // save link to element for getThumbBoundsFn
                items.push(item);
            }

            return items;
        };

        // find nearest parent element
        var closest = function closest(el, fn) {
            return el && (fn(el) ? el : closest(el.parentNode, fn));
        };

        // triggers when user clicks on thumbnail
        var onThumbnailsClick = function(e) {
            e = e || window.event;
            e.preventDefault ? e.preventDefault() : e.returnValue = false;

            var eTarget = e.target || e.srcElement;

            // find root element of slide
            var clickedListItem = closest(eTarget, function(el) {
                return (el.tagName && el.tagName.toUpperCase() === 'FIGURE');
            });

            if (!clickedListItem) {
                return;
            }

            // find index of clicked item by looping through all child nodes
            // alternatively, you may define index via data- attribute
            var clickedGallery = clickedListItem.parentNode,
                childNodes = clickedListItem.parentNode.childNodes,
                numChildNodes = childNodes.length,
                nodeIndex = 0,
                index;

            for (var i = 0; i < numChildNodes; i++) {
                if (childNodes[i].nodeType !== 1) {
                    continue;
                }

                if (childNodes[i] === clickedListItem) {
                    index = nodeIndex;
                    break;
                }
                nodeIndex++;
            }



            if (index >= 0) {
                // open PhotoSwipe if valid index found
                openPhotoSwipe(index, clickedGallery);
            }
            return false;
        };

        // parse picture index and gallery index from URL (#&pid=1&gid=2)
        var photoswipeParseHash = function() {
            var hash = window.location.hash.substring(1),
                params = {};

            if (hash.length < 5) {
                return params;
            }

            var vars = hash.split('&');
            for (var i = 0; i < vars.length; i++) {
                if (!vars[i]) {
                    continue;
                }
                var pair = vars[i].split('=');
                if (pair.length < 2) {
                    continue;
                }
                params[pair[0]] = pair[1];
            }

            if (params.gid) {
                params.gid = parseInt(params.gid, 10);
            }

            return params;
        };

        var openPhotoSwipe = function(index, galleryElement, disableAnimation, fromURL) {
            var pswpElement = document.querySelectorAll('.pswp')[0],
                gallery,
                options,
                items;

            items = parseThumbnailElements(galleryElement);

            // define options (if needed)
            options = {
                maxSpreadZoom: 1,
                bgOpacity: 0.7,
                zoomEl: true,
                history: false,
                zoomEl: false,
                pinchToClose: false,
                closeOnScroll: false,
                // define gallery index (for URL)
                galleryUID: galleryElement.getAttribute('data-pswp-uid'),

            };

            // PhotoSwipe opened from URL
            if (fromURL) {
                if (options.galleryPIDs) {
                    // parse real index when custom PIDs are used 
                    // http://photoswipe.com/documentation/faq.html#custom-pid-in-url
                    for (var j = 0; j < items.length; j++) {
                        if (items[j].pid == index) {
                            options.index = j;
                            break;
                        }
                    }
                } else {
                    // in URL indexes start from 1
                    options.index = parseInt(index, 10) - 1;
                }
            } else {
                options.index = parseInt(index, 10);
            }

            // exit if index not found
            if (isNaN(options.index)) {
                return;
            }

            if (disableAnimation) {
                options.showAnimationDuration = 0;
            }

            // Pass data to PhotoSwipe and initialize it
            gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, items, options);
            gallery.init();
        };

        // loop through all gallery elements and bind events
        var galleryElements = document.querySelectorAll(gallerySelector);

        for (var i = 0, l = galleryElements.length; i < l; i++) {
            galleryElements[i].setAttribute('data-pswp-uid', i + 1);
            galleryElements[i].onclick = onThumbnailsClick;
        }

        // Parse URL and open gallery if it contains #&pid=3&gid=1
        var hashData = photoswipeParseHash();
        if (hashData.pid && hashData.gid) {
            openPhotoSwipe(hashData.pid, galleryElements[hashData.gid - 1], true, true);
        }
    };

    // execute above function
    initPhotoSwipeFromDOM('.my-gallery');
})()

theme.ZoomImage = (function() {
    $(window).resize(function() {
        var width = $(window).width();
        if (width > 767) {
            ZoomImage();
        }
    });
    $(window).width(function() {
        var width = $(window).width();
        if (width > 767) {
            ZoomImage();
        }
    });

    function ZoomImage() {
        $(".zoom_image").each(function(arg, el) {
            var image = $(el).find("img");
            $(el).zoom({
                on: 'mouseover',
                url: image.attr("src").replace("small", "big")
            });
        });
    }
})()

theme.activeAccordion = (function() {
    $('.collapse').on('shown.bs.collapse', function() {
        $(this).prev().addClass('active-acc');
    });
    $('.collapse').on('hidden.bs.collapse', function() {
        $(this).prev().removeClass('active-acc');
    });
})()


// Anchor scroll
theme.anchorScroll = (function() {
    $(document).on('click', 'a[href^="#"]', function(event) {
        event.preventDefault();
        var disableAnchor = $(this).hasClass('disabled-anchor');
        if (!disableAnchor) {
            $('html, body').animate({
                scrollTop: $($.attr(this, 'href')).offset().top
            }, 500);
        }
    });
})()

// Product-recently-viewed
theme.productRecentlyViewed = (function() {
    var $viewedElement = $('.js-recently-view'),
        $viewButton = $('.js-recently-view-button'),
        $content = $('.js-recently-view-content'),
        productHandle = $viewedElement.data('handle') || '',
        limit = $viewButton.data('limit') || 0,
        arrayProduct = JSON.parse(localStorage.getItem('localRecentlyViewed')) || [],
        lastProduct = arrayProduct[arrayProduct.length - 1] || '',
        isAdded = $.inArray(productHandle, arrayProduct) !== -1 ? true : false;

    function processViewed() {
        if (productHandle !== '') {
            //process last product
            if (lastProduct === productHandle && arrayProduct.length > 1) {
                lastProduct = arrayProduct[arrayProduct.length - 2]
            }

            //move current product to last of array
            if (isAdded) {
                arrayProduct.splice(arrayProduct.indexOf(productHandle), 1);
            }
            arrayProduct.push(productHandle);
            //remove first item if limit
            if (arrayProduct.length > limit) {
                arrayProduct.shift()
            }
            localStorage.setItem('localRecentlyViewed', JSON.stringify(arrayProduct));
        }
    }

    function generatorProduct() {
        $content.html('');
        if (arrayProduct.length > 0) {
            //array
            for (var i = 0; i < arrayProduct.length; i++) {
                var productHandle = arrayProduct[i];
                Shopify.getProduct(productHandle, function(product) {
                    var htmlProduct = '';
                    var productPrice = product.price_varies ? 'from ' + theme.Currency.formatMoney(product.price_min, theme.moneyFormat) : theme.Currency.formatMoney(product.price, theme.moneyFormat);
                    var productComparePrice = product.compare_at_price_min !== 0 ? theme.Currency.formatMoney(product.compare_at_price_min, theme.moneyFormat) : '';
                    htmlProduct += '<div class="col-12 col-lg-4 js-viewed-item mb-4">';
                    htmlProduct += '	<div class="border p-3 rounded media d-flex ">';
                    htmlProduct += '	<a class="mr-3 col-4 p-0" href="' + product.url + '">';
                    htmlProduct += '		<img src="' + product.featured_image + '"/>';
                    htmlProduct += '	</a>';
                    htmlProduct += '	<div class="media-body text-left">';
                    htmlProduct += '		<h4 class="mb-2 mt-2"><a href="' + product.url + '">' + product.title + '</a></h5>';
                    htmlProduct += '	<span> ' + productPrice + '</span>';
                    htmlProduct += '	<s>' + productComparePrice + '</s>';
                    htmlProduct += '	</div>';
                    htmlProduct += '	</div>';
                    htmlProduct += '</div>';
                    $content.append(htmlProduct);
                    theme.updateCurrencies();
                });
            }

            //last product
            Shopify.getProduct(lastProduct, function(product) {
                $viewButton.css('background-image', 'url(' + product.featured_image + ')').addClass('active');
            })
        }
    }

    processViewed();
    generatorProduct();

})()

// Notice when soldout
theme.alert = (function() {
    function createAlert(title, mess, time, type) {
        var aTitle = title || '',
            aTime = time || 2000,
            aMessage = mess || '',
            aClass = type || 'default';
        $.growl({
            title: aTitle,
            message: aMessage,
            duration: aTime,
            style: aClass,
            size: 'large'
        });
    }

    return {
        new: createAlert
    }
})()

// Notice when soldout
theme.noticeSoldout = (function() {
    var $soldoutWrapFormClass = $('.js-contact-soldout'),
        $textClass = $('.js-notify-text'),
        $soldoutValueId = $('#ContactProduct');

    function noticeSoldout(variant) {
        $soldoutWrapFormClass.find('.form-success').remove()
        if (variant.available) {
            $textClass.find('span').text('');
            $soldoutWrapFormClass.addClass('hide');
        } else {
            $textClass.find('span').text(': ' + variant.name);
            $soldoutWrapFormClass.removeClass('hide');
            $soldoutValueId.val(variant.name).attr('value', variant.name);
        }
    }
    return {
        init: noticeSoldout
    }
})()

// Sticky cart
theme.stickyCart = (function() {
    var $anchor = $('#js-anchor-sticky-cart'),
        $stCart = $('.sticky-cart-wr'),
        $close = $('#js-sticky-close'),
        disableStCart = localStorage.getItem('localDisableStCart') || '';
    if (disableStCart !== '') {
        $stCart.addClass('disable');
    }
    $close.on('click', function() {
        var isDisable = disableStCart !== '';
        if (isDisable) {
            localStorage.setItem('localDisableStCart', '');
        } else {
            localStorage.setItem('localDisableStCart', 'true');
        }
        $stCart.toggleClass('disable');
    })
    if ($anchor.length) {
        $(window).on('scroll', function() {
            var hT = $anchor.offset().top,
                hH = $anchor.outerHeight(),
                wH = $(window).height(),
                wS = $(this).scrollTop();
            if (wS > (hT + hH - wH)) {
                $stCart.addClass('active');
            } else {
                $stCart.removeClass('active');
            }
        });
    }

})()

//Fix reload safari
window.addEventListener("pageshow", function(evt) {
    if (evt.persisted) {
        setTimeout(function() {
            window.location.reload();
        }, 10);
    }
}, false);

// Back to top
theme.backToTop = (function() {
    var backtotopClass = $('.js-back-to-top');
    $(window).scroll(function() {
        if ($(this).scrollTop() > 300) {
            backtotopClass.fadeIn('slow');
        } else {
            backtotopClass.fadeOut('slow');
        }
    });
    backtotopClass.on('click', function() {
        $('body,html').animate({ scrollTop: 0 }, 800);
    });
})()


// Tooltip
theme.tooltip = (function() {
    var selector = '[data-toggle="tooltip"],[data-tooltip="true"]';

    function loadTooltip() {
        $(selector).tooltip(); //Bootstrap 4
    };
    $(document).on('click', selector, function() {
        $(this).tooltip('hide');
    });
    loadTooltip();
    return {
        load: loadTooltip
    }
})()

//Collections style 2
theme.Bgcollection = (function() {
    // init Isotope
    function Bgcollection(container) {
        var $container = this.$container = $(container);
        var sectionId = $container.attr('data-section-id');
        var wrapper = this.wrapper = '.bgcollection-wrapper';
        var slider = this.slider = '#Bgcollection-' + sectionId;
        var $slider = $(slider, wrapper);
        $(".colgrid__bg--full[data-index='1']").addClass('active');
        $('.colgrid .colgrid__box').each(function() {
            var index = $(this).attr("data-index");
            $(this).hover(
                function() {
                    $(".colgrid__bg--full[data-index='" + index + "']").addClass('active');
                },
                function() {
                    $(".colgrid__bg--full[data-index='" + index + "']").removeClass('active');
                }
            );
        });
    }

    return Bgcollection;
})();


//Sidebar
theme.sidebar = (function() {
    var togglebutton = '.js-toggle-filter',
        $sidebar = $('.js-sidebar');
    $(document).on('click', togglebutton, function() {
        $sidebar.toggleClass('active');
        $(this).toggleClass('active');
    })
})()

// Ajax filter in collection page
theme.ajaxFilter = (function() {
    var ajaxContent = '#js-product-ajax',
        ajaxSortBy = '#js-sortby',
        ajaxFillter = '#js-fillter',
        ajaxCollectionTitle = '.js-collection-title',
        pageTitle = $(document).find("title").text(),
        jsLoading = '#js-loading';

    var apollo = {
        init: function() {
            this.initFilter();
        },
        showLoading: function() {
            $(jsLoading).show();
        },
        hideLoading: function() {
            $('body,html').animate({
                scrollTop: $('#MainContent').offset().top - 150
            }, 600);
            setTimeout(function() {
                $(jsLoading).hide(); //delay 500ms for better UX
            }, 500);

        },
        initFilter: function() {
            apollo.filterParams();
            apollo.filterSortby();
            apollo.sidebarMapTagEvents();
            apollo.filterMapSorting();
            apollo.filterMapPaging();
        },
        filterParams: function() {
            Shopify.queryParams = {};
            if (location.search.length) {
                for (var aKeyValue, i = 0, aCouples = location.search.substr(1).split('&'); i < aCouples.length; i++) {
                    aKeyValue = aCouples[i].split('=');
                    if (aKeyValue.length > 1) {
                        Shopify.queryParams[decodeURIComponent(aKeyValue[0])] = decodeURIComponent(aKeyValue[1]);
                    }
                }
            }
        },
        filterSortby: function() {
            if (Shopify.queryParams.sort_by) {
                var sortby = Shopify.queryParams.sort_by;
                $(ajaxSortBy).val(sortby);
            }
        },
        filterCreateUrl: function(baseLink) {
            var newQuery = $.param(Shopify.queryParams).replace(/%2B/g, '+');
            if (baseLink) {
                if (newQuery != "") {
                    return baseLink + "?" + newQuery;
                } else {
                    return baseLink;
                }
            }
            return location.pathname + "?" + newQuery;
        },
        filterMapData: function(data) {
            // 1. update product grid
            $(ajaxContent).html($(ajaxContent, data.responseText).html());
            // 2. update left filter
            $(ajaxFillter).html($(ajaxFillter, data.responseText).html());
            // 3. update collection title
            $(ajaxCollectionTitle).html($(ajaxCollectionTitle, data.responseText).html());
        },
        filterAjaxClick: function(baseLink) {
            delete Shopify.queryParams.page;
            var newurl = apollo.filterCreateUrl(baseLink);
            History.pushState({
                param: Shopify.queryParams
            }, pageTitle, newurl);
            apollo.filterGetContent(newurl);
        },
        filterGetContent: function(newurl) {
            $.ajax({
                type: 'GET',
                url: newurl,
                data: {},
                beforeSend: function() {
                    apollo.showLoading();
                },
                complete: function(data) {
                    apollo.filterMapData(data);
                    theme.wishlist.load();
                    theme.compare.load();
                    theme.countdown.load();
                    theme.priceRange.load();
                    theme.tooltip.load();
                    theme.collectionView.triggerView();
                    theme.swatchCard2.load();
                    theme.infiniteScroll.load();
                    apollo.hideLoading();
                },
                error: function(xhr, text) {
                    apollo.hideLoading();
                    alert($.parseJSON(xhr.responseText).description);
                }
            });
        },
        sidebarMapTagEvents: function() {
            $(document).on('click', '.advanced-filter a', function(event) {
                event.preventDefault();
                $('.tooltip').removeClass('show');
                var currentTags = [];
                if (Shopify.queryParams.constraint) {
                    currentTags = Shopify.queryParams.constraint.split('+');
                }
                if (!$(this).parent().hasClass("active-filter")) {
                    var otherTag = $(this).parents('.catalog_filter_ul').find("li.active-filter");
                    if (otherTag.length > 0) {
                        var tagName = otherTag.data("handle");
                        if (tagName) {
                            var tagPos = currentTags.indexOf(tagName);
                            if (tagPos >= 0) {
                                currentTags.splice(tagPos, 1);
                            }
                        }
                    }
                }
                var dataHandle = $(this).parent().data("handle");
                if (dataHandle) {
                    var tagPos = currentTags.indexOf(dataHandle);
                    if (tagPos >= 0) {
                        currentTags.splice(tagPos, 1);
                    } else {
                        currentTags.push(dataHandle);
                    }
                }
                if (currentTags.length) {
                    Shopify.queryParams.constraint = currentTags.join('+');
                } else {
                    delete Shopify.queryParams.constraint;
                }
                apollo.filterAjaxClick();
            });
            $(document).on('click', '.advanced-filter .icon', function() {
                $(this).parent('.advanced-filter').find('a').trigger("click");
            });
        },
        filterMapSorting: function() {
            $(document).on('change', ajaxSortBy, function() {
                Shopify.queryParams.sort_by = $(this).val();
                apollo.filterAjaxClick();
            })
        },
        filterMapPaging: function() {
            $(document).on('click', '.js-pagination a', function() {
                event.preventDefault();
                var linkPage = $(this).attr("href").match(/page=\d+/g);
                if (linkPage) {
                    Shopify.queryParams.page = parseInt(linkPage[0].match(/\d+/g));
                    if (Shopify.queryParams.page) {
                        var newurl = apollo.filterCreateUrl();
                        History.pushState({
                            param: Shopify.queryParams
                        }, pageTitle, newurl);
                        apollo.filterGetContent(newurl);
                    }
                }
            });
        }
    }

    if ($(".template-collection")) {
        History.Adapter.bind(window, 'statechange', function() {
            var State = History.getState();
            apollo.filterParams();
        });
    }
    apollo.init();

})();
$(theme.init);

/**
 * Currency Helpers
 * -----------------------------------------------------------------------------
 * A collection of useful functions that help with currency formatting
 *
 * Current contents
 * - formatMoney - Takes an amount in cents and returns it as a formatted dollar value.
 *
 * Alternatives
 * - Accounting.js - http://openexchangerates.github.io/accounting.js/
 *
 */

theme.Currency = (function() {
    var moneyFormat = '${{amount}}'; // eslint-disable-line camelcase

    function formatMoney(cents, format) {
        if (typeof cents === 'string') {
            cents = cents.replace('.', '');
        }
        var value = '';
        var placeholderRegex = /\{\{\s*(\w+)\s*\}\}/;
        var formatString = format || moneyFormat;

        function formatWithDelimiters(number, precision, thousands, decimal) {
            thousands = thousands || ',';
            decimal = decimal || '.';

            if (isNaN(number) || number === null) {
                return 0;
            }

            number = (number / 100.0).toFixed(precision);

            var parts = number.split('.');
            var dollarsAmount = parts[0].replace(
                /(\d)(?=(\d\d\d)+(?!\d))/g,
                '$1' + thousands
            );
            var centsAmount = parts[1] ? decimal + parts[1] : '';

            return dollarsAmount + centsAmount;
        }

        switch (formatString.match(placeholderRegex)[1]) {
            case 'amount':
                value = formatWithDelimiters(cents, 2);
                break;
            case 'amount_no_decimals':
                value = formatWithDelimiters(cents, 0);
                break;
            case 'amount_with_comma_separator':
                value = formatWithDelimiters(cents, 2, '.', ',');
                break;
            case 'amount_no_decimals_with_comma_separator':
                value = formatWithDelimiters(cents, 0, '.', ',');
                break;
            case 'amount_no_decimals_with_space_separator':
                value = formatWithDelimiters(cents, 0, ' ');
                break;
            case 'amount_with_apostrophe_separator':
                value = formatWithDelimiters(cents, 2, "'");
                break;
        }
        return formatString.replace(placeholderRegex, value);
    }

    return {
        formatMoney: formatMoney
    };
})();

/**
 * Image Helper Functions
 * -----------------------------------------------------------------------------
 * A collection of functions that help with basic image operations.
 *
 */

theme.Images = (function() {
    /**
     * Preloads an image in memory and uses the browsers cache to store it until needed.
     *
     * @param {Array} images - A list of image urls
     * @param {String} size - A shopify image size attribute
     */

    function preload(images, size) {
        if (typeof images === 'string') {
            images = [images];
        }

        for (var i = 0; i < images.length; i++) {
            var image = images[i];
            this.loadImage(this.getSizedImageUrl(image, size));
        }
    }

    /**
     * Loads and caches an image in the browsers cache.
     * @param {string} path - An image url
     */
    function loadImage(path) {
        new Image().src = path;
    }

    /**
     * Swaps the src of an image for another OR returns the imageURL to the callback function
     * @param image
     * @param element
     * @param callback
     */
    function switchImage(image, element, callback) {
        var size = this.imageSize(element.src);
        var imageUrl = this.getSizedImageUrl(image.src, size);

        if (callback) {
            callback(imageUrl, image, element); // eslint-disable-line callback-return
        } else {
            element.src = imageUrl;
        }
    }

    /**
     * +++ Useful
     * Find the Shopify image attribute size
     *
     * @param {string} src
     * @returns {null}
     */
    function imageSize(src) {
        src = src || '';

        var match = src.match(
            /.+_((?:pico|icon|thumb|small|compact|medium|large|grande)|\d{1,4}x\d{0,4}|x\d{1,4})[_\\.@]/
        );

        if (match === null) {
            return null;
        } else {
            return match[1];
        }
    }

    /**
     * +++ Useful
     * Adds a Shopify size attribute to a URL
     *
     * @param src
     * @param size
     * @returns {*}
     */
    function getSizedImageUrl(src, size) {
        if (size === null) {
            return src;
        }

        if (size === 'master') {
            return this.removeProtocol(src);
        }

        var match = src.match(
            /\.(jpg|jpeg|gif|png|bmp|bitmap|tiff|tif)(\?v=\d+)?$/i
        );

        if (match !== null) {
            var prefix = src.split(match[0]);
            var suffix = match[0];

            return this.removeProtocol(prefix[0] + '_' + size + suffix);
        }

        return null;
    }

    function removeProtocol(path) {
        return path.replace(/http(s)?:/, '');
    }

    return {
        preload: preload,
        loadImage: loadImage,
        switchImage: switchImage,
        imageSize: imageSize,
        getSizedImageUrl: getSizedImageUrl,
        removeProtocol: removeProtocol
    };
})();

/**
 * Variant Selection scripts
 * ------------------------------------------------------------------------------
 *
 * Handles change events from the variant inputs in any `cart/add` forms that may
 * exist.  Also updates the master select and triggers updates when the variants
 * price or image changes.
 *
 * @namespace variants
 */

slate.Variants = (function() {
    /**
     * Variant constructor
     *
     * @param {object} options - Settings from `product.js`
     */
    function Variants(options) {
        this.$container = options.$container;
        this.product = options.product;
        this.singleOptionSelector = options.singleOptionSelector;
        this.originalSelectorId = options.originalSelectorId;
        this.enableHistoryState = options.enableHistoryState;
        this.currentVariant = this._getVariantFromOptions();

        $(this.singleOptionSelector, this.$container).on(
            'change',
            this._onSelectChange.bind(this)
        );
    }

    Variants.prototype = _.assignIn({}, Variants.prototype, {
        /**
         * Get the currently selected options from add-to-cart form. Works with all
         * form input elements.
         *
         * @return {array} options - Values of currently selected variants
         */
        _getCurrentOptions: function() {
            var currentOptions = _.map(
                $(this.singleOptionSelector, this.$container),
                function(element) {
                    var $element = $(element);
                    var type = $element.attr('type');
                    var currentOption = {};

                    if (type === 'radio' || type === 'checkbox') {
                        if ($element[0].checked) {
                            currentOption.value = $element.val();
                            currentOption.index = $element.data('index');

                            return currentOption;
                        } else {
                            return false;
                        }
                    } else {
                        currentOption.value = $element.val();
                        currentOption.index = $element.data('index');

                        return currentOption;
                    }
                }
            );

            // remove any unchecked input values if using radio buttons or checkboxes
            currentOptions = _.compact(currentOptions);

            return currentOptions;
        },

        /**
         * Find variant based on selected values.
         *
         * @param  {array} selectedValues - Values of variant inputs
         * @return {object || undefined} found - Variant object from product.variants
         */
        _getVariantFromOptions: function() {
            var selectedValues = this._getCurrentOptions();
            var variants = this.product.variants;

            var found = _.find(variants, function(variant) {
                return selectedValues.every(function(values) {
                    return _.isEqual(variant[values.index], values.value);
                });
            });

            return found;
        },

        /**
         * Event handler for when a variant input changes.
         */
        _onSelectChange: function() {
            var variant = this._getVariantFromOptions();

            this.$container.trigger({
                type: 'variantChange',
                variant: variant
            });

            if (!variant) {
                return;
            }

            this._updateMasterSelect(variant);
            this._updateImages(variant);
            this._updatePrice(variant);
            this._updateSKU(variant);
            this.currentVariant = variant;

            if (this.enableHistoryState) {
                this._updateHistoryState(variant);
            }
        },

        /**
         * Trigger event when variant image changes
         *
         * @param  {object} variant - Currently selected variant
         * @return {event}  variantImageChange
         */
        _updateImages: function(variant) {
            var variantImage = variant.featured_image || {};
            var currentVariantImage = this.currentVariant.featured_image || {};

            if (!variant.featured_image ||
                variantImage.src === currentVariantImage.src
            ) {
                return;
            }

            this.$container.trigger({
                type: 'variantImageChange',
                variant: variant
            });
        },

        /**
         * Trigger event when variant price changes.
         *
         * @param  {object} variant - Currently selected variant
         * @return {event} variantPriceChange
         */
        _updatePrice: function(variant) {
            if (
                variant.price === this.currentVariant.price &&
                variant.compare_at_price === this.currentVariant.compare_at_price
            ) {
                return;
            }

            this.$container.trigger({
                type: 'variantPriceChange',
                variant: variant
            });
        },

        /**
         * Trigger event when variant sku changes.
         *
         * @param  {object} variant - Currently selected variant
         * @return {event} variantSKUChange
         */
        _updateSKU: function(variant) {
            if (variant.sku === this.currentVariant.sku) {
                return;
            }

            this.$container.trigger({
                type: 'variantSKUChange',
                variant: variant
            });
        },

        /**
         * Update history state for product deeplinking
         *
         * @param  {variant} variant - Currently selected variant
         * @return {k}         [description]
         */
        _updateHistoryState: function(variant) {
            if (!history.replaceState || !variant) {
                return;
            }

            var newurl =
                window.location.protocol +
                '//' +
                window.location.host +
                window.location.pathname +
                '?variant=' +
                variant.id;
            window.history.replaceState({ path: newurl }, '', newurl);
        },

        /**
         * Update hidden master select of variant change
         *
         * @param  {variant} variant - Currently selected variant
         */
        _updateMasterSelect: function(variant) {
            $(this.originalSelectorId, this.$container).val(variant.id);
        }
    });

    return Variants;
})();


/*================ MODULES ================*/
window.Drawers = (function() {
    var Drawer = function(id, position, options) {
        var defaults = {
            close: '.js-drawer-close',
            open: '.js-drawer-open-' + position,
            openClass: 'js-drawer-open',
            dirOpenClass: 'js-drawer-open-' + position
        };

        this.nodes = {
            $parent: $('body, html'),
            $page: $('.page-element'),
            $moved: $('.is-moved-by-drawer')
        };

        this.config = $.extend(defaults, options);
        this.position = position;

        this.$drawer = $('#' + id);
        this.$open = $(this.config.open);

        if (!this.$drawer.length) {
            return false;
        }

        this.drawerIsOpen = false;
        this.init();
    };

    Drawer.prototype.init = function() {
        this.$open.attr('aria-expanded', 'false');
        this.$open.on('click', $.proxy(this.open, this));
        this.$drawer.find(this.config.close).on('click', $.proxy(this.close, this));
    };

    Drawer.prototype.open = function(evt) {
        // Keep track if drawer was opened from a click, or called by another function
        var externalCall = false;

        // don't open an opened drawer
        if (this.drawerIsOpen) {
            return;
        }

        this.$open.addClass(this.config.openClass);

        // Prevent following href if link is clicked
        if (evt) {
            evt.preventDefault();
        } else {
            externalCall = true;
        }

        // Without this, the drawer opens, the click event bubbles up to $nodes.page
        // which closes the drawer.
        if (evt && evt.stopPropagation) {
            evt.stopPropagation();
            // save the source of the click, we'll focus to this on close
            this.$activeSource = $(evt.currentTarget);
        }

        if (this.drawerIsOpen && !externalCall) {
            return this.close();
        }

        // Add is-transitioning class to moved elements on open so drawer can have
        // transition for close animation
        this.nodes.$moved.addClass('is-transitioning');
        this.$drawer.prepareTransition();

        this.nodes.$parent.addClass(
            this.config.openClass + ' ' + this.config.dirOpenClass
        );
        this.drawerIsOpen = true;

        // Set focus on drawer
        slate.a11y.trapFocus({
            $container: this.$drawer,
            namespace: 'drawer_focus'
        });

        // Run function when draw opens if set
        if (
            this.config.onDrawerOpen &&
            typeof this.config.onDrawerOpen === 'function'
        ) {
            if (!externalCall) {
                this.config.onDrawerOpen();
            }
        }

        if (this.$activeSource && this.$activeSource.attr('aria-expanded')) {
            this.$activeSource.attr('aria-expanded', 'true');
        }

        this.bindEvents();
    };

    Drawer.prototype.close = function() {
        // don't close a closed drawer
        if (!this.drawerIsOpen) {
            return;
        }

        this.$open.removeClass(this.config.openClass);

        // deselect any focused form elements
        $(document.activeElement).trigger('blur');

        // Ensure closing transition is applied to moved elements, like the nav
        this.nodes.$moved.prepareTransition({ disableExisting: true });
        this.$drawer.prepareTransition({ disableExisting: true });

        this.nodes.$parent.removeClass(
            this.config.dirOpenClass + ' ' + this.config.openClass
        );

        this.drawerIsOpen = false;

        // Remove focus on drawer
        slate.a11y.removeTrapFocus({
            $container: this.$drawer,
            namespace: 'drawer_focus'
        });

        if (this.$activeSource && this.$activeSource.attr('aria-expanded')) {
            this.$activeSource.attr('aria-expanded', 'false');
        }

        this.unbindEvents();
    };

    Drawer.prototype.bindEvents = function() {
        // Lock scrolling on mobile
        this.nodes.$page.on('touchmove.drawer', function() {
            return false;
        });

        // Clicking out of drawer closes it
        this.nodes.$page.on(
            'click.drawer',
            $.proxy(function() {
                this.close();
                return false;
            }, this)
        );

        // Pressing escape closes drawer
        this.nodes.$parent.on(
            'keyup.drawer',
            $.proxy(function(evt) {
                if (evt.keyCode === 27) {
                    this.close();
                }
            }, this)
        );
    };

    Drawer.prototype.unbindEvents = function() {
        this.nodes.$page.off('.drawer');
        this.nodes.$parent.off('.drawer');
    };

    return Drawer;
})();

window.Modals = (function() {
    var Modal = function(id, name, options) {
        var defaults = {
            close: '.js-modal-close',
            open: '.js-modal-open-' + name,
            openClass: 'modal--is-active'
        };

        this.$modal = $('#' + id);

        if (!this.$modal.length) {
            return false;
        }

        this.nodes = {
            $body: $('body')
        };

        this.config = $.extend(defaults, options);

        this.modalIsOpen = false;
        this.$focusOnOpen = this.config.focusOnOpen ?
            $(this.config.focusOnOpen) :
            this.$modal;
        this.init();
    };

    Modal.prototype.init = function() {
        var $openBtn = $(this.config.open);

        // Add aria controls
        $openBtn.attr('aria-expanded', 'false');

        $(this.config.open).on('click', $.proxy(this.open, this));
        this.$modal.find(this.config.close).on('click', $.proxy(this.close, this));
    };

    Modal.prototype.open = function(evt) {
        // Keep track if modal was opened from a click, or called by another function
        var externalCall = false;

        // don't open an opened modal
        if (this.modalIsOpen) {
            return;
        }

        // Prevent following href if link is clicked
        if (evt) {
            evt.preventDefault();
        } else {
            externalCall = true;
        }

        // Without this, the modal opens, the click event bubbles up to $nodes.page
        // which closes the modal.
        if (evt && evt.stopPropagation) {
            evt.stopPropagation();
            // save the source of the click, we'll focus to this on close
            this.$activeSource = $(evt.currentTarget);
        }

        if (this.modalIsOpen && !externalCall) {
            return this.close();
        }

        this.$modal.prepareTransition().addClass(this.config.openClass);
        this.nodes.$body.addClass(this.config.openClass);

        this.modalIsOpen = true;

        // Set focus on modal
        slate.a11y.trapFocus({
            $container: this.$modal,
            namespace: 'modal_focus',
            $elementToFocus: this.$focusOnOpen
        });

        if (this.$activeSource && this.$activeSource.attr('aria-expanded')) {
            this.$activeSource.attr('aria-expanded', 'true');
        }

        this.bindEvents();
    };

    Modal.prototype.close = function() {
        // don't close a closed modal
        if (!this.modalIsOpen) {
            return;
        }

        // deselect any focused form elements
        $(document.activeElement).trigger('blur');

        this.$modal.prepareTransition().removeClass(this.config.openClass);
        this.nodes.$body.removeClass(this.config.openClass);

        this.modalIsOpen = false;

        // Remove focus on modal
        slate.a11y.removeTrapFocus({
            $container: this.$modal,
            namespace: 'modal_focus'
        });

        if (this.$activeSource && this.$activeSource.attr('aria-expanded')) {
            this.$activeSource.attr('aria-expanded', 'false').focus();
        }

        this.unbindEvents();
    };

    Modal.prototype.bindEvents = function() {
        // Pressing escape closes modal
        this.nodes.$body.on(
            'keyup.modal',
            $.proxy(function(evt) {
                if (evt.keyCode === 27) {
                    this.close();
                }
            }, this)
        );
    };

    Modal.prototype.unbindEvents = function() {
        this.nodes.$body.off('.modal');
    };

    return Modal;
})();

window.QtySelector = (function() {
    var QtySelector = function($el) {
        this.cache = {
            $body: $('body'),
            $subtotal: $('#CartSubtotal'),
            $discountTotal: $('#cartDiscountTotal'),
            $cartTable: $('.cart-table'),
            $cartTemplate: $('#CartProducts')
        };

        this.settings = {
            loadingClass: 'js-qty--is-loading',
            isCartTemplate: this.cache.$body.hasClass('template-cart'),
            // On the cart template, minimum is 0. Elsewhere min is 1
            minQty: this.cache.$body.hasClass('template-cart') ? 0 : 1
        };

        this.$el = $el;
        this.qtyUpdateTimeout;
        this.createInputs();
        this.bindEvents();
    };

    QtySelector.prototype.createInputs = function() {
        var $el = this.$el;

        var data = {
            value: $el.val(),
            key: $el.attr('id'),
            name: $el.attr('name'),
            line: $el.attr('data-line')
        };
        var source = $('#QuantityTemplate').html();
        var template = Handlebars.compile(source);

        this.$wrapper = $(template(data)).insertBefore($el);

        // Remove original number input
        $el.remove();
    };

    QtySelector.prototype.validateAvailability = function(line, quantity) {
        var product = theme.cartObject.items[line - 1]; // 0-based index in API
        var handle = product.handle; // needed for the ajax request
        var id = product.id; // needed to find right variant from ajax results

        var params = {
            type: 'GET',
            url: '/products/' + handle + '.js',
            dataType: 'json',
            success: $.proxy(function(cartProduct) {
                this.validateAvailabilityCallback(line, quantity, id, cartProduct);
            }, this)
        };

        $.ajax(params);
    };

    QtySelector.prototype.validateAvailabilityCallback = function(
        line,
        quantity,
        id,
        product
    ) {
        var quantityIsAvailable = true;

        // This returns all variants of a product.
        // Loop through them to get our desired one.
        for (var i = 0; i < product.variants.length; i++) {
            var variant = product.variants[i];
            if (variant.id === id) {
                break;
            }
        }

        // If the variant tracks inventory and does not sell when sold out
        // we can compare the requested with available quantity
        if (
            variant.inventory_management !== null &&
            variant.inventory_policy === 'deny'
        ) {
            if (variant.inventory_quantity < quantity) {

                // Set quantity to max amount available
                this.$wrapper.find('.js-qty__input').val(variant.inventory_quantity);

                quantityIsAvailable = false;
                this.$wrapper.removeClass(this.settings.loadingClass);
            }
        }

        if (quantityIsAvailable) {
            this.updateItemQuantity(line, quantity);
        }
    };

    QtySelector.prototype.validateQty = function(qty) {
        if (parseFloat(qty) === parseInt(qty, 10) && !isNaN(qty)) {
            // We have a valid number!
        } else {
            // Not a number. Default to 1.
            qty = 1;
        }
        return parseInt(qty, 10);
    };

    QtySelector.prototype.adjustQty = function(evt) {
        var $el = $(evt.currentTarget);
        var $input = $el.siblings('.js-qty__input');
        var qty = this.validateQty($input.val());
        var line = $input.attr('data-line');

        if ($el.hasClass('js-qty__adjust--minus')) {
            qty -= 1;
            if (qty <= this.settings.minQty) {
                qty = this.settings.minQty;
            }
        } else {
            qty += 1;
        }

        if (this.settings.isCartTemplate) {
            $el.parent().addClass(this.settings.loadingClass);
            this.updateCartItemPrice(line, qty);
        } else {
            $input.val(qty);
        }
    };

    QtySelector.prototype.bindEvents = function() {
        this.$wrapper
            .find('.js-qty__adjust')
            .on('click', $.proxy(this.adjustQty, this));

        // Select input text on click
        this.$wrapper.on('click', '.js-qty__input', function() {
            this.setSelectionRange(0, this.value.length);
        });

        // If the quantity changes on the cart template, update the price
        if (this.settings.isCartTemplate) {
            this.$wrapper.on(
                'change',
                '.js-qty__input',
                $.proxy(function(evt) {
                    var $input = $(evt.currentTarget);
                    var line = $input.attr('data-line');
                    var qty = this.validateQty($input.val());
                    $input.parent().addClass(this.settings.loadingClass);
                    this.updateCartItemPrice(line, qty);
                }, this)
            );
        }
    };

    QtySelector.prototype.updateCartItemPrice = function(line, qty) {
        // Update cart after short timeout so user doesn't create simultaneous ajax calls
        clearTimeout(this.qtyUpdateTimeout);
        this.qtyUpdateTimeout = setTimeout(
            $.proxy(function() {
                this.validateAvailability(line, qty);
            }, this),
            200
        );
    };

    QtySelector.prototype.updateItemQuantity = function(line, quantity) {
        var params = {
            type: 'POST',
            url: '/cart/change.js',
            data: 'quantity=' + quantity + '&line=' + line,
            dataType: 'json',
            success: $.proxy(function(cart) {
                this.updateCartItemCallback(cart);
            }, this)
        };

        $.ajax(params);
    };

    QtySelector.prototype.updateCartItemCallback = function(cart) {
        // Reload the page to show the empty cart if no items
        if (cart.item_count === 0) {
            location.reload();
            return;
        }

        // Update cart object
        theme.cartObject = cart;

        // Handlebars.js cart layout
        var data = {};
        var items = [];
        var item = {};
        var source = $('#CartProductTemplate').html();
        var template = Handlebars.compile(source);
        var prodImg;

        // Add each item to our handlebars.js data
        $.each(cart.items, function(index, cartItem) {
            /* Hack to get product image thumbnail
             *   - If image is not null
             *     - Remove file extension, add 240x240, and re-add extension
             *     - Create server relative link
             *   - A hard-coded url of no-image
             */

            if (cartItem.image === null) {
                prodImg =
                    '//cdn.shopify.com/s/assets/admin/no-image-medium-cc9732cb976dd349a0df1d39816fbcc7.gif';
            } else {
                prodImg = cartItem.image
                    .replace(/(\.[^.]*)$/, '_240x240$1')
                    .replace('http:', '');
            }

            if (cartItem.properties !== null) {
                $.each(cartItem.properties, function(key, value) {
                    if (key.charAt(0) === '_' || !value) {
                        delete cartItem.properties[key];
                    }
                });
            }

            // Create item's data object and add to 'items' array
            item = {
                key: cartItem.key,
                line: index + 1, // Shopify uses a 1+ index in the API
                url: cartItem.url,
                img: prodImg,
                name: cartItem.product_title,
                variation: cartItem.variant_title,
                properties: cartItem.properties,
                itemQty: cartItem.quantity,
                price: theme.Currency.formatMoney(cartItem.price, theme.moneyFormat),
                vendor: cartItem.vendor,
                linePrice: theme.Currency.formatMoney(
                    cartItem.line_price,
                    theme.moneyFormat
                ),
                originalLinePrice: theme.Currency.formatMoney(
                    cartItem.original_line_price,
                    theme.moneyFormat
                ),
                discounts: cartItem.discounts,
                discountsApplied: cartItem.line_price === cartItem.original_line_price ? false : true
            };

            items.push(item);
            theme.updateCurrencies();
        });

        // Gather all cart data and add to DOM
        data = {
            items: items
        };
        this.cache.$cartTemplate.empty().append(template(data));

        // Create new quantity selectors
        this.cache.$cartTable.find('input[type="number"]').each(function(i, el) {
            new QtySelector($(el));
        });

        // Update the cart subtotal
        this.cache.$subtotal.html(
            theme.Currency.formatMoney(cart.total_price, theme.moneyFormat)
        );

        // Update the cart total discounts
        if (cart.total_discount > 0) {
            this.cache.$discountTotal.html(
                theme.strings.totalCartDiscount.replace(
                    '[savings]',
                    theme.Currency.formatMoney(cart.total_discount, theme.moneyFormat)
                )
            );
        } else {
            this.cache.$discountTotal.empty();
        }

        theme.miniCart.updateElements();
        theme.updateCurrencies();
        // Set focus on cart table
        slate.a11y.pageLinkFocus(this.cache.$cartTable);
    };

    return QtySelector;
})();

/*
  Allow product to be added to cart via ajax with
  custom success and error responses.
*/
window.AjaxCart = (function() {
    var styleCart = $('.js-mini-cart').attr("data-cartmini");
    var cart = function($form) {
        this.cache = {
            $cartIconIndicator: $('.site-header__cart-indicator')
        };

        this.$form = $form;
        this.eventListeners();

        this.showNotice = false;
        if (this.$form.length) {
            this.showNotice = this.$form.hasClass('js-form--notice') ? true : false;
        }
    };

    cart.prototype.eventListeners = function() {
        if (this.$form.length) {
            this.$form.on('submit', $.proxy(this.addItemFromForm, this));
        }
    };

    cart.prototype.addItemFromForm = function(evt) {
        evt.preventDefault();

        var params = {
            type: 'POST',
            url: '/cart/add.js',
            data: this.$form.serialize(),
            dataType: 'json',
            success: $.proxy(function(lineItem) {
                //this.success(lineItem);
                window.location.href = '/cart';
            }, this),
            error: $.proxy(function(XMLHttpRequest, textStatus) {
                this.error(XMLHttpRequest, textStatus);
            }, this)
        };
        $.ajax(params);
    };

    cart.prototype.success = function(item) {
        theme.miniCart.updateElements();
        theme.miniCart.generateCart();
        if (styleCart != 'false') {
            if (this.showNotice) {
                var htmlVariant = item.variant_title !== null ? '<i>(' + item.variant_title + ')</i>' : '';
                var htmlAlert = '<div class="media mt-2 alert--cart"><a class="mr-3" href="/cart"><img class="lazyload" data-src="' + item.image + '"></a><div class="media-body align-self-center"><p class="m-0 font-weight-bold">' + item.product_title + ' x ' + item.quantity + '</p>' + htmlVariant + '<div><div>';
                theme.alert.new(theme.strings.addToCartSuccess, htmlAlert, 3000, 'notice');
            } else {
                theme.crosssell.showPopup(item);
            }
        }
    };

    // Error handling reference from Shopify.onError in api.jquery.js
    cart.prototype.error = function(XMLHttpRequest) {
        var data = JSON.parse(XMLHttpRequest.responseText);

        if (data.message) {
            theme.alert.new('', data.description, 3000, 'warning');
        }
    };

    return cart;
})();

/*================ TEMPLATES ================*/
theme.customerTemplates = (function() {
    function initEventListeners() {
        // Show reset password form
        $('#RecoverPassword').on('click', function(evt) {
            evt.preventDefault();
            toggleRecoverPasswordForm();
        });

        // Hide reset password form
        $('#HideRecoverPasswordLink').on('click', function(evt) {
            evt.preventDefault();
            toggleRecoverPasswordForm();
        });
    }

    /**
     *
     *  Show/Hide recover password form
     *
     */
    function toggleRecoverPasswordForm() {
        $('#RecoverPasswordForm').toggleClass('hide');
        $('#CustomerLoginForm').toggleClass('hide');
    }

    /**
     *
     *  Show reset password success message
     *
     */
    function resetPasswordSuccess() {
        // check if reset password form was successfully submited
        if (!$('.reset-password-success').length) {
            return;
        }

        // show success message
        $('#ResetSuccess').removeClass('hide');
    }

    /**
     *
     *  Show/hide customer address forms
     *
     */
    function customerAddressForm() {
        var $newAddressForm = $('#AddressNewForm');

        if (!$newAddressForm.length) {
            return;
        }

        // Initialize observers on address selectors, defined in shopify_common.js
        if (Shopify) {
            // eslint-disable-next-line no-new
            new Shopify.CountryProvinceSelector(
                'AddressCountryNew',
                'AddressProvinceNew', {
                    hideElement: 'AddressProvinceContainerNew'
                }
            );
        }

        // Initialize each edit form's country/province selector
        $('.address-country-option').each(function() {
            var formId = $(this).data('form-id');
            var countrySelector = 'AddressCountry_' + formId;
            var provinceSelector = 'AddressProvince_' + formId;
            var containerSelector = 'AddressProvinceContainer_' + formId;

            // eslint-disable-next-line no-new
            new Shopify.CountryProvinceSelector(countrySelector, provinceSelector, {
                hideElement: containerSelector
            });
        });

        // Toggle new/edit address forms
        $('.address-new-toggle').on('click', function() {
            $newAddressForm.toggleClass('hide');
        });

        $('.address-edit-toggle').on('click', function() {
            var formId = $(this).data('form-id');
            $('#EditAddress_' + formId).toggleClass('hide');
        });

        $('.address-delete').on('click', function() {
            var $el = $(this);
            var formId = $el.data('form-id');
            var confirmMessage = $el.data('confirm-message');

            // eslint-disable-next-line no-alert
            if (
                confirm(
                    confirmMessage || 'Are you sure you wish to delete this address?'
                )
            ) {
                Shopify.postLink('/account/addresses/' + formId, {
                    parameters: { _method: 'delete' }
                });
            }
        });
    }

    /**
     *
     *  Check URL for reset password hash
     *
     */
    function checkUrlHash() {
        var hash = window.location.hash;

        // Allow deep linking to recover password form
        if (hash === '#recover') {
            toggleRecoverPasswordForm();
        }
    }

    return {
        init: function() {
            checkUrlHash();
            initEventListeners();
            resetPasswordSuccess();
            customerAddressForm();
        }
    };
})();

/*================ SECTIONS ================*/
theme.HeaderSection = (function() {
    function Header() {
        theme.NavDrawer = new window.Drawers('NavDrawer', 'left');
    }

    return Header;
})();

theme.Product = (function() {
    var defaults = {
        smallBreakpoint: 750,
        productThumbIndex: 0,
        productThumbMax: 0,
        ajaxCart: false,
        stockSetting: false
    };

    function Product(container) {
        var $container = (this.$container = $(container));
        var sectionId = $container.attr('data-section-id');

        this.selectors = {
            originalSelectorId: '#ProductSelect-' + sectionId,
            modal: 'ProductModal',
            productZoomImage: '#ProductZoomImg',
            addToCart: '#AddToCart-' + sectionId,
            productPrice: '#ProductPrice-' + sectionId,
            comparePrice: '#ComparePrice-' + sectionId,
            addToCartText: '#AddToCartText-' + sectionId,
            SKU: '.js-variant-sku',
            productImageContainers: '.product__photo-container-' + sectionId,
            productImageWrappers: '.product__photo-wrapper-' + sectionId,
            productThumbContainers: '.product-single__thumbnail-item-' + sectionId,
            productThumbsWrapper: '.product-single__thumbnails-' + sectionId,
            productThumbs: '.product-single__thumbnail-' + sectionId,
            saleTag: '#ProductSaleTag-' + sectionId,
            productStock: '#ProductStock-' + sectionId,
            singleOptionSelector: '.single-option-selector-' + sectionId,
            shopifyPaymentButton: '.shopify-payment-button',
            availability: '.product-single__availability',
            hurrify: '.js-hurrify'
        };

        this.settings = $.extend({}, defaults, {
            sectionId: sectionId,
            ajaxCart: $container.data('ajax'),
            stockSetting: $container.data('stock'),
            enableHistoryState: $container.data('enable-history-state') || false,
            namespace: '.product-' + sectionId
        });

        // Stop parsing if we don't have the product json script tag
        if (!$('#ProductJson-' + sectionId).html()) {
            return;
        }

        this.productSingleObject = JSON.parse(
            $('#ProductJson-' + sectionId).html()
        );
        this.addVariantInfo();

        this.init();
    }

    Product.prototype = _.assignIn({}, Product.prototype, {
        init: function() {
            this._stringOverrides();
            this._initVariants();
            this._productZoomImage();
            this._productThumbSwitch();
            this._productThumbnailSlider();
            this._initQtySelector();

            if (this.settings.ajaxCart) {
                theme.AjaxCart = new window.AjaxCart(
                    $('#AddToCartForm-' + this.settings.sectionId)
                );
            }
        },

        _stringOverrides: function() {
            window.productStrings = window.productStrings || {};
            $.extend(theme.strings, window.productStrings);
        },

        addVariantInfo: function() {
            if (!this.productSingleObject || !this.settings.stockSetting) {
                return;
            }

            var variantInfo = JSON.parse(
                $('#VariantJson-' + this.settings.sectionId).html()
            );

            for (var i = 0; i < variantInfo.length; i++) {
                $.extend(this.productSingleObject.variants[i], variantInfo[i]);
            }
        },

        _initVariants: function() {
            var options = {
                $container: this.$container,
                enableHistoryState: this.settings.enableHistoryState,
                product: this.productSingleObject,
                singleOptionSelector: this.selectors.singleOptionSelector,
                originalSelectorId: this.selectors.originalSelectorId
            };

            // eslint-disable-next-line no-new
            this.variants = new slate.Variants(options);

            this.$container.on(
                'variantChange' + this.settings.namespace,
                this._updateAddToCartBtn.bind(this)
            );
            this.$container.on(
                'variantChange' + this.settings.namespace,
                this._updateStickyCart.bind(this)
            );
            this.$container.on(
                'variantPriceChange' + this.settings.namespace,
                this._updatePrice.bind(this)
            );
            this.$container.on(
                'variantSKUChange' + this.settings.namespace,
                this._updateSKU.bind(this)
            );
            this.$container.on(
                'variantImageChange' + this.settings.namespace,
                this._updateImages.bind(this)
            );
        },

        _updateStock: function(variant) {
            if (!this.settings.stockSetting) return;

            var $stock = $(this.selectors.productStock),
                $hurrify = $(this.selectors.hurrify);

            // If we don't track variant inventory, hide stock
            if (!variant || !variant.inventory_management) {
                $stock.addClass('hide');
                $hurrify.addClass('hide');
                return;
            }

            if (variant.inventory_quantity < 10 && variant.inventory_quantity > 0) {
                $stock
                    .html(
                        theme.strings.stockAvailable.replace(
                            '1',
                            variant.inventory_quantity
                        )
                    )
                    .removeClass('hide');
                $hurrify.removeClass('hide').find('.progress-bar').css('width', variant.inventory_quantity * 10 + '%');
                return;
            }

            if (variant.inventory_quantity <= 0 && variant.incoming) {
                $stock
                    .html(
                        theme.strings.willNotShipUntil.replace(
                            '[date]',
                            variant.next_incoming_date
                        )
                    )
                    .removeClass('hide');
                $hurrify.addClass('hide');
                return;
            }

            // If there's more than 10 available, hide stock
            $stock.addClass('hide');
            $hurrify.addClass('hide');
        },

        _updateIncomingInfo: function(variant) {
            if (!this.settings.stockSetting) return;

            var $stock = $(this.selectors.productStock);

            if (variant.incoming) {
                $stock
                    .html(
                        theme.strings.willBeInStockAfter.replace(
                            '[date]',
                            variant.next_incoming_date
                        )
                    )
                    .removeClass('hide');
                return;
            }

            // If there is no stock incoming, hide stock
            $stock.addClass('hide');
        },

        _updateAddToCartBtn: function(evt) {
            var variant = evt.variant;

            var cache = {
                $addToCart: $(this.selectors.addToCart),
                $addToCartText: $(this.selectors.addToCartText)
            };

            if (variant) {
                // Select a valid variant if available
                theme.noticeSoldout.init(variant);
                if (variant.available) {
                    // We have a valid product variant, so enable the submit button
                    cache.$addToCart.removeClass('btn--sold-out').prop('disabled', false);
                    cache.$addToCartText.html(theme.strings.addToCart);
                    $(this.selectors.shopifyPaymentButton, this.$container).show();
                    // Show how many items are left, if below 10
                    this._updateStock(variant);
                    //update availability - available
                    $(this.selectors.availability).find('span').text(theme.strings.available);
                } else {
                    // Variant is sold out, disable the submit button
                    cache.$addToCart.prop('disabled', true).addClass('btn--sold-out');
                    cache.$addToCartText.html(theme.strings.soldOut);
                    $(this.selectors.shopifyPaymentButton, this.$container).hide();
                    // Update when stock will be available
                    this._updateIncomingInfo(variant);
                    //update availability - soldout
                    $(this.selectors.availability).find('span').text(theme.strings.soldOut);
                }
            } else {
                cache.$addToCart.prop('disabled', true).removeClass('btn--sold-out');
                cache.$addToCartText.html(theme.strings.unavailable);
                //update availability - unavailable
                $(this.selectors.availability).find('span').text(theme.strings.unavailable);
                $(this.selectors.shopifyPaymentButton, this.$container).hide();
                // Hide stock display
                this._updateStock();
            }
        },

        _updatePrice: function(evt) {
            var variant = evt.variant;

            if (variant) {
                $(this.selectors.productPrice).html(
                    theme.Currency.formatMoney(variant.price, theme.moneyFormat)
                );

                // Update and show the product's compare price if necessary
                if (variant.compare_at_price > variant.price) {
                    $(this.selectors.comparePrice)
                        .html(
                            theme.Currency.formatMoney(
                                variant.compare_at_price,
                                theme.moneyFormat
                            )
                        )
                        .removeClass('hide');
                    $(this.selectors.saleTag).removeClass('hide');
                } else {
                    $(this.selectors.comparePrice).addClass('hide');
                    $(this.selectors.saleTag).addClass('hide');
                }

                theme.updateCurrencies();
            } else {
                $(this.selectors.comparePrice).addClass('hide');
            }
        },

        _updateSKU: function(evt) {
            var variant = evt.variant;

            if (variant) {
                $(this.selectors.SKU).html(variant.sku);
            }
        },

        _updateImages: function(evt) {
            var variant = evt.variant;

            if (variant && variant.featured_image) {
                var imageId = variant.featured_image.id;
                this.switchProductImage(imageId);
                this.setActiveThumbnail(imageId);
            }
        },
        _updateStickyCart: function(evt) {
            var variant = evt.variant,
                $stickyPrice = $('#js-sticky-price'),
                $stickyTitle = $('#js-sticky-title'),
                $stickyImage = $('#js-sticky-img'),
                $stickyButton = $('#js-sticky-btn');
            if (variant) {
                //update title
                $stickyTitle.html(' - ' + variant.title);
                //update price
                $stickyPrice.html(theme.Currency.formatMoney(variant.price, theme.moneyFormat));
                //update selectbox
                for (var i = 1; i <= 3; i++) {
                    var option = 'option' + i,
                        $selecBox = '#js-sticky-option-' + i;
                    if (variant[option] !== null) {
                        var valueOption = variant[option];
                        $($selecBox).val(valueOption);
                    }
                }
                //update button cart
                if (variant.available) {
                    $stickyButton.prop('disabled', false).removeClass('btn--sold-out');
                    $stickyButton.html(theme.strings.addToCart);
                } else {
                    $stickyButton.prop('disabled', true).addClass('btn--sold-out');
                    $stickyButton.html(theme.strings.soldOut);
                }
                //update image
                if (variant.featured_image) {
                    $stickyImage.attr('src', theme.Images.getSizedImageUrl(variant.featured_image.src, '200x'));
                }
            } else {
                //update title
                $stickyTitle.html(' - ' + theme.strings.unavailable);
                //update button cart
                $stickyButton.prop('disabled', true).removeClass('btn--sold-out');
                $stickyButton.html(theme.strings.unavailable);
            }
        },

        switchProductImage: function(imageId) {
            var $imageToShow = $(
                this.selectors.productImageContainers +
                "[data-image-id='" +
                imageId +
                "']",
                this.$container
            );
            var $imagesToHide = $(
                this.selectors.productImageContainers +
                ":not([data-image-id='" +
                imageId +
                "'])",
                this.$container
            );
            $imagesToHide.addClass('hide');
            $imageToShow.removeClass('hide');
            //Scroll to active
            topMenuHeight = $('.site-header').outerHeight();
            if (this.settings.sectionId === 'product-template-8') {
                $([document.documentElement, document.body]).animate({
                    scrollTop: $imageToShow.offset().top - topMenuHeight
                }, 500);
            }
        },

        setActiveThumbnail: function(imageId) {
            var $thumbnailToShow = $(
                this.selectors.productThumbContainers +
                "[data-image-id='" +
                imageId +
                "']",
                this.$container
            );
            var $thumbnailsToHide = $(
                this.selectors.productThumbContainers +
                ":not([data-image-id='" +
                imageId +
                "'])",
                this.$container
            );
            $thumbnailsToHide.removeClass('is-active');
            $thumbnailToShow.addClass('is-active');
            $thumbnailToShow.trigger('click');
            var $thumbnails = $(this.selectors.productThumbsWrapper, this.$container);

            // If there is a slick carousel, get the slide index, and position it into view with animation.
            if ($thumbnails.hasClass('slick-initialized')) {
                // eslint-disable-next-line shopify/jquery-dollar-sign-reference
                var currentActiveSlideIndex = $thumbnails.slick('slickCurrentSlide');
                var newActiveSlideIndex = parseInt(
                    $thumbnailToShow.attr('data-slick-index')
                );
                if (currentActiveSlideIndex !== newActiveSlideIndex) {
                    $thumbnails.slick('slickGoTo', newActiveSlideIndex, false);

                }
            }
        },

        _productZoomImage: function() {
            // The zoom image is only used on the product template, so return early
            // even if a featured product section is present.
            if (!$('.product-single ' + this.selectors.productImageContainers).length) {
                return;
            }

            var self = this;

            $(this.selectors.productImageWrappers).on(
                'click' + this.settings.namespace,
                function(evt) {
                    evt.preventDefault();
                    // Empty src before loadig new image to avoid awkward image swap
                    $(self.selectors.productZoomImage)
                        .attr('src', '')
                        .attr('src', $(this).attr('href'));
                }
            );

            this.ProductModal = new window.Modals(
                this.selectors.modal,
                'product-modal'
            );

            // Close modal if clicked, but not if the image is clicked
            this.ProductModal.$modal.on('click' + this.settings.namespace, function(
                evt
            ) {
                if (evt.target.nodeName !== 'IMG') {
                    self.ProductModal.close();
                }
            });
        },

        _productThumbSwitch: function() {
            if (!$(this.selectors.productThumbs).length) {
                return;
            }

            var self = this;

            $(this.selectors.productThumbs).on(
                'click' + this.settings.namespace,
                function(evt) {
                    evt.preventDefault();
                    var imageId = $(this)
                        .parent()
                        .data('image-id');
                    self.setActiveThumbnail(imageId);
                    self.switchProductImage(imageId);
                }
            );
            //trigger hover thumb
            // $(this.selectors.productThumbs).on('click',function(){
            //   $(this).trigger('click');
            // });
        },

        /*
          Thumbnail slider
         */
        _productThumbnailSlider: function() {
            var $productThumbsWrapper = $(this.selectors.productThumbsWrapper);
            var $productThumbs = $(this.selectors.productThumbs);
            if (!$productThumbs.length) {
                return;
            }

            if ($productThumbs.length > 1) {
                $productThumbsWrapper.on(
                    'init' + this.settings.namespace,
                    this._productSwipeInit.bind(this)
                );

                if (this.settings.sectionId === 'product-template-3' || this.settings.sectionId === 'product-template-4') {
                    $productThumbsWrapper.slick({
                        accessibility: false,
                        arrows: true,
                        dots: false,
                        infinite: false,
                        autoplay: false,
                        slidesToShow: 5,
                        slidesToScroll: 5,
                        vertical: true,
                        verticalSwiping: true,
                        responsive: [{
                            breakpoint: 992,
                            settings: {
                                vertical: false,
                                verticalSwiping: false,
                                slidesToShow: 4,
                                slidesToScroll: 4,
                                dots: false,
                            }
                        }]
                    }).css('opacity', '1');
                } else if (this.settings.sectionId === 'product-template-5') {
                    $productThumbsWrapper.slick({
                        accessibility: false,
                        arrows: true,
                        dots: false,
                        infinite: true,
                        autoplay: false,
                        slidesToShow: 2,
                        slidesToScroll: 1,
                        responsive: [{
                            breakpoint: 992,
                            settings: {
                                slidesToShow: 4,
                                slidesToScroll: 4,
                                dots: false,
                            }
                        }]
                    }).css('opacity', '1');
                } else if (this.settings.sectionId === 'product-template-7') {
                    $productThumbsWrapper.slick({
                        accessibility: false,
                        arrows: true,
                        dots: true,
                        infinite: true,
                        autoplay: false,
                        slidesToShow: 1,
                        slidesToScroll: 1,
                        responsive: [{
                            breakpoint: 992,
                            settings: {
                                slidesToShow: 1,
                                slidesToScroll: 1,
                                dots: false,
                                arrows: true,
                            }
                        }]
                    }).css('opacity', '1');
                } else if (this.settings.sectionId === 'product-template-8') {
                    var lastId,
                        topMenu = $(".product-single__thumbnails"),
                        topMenuHeight = $('.site-header').outerHeight() + 20,
                        // All list items
                        menuItems = topMenu.find(".product-single__thumbnail");


                    if ($(window).width() > 767) {
                        menuItems.click(function(e) {
                            var findid = $(this).attr('href');
                            offsetTop = $(findid).offset().top - topMenuHeight + 1;
                            $('html, body').stop().animate({
                                scrollTop: offsetTop
                            }, 200);
                            return false;
                        });
                        // Anchors corresponding to menu items
                        scrollItems = menuItems.map(function() {
                            var item = $($(this).attr('href'));
                            if (item.length) { return item; }
                        });

                        $(window).scroll(function() {
                            // Get container scroll position
                            var fromTop = $(this).scrollTop() + topMenuHeight;
                            // Get id of current scroll item
                            var cur = scrollItems.map(function() {
                                if ($(this).offset().top < fromTop)
                                    return this;
                            });
                            // Get the id of the current element
                            cur = cur[cur.length - 1];
                            var id = cur && cur.length ? cur[0].id : "";

                            if (lastId !== id) {
                                lastId = id;
                                // Set/remove active class
                                menuItems
                                    .parent().removeClass("is-active")
                                    .end().filter("[href='#" + id + "']").parent().addClass("is-active");
                            }
                        });
                    } else {
                        menuItems.click(function(e) {
                            var findid = $(this).attr('href');
                            offsetTop = $(findid).offset().top;
                            $('html, body').stop().animate({
                                scrollTop: offsetTop
                            });
                            return false;
                        });
                    }

                    $productThumbsWrapper.slick({
                        accessibility: false,
                        arrows: true,
                        dots: false,
                        infinite: false,
                        autoplay: false,
                        slidesToShow: 5,
                        slidesToScroll: 1,
                        vertical: true,
                        verticalSwiping: true,
                        responsive: [{
                            breakpoint: 992,
                            settings: {
                                vertical: false,
                                verticalSwiping: false,
                                slidesToShow: 4,
                                slidesToScroll: 4,
                                dots: true,
                            }
                        }]
                    }).css('opacity', '1');
                } else {
                    $productThumbsWrapper.slick({
                        accessibility: false,
                        arrows: true,
                        dots: false,
                        infinite: false,
                        autoplay: false,
                        slidesToShow: 4,
                        slidesToScroll: 4
                    }).css('opacity', '1');
                }

                // Show highlighted thumbnail by repositioning slider
                $productThumbsWrapper.slick(
                    'slickGoTo',
                    $productThumbsWrapper.find('.is-active').attr('data-slick-index'),
                    true
                );
            }
        },

        _productSwipeInit: function(evt, obj) {
            // Slider is initialized. Setup custom swipe events
            this.settings.productThumbIndex = obj.currentSlide;
            this.settings.productThumbMax = obj.slideCount - 1; // we need the 0-based index

            var self = this;

            $(this.selectors.productImageWrappers).on(
                'swipeleft swiperight',
                function(event) {
                    if (event.type === 'swipeleft') {
                        self._goToNextThumbnail();
                    }

                    if (event.type === 'swiperight') {
                        self._goToPrevThumbnail();
                    }

                    // Trigger click on newly requested thumbnail
                    $(
                            '.product-single__thumbnail-item[data-slick-index="' +
                            self.settings.productThumbIndex +
                            '"]'
                        )
                        .find('.product-single__thumbnail')
                        .trigger('click');

                }
            );
        },
        _goToNextThumbnail: function() {
            this.settings.productThumbIndex++;

            if (this.settings.productThumbIndex > this.settings.productThumbMax) {
                this.settings.productThumbIndex = 0;
            }

            $(this.selectors.productThumbsWrapper).slick(
                'slickGoTo',
                this.settings.productThumbIndex,
                true
            );
        },

        _goToPrevThumbnail: function() {
            this.settings.productThumbIndex--;

            if (this.settings.productThumbIndex < 0) {
                this.settings.productThumbIndex = this.settings.productThumbMax;
            }

            $(this.selectors.productThumbsWrapper).slick(
                'slickGoTo',
                this.settings.productThumbIndex,
                true
            );
        },

        _initQtySelector: function() {
            this.$container.find('.product-form__quantity').each(function(i, el) {
                // eslint-disable-next-line no-new
                new QtySelector($(el));
            });
        },

        onUnload: function() {
            $(this.selectors.productImageWrappers).off(this.settings.namespace);
            $(this.selectors.productThumbs).off(this.settings.namespace);
            $(this.selectors.productThumbs).slick('unslick');
            if (this.ProductModal) {
                this.ProductModal.$modal.off(this.settings.namespace);
            }
        }
    });

    return Product;
})();

theme.Slideshow = (function() {
    this.$slideshow = null;
    var classes = {
        slideshow: 'slideshow',
        slickActiveMobile: 'slick-active-mobile',
        controlsHover: 'slideshow__controls--hover',
        isPaused: 'is-paused'
    };

    var selectors = {
        section: '.shopify-section',
        wrapper: '#SlideshowWrapper-',
        slides: '.slideshow__slide',
        textWrapperMobile: '.slideshow__text-wrap--mobile',
        textContentMobile: '.slideshow__text-content--mobile',
        controls: '.slideshow__controls',
        dots: '.slick-dots',
        arrowLeft: '.slideshow__arrow-left',
        arrowRight: '.slideshow__arrow-right'
    };

    function slideshow(el, sectionId) {
        var $slideshow = (this.$slideshow = $(el));
        this.adaptHeight = this.$slideshow.data('adapt-height');
        this.$wrapper = this.$slideshow.closest(selectors.wrapper + sectionId);
        this.$section = this.$wrapper.closest(selectors.section);
        this.$controls = this.$wrapper.find(selectors.controls);
        this.$textWrapperMobile = this.$section.find(selectors.textWrapperMobile);
        this.autorotate = this.$slideshow.data('autorotate');
        var autoplaySpeed = this.$slideshow.data('speed');
        var loadSlideA11yString = this.$slideshow.data('slide-nav-a11y');

        this.settings = {
            rtl: theme.rtl,
            accessibility: true,
            arrows: true,
            dots: true,
            fade: (theme.rtl ? false : true),
            draggable: true,
            touchThreshold: 20,
            autoplay: this.autorotate,
            autoplaySpeed: autoplaySpeed
        };

        this.$slideshow.on('beforeChange', beforeChange.bind(this));
        this.$slideshow.on('init', slideshowA11ySetup.bind(this));

        // Add class to style mobile dots & show the correct text content for the
        // first slide on mobile when the slideshow initialises
        this.$slideshow.on(
            'init',
            function() {
                this.$mobileDots
                    .find('li:first-of-type')
                    .addClass(classes.slickActiveMobile);
                this.showMobileText(0);
            }.bind(this)
        );

        if (this.adaptHeight) {
            this.setSlideshowHeight();
            $(window).resize($.debounce(50, this.setSlideshowHeight.bind(this)));
        }

        this.$slideshow.slick(this.settings);

        // This can't be called when the slick 'init' event fires due to how slick
        // adds a11y features.
        slideshowPostInitA11ySetup.bind(this)();
    }

    function slideshowA11ySetup(event, obj) {
        var $slider = obj.$slider;
        var $list = obj.$list;
        this.$dots = this.$section.find(selectors.dots);
        this.$mobileDots = this.$dots.eq(1);

        // Remove default Slick aria-live attr until slider is focused
        $list.removeAttr('aria-live');

        //     this.$wrapper.on('keyup', keyboardNavigation.bind(this));
        //     this.$controls.on('keyup', keyboardNavigation.bind(this));
        //     this.$textWrapperMobile.on('keyup', keyboardNavigation.bind(this));

        // When an element in the slider is focused
        // pause slideshow and set aria-live.
        this.$wrapper
            .on(
                'focusin',
                function(evt) {
                    if (!this.$wrapper.has(evt.target).length) {
                        return;
                    }

                    $list.attr('aria-live', 'polite');
                    if (this.autorotate) {
                        $slider.slick('slickPause');
                    }
                }.bind(this)
            )
            .on(
                'focusout',
                function(evt) {
                    if (!this.$wrapper.has(evt.target).length) {
                        return;
                    }

                    $list.removeAttr('aria-live');
                }.bind(this)
            );

        // Add arrow key support when focused
        if (this.$dots) {
            this.$dots
                .find('a')
                .each(function() {
                    var $dot = $(this);
                    $dot.on('click keyup', function(evt) {
                        if (
                            evt.type === 'keyup' &&
                            evt.which !== slate.utils.keyboardKeys.ENTER
                        )
                            return;

                        evt.preventDefault();

                        var slideNumber = $(evt.target).data('slide-number');

                        $slider.attr('tabindex', -1).slick('slickGoTo', slideNumber);

                        if (evt.type === 'keyup') {
                            $slider.focus();
                        }
                    });
                })
                .eq(0)
                .attr('aria-current', 'true');
        }

        this.$controls
            .on('focusin', highlightControls.bind(this))
            .on('focusout', unhighlightControls.bind(this));
    }

    function slideshowPostInitA11ySetup() {
        var $slides = this.$slideshow.find(selectors.slides);

        $slides.removeAttr('role').removeAttr('aria-labelledby');
        this.$dots
            .removeAttr('role')
            .find('li')
            .removeAttr('role')
            .removeAttr('aria-selected')
            .each(function() {
                var $dot = $(this);
                var ariaControls = $dot.attr('aria-controls');
                $dot
                    .removeAttr('aria-controls')
                    .find('a')
                    .attr('aria-controls', ariaControls);
            });
    }

    function beforeChange(event, slick, currentSlide, nextSlide) {
        var $dotLinks = this.$dots.find('a');
        var $mobileDotLinks = this.$mobileDots.find('li');

        $dotLinks
            .removeAttr('aria-current')
            .eq(nextSlide)
            .attr('aria-current', 'true');

        $mobileDotLinks
            .removeClass(classes.slickActiveMobile)
            .eq(nextSlide)
            .addClass(classes.slickActiveMobile);
        this.showMobileText(nextSlide);
    }

    //   function keyboardNavigation() {
    //     if (event.keyCode === slate.utils.keyboardKeys.LEFTARROW) {
    //       this.$slideshow.slick('slickPrev');
    //     }
    //     if (event.keyCode === slate.utils.keyboardKeys.RIGHTARROW) {
    //       this.$slideshow.slick('slickNext');
    //     }
    //   }

    function highlightControls() {
        this.$controls.addClass(classes.controlsHover);
    }

    function unhighlightControls() {
        this.$controls.removeClass(classes.controlsHover);
    }

    slideshow.prototype.setSlideshowHeight = function() {
        var minAspectRatio = this.$slideshow.data('min-aspect-ratio');
        this.$slideshow.height($(document).width() / minAspectRatio);
    };

    slideshow.prototype.showMobileText = function(slideIndex) {
        var $allTextContent = this.$textWrapperMobile.find(
            selectors.textContentMobile
        );
        var currentTextContentSelector =
            selectors.textContentMobile + '-' + slideIndex;
        var $currentTextContent = this.$textWrapperMobile.find(
            currentTextContentSelector
        );
        if (!$currentTextContent.length &&
            this.$slideshow.find(selectors.slides).length === 1
        ) {
            this.$textWrapperMobile.hide();
        } else {
            this.$textWrapperMobile.show();
        }
        $allTextContent.hide();
        $currentTextContent.show();
    };

    function getSlideshowId($el) {
        return '#Slideshow-' + $el.data('id');
    }

    return slideshow;
})();

theme.slideshows = {};

theme.SlideshowSection = (function() {
    function SlideshowSection(container) {
        var $container = (this.$container = $(container));
        var sectionId = $container.attr('data-section-id');
        var slideshow = (this.slideshow = '#Slideshow-' + sectionId);

        theme.slideshows[slideshow] = new theme.Slideshow(slideshow, sectionId);
    }

    return SlideshowSection;
})();

theme.SlideshowSection.prototype = _.assignIn({},
    theme.SlideshowSection.prototype, {
        onUnload: function() {
            delete theme.slideshows[this.slideshow];
        },

        onBlockSelect: function(evt) {
            var $slideshow = $(this.slideshow);
            var adaptHeight = $slideshow.data('adapt-height');

            if (adaptHeight) {
                theme.slideshows[this.slideshow].setSlideshowHeight();
            }

            // Ignore the cloned version
            var $slide = $(
                '.slideshow__slide--' + evt.detail.blockId + ':not(.slick-cloned)'
            );
            var slideIndex = $slide.data('slick-index');

            // Go to selected slide, pause auto-rotate
            $slideshow.slick('slickGoTo', slideIndex).slick('slickPause');
        },

        onBlockDeselect: function() {
            // Resume auto-rotate
            $(this.slideshow).slick('slickPlay');
        }
    }
);

theme.slideshows = {};

theme.Cart = (function() {
    var selectors = {
        cartNote: '#CartSpecialInstructions',
        cartQtyInput: '.cart__quantity',
        cartNoCookiesClass: 'cart--no-cookies'
    };

    function Cart(container) {
        var $container = (this.$container = $(container));
        var sectionId = $container.attr('data-section-id');

        theme.cartObject = JSON.parse($('#CartJson-' + sectionId).html());

        this.init($container);
    }

    Cart.prototype = _.assignIn({}, Cart.prototype, {
        init: function($container) {
            this._initQtySelector();
            this._initCartNote();

            if (!this._cookiesEnabled()) {
                $container.addClass(selectors.cartNoCookiesClass);
            }
        },

        _initQtySelector: function() {
            $(selectors.cartQtyInput).each(function(i, el) {
                // eslint-disable-next-line no-new
                new QtySelector($(el));
            });
        },

        _initCartNote: function() {
            if (!$(selectors.cartNote).length) {
                return;
            }

            var $el = $(selectors.cartNote);
            var noteText;
            var params;
            var noteOffset = $el[0].offsetHeight - $el[0].clientHeight;

            // Auto grow the cart note if text fills it up
            $el.on('keyup input', function() {
                $(this)
                    .css('height', 'auto')
                    .css('height', $el[0].scrollHeight + noteOffset);
            });

            // Save the cart note via ajax. A safeguard in case
            // a user decides to leave the page before clicking 'Update Cart'
            $el.on(
                'change',
                $.proxy(function() {
                    noteText = $el.val();
                    params = {
                        type: 'POST',
                        url: '/cart/update.js',
                        data: 'note=' + this._attributeToString(noteText),
                        dataType: 'json'
                    };
                    $.ajax(params);
                }, this)
            );
        },

        _attributeToString: function(attr) {
            if (typeof attr !== 'string') {
                attr = String(attr);
                if (attr === 'undefined') {
                    attr = '';
                }
            }
            return $.trim(attr);
        },

        _cookiesEnabled: function() {
            var cookieEnabled = navigator.cookieEnabled;

            if (!cookieEnabled) {
                document.cookie = 'testcookie';
                cookieEnabled = document.cookie.indexOf('testcookie') !== -1;
            }
            return cookieEnabled;
        }
    });

    return Cart;
})();

// Instagrams
theme.Instagrams = (function() {
    function Instagrams(container) {
        this.$container = $(container).on('init', this._a11y.bind(this));
        //console.log(this.$container);
        this.settings = {
            style: this.$container.data('style'),
            accesstoken: this.$container.data('accesstoken'),
            userid: this.$container.data('userid'),
            limit: this.$container.data('limit'),
            resolution: this.$container.data('resolution'),
            target: this.$container.attr('id'),
            rows: this.$container.data('rows'),

            slidesToShow: this.$container.data('slidestoshow') || 1,
            infinite: this.$container.data('infinite') || false,
            arrows: this.$container.data('arrows') || false,
            draggable: this.$container.data('draggable') || false,
            dots: this.$container.data('dots') || false,
        }
        this.settings.slidesToShow1200 = (this.settings.slidesToShow - 1) > 1 ? (this.settings.slidesToShow - 1) : 1;
        this.settings.slidesToShow992 = (this.settings.slidesToShow - 2) > 1 ? (this.settings.slidesToShow - 2) : 1;
        this.settings.slidesToShow768 = (this.settings.slidesToShow - 3) > 1 ? (this.settings.slidesToShow - 3) : 1;
        this.settings.slidesToShow480 = 2;

        var _self = this;
        var $instagramSelector = $('#' + this.settings.target);
        if (this.settings.style === 'grid') {
            var afterInstagram = function() {} // blank function
        } else if (this.settings.style === 'carousel') {
            var afterInstagram = function() {
                $instagramSelector.slick({
                    slidesToShow: _self.settings.slidesToShow,
                    slidesToScroll: _self.settings.slidesToShow,
                    arrows: _self.settings.arrows,
                    dots: _self.settings.dots,
                    draggable: _self.settings.draggable,
                    infinite: _self.settings.infinite,
                    rows: _self.settings.rows,
                    responsive: [{
                            breakpoint: 1200,
                            settings: {
                                slidesToShow: _self.settings.slidesToShow1200,
                                slidesToScroll: _self.settings.slidesToShow1200,
                            }
                        },
                        {
                            breakpoint: 992,
                            settings: {
                                slidesToShow: _self.settings.slidesToShow992,
                                slidesToScroll: _self.settings.slidesToShow992,
                            }
                        },
                        {
                            breakpoint: 768,
                            settings: {
                                slidesToShow: _self.settings.slidesToShow768,
                                slidesToScroll: _self.settings.slidesToShow768,
                            }
                        },
                        {
                            breakpoint: 480,
                            settings: {
                                slidesToShow: _self.settings.slidesToShow480,
                                slidesToScroll: _self.settings.slidesToShow480,
                            }
                        }
                    ]
                })
            }
        }

        var feed = new Instafeed({
            get: 'user',
            target: this.settings.target,
            userId: this.settings.userid,
            accessToken: this.settings.accesstoken,
            limit: this.settings.limit,
            resolution: this.settings.resolution,
            template: '<div class="col hv-image-brightness"><a class="instagram-item" href="{{link}}" target="_blank" id="{{id}}"><img alt="instagram image" class="transition lazyload" data-src="{{image}}" /></a></div>',
            after: afterInstagram
        });

        feed.run();
    }

    Instagrams.prototype = _.assignIn({}, Instagrams.prototype, {
        _a11y: function(event, obj) {
            var $list = obj.$list;
            var $wrapper = this.$container.parent();

            // Remove default Slick aria-live attr until slider is focused
            $list.removeAttr('aria-live');

            // When an element in the slider is focused set aria-live
            $wrapper.on('focusin', function(evt) {
                if ($wrapper.has(evt.target).length) {
                    $list.attr('aria-live', 'polite');
                }
            });

            // Remove aria-live
            $wrapper.on('focusout', function(evt) {
                if ($wrapper.has(evt.target).length) {
                    $list.removeAttr('aria-live');
                }
            });
        }
    });

    return Instagrams;
})();

// Slick carousel
theme.slickCarousel = (function() {
    function Carousels(container) {
        this.$container = $(container).on('init', this._a11y.bind(this));
        this.settings = {
            rows: this.$container.data('rows') || 1,
            slidesToShow: this.$container.data('slidestoshow') || 1,
            slidesToScroll: this.$container.data('slidestoscroll') || 1,
            infinite: this.$container.data('infinite') || false,
            arrows: this.$container.data('arrows') || false,
            dots: this.$container.data('dots') || false,
            autoplay: this.$container.data('autoplay') || false,
            draggable: this.$container.data('draggable') || false,
            accessibility: this.$container.data('accessibility') || true,
        }
        this.settings.slidesToShow1200 = (this.settings.slidesToShow - 1) > 1 ? (this.settings.slidesToShow - 1) : 1;
        this.settings.slidesToShow992 = (this.settings.slidesToShow - 2) > 1 ? (this.settings.slidesToShow - 2) : 1;
        this.settings.slidesToShow768 = (this.settings.slidesToShow - 3) > 1 ? (this.settings.slidesToShow - 3) : 1;
        this.settings.slidesToShow480 = (this.settings.slidesToShow - 4) > 1 ? (this.settings.slidesToShow - 4) : 1;
        this.settings.slidesToScroll1200 = (this.settings.slidesToScroll - 1) > 1 ? (this.settings.slidesToScroll - 1) : 1;
        this.settings.slidesToScroll992 = (this.settings.slidesToScroll - 2) > 1 ? (this.settings.slidesToScroll - 2) : 1;
        this.settings.slidesToScroll768 = (this.settings.slidesToScroll - 3) > 1 ? (this.settings.slidesToScroll - 3) : 1;
        this.settings.slidesToScroll480 = (this.settings.slidesToScroll - 4) > 1 ? (this.settings.slidesToScroll - 4) : 1;
        this.$container.slick({
            rtl: theme.rtl,
            rows: this.settings.rows,
            slidesToShow: this.settings.slidesToShow,
            slidesToScroll: this.settings.slidesToScroll,
            arrows: this.settings.arrows,
            dots: this.settings.dots,
            autoplay: this.settings.autoplay,
            accessibility: this.settings.accessibility,
            draggable: this.settings.draggable,
            infinite: this.settings.infinite,
            adaptiveHeight: true,
            responsive: [{
                    breakpoint: 1200,
                    settings: {
                        slidesToShow: this.settings.slidesToShow1200,
                        slidesToScroll: this.settings.slidesToScroll1200
                    }
                },
                {
                    breakpoint: 992,
                    settings: {
                        slidesToShow: this.settings.slidesToShow992,
                        slidesToScroll: this.settings.slidesToScroll992
                    }
                },
                {
                    breakpoint: 768,
                    settings: {
                        slidesToShow: this.settings.slidesToShow768,
                        slidesToScroll: this.settings.slidesToScroll768
                    }
                },
                {
                    breakpoint: 480,
                    settings: {
                        slidesToShow: 1,
                        slidesToScroll: this.settings.slidesToScroll480
                    }
                }
            ]
        })
    }

    Carousels.prototype = _.assignIn({}, Carousels.prototype, {
        _a11y: function(event, obj) {
            var $list = obj.$list;
            var $wrapper = this.$container.parent();

            // Remove default Slick aria-live attr until slider is focused
            $list.removeAttr('aria-live');

            // When an element in the slider is focused set aria-live
            $wrapper.on('focusin', function(evt) {
                if ($wrapper.has(evt.target).length) {
                    $list.attr('aria-live', 'polite');
                }
            });

            // Remove aria-live
            $wrapper.on('focusout', function(evt) {
                if ($wrapper.has(evt.target).length) {
                    $list.removeAttr('aria-live');
                }
            });
        },

        _goToSlide: function(slideIndex) {
            this.$container.slick('slickGoTo', slideIndex);
        },

        onUnload: function() {
            delete this.$container;
        },

        onBlockSelect: function(evt) {
            // Ignore the cloned version
            var $slide = $(
                '.carousel__slide-wrapper--' + evt.detail.blockId + ':not(.slick-cloned)'
            );
            var slideIndex = $slide.data('slick-index');

            // Go to selected slide, pause autoplay
            this._goToSlide(slideIndex);

        }
    });

    return Carousels;
})()

// Productlists
theme.Productlists = (function() {
    function Productlists(container) {
        this.$container = $(container).on('init', this._a11y.bind(this));
        this.settings = {
            slidesToShow: this.$container.data('slidestoshow') || 1,
            rows: this.$container.data('rows') || 1,
            arrows: this.$container.data('arrows') || false,
            dots: this.$container.data('dots') || false,
            draggable: this.$container.data('draggable') || false,
            infinite: this.$container.data('infinite') || false,
        }
        this.settings.slidesToShow1200 = (this.settings.slidesToShow - 1) > 1 ? (this.settings.slidesToShow - 1) : 1;
        this.settings.slidesToShow992 = (this.settings.slidesToShow - 2) > 1 ? (this.settings.slidesToShow - 2) : 1;
        this.settings.slidesToShow768 = (this.settings.slidesToShow - 3) > 1 ? (this.settings.slidesToShow - 3) : 1;
        this.settings.slidesToShow480 = 2;
        this.$container.slick({
            rtl: theme.rtl,
            accessibility: true,
            slidesToShow: this.settings.slidesToShow,
            slidesToScroll: this.settings.slidesToShow,
            rows: this.settings.rows,
            arrows: this.settings.arrows,
            dots: this.settings.dots,
            infinite: this.settings.infinite,
            draggable: this.settings.draggable,
            responsive: [{
                    breakpoint: 1200,
                    settings: {
                        slidesToShow: this.settings.slidesToShow1200,
                        slidesToScroll: this.settings.slidesToShow1200
                    }
                },
                {
                    breakpoint: 992,
                    settings: {
                        slidesToShow: this.settings.slidesToShow992,
                        slidesToScroll: this.settings.slidesToShow992
                    }
                },
                {
                    breakpoint: 768,
                    settings: {
                        slidesToShow: this.settings.slidesToShow768,
                        slidesToScroll: this.settings.slidesToShow768
                    }
                },
                {
                    breakpoint: 480,
                    settings: {
                        slidesToShow: this.settings.slidesToShow480,
                        slidesToScroll: this.settings.slidesToShow480
                    }
                }
            ]
        }).css('opacity', '1');
    }

    Productlists.prototype = _.assignIn({}, Productlists.prototype, {
        _a11y: function(event, obj) {
            var $list = obj.$list;
            var $wrapper = this.$container.parent();

            // Remove default Slick aria-live attr until slider is focused
            $list.removeAttr('aria-live');

            // When an element in the slider is focused set aria-live
            $wrapper.on('focusin', function(evt) {
                if ($wrapper.has(evt.target).length) {
                    $list.attr('aria-live', 'polite');
                }
            });

            // Remove aria-live
            $wrapper.on('focusout', function(evt) {
                if ($wrapper.has(evt.target).length) {
                    $list.removeAttr('aria-live');
                }
            });
        },

        _goToSlide: function(slideIndex) {
            this.$container.slick('slickGoTo', slideIndex);
        },

        onUnload: function() {
            delete this.$container;
        }
    });

    return Productlists;
})();

// Producttabs
theme.Producttabs = (function() {
    function Producttabs(container) {
        var _self = this; // avoid conflict
        this.$container = $(container).on('init', this._a11y.bind(this));
        this.slickWrap = '.prdtab-content';
        this.settings = {
            slidesToShow: this.$container.data('slidestoshow') || 1,
            arrows: this.$container.data('arrows') || false,
            rows: this.$container.data('rows') || 1,
            dots: this.$container.data('dots') || false,
            draggable: this.$container.data('draggable') || false,
            infinite: this.$container.data('infinite') || false,
        }
        this.settings.slidesToShow1200 = (this.settings.slidesToShow - 1) > 1 ? (this.settings.slidesToShow - 1) : 1;
        this.settings.slidesToShow992 = (this.settings.slidesToShow - 2) > 1 ? (this.settings.slidesToShow - 2) : 1;
        this.settings.slidesToShow768 = (this.settings.slidesToShow - 3) > 1 ? (this.settings.slidesToShow - 3) : 1;
        this.settings.slidesToShow480 = 2;

        this._initSlick();
        this.$container.find('a[data-toggle="tab"]').on("shown.bs.tab", function(e) {
            _self._unSlick();
            _self._initSlick();
            theme.tooltip.load();
        })
    }

    Producttabs.prototype = _.assignIn({}, Producttabs.prototype, {
        _a11y: function(event, obj) {
            var $list = obj.$list;
            var $wrapper = this.$container.parent();

            // Remove default Slick aria-live attr until slider is focused
            $list.removeAttr('aria-live');

            // When an element in the slider is focused set aria-live
            $wrapper.on('focusin', function(evt) {
                if ($wrapper.has(evt.target).length) {
                    $list.attr('aria-live', 'polite');
                }
            });

            // Remove aria-live
            $wrapper.on('focusout', function(evt) {
                if ($wrapper.has(evt.target).length) {
                    $list.removeAttr('aria-live');
                }
            });
        },

        _getSliderSettings: function() {
            return {
                rtl: theme.rtl,
                accessibility: true,
                slidesToShow: this.settings.slidesToShow,
                slidesToScroll: this.settings.slidesToShow,
                arrows: this.settings.arrows,
                rows: this.settings.rows,
                dots: this.settings.dots,
                infinite: this.settings.infinite,
                draggable: this.settings.draggable,
                responsive: [{
                        breakpoint: 1200,
                        settings: {
                            slidesToShow: this.settings.slidesToShow1200,
                            slidesToScroll: this.settings.slidesToShow1200
                        }
                    },
                    {
                        breakpoint: 992,
                        settings: {
                            slidesToShow: this.settings.slidesToShow992,
                            slidesToScroll: this.settings.slidesToShow992
                        }
                    },
                    {
                        breakpoint: 768,
                        settings: {
                            slidesToShow: this.settings.slidesToShow768,
                            slidesToScroll: this.settings.slidesToShow768
                        }
                    },
                    {
                        breakpoint: 480,
                        settings: {
                            slidesToShow: this.settings.slidesToShow480,
                            slidesToScroll: this.settings.slidesToShow480
                        }
                    }
                ]
            }
        },

        _initSlick: function() {
            this.$container.find(this.slickWrap).slick(this._getSliderSettings()).css('opacity', '1');
        },

        _unSlick: function() {
            this.$container.find(this.slickWrap).slick('unslick');
        },

        onUnload: function() {
            delete this.$container;
        },

        onSelect: function() {
            this._unSlick();
            this._initSlick();
        },

        onBlockSelect: function(evt) {
            var navItem = $('.nav-link-' + evt.detail.blockId);
            navItem.tab('show');
            this._unSlick();
            this._initSlick();
        }
    });

    return Producttabs;
})();

theme.Video = (function() {
    var promiseYoutubeAPI;
    var promiseVimeoAPI;

    var youtube = {
        promiseAPI: function() {
            if (!promiseYoutubeAPI) {
                var tag = document.createElement('script');

                tag.src = 'https://www.youtube.com/iframe_api';
                var firstScriptTag = document.getElementsByTagName('script')[0];
                firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

                promiseYoutubeAPI = $.Deferred(function(defer) {
                    window.onYouTubeIframeAPIReady = defer.resolve;

                    setTimeout(function() {
                        defer.reject('Request for YouTube API timed out after 30 seconds.');
                    }, 30000);
                });
            }

            return promiseYoutubeAPI;
        },
        promisePlayer: function(id, options) {
            return this.promiseAPI().then(function() {
                return $.Deferred(function(defer) {
                    if (typeof window.YT === 'undefined') {
                        defer.reject(
                            "We're sorry, something went wrong. The YouTube API has not loaded correctly."
                        );
                    }

                    /* eslint-disable no-undef */
                    var player = new YT.Player(id, options); // global YT variable injected by YouTube API

                    player.addEventListener('onReady', function() {
                        defer.resolve(player);
                    });

                    setTimeout(function() {
                        defer.reject(
                            'Request for YouTube player has timed out after 30 seconds.'
                        );
                    }, 30000);
                });
            });
        }
    };

    var vimeo = {
        promiseAPI: function() {
            if (!promiseVimeoAPI) {
                promiseVimeoAPI = $.Deferred(function(defer) {
                    var tag = document.createElement('script');
                    tag.src = 'https://player.vimeo.com/api/player.js';
                    tag.onload = tag.onreadystatechange = function() {
                        if (!this.readyState || this.readyState === 'complete') {
                            defer.resolve();
                        }
                    };

                    var firstScriptTag = document.getElementsByTagName('script')[0];
                    firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

                    setTimeout(function() {
                        defer.reject('Request for Vimeo API timed out after 30 seconds.');
                    }, 30000);
                });
            }

            return promiseVimeoAPI;
        },

        promisePlayer: function(id, options) {
            return this.promiseAPI().then(function() {
                return $.Deferred(function(defer) {
                    if (typeof window.Vimeo === 'undefined') {
                        defer.reject(
                            "We're sorry, something went wrong. The Vimeo API has not loaded correctly."
                        );
                    }

                    var player = new window.Vimeo.Player(id, options);

                    setTimeout(function() {
                        defer.reject(
                            'Request for Vimeo player has timed out after 30 seconds.'
                        );
                    }, 30000);

                    player.ready().then(function() {
                        defer.resolve(player);
                    });
                });
            });
        }
    };

    var selectors = {
        loadPlayerButton: '.video-section__load-player-button',
        closePlayerButton: '.video-section__player-close',
        playerContainer: '.video-section__player',
        cover: '.video-section__cover',
        errorMessage: '.video-section__error',
        bodyOverlay: '.video-section__body-overlay',
        body: 'body'
    };
    var classes = {
        playerLoading: 'video-section--loading',
        playerLoaded: 'video-section--loaded',
        playerError: 'video-section--error',
        videoPlaying: 'video-playing'
    };

    function Video(container) {
        this.$container = $(container);
        var sectionId = this.$container.attr('data-section-id');
        this.namespace = '.' + sectionId;
        this.onLoad();
    }

    Video.prototype = _.assignIn({}, Video.prototype, {
        onLoad: function() {
            this.$container
                .on('click', selectors.loadPlayerButton, this._loadPlayer.bind(this))
                .on('click', selectors.closePlayerButton, this._closePlayer.bind(this))
                .on('click', selectors.bodyOverlay, this._closePlayer.bind(this));
        },

        _loadPlayer: function() {
            var $container = this.$container;
            var $playerContainer = $(selectors.playerContainer, $container);
            var playerType = this.$container.attr('data-video-type');

            var promiseVideoPlayer;

            if (playerType === 'youtube') {
                promiseVideoPlayer = this._loadYoutubePlayer($playerContainer[0]);
            } else if (playerType === 'vimeo') {
                promiseVideoPlayer = this._loadVimeoPlayer($playerContainer[0]);
            }

            return promiseVideoPlayer
                .then(this._onPlayerLoadReady.bind(this))
                .fail(this._onPlayerLoadError.bind(this));
        },

        _loadYoutubePlayer: function(container) {
            return youtube
                .promisePlayer(container, {
                    videoId: this.$container.attr('data-video-id'),
                    ratio: 16 / 9,
                    playerVars: {
                        modestbranding: 1,
                        autoplay: 1,
                        showinfo: 0,
                        rel: 0
                    }
                })
                .then(
                    function(player) {
                        this.player = player;
                    }.bind(this)
                );
        },

        _loadVimeoPlayer: function(container) {
            return vimeo
                .promisePlayer(container, {
                    id: this.$container.attr('data-video-id')
                })
                .then(
                    function(player) {
                        this.player = player;
                        this.player.play();
                    }.bind(this)
                );
        },

        _onPlayerLoadReady: function() {
            $(selectors.closePlayerButton, this.$container)
                .show()
                .focus();
            $(selectors.cover, this.$container).addClass(classes.playerLoaded);
            this.$container.addClass(classes.playerLoaded);

            this._setScrollPositionValues();

            $(selectors.body).addClass(classes.videoPlaying);

            $(document).on('keyup' + this.namespace, this._closeOnEscape.bind(this));
            $(window).on(
                'resize' + this.namespace,
                this._setScrollPositionValues.bind(this)
            );
            slate.a11y.trapFocus({
                $container: this.$container,
                namespace: this.namespace
            });
        },

        _onPlayerLoadError: function(err) {
            this.$container.addClass(classes.playerError);
            $(selectors.errorMessage, this.$container).text(err);
        },

        _closeOnEscape: function(evt) {
            if (evt.keyCode !== 27) {
                return;
            }

            this._closePlayer();
            $(selectors.loadPlayerButton, this.$container).focus();
        },

        _onScroll: function() {
            var scrollTop = $(window).scrollTop();

            if (
                scrollTop > this.videoTop + 0.25 * this.videoHeight ||
                scrollTop + this.windowHeight <
                this.videoBottom - 0.25 * this.videoHeight
            ) {
                // Debounce DOM edits to the next frame with requestAnimationFrame
                requestAnimationFrame(this._closePlayer.bind(this));
            }
        },

        _setScrollPositionValues: function() {
            this.videoHeight = this.$container.outerHeight(true);
            this.videoTop = this.$container.offset().top;
            this.videoBottom = this.videoTop + this.videoHeight;
            this.windowHeight = $(window).innerHeight();
        },

        _closePlayer: function() {
            $(selectors.body).removeClass(classes.videoPlaying);
            $(selectors.cover, this.$container).removeClass(classes.playerLoaded);
            this.$container.removeClass(classes.playerLoaded);
            $(selectors.closePlayerButton, this.$container).hide();

            slate.a11y.removeTrapFocus({
                $container: this.$container,
                namespace: this.namespace
            });

            if (typeof this.player.destroy === 'function') {
                this.player.destroy();
            } else if (typeof this.player.unload === 'function') {
                this.player.unload();
            }

            $(document).off(this.namespace);
            $(window).off(this.namespace);
        }
    });

    return Video;
})();

theme.CollectionsList = (function() {
    function CollectionsList(container) {
        var $container = (this.$container = $(container));
        var stretchImage = $container.is('[data-stretch-image]');

        // Early return if 'secondary image layout' is enabled
        if (stretchImage) return;

        var namespace = (this.namespace = '.' + $container.attr('data-section-id'));
        var self = this;

        self._collectionListFix();
        $(window).on(
            'resize' + namespace,
            $.debounce(250, function() {
                self._collectionListFix();
            })
        );
    }

    CollectionsList.prototype = _.assignIn({}, CollectionsList.prototype, {
        onUnload: function() {
            $(window).off(this.namespace);
        },

        _collectionListFix: function() {
            var numberRows = this.$container.find('.grid').data('number-rows');
            var $featureCards = this.$container.find('.featured-card');

            // We can exit if 'Use secondary image layout' is enabled
            if ($featureCards.is('[data-stretch-image]')) return;

            // Go through each of the rows
            for (var i = 0; i < numberRows; i++) {
                var maxWrapperHeight = 0;
                var maxHeaderHeight = 0;
                var $currentRow = $featureCards.filter(
                    "[data-row-number='" + (i + 1) + "']"
                );
                var $cardHeaders = $currentRow.find('.featured-card__header');

                // Find the max heights for each row
                $currentRow.each(function() {
                    var $cardTitle = $(this).find('.featured-card__title');
                    var $cardAction = $(this).find('.featured-card__action');
                    var $cardImageWrapper = $(this).find('.featured-card__image-wrapper');
                    var headerHeight =
                        $cardTitle.outerHeight() + $cardAction.outerHeight() + 65;
                    var wrapperHeight = $cardImageWrapper.outerHeight();
                    if (headerHeight > maxHeaderHeight) {
                        maxHeaderHeight = headerHeight;
                    }
                    if (wrapperHeight > maxWrapperHeight) {
                        maxWrapperHeight = wrapperHeight;
                    }
                });

                // Set the heights of the headers and cards for this row with padding
                $cardHeaders.outerHeight(maxHeaderHeight);
                $currentRow.height(maxWrapperHeight + maxHeaderHeight + 40);
            }
        }
    });

    return CollectionsList;
})();

theme.ParrallaxImage = (function() {
    function ParrallaxImage(container) {
        this.container = container;
        this.sectionId = $(container).attr('data-section-id');
        this.namespace = 'parallax-' + this.sectionId;
        var images = document.getElementsByClassName('thumbnail' + this.sectionId);
        new simpleParallax(images, {
            scale: 1.5,
            delay: .6,
        });
    }

    ParrallaxImage.prototype = $.extend({}, ParrallaxImage.prototype, {
        onUnload: function(evt) {
            var instance = new simpleParallax(images);
            instance.destroy();
            delete theme.ParrallaxImage[this.namespace];
        }
    });

    return ParrallaxImage;
})();

theme.init = function() {
    theme.customerTemplates.init();
    slate.rte.wrapTable();
    slate.rte.iframeReset();

    // Common a11y fixes
    slate.a11y.pageLinkFocus($(window.location.hash));

    $('.in-page-link').on('click', function(evt) {
        slate.a11y.pageLinkFocus($(evt.currentTarget.hash));
    });

    $('a[href="#"]').on('click', function(evt) {
        evt.preventDefault();
    });


    //scroll animation
    AOS.init({
        startEvent: 'DOMContentLoaded',
        offset: 30, // offset (in px) from the original trigger point
        delay: 0, // values from 0 to 3000, with step 50ms
        duration: 1000,
        once: true
    });
    window.addEventListener('load', function() {
        AOS.refresh();
    });


    // Sections
    var sections = new theme.Sections();
    sections.register('header', theme.HeaderSection);
    sections.register('product', theme.Product);
    sections.register('slideshow-section', theme.SlideshowSection);
    sections.register('cart', theme.Cart);
    sections.register('instagrams', theme.Instagrams);
    sections.register('masonries', theme.Masonry);
    sections.register('productlist', theme.Productlists);
    sections.register('producttab', theme.Producttabs);
    sections.register('slickCarousels', theme.slickCarousel);
    sections.register('video', theme.Video);
    sections.register('collections-list', theme.CollectionsList);
    sections.register('parallax-image', theme.ParrallaxImage);
    sections.register('bgcollection', theme.Bgcollection);

    // Standalone modules
    $(window).on('load', theme.articleImages);
    theme.passwordModalInit();
};

theme.articleImages = function() {
    var $indentedRteImages = $('.rte--indented-images');
    if (!$indentedRteImages.length) {
        return;
    }

    $indentedRteImages.find('img').each(function(i, el) {
        var $el = $(el);
        var attr = $el.attr('style');

        // Check if undefined or float: none
        if (!attr || attr === 'float: none;') {
            // Add class to parent paragraph tag if image is wider than container
            if ($el.width() >= $indentedRteImages.width()) {
                $el.parent('p').addClass('rte__image-indent');
            }
        }
    });
};

theme.passwordModalInit = function() {
    var $loginModal = $('#LoginModal');
    if (!$loginModal.length) {
        return;
    }

    // Initialize modal
    theme.PasswordModal = new window.Modals('LoginModal', 'login-modal', {
        focusOnOpen: '#Password'
    });

    // Open modal if errors exist
    if ($loginModal.find('.errors').length) {
        theme.PasswordModal.open();
    }
};

// CSS var ponyfill
theme.cssVar = (function() {
    cssVars();
})()

// Ajax search https://gist.github.com/awojtczyk/53d74c8af5f893841f33979b0cdcd6fe
theme.ajaxSearch = (function() {
    var $inputSearch = '.js-ajaxsearch',
        $resultsList = '.search-results',
        $input = $($inputSearch).find('input[name="q"]'),
        $currentAjaxRequest,
        $displayProducts = 6;

    $($inputSearch).css('position', 'relative').each(function() {
        $input.attr('autocomplete', 'off').bind('keyup change', function() {
            var term = $(this).val(),
                form = $(this).closest('form'),
                searchURL = '/search?type=product&q=*' + term + '*';
            if (term.length > 2 && term !== $(this).attr('data-old-term')) {
                $(this).attr('data-old-term', term);
                if ($currentAjaxRequest !== undefined) $currentAjaxRequest.abort();
                $currentAjaxRequest = $.getJSON(searchURL + '&view=json', function(data) {
                    $($resultsList).empty();

                    if (data.results_count === 0) {
                        $($resultsList).html('<p class="text-center">' + theme.strings.ajaxSearchNoResult + '</p>')
                    } else {
                        $.each(data.results, function(index, item) {
                            if (index < $displayProducts) {
                                var itemPrice = theme.Currency.formatMoney(item.price, theme.moneyFormat);
                                var link = $('<a class="d-inline-flex ' + index + '"></a>')
                                    .attr('href', item.url)
                                    .append('<span class="image"><img src="' + item.thumbnail + '" /></span>')
                                    .append('<div class="meta"><p class="title">' + item.title + '</p>' + itemPrice + '</div>')
                                    .wrap('<div class="ajax-search-item"></div>');
                                $($resultsList).append(link.parent());
                                theme.updateCurrencies();
                            }
                        });
                        if (data.results_count > $displayProducts) {
                            $($resultsList).append('<a class="btn btn--full" href="' + searchURL + '">' + theme.strings.ajaxSearchViewAll + ' (' + data.results_count + ')</a>');
                        }
                    }
                    $($resultsList).addClass('active').fadeIn(200);
                });
            }
        });
    });

    //escape when click somethings
    $(document).click(function(event) {
        var target = event.target;
        if (!$(target).is($inputSearch) && !$(target).parents().is($inputSearch)) {
            $($resultsList).slideUp(300);
        }
    });
})();

// Quickview https://github.com/kellyvaughn/quickview-for-shopify/blob/master/quickview.js.liquid
theme.quickview = (function() {
    var product_handle = '',
        quickviewButtonClass = '.js-btn-quickview',
        quickviewId = '#jsQuickview',
        quickviewOption = '#jsQuickview select',
        quickviewThumb = '#qv-product-images',
        quickviewAddCartButton = '.qv-add-button',
        quickviewPrice = '.qv-product-price',
        quickviewComparePrice = '.qv-product-compare-price';

    // 1. Show quickview
    $(document).on('click', quickviewButtonClass, function() {
        var quickviewAvaible = $(this).attr("data-pavailable");
        product_handle = $(this).data('handle');
        //ResetQuickview
        $(quickviewId).removeClass().addClass('modal fade');
        $(quickviewThumb).removeClass().empty();
        $('.qv-product-options').empty();

        //Pushdata
        $(quickviewId).addClass(product_handle).data('handle', product_handle);
        jQuery.getJSON('/products/' + product_handle + '.js', function(product) {
            var title = product.title;
            var type = product.type;
            var vendor = product.vendor;
            var price = 0;
            var compare_price = 0;
            var desc = product.description.slice(0, 90);
            var images = product.images;
            var variants = product.variants;
            var options = product.options;
            var url = '/products/' + product_handle;
            $('.qv-product-title').text(title);
            $('.qv-product-type').text(type);
            $('.qv-product-description').html(desc);
            $('.qv-view-product').attr('href', url);
            $('.qv-view-type').text(type);
            $('.qv-view-vendor').text(vendor)
            if (quickviewAvaible == 'true') {
                $(quickviewAddCartButton).prop('disabled', false).html(theme.strings.addToCart);
            } else {
                $(quickviewAddCartButton).prop('disabled', true).html(theme.strings.soldOut);
            }
            $(product.variants).each(function(i, variants) {
                if (variants.sku != null) {
                    $('.qv-sku').addClass("show").removeClass("hide");
                    $('.qv-view-sku').text(product.variants[0].sku);
                } else {
                    $('.qv-sku').addClass("hide").removeClass("show");
                }

            });
            var imageCount = $(images).length;
            $(images).each(function(i, image) {
                image_embed = '<div><img src="' + image + '"></div>';
                image_embed = image_embed.replace('.jpg', '_800x.jpg').replace('.png', '_800x.png');
                $(quickviewThumb).append(image_embed);
            });
            $(quickviewThumb).slick({
                rtl: theme.rtl,
                'dots': true,
                'arrows': true,
                'respondTo': 'min',
                'useTransform': true
            }).css('opacity', '1');

            if (product.variants[0].option1 !== "Default Title") {
                $(options).each(function(i, option) {
                    var name = option.name;
                    var opt = name.replace(/ /g, '-').toLowerCase();
                    var selectClass = '.option.' + opt;
                    $('.qv-product-options').append('<div class="option-selection ' + opt + '"><span class="option text-uppercase font-weight-bold text-body">' + option.name + '</span><select class="option-' + i + ' option ' + opt + '"></select></div>');
                    $(option.values).each(function(i, value) {
                        $('.option.' + opt).append($('<option>', {
                            value: value,
                            text: value
                        }));
                    });
                });
            }
            $(product.variants).each(function(i, v) {
                if (v.inventory_quantity == 0) {
                    return true
                } else {
                    price = theme.Currency.formatMoney(v.price, theme.moneyFormat);
                    compare_price = theme.Currency.formatMoney(v.compare_at_price, theme.moneyFormat);
                    $(quickviewPrice).html(price);
                    if (v.compare_at_price !== null) {
                        $(quickviewComparePrice).html(compare_price).show();
                    } else {
                        $(quickviewComparePrice).hide();
                    }
                    theme.updateCurrencies();
                    $('select.option-0').val(v.option1);
                    $('select.option-1').val(v.option2);
                    $('select.option-2').val(v.option3);
                    return false
                }
            });
        });
        //addCartQuickview
    });
    // 2. Add to cart
    $(document).on('click', quickviewAddCartButton, function() {
        product_handle = $(quickviewId).data('handle');
        var qty = $('.qv-quantity').val(),
            selectedOptions = '',
            var_id = '';

        function processCart() {
            jQuery.post('/cart/add.js', {
                    quantity: qty,
                    id: var_id
                }, null, "json").done(function(item) {
                    var htmlVariant = item.variant_title !== null ? '<i>(' + item.variant_title + ')</i>' : '';
                    var styleCart = $('.js-mini-cart').attr("data-cartmini");
                    if (styleCart != 'true') {
                        var htmlAlert = '<div class="media mt-2 alert--cart"><a class="mr-3" href="/cart"><img class="lazyload" data-src="' + item.image + '"></a><div class="media-body align-self-center"><p class="m-0 font-weight-bold">' + item.product_title + ' x ' + item.quantity + '</p>' + htmlVariant + '<div><div>';
                        theme.alert.new(theme.strings.addToCartSuccess, htmlAlert, 3000, 'notice');
                    }
                    theme.miniCart.updateElements();
                    theme.miniCart.generateCart();
                })
                .fail(function($xhr) {
                    var data = $xhr.responseJSON;
                    theme.alert.new('', data.description, 3000, 'warning');
                });
        }
        $(quickviewOption).each(function(i) {
            if (selectedOptions == '') {
                selectedOptions = $(this).val();
            } else {
                selectedOptions = selectedOptions + ' / ' + $(this).val();
            }
        });
        jQuery.getJSON('/products/' + product_handle + '.js', function(product) {
            if (product.variants.length === 1) {
                var_id = product.variants[0].id;
            } else {
                $(product.variants).each(function(i, v) {
                    if (v.title == selectedOptions) {
                        var_id = v.id;
                    }
                });
            }
            processCart();
        });
    });
    // 3. Select variants
    $(document).on('change', quickviewOption, function() {
        var selectedOptions = '';
        $(quickviewOption).each(function(i) {
            if (selectedOptions == '') {
                selectedOptions = $(this).val();
            } else {
                selectedOptions = selectedOptions + ' / ' + $(this).val();
            }
        });
        jQuery.getJSON('/products/' + product_handle + '.js', function(product) {
            $(product.variants).each(function(i, v) {
                if (v.title == selectedOptions) {
                    if (v.featured_image !== null) {
                        var iSlick = v.featured_image.position - 1;
                        $(quickviewThumb).slick('slickGoTo', iSlick);
                    }
                    var price = theme.Currency.formatMoney(v.price, theme.moneyFormat);
                    var compare_price = theme.Currency.formatMoney(v.compare_at_price, theme.moneyFormat);
                    $(quickviewPrice).html(price);
                    $(quickviewComparePrice).html(compare_price);
                    if (v.sku != null) {
                        $('.qv-sku').addClass("show").removeClass("hide");
                        $('.qv-view-sku').text(v.sku);
                    } else {
                        $('.qv-sku').addClass("hide").removeClass("show");
                    }
                    if (v.compare_at_price !== null) {
                        $(quickviewComparePrice).html(compare_price).show();
                    } else {
                        $(quickviewComparePrice).hide();
                    }
                    theme.updateCurrencies();
                    if (v.inventory_management === null) {
                        $(quickviewAddCartButton).prop('disabled', false).val(theme.strings.addToCart);
                    } else {
                        if (v.inventory_quantity < 1) {
                            $(quickviewAddCartButton).prop('disabled', true).val(theme.strings.soldOut);
                        } else {
                            $(quickviewAddCartButton).prop('disabled', false).val(theme.strings.addToCart);
                        }
                    }
                }
            });
        });
    });
})()

//Button add to cart (in grid item)
theme.addCartButton = (function() {
    var buttonClass = '.js-grid-cart';
    $(document).on('click', buttonClass, function() {
        var $this = $(this);
        var id = $this.data('id');
        $this.addClass('is-loading');
        Shopify.addItem(id, 1, function(item) {
            location.href = "/cart";
            var htmlVariant = item.variant_title !== null ? '<i>(' + item.variant_title + ')</i>' : '';
            var styleCart = $('.js-mini-cart').attr("data-cartmini");
            if (styleCart != 'true') {
                var htmlAlert = '<div class="media mt-2 alert--cart"><a class="mr-3" href="/cart"><img class="lazyload" data-src="' + item.image + '"></a><div class="media-body align-self-center"><p class="m-0 font-weight-bold">' + item.product_title + ' x ' + item.quantity + '</p>' + htmlVariant + '<div><div>';
            }
            theme.miniCart.updateElements();
            theme.miniCart.generateCart();
            setTimeout(function() {
                styleCart != 'true' ? theme.alert.new(theme.strings.addToCartSuccess, htmlAlert, 3000, 'notice') : '';
                $this.removeClass('is-loading');
            }, 1000);
        });
    })
})()

// Button add to cart (in grid item)
//theme.addCartButton = (function(){
//  var buttonClass = '.js-grid-cart';
//  $(document).on('click',buttonClass,function(){
//    var $this = $(this);
//    var id = $this.data('id');
//    $this.addClass('is-loading');
//    Shopify.addItem(id,1,function(item){
//      var htmlVariant = item.variant_title !== null ? '<i>('+item.variant_title+')</i>' : '';
//      var styleCart = $('.js-mini-cart').attr("data-cartmini");
//        if(styleCart != 'true'){
//          var htmlAlert = '<div class="media mt-2 alert--cart"><a class="mr-3" href="/cart"><img class="lazyload" data-src="'+item.image+'"></a><div class="media-body align-self-center"><p class="m-0 font-weight-bold">'+item.product_title+' x '+ item.quantity +'</p>'+htmlVariant+'<div><div>';
//        }
//      theme.miniCart.updateElements();
//      theme.miniCart.generateCart();
//      setTimeout(function() {
//        styleCart != 'true' ? theme.alert.new(theme.strings.addToCartSuccess,htmlAlert,3000,'notice'): '';
//        $this.removeClass('is-loading');
//      }, 1000);
//    });
// })
//})()

// Multi currencies 
if (theme.enableCurrencies) {
    // Can be 'money_format' or 'money_with_currency_format'
    Currency.format = 'money_format';
    var shopCurrency = Shopify.currency.active;
    var cookieCurrency = Currency.cookie.read();
    // Fix for customer account pages 
    jQuery('span.money span.money').each(function() {
        jQuery(this).parent('span.money').removeClass('money');
    });
    // Add precalculated shop currency to data attribute 
    jQuery('span.money').each(function() {
        jQuery(this).attr('data-currency-' + Shopify.currency.active, jQuery(this).html());
    });
    // Select all your currencies buttons.
    var buttons = jQuery('#currencies a'),
        currentCurrencies = jQuery('.pre-currencies');
    // When the page loads.
    if (cookieCurrency == null || cookieCurrency == shopCurrency) {
        Currency.currentCurrency = shopCurrency;
    } else {
        Currency.currentCurrency = cookieCurrency;
        Currency.convertAll(shopCurrency, cookieCurrency);
        buttons.removeClass('selected');
        jQuery('#currencies a[data-currency=' + cookieCurrency + ']').addClass('selected');
        var htmlCurrently = jQuery('#currencies a[data-currency=' + cookieCurrency + ']').html();
        currentCurrencies.html(htmlCurrently);
    }
    buttons.click(function() {
        buttons.removeClass('selected');
        jQuery(this).addClass('selected');
        var newCurrency = jQuery(this).attr('data-currency');
        var htmlCurrently = jQuery(this).html();
        currentCurrencies.html(htmlCurrently);
        Currency.convertAll(Currency.currentCurrency, newCurrency);
    });
    // For product options.
    var original_selectCallback = window.selectCallback;
    var selectCallback = function(variant, selector) {
        original_selectCallback(variant, selector);
        Currency.convertAll(shopCurrency, jQuery('#currencies a.selected').attr('data-currency'));
    };
}
theme.updateCurrencies = function() {
    Currency.convertAll(shopCurrency, jQuery('#currencies a.selected').attr('data-currency'));
}



// Free shipping
theme.freeShipping = (function() {
    var $freeShippingClass = $('.js-free-shipping'),
        $freeShippingTextClass = $('.js-free-shipping-text'),
        $free_fisrt = $freeShippingClass.attr('data-start'),
        $free_end = $freeShippingClass.attr('data-end')
    minOrderValue = parseInt($freeShippingClass.data('value')) || 0,
        $percentClass = $('.js-free-shipping .progress-bar');

    function generate(cart) {
        var priceCart = cart.total_price;
        if (priceCart >= minOrderValue) {
            $percentClass.css('width', '100%').removeClass('progress-bar-striped bg-primary');
            $freeShippingTextClass.text(theme.strings.freeShipping)
        } else {
            let percent = priceCart / minOrderValue * 100;
            let left = Shopify.formatMoney((minOrderValue - priceCart), theme.moneyFormat);
            $percentClass.css('width', percent + '%').addClass('progress-bar-striped primary');
            $freeShippingTextClass.html($free_fisrt + ' ' + left + ' ' + $free_end);
            theme.updateCurrencies();
        }
    }

    Shopify.getCart(function(cart) {
        generate(cart);
    });

    return {
        load: generate
    }
})()

// Shipping time - https://github.com/phstc/jquery-dateFormat
theme.shippingTime = (function() {
    var $shippingTime = $('.js-shipping-time'),
        shippingTime = $shippingTime.data('time') || '',
        now = new Date(),
        restHour = 23 - now.getHours(),
        restMinute = 59 - now.getMinutes();
    if (shippingTime !== '') {
        var nextTime = new Date(now.getTime() + shippingTime * 86400000),
            formatTime = $.format.date(nextTime, "ddd, dd MMMM yyyy"),
            htmlShipping = 'Order in the next <b>' + restHour + '</b> hours <b>' + restMinute + '</b> minutes to get it by <b>' + formatTime + '</b>. ';
        $shippingTime.html(htmlShipping);
    }
})()

// Infinite scroll - https://github.com/Elkfox/Ajaxinate/blob/master/dist/ajaxinate.min.js
theme.infiniteScroll = (function() {
    function initInfiniteScroll() {
        if ($('.AjaxinateLoop').length === 0) {
            return;
        } else {
            var endlessScroll = new Ajaxinate({
                loadingText: '<div class="text-center"><div class="' + theme.loadingClass + '" role="status"></div></div>',
                callback: function() {
                    theme.wishlist.load();
                    theme.compare.load();
                    theme.countdown.load();
                    theme.priceRange.load();
                    theme.tooltip.load();
                    theme.collectionView.triggerView();
                    theme.swatchCard2.load();
                }
            });
        }
    }

    // Infinite scroll in other page (blog, list-collection)
    function initOtherPages() {
        var otherPages = new Ajaxinate({
            loadingText: '<div class="text-center"><div class="' + theme.loadingClass + '" role="status"></div></div>',
            container: '.js-pagination-content',
            pagination: '.js-pagination'
        });
    }

    document.addEventListener("DOMContentLoaded", function() {
        initInfiniteScroll();
        initOtherPages();
    });

    return {
        load: initInfiniteScroll
    }
})()

// Scroll to fixed
theme.scrollToFixed = (function() {
    var window_width = $(window).width();

    if (window_width < 768) {
        $(".js-stick-parent").trigger("sticky_kit:detach");
    } else {
        make_sticky();
    }
    $(window).resize(function() {

        window_width = $(window).width();

        if (window_width < 768) {
            $(".js-stick-parent").trigger("sticky_kit:detach");
        } else {
            make_sticky();
        }
    });

    function make_sticky() {
        $('.js-stick-parent').stick_in_parent();
    }

})()


theme.headersidebar = (function() {
    $('#dismiss, .overlaysidebar').on('click', function() {
        // hide sidebar
        $('#sidebar').removeClass('active');
        // hide overlay
        $('.overlaysidebar').removeClass('active');
    });

    $('#sidebarCollapse').on('click', function() {
        // open sidebar
        $('#sidebar').addClass('active');
        // fade in the overlay
        $('.overlaysidebar').addClass('active');
        $('.collapse.in').toggleClass('in');
        $('a[aria-expanded=true]').attr('aria-expanded', 'false');
    });
})()

// Wishlist
theme.wishlist = (function() {
    var wishlistButtonClass = '.js-btn-wishlist',
        wishlistRemoveButtonClass = '.js-remove-wishlist',
        $wishlistCount = $('.js-wishlist-count'),
        $wishlistContainer = $('.js-wishlist-content'),
        wishlistObject = JSON.parse(localStorage.getItem('localWishlist')) || [],
        wishlistPageUrl = $('.js-wishlist-link').attr('href'),
        loadNoResult = function() {
            // $wishlistContainer.html('<div class="col text-center"><div class="alert alert-warning d-inline-block">' + theme.strings.wishlistNoResult + '</div></div>');
        };

    function updateWishlist(self) {
        var productHandle = $(self).data('handle'),
            allSimilarProduct = $(wishlistButtonClass + '[data-handle="' + productHandle + '"]');
        var isAdded = $.inArray(productHandle, wishlistObject) !== -1 ? true : false;
        if (isAdded) {
            // go to wishlist page
            window.location.href = wishlistPageUrl;
        } else {
            wishlistObject.push(productHandle);
            allSimilarProduct.fadeOut('slow').fadeIn('fast').html(theme.strings.wishlistIconAdded + theme.strings.wishlistTextAdded);
            //change tooltip
            allSimilarProduct.attr('data-original-title', theme.strings.wishlistTextAdded);
            $('.tooltip-inner').text(theme.strings.wishlistTextAdded);
        }
        localStorage.setItem('localWishlist', JSON.stringify(wishlistObject));
        $wishlistCount.text(wishlistObject.length);
    };

    function loadWishlist() {
        $wishlistContainer.html('');
        //page wishlist
        if (wishlistObject.length > 0) {
            for (var i = 0; i < wishlistObject.length; i++) {
                var productHandle = wishlistObject[i];
                Shopify.getProduct(productHandle, function(product) {
                    var htmlProduct = '';
                    var productPrice = product.price_varies ? 'from ' + theme.Currency.formatMoney(product.price_min, theme.moneyFormat) : theme.Currency.formatMoney(product.price, theme.moneyFormat);
                    var productComparePrice = product.compare_at_price_min !== 0 ? theme.Currency.formatMoney(product.compare_at_price_min, theme.moneyFormat) : '';
                    htmlProduct += '<div class="js-wishlist-item col-md-4 col-sm-6 col-xs-6 col-12 mb-4">';
                    htmlProduct += '<div class="js-wishlist-itembox">';
                    htmlProduct += '<div class=" d-flex flex-row p-4">';
                    htmlProduct += '	<a class="d-inline-block mr-4 " href="' + product.url + '">';
                    htmlProduct += '		<img src="' + product.featured_image + '"/>';
                    htmlProduct += '	</a>';
                    htmlProduct += '	<div><a href="' + product.url + '" class="title-prouct d-block h4 text-body" >' + product.title + '</a>';
                    htmlProduct += '	<span> ' + productPrice + '</span>';
                    htmlProduct += '	 <s>' + productComparePrice + '</s></div>';
                    htmlProduct += '<button class="btn js-remove-wishlist" data-handle="' + product.handle + '">' + theme.strings.wishlistRemove + '</button>';
                    htmlProduct += '</div>';
                    htmlProduct += '</div>';
                    htmlProduct += '</div>';
                    $wishlistContainer.append(htmlProduct);
                    theme.updateCurrencies();
                });
            }
        } else {
            loadNoResult();
        }

        //count items
        $wishlistCount.text(wishlistObject.length);

        //button text
        $(wishlistButtonClass).each(function() {
            var productHandle = $(this).data('handle');
            var iconWishlist = $.inArray(productHandle, wishlistObject) !== -1 ? theme.strings.wishlistIconAdded : theme.strings.wishlistIcon;
            var textWishlist = $.inArray(productHandle, wishlistObject) !== -1 ? theme.strings.wishlistTextAdded : theme.strings.wishlistText;
            $(this).html(iconWishlist + textWishlist).attr('title', textWishlist);
        });
    }

    $(document).on('click', wishlistButtonClass, function(event) {
        event.preventDefault();
        updateWishlist(this);
    });
    $(document).on('click', wishlistRemoveButtonClass, function() {
        var productHandle = $(this).data('handle'),
            allSimilarProduct = $(wishlistButtonClass + '[data-handle="' + productHandle + '"]');

        //update button
        allSimilarProduct.html(theme.strings.wishlistIcon + theme.strings.wishlistText);
        //update tooltip
        allSimilarProduct.attr('data-original-title', theme.strings.wishlistText);
        $('.tooltip-inner').text(theme.strings.wishlistText);
        //update Object
        wishlistObject.splice(wishlistObject.indexOf(productHandle), 1);
        localStorage.setItem('localWishlist', JSON.stringify(wishlistObject));
        // Remove element
        $(this).closest('.js-wishlist-item').fadeOut(); // or .remove()
        //count
        $wishlistCount.text(wishlistObject.length);
        if (wishlistObject.length === 0) {
            loadNoResult();
        }
    });

    loadWishlist();
    $(document).on('shopify:section:load', loadWishlist);
    return {
        load: loadWishlist
    }
})()

// Compare
theme.compare = (function() {
    var compareButtonClass = '.js-btn-compare',
        compareRemoveButtonClass = '.js-remove-compare',
        $compareCount = $('.js-compare-count'),
        $compareContainer = $('.js-compare-content'),
        compareObject = JSON.parse(localStorage.getItem('localCompare')) || [],
        alertClass = 'notice';

    function updateCompare(self) {
        var productHandle = $(self).data('handle'),
            alertText = '';
        var isAdded = $.inArray(productHandle, compareObject) !== -1 ? true : false;
        if (isAdded) {
            compareObject.splice(compareObject.indexOf(productHandle), 1);
            alertText = theme.strings.compareNotifyRemoved;
            alertClass = 'notice';
        } else {
            if (compareObject.length === 4) {
                alertText = theme.strings.compareNotifyMaximum;
                alertClass = 'error';
            } else {
                alertClass = 'notice';
                compareObject.push(productHandle);
                alertText = theme.strings.compareNotifyAdded;
            }
        }
        localStorage.setItem('localCompare', JSON.stringify(compareObject));
        theme.alert.new(theme.strings.compareText, alertText, 2000, alertClass);
        $compareCount.text(compareObject.length);
    };

    function loadCompare() {
        var compareGrid;
        $compareContainer.html('');
        //popup compare
        if (compareObject.length > 0) {
            compareGrid = compareObject.length === 1 ? 'col-md-6 col-sm-6' : 'col';
            for (var i = 0; i < compareObject.length; i++) {
                var productHandle = compareObject[i];
                Shopify.getProduct(productHandle, function(product) {
                    var htmlProduct = '',
                        productPrice = product.price_varies ? 'from ' + theme.Currency.formatMoney(product.price_min, theme.moneyFormat) : theme.Currency.formatMoney(product.price, theme.moneyFormat),
                        productComparePrice = product.compare_at_price_min !== 0 ? theme.Currency.formatMoney(product.compare_at_price_min, theme.moneyFormat) : '',
                        productAvailable = product.available ? theme.strings.available : theme.strings.unavailable,
                        productAvailableClass = product.available ? 'alert-success' : 'alert-danger',
                        productTypeHTML = product.type !== "" ? '<a href="/collections/types?q=' + product.type + '">' + product.type + '</a>' : '<span>' + theme.strings.none + '</span>',
                        productVendorHTML = product.vendor !== "" ? '<a href="/collections/vendors?q=' + product.vendor + '">' + product.vendor + '</a>' : '<span>' + theme.strings.none + '</span>';
                    htmlProduct += '<div class="compare-item ' + compareGrid + ' col-xs-6">';
                    htmlProduct += '	<a href="' + product.url + '">';
                    htmlProduct += '		<img src="' + Shopify.resizeImage(product.featured_image, 'x300') + '"/>';
                    htmlProduct += '	</a>';
                    htmlProduct += '	<hr /><h5 >' + product.title + '</h5>';
                    htmlProduct += '	<hr /><s>' + productComparePrice + '</s>';
                    htmlProduct += '	<span> ' + productPrice + '</span>';
                    htmlProduct += '	<hr /><span class=' + productAvailableClass + '> ' + productAvailable + '</span>';
                    htmlProduct += '	<hr />' + productTypeHTML;
                    htmlProduct += '	<hr />' + productVendorHTML;
                    htmlProduct += '  <hr /><button class="btn js-remove-compare btn-theme gradient-theme" data-handle="' + product.handle + '">' + theme.strings.compareRemove + '</button>';
                    htmlProduct += '</div>';
                    $compareContainer.append(htmlProduct);
                    theme.updateCurrencies();
                });
            }
        } else {
            $compareContainer.html('<div class="alert alert-warning d-inline-block">' + theme.strings.compareNoResult + '</div>');
        }

        //button text
        $(compareButtonClass).each(function() {
            var productHandle = $(this).data('handle');
            var status = $.inArray(productHandle, compareObject) !== -1 ? 'added' : '';
            $(this).removeClass('added').addClass(status);
        });

        //count items
        $compareCount.text(compareObject.length);
    }
    $(document).on('click', compareButtonClass, function(event) {
        event.preventDefault();
        updateCompare(this);
        loadCompare();
    });
    $(document).on('click', compareRemoveButtonClass, function() {
        var productHandle = $(this).data('handle');
        compareObject.splice(compareObject.indexOf(productHandle), 1);
        localStorage.setItem('localCompare', JSON.stringify(compareObject));
        loadCompare();
    });

    loadCompare();
    $(document).on('shopify:section:load', loadCompare);
    return {
        load: loadCompare
    }
})()

// Popup newsletter
theme.popupNewletter = (function() {
    var $popupNewsletter = $('#jsPopupNewsletter'),
        $newsletterForm = $('#jsPopupNewsletter form'),
        date = new Date(),
        minutes = theme.timePopupNewsletter;
    minutesdelay = $popupNewsletter.attr('data-delay');
    if ($popupNewsletter.length === 1) {
        date.setTime(date.getTime() + (minutes * 60 * 1000));
        var setCookies = function() {
            $.cookie('cookiesNewsletter', 'disabled', { expires: date, path: '/' });
        };
        if ($.cookie('cookiesNewsletter') !== "disabled") {
            $(window).on('load', function() {
                setTimeout(function() {
                    $popupNewsletter.modal('show');
                }, minutesdelay * 1000);
            });
            $popupNewsletter.on('hidden.bs.modal', setCookies);
            $newsletterForm.submit(setCookies);
        }
    }
})()

// Cookie policy
theme.cookie = (function() {
    var $policy = $('.js-cookie-policy'),
        $closeButton = $('.js-btn-ok'),
        isOk = localStorage.getItem('localCookie') || '';
    if (isOk === '') {
        $policy.fadeIn('slow');
    }
    $closeButton.on('click', function() {
        localStorage.setItem('localCookie', 'accept');
        $policy.fadeOut('slow');
    })
})()

// Announcement Bar
theme.announcement = (function() {
    var $bar = $('.js-announcement-bar'),
        $closeButton = $('.js-ab-close'),
        isClosed = localStorage.getItem('localAnnouncement') || '';
    if (isClosed === '') {
        $bar.fadeIn();
        $bar.closest('.body-theme').addClass('body-announcement-bar');
    }
    $closeButton.on('click', function() {
        localStorage.setItem('localAnnouncement', 'closed');
        $bar.slideUp();
        $bar.closest('.body-theme').removeClass('body-announcement-bar');
    })
})()

// Open external link in new tab
theme.exLink = (function() {
    var links = document.links;
    for (let i = 0, linksLength = links.length; i < linksLength; i++) {
        if (links[i].hostname !== window.location.hostname && $(links[i]).attr('href') !== 'javascript:void(0)') {
            links[i].target = '_blank';
        }
    }
})()

// Deal- countdown
theme.countdown = (function() {
    function initCountdown() {
        $(".js-countdown").each(function() {
            var endTime = $(this).data('time'),
                htmlLayout = "<ul class='list--inline'><li class='gradient-theme-vertical'><span class='countdown-time'>%%D%%</span><span class='countdown-text'>Days</span></li><li class='gradient-theme-vertical'><span class='countdown-time'>%%H%%</span><span class='countdown-text'>Hours</span></li><li class='gradient-theme-vertical'><span class='countdown-time'>%%M%%</span><span class='countdown-text'>Mins</span></li><li class='gradient-theme-vertical'><span class='countdown-time'>%%S%%</span><span class='countdown-text'>Secs</span></li></ul>";
            $(this).lofCountDown({
                TargetDate: endTime,
                DisplayFormat: htmlLayout,
                FinishMessage: '<span class="alert alert-warning d-inline-block">' + theme.strings.countdownEndText + '</span>'
            });
        });
    }
    initCountdown();
    return {
        load: initCountdown
    }
})()

// Price range - Collection page
theme.priceRange = (function() {
    function initPriceRange() {
        var min = 0,
            max = 0,
            slideRange = '#js-slider-range',
            productCard = '.js-product-card',
            slideRangeWrap = '.slider-range-wr',
            rangeMin = '.js-range-min',
            rangeMax = '.js-range-max',
            enablePriceRange = $('#js-slider-range').length === 1 ? true : false;

        if (enablePriceRange) {
            $(productCard).each(function() {
                if (eval($(this).data('price')) > max) max = eval($(this).data('price'));
                if (min == 0) min = eval($(this).data('price'));
                else if (eval($(this).data('price')) < min) min = eval($(this).data('price'));
            });

            if (min === max) {
                $(slideRangeWrap).fadeOut();
            } else {
                $(slideRangeWrap).fadeIn();
            }

            $(slideRange).slider({
                range: true,
                min: min,
                max: max,
                values: [min, max],
                slide: function(event, ui) {
                    var price1 = (Shopify.formatMoney(ui.values[0], theme.moneyFormat));
                    var price2 = (Shopify.formatMoney(ui.values[1], theme.moneyFormat));
                    $(rangeMin).html(price1);
                    $(rangeMax).html(price2);
                    theme.updateCurrencies();

                    // Show/Hide product when dragging
                    $(productCard).each(function() {
                        if (eval($(this).data('price')) >= ui.values[0] && eval($(this).data('price')) <= ui.values[1]) {
                            $(this).parent().fadeIn();
                        } else {
                            $(this).parent().fadeOut();
                        }
                    });
                }
            });

            var price1 = (Shopify.formatMoney(min, theme.moneyFormat));
            var price2 = (Shopify.formatMoney(max, theme.moneyFormat));
            $(rangeMin).html(price1);
            $(rangeMax).html(price2);
            theme.updateCurrencies();

        }
    }
    initPriceRange();
    return {
        load: initPriceRange
    }
})()

// Collection view - Collection page
theme.collectionView = (function() {
    var btnView = '.js-btn-view',
        btnViewActive = '.js-btn-view.active';

    $(document).on('click', btnView, function() {
        var value = $(this).data('col'),
            $gridItemCol = $('.js-col');

        $(btnView).removeClass('active');
        $(this).addClass('active');

        $gridItemCol.removeClass().addClass('js-col col-sm-6 col-12');
        if (value === 3) {
            $gridItemCol.addClass('col-lg-4');
        } else if (value === 4) {
            $gridItemCol.addClass('col-lg-3');
        } else if (value === 5) {
            $gridItemCol.addClass('col-lg-2-4');
        } else if (value === 6) {
            $gridItemCol.addClass('col-lg-2');
        };
    })

    function triggerCollectionView() {
        $(btnViewActive).trigger('click');
    }

    return {
        triggerView: triggerCollectionView
    }
})()

// Swath variant in card item
theme.swatchCard = (function() {
    $(document).on('click', '.js-swatch-card-item', function() { //click or mouseover
        $(".js-swatch-card-item").removeClass("active");
        $(this).addClass("active");
        var newImage = $(this).data('image');
        var id = $(this).data('id');
        var gridItem = $(this).closest('.js-product-card');
        gridItem.find('.product-card__image').find('img').attr('srcset', newImage);
        gridItem.find('.js-grid-cart').data('id', id).attr('data-id', id);
    });
})()

theme.swatchCard2 = (function() {
    function initVariant(id) {
        var productJson = JSON.parse($('.customJson-' + id).html());
        var $selectorForm = $('.customform-' + id);
        var $button = $('.js-customform-addtocart-' + id);
        var $buttontext = $button.find('span');
        var $wrapObject = $selectorForm.closest('.js-product-card');
        var options = {
            $container: $selectorForm,
            enableHistoryState: false,
            product: productJson,
            singleOptionSelector: '.single-option-selector-' + id,
            originalSelectorId: '#ProductSelect-' + id
        };
        var variants = new slate.Variants(options);
        var AjaxCart = new window.AjaxCart($selectorForm);
        var _updateButton = function(evt) {
            var variant = evt.variant;
            if (variant === undefined) {
                $button.prop('disabled', true).removeClass('btn--sold-out');
                $buttontext.html(theme.strings.unavailable);
            } else {
                if (variant.available) {
                    $button.removeClass('btn--sold-out').prop('disabled', false);
                    $buttontext.html(theme.strings.addToCart);
                } else {
                    $button.prop('disabled', true).addClass('btn--sold-out');
                    $buttontext.html(theme.strings.soldOut);
                }
            }
        }
        var _updateImage = function(evt) {
            var variant = evt.variant;
            var $mainImage = $wrapObject.find('.product-card__image').find('img');
            if (variant !== undefined && variant.featured_image !== null) {
                var variantImage = variant.featured_image;
                $mainImage.attr('srcset', variantImage.src);
            }
        }
        var _updatePrice = function(evt) {
            var $price = $wrapObject.find('.product-card__price');
            var variant = evt.variant;
            if (variant !== undefined) {
                var htmlComparePrice = variant.compare_at_price !== null ? '<s class="product-card__regular-price"><span class="money">' + variant.compare_at_price + '</span></s>' : '';
                var htmlPrice = '<span class="money">' + variant.price + '</span>' + htmlComparePrice;
                $price.html(htmlPrice);
                theme.updateCurrencies();
            }
        }
        variants.$container.on(
            'variantChange', _updateButton
        );
        variants.$container.on(
            'variantChange', _updateImage
        );
        variants.$container.on(
            'variantChange', _updatePrice
        );
    }

    function initForm() {
        $('.js-customform').each(function() {
            var id = $(this).data('id');
            initVariant(id);
        })
    }

    initForm();
    return {
        load: initForm
    }
})()

// Loading
theme.loading = (function() {
    var $loading = $('#js-loading'),
        hasLoading = $('#js-loading').length === 0 ? false : true;
    if (hasLoading) {
        $(window).load(function() {
            $loading.fadeOut();
        });
    }
})()

theme.effectLeavingPage = (function() {
    window.onbeforeunload = function() {
        $('body').css('opacity', '0');
    }
})()

// Isotope
theme.isotope = (function() {
    var enableIsotope = $('.enable-isotope').length === 1 ? true : false,
        $grid = $('.js-grid'),
        filter = '.js-filter-isotope';

    function initIsotope() {
        if (enableIsotope) {
            $grid.isotope({
                itemSelector: '.grid-item',
                percentPosition: true
            })
            $(document).on('click', filter, function() {
                var filterValue = $(this).data('filter') === '*' ? $(this).data('filter') : '.' + $(this).data('filter');
                $(filter).removeClass('active');
                $(this).addClass('active');
                $grid.isotope({
                    filter: filterValue
                });
            });
            $(window).scroll(function() {
                $grid.isotope('layout');
            });
            $(window).load(function() {
                $grid.isotope('layout');
                $(filter).first().trigger('click');
            });
        }
    }
    initIsotope();
})()

//aos



// theme.Wow = (function(){
//   new WOW().init();
// })()




// Masonry
theme.Masonry = (function() {
    function Masonry(container) {
        this.$container = $(container).on('init', this._a11y.bind(this));
        var $masonry = this.$container;
        $masonry.isotope({
            itemSelector: '.grid-item',
            percentPosition: true,
            masonry: {
                columnWidth: '.grid-sizer'
            }
        });
        $(window).load(function() {
            $masonry.isotope('layout').css('opacity', '1');
        });
        $(window).scroll(function() {
            $masonry.isotope('layout').css('opacity', '1');
        });
    }

    Masonry.prototype = _.assignIn({}, Masonry.prototype, {
        _a11y: function(event, obj) {
            var $list = obj.$list;
            var $wrapper = this.$container.parent();

            // Remove default Slick aria-live attr until slider is focused
            $list.removeAttr('aria-live');

            // When an element in the slider is focused set aria-live
            $wrapper.on('focusin', function(evt) {
                if ($wrapper.has(evt.target).length) {
                    $list.attr('aria-live', 'polite');
                }
            });

            // Remove aria-live
            $wrapper.on('focusout', function(evt) {
                if ($wrapper.has(evt.target).length) {
                    $list.removeAttr('aria-live');
                }
            });
        }
    });

    return Masonry;
})();



// Cross-selling
theme.crosssell = (function() {
    var crosssellClass = '.js-crosssell',
        handles = $(crosssellClass).data('handles') || '',
        arrayHandle = handles.split(','),
        $blockCrosssell = $('.block-cross-sell'),
        variantSelectClass = '.js-cross-select',
        crossImageClass = '.cross-item-image',
        crossPriceClass = '.cross-item-money';

    function generateCrosssell() {
        for (var i = 0; i < arrayHandle.length; i++) {
            var productHandle = arrayHandle[i];
            Shopify.getProduct(productHandle, function(product) {
                var htmlCross = '',
                    htmlOption = '',
                    firstAvailableVariant = '',
                    variantCount = product.variants.length;

                // generate select box and check first avaiable variant
                for (var j = 0; j < variantCount; j++) {
                    var variant = product.variants[j],
                        variantImage = variant.featured_image === null ? product.featured_image : variant.featured_image.src,
                        disabled = variant.available ? '' : 'disabled';
                    htmlOption += '<option ' + disabled + ' data-id="' + variant.id + '" data-price="' + variant.price + '" data-image="' + variantImage + '">' + variant.title + '</option>';
                    if (firstAvailableVariant === '' && variant.available) {
                        firstAvailableVariant = variant
                    }
                }
                var productPrice = theme.Currency.formatMoney(firstAvailableVariant.price, theme.moneyFormat),
                    productImage = firstAvailableVariant.featured_image === null ? product.featured_image : firstAvailableVariant.featured_image.src,
                    selectHide = variantCount === 1 ? 'hide' : '';

                // generate HTML
                htmlCross += '<div class="col cross-item ' + product.handle + '">';
                htmlCross += '	<a class="cross-item-image" href="' + product.url + '" title="' + product.title + '"><img src="' + productImage + '" />' + theme.strings.cartIcon + '</a>';
                htmlCross += '	<a target="_blank" href="' + product.url + '" title="' + product.title + '" class="cross-item-title">' + product.title + '</a>';
                htmlCross += '	<span class="cross-item-money">' + productPrice + '</span>';
                htmlCross += '	<select class="js-cross-select ' + selectHide + '" data-image="' + productImage + '" data-price="' + firstAvailableVariant.price + '" data-item="' + firstAvailableVariant.id + '">' + htmlOption + '</select>';
                htmlCross += '</div>';
                $(crosssellClass).append(htmlCross);
                theme.updateCurrencies();
            });
        }
    }

    function showPopupCrosssell(lineItem) {
        //generate lineitem;
        var htmlLineItem = '';
        htmlLineItem += '<span class="alert alert-success d-inline-block mb-2">' + theme.strings.addToCartSuccess + '</span>';
        htmlLineItem += '<div><img src="' + lineItem.image + '" alt="Added Product"></div>';
        htmlLineItem += '<h4 class="cross-item-title">' + lineItem.title + '</h4>';
        htmlLineItem += '<div class="mb-2">' + theme.strings.cartQuantity + ': ' + lineItem.quantity + '</div>';
        $('.js-cross-added').hide().html(htmlLineItem).fadeIn();

        // show popup
        var $popupCrosssell = $('#jsCrosssell');
        $popupCrosssell.modal('show');
    }

    if (handles !== '') {
        $(document).on('click', crossImageClass, function(event) {
            event.preventDefault();
            var parent = $(this).closest('.cross-item'),
                itemId = parent.find(variantSelectClass).attr('data-item');
            Shopify.addItem(itemId, 1, function(lineItem) {
                theme.miniCart.updateElements();
                theme.miniCart.generateCart();
                showPopupCrosssell(lineItem);
            });
        });
        $(document).on('change', variantSelectClass, function() {
            var selectVariant = $(this).children(':selected'),
                selectVariantId = selectVariant.data('id'),
                parent = $(this).parent(),
                newPrice = theme.Currency.formatMoney(selectVariant.data('price'), theme.moneyFormat);

            if (selectVariant.data('image') !== '') {
                parent.find(crossImageClass).find('img').attr('src', selectVariant.data('image'));
            }
            $(this).attr('data-item', selectVariantId);
            parent.find(crossPriceClass).html(newPrice);
            theme.updateCurrencies();
        });
        $(document).on('shopify:section:load', generateCrosssell);
        generateCrosssell();
        $blockCrosssell.removeClass('hide');
    }
    return {
        showPopup: showPopupCrosssell
    }
})()

// Upsell
theme.upsell = (function() {
    var popupUpsell = '#jsUpsell',
        $button = $('#jsUpsell .btn'),
        productUpsellId = $('#jsUpsell').data('id') || '',
        buttonAcceptClass = 'js-btn-accept',
        delayTime = $('#jsUpsell').data('delay') || 3000,
        isUpsell = $(popupUpsell).length === 1 ? true : false;
    if (isUpsell) {
        $(document).ready(function() {
            setTimeout(function() {
                $(popupUpsell).modal('show');
            }, delayTime);
        });
        $button.on('click', function() {
            if ($(this).hasClass(buttonAcceptClass)) {
                Shopify.addItem(productUpsellId, 1, function(item) {
                    theme.miniCart.updateElements();
                    theme.miniCart.generateCart();
                    var htmlVariant = item.variant_title !== null ? '<i>(' + item.variant_title + ')</i>' : '';
                    var htmlAlert = '<div class="media mt-2 alert--cart"><a class="mr-3" href="/cart"><img class="lazyload" data-src="' + item.image + '"></a><div class="media-body align-self-center"><p class="m-0 font-weight-bold">' + item.product_title + ' x ' + item.quantity + '</p>' + htmlVariant + '<div><div>';
                    theme.alert.new(theme.strings.addToCartSuccess, htmlAlert, 3000, 'notice');
                })
            }
            $(popupUpsell).modal('hide');
        })
    }
})()

// Coupon
theme.coupon = (function() {
    var popupCoupon = '#jsCoupon',
        $button = $('#jsCoupon .js-btn-coupon'),
        delayTime = $('#jsCoupon').data('delay') || 3000,
        isCoupon = $(popupCoupon).length === 1 ? true : false,
        isCopied = localStorage.getItem('localCoupon') || '';
    if (isCoupon && isCopied === '') {
        $(document).ready(function() {
            setTimeout(function() {
                $(popupCoupon).modal('show');
            }, delayTime);
        });
        $button.on('click', function() {
            var copyText = document.getElementById("coupon_code");
            copyText.select();
            document.execCommand("Copy");
            $(popupCoupon).modal('hide');
            theme.alert.new('Coupon code', 'Successfully copied, now you can paste code at checkout', 4000);
            localStorage.setItem('localCoupon', 'copied');
        })
    }
})()

// Overwrite Shopify.onError in Shopify API
Shopify.onError = function(t, r) {
    var e = eval("(" + t.responseText + ")");
    var mess = e.message ? e.message + "(" + e.status + "): " + e.description : "Error : " + Shopify.fullMessagesFromErrors(e).join("; ") + "."
    theme.alert.new('Alert', mess, 3000, 'warning');
}

// Megamenu width
theme.fixWidthMegamenu = (function() {
    var $megamenuClass = $('.site-nav__item-mega'),
        megaDropdownClass = '.meganav';
    $megamenuClass.each(function() {
        var widthMenu = $(this).data('width') || 0;
        if (widthMenu !== 0) {
            $(this).find(megaDropdownClass).css({ 'width': widthMenu + 'px', 'margin-left': '-' + widthMenu / 2 + 'px' });
        }
    });
})()

// Product video
theme.productVideo = (function() {
    var playButtonClass = '.js-play-button';
    $(document).on('click', playButtonClass, function() {
        let videoSelector = $(this).next(),
            videoObject = videoSelector.get(0);
        $(this).toggleClass('active');
        videoSelector.toggleClass('active');
        videoObject.paused ? videoObject.play() : videoObject.pause();
    })
})()

// Fake-viewers
theme.fakeViewer = (function() {
    var $fakeViewClass = $('.js-fake-view'),
        minValue = $fakeViewClass.data('min'),
        maxValue = $fakeViewClass.data('max'),
        duration = $fakeViewClass.data('duration');

    function randomInRange(start, end) {
        var value = Math.floor(Math.random() * (end - start + 1) + start);
        $fakeViewClass.text(value);
    }

    if (minValue !== undefined && maxValue !== undefined) {
        randomInRange(minValue, maxValue);
        setInterval(function() {
            randomInRange(minValue, maxValue);
        }, duration);
    }

})();

// Product-suggest
theme.productSuggest = (function() {
    var $productSuggestClass = $('.product-notification'),
        $closeButtonClass = $('.close-notifi'),
        duration = $productSuggestClass.data('time') || 0,
        productSuggestCookie = 'cookieSuggest';

    function SomeonePurchased() {
        if ($.cookie(productSuggestCookie) == 'closed') {
            $productSuggestClass.remove();
        }
        $closeButtonClass.on('click', function() {
            $productSuggestClass.remove();
            $.cookie(productSuggestCookie, 'closed', { expires: 1, path: '/' });
        });

        function toggleSomething() {
            if ($productSuggestClass.hasClass('active')) {
                $productSuggestClass.removeClass('active')
            } else {
                var arrayProducts = $('.data-product'),
                    randomProduct = Math.floor(Math.random() * arrayProducts.length),
                    Object = $(arrayProducts[randomProduct]);

                $productSuggestClass.addClass('active');
                $productSuggestClass.find('.product-image').attr('href', Object.data('url')).find('img').attr('src', Object.data('image'));
                $productSuggestClass.find('.product-name').text(Object.data('title')).attr('href', Object.data('url'));
                $productSuggestClass.find('.time-ago').text(Object.data('time'));
                $productSuggestClass.find('.from-ago').text(Object.data('local'));
            }
        }

        if (duration !== 0) {
            setInterval(toggleSomething, duration);
        }
    }
    SomeonePurchased();
})()


// Stickyheader
theme.stickyHeader = (function() {
    var stickHeaderClass = '.site-header--sticky';
    if ($(stickHeaderClass).length !== 0) {
        $(window).scroll(function() {
            if (window.pageYOffset >= 20) {
                $(stickHeaderClass).addClass('active');
            } else {
                $(stickHeaderClass).removeClass('active');
            }
        });
    }
})()

theme.PhotoSwipe = (function() {
    var initPhotoSwipeFromDOM = function(gallerySelector) {

        // parse slide data (url, title, size ...) from DOM elements 
        // (children of gallerySelector)
        var parseThumbnailElements = function(el) {
            var thumbElements = el.childNodes,
                numNodes = thumbElements.length,
                items = [],
                figureEl,
                linkEl,
                size,
                item;

            for (var i = 0; i < numNodes; i++) {

                figureEl = thumbElements[i]; // <figure> element

                // include only element nodes 
                if (figureEl.nodeType !== 1) {
                    continue;
                }

                linkEl = figureEl.children[0]; // <a> element

                size = linkEl.getAttribute('data-size').split('x');

                // create slide object
                item = {
                    src: linkEl.getAttribute('href'),
                    w: parseInt(size[0], 10),
                    h: parseInt(size[1], 10)
                };



                if (figureEl.children.length > 1) {
                    // <figcaption> content
                    item.title = figureEl.children[1].innerHTML;
                }

                if (linkEl.children.length > 0) {
                    // <img> thumbnail element, retrieving thumbnail url
                    item.msrc = linkEl.children[0].getAttribute('src');
                }

                item.el = figureEl; // save link to element for getThumbBoundsFn
                items.push(item);
            }

            return items;
        };

        // find nearest parent element
        var closest = function closest(el, fn) {
            return el && (fn(el) ? el : closest(el.parentNode, fn));
        };

        // triggers when user clicks on thumbnail
        var onThumbnailsClick = function(e) {
            e = e || window.event;
            e.preventDefault ? e.preventDefault() : e.returnValue = false;

            var eTarget = e.target || e.srcElement;

            // find root element of slide
            var clickedListItem = closest(eTarget, function(el) {
                return (el.tagName && el.tagName.toUpperCase() === 'FIGURE');
            });

            if (!clickedListItem) {
                return;
            }

            // find index of clicked item by looping through all child nodes
            // alternatively, you may define index via data- attribute
            var clickedGallery = clickedListItem.parentNode,
                childNodes = clickedListItem.parentNode.childNodes,
                numChildNodes = childNodes.length,
                nodeIndex = 0,
                index;

            for (var i = 0; i < numChildNodes; i++) {
                if (childNodes[i].nodeType !== 1) {
                    continue;
                }

                if (childNodes[i] === clickedListItem) {
                    index = nodeIndex;
                    break;
                }
                nodeIndex++;
            }



            if (index >= 0) {
                // open PhotoSwipe if valid index found
                openPhotoSwipe(index, clickedGallery);
            }
            return false;
        };

        // parse picture index and gallery index from URL (#&pid=1&gid=2)
        var photoswipeParseHash = function() {
            var hash = window.location.hash.substring(1),
                params = {};

            if (hash.length < 5) {
                return params;
            }

            var vars = hash.split('&');
            for (var i = 0; i < vars.length; i++) {
                if (!vars[i]) {
                    continue;
                }
                var pair = vars[i].split('=');
                if (pair.length < 2) {
                    continue;
                }
                params[pair[0]] = pair[1];
            }

            if (params.gid) {
                params.gid = parseInt(params.gid, 10);
            }

            return params;
        };

        var openPhotoSwipe = function(index, galleryElement, disableAnimation, fromURL) {
            var pswpElement = document.querySelectorAll('.pswp')[0],
                gallery,
                options,
                items;

            items = parseThumbnailElements(galleryElement);

            // define options (if needed)
            options = {
                maxSpreadZoom: 1,
                bgOpacity: 0.7,
                zoomEl: true,
                history: false,
                zoomEl: false,
                pinchToClose: false,
                closeOnScroll: false,
                // define gallery index (for URL)
                galleryUID: galleryElement.getAttribute('data-pswp-uid'),

            };

            // PhotoSwipe opened from URL
            if (fromURL) {
                if (options.galleryPIDs) {
                    // parse real index when custom PIDs are used 
                    // http://photoswipe.com/documentation/faq.html#custom-pid-in-url
                    for (var j = 0; j < items.length; j++) {
                        if (items[j].pid == index) {
                            options.index = j;
                            break;
                        }
                    }
                } else {
                    // in URL indexes start from 1
                    options.index = parseInt(index, 10) - 1;
                }
            } else {
                options.index = parseInt(index, 10);
            }

            // exit if index not found
            if (isNaN(options.index)) {
                return;
            }

            if (disableAnimation) {
                options.showAnimationDuration = 0;
            }

            // Pass data to PhotoSwipe and initialize it
            gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, items, options);
            gallery.init();
        };

        // loop through all gallery elements and bind events
        var galleryElements = document.querySelectorAll(gallerySelector);

        for (var i = 0, l = galleryElements.length; i < l; i++) {
            galleryElements[i].setAttribute('data-pswp-uid', i + 1);
            galleryElements[i].onclick = onThumbnailsClick;
        }

        // Parse URL and open gallery if it contains #&pid=3&gid=1
        var hashData = photoswipeParseHash();
        if (hashData.pid && hashData.gid) {
            openPhotoSwipe(hashData.pid, galleryElements[hashData.gid - 1], true, true);
        }
    };

    // execute above function
    initPhotoSwipeFromDOM('.my-gallery');
})()

theme.ZoomImage = (function() {
    $(window).resize(function() {
        var width = $(window).width();
        if (width > 767) {
            ZoomImage();
        }
    });
    $(window).width(function() {
        var width = $(window).width();
        if (width > 767) {
            ZoomImage();
        }
    });

    function ZoomImage() {
        $(".zoom_image").each(function(arg, el) {
            var image = $(el).find("img");
            $(el).zoom({
                on: 'mouseover',
                url: image.attr("src").replace("small", "big")
            });
        });
    }
})()

theme.activeAccordion = (function() {
    $('.collapse').on('shown.bs.collapse', function() {
        $(this).prev().addClass('active-acc');
    });
    $('.collapse').on('hidden.bs.collapse', function() {
        $(this).prev().removeClass('active-acc');
    });
})()


// Anchor scroll
theme.anchorScroll = (function() {
    $(document).on('click', 'a[href^="#"]', function(event) {
        event.preventDefault();
        var disableAnchor = $(this).hasClass('disabled-anchor');
        if (!disableAnchor) {
            $('html, body').animate({
                scrollTop: $($.attr(this, 'href')).offset().top
            }, 500);
        }
    });
})()

// Product-recently-viewed
theme.productRecentlyViewed = (function() {
    var $viewedElement = $('.js-recently-view'),
        $viewButton = $('.js-recently-view-button'),
        $content = $('.js-recently-view-content'),
        productHandle = $viewedElement.data('handle') || '',
        limit = $viewButton.data('limit') || 0,
        arrayProduct = JSON.parse(localStorage.getItem('localRecentlyViewed')) || [],
        lastProduct = arrayProduct[arrayProduct.length - 1] || '',
        isAdded = $.inArray(productHandle, arrayProduct) !== -1 ? true : false;

    function processViewed() {
        if (productHandle !== '') {
            //process last product
            if (lastProduct === productHandle && arrayProduct.length > 1) {
                lastProduct = arrayProduct[arrayProduct.length - 2]
            }

            //move current product to last of array
            if (isAdded) {
                arrayProduct.splice(arrayProduct.indexOf(productHandle), 1);
            }
            arrayProduct.push(productHandle);
            //remove first item if limit
            if (arrayProduct.length > limit) {
                arrayProduct.shift()
            }
            localStorage.setItem('localRecentlyViewed', JSON.stringify(arrayProduct));
        }
    }

    function generatorProduct() {
        $content.html('');
        if (arrayProduct.length > 0) {
            //array
            for (var i = 0; i < arrayProduct.length; i++) {
                var productHandle = arrayProduct[i];
                Shopify.getProduct(productHandle, function(product) {
                    var htmlProduct = '';
                    var productPrice = product.price_varies ? 'from ' + theme.Currency.formatMoney(product.price_min, theme.moneyFormat) : theme.Currency.formatMoney(product.price, theme.moneyFormat);
                    var productComparePrice = product.compare_at_price_min !== 0 ? theme.Currency.formatMoney(product.compare_at_price_min, theme.moneyFormat) : '';
                    htmlProduct += '<div class="col-12 col-lg-4 js-viewed-item mb-4">';
                    htmlProduct += '	<div class="border p-3 rounded media d-flex ">';
                    htmlProduct += '	<a class="mr-3 col-4 p-0" href="' + product.url + '">';
                    htmlProduct += '		<img src="' + product.featured_image + '"/>';
                    htmlProduct += '	</a>';
                    htmlProduct += '	<div class="media-body text-left">';
                    htmlProduct += '		<h4 class="mb-2 mt-2"><a href="' + product.url + '">' + product.title + '</a></h5>';
                    htmlProduct += '	<span> ' + productPrice + '</span>';
                    htmlProduct += '	<s>' + productComparePrice + '</s>';
                    htmlProduct += '	</div>';
                    htmlProduct += '	</div>';
                    htmlProduct += '</div>';
                    $content.append(htmlProduct);
                    theme.updateCurrencies();
                });
            }

            //last product
            Shopify.getProduct(lastProduct, function(product) {
                $viewButton.css('background-image', 'url(' + product.featured_image + ')').addClass('active');
            })
        }
    }

    processViewed();
    generatorProduct();

})()

// Notice when soldout
theme.alert = (function() {
    function createAlert(title, mess, time, type) {
        var aTitle = title || '',
            aTime = time || 2000,
            aMessage = mess || '',
            aClass = type || 'default';
        $.growl({
            title: aTitle,
            message: aMessage,
            duration: aTime,
            style: aClass,
            size: 'large'
        });
    }

    return {
        new: createAlert
    }
})()

// Notice when soldout
theme.noticeSoldout = (function() {
    var $soldoutWrapFormClass = $('.js-contact-soldout'),
        $textClass = $('.js-notify-text'),
        $soldoutValueId = $('#ContactProduct');

    function noticeSoldout(variant) {
        $soldoutWrapFormClass.find('.form-success').remove()
        if (variant.available) {
            $textClass.find('span').text('');
            $soldoutWrapFormClass.addClass('hide');
        } else {
            $textClass.find('span').text(': ' + variant.name);
            $soldoutWrapFormClass.removeClass('hide');
            $soldoutValueId.val(variant.name).attr('value', variant.name);
        }
    }
    return {
        init: noticeSoldout
    }
})()

// Sticky cart
theme.stickyCart = (function() {
    var $anchor = $('#js-anchor-sticky-cart'),
        $stCart = $('.sticky-cart-wr'),
        $close = $('#js-sticky-close'),
        disableStCart = localStorage.getItem('localDisableStCart') || '';
    if (disableStCart !== '') {
        $stCart.addClass('disable');
    }
    $close.on('click', function() {
        var isDisable = disableStCart !== '';
        if (isDisable) {
            localStorage.setItem('localDisableStCart', '');
        } else {
            localStorage.setItem('localDisableStCart', 'true');
        }
        $stCart.toggleClass('disable');
    })
    if ($anchor.length) {
        $(window).on('scroll', function() {
            var hT = $anchor.offset().top,
                hH = $anchor.outerHeight(),
                wH = $(window).height(),
                wS = $(this).scrollTop();
            if (wS > (hT + hH - wH)) {
                $stCart.addClass('active');
            } else {
                $stCart.removeClass('active');
            }
        });
    }

})()

//Fix reload safari
window.addEventListener("pageshow", function(evt) {
    if (evt.persisted) {
        setTimeout(function() {
            window.location.reload();
        }, 10);
    }
}, false);

// Back to top
theme.backToTop = (function() {
    var backtotopClass = $('.js-back-to-top');
    $(window).scroll(function() {
        if ($(this).scrollTop() > 300) {
            backtotopClass.fadeIn('slow');
        } else {
            backtotopClass.fadeOut('slow');
        }
    });
    backtotopClass.on('click', function() {
        $('body,html').animate({ scrollTop: 0 }, 800);
    });
})()


// Tooltip
theme.tooltip = (function() {
    var selector = '[data-toggle="tooltip"],[data-tooltip="true"]';

    function loadTooltip() {
        $(selector).tooltip(); //Bootstrap 4
    };
    $(document).on('click', selector, function() {
        $(this).tooltip('hide');
    });
    loadTooltip();
    return {
        load: loadTooltip
    }
})()

//Collections style 2
theme.Bgcollection = (function() {
    // init Isotope
    function Bgcollection(container) {
        var $container = this.$container = $(container);
        var sectionId = $container.attr('data-section-id');
        var wrapper = this.wrapper = '.bgcollection-wrapper';
        var slider = this.slider = '#Bgcollection-' + sectionId;
        var $slider = $(slider, wrapper);
        $(".colgrid__bg--full[data-index='1']").addClass('active');
        $('.colgrid .colgrid__box').each(function() {
            var index = $(this).attr("data-index");
            $(this).hover(
                function() {
                    $(".colgrid__bg--full[data-index='" + index + "']").addClass('active');
                },
                function() {
                    $(".colgrid__bg--full[data-index='" + index + "']").removeClass('active');
                }
            );
        });
    }

    return Bgcollection;
})();


//Sidebar
theme.sidebar = (function() {
    var togglebutton = '.js-toggle-filter',
        $sidebar = $('.js-sidebar');
    $(document).on('click', togglebutton, function() {
        $sidebar.toggleClass('active');
        $(this).toggleClass('active');
    })
})()

// Ajax filter in collection page
theme.ajaxFilter = (function() {
    var ajaxContent = '#js-product-ajax',
        ajaxSortBy = '#js-sortby',
        ajaxFillter = '#js-fillter',
        ajaxCollectionTitle = '.js-collection-title',
        pageTitle = $(document).find("title").text(),
        jsLoading = '#js-loading';

    var apollo = {
        init: function() {
            this.initFilter();
        },
        showLoading: function() {
            $(jsLoading).show();
        },
        hideLoading: function() {
            $('body,html').animate({
                scrollTop: $('#MainContent').offset().top - 150
            }, 600);
            setTimeout(function() {
                $(jsLoading).hide(); //delay 500ms for better UX
            }, 500);

        },
        initFilter: function() {
            apollo.filterParams();
            apollo.filterSortby();
            apollo.sidebarMapTagEvents();
            apollo.filterMapSorting();
            apollo.filterMapPaging();
        },
        filterParams: function() {
            Shopify.queryParams = {};
            if (location.search.length) {
                for (var aKeyValue, i = 0, aCouples = location.search.substr(1).split('&'); i < aCouples.length; i++) {
                    aKeyValue = aCouples[i].split('=');
                    if (aKeyValue.length > 1) {
                        Shopify.queryParams[decodeURIComponent(aKeyValue[0])] = decodeURIComponent(aKeyValue[1]);
                    }
                }
            }
        },
        filterSortby: function() {
            if (Shopify.queryParams.sort_by) {
                var sortby = Shopify.queryParams.sort_by;
                $(ajaxSortBy).val(sortby);
            }
        },
        filterCreateUrl: function(baseLink) {
            var newQuery = $.param(Shopify.queryParams).replace(/%2B/g, '+');
            if (baseLink) {
                if (newQuery != "") {
                    return baseLink + "?" + newQuery;
                } else {
                    return baseLink;
                }
            }
            return location.pathname + "?" + newQuery;
        },
        filterMapData: function(data) {
            // 1. update product grid
            $(ajaxContent).html($(ajaxContent, data.responseText).html());
            // 2. update left filter
            $(ajaxFillter).html($(ajaxFillter, data.responseText).html());
            // 3. update collection title
            $(ajaxCollectionTitle).html($(ajaxCollectionTitle, data.responseText).html());
        },
        filterAjaxClick: function(baseLink) {
            delete Shopify.queryParams.page;
            var newurl = apollo.filterCreateUrl(baseLink);
            History.pushState({
                param: Shopify.queryParams
            }, pageTitle, newurl);
            apollo.filterGetContent(newurl);
        },
        filterGetContent: function(newurl) {
            $.ajax({
                type: 'GET',
                url: newurl,
                data: {},
                beforeSend: function() {
                    apollo.showLoading();
                },
                complete: function(data) {
                    apollo.filterMapData(data);
                    theme.wishlist.load();
                    theme.compare.load();
                    theme.countdown.load();
                    theme.priceRange.load();
                    theme.tooltip.load();
                    theme.collectionView.triggerView();
                    theme.swatchCard2.load();
                    theme.infiniteScroll.load();
                    apollo.hideLoading();
                },
                error: function(xhr, text) {
                    apollo.hideLoading();
                    alert($.parseJSON(xhr.responseText).description);
                }
            });
        },
        sidebarMapTagEvents: function() {
            $(document).on('click', '.advanced-filter a', function(event) {
                event.preventDefault();
                $('.tooltip').removeClass('show');
                var currentTags = [];
                if (Shopify.queryParams.constraint) {
                    currentTags = Shopify.queryParams.constraint.split('+');
                }
                if (!$(this).parent().hasClass("active-filter")) {
                    var otherTag = $(this).parents('.catalog_filter_ul').find("li.active-filter");
                    if (otherTag.length > 0) {
                        var tagName = otherTag.data("handle");
                        if (tagName) {
                            var tagPos = currentTags.indexOf(tagName);
                            if (tagPos >= 0) {
                                currentTags.splice(tagPos, 1);
                            }
                        }
                    }
                }
                var dataHandle = $(this).parent().data("handle");
                if (dataHandle) {
                    var tagPos = currentTags.indexOf(dataHandle);
                    if (tagPos >= 0) {
                        currentTags.splice(tagPos, 1);
                    } else {
                        currentTags.push(dataHandle);
                    }
                }
                if (currentTags.length) {
                    Shopify.queryParams.constraint = currentTags.join('+');
                } else {
                    delete Shopify.queryParams.constraint;
                }
                apollo.filterAjaxClick();
            });
            $(document).on('click', '.advanced-filter .icon', function() {
                $(this).parent('.advanced-filter').find('a').trigger("click");
            });
        },
        filterMapSorting: function() {
            $(document).on('change', ajaxSortBy, function() {
                Shopify.queryParams.sort_by = $(this).val();
                apollo.filterAjaxClick();
            })
        },
        filterMapPaging: function() {
            $(document).on('click', '.js-pagination a', function() {
                event.preventDefault();
                var linkPage = $(this).attr("href").match(/page=\d+/g);
                if (linkPage) {
                    Shopify.queryParams.page = parseInt(linkPage[0].match(/\d+/g));
                    if (Shopify.queryParams.page) {
                        var newurl = apollo.filterCreateUrl();
                        History.pushState({
                            param: Shopify.queryParams
                        }, pageTitle, newurl);
                        apollo.filterGetContent(newurl);
                    }
                }
            });
        }
    }

    if ($(".template-collection")) {
        History.Adapter.bind(window, 'statechange', function() {
            var State = History.getState();
            apollo.filterParams();
        });
    }
    apollo.init();

})();
$(theme.init);

/**
 * Currency Helpers
 * -----------------------------------------------------------------------------
 * A collection of useful functions that help with currency formatting
 *
 * Current contents
 * - formatMoney - Takes an amount in cents and returns it as a formatted dollar value.
 *
 * Alternatives
 * - Accounting.js - http://openexchangerates.github.io/accounting.js/
 *
 */

theme.Currency = (function() {
    var moneyFormat = '${{amount}}'; // eslint-disable-line camelcase

    function formatMoney(cents, format) {
        if (typeof cents === 'string') {
            cents = cents.replace('.', '');
        }
        var value = '';
        var placeholderRegex = /\{\{\s*(\w+)\s*\}\}/;
        var formatString = format || moneyFormat;

        function formatWithDelimiters(number, precision, thousands, decimal) {
            thousands = thousands || ',';
            decimal = decimal || '.';

            if (isNaN(number) || number === null) {
                return 0;
            }

            number = (number / 100.0).toFixed(precision);

            var parts = number.split('.');
            var dollarsAmount = parts[0].replace(
                /(\d)(?=(\d\d\d)+(?!\d))/g,
                '$1' + thousands
            );
            var centsAmount = parts[1] ? decimal + parts[1] : '';

            return dollarsAmount + centsAmount;
        }

        switch (formatString.match(placeholderRegex)[1]) {
            case 'amount':
                value = formatWithDelimiters(cents, 2);
                break;
            case 'amount_no_decimals':
                value = formatWithDelimiters(cents, 0);
                break;
            case 'amount_with_comma_separator':
                value = formatWithDelimiters(cents, 2, '.', ',');
                break;
            case 'amount_no_decimals_with_comma_separator':
                value = formatWithDelimiters(cents, 0, '.', ',');
                break;
            case 'amount_no_decimals_with_space_separator':
                value = formatWithDelimiters(cents, 0, ' ');
                break;
            case 'amount_with_apostrophe_separator':
                value = formatWithDelimiters(cents, 2, "'");
                break;
        }
        return formatString.replace(placeholderRegex, value);
    }

    return {
        formatMoney: formatMoney
    };
})();

/**
 * Image Helper Functions
 * -----------------------------------------------------------------------------
 * A collection of functions that help with basic image operations.
 *
 */

theme.Images = (function() {
    /**
     * Preloads an image in memory and uses the browsers cache to store it until needed.
     *
     * @param {Array} images - A list of image urls
     * @param {String} size - A shopify image size attribute
     */

    function preload(images, size) {
        if (typeof images === 'string') {
            images = [images];
        }

        for (var i = 0; i < images.length; i++) {
            var image = images[i];
            this.loadImage(this.getSizedImageUrl(image, size));
        }
    }

    /**
     * Loads and caches an image in the browsers cache.
     * @param {string} path - An image url
     */
    function loadImage(path) {
        new Image().src = path;
    }

    /**
     * Swaps the src of an image for another OR returns the imageURL to the callback function
     * @param image
     * @param element
     * @param callback
     */
    function switchImage(image, element, callback) {
        var size = this.imageSize(element.src);
        var imageUrl = this.getSizedImageUrl(image.src, size);

        if (callback) {
            callback(imageUrl, image, element); // eslint-disable-line callback-return
        } else {
            element.src = imageUrl;
        }
    }

    /**
     * +++ Useful
     * Find the Shopify image attribute size
     *
     * @param {string} src
     * @returns {null}
     */
    function imageSize(src) {
        src = src || '';

        var match = src.match(
            /.+_((?:pico|icon|thumb|small|compact|medium|large|grande)|\d{1,4}x\d{0,4}|x\d{1,4})[_\\.@]/
        );

        if (match === null) {
            return null;
        } else {
            return match[1];
        }
    }

    /**
     * +++ Useful
     * Adds a Shopify size attribute to a URL
     *
     * @param src
     * @param size
     * @returns {*}
     */
    function getSizedImageUrl(src, size) {
        if (size === null) {
            return src;
        }

        if (size === 'master') {
            return this.removeProtocol(src);
        }

        var match = src.match(
            /\.(jpg|jpeg|gif|png|bmp|bitmap|tiff|tif)(\?v=\d+)?$/i
        );

        if (match !== null) {
            var prefix = src.split(match[0]);
            var suffix = match[0];

            return this.removeProtocol(prefix[0] + '_' + size + suffix);
        }

        return null;
    }

    function removeProtocol(path) {
        return path.replace(/http(s)?:/, '');
    }

    return {
        preload: preload,
        loadImage: loadImage,
        switchImage: switchImage,
        imageSize: imageSize,
        getSizedImageUrl: getSizedImageUrl,
        removeProtocol: removeProtocol
    };
})();

/**
 * Variant Selection scripts
 * ------------------------------------------------------------------------------
 *
 * Handles change events from the variant inputs in any `cart/add` forms that may
 * exist.  Also updates the master select and triggers updates when the variants
 * price or image changes.
 *
 * @namespace variants
 */

slate.Variants = (function() {
    /**
     * Variant constructor
     *
     * @param {object} options - Settings from `product.js`
     */
    function Variants(options) {
        this.$container = options.$container;
        this.product = options.product;
        this.singleOptionSelector = options.singleOptionSelector;
        this.originalSelectorId = options.originalSelectorId;
        this.enableHistoryState = options.enableHistoryState;
        this.currentVariant = this._getVariantFromOptions();

        $(this.singleOptionSelector, this.$container).on(
            'change',
            this._onSelectChange.bind(this)
        );
    }

    Variants.prototype = _.assignIn({}, Variants.prototype, {
        /**
         * Get the currently selected options from add-to-cart form. Works with all
         * form input elements.
         *
         * @return {array} options - Values of currently selected variants
         */
        _getCurrentOptions: function() {
            var currentOptions = _.map(
                $(this.singleOptionSelector, this.$container),
                function(element) {
                    var $element = $(element);
                    var type = $element.attr('type');
                    var currentOption = {};

                    if (type === 'radio' || type === 'checkbox') {
                        if ($element[0].checked) {
                            currentOption.value = $element.val();
                            currentOption.index = $element.data('index');

                            return currentOption;
                        } else {
                            return false;
                        }
                    } else {
                        currentOption.value = $element.val();
                        currentOption.index = $element.data('index');

                        return currentOption;
                    }
                }
            );

            // remove any unchecked input values if using radio buttons or checkboxes
            currentOptions = _.compact(currentOptions);

            return currentOptions;
        },

        /**
         * Find variant based on selected values.
         *
         * @param  {array} selectedValues - Values of variant inputs
         * @return {object || undefined} found - Variant object from product.variants
         */
        _getVariantFromOptions: function() {
            var selectedValues = this._getCurrentOptions();
            var variants = this.product.variants;

            var found = _.find(variants, function(variant) {
                return selectedValues.every(function(values) {
                    return _.isEqual(variant[values.index], values.value);
                });
            });

            return found;
        },

        /**
         * Event handler for when a variant input changes.
         */
        _onSelectChange: function() {
            var variant = this._getVariantFromOptions();

            this.$container.trigger({
                type: 'variantChange',
                variant: variant
            });

            if (!variant) {
                return;
            }

            this._updateMasterSelect(variant);
            this._updateImages(variant);
            this._updatePrice(variant);
            this._updateSKU(variant);
            this.currentVariant = variant;

            if (this.enableHistoryState) {
                this._updateHistoryState(variant);
            }
        },

        /**
         * Trigger event when variant image changes
         *
         * @param  {object} variant - Currently selected variant
         * @return {event}  variantImageChange
         */
        _updateImages: function(variant) {
            var variantImage = variant.featured_image || {};
            var currentVariantImage = this.currentVariant.featured_image || {};

            if (!variant.featured_image ||
                variantImage.src === currentVariantImage.src
            ) {
                return;
            }

            this.$container.trigger({
                type: 'variantImageChange',
                variant: variant
            });
        },

        /**
         * Trigger event when variant price changes.
         *
         * @param  {object} variant - Currently selected variant
         * @return {event} variantPriceChange
         */
        _updatePrice: function(variant) {
            if (
                variant.price === this.currentVariant.price &&
                variant.compare_at_price === this.currentVariant.compare_at_price
            ) {
                return;
            }

            this.$container.trigger({
                type: 'variantPriceChange',
                variant: variant
            });
        },

        /**
         * Trigger event when variant sku changes.
         *
         * @param  {object} variant - Currently selected variant
         * @return {event} variantSKUChange
         */
        _updateSKU: function(variant) {
            if (variant.sku === this.currentVariant.sku) {
                return;
            }

            this.$container.trigger({
                type: 'variantSKUChange',
                variant: variant
            });
        },

        /**
         * Update history state for product deeplinking
         *
         * @param  {variant} variant - Currently selected variant
         * @return {k}         [description]
         */
        _updateHistoryState: function(variant) {
            if (!history.replaceState || !variant) {
                return;
            }

            var newurl =
                window.location.protocol +
                '//' +
                window.location.host +
                window.location.pathname +
                '?variant=' +
                variant.id;
            window.history.replaceState({ path: newurl }, '', newurl);
        },

        /**
         * Update hidden master select of variant change
         *
         * @param  {variant} variant - Currently selected variant
         */
        _updateMasterSelect: function(variant) {
            $(this.originalSelectorId, this.$container).val(variant.id);
        }
    });

    return Variants;
})();


/*================ MODULES ================*/
window.Drawers = (function() {
    var Drawer = function(id, position, options) {
        var defaults = {
            close: '.js-drawer-close',
            open: '.js-drawer-open-' + position,
            openClass: 'js-drawer-open',
            dirOpenClass: 'js-drawer-open-' + position
        };

        this.nodes = {
            $parent: $('body, html'),
            $page: $('.page-element'),
            $moved: $('.is-moved-by-drawer')
        };

        this.config = $.extend(defaults, options);
        this.position = position;

        this.$drawer = $('#' + id);
        this.$open = $(this.config.open);

        if (!this.$drawer.length) {
            return false;
        }

        this.drawerIsOpen = false;
        this.init();
    };

    Drawer.prototype.init = function() {
        this.$open.attr('aria-expanded', 'false');
        this.$open.on('click', $.proxy(this.open, this));
        this.$drawer.find(this.config.close).on('click', $.proxy(this.close, this));
    };

    Drawer.prototype.open = function(evt) {
        // Keep track if drawer was opened from a click, or called by another function
        var externalCall = false;

        // don't open an opened drawer
        if (this.drawerIsOpen) {
            return;
        }

        this.$open.addClass(this.config.openClass);

        // Prevent following href if link is clicked
        if (evt) {
            evt.preventDefault();
        } else {
            externalCall = true;
        }

        // Without this, the drawer opens, the click event bubbles up to $nodes.page
        // which closes the drawer.
        if (evt && evt.stopPropagation) {
            evt.stopPropagation();
            // save the source of the click, we'll focus to this on close
            this.$activeSource = $(evt.currentTarget);
        }

        if (this.drawerIsOpen && !externalCall) {
            return this.close();
        }

        // Add is-transitioning class to moved elements on open so drawer can have
        // transition for close animation
        this.nodes.$moved.addClass('is-transitioning');
        this.$drawer.prepareTransition();

        this.nodes.$parent.addClass(
            this.config.openClass + ' ' + this.config.dirOpenClass
        );
        this.drawerIsOpen = true;

        // Set focus on drawer
        slate.a11y.trapFocus({
            $container: this.$drawer,
            namespace: 'drawer_focus'
        });

        // Run function when draw opens if set
        if (
            this.config.onDrawerOpen &&
            typeof this.config.onDrawerOpen === 'function'
        ) {
            if (!externalCall) {
                this.config.onDrawerOpen();
            }
        }

        if (this.$activeSource && this.$activeSource.attr('aria-expanded')) {
            this.$activeSource.attr('aria-expanded', 'true');
        }

        this.bindEvents();
    };

    Drawer.prototype.close = function() {
        // don't close a closed drawer
        if (!this.drawerIsOpen) {
            return;
        }

        this.$open.removeClass(this.config.openClass);

        // deselect any focused form elements
        $(document.activeElement).trigger('blur');

        // Ensure closing transition is applied to moved elements, like the nav
        this.nodes.$moved.prepareTransition({ disableExisting: true });
        this.$drawer.prepareTransition({ disableExisting: true });

        this.nodes.$parent.removeClass(
            this.config.dirOpenClass + ' ' + this.config.openClass
        );

        this.drawerIsOpen = false;

        // Remove focus on drawer
        slate.a11y.removeTrapFocus({
            $container: this.$drawer,
            namespace: 'drawer_focus'
        });

        if (this.$activeSource && this.$activeSource.attr('aria-expanded')) {
            this.$activeSource.attr('aria-expanded', 'false');
        }

        this.unbindEvents();
    };

    Drawer.prototype.bindEvents = function() {
        // Lock scrolling on mobile
        this.nodes.$page.on('touchmove.drawer', function() {
            return false;
        });

        // Clicking out of drawer closes it
        this.nodes.$page.on(
            'click.drawer',
            $.proxy(function() {
                this.close();
                return false;
            }, this)
        );

        // Pressing escape closes drawer
        this.nodes.$parent.on(
            'keyup.drawer',
            $.proxy(function(evt) {
                if (evt.keyCode === 27) {
                    this.close();
                }
            }, this)
        );
    };

    Drawer.prototype.unbindEvents = function() {
        this.nodes.$page.off('.drawer');
        this.nodes.$parent.off('.drawer');
    };

    return Drawer;
})();

window.Modals = (function() {
    var Modal = function(id, name, options) {
        var defaults = {
            close: '.js-modal-close',
            open: '.js-modal-open-' + name,
            openClass: 'modal--is-active'
        };

        this.$modal = $('#' + id);

        if (!this.$modal.length) {
            return false;
        }

        this.nodes = {
            $body: $('body')
        };

        this.config = $.extend(defaults, options);

        this.modalIsOpen = false;
        this.$focusOnOpen = this.config.focusOnOpen ?
            $(this.config.focusOnOpen) :
            this.$modal;
        this.init();
    };

    Modal.prototype.init = function() {
        var $openBtn = $(this.config.open);

        // Add aria controls
        $openBtn.attr('aria-expanded', 'false');

        $(this.config.open).on('click', $.proxy(this.open, this));
        this.$modal.find(this.config.close).on('click', $.proxy(this.close, this));
    };

    Modal.prototype.open = function(evt) {
        // Keep track if modal was opened from a click, or called by another function
        var externalCall = false;

        // don't open an opened modal
        if (this.modalIsOpen) {
            return;
        }

        // Prevent following href if link is clicked
        if (evt) {
            evt.preventDefault();
        } else {
            externalCall = true;
        }

        // Without this, the modal opens, the click event bubbles up to $nodes.page
        // which closes the modal.
        if (evt && evt.stopPropagation) {
            evt.stopPropagation();
            // save the source of the click, we'll focus to this on close
            this.$activeSource = $(evt.currentTarget);
        }

        if (this.modalIsOpen && !externalCall) {
            return this.close();
        }

        this.$modal.prepareTransition().addClass(this.config.openClass);
        this.nodes.$body.addClass(this.config.openClass);

        this.modalIsOpen = true;

        // Set focus on modal
        slate.a11y.trapFocus({
            $container: this.$modal,
            namespace: 'modal_focus',
            $elementToFocus: this.$focusOnOpen
        });

        if (this.$activeSource && this.$activeSource.attr('aria-expanded')) {
            this.$activeSource.attr('aria-expanded', 'true');
        }

        this.bindEvents();
    };

    Modal.prototype.close = function() {
        // don't close a closed modal
        if (!this.modalIsOpen) {
            return;
        }

        // deselect any focused form elements
        $(document.activeElement).trigger('blur');

        this.$modal.prepareTransition().removeClass(this.config.openClass);
        this.nodes.$body.removeClass(this.config.openClass);

        this.modalIsOpen = false;

        // Remove focus on modal
        slate.a11y.removeTrapFocus({
            $container: this.$modal,
            namespace: 'modal_focus'
        });

        if (this.$activeSource && this.$activeSource.attr('aria-expanded')) {
            this.$activeSource.attr('aria-expanded', 'false').focus();
        }

        this.unbindEvents();
    };

    Modal.prototype.bindEvents = function() {
        // Pressing escape closes modal
        this.nodes.$body.on(
            'keyup.modal',
            $.proxy(function(evt) {
                if (evt.keyCode === 27) {
                    this.close();
                }
            }, this)
        );
    };

    Modal.prototype.unbindEvents = function() {
        this.nodes.$body.off('.modal');
    };

    return Modal;
})();

window.QtySelector = (function() {
    var QtySelector = function($el) {
        this.cache = {
            $body: $('body'),
            $subtotal: $('#CartSubtotal'),
            $discountTotal: $('#cartDiscountTotal'),
            $cartTable: $('.cart-table'),
            $cartTemplate: $('#CartProducts')
        };

        this.settings = {
            loadingClass: 'js-qty--is-loading',
            isCartTemplate: this.cache.$body.hasClass('template-cart'),
            // On the cart template, minimum is 0. Elsewhere min is 1
            minQty: this.cache.$body.hasClass('template-cart') ? 0 : 1
        };

        this.$el = $el;
        this.qtyUpdateTimeout;
        this.createInputs();
        this.bindEvents();
    };

    QtySelector.prototype.createInputs = function() {
        var $el = this.$el;

        var data = {
            value: $el.val(),
            key: $el.attr('id'),
            name: $el.attr('name'),
            line: $el.attr('data-line')
        };
        var source = $('#QuantityTemplate').html();
        var template = Handlebars.compile(source);

        this.$wrapper = $(template(data)).insertBefore($el);

        // Remove original number input
        $el.remove();
    };

    QtySelector.prototype.validateAvailability = function(line, quantity) {
        var product = theme.cartObject.items[line - 1]; // 0-based index in API
        var handle = product.handle; // needed for the ajax request
        var id = product.id; // needed to find right variant from ajax results

        var params = {
            type: 'GET',
            url: '/products/' + handle + '.js',
            dataType: 'json',
            success: $.proxy(function(cartProduct) {
                this.validateAvailabilityCallback(line, quantity, id, cartProduct);
            }, this)
        };

        $.ajax(params);
    };

    QtySelector.prototype.validateAvailabilityCallback = function(
        line,
        quantity,
        id,
        product
    ) {
        var quantityIsAvailable = true;

        // This returns all variants of a product.
        // Loop through them to get our desired one.
        for (var i = 0; i < product.variants.length; i++) {
            var variant = product.variants[i];
            if (variant.id === id) {
                break;
            }
        }

        // If the variant tracks inventory and does not sell when sold out
        // we can compare the requested with available quantity
        if (
            variant.inventory_management !== null &&
            variant.inventory_policy === 'deny'
        ) {
            if (variant.inventory_quantity < quantity) {

                // Set quantity to max amount available
                this.$wrapper.find('.js-qty__input').val(variant.inventory_quantity);

                quantityIsAvailable = false;
                this.$wrapper.removeClass(this.settings.loadingClass);
            }
        }

        if (quantityIsAvailable) {
            this.updateItemQuantity(line, quantity);
        }
    };

    QtySelector.prototype.validateQty = function(qty) {
        if (parseFloat(qty) === parseInt(qty, 10) && !isNaN(qty)) {
            // We have a valid number!
        } else {
            // Not a number. Default to 1.
            qty = 1;
        }
        return parseInt(qty, 10);
    };

    QtySelector.prototype.adjustQty = function(evt) {
        var $el = $(evt.currentTarget);
        var $input = $el.siblings('.js-qty__input');
        var qty = this.validateQty($input.val());
        var line = $input.attr('data-line');

        if ($el.hasClass('js-qty__adjust--minus')) {
            qty -= 1;
            if (qty <= this.settings.minQty) {
                qty = this.settings.minQty;
            }
        } else {
            qty += 1;
        }

        if (this.settings.isCartTemplate) {
            $el.parent().addClass(this.settings.loadingClass);
            this.updateCartItemPrice(line, qty);
        } else {
            $input.val(qty);
        }
    };

    QtySelector.prototype.bindEvents = function() {
        this.$wrapper
            .find('.js-qty__adjust')
            .on('click', $.proxy(this.adjustQty, this));

        // Select input text on click
        this.$wrapper.on('click', '.js-qty__input', function() {
            this.setSelectionRange(0, this.value.length);
        });

        // If the quantity changes on the cart template, update the price
        if (this.settings.isCartTemplate) {
            this.$wrapper.on(
                'change',
                '.js-qty__input',
                $.proxy(function(evt) {
                    var $input = $(evt.currentTarget);
                    var line = $input.attr('data-line');
                    var qty = this.validateQty($input.val());
                    $input.parent().addClass(this.settings.loadingClass);
                    this.updateCartItemPrice(line, qty);
                }, this)
            );
        }
    };

    QtySelector.prototype.updateCartItemPrice = function(line, qty) {
        // Update cart after short timeout so user doesn't create simultaneous ajax calls
        clearTimeout(this.qtyUpdateTimeout);
        this.qtyUpdateTimeout = setTimeout(
            $.proxy(function() {
                this.validateAvailability(line, qty);
            }, this),
            200
        );
    };

    QtySelector.prototype.updateItemQuantity = function(line, quantity) {
        var params = {
            type: 'POST',
            url: '/cart/change.js',
            data: 'quantity=' + quantity + '&line=' + line,
            dataType: 'json',
            success: $.proxy(function(cart) {
                this.updateCartItemCallback(cart);
            }, this)
        };

        $.ajax(params);
    };

    QtySelector.prototype.updateCartItemCallback = function(cart) {
        // Reload the page to show the empty cart if no items
        if (cart.item_count === 0) {
            location.reload();
            return;
        }

        // Update cart object
        theme.cartObject = cart;

        // Handlebars.js cart layout
        var data = {};
        var items = [];
        var item = {};
        var source = $('#CartProductTemplate').html();
        var template = Handlebars.compile(source);
        var prodImg;

        // Add each item to our handlebars.js data
        $.each(cart.items, function(index, cartItem) {
            /* Hack to get product image thumbnail
             *   - If image is not null
             *     - Remove file extension, add 240x240, and re-add extension
             *     - Create server relative link
             *   - A hard-coded url of no-image
             */

            if (cartItem.image === null) {
                prodImg =
                    '//cdn.shopify.com/s/assets/admin/no-image-medium-cc9732cb976dd349a0df1d39816fbcc7.gif';
            } else {
                prodImg = cartItem.image
                    .replace(/(\.[^.]*)$/, '_240x240$1')
                    .replace('http:', '');
            }

            if (cartItem.properties !== null) {
                $.each(cartItem.properties, function(key, value) {
                    if (key.charAt(0) === '_' || !value) {
                        delete cartItem.properties[key];
                    }
                });
            }

            // Create item's data object and add to 'items' array
            item = {
                key: cartItem.key,
                line: index + 1, // Shopify uses a 1+ index in the API
                url: cartItem.url,
                img: prodImg,
                name: cartItem.product_title,
                variation: cartItem.variant_title,
                properties: cartItem.properties,
                itemQty: cartItem.quantity,
                price: theme.Currency.formatMoney(cartItem.price, theme.moneyFormat),
                vendor: cartItem.vendor,
                linePrice: theme.Currency.formatMoney(
                    cartItem.line_price,
                    theme.moneyFormat
                ),
                originalLinePrice: theme.Currency.formatMoney(
                    cartItem.original_line_price,
                    theme.moneyFormat
                ),
                discounts: cartItem.discounts,
                discountsApplied: cartItem.line_price === cartItem.original_line_price ? false : true
            };

            items.push(item);
            theme.updateCurrencies();
        });

        // Gather all cart data and add to DOM
        data = {
            items: items
        };
        this.cache.$cartTemplate.empty().append(template(data));

        // Create new quantity selectors
        this.cache.$cartTable.find('input[type="number"]').each(function(i, el) {
            new QtySelector($(el));
        });

        // Update the cart subtotal
        this.cache.$subtotal.html(
            theme.Currency.formatMoney(cart.total_price, theme.moneyFormat)
        );

        // Update the cart total discounts
        if (cart.total_discount > 0) {
            this.cache.$discountTotal.html(
                theme.strings.totalCartDiscount.replace(
                    '[savings]',
                    theme.Currency.formatMoney(cart.total_discount, theme.moneyFormat)
                )
            );
        } else {
            this.cache.$discountTotal.empty();
        }

        theme.miniCart.updateElements();
        theme.updateCurrencies();
        // Set focus on cart table
        slate.a11y.pageLinkFocus(this.cache.$cartTable);
    };

    return QtySelector;
})();

/*
  Allow product to be added to cart via ajax with
  custom success and error responses.
*/
window.AjaxCart = (function() {
    var styleCart = $('.js-mini-cart').attr("data-cartmini");
    var cart = function($form) {
        this.cache = {
            $cartIconIndicator: $('.site-header__cart-indicator')
        };

        this.$form = $form;
        this.eventListeners();

        this.showNotice = false;
        if (this.$form.length) {
            this.showNotice = this.$form.hasClass('js-form--notice') ? true : false;
        }
    };

    cart.prototype.eventListeners = function() {
        if (this.$form.length) {
            this.$form.on('submit', $.proxy(this.addItemFromForm, this));
        }
    };

    cart.prototype.addItemFromForm = function(evt) {
        evt.preventDefault();

        var params = {
            type: 'POST',
            url: '/cart/add.js',
            data: this.$form.serialize(),
            dataType: 'json',
            success: $.proxy(function(lineItem) {
                //this.success(lineItem);
                window.location.href = '/cart';
            }, this),
            error: $.proxy(function(XMLHttpRequest, textStatus) {
                this.error(XMLHttpRequest, textStatus);
            }, this)
        };
        $.ajax(params);
    };

    cart.prototype.success = function(item) {
        theme.miniCart.updateElements();
        theme.miniCart.generateCart();
        if (styleCart != 'false') {
            if (this.showNotice) {
                var htmlVariant = item.variant_title !== null ? '<i>(' + item.variant_title + ')</i>' : '';
                var htmlAlert = '<div class="media mt-2 alert--cart"><a class="mr-3" href="/cart"><img class="lazyload" data-src="' + item.image + '"></a><div class="media-body align-self-center"><p class="m-0 font-weight-bold">' + item.product_title + ' x ' + item.quantity + '</p>' + htmlVariant + '<div><div>';
                theme.alert.new(theme.strings.addToCartSuccess, htmlAlert, 3000, 'notice');
            } else {
                theme.crosssell.showPopup(item);
            }
        }
    };

    // Error handling reference from Shopify.onError in api.jquery.js
    cart.prototype.error = function(XMLHttpRequest) {
        var data = JSON.parse(XMLHttpRequest.responseText);

        if (data.message) {
            theme.alert.new('', data.description, 3000, 'warning');
        }
    };

    return cart;
})();

/*================ TEMPLATES ================*/
theme.customerTemplates = (function() {
    function initEventListeners() {
        // Show reset password form
        $('#RecoverPassword').on('click', function(evt) {
            evt.preventDefault();
            toggleRecoverPasswordForm();
        });

        // Hide reset password form
        $('#HideRecoverPasswordLink').on('click', function(evt) {
            evt.preventDefault();
            toggleRecoverPasswordForm();
        });
    }

    /**
     *
     *  Show/Hide recover password form
     *
     */
    function toggleRecoverPasswordForm() {
        $('#RecoverPasswordForm').toggleClass('hide');
        $('#CustomerLoginForm').toggleClass('hide');
    }

    /**
     *
     *  Show reset password success message
     *
     */
    function resetPasswordSuccess() {
        // check if reset password form was successfully submited
        if (!$('.reset-password-success').length) {
            return;
        }

        // show success message
        $('#ResetSuccess').removeClass('hide');
    }

    /**
     *
     *  Show/hide customer address forms
     *
     */
    function customerAddressForm() {
        var $newAddressForm = $('#AddressNewForm');

        if (!$newAddressForm.length) {
            return;
        }

        // Initialize observers on address selectors, defined in shopify_common.js
        if (Shopify) {
            // eslint-disable-next-line no-new
            new Shopify.CountryProvinceSelector(
                'AddressCountryNew',
                'AddressProvinceNew', {
                    hideElement: 'AddressProvinceContainerNew'
                }
            );
        }

        // Initialize each edit form's country/province selector
        $('.address-country-option').each(function() {
            var formId = $(this).data('form-id');
            var countrySelector = 'AddressCountry_' + formId;
            var provinceSelector = 'AddressProvince_' + formId;
            var containerSelector = 'AddressProvinceContainer_' + formId;

            // eslint-disable-next-line no-new
            new Shopify.CountryProvinceSelector(countrySelector, provinceSelector, {
                hideElement: containerSelector
            });
        });

        // Toggle new/edit address forms
        $('.address-new-toggle').on('click', function() {
            $newAddressForm.toggleClass('hide');
        });

        $('.address-edit-toggle').on('click', function() {
            var formId = $(this).data('form-id');
            $('#EditAddress_' + formId).toggleClass('hide');
        });

        $('.address-delete').on('click', function() {
            var $el = $(this);
            var formId = $el.data('form-id');
            var confirmMessage = $el.data('confirm-message');

            // eslint-disable-next-line no-alert
            if (
                confirm(
                    confirmMessage || 'Are you sure you wish to delete this address?'
                )
            ) {
                Shopify.postLink('/account/addresses/' + formId, {
                    parameters: { _method: 'delete' }
                });
            }
        });
    }

    /**
     *
     *  Check URL for reset password hash
     *
     */
    function checkUrlHash() {
        var hash = window.location.hash;

        // Allow deep linking to recover password form
        if (hash === '#recover') {
            toggleRecoverPasswordForm();
        }
    }

    return {
        init: function() {
            checkUrlHash();
            initEventListeners();
            resetPasswordSuccess();
            customerAddressForm();
        }
    };
})();

/*================ SECTIONS ================*/
theme.HeaderSection = (function() {
    function Header() {
        theme.NavDrawer = new window.Drawers('NavDrawer', 'left');
    }

    return Header;
})();

theme.Product = (function() {
    var defaults = {
        smallBreakpoint: 750,
        productThumbIndex: 0,
        productThumbMax: 0,
        ajaxCart: false,
        stockSetting: false
    };

    function Product(container) {
        var $container = (this.$container = $(container));
        var sectionId = $container.attr('data-section-id');

        this.selectors = {
            originalSelectorId: '#ProductSelect-' + sectionId,
            modal: 'ProductModal',
            productZoomImage: '#ProductZoomImg',
            addToCart: '#AddToCart-' + sectionId,
            productPrice: '#ProductPrice-' + sectionId,
            comparePrice: '#ComparePrice-' + sectionId,
            addToCartText: '#AddToCartText-' + sectionId,
            SKU: '.js-variant-sku',
            productImageContainers: '.product__photo-container-' + sectionId,
            productImageWrappers: '.product__photo-wrapper-' + sectionId,
            productThumbContainers: '.product-single__thumbnail-item-' + sectionId,
            productThumbsWrapper: '.product-single__thumbnails-' + sectionId,
            productThumbs: '.product-single__thumbnail-' + sectionId,
            saleTag: '#ProductSaleTag-' + sectionId,
            productStock: '#ProductStock-' + sectionId,
            singleOptionSelector: '.single-option-selector-' + sectionId,
            shopifyPaymentButton: '.shopify-payment-button',
            availability: '.product-single__availability',
            hurrify: '.js-hurrify'
        };

        this.settings = $.extend({}, defaults, {
            sectionId: sectionId,
            ajaxCart: $container.data('ajax'),
            stockSetting: $container.data('stock'),
            enableHistoryState: $container.data('enable-history-state') || false,
            namespace: '.product-' + sectionId
        });

        // Stop parsing if we don't have the product json script tag
        if (!$('#ProductJson-' + sectionId).html()) {
            return;
        }

        this.productSingleObject = JSON.parse(
            $('#ProductJson-' + sectionId).html()
        );
        this.addVariantInfo();

        this.init();
    }

    Product.prototype = _.assignIn({}, Product.prototype, {
        init: function() {
            this._stringOverrides();
            this._initVariants();
            this._productZoomImage();
            this._productThumbSwitch();
            this._productThumbnailSlider();
            this._initQtySelector();

            if (this.settings.ajaxCart) {
                theme.AjaxCart = new window.AjaxCart(
                    $('#AddToCartForm-' + this.settings.sectionId)
                );
            }
        },

        _stringOverrides: function() {
            window.productStrings = window.productStrings || {};
            $.extend(theme.strings, window.productStrings);
        },

        addVariantInfo: function() {
            if (!this.productSingleObject || !this.settings.stockSetting) {
                return;
            }

            var variantInfo = JSON.parse(
                $('#VariantJson-' + this.settings.sectionId).html()
            );

            for (var i = 0; i < variantInfo.length; i++) {
                $.extend(this.productSingleObject.variants[i], variantInfo[i]);
            }
        },

        _initVariants: function() {
            var options = {
                $container: this.$container,
                enableHistoryState: this.settings.enableHistoryState,
                product: this.productSingleObject,
                singleOptionSelector: this.selectors.singleOptionSelector,
                originalSelectorId: this.selectors.originalSelectorId
            };

            // eslint-disable-next-line no-new
            this.variants = new slate.Variants(options);

            this.$container.on(
                'variantChange' + this.settings.namespace,
                this._updateAddToCartBtn.bind(this)
            );
            this.$container.on(
                'variantChange' + this.settings.namespace,
                this._updateStickyCart.bind(this)
            );
            this.$container.on(
                'variantPriceChange' + this.settings.namespace,
                this._updatePrice.bind(this)
            );
            this.$container.on(
                'variantSKUChange' + this.settings.namespace,
                this._updateSKU.bind(this)
            );
            this.$container.on(
                'variantImageChange' + this.settings.namespace,
                this._updateImages.bind(this)
            );
        },

        _updateStock: function(variant) {
            if (!this.settings.stockSetting) return;

            var $stock = $(this.selectors.productStock),
                $hurrify = $(this.selectors.hurrify);

            // If we don't track variant inventory, hide stock
            if (!variant || !variant.inventory_management) {
                $stock.addClass('hide');
                $hurrify.addClass('hide');
                return;
            }

            if (variant.inventory_quantity < 10 && variant.inventory_quantity > 0) {
                $stock
                    .html(
                        theme.strings.stockAvailable.replace(
                            '1',
                            variant.inventory_quantity
                        )
                    )
                    .removeClass('hide');
                $hurrify.removeClass('hide').find('.progress-bar').css('width', variant.inventory_quantity * 10 + '%');
                return;
            }

            if (variant.inventory_quantity <= 0 && variant.incoming) {
                $stock
                    .html(
                        theme.strings.willNotShipUntil.replace(
                            '[date]',
                            variant.next_incoming_date
                        )
                    )
                    .removeClass('hide');
                $hurrify.addClass('hide');
                return;
            }

            // If there's more than 10 available, hide stock
            $stock.addClass('hide');
            $hurrify.addClass('hide');
        },

        _updateIncomingInfo: function(variant) {
            if (!this.settings.stockSetting) return;

            var $stock = $(this.selectors.productStock);

            if (variant.incoming) {
                $stock
                    .html(
                        theme.strings.willBeInStockAfter.replace(
                            '[date]',
                            variant.next_incoming_date
                        )
                    )
                    .removeClass('hide');
                return;
            }

            // If there is no stock incoming, hide stock
            $stock.addClass('hide');
        },

        _updateAddToCartBtn: function(evt) {
            var variant = evt.variant;

            var cache = {
                $addToCart: $(this.selectors.addToCart),
                $addToCartText: $(this.selectors.addToCartText)
            };

            if (variant) {
                // Select a valid variant if available
                theme.noticeSoldout.init(variant);
                if (variant.available) {
                    // We have a valid product variant, so enable the submit button
                    cache.$addToCart.removeClass('btn--sold-out').prop('disabled', false);
                    cache.$addToCartText.html(theme.strings.addToCart);
                    $(this.selectors.shopifyPaymentButton, this.$container).show();
                    // Show how many items are left, if below 10
                    this._updateStock(variant);
                    //update availability - available
                    $(this.selectors.availability).find('span').text(theme.strings.available);
                } else {
                    // Variant is sold out, disable the submit button
                    cache.$addToCart.prop('disabled', true).addClass('btn--sold-out');
                    cache.$addToCartText.html(theme.strings.soldOut);
                    $(this.selectors.shopifyPaymentButton, this.$container).hide();
                    // Update when stock will be available
                    this._updateIncomingInfo(variant);
                    //update availability - soldout
                    $(this.selectors.availability).find('span').text(theme.strings.soldOut);
                }
            } else {
                cache.$addToCart.prop('disabled', true).removeClass('btn--sold-out');
                cache.$addToCartText.html(theme.strings.unavailable);
                //update availability - unavailable
                $(this.selectors.availability).find('span').text(theme.strings.unavailable);
                $(this.selectors.shopifyPaymentButton, this.$container).hide();
                // Hide stock display
                this._updateStock();
            }
        },

        _updatePrice: function(evt) {
            var variant = evt.variant;

            if (variant) {
                $(this.selectors.productPrice).html(
                    theme.Currency.formatMoney(variant.price, theme.moneyFormat)
                );

                // Update and show the product's compare price if necessary
                if (variant.compare_at_price > variant.price) {
                    $(this.selectors.comparePrice)
                        .html(
                            theme.Currency.formatMoney(
                                variant.compare_at_price,
                                theme.moneyFormat
                            )
                        )
                        .removeClass('hide');
                    $(this.selectors.saleTag).removeClass('hide');
                } else {
                    $(this.selectors.comparePrice).addClass('hide');
                    $(this.selectors.saleTag).addClass('hide');
                }

                theme.updateCurrencies();
            } else {
                $(this.selectors.comparePrice).addClass('hide');
            }
        },

        _updateSKU: function(evt) {
            var variant = evt.variant;

            if (variant) {
                $(this.selectors.SKU).html(variant.sku);
            }
        },

        _updateImages: function(evt) {
            var variant = evt.variant;

            if (variant && variant.featured_image) {
                var imageId = variant.featured_image.id;
                this.switchProductImage(imageId);
                this.setActiveThumbnail(imageId);
            }
        },
        _updateStickyCart: function(evt) {
            var variant = evt.variant,
                $stickyPrice = $('#js-sticky-price'),
                $stickyTitle = $('#js-sticky-title'),
                $stickyImage = $('#js-sticky-img'),
                $stickyButton = $('#js-sticky-btn');
            if (variant) {
                //update title
                $stickyTitle.html(' - ' + variant.title);
                //update price
                $stickyPrice.html(theme.Currency.formatMoney(variant.price, theme.moneyFormat));
                //update selectbox
                for (var i = 1; i <= 3; i++) {
                    var option = 'option' + i,
                        $selecBox = '#js-sticky-option-' + i;
                    if (variant[option] !== null) {
                        var valueOption = variant[option];
                        $($selecBox).val(valueOption);
                    }
                }
                //update button cart
                if (variant.available) {
                    $stickyButton.prop('disabled', false).removeClass('btn--sold-out');
                    $stickyButton.html(theme.strings.addToCart);
                } else {
                    $stickyButton.prop('disabled', true).addClass('btn--sold-out');
                    $stickyButton.html(theme.strings.soldOut);
                }
                //update image
                if (variant.featured_image) {
                    $stickyImage.attr('src', theme.Images.getSizedImageUrl(variant.featured_image.src, '200x'));
                }
            } else {
                //update title
                $stickyTitle.html(' - ' + theme.strings.unavailable);
                //update button cart
                $stickyButton.prop('disabled', true).removeClass('btn--sold-out');
                $stickyButton.html(theme.strings.unavailable);
            }
        },

        switchProductImage: function(imageId) {
            var $imageToShow = $(
                this.selectors.productImageContainers +
                "[data-image-id='" +
                imageId +
                "']",
                this.$container
            );
            var $imagesToHide = $(
                this.selectors.productImageContainers +
                ":not([data-image-id='" +
                imageId +
                "'])",
                this.$container
            );
            $imagesToHide.addClass('hide');
            $imageToShow.removeClass('hide');
            //Scroll to active
            topMenuHeight = $('.site-header').outerHeight();
            if (this.settings.sectionId === 'product-template-8') {
                $([document.documentElement, document.body]).animate({
                    scrollTop: $imageToShow.offset().top - topMenuHeight
                }, 500);
            }
        },

        setActiveThumbnail: function(imageId) {
            var $thumbnailToShow = $(
                this.selectors.productThumbContainers +
                "[data-image-id='" +
                imageId +
                "']",
                this.$container
            );
            var $thumbnailsToHide = $(
                this.selectors.productThumbContainers +
                ":not([data-image-id='" +
                imageId +
                "'])",
                this.$container
            );
            $thumbnailsToHide.removeClass('is-active');
            $thumbnailToShow.addClass('is-active');
            $thumbnailToShow.trigger('click');
            var $thumbnails = $(this.selectors.productThumbsWrapper, this.$container);

            // If there is a slick carousel, get the slide index, and position it into view with animation.
            if ($thumbnails.hasClass('slick-initialized')) {
                // eslint-disable-next-line shopify/jquery-dollar-sign-reference
                var currentActiveSlideIndex = $thumbnails.slick('slickCurrentSlide');
                var newActiveSlideIndex = parseInt(
                    $thumbnailToShow.attr('data-slick-index')
                );
                if (currentActiveSlideIndex !== newActiveSlideIndex) {
                    $thumbnails.slick('slickGoTo', newActiveSlideIndex, false);

                }
            }
        },

        _productZoomImage: function() {
            // The zoom image is only used on the product template, so return early
            // even if a featured product section is present.
            if (!$('.product-single ' + this.selectors.productImageContainers).length) {
                return;
            }

            var self = this;

            $(this.selectors.productImageWrappers).on(
                'click' + this.settings.namespace,
                function(evt) {
                    evt.preventDefault();
                    // Empty src before loadig new image to avoid awkward image swap
                    $(self.selectors.productZoomImage)
                        .attr('src', '')
                        .attr('src', $(this).attr('href'));
                }
            );

            this.ProductModal = new window.Modals(
                this.selectors.modal,
                'product-modal'
            );

            // Close modal if clicked, but not if the image is clicked
            this.ProductModal.$modal.on('click' + this.settings.namespace, function(
                evt
            ) {
                if (evt.target.nodeName !== 'IMG') {
                    self.ProductModal.close();
                }
            });
        },

        _productThumbSwitch: function() {
            if (!$(this.selectors.productThumbs).length) {
                return;
            }

            var self = this;

            $(this.selectors.productThumbs).on(
                'click' + this.settings.namespace,
                function(evt) {
                    evt.preventDefault();
                    var imageId = $(this)
                        .parent()
                        .data('image-id');
                    self.setActiveThumbnail(imageId);
                    self.switchProductImage(imageId);
                }
            );
            //trigger hover thumb
            // $(this.selectors.productThumbs).on('click',function(){
            //   $(this).trigger('click');
            // });
        },

        /*
          Thumbnail slider
         */
        _productThumbnailSlider: function() {
            var $productThumbsWrapper = $(this.selectors.productThumbsWrapper);
            var $productThumbs = $(this.selectors.productThumbs);
            if (!$productThumbs.length) {
                return;
            }

            if ($productThumbs.length > 1) {
                $productThumbsWrapper.on(
                    'init' + this.settings.namespace,
                    this._productSwipeInit.bind(this)
                );

                if (this.settings.sectionId === 'product-template-3' || this.settings.sectionId === 'product-template-4') {
                    $productThumbsWrapper.slick({
                        accessibility: false,
                        arrows: true,
                        dots: false,
                        infinite: false,
                        autoplay: false,
                        slidesToShow: 5,
                        slidesToScroll: 5,
                        vertical: true,
                        verticalSwiping: true,
                        responsive: [{
                            breakpoint: 992,
                            settings: {
                                vertical: false,
                                verticalSwiping: false,
                                slidesToShow: 4,
                                slidesToScroll: 4,
                                dots: false,
                            }
                        }]
                    }).css('opacity', '1');
                } else if (this.settings.sectionId === 'product-template-5') {
                    $productThumbsWrapper.slick({
                        accessibility: false,
                        arrows: true,
                        dots: false,
                        infinite: true,
                        autoplay: false,
                        slidesToShow: 2,
                        slidesToScroll: 1,
                        responsive: [{
                            breakpoint: 992,
                            settings: {
                                slidesToShow: 4,
                                slidesToScroll: 4,
                                dots: false,
                            }
                        }]
                    }).css('opacity', '1');
                } else if (this.settings.sectionId === 'product-template-7') {
                    $productThumbsWrapper.slick({
                        accessibility: false,
                        arrows: true,
                        dots: true,
                        infinite: true,
                        autoplay: false,
                        slidesToShow: 1,
                        slidesToScroll: 1,
                        responsive: [{
                            breakpoint: 992,
                            settings: {
                                slidesToShow: 1,
                                slidesToScroll: 1,
                                dots: false,
                                arrows: true,
                            }
                        }]
                    }).css('opacity', '1');
                } else if (this.settings.sectionId === 'product-template-8') {
                    var lastId,
                        topMenu = $(".product-single__thumbnails"),
                        topMenuHeight = $('.site-header').outerHeight() + 20,
                        // All list items
                        menuItems = topMenu.find(".product-single__thumbnail");


                    if ($(window).width() > 767) {
                        menuItems.click(function(e) {
                            var findid = $(this).attr('href');
                            offsetTop = $(findid).offset().top - topMenuHeight + 1;
                            $('html, body').stop().animate({
                                scrollTop: offsetTop
                            }, 200);
                            return false;
                        });
                        // Anchors corresponding to menu items
                        scrollItems = menuItems.map(function() {
                            var item = $($(this).attr('href'));
                            if (item.length) { return item; }
                        });

                        $(window).scroll(function() {
                            // Get container scroll position
                            var fromTop = $(this).scrollTop() + topMenuHeight;
                            // Get id of current scroll item
                            var cur = scrollItems.map(function() {
                                if ($(this).offset().top < fromTop)
                                    return this;
                            });
                            // Get the id of the current element
                            cur = cur[cur.length - 1];
                            var id = cur && cur.length ? cur[0].id : "";

                            if (lastId !== id) {
                                lastId = id;
                                // Set/remove active class
                                menuItems
                                    .parent().removeClass("is-active")
                                    .end().filter("[href='#" + id + "']").parent().addClass("is-active");
                            }
                        });
                    } else {
                        menuItems.click(function(e) {
                            var findid = $(this).attr('href');
                            offsetTop = $(findid).offset().top;
                            $('html, body').stop().animate({
                                scrollTop: offsetTop
                            });
                            return false;
                        });
                    }

                    $productThumbsWrapper.slick({
                        accessibility: false,
                        arrows: true,
                        dots: false,
                        infinite: false,
                        autoplay: false,
                        slidesToShow: 5,
                        slidesToScroll: 1,
                        vertical: true,
                        verticalSwiping: true,
                        responsive: [{
                            breakpoint: 992,
                            settings: {
                                vertical: false,
                                verticalSwiping: false,
                                slidesToShow: 4,
                                slidesToScroll: 4,
                                dots: true,
                            }
                        }]
                    }).css('opacity', '1');
                } else {
                    $productThumbsWrapper.slick({
                        accessibility: false,
                        arrows: true,
                        dots: false,
                        infinite: false,
                        autoplay: false,
                        slidesToShow: 4,
                        slidesToScroll: 4
                    }).css('opacity', '1');
                }

                // Show highlighted thumbnail by repositioning slider
                $productThumbsWrapper.slick(
                    'slickGoTo',
                    $productThumbsWrapper.find('.is-active').attr('data-slick-index'),
                    true
                );
            }
        },

        _productSwipeInit: function(evt, obj) {
            // Slider is initialized. Setup custom swipe events
            this.settings.productThumbIndex = obj.currentSlide;
            this.settings.productThumbMax = obj.slideCount - 1; // we need the 0-based index

            var self = this;

            $(this.selectors.productImageWrappers).on(
                'swipeleft swiperight',
                function(event) {
                    if (event.type === 'swipeleft') {
                        self._goToNextThumbnail();
                    }

                    if (event.type === 'swiperight') {
                        self._goToPrevThumbnail();
                    }

                    // Trigger click on newly requested thumbnail
                    $(
                            '.product-single__thumbnail-item[data-slick-index="' +
                            self.settings.productThumbIndex +
                            '"]'
                        )
                        .find('.product-single__thumbnail')
                        .trigger('click');

                }
            );
        },
        _goToNextThumbnail: function() {
            this.settings.productThumbIndex++;

            if (this.settings.productThumbIndex > this.settings.productThumbMax) {
                this.settings.productThumbIndex = 0;
            }

            $(this.selectors.productThumbsWrapper).slick(
                'slickGoTo',
                this.settings.productThumbIndex,
                true
            );
        },

        _goToPrevThumbnail: function() {
            this.settings.productThumbIndex--;

            if (this.settings.productThumbIndex < 0) {
                this.settings.productThumbIndex = this.settings.productThumbMax;
            }

            $(this.selectors.productThumbsWrapper).slick(
                'slickGoTo',
                this.settings.productThumbIndex,
                true
            );
        },

        _initQtySelector: function() {
            this.$container.find('.product-form__quantity').each(function(i, el) {
                // eslint-disable-next-line no-new
                new QtySelector($(el));
            });
        },

        onUnload: function() {
            $(this.selectors.productImageWrappers).off(this.settings.namespace);
            $(this.selectors.productThumbs).off(this.settings.namespace);
            $(this.selectors.productThumbs).slick('unslick');
            if (this.ProductModal) {
                this.ProductModal.$modal.off(this.settings.namespace);
            }
        }
    });

    return Product;
})();

theme.Slideshow = (function() {
    this.$slideshow = null;
    var classes = {
        slideshow: 'slideshow',
        slickActiveMobile: 'slick-active-mobile',
        controlsHover: 'slideshow__controls--hover',
        isPaused: 'is-paused'
    };

    var selectors = {
        section: '.shopify-section',
        wrapper: '#SlideshowWrapper-',
        slides: '.slideshow__slide',
        textWrapperMobile: '.slideshow__text-wrap--mobile',
        textContentMobile: '.slideshow__text-content--mobile',
        controls: '.slideshow__controls',
        dots: '.slick-dots',
        arrowLeft: '.slideshow__arrow-left',
        arrowRight: '.slideshow__arrow-right'
    };

    function slideshow(el, sectionId) {
        var $slideshow = (this.$slideshow = $(el));
        this.adaptHeight = this.$slideshow.data('adapt-height');
        this.$wrapper = this.$slideshow.closest(selectors.wrapper + sectionId);
        this.$section = this.$wrapper.closest(selectors.section);
        this.$controls = this.$wrapper.find(selectors.controls);
        this.$textWrapperMobile = this.$section.find(selectors.textWrapperMobile);
        this.autorotate = this.$slideshow.data('autorotate');
        var autoplaySpeed = this.$slideshow.data('speed');
        var loadSlideA11yString = this.$slideshow.data('slide-nav-a11y');

        this.settings = {
            rtl: theme.rtl,
            accessibility: true,
            arrows: true,
            dots: true,
            fade: (theme.rtl ? false : true),
            draggable: true,
            touchThreshold: 20,
            autoplay: this.autorotate,
            autoplaySpeed: autoplaySpeed
        };

        this.$slideshow.on('beforeChange', beforeChange.bind(this));
        this.$slideshow.on('init', slideshowA11ySetup.bind(this));

        // Add class to style mobile dots & show the correct text content for the
        // first slide on mobile when the slideshow initialises
        this.$slideshow.on(
            'init',
            function() {
                this.$mobileDots
                    .find('li:first-of-type')
                    .addClass(classes.slickActiveMobile);
                this.showMobileText(0);
            }.bind(this)
        );

        if (this.adaptHeight) {
            this.setSlideshowHeight();
            $(window).resize($.debounce(50, this.setSlideshowHeight.bind(this)));
        }

        this.$slideshow.slick(this.settings);

        // This can't be called when the slick 'init' event fires due to how slick
        // adds a11y features.
        slideshowPostInitA11ySetup.bind(this)();
    }

    function slideshowA11ySetup(event, obj) {
        var $slider = obj.$slider;
        var $list = obj.$list;
        this.$dots = this.$section.find(selectors.dots);
        this.$mobileDots = this.$dots.eq(1);

        // Remove default Slick aria-live attr until slider is focused
        $list.removeAttr('aria-live');

        //     this.$wrapper.on('keyup', keyboardNavigation.bind(this));
        //     this.$controls.on('keyup', keyboardNavigation.bind(this));
        //     this.$textWrapperMobile.on('keyup', keyboardNavigation.bind(this));

        // When an element in the slider is focused
        // pause slideshow and set aria-live.
        this.$wrapper
            .on(
                'focusin',
                function(evt) {
                    if (!this.$wrapper.has(evt.target).length) {
                        return;
                    }

                    $list.attr('aria-live', 'polite');
                    if (this.autorotate) {
                        $slider.slick('slickPause');
                    }
                }.bind(this)
            )
            .on(
                'focusout',
                function(evt) {
                    if (!this.$wrapper.has(evt.target).length) {
                        return;
                    }

                    $list.removeAttr('aria-live');
                }.bind(this)
            );

        // Add arrow key support when focused
        if (this.$dots) {
            this.$dots
                .find('a')
                .each(function() {
                    var $dot = $(this);
                    $dot.on('click keyup', function(evt) {
                        if (
                            evt.type === 'keyup' &&
                            evt.which !== slate.utils.keyboardKeys.ENTER
                        )
                            return;

                        evt.preventDefault();

                        var slideNumber = $(evt.target).data('slide-number');

                        $slider.attr('tabindex', -1).slick('slickGoTo', slideNumber);

                        if (evt.type === 'keyup') {
                            $slider.focus();
                        }
                    });
                })
                .eq(0)
                .attr('aria-current', 'true');
        }

        this.$controls
            .on('focusin', highlightControls.bind(this))
            .on('focusout', unhighlightControls.bind(this));
    }

    function slideshowPostInitA11ySetup() {
        var $slides = this.$slideshow.find(selectors.slides);

        $slides.removeAttr('role').removeAttr('aria-labelledby');
        this.$dots
            .removeAttr('role')
            .find('li')
            .removeAttr('role')
            .removeAttr('aria-selected')
            .each(function() {
                var $dot = $(this);
                var ariaControls = $dot.attr('aria-controls');
                $dot
                    .removeAttr('aria-controls')
                    .find('a')
                    .attr('aria-controls', ariaControls);
            });
    }

    function beforeChange(event, slick, currentSlide, nextSlide) {
        var $dotLinks = this.$dots.find('a');
        var $mobileDotLinks = this.$mobileDots.find('li');

        $dotLinks
            .removeAttr('aria-current')
            .eq(nextSlide)
            .attr('aria-current', 'true');

        $mobileDotLinks
            .removeClass(classes.slickActiveMobile)
            .eq(nextSlide)
            .addClass(classes.slickActiveMobile);
        this.showMobileText(nextSlide);
    }

    //   function keyboardNavigation() {
    //     if (event.keyCode === slate.utils.keyboardKeys.LEFTARROW) {
    //       this.$slideshow.slick('slickPrev');
    //     }
    //     if (event.keyCode === slate.utils.keyboardKeys.RIGHTARROW) {
    //       this.$slideshow.slick('slickNext');
    //     }
    //   }

    function highlightControls() {
        this.$controls.addClass(classes.controlsHover);
    }

    function unhighlightControls() {
        this.$controls.removeClass(classes.controlsHover);
    }

    slideshow.prototype.setSlideshowHeight = function() {
        var minAspectRatio = this.$slideshow.data('min-aspect-ratio');
        this.$slideshow.height($(document).width() / minAspectRatio);
    };

    slideshow.prototype.showMobileText = function(slideIndex) {
        var $allTextContent = this.$textWrapperMobile.find(
            selectors.textContentMobile
        );
        var currentTextContentSelector =
            selectors.textContentMobile + '-' + slideIndex;
        var $currentTextContent = this.$textWrapperMobile.find(
            currentTextContentSelector
        );
        if (!$currentTextContent.length &&
            this.$slideshow.find(selectors.slides).length === 1
        ) {
            this.$textWrapperMobile.hide();
        } else {
            this.$textWrapperMobile.show();
        }
        $allTextContent.hide();
        $currentTextContent.show();
    };

    function getSlideshowId($el) {
        return '#Slideshow-' + $el.data('id');
    }

    return slideshow;
})();

theme.slideshows = {};

theme.SlideshowSection = (function() {
    function SlideshowSection(container) {
        var $container = (this.$container = $(container));
        var sectionId = $container.attr('data-section-id');
        var slideshow = (this.slideshow = '#Slideshow-' + sectionId);

        theme.slideshows[slideshow] = new theme.Slideshow(slideshow, sectionId);
    }

    return SlideshowSection;
})();

theme.SlideshowSection.prototype = _.assignIn({},
    theme.SlideshowSection.prototype, {
        onUnload: function() {
            delete theme.slideshows[this.slideshow];
        },

        onBlockSelect: function(evt) {
            var $slideshow = $(this.slideshow);
            var adaptHeight = $slideshow.data('adapt-height');

            if (adaptHeight) {
                theme.slideshows[this.slideshow].setSlideshowHeight();
            }

            // Ignore the cloned version
            var $slide = $(
                '.slideshow__slide--' + evt.detail.blockId + ':not(.slick-cloned)'
            );
            var slideIndex = $slide.data('slick-index');

            // Go to selected slide, pause auto-rotate
            $slideshow.slick('slickGoTo', slideIndex).slick('slickPause');
        },

        onBlockDeselect: function() {
            // Resume auto-rotate
            $(this.slideshow).slick('slickPlay');
        }
    }
);

theme.slideshows = {};

theme.Cart = (function() {
    var selectors = {
        cartNote: '#CartSpecialInstructions',
        cartQtyInput: '.cart__quantity',
        cartNoCookiesClass: 'cart--no-cookies'
    };

    function Cart(container) {
        var $container = (this.$container = $(container));
        var sectionId = $container.attr('data-section-id');

        theme.cartObject = JSON.parse($('#CartJson-' + sectionId).html());

        this.init($container);
    }

    Cart.prototype = _.assignIn({}, Cart.prototype, {
        init: function($container) {
            this._initQtySelector();
            this._initCartNote();

            if (!this._cookiesEnabled()) {
                $container.addClass(selectors.cartNoCookiesClass);
            }
        },

        _initQtySelector: function() {
            $(selectors.cartQtyInput).each(function(i, el) {
                // eslint-disable-next-line no-new
                new QtySelector($(el));
            });
        },

        _initCartNote: function() {
            if (!$(selectors.cartNote).length) {
                return;
            }

            var $el = $(selectors.cartNote);
            var noteText;
            var params;
            var noteOffset = $el[0].offsetHeight - $el[0].clientHeight;

            // Auto grow the cart note if text fills it up
            $el.on('keyup input', function() {
                $(this)
                    .css('height', 'auto')
                    .css('height', $el[0].scrollHeight + noteOffset);
            });

            // Save the cart note via ajax. A safeguard in case
            // a user decides to leave the page before clicking 'Update Cart'
            $el.on(
                'change',
                $.proxy(function() {
                    noteText = $el.val();
                    params = {
                        type: 'POST',
                        url: '/cart/update.js',
                        data: 'note=' + this._attributeToString(noteText),
                        dataType: 'json'
                    };
                    $.ajax(params);
                }, this)
            );
        },

        _attributeToString: function(attr) {
            if (typeof attr !== 'string') {
                attr = String(attr);
                if (attr === 'undefined') {
                    attr = '';
                }
            }
            return $.trim(attr);
        },

        _cookiesEnabled: function() {
            var cookieEnabled = navigator.cookieEnabled;

            if (!cookieEnabled) {
                document.cookie = 'testcookie';
                cookieEnabled = document.cookie.indexOf('testcookie') !== -1;
            }
            return cookieEnabled;
        }
    });

    return Cart;
})();

// Instagrams
theme.Instagrams = (function() {
    function Instagrams(container) {
        this.$container = $(container).on('init', this._a11y.bind(this));
        //console.log(this.$container);
        this.settings = {
            style: this.$container.data('style'),
            accesstoken: this.$container.data('accesstoken'),
            userid: this.$container.data('userid'),
            limit: this.$container.data('limit'),
            resolution: this.$container.data('resolution'),
            target: this.$container.attr('id'),
            rows: this.$container.data('rows'),

            slidesToShow: this.$container.data('slidestoshow') || 1,
            infinite: this.$container.data('infinite') || false,
            arrows: this.$container.data('arrows') || false,
            draggable: this.$container.data('draggable') || false,
            dots: this.$container.data('dots') || false,
        }
        this.settings.slidesToShow1200 = (this.settings.slidesToShow - 1) > 1 ? (this.settings.slidesToShow - 1) : 1;
        this.settings.slidesToShow992 = (this.settings.slidesToShow - 2) > 1 ? (this.settings.slidesToShow - 2) : 1;
        this.settings.slidesToShow768 = (this.settings.slidesToShow - 3) > 1 ? (this.settings.slidesToShow - 3) : 1;
        this.settings.slidesToShow480 = 2;

        var _self = this;
        var $instagramSelector = $('#' + this.settings.target);
        if (this.settings.style === 'grid') {
            var afterInstagram = function() {} // blank function
        } else if (this.settings.style === 'carousel') {
            var afterInstagram = function() {
                $instagramSelector.slick({
                    slidesToShow: _self.settings.slidesToShow,
                    slidesToScroll: _self.settings.slidesToShow,
                    arrows: _self.settings.arrows,
                    dots: _self.settings.dots,
                    draggable: _self.settings.draggable,
                    infinite: _self.settings.infinite,
                    rows: _self.settings.rows,
                    responsive: [{
                            breakpoint: 1200,
                            settings: {
                                slidesToShow: _self.settings.slidesToShow1200,
                                slidesToScroll: _self.settings.slidesToShow1200,
                            }
                        },
                        {
                            breakpoint: 992,
                            settings: {
                                slidesToShow: _self.settings.slidesToShow992,
                                slidesToScroll: _self.settings.slidesToShow992,
                            }
                        },
                        {
                            breakpoint: 768,
                            settings: {
                                slidesToShow: _self.settings.slidesToShow768,
                                slidesToScroll: _self.settings.slidesToShow768,
                            }
                        },
                        {
                            breakpoint: 480,
                            settings: {
                                slidesToShow: _self.settings.slidesToShow480,
                                slidesToScroll: _self.settings.slidesToShow480,
                            }
                        }
                    ]
                })
            }
        }

        var feed = new Instafeed({
            get: 'user',
            target: this.settings.target,
            userId: this.settings.userid,
            accessToken: this.settings.accesstoken,
            limit: this.settings.limit,
            resolution: this.settings.resolution,
            template: '<div class="col hv-image-brightness"><a class="instagram-item" href="{{link}}" target="_blank" id="{{id}}"><img alt="instagram image" class="transition lazyload" data-src="{{image}}" /></a></div>',
            after: afterInstagram
        });

        feed.run();
    }

    Instagrams.prototype = _.assignIn({}, Instagrams.prototype, {
        _a11y: function(event, obj) {
            var $list = obj.$list;
            var $wrapper = this.$container.parent();

            // Remove default Slick aria-live attr until slider is focused
            $list.removeAttr('aria-live');

            // When an element in the slider is focused set aria-live
            $wrapper.on('focusin', function(evt) {
                if ($wrapper.has(evt.target).length) {
                    $list.attr('aria-live', 'polite');
                }
            });

            // Remove aria-live
            $wrapper.on('focusout', function(evt) {
                if ($wrapper.has(evt.target).length) {
                    $list.removeAttr('aria-live');
                }
            });
        }
    });

    return Instagrams;
})();

// Slick carousel
theme.slickCarousel = (function() {
    function Carousels(container) {
        this.$container = $(container).on('init', this._a11y.bind(this));
        this.settings = {
            rows: this.$container.data('rows') || 1,
            slidesToShow: this.$container.data('slidestoshow') || 1,
            slidesToScroll: this.$container.data('slidestoscroll') || 1,
            infinite: this.$container.data('infinite') || false,
            arrows: this.$container.data('arrows') || false,
            dots: this.$container.data('dots') || false,
            autoplay: this.$container.data('autoplay') || false,
            draggable: this.$container.data('draggable') || false,
            accessibility: this.$container.data('accessibility') || true,
        }
        this.settings.slidesToShow1200 = (this.settings.slidesToShow - 1) > 1 ? (this.settings.slidesToShow - 1) : 1;
        this.settings.slidesToShow992 = (this.settings.slidesToShow - 2) > 1 ? (this.settings.slidesToShow - 2) : 1;
        this.settings.slidesToShow768 = (this.settings.slidesToShow - 3) > 1 ? (this.settings.slidesToShow - 3) : 1;
        this.settings.slidesToShow480 = (this.settings.slidesToShow - 4) > 1 ? (this.settings.slidesToShow - 4) : 1;
        this.settings.slidesToScroll1200 = (this.settings.slidesToScroll - 1) > 1 ? (this.settings.slidesToScroll - 1) : 1;
        this.settings.slidesToScroll992 = (this.settings.slidesToScroll - 2) > 1 ? (this.settings.slidesToScroll - 2) : 1;
        this.settings.slidesToScroll768 = (this.settings.slidesToScroll - 3) > 1 ? (this.settings.slidesToScroll - 3) : 1;
        this.settings.slidesToScroll480 = (this.settings.slidesToScroll - 4) > 1 ? (this.settings.slidesToScroll - 4) : 1;
        this.$container.slick({
            rtl: theme.rtl,
            rows: this.settings.rows,
            slidesToShow: this.settings.slidesToShow,
            slidesToScroll: this.settings.slidesToScroll,
            arrows: this.settings.arrows,
            dots: this.settings.dots,
            autoplay: this.settings.autoplay,
            accessibility: this.settings.accessibility,
            draggable: this.settings.draggable,
            infinite: this.settings.infinite,
            adaptiveHeight: true,
            responsive: [{
                    breakpoint: 1200,
                    settings: {
                        slidesToShow: this.settings.slidesToShow1200,
                        slidesToScroll: this.settings.slidesToScroll1200
                    }
                },
                {
                    breakpoint: 992,
                    settings: {
                        slidesToShow: this.settings.slidesToShow992,
                        slidesToScroll: this.settings.slidesToScroll992
                    }
                },
                {
                    breakpoint: 768,
                    settings: {
                        slidesToShow: this.settings.slidesToShow768,
                        slidesToScroll: this.settings.slidesToScroll768
                    }
                },
                {
                    breakpoint: 480,
                    settings: {
                        slidesToShow: 1,
                        slidesToScroll: this.settings.slidesToScroll480
                    }
                }
            ]
        })
    }

    Carousels.prototype = _.assignIn({}, Carousels.prototype, {
        _a11y: function(event, obj) {
            var $list = obj.$list;
            var $wrapper = this.$container.parent();

            // Remove default Slick aria-live attr until slider is focused
            $list.removeAttr('aria-live');

            // When an element in the slider is focused set aria-live
            $wrapper.on('focusin', function(evt) {
                if ($wrapper.has(evt.target).length) {
                    $list.attr('aria-live', 'polite');
                }
            });

            // Remove aria-live
            $wrapper.on('focusout', function(evt) {
                if ($wrapper.has(evt.target).length) {
                    $list.removeAttr('aria-live');
                }
            });
        },

        _goToSlide: function(slideIndex) {
            this.$container.slick('slickGoTo', slideIndex);
        },

        onUnload: function() {
            delete this.$container;
        },

        onBlockSelect: function(evt) {
            // Ignore the cloned version
            var $slide = $(
                '.carousel__slide-wrapper--' + evt.detail.blockId + ':not(.slick-cloned)'
            );
            var slideIndex = $slide.data('slick-index');

            // Go to selected slide, pause autoplay
            this._goToSlide(slideIndex);

        }
    });

    return Carousels;
})()

// Productlists
theme.Productlists = (function() {
    function Productlists(container) {
        this.$container = $(container).on('init', this._a11y.bind(this));
        this.settings = {
            slidesToShow: this.$container.data('slidestoshow') || 1,
            rows: this.$container.data('rows') || 1,
            arrows: this.$container.data('arrows') || false,
            dots: this.$container.data('dots') || false,
            draggable: this.$container.data('draggable') || false,
            infinite: this.$container.data('infinite') || false,
        }
        this.settings.slidesToShow1200 = (this.settings.slidesToShow - 1) > 1 ? (this.settings.slidesToShow - 1) : 1;
        this.settings.slidesToShow992 = (this.settings.slidesToShow - 2) > 1 ? (this.settings.slidesToShow - 2) : 1;
        this.settings.slidesToShow768 = (this.settings.slidesToShow - 3) > 1 ? (this.settings.slidesToShow - 3) : 1;
        this.settings.slidesToShow480 = 2;
        this.$container.slick({
            rtl: theme.rtl,
            accessibility: true,
            slidesToShow: this.settings.slidesToShow,
            slidesToScroll: this.settings.slidesToShow,
            rows: this.settings.rows,
            arrows: this.settings.arrows,
            dots: this.settings.dots,
            infinite: this.settings.infinite,
            draggable: this.settings.draggable,
            responsive: [{
                    breakpoint: 1200,
                    settings: {
                        slidesToShow: this.settings.slidesToShow1200,
                        slidesToScroll: this.settings.slidesToShow1200
                    }
                },
                {
                    breakpoint: 992,
                    settings: {
                        slidesToShow: this.settings.slidesToShow992,
                        slidesToScroll: this.settings.slidesToShow992
                    }
                },
                {
                    breakpoint: 768,
                    settings: {
                        slidesToShow: this.settings.slidesToShow768,
                        slidesToScroll: this.settings.slidesToShow768
                    }
                },
                {
                    breakpoint: 480,
                    settings: {
                        slidesToShow: this.settings.slidesToShow480,
                        slidesToScroll: this.settings.slidesToShow480
                    }
                }
            ]
        }).css('opacity', '1');
    }

    Productlists.prototype = _.assignIn({}, Productlists.prototype, {
        _a11y: function(event, obj) {
            var $list = obj.$list;
            var $wrapper = this.$container.parent();

            // Remove default Slick aria-live attr until slider is focused
            $list.removeAttr('aria-live');

            // When an element in the slider is focused set aria-live
            $wrapper.on('focusin', function(evt) {
                if ($wrapper.has(evt.target).length) {
                    $list.attr('aria-live', 'polite');
                }
            });

            // Remove aria-live
            $wrapper.on('focusout', function(evt) {
                if ($wrapper.has(evt.target).length) {
                    $list.removeAttr('aria-live');
                }
            });
        },

        _goToSlide: function(slideIndex) {
            this.$container.slick('slickGoTo', slideIndex);
        },

        onUnload: function() {
            delete this.$container;
        }
    });

    return Productlists;
})();

// Producttabs
theme.Producttabs = (function() {
    function Producttabs(container) {
        var _self = this; // avoid conflict
        this.$container = $(container).on('init', this._a11y.bind(this));
        this.slickWrap = '.prdtab-content';
        this.settings = {
            slidesToShow: this.$container.data('slidestoshow') || 1,
            arrows: this.$container.data('arrows') || false,
            rows: this.$container.data('rows') || 1,
            dots: this.$container.data('dots') || false,
            draggable: this.$container.data('draggable') || false,
            infinite: this.$container.data('infinite') || false,
        }
        this.settings.slidesToShow1200 = (this.settings.slidesToShow - 1) > 1 ? (this.settings.slidesToShow - 1) : 1;
        this.settings.slidesToShow992 = (this.settings.slidesToShow - 2) > 1 ? (this.settings.slidesToShow - 2) : 1;
        this.settings.slidesToShow768 = (this.settings.slidesToShow - 3) > 1 ? (this.settings.slidesToShow - 3) : 1;
        this.settings.slidesToShow480 = 2;

        this._initSlick();
        this.$container.find('a[data-toggle="tab"]').on("shown.bs.tab", function(e) {
            _self._unSlick();
            _self._initSlick();
            theme.tooltip.load();
        })
    }

    Producttabs.prototype = _.assignIn({}, Producttabs.prototype, {
        _a11y: function(event, obj) {
            var $list = obj.$list;
            var $wrapper = this.$container.parent();

            // Remove default Slick aria-live attr until slider is focused
            $list.removeAttr('aria-live');

            // When an element in the slider is focused set aria-live
            $wrapper.on('focusin', function(evt) {
                if ($wrapper.has(evt.target).length) {
                    $list.attr('aria-live', 'polite');
                }
            });

            // Remove aria-live
            $wrapper.on('focusout', function(evt) {
                if ($wrapper.has(evt.target).length) {
                    $list.removeAttr('aria-live');
                }
            });
        },

        _getSliderSettings: function() {
            return {
                rtl: theme.rtl,
                accessibility: true,
                slidesToShow: this.settings.slidesToShow,
                slidesToScroll: this.settings.slidesToShow,
                arrows: this.settings.arrows,
                rows: this.settings.rows,
                dots: this.settings.dots,
                infinite: this.settings.infinite,
                draggable: this.settings.draggable,
                responsive: [{
                        breakpoint: 1200,
                        settings: {
                            slidesToShow: this.settings.slidesToShow1200,
                            slidesToScroll: this.settings.slidesToShow1200
                        }
                    },
                    {
                        breakpoint: 992,
                        settings: {
                            slidesToShow: this.settings.slidesToShow992,
                            slidesToScroll: this.settings.slidesToShow992
                        }
                    },
                    {
                        breakpoint: 768,
                        settings: {
                            slidesToShow: this.settings.slidesToShow768,
                            slidesToScroll: this.settings.slidesToShow768
                        }
                    },
                    {
                        breakpoint: 480,
                        settings: {
                            slidesToShow: this.settings.slidesToShow480,
                            slidesToScroll: this.settings.slidesToShow480
                        }
                    }
                ]
            }
        },

        _initSlick: function() {
            this.$container.find(this.slickWrap).slick(this._getSliderSettings()).css('opacity', '1');
        },

        _unSlick: function() {
            this.$container.find(this.slickWrap).slick('unslick');
        },

        onUnload: function() {
            delete this.$container;
        },

        onSelect: function() {
            this._unSlick();
            this._initSlick();
        },

        onBlockSelect: function(evt) {
            var navItem = $('.nav-link-' + evt.detail.blockId);
            navItem.tab('show');
            this._unSlick();
            this._initSlick();
        }
    });

    return Producttabs;
})();

theme.Video = (function() {
    var promiseYoutubeAPI;
    var promiseVimeoAPI;

    var youtube = {
        promiseAPI: function() {
            if (!promiseYoutubeAPI) {
                var tag = document.createElement('script');

                tag.src = 'https://www.youtube.com/iframe_api';
                var firstScriptTag = document.getElementsByTagName('script')[0];
                firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

                promiseYoutubeAPI = $.Deferred(function(defer) {
                    window.onYouTubeIframeAPIReady = defer.resolve;

                    setTimeout(function() {
                        defer.reject('Request for YouTube API timed out after 30 seconds.');
                    }, 30000);
                });
            }

            return promiseYoutubeAPI;
        },
        promisePlayer: function(id, options) {
            return this.promiseAPI().then(function() {
                return $.Deferred(function(defer) {
                    if (typeof window.YT === 'undefined') {
                        defer.reject(
                            "We're sorry, something went wrong. The YouTube API has not loaded correctly."
                        );
                    }

                    /* eslint-disable no-undef */
                    var player = new YT.Player(id, options); // global YT variable injected by YouTube API

                    player.addEventListener('onReady', function() {
                        defer.resolve(player);
                    });

                    setTimeout(function() {
                        defer.reject(
                            'Request for YouTube player has timed out after 30 seconds.'
                        );
                    }, 30000);
                });
            });
        }
    };

    var vimeo = {
        promiseAPI: function() {
            if (!promiseVimeoAPI) {
                promiseVimeoAPI = $.Deferred(function(defer) {
                    var tag = document.createElement('script');
                    tag.src = 'https://player.vimeo.com/api/player.js';
                    tag.onload = tag.onreadystatechange = function() {
                        if (!this.readyState || this.readyState === 'complete') {
                            defer.resolve();
                        }
                    };

                    var firstScriptTag = document.getElementsByTagName('script')[0];
                    firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

                    setTimeout(function() {
                        defer.reject('Request for Vimeo API timed out after 30 seconds.');
                    }, 30000);
                });
            }

            return promiseVimeoAPI;
        },

        promisePlayer: function(id, options) {
            return this.promiseAPI().then(function() {
                return $.Deferred(function(defer) {
                    if (typeof window.Vimeo === 'undefined') {
                        defer.reject(
                            "We're sorry, something went wrong. The Vimeo API has not loaded correctly."
                        );
                    }

                    var player = new window.Vimeo.Player(id, options);

                    setTimeout(function() {
                        defer.reject(
                            'Request for Vimeo player has timed out after 30 seconds.'
                        );
                    }, 30000);

                    player.ready().then(function() {
                        defer.resolve(player);
                    });
                });
            });
        }
    };

    var selectors = {
        loadPlayerButton: '.video-section__load-player-button',
        closePlayerButton: '.video-section__player-close',
        playerContainer: '.video-section__player',
        cover: '.video-section__cover',
        errorMessage: '.video-section__error',
        bodyOverlay: '.video-section__body-overlay',
        body: 'body'
    };
    var classes = {
        playerLoading: 'video-section--loading',
        playerLoaded: 'video-section--loaded',
        playerError: 'video-section--error',
        videoPlaying: 'video-playing'
    };

    function Video(container) {
        this.$container = $(container);
        var sectionId = this.$container.attr('data-section-id');
        this.namespace = '.' + sectionId;
        this.onLoad();
    }

    Video.prototype = _.assignIn({}, Video.prototype, {
        onLoad: function() {
            this.$container
                .on('click', selectors.loadPlayerButton, this._loadPlayer.bind(this))
                .on('click', selectors.closePlayerButton, this._closePlayer.bind(this))
                .on('click', selectors.bodyOverlay, this._closePlayer.bind(this));
        },

        _loadPlayer: function() {
            var $container = this.$container;
            var $playerContainer = $(selectors.playerContainer, $container);
            var playerType = this.$container.attr('data-video-type');

            var promiseVideoPlayer;

            if (playerType === 'youtube') {
                promiseVideoPlayer = this._loadYoutubePlayer($playerContainer[0]);
            } else if (playerType === 'vimeo') {
                promiseVideoPlayer = this._loadVimeoPlayer($playerContainer[0]);
            }

            return promiseVideoPlayer
                .then(this._onPlayerLoadReady.bind(this))
                .fail(this._onPlayerLoadError.bind(this));
        },

        _loadYoutubePlayer: function(container) {
            return youtube
                .promisePlayer(container, {
                    videoId: this.$container.attr('data-video-id'),
                    ratio: 16 / 9,
                    playerVars: {
                        modestbranding: 1,
                        autoplay: 1,
                        showinfo: 0,
                        rel: 0
                    }
                })
                .then(
                    function(player) {
                        this.player = player;
                    }.bind(this)
                );
        },

        _loadVimeoPlayer: function(container) {
            return vimeo
                .promisePlayer(container, {
                    id: this.$container.attr('data-video-id')
                })
                .then(
                    function(player) {
                        this.player = player;
                        this.player.play();
                    }.bind(this)
                );
        },

        _onPlayerLoadReady: function() {
            $(selectors.closePlayerButton, this.$container)
                .show()
                .focus();
            $(selectors.cover, this.$container).addClass(classes.playerLoaded);
            this.$container.addClass(classes.playerLoaded);

            this._setScrollPositionValues();

            $(selectors.body).addClass(classes.videoPlaying);

            $(document).on('keyup' + this.namespace, this._closeOnEscape.bind(this));
            $(window).on(
                'resize' + this.namespace,
                this._setScrollPositionValues.bind(this)
            );
            slate.a11y.trapFocus({
                $container: this.$container,
                namespace: this.namespace
            });
        },

        _onPlayerLoadError: function(err) {
            this.$container.addClass(classes.playerError);
            $(selectors.errorMessage, this.$container).text(err);
        },

        _closeOnEscape: function(evt) {
            if (evt.keyCode !== 27) {
                return;
            }

            this._closePlayer();
            $(selectors.loadPlayerButton, this.$container).focus();
        },

        _onScroll: function() {
            var scrollTop = $(window).scrollTop();

            if (
                scrollTop > this.videoTop + 0.25 * this.videoHeight ||
                scrollTop + this.windowHeight <
                this.videoBottom - 0.25 * this.videoHeight
            ) {
                // Debounce DOM edits to the next frame with requestAnimationFrame
                requestAnimationFrame(this._closePlayer.bind(this));
            }
        },

        _setScrollPositionValues: function() {
            this.videoHeight = this.$container.outerHeight(true);
            this.videoTop = this.$container.offset().top;
            this.videoBottom = this.videoTop + this.videoHeight;
            this.windowHeight = $(window).innerHeight();
        },

        _closePlayer: function() {
            $(selectors.body).removeClass(classes.videoPlaying);
            $(selectors.cover, this.$container).removeClass(classes.playerLoaded);
            this.$container.removeClass(classes.playerLoaded);
            $(selectors.closePlayerButton, this.$container).hide();

            slate.a11y.removeTrapFocus({
                $container: this.$container,
                namespace: this.namespace
            });

            if (typeof this.player.destroy === 'function') {
                this.player.destroy();
            } else if (typeof this.player.unload === 'function') {
                this.player.unload();
            }

            $(document).off(this.namespace);
            $(window).off(this.namespace);
        }
    });

    return Video;
})();

theme.CollectionsList = (function() {
    function CollectionsList(container) {
        var $container = (this.$container = $(container));
        var stretchImage = $container.is('[data-stretch-image]');

        // Early return if 'secondary image layout' is enabled
        if (stretchImage) return;

        var namespace = (this.namespace = '.' + $container.attr('data-section-id'));
        var self = this;

        self._collectionListFix();
        $(window).on(
            'resize' + namespace,
            $.debounce(250, function() {
                self._collectionListFix();
            })
        );
    }

    CollectionsList.prototype = _.assignIn({}, CollectionsList.prototype, {
        onUnload: function() {
            $(window).off(this.namespace);
        },

        _collectionListFix: function() {
            var numberRows = this.$container.find('.grid').data('number-rows');
            var $featureCards = this.$container.find('.featured-card');

            // We can exit if 'Use secondary image layout' is enabled
            if ($featureCards.is('[data-stretch-image]')) return;

            // Go through each of the rows
            for (var i = 0; i < numberRows; i++) {
                var maxWrapperHeight = 0;
                var maxHeaderHeight = 0;
                var $currentRow = $featureCards.filter(
                    "[data-row-number='" + (i + 1) + "']"
                );
                var $cardHeaders = $currentRow.find('.featured-card__header');

                // Find the max heights for each row
                $currentRow.each(function() {
                    var $cardTitle = $(this).find('.featured-card__title');
                    var $cardAction = $(this).find('.featured-card__action');
                    var $cardImageWrapper = $(this).find('.featured-card__image-wrapper');
                    var headerHeight =
                        $cardTitle.outerHeight() + $cardAction.outerHeight() + 65;
                    var wrapperHeight = $cardImageWrapper.outerHeight();
                    if (headerHeight > maxHeaderHeight) {
                        maxHeaderHeight = headerHeight;
                    }
                    if (wrapperHeight > maxWrapperHeight) {
                        maxWrapperHeight = wrapperHeight;
                    }
                });

                // Set the heights of the headers and cards for this row with padding
                $cardHeaders.outerHeight(maxHeaderHeight);
                $currentRow.height(maxWrapperHeight + maxHeaderHeight + 40);
            }
        }
    });

    return CollectionsList;
})();

theme.ParrallaxImage = (function() {
    function ParrallaxImage(container) {
        this.container = container;
        this.sectionId = $(container).attr('data-section-id');
        this.namespace = 'parallax-' + this.sectionId;
        var images = document.getElementsByClassName('thumbnail' + this.sectionId);
        new simpleParallax(images, {
            scale: 1.5,
            delay: .6,
        });
    }

    ParrallaxImage.prototype = $.extend({}, ParrallaxImage.prototype, {
        onUnload: function(evt) {
            var instance = new simpleParallax(images);
            instance.destroy();
            delete theme.ParrallaxImage[this.namespace];
        }
    });

    return ParrallaxImage;
})();

theme.init = function() {
    theme.customerTemplates.init();
    slate.rte.wrapTable();
    slate.rte.iframeReset();

    // Common a11y fixes
    slate.a11y.pageLinkFocus($(window.location.hash));

    $('.in-page-link').on('click', function(evt) {
        slate.a11y.pageLinkFocus($(evt.currentTarget.hash));
    });

    $('a[href="#"]').on('click', function(evt) {
        evt.preventDefault();
    });


    //scroll animation
    AOS.init({
        startEvent: 'DOMContentLoaded',
        offset: 30, // offset (in px) from the original trigger point
        delay: 0, // values from 0 to 3000, with step 50ms
        duration: 1000,
        once: true
    });
    window.addEventListener('load', function() {
        AOS.refresh();
    });


    // Sections
    var sections = new theme.Sections();
    sections.register('header', theme.HeaderSection);
    sections.register('product', theme.Product);
    sections.register('slideshow-section', theme.SlideshowSection);
    sections.register('cart', theme.Cart);
    sections.register('instagrams', theme.Instagrams);
    sections.register('masonries', theme.Masonry);
    sections.register('productlist', theme.Productlists);
    sections.register('producttab', theme.Producttabs);
    sections.register('slickCarousels', theme.slickCarousel);
    sections.register('video', theme.Video);
    sections.register('collections-list', theme.CollectionsList);
    sections.register('parallax-image', theme.ParrallaxImage);
    sections.register('bgcollection', theme.Bgcollection);

    // Standalone modules
    $(window).on('load', theme.articleImages);
    theme.passwordModalInit();
};

theme.articleImages = function() {
    var $indentedRteImages = $('.rte--indented-images');
    if (!$indentedRteImages.length) {
        return;
    }

    $indentedRteImages.find('img').each(function(i, el) {
        var $el = $(el);
        var attr = $el.attr('style');

        // Check if undefined or float: none
        if (!attr || attr === 'float: none;') {
            // Add class to parent paragraph tag if image is wider than container
            if ($el.width() >= $indentedRteImages.width()) {
                $el.parent('p').addClass('rte__image-indent');
            }
        }
    });
};

theme.passwordModalInit = function() {
    var $loginModal = $('#LoginModal');
    if (!$loginModal.length) {
        return;
    }

    // Initialize modal
    theme.PasswordModal = new window.Modals('LoginModal', 'login-modal', {
        focusOnOpen: '#Password'
    });

    // Open modal if errors exist
    if ($loginModal.find('.errors').length) {
        theme.PasswordModal.open();
    }
};

// CSS var ponyfill
theme.cssVar = (function() {
    cssVars();
})()

// Ajax search https://gist.github.com/awojtczyk/53d74c8af5f893841f33979b0cdcd6fe
theme.ajaxSearch = (function() {
    var $inputSearch = '.js-ajaxsearch',
        $resultsList = '.search-results',
        $input = $($inputSearch).find('input[name="q"]'),
        $currentAjaxRequest,
        $displayProducts = 6;

    $($inputSearch).css('position', 'relative').each(function() {
        $input.attr('autocomplete', 'off').bind('keyup change', function() {
            var term = $(this).val(),
                form = $(this).closest('form'),
                searchURL = '/search?type=product&q=*' + term + '*';
            if (term.length > 2 && term !== $(this).attr('data-old-term')) {
                $(this).attr('data-old-term', term);
                if ($currentAjaxRequest !== undefined) $currentAjaxRequest.abort();
                $currentAjaxRequest = $.getJSON(searchURL + '&view=json', function(data) {
                    $($resultsList).empty();

                    if (data.results_count === 0) {
                        $($resultsList).html('<p class="text-center">' + theme.strings.ajaxSearchNoResult + '</p>')
                    } else {
                        $.each(data.results, function(index, item) {
                            if (index < $displayProducts) {
                                var itemPrice = theme.Currency.formatMoney(item.price, theme.moneyFormat);
                                var link = $('<a class="d-inline-flex ' + index + '"></a>')
                                    .attr('href', item.url)
                                    .append('<span class="image"><img src="' + item.thumbnail + '" /></span>')
                                    .append('<div class="meta"><p class="title">' + item.title + '</p>' + itemPrice + '</div>')
                                    .wrap('<div class="ajax-search-item"></div>');
                                $($resultsList).append(link.parent());
                                theme.updateCurrencies();
                            }
                        });
                        if (data.results_count > $displayProducts) {
                            $($resultsList).append('<a class="btn btn--full" href="' + searchURL + '">' + theme.strings.ajaxSearchViewAll + ' (' + data.results_count + ')</a>');
                        }
                    }
                    $($resultsList).addClass('active').fadeIn(200);
                });
            }
        });
    });

    //escape when click somethings
    $(document).click(function(event) {
        var target = event.target;
        if (!$(target).is($inputSearch) && !$(target).parents().is($inputSearch)) {
            $($resultsList).slideUp(300);
        }
    });
})();

// Quickview https://github.com/kellyvaughn/quickview-for-shopify/blob/master/quickview.js.liquid
theme.quickview = (function() {
    var product_handle = '',
        quickviewButtonClass = '.js-btn-quickview',
        quickviewId = '#jsQuickview',
        quickviewOption = '#jsQuickview select',
        quickviewThumb = '#qv-product-images',
        quickviewAddCartButton = '.qv-add-button',
        quickviewPrice = '.qv-product-price',
        quickviewComparePrice = '.qv-product-compare-price';

    // 1. Show quickview
    $(document).on('click', quickviewButtonClass, function() {
        var quickviewAvaible = $(this).attr("data-pavailable");
        product_handle = $(this).data('handle');
        //ResetQuickview
        $(quickviewId).removeClass().addClass('modal fade');
        $(quickviewThumb).removeClass().empty();
        $('.qv-product-options').empty();

        //Pushdata
        $(quickviewId).addClass(product_handle).data('handle', product_handle);
        jQuery.getJSON('/products/' + product_handle + '.js', function(product) {
            var title = product.title;
            var type = product.type;
            var vendor = product.vendor;
            var price = 0;
            var compare_price = 0;
            var desc = product.description.slice(0, 90);
            var images = product.images;
            var variants = product.variants;
            var options = product.options;
            var url = '/products/' + product_handle;
            $('.qv-product-title').text(title);
            $('.qv-product-type').text(type);
            $('.qv-product-description').html(desc);
            $('.qv-view-product').attr('href', url);
            $('.qv-view-type').text(type);
            $('.qv-view-vendor').text(vendor)
            if (quickviewAvaible == 'true') {
                $(quickviewAddCartButton).prop('disabled', false).html(theme.strings.addToCart);
            } else {
                $(quickviewAddCartButton).prop('disabled', true).html(theme.strings.soldOut);
            }
            $(product.variants).each(function(i, variants) {
                if (variants.sku != null) {
                    $('.qv-sku').addClass("show").removeClass("hide");
                    $('.qv-view-sku').text(product.variants[0].sku);
                } else {
                    $('.qv-sku').addClass("hide").removeClass("show");
                }

            });
            var imageCount = $(images).length;
            $(images).each(function(i, image) {
                image_embed = '<div><img src="' + image + '"></div>';
                image_embed = image_embed.replace('.jpg', '_800x.jpg').replace('.png', '_800x.png');
                $(quickviewThumb).append(image_embed);
            });
            $(quickviewThumb).slick({
                rtl: theme.rtl,
                'dots': true,
                'arrows': true,
                'respondTo': 'min',
                'useTransform': true
            }).css('opacity', '1');

            if (product.variants[0].option1 !== "Default Title") {
                $(options).each(function(i, option) {
                    var name = option.name;
                    var opt = name.replace(/ /g, '-').toLowerCase();
                    var selectClass = '.option.' + opt;
                    $('.qv-product-options').append('<div class="option-selection ' + opt + '"><span class="option text-uppercase font-weight-bold text-body">' + option.name + '</span><select class="option-' + i + ' option ' + opt + '"></select></div>');
                    $(option.values).each(function(i, value) {
                        $('.option.' + opt).append($('<option>', {
                            value: value,
                            text: value
                        }));
                    });
                });
            }
            $(product.variants).each(function(i, v) {
                if (v.inventory_quantity == 0) {
                    return true
                } else {
                    price = theme.Currency.formatMoney(v.price, theme.moneyFormat);
                    compare_price = theme.Currency.formatMoney(v.compare_at_price, theme.moneyFormat);
                    $(quickviewPrice).html(price);
                    if (v.compare_at_price !== null) {
                        $(quickviewComparePrice).html(compare_price).show();
                    } else {
                        $(quickviewComparePrice).hide();
                    }
                    theme.updateCurrencies();
                    $('select.option-0').val(v.option1);
                    $('select.option-1').val(v.option2);
                    $('select.option-2').val(v.option3);
                    return false
                }
            });
        });
        //addCartQuickview
    });
    // 2. Add to cart
    $(document).on('click', quickviewAddCartButton, function() {
        product_handle = $(quickviewId).data('handle');
        var qty = $('.qv-quantity').val(),
            selectedOptions = '',
            var_id = '';

        function processCart() {
            jQuery.post('/cart/add.js', {
                    quantity: qty,
                    id: var_id
                }, null, "json").done(function(item) {
                    var htmlVariant = item.variant_title !== null ? '<i>(' + item.variant_title + ')</i>' : '';
                    var styleCart = $('.js-mini-cart').attr("data-cartmini");
                    if (styleCart != 'true') {
                        var htmlAlert = '<div class="media mt-2 alert--cart"><a class="mr-3" href="/cart"><img class="lazyload" data-src="' + item.image + '"></a><div class="media-body align-self-center"><p class="m-0 font-weight-bold">' + item.product_title + ' x ' + item.quantity + '</p>' + htmlVariant + '<div><div>';
                        theme.alert.new(theme.strings.addToCartSuccess, htmlAlert, 3000, 'notice');
                    }
                    theme.miniCart.updateElements();
                    theme.miniCart.generateCart();
                })
                .fail(function($xhr) {
                    var data = $xhr.responseJSON;
                    theme.alert.new('', data.description, 3000, 'warning');
                });
        }
        $(quickviewOption).each(function(i) {
            if (selectedOptions == '') {
                selectedOptions = $(this).val();
            } else {
                selectedOptions = selectedOptions + ' / ' + $(this).val();
            }
        });
        jQuery.getJSON('/products/' + product_handle + '.js', function(product) {
            if (product.variants.length === 1) {
                var_id = product.variants[0].id;
            } else {
                $(product.variants).each(function(i, v) {
                    if (v.title == selectedOptions) {
                        var_id = v.id;
                    }
                });
            }
            processCart();
        });
    });
    // 3. Select variants
    $(document).on('change', quickviewOption, function() {
        var selectedOptions = '';
        $(quickviewOption).each(function(i) {
            if (selectedOptions == '') {
                selectedOptions = $(this).val();
            } else {
                selectedOptions = selectedOptions + ' / ' + $(this).val();
            }
        });
        jQuery.getJSON('/products/' + product_handle + '.js', function(product) {
            $(product.variants).each(function(i, v) {
                if (v.title == selectedOptions) {
                    if (v.featured_image !== null) {
                        var iSlick = v.featured_image.position - 1;
                        $(quickviewThumb).slick('slickGoTo', iSlick);
                    }
                    var price = theme.Currency.formatMoney(v.price, theme.moneyFormat);
                    var compare_price = theme.Currency.formatMoney(v.compare_at_price, theme.moneyFormat);
                    $(quickviewPrice).html(price);
                    $(quickviewComparePrice).html(compare_price);
                    if (v.sku != null) {
                        $('.qv-sku').addClass("show").removeClass("hide");
                        $('.qv-view-sku').text(v.sku);
                    } else {
                        $('.qv-sku').addClass("hide").removeClass("show");
                    }
                    if (v.compare_at_price !== null) {
                        $(quickviewComparePrice).html(compare_price).show();
                    } else {
                        $(quickviewComparePrice).hide();
                    }
                    theme.updateCurrencies();
                    if (v.inventory_management === null) {
                        $(quickviewAddCartButton).prop('disabled', false).val(theme.strings.addToCart);
                    } else {
                        if (v.inventory_quantity < 1) {
                            $(quickviewAddCartButton).prop('disabled', true).val(theme.strings.soldOut);
                        } else {
                            $(quickviewAddCartButton).prop('disabled', false).val(theme.strings.addToCart);
                        }
                    }
                }
            });
        });
    });
})()

//Button add to cart (in grid item)
theme.addCartButton = (function() {
    var buttonClass = '.js-grid-cart';
    $(document).on('click', buttonClass, function() {
        var $this = $(this);
        var id = $this.data('id');
        $this.addClass('is-loading');
        Shopify.addItem(id, 1, function(item) {
            location.href = "/cart";
            var htmlVariant = item.variant_title !== null ? '<i>(' + item.variant_title + ')</i>' : '';
            var styleCart = $('.js-mini-cart').attr("data-cartmini");
            if (styleCart != 'true') {
                var htmlAlert = '<div class="media mt-2 alert--cart"><a class="mr-3" href="/cart"><img class="lazyload" data-src="' + item.image + '"></a><div class="media-body align-self-center"><p class="m-0 font-weight-bold">' + item.product_title + ' x ' + item.quantity + '</p>' + htmlVariant + '<div><div>';
            }
            theme.miniCart.updateElements();
            theme.miniCart.generateCart();
            setTimeout(function() {
                styleCart != 'true' ? theme.alert.new(theme.strings.addToCartSuccess, htmlAlert, 3000, 'notice') : '';
                $this.removeClass('is-loading');
            }, 1000);
        });
    })
})()

// Button add to cart (in grid item)
//theme.addCartButton = (function(){
//  var buttonClass = '.js-grid-cart';
//  $(document).on('click',buttonClass,function(){
//    var $this = $(this);
//    var id = $this.data('id');
//    $this.addClass('is-loading');
//    Shopify.addItem(id,1,function(item){
//      var htmlVariant = item.variant_title !== null ? '<i>('+item.variant_title+')</i>' : '';
//      var styleCart = $('.js-mini-cart').attr("data-cartmini");
//        if(styleCart != 'true'){
//          var htmlAlert = '<div class="media mt-2 alert--cart"><a class="mr-3" href="/cart"><img class="lazyload" data-src="'+item.image+'"></a><div class="media-body align-self-center"><p class="m-0 font-weight-bold">'+item.product_title+' x '+ item.quantity +'</p>'+htmlVariant+'<div><div>';
//        }
//      theme.miniCart.updateElements();
//      theme.miniCart.generateCart();
//      setTimeout(function() {
//        styleCart != 'true' ? theme.alert.new(theme.strings.addToCartSuccess,htmlAlert,3000,'notice'): '';
//        $this.removeClass('is-loading');
//      }, 1000);
//    });
// })
//})()

// Multi currencies 
if (theme.enableCurrencies) {
    // Can be 'money_format' or 'money_with_currency_format'
    Currency.format = 'money_format';
    var shopCurrency = Shopify.currency.active;
    var cookieCurrency = Currency.cookie.read();
    // Fix for customer account pages 
    jQuery('span.money span.money').each(function() {
        jQuery(this).parent('span.money').removeClass('money');
    });
    // Add precalculated shop currency to data attribute 
    jQuery('span.money').each(function() {
        jQuery(this).attr('data-currency-' + Shopify.currency.active, jQuery(this).html());
    });
    // Select all your currencies buttons.
    var buttons = jQuery('#currencies a'),
        currentCurrencies = jQuery('.pre-currencies');
    // When the page loads.
    if (cookieCurrency == null || cookieCurrency == shopCurrency) {
        Currency.currentCurrency = shopCurrency;
    } else {
        Currency.currentCurrency = cookieCurrency;
        Currency.convertAll(shopCurrency, cookieCurrency);
        buttons.removeClass('selected');
        jQuery('#currencies a[data-currency=' + cookieCurrency + ']').addClass('selected');
        var htmlCurrently = jQuery('#currencies a[data-currency=' + cookieCurrency + ']').html();
        currentCurrencies.html(htmlCurrently);
    }
    buttons.click(function() {
        buttons.removeClass('selected');
        jQuery(this).addClass('selected');
        var newCurrency = jQuery(this).attr('data-currency');
        var htmlCurrently = jQuery(this).html();
        currentCurrencies.html(htmlCurrently);
        Currency.convertAll(Currency.currentCurrency, newCurrency);
    });
    // For product options.
    var original_selectCallback = window.selectCallback;
    var selectCallback = function(variant, selector) {
        original_selectCallback(variant, selector);
        Currency.convertAll(shopCurrency, jQuery('#currencies a.selected').attr('data-currency'));
    };
}
theme.updateCurrencies = function() {
    Currency.convertAll(shopCurrency, jQuery('#currencies a.selected').attr('data-currency'));
}

// MiniCart


// Free shipping
theme.freeShipping = (function() {
    var $freeShippingClass = $('.js-free-shipping'),
        $freeShippingTextClass = $('.js-free-shipping-text'),
        $free_fisrt = $freeShippingClass.attr('data-start'),
        $free_end = $freeShippingClass.attr('data-end')
    minOrderValue = parseInt($freeShippingClass.data('value')) || 0,
        $percentClass = $('.js-free-shipping .progress-bar');

    function generate(cart) {
        var priceCart = cart.total_price;
        if (priceCart >= minOrderValue) {
            $percentClass.css('width', '100%').removeClass('progress-bar-striped bg-primary');
            $freeShippingTextClass.text(theme.strings.freeShipping)
        } else {
            let percent = priceCart / minOrderValue * 100;
            let left = Shopify.formatMoney((minOrderValue - priceCart), theme.moneyFormat);
            $percentClass.css('width', percent + '%').addClass('progress-bar-striped primary');
            $freeShippingTextClass.html($free_fisrt + ' ' + left + ' ' + $free_end);
            theme.updateCurrencies();
        }
    }

    Shopify.getCart(function(cart) {
        generate(cart);
    });

    return {
        load: generate
    }
})()

// Shipping time - https://github.com/phstc/jquery-dateFormat
theme.shippingTime = (function() {
    var $shippingTime = $('.js-shipping-time'),
        shippingTime = $shippingTime.data('time') || '',
        now = new Date(),
        restHour = 23 - now.getHours(),
        restMinute = 59 - now.getMinutes();
    if (shippingTime !== '') {
        var nextTime = new Date(now.getTime() + shippingTime * 86400000),
            formatTime = $.format.date(nextTime, "ddd, dd MMMM yyyy"),
            htmlShipping = 'Order in the next <b>' + restHour + '</b> hours <b>' + restMinute + '</b> minutes to get it by <b>' + formatTime + '</b>. ';
        $shippingTime.html(htmlShipping);
    }
})()

// Infinite scroll - https://github.com/Elkfox/Ajaxinate/blob/master/dist/ajaxinate.min.js
theme.infiniteScroll = (function() {
    function initInfiniteScroll() {
        if ($('.AjaxinateLoop').length === 0) {
            return;
        } else {
            var endlessScroll = new Ajaxinate({
                loadingText: '<div class="text-center"><div class="' + theme.loadingClass + '" role="status"></div></div>',
                callback: function() {
                    theme.wishlist.load();
                    theme.compare.load();
                    theme.countdown.load();
                    theme.priceRange.load();
                    theme.tooltip.load();
                    theme.collectionView.triggerView();
                    theme.swatchCard2.load();
                }
            });
        }
    }

    // Infinite scroll in other page (blog, list-collection)
    function initOtherPages() {
        var otherPages = new Ajaxinate({
            loadingText: '<div class="text-center"><div class="' + theme.loadingClass + '" role="status"></div></div>',
            container: '.js-pagination-content',
            pagination: '.js-pagination'
        });
    }

    document.addEventListener("DOMContentLoaded", function() {
        initInfiniteScroll();
        initOtherPages();
    });

    return {
        load: initInfiniteScroll
    }
})()

// Scroll to fixed
theme.scrollToFixed = (function() {
    var window_width = $(window).width();

    if (window_width < 768) {
        $(".js-stick-parent").trigger("sticky_kit:detach");
    } else {
        make_sticky();
    }
    $(window).resize(function() {

        window_width = $(window).width();

        if (window_width < 768) {
            $(".js-stick-parent").trigger("sticky_kit:detach");
        } else {
            make_sticky();
        }
    });

    function make_sticky() {
        $('.js-stick-parent').stick_in_parent();
    }

})()


theme.headersidebar = (function() {
    $('#dismiss, .overlaysidebar').on('click', function() {
        // hide sidebar
        $('#sidebar').removeClass('active');
        // hide overlay
        $('.overlaysidebar').removeClass('active');
    });

    $('#sidebarCollapse').on('click', function() {
        // open sidebar
        $('#sidebar').addClass('active');
        // fade in the overlay
        $('.overlaysidebar').addClass('active');
        $('.collapse.in').toggleClass('in');
        $('a[aria-expanded=true]').attr('aria-expanded', 'false');
    });
})()

// Wishlist
theme.wishlist = (function() {
    var wishlistButtonClass = '.js-btn-wishlist',
        wishlistRemoveButtonClass = '.js-remove-wishlist',
        $wishlistCount = $('.js-wishlist-count'),
        $wishlistContainer = $('.js-wishlist-content'),
        wishlistObject = JSON.parse(localStorage.getItem('localWishlist')) || [],
        wishlistPageUrl = $('.js-wishlist-link').attr('href'),
        loadNoResult = function() {
            $wishlistContainer.html('<div class="col text-center"><div class="alert alert-warning d-inline-block">' + theme.strings.wishlistNoResult + '</div></div>');
        };

    function updateWishlist(self) {
        var productHandle = $(self).data('handle'),
            allSimilarProduct = $(wishlistButtonClass + '[data-handle="' + productHandle + '"]');
        var isAdded = $.inArray(productHandle, wishlistObject) !== -1 ? true : false;
        if (isAdded) {
            // go to wishlist page
            window.location.href = wishlistPageUrl;
        } else {
            wishlistObject.push(productHandle);
            allSimilarProduct.fadeOut('slow').fadeIn('fast').html(theme.strings.wishlistIconAdded + theme.strings.wishlistTextAdded);
            //change tooltip
            allSimilarProduct.attr('data-original-title', theme.strings.wishlistTextAdded);
            $('.tooltip-inner').text(theme.strings.wishlistTextAdded);
        }
        localStorage.setItem('localWishlist', JSON.stringify(wishlistObject));
        $wishlistCount.text(wishlistObject.length);
    };

    function loadWishlist() {
        $wishlistContainer.html('');
        //page wishlist
        if (wishlistObject.length > 0) {
            for (var i = 0; i < wishlistObject.length; i++) {
                var productHandle = wishlistObject[i];
                Shopify.getProduct(productHandle, function(product) {
                    var htmlProduct = '';
                    var productPrice = product.price_varies ? 'from ' + theme.Currency.formatMoney(product.price_min, theme.moneyFormat) : theme.Currency.formatMoney(product.price, theme.moneyFormat);
                    var productComparePrice = product.compare_at_price_min !== 0 ? theme.Currency.formatMoney(product.compare_at_price_min, theme.moneyFormat) : '';
                    htmlProduct += '<div class="js-wishlist-item col-md-4 col-sm-6 col-xs-6 col-12 mb-4">';
                    htmlProduct += '<div class="js-wishlist-itembox">';
                    htmlProduct += '<div class=" d-flex flex-row p-4">';
                    htmlProduct += '	<a class="d-inline-block mr-4 " href="' + product.url + '">';
                    htmlProduct += '		<img src="' + product.featured_image + '"/>';
                    htmlProduct += '	</a>';
                    htmlProduct += '	<div><a href="' + product.url + '" class="title-prouct d-block h4 text-body" >' + product.title + '</a>';
                    htmlProduct += '	<span> ' + productPrice + '</span>';
                    htmlProduct += '	 <s>' + productComparePrice + '</s></div>';
                    htmlProduct += '<button class="btn js-remove-wishlist" data-handle="' + product.handle + '">' + theme.strings.wishlistRemove + '</button>';
                    htmlProduct += '</div>';
                    htmlProduct += '</div>';
                    htmlProduct += '</div>';
                    $wishlistContainer.append(htmlProduct);
                    theme.updateCurrencies();
                });
            }
        } else {
            loadNoResult();
        }

        //count items
        $wishlistCount.text(wishlistObject.length);

        //button text
        $(wishlistButtonClass).each(function() {
            var productHandle = $(this).data('handle');
            var iconWishlist = $.inArray(productHandle, wishlistObject) !== -1 ? theme.strings.wishlistIconAdded : theme.strings.wishlistIcon;
            var textWishlist = $.inArray(productHandle, wishlistObject) !== -1 ? theme.strings.wishlistTextAdded : theme.strings.wishlistText;
            $(this).html(iconWishlist + textWishlist).attr('title', textWishlist);
        });
    }

    $(document).on('click', wishlistButtonClass, function(event) {
        event.preventDefault();
        updateWishlist(this);
    });
    $(document).on('click', wishlistRemoveButtonClass, function() {
        var productHandle = $(this).data('handle'),
            allSimilarProduct = $(wishlistButtonClass + '[data-handle="' + productHandle + '"]');

        //update button
        allSimilarProduct.html(theme.strings.wishlistIcon + theme.strings.wishlistText);
        //update tooltip
        allSimilarProduct.attr('data-original-title', theme.strings.wishlistText);
        $('.tooltip-inner').text(theme.strings.wishlistText);
        //update Object
        wishlistObject.splice(wishlistObject.indexOf(productHandle), 1);
        localStorage.setItem('localWishlist', JSON.stringify(wishlistObject));
        // Remove element
        $(this).closest('.js-wishlist-item').fadeOut(); // or .remove()
        //count
        $wishlistCount.text(wishlistObject.length);
        if (wishlistObject.length === 0) {
            loadNoResult();
        }
    });

    loadWishlist();
    $(document).on('shopify:section:load', loadWishlist);
    return {
        load: loadWishlist
    }
})()

// Compare
theme.compare = (function() {
    var compareButtonClass = '.js-btn-compare',
        compareRemoveButtonClass = '.js-remove-compare',
        $compareCount = $('.js-compare-count'),
        $compareContainer = $('.js-compare-content'),
        compareObject = JSON.parse(localStorage.getItem('localCompare')) || [],
        alertClass = 'notice';

    function updateCompare(self) {
        var productHandle = $(self).data('handle'),
            alertText = '';
        var isAdded = $.inArray(productHandle, compareObject) !== -1 ? true : false;
        if (isAdded) {
            compareObject.splice(compareObject.indexOf(productHandle), 1);
            alertText = theme.strings.compareNotifyRemoved;
            alertClass = 'notice';
        } else {
            if (compareObject.length === 4) {
                alertText = theme.strings.compareNotifyMaximum;
                alertClass = 'error';
            } else {
                alertClass = 'notice';
                compareObject.push(productHandle);
                alertText = theme.strings.compareNotifyAdded;
            }
        }
        localStorage.setItem('localCompare', JSON.stringify(compareObject));
        theme.alert.new(theme.strings.compareText, alertText, 2000, alertClass);
        $compareCount.text(compareObject.length);
    };

    function loadCompare() {
        var compareGrid;
        $compareContainer.html('');
        //popup compare
        if (compareObject.length > 0) {
            compareGrid = compareObject.length === 1 ? 'col-md-6 col-sm-6' : 'col';
            for (var i = 0; i < compareObject.length; i++) {
                var productHandle = compareObject[i];
                Shopify.getProduct(productHandle, function(product) {
                    var htmlProduct = '',
                        productPrice = product.price_varies ? 'from ' + theme.Currency.formatMoney(product.price_min, theme.moneyFormat) : theme.Currency.formatMoney(product.price, theme.moneyFormat),
                        productComparePrice = product.compare_at_price_min !== 0 ? theme.Currency.formatMoney(product.compare_at_price_min, theme.moneyFormat) : '',
                        productAvailable = product.available ? theme.strings.available : theme.strings.unavailable,
                        productAvailableClass = product.available ? 'alert-success' : 'alert-danger',
                        productTypeHTML = product.type !== "" ? '<a href="/collections/types?q=' + product.type + '">' + product.type + '</a>' : '<span>' + theme.strings.none + '</span>',
                        productVendorHTML = product.vendor !== "" ? '<a href="/collections/vendors?q=' + product.vendor + '">' + product.vendor + '</a>' : '<span>' + theme.strings.none + '</span>';
                    htmlProduct += '<div class="compare-item ' + compareGrid + ' col-xs-6">';
                    htmlProduct += '	<a href="' + product.url + '">';
                    htmlProduct += '		<img src="' + Shopify.resizeImage(product.featured_image, 'x300') + '"/>';
                    htmlProduct += '	</a>';
                    htmlProduct += '	<hr /><h5 >' + product.title + '</h5>';
                    htmlProduct += '	<hr /><s>' + productComparePrice + '</s>';
                    htmlProduct += '	<span> ' + productPrice + '</span>';
                    htmlProduct += '	<hr /><span class=' + productAvailableClass + '> ' + productAvailable + '</span>';
                    htmlProduct += '	<hr />' + productTypeHTML;
                    htmlProduct += '	<hr />' + productVendorHTML;
                    htmlProduct += '  <hr /><button class="btn js-remove-compare btn-theme gradient-theme" data-handle="' + product.handle + '">' + theme.strings.compareRemove + '</button>';
                    htmlProduct += '</div>';
                    $compareContainer.append(htmlProduct);
                    theme.updateCurrencies();
                });
            }
        } else {
            $compareContainer.html('<div class="alert alert-warning d-inline-block">' + theme.strings.compareNoResult + '</div>');
        }

        //button text
        $(compareButtonClass).each(function() {
            var productHandle = $(this).data('handle');
            var status = $.inArray(productHandle, compareObject) !== -1 ? 'added' : '';
            $(this).removeClass('added').addClass(status);
        });

        //count items
        $compareCount.text(compareObject.length);
    }
    $(document).on('click', compareButtonClass, function(event) {
        event.preventDefault();
        updateCompare(this);
        loadCompare();
    });
    $(document).on('click', compareRemoveButtonClass, function() {
        var productHandle = $(this).data('handle');
        compareObject.splice(compareObject.indexOf(productHandle), 1);
        localStorage.setItem('localCompare', JSON.stringify(compareObject));
        loadCompare();
    });

    loadCompare();
    $(document).on('shopify:section:load', loadCompare);
    return {
        load: loadCompare
    }
})()

// Popup newsletter
theme.popupNewletter = (function() {
    var $popupNewsletter = $('#jsPopupNewsletter'),
        $newsletterForm = $('#jsPopupNewsletter form'),
        date = new Date(),
        minutes = theme.timePopupNewsletter;
    minutesdelay = $popupNewsletter.attr('data-delay');
    if ($popupNewsletter.length === 1) {
        date.setTime(date.getTime() + (minutes * 60 * 1000));
        var setCookies = function() {
            $.cookie('cookiesNewsletter', 'disabled', { expires: date, path: '/' });
        };
        if ($.cookie('cookiesNewsletter') !== "disabled") {
            $(window).on('load', function() {
                setTimeout(function() {
                    $popupNewsletter.modal('show');
                }, minutesdelay * 1000);
            });
            $popupNewsletter.on('hidden.bs.modal', setCookies);
            $newsletterForm.submit(setCookies);
        }
    }
})()

// Cookie policy
theme.cookie = (function() {
    var $policy = $('.js-cookie-policy'),
        $closeButton = $('.js-btn-ok'),
        isOk = localStorage.getItem('localCookie') || '';
    if (isOk === '') {
        $policy.fadeIn('slow');
    }
    $closeButton.on('click', function() {
        localStorage.setItem('localCookie', 'accept');
        $policy.fadeOut('slow');
    })
})()

// Announcement Bar
theme.announcement = (function() {
    var $bar = $('.js-announcement-bar'),
        $closeButton = $('.js-ab-close'),
        isClosed = localStorage.getItem('localAnnouncement') || '';
    if (isClosed === '') {
        $bar.fadeIn();
        $bar.closest('.body-theme').addClass('body-announcement-bar');
    }
    $closeButton.on('click', function() {
        localStorage.setItem('localAnnouncement', 'closed');
        $bar.slideUp();
        $bar.closest('.body-theme').removeClass('body-announcement-bar');
    })
})()

// Open external link in new tab
theme.exLink = (function() {
    var links = document.links;
    for (let i = 0, linksLength = links.length; i < linksLength; i++) {
        if (links[i].hostname !== window.location.hostname && $(links[i]).attr('href') !== 'javascript:void(0)') {
            links[i].target = '_blank';
        }
    }
})()

// Deal- countdown
theme.countdown = (function() {
    function initCountdown() {
        $(".js-countdown").each(function() {
            var endTime = $(this).data('time'),
                htmlLayout = "<ul class='list--inline'><li class='gradient-theme-vertical'><span class='countdown-time'>%%D%%</span><span class='countdown-text'>Days</span></li><li class='gradient-theme-vertical'><span class='countdown-time'>%%H%%</span><span class='countdown-text'>Hours</span></li><li class='gradient-theme-vertical'><span class='countdown-time'>%%M%%</span><span class='countdown-text'>Mins</span></li><li class='gradient-theme-vertical'><span class='countdown-time'>%%S%%</span><span class='countdown-text'>Secs</span></li></ul>";
            $(this).lofCountDown({
                TargetDate: endTime,
                DisplayFormat: htmlLayout,
                FinishMessage: '<span class="alert alert-warning d-inline-block">' + theme.strings.countdownEndText + '</span>'
            });
        });
    }
    initCountdown();
    return {
        load: initCountdown
    }
})()

// Price range - Collection page
theme.priceRange = (function() {
    function initPriceRange() {
        var min = 0,
            max = 0,
            slideRange = '#js-slider-range',
            productCard = '.js-product-card',
            slideRangeWrap = '.slider-range-wr',
            rangeMin = '.js-range-min',
            rangeMax = '.js-range-max',
            enablePriceRange = $('#js-slider-range').length === 1 ? true : false;

        if (enablePriceRange) {
            $(productCard).each(function() {
                if (eval($(this).data('price')) > max) max = eval($(this).data('price'));
                if (min == 0) min = eval($(this).data('price'));
                else if (eval($(this).data('price')) < min) min = eval($(this).data('price'));
            });

            if (min === max) {
                $(slideRangeWrap).fadeOut();
            } else {
                $(slideRangeWrap).fadeIn();
            }

            $(slideRange).slider({
                range: true,
                min: min,
                max: max,
                values: [min, max],
                slide: function(event, ui) {
                    var price1 = (Shopify.formatMoney(ui.values[0], theme.moneyFormat));
                    var price2 = (Shopify.formatMoney(ui.values[1], theme.moneyFormat));
                    $(rangeMin).html(price1);
                    $(rangeMax).html(price2);
                    theme.updateCurrencies();

                    // Show/Hide product when dragging
                    $(productCard).each(function() {
                        if (eval($(this).data('price')) >= ui.values[0] && eval($(this).data('price')) <= ui.values[1]) {
                            $(this).parent().fadeIn();
                        } else {
                            $(this).parent().fadeOut();
                        }
                    });
                }
            });

            var price1 = (Shopify.formatMoney(min, theme.moneyFormat));
            var price2 = (Shopify.formatMoney(max, theme.moneyFormat));
            $(rangeMin).html(price1);
            $(rangeMax).html(price2);
            theme.updateCurrencies();

        }
    }
    initPriceRange();
    return {
        load: initPriceRange
    }
})()

// Collection view - Collection page
theme.collectionView = (function() {
    var btnView = '.js-btn-view',
        btnViewActive = '.js-btn-view.active';

    $(document).on('click', btnView, function() {
        var value = $(this).data('col'),
            $gridItemCol = $('.js-col');

        $(btnView).removeClass('active');
        $(this).addClass('active');

        $gridItemCol.removeClass().addClass('js-col col-sm-6 col-12');
        if (value === 3) {
            $gridItemCol.addClass('col-lg-4');
        } else if (value === 4) {
            $gridItemCol.addClass('col-lg-3');
        } else if (value === 5) {
            $gridItemCol.addClass('col-lg-2-4');
        } else if (value === 6) {
            $gridItemCol.addClass('col-lg-2');
        };
    })

    function triggerCollectionView() {
        $(btnViewActive).trigger('click');
    }

    return {
        triggerView: triggerCollectionView
    }
})()

// Swath variant in card item
theme.swatchCard = (function() {
    $(document).on('click', '.js-swatch-card-item', function() { //click or mouseover
        $(".js-swatch-card-item").removeClass("active");
        $(this).addClass("active");
        var newImage = $(this).data('image');
        var id = $(this).data('id');
        var gridItem = $(this).closest('.js-product-card');
        gridItem.find('.product-card__image').find('img').attr('srcset', newImage);
        gridItem.find('.js-grid-cart').data('id', id).attr('data-id', id);
    });
})()

theme.swatchCard2 = (function() {
    function initVariant(id) {
        var productJson = JSON.parse($('.customJson-' + id).html());
        var $selectorForm = $('.customform-' + id);
        var $button = $('.js-customform-addtocart-' + id);
        var $buttontext = $button.find('span');
        var $wrapObject = $selectorForm.closest('.js-product-card');
        var options = {
            $container: $selectorForm,
            enableHistoryState: false,
            product: productJson,
            singleOptionSelector: '.single-option-selector-' + id,
            originalSelectorId: '#ProductSelect-' + id
        };
        var variants = new slate.Variants(options);
        var AjaxCart = new window.AjaxCart($selectorForm);
        var _updateButton = function(evt) {
            var variant = evt.variant;
            if (variant === undefined) {
                $button.prop('disabled', true).removeClass('btn--sold-out');
                $buttontext.html(theme.strings.unavailable);
            } else {
                if (variant.available) {
                    $button.removeClass('btn--sold-out').prop('disabled', false);
                    $buttontext.html(theme.strings.addToCart);
                } else {
                    $button.prop('disabled', true).addClass('btn--sold-out');
                    $buttontext.html(theme.strings.soldOut);
                }
            }
        }
        var _updateImage = function(evt) {
            var variant = evt.variant;
            var $mainImage = $wrapObject.find('.product-card__image').find('img');
            if (variant !== undefined && variant.featured_image !== null) {
                var variantImage = variant.featured_image;
                $mainImage.attr('srcset', variantImage.src);
            }
        }
        var _updatePrice = function(evt) {
            var $price = $wrapObject.find('.product-card__price');
            var variant = evt.variant;
            if (variant !== undefined) {
                var htmlComparePrice = variant.compare_at_price !== null ? '<s class="product-card__regular-price"><span class="money">' + variant.compare_at_price + '</span></s>' : '';
                var htmlPrice = '<span class="money">' + variant.price + '</span>' + htmlComparePrice;
                $price.html(htmlPrice);
                theme.updateCurrencies();
            }
        }
        variants.$container.on(
            'variantChange', _updateButton
        );
        variants.$container.on(
            'variantChange', _updateImage
        );
        variants.$container.on(
            'variantChange', _updatePrice
        );
    }

    function initForm() {
        $('.js-customform').each(function() {
            var id = $(this).data('id');
            initVariant(id);
        })
    }

    initForm();
    return {
        load: initForm
    }
})()

// Loading
theme.loading = (function() {
    var $loading = $('#js-loading'),
        hasLoading = $('#js-loading').length === 0 ? false : true;
    if (hasLoading) {
        $(window).load(function() {
            $loading.fadeOut();
        });
    }
})()

theme.effectLeavingPage = (function() {
    window.onbeforeunload = function() {
        $('body').css('opacity', '0');
    }
})()

// Isotope
theme.isotope = (function() {
    var enableIsotope = $('.enable-isotope').length === 1 ? true : false,
        $grid = $('.js-grid'),
        filter = '.js-filter-isotope';

    function initIsotope() {
        if (enableIsotope) {
            $grid.isotope({
                itemSelector: '.grid-item',
                percentPosition: true
            })
            $(document).on('click', filter, function() {
                var filterValue = $(this).data('filter') === '*' ? $(this).data('filter') : '.' + $(this).data('filter');
                $(filter).removeClass('active');
                $(this).addClass('active');
                $grid.isotope({
                    filter: filterValue
                });
            });
            $(window).scroll(function() {
                $grid.isotope('layout');
            });
            $(window).load(function() {
                $grid.isotope('layout');
                $(filter).first().trigger('click');
            });
        }
    }
    initIsotope();
})()

//aos



// theme.Wow = (function(){
//   new WOW().init();
// })()




// Masonry
theme.Masonry = (function() {
    function Masonry(container) {
        this.$container = $(container).on('init', this._a11y.bind(this));
        var $masonry = this.$container;
        $masonry.isotope({
            itemSelector: '.grid-item',
            percentPosition: true,
            masonry: {
                columnWidth: '.grid-sizer'
            }
        });
        $(window).load(function() {
            $masonry.isotope('layout').css('opacity', '1');
        });
        $(window).scroll(function() {
            $masonry.isotope('layout').css('opacity', '1');
        });
    }

    Masonry.prototype = _.assignIn({}, Masonry.prototype, {
        _a11y: function(event, obj) {
            var $list = obj.$list;
            var $wrapper = this.$container.parent();

            // Remove default Slick aria-live attr until slider is focused
            $list.removeAttr('aria-live');

            // When an element in the slider is focused set aria-live
            $wrapper.on('focusin', function(evt) {
                if ($wrapper.has(evt.target).length) {
                    $list.attr('aria-live', 'polite');
                }
            });

            // Remove aria-live
            $wrapper.on('focusout', function(evt) {
                if ($wrapper.has(evt.target).length) {
                    $list.removeAttr('aria-live');
                }
            });
        }
    });

    return Masonry;
})();



// Cross-selling
theme.crosssell = (function() {
    var crosssellClass = '.js-crosssell',
        handles = $(crosssellClass).data('handles') || '',
        arrayHandle = handles.split(','),
        $blockCrosssell = $('.block-cross-sell'),
        variantSelectClass = '.js-cross-select',
        crossImageClass = '.cross-item-image',
        crossPriceClass = '.cross-item-money';

    function generateCrosssell() {
        for (var i = 0; i < arrayHandle.length; i++) {
            var productHandle = arrayHandle[i];
            Shopify.getProduct(productHandle, function(product) {
                var htmlCross = '',
                    htmlOption = '',
                    firstAvailableVariant = '',
                    variantCount = product.variants.length;

                // generate select box and check first avaiable variant
                for (var j = 0; j < variantCount; j++) {
                    var variant = product.variants[j],
                        variantImage = variant.featured_image === null ? product.featured_image : variant.featured_image.src,
                        disabled = variant.available ? '' : 'disabled';
                    htmlOption += '<option ' + disabled + ' data-id="' + variant.id + '" data-price="' + variant.price + '" data-image="' + variantImage + '">' + variant.title + '</option>';
                    if (firstAvailableVariant === '' && variant.available) {
                        firstAvailableVariant = variant
                    }
                }
                var productPrice = theme.Currency.formatMoney(firstAvailableVariant.price, theme.moneyFormat),
                    productImage = firstAvailableVariant.featured_image === null ? product.featured_image : firstAvailableVariant.featured_image.src,
                    selectHide = variantCount === 1 ? 'hide' : '';

                // generate HTML
                htmlCross += '<div class="col cross-item ' + product.handle + '">';
                htmlCross += '	<a class="cross-item-image" href="' + product.url + '" title="' + product.title + '"><img src="' + productImage + '" />' + theme.strings.cartIcon + '</a>';
                htmlCross += '	<a target="_blank" href="' + product.url + '" title="' + product.title + '" class="cross-item-title">' + product.title + '</a>';
                htmlCross += '	<span class="cross-item-money">' + productPrice + '</span>';
                htmlCross += '	<select class="js-cross-select ' + selectHide + '" data-image="' + productImage + '" data-price="' + firstAvailableVariant.price + '" data-item="' + firstAvailableVariant.id + '">' + htmlOption + '</select>';
                htmlCross += '</div>';
                $(crosssellClass).append(htmlCross);
                theme.updateCurrencies();
            });
        }
    }

    function showPopupCrosssell(lineItem) {
        //generate lineitem;
        var htmlLineItem = '';
        htmlLineItem += '<span class="alert alert-success d-inline-block mb-2">' + theme.strings.addToCartSuccess + '</span>';
        htmlLineItem += '<div><img src="' + lineItem.image + '" alt="Added Product"></div>';
        htmlLineItem += '<h4 class="cross-item-title">' + lineItem.title + '</h4>';
        htmlLineItem += '<div class="mb-2">' + theme.strings.cartQuantity + ': ' + lineItem.quantity + '</div>';
        $('.js-cross-added').hide().html(htmlLineItem).fadeIn();

        // show popup
        var $popupCrosssell = $('#jsCrosssell');
        $popupCrosssell.modal('show');
    }

    if (handles !== '') {
        $(document).on('click', crossImageClass, function(event) {
            event.preventDefault();
            var parent = $(this).closest('.cross-item'),
                itemId = parent.find(variantSelectClass).attr('data-item');
            Shopify.addItem(itemId, 1, function(lineItem) {
                theme.miniCart.updateElements();
                theme.miniCart.generateCart();
                showPopupCrosssell(lineItem);
            });
        });
        $(document).on('change', variantSelectClass, function() {
            var selectVariant = $(this).children(':selected'),
                selectVariantId = selectVariant.data('id'),
                parent = $(this).parent(),
                newPrice = theme.Currency.formatMoney(selectVariant.data('price'), theme.moneyFormat);

            if (selectVariant.data('image') !== '') {
                parent.find(crossImageClass).find('img').attr('src', selectVariant.data('image'));
            }
            $(this).attr('data-item', selectVariantId);
            parent.find(crossPriceClass).html(newPrice);
            theme.updateCurrencies();
        });
        $(document).on('shopify:section:load', generateCrosssell);
        generateCrosssell();
        $blockCrosssell.removeClass('hide');
    }
    return {
        showPopup: showPopupCrosssell
    }
})()

// Upsell
theme.upsell = (function() {
    var popupUpsell = '#jsUpsell',
        $button = $('#jsUpsell .btn'),
        productUpsellId = $('#jsUpsell').data('id') || '',
        buttonAcceptClass = 'js-btn-accept',
        delayTime = $('#jsUpsell').data('delay') || 3000,
        isUpsell = $(popupUpsell).length === 1 ? true : false;
    if (isUpsell) {
        $(document).ready(function() {
            setTimeout(function() {
                $(popupUpsell).modal('show');
            }, delayTime);
        });
        $button.on('click', function() {
            if ($(this).hasClass(buttonAcceptClass)) {
                Shopify.addItem(productUpsellId, 1, function(item) {
                    theme.miniCart.updateElements();
                    theme.miniCart.generateCart();
                    var htmlVariant = item.variant_title !== null ? '<i>(' + item.variant_title + ')</i>' : '';
                    var htmlAlert = '<div class="media mt-2 alert--cart"><a class="mr-3" href="/cart"><img class="lazyload" data-src="' + item.image + '"></a><div class="media-body align-self-center"><p class="m-0 font-weight-bold">' + item.product_title + ' x ' + item.quantity + '</p>' + htmlVariant + '<div><div>';
                    theme.alert.new(theme.strings.addToCartSuccess, htmlAlert, 3000, 'notice');
                })
            }
            $(popupUpsell).modal('hide');
        })
    }
})()

// Coupon
theme.coupon = (function() {
    var popupCoupon = '#jsCoupon',
        $button = $('#jsCoupon .js-btn-coupon'),
        delayTime = $('#jsCoupon').data('delay') || 3000,
        isCoupon = $(popupCoupon).length === 1 ? true : false,
        isCopied = localStorage.getItem('localCoupon') || '';
    if (isCoupon && isCopied === '') {
        $(document).ready(function() {
            setTimeout(function() {
                $(popupCoupon).modal('show');
            }, delayTime);
        });
        $button.on('click', function() {
            var copyText = document.getElementById("coupon_code");
            copyText.select();
            document.execCommand("Copy");
            $(popupCoupon).modal('hide');
            theme.alert.new('Coupon code', 'Successfully copied, now you can paste code at checkout', 4000);
            localStorage.setItem('localCoupon', 'copied');
        })
    }
})()

// Overwrite Shopify.onError in Shopify API
Shopify.onError = function(t, r) {
    var e = eval("(" + t.responseText + ")");
    var mess = e.message ? e.message + "(" + e.status + "): " + e.description : "Error : " + Shopify.fullMessagesFromErrors(e).join("; ") + "."
    theme.alert.new('Alert', mess, 3000, 'warning');
}

// Megamenu width
theme.fixWidthMegamenu = (function() {
    var $megamenuClass = $('.site-nav__item-mega'),
        megaDropdownClass = '.meganav';
    $megamenuClass.each(function() {
        var widthMenu = $(this).data('width') || 0;
        if (widthMenu !== 0) {
            $(this).find(megaDropdownClass).css({ 'width': widthMenu + 'px', 'margin-left': '-' + widthMenu / 2 + 'px' });
        }
    });
})()

// Product video
theme.productVideo = (function() {
    var playButtonClass = '.js-play-button';
    $(document).on('click', playButtonClass, function() {
        let videoSelector = $(this).next(),
            videoObject = videoSelector.get(0);
        $(this).toggleClass('active');
        videoSelector.toggleClass('active');
        videoObject.paused ? videoObject.play() : videoObject.pause();
    })
})()

// Fake-viewers
theme.fakeViewer = (function() {
    var $fakeViewClass = $('.js-fake-view'),
        minValue = $fakeViewClass.data('min'),
        maxValue = $fakeViewClass.data('max'),
        duration = $fakeViewClass.data('duration');

    function randomInRange(start, end) {
        var value = Math.floor(Math.random() * (end - start + 1) + start);
        $fakeViewClass.text(value);
    }

    if (minValue !== undefined && maxValue !== undefined) {
        randomInRange(minValue, maxValue);
        setInterval(function() {
            randomInRange(minValue, maxValue);
        }, duration);
    }

})();

// Product-suggest
theme.productSuggest = (function() {
    var $productSuggestClass = $('.product-notification'),
        $closeButtonClass = $('.close-notifi'),
        duration = $productSuggestClass.data('time') || 0,
        productSuggestCookie = 'cookieSuggest';

    function SomeonePurchased() {
        if ($.cookie(productSuggestCookie) == 'closed') {
            $productSuggestClass.remove();
        }
        $closeButtonClass.on('click', function() {
            $productSuggestClass.remove();
            $.cookie(productSuggestCookie, 'closed', { expires: 1, path: '/' });
        });

        function toggleSomething() {
            if ($productSuggestClass.hasClass('active')) {
                $productSuggestClass.removeClass('active')
            } else {
                var arrayProducts = $('.data-product'),
                    randomProduct = Math.floor(Math.random() * arrayProducts.length),
                    Object = $(arrayProducts[randomProduct]);

                $productSuggestClass.addClass('active');
                $productSuggestClass.find('.product-image').attr('href', Object.data('url')).find('img').attr('src', Object.data('image'));
                $productSuggestClass.find('.product-name').text(Object.data('title')).attr('href', Object.data('url'));
                $productSuggestClass.find('.time-ago').text(Object.data('time'));
                $productSuggestClass.find('.from-ago').text(Object.data('local'));
            }
        }

        if (duration !== 0) {
            setInterval(toggleSomething, duration);
        }
    }
    SomeonePurchased();
})()


// Stickyheader
theme.stickyHeader = (function() {
    var stickHeaderClass = '.site-header--sticky';
    if ($(stickHeaderClass).length !== 0) {
        $(window).scroll(function() {
            if (window.pageYOffset >= 20) {
                $(stickHeaderClass).addClass('active');
            } else {
                $(stickHeaderClass).removeClass('active');
            }
        });
    }
})()

theme.PhotoSwipe = (function() {
    var initPhotoSwipeFromDOM = function(gallerySelector) {

        // parse slide data (url, title, size ...) from DOM elements 
        // (children of gallerySelector)
        var parseThumbnailElements = function(el) {
            var thumbElements = el.childNodes,
                numNodes = thumbElements.length,
                items = [],
                figureEl,
                linkEl,
                size,
                item;

            for (var i = 0; i < numNodes; i++) {

                figureEl = thumbElements[i]; // <figure> element

                // include only element nodes 
                if (figureEl.nodeType !== 1) {
                    continue;
                }

                linkEl = figureEl.children[0]; // <a> element

                size = linkEl.getAttribute('data-size').split('x');

                // create slide object
                item = {
                    src: linkEl.getAttribute('href'),
                    w: parseInt(size[0], 10),
                    h: parseInt(size[1], 10)
                };



                if (figureEl.children.length > 1) {
                    // <figcaption> content
                    item.title = figureEl.children[1].innerHTML;
                }

                if (linkEl.children.length > 0) {
                    // <img> thumbnail element, retrieving thumbnail url
                    item.msrc = linkEl.children[0].getAttribute('src');
                }

                item.el = figureEl; // save link to element for getThumbBoundsFn
                items.push(item);
            }

            return items;
        };

        // find nearest parent element
        var closest = function closest(el, fn) {
            return el && (fn(el) ? el : closest(el.parentNode, fn));
        };

        // triggers when user clicks on thumbnail
        var onThumbnailsClick = function(e) {
            e = e || window.event;
            e.preventDefault ? e.preventDefault() : e.returnValue = false;

            var eTarget = e.target || e.srcElement;

            // find root element of slide
            var clickedListItem = closest(eTarget, function(el) {
                return (el.tagName && el.tagName.toUpperCase() === 'FIGURE');
            });

            if (!clickedListItem) {
                return;
            }

            // find index of clicked item by looping through all child nodes
            // alternatively, you may define index via data- attribute
            var clickedGallery = clickedListItem.parentNode,
                childNodes = clickedListItem.parentNode.childNodes,
                numChildNodes = childNodes.length,
                nodeIndex = 0,
                index;

            for (var i = 0; i < numChildNodes; i++) {
                if (childNodes[i].nodeType !== 1) {
                    continue;
                }

                if (childNodes[i] === clickedListItem) {
                    index = nodeIndex;
                    break;
                }
                nodeIndex++;
            }



            if (index >= 0) {
                // open PhotoSwipe if valid index found
                openPhotoSwipe(index, clickedGallery);
            }
            return false;
        };

        // parse picture index and gallery index from URL (#&pid=1&gid=2)
        var photoswipeParseHash = function() {
            var hash = window.location.hash.substring(1),
                params = {};

            if (hash.length < 5) {
                return params;
            }

            var vars = hash.split('&');
            for (var i = 0; i < vars.length; i++) {
                if (!vars[i]) {
                    continue;
                }
                var pair = vars[i].split('=');
                if (pair.length < 2) {
                    continue;
                }
                params[pair[0]] = pair[1];
            }

            if (params.gid) {
                params.gid = parseInt(params.gid, 10);
            }

            return params;
        };

        var openPhotoSwipe = function(index, galleryElement, disableAnimation, fromURL) {
            var pswpElement = document.querySelectorAll('.pswp')[0],
                gallery,
                options,
                items;

            items = parseThumbnailElements(galleryElement);

            // define options (if needed)
            options = {
                maxSpreadZoom: 1,
                bgOpacity: 0.7,
                zoomEl: true,
                history: false,
                zoomEl: false,
                pinchToClose: false,
                closeOnScroll: false,
                // define gallery index (for URL)
                galleryUID: galleryElement.getAttribute('data-pswp-uid'),

            };

            // PhotoSwipe opened from URL
            if (fromURL) {
                if (options.galleryPIDs) {
                    // parse real index when custom PIDs are used 
                    // http://photoswipe.com/documentation/faq.html#custom-pid-in-url
                    for (var j = 0; j < items.length; j++) {
                        if (items[j].pid == index) {
                            options.index = j;
                            break;
                        }
                    }
                } else {
                    // in URL indexes start from 1
                    options.index = parseInt(index, 10) - 1;
                }
            } else {
                options.index = parseInt(index, 10);
            }

            // exit if index not found
            if (isNaN(options.index)) {
                return;
            }

            if (disableAnimation) {
                options.showAnimationDuration = 0;
            }

            // Pass data to PhotoSwipe and initialize it
            gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, items, options);
            gallery.init();
        };

        // loop through all gallery elements and bind events
        var galleryElements = document.querySelectorAll(gallerySelector);

        for (var i = 0, l = galleryElements.length; i < l; i++) {
            galleryElements[i].setAttribute('data-pswp-uid', i + 1);
            galleryElements[i].onclick = onThumbnailsClick;
        }

        // Parse URL and open gallery if it contains #&pid=3&gid=1
        var hashData = photoswipeParseHash();
        if (hashData.pid && hashData.gid) {
            openPhotoSwipe(hashData.pid, galleryElements[hashData.gid - 1], true, true);
        }
    };

    // execute above function
    initPhotoSwipeFromDOM('.my-gallery');
})()

theme.ZoomImage = (function() {
    $(window).resize(function() {
        var width = $(window).width();
        if (width > 767) {
            ZoomImage();
        }
    });
    $(window).width(function() {
        var width = $(window).width();
        if (width > 767) {
            ZoomImage();
        }
    });

    function ZoomImage() {
        $(".zoom_image").each(function(arg, el) {
            var image = $(el).find("img");
            $(el).zoom({
                on: 'mouseover',
                url: image.attr("src").replace("small", "big")
            });
        });
    }
})()

theme.activeAccordion = (function() {
    $('.collapse').on('shown.bs.collapse', function() {
        $(this).prev().addClass('active-acc');
    });
    $('.collapse').on('hidden.bs.collapse', function() {
        $(this).prev().removeClass('active-acc');
    });
})()


// Anchor scroll
theme.anchorScroll = (function() {
    $(document).on('click', 'a[href^="#"]', function(event) {
        event.preventDefault();
        var disableAnchor = $(this).hasClass('disabled-anchor');
        if (!disableAnchor) {
            $('html, body').animate({
                scrollTop: $($.attr(this, 'href')).offset().top
            }, 500);
        }
    });
})()

// Product-recently-viewed
theme.productRecentlyViewed = (function() {
    var $viewedElement = $('.js-recently-view'),
        $viewButton = $('.js-recently-view-button'),
        $content = $('.js-recently-view-content'),
        productHandle = $viewedElement.data('handle') || '',
        limit = $viewButton.data('limit') || 0,
        arrayProduct = JSON.parse(localStorage.getItem('localRecentlyViewed')) || [],
        lastProduct = arrayProduct[arrayProduct.length - 1] || '',
        isAdded = $.inArray(productHandle, arrayProduct) !== -1 ? true : false;

    function processViewed() {
        if (productHandle !== '') {
            //process last product
            if (lastProduct === productHandle && arrayProduct.length > 1) {
                lastProduct = arrayProduct[arrayProduct.length - 2]
            }

            //move current product to last of array
            if (isAdded) {
                arrayProduct.splice(arrayProduct.indexOf(productHandle), 1);
            }
            arrayProduct.push(productHandle);
            //remove first item if limit
            if (arrayProduct.length > limit) {
                arrayProduct.shift()
            }
            localStorage.setItem('localRecentlyViewed', JSON.stringify(arrayProduct));
        }
    }

    function generatorProduct() {
        $content.html('');
        if (arrayProduct.length > 0) {
            //array
            for (var i = 0; i < arrayProduct.length; i++) {
                var productHandle = arrayProduct[i];
                Shopify.getProduct(productHandle, function(product) {
                    var htmlProduct = '';
                    var productPrice = product.price_varies ? 'from ' + theme.Currency.formatMoney(product.price_min, theme.moneyFormat) : theme.Currency.formatMoney(product.price, theme.moneyFormat);
                    var productComparePrice = product.compare_at_price_min !== 0 ? theme.Currency.formatMoney(product.compare_at_price_min, theme.moneyFormat) : '';
                    htmlProduct += '<div class="col-12 col-lg-4 js-viewed-item mb-4">';
                    htmlProduct += '	<div class="border p-3 rounded media d-flex ">';
                    htmlProduct += '	<a class="mr-3 col-4 p-0" href="' + product.url + '">';
                    htmlProduct += '		<img src="' + product.featured_image + '"/>';
                    htmlProduct += '	</a>';
                    htmlProduct += '	<div class="media-body text-left">';
                    htmlProduct += '		<h4 class="mb-2 mt-2"><a href="' + product.url + '">' + product.title + '</a></h5>';
                    htmlProduct += '	<span> ' + productPrice + '</span>';
                    htmlProduct += '	<s>' + productComparePrice + '</s>';
                    htmlProduct += '	</div>';
                    htmlProduct += '	</div>';
                    htmlProduct += '</div>';
                    $content.append(htmlProduct);
                    theme.updateCurrencies();
                });
            }

            //last product
            Shopify.getProduct(lastProduct, function(product) {
                $viewButton.css('background-image', 'url(' + product.featured_image + ')').addClass('active');
            })
        }
    }

    processViewed();
    generatorProduct();

})()

// Notice when soldout
theme.alert = (function() {
    function createAlert(title, mess, time, type) {
        var aTitle = title || '',
            aTime = time || 2000,
            aMessage = mess || '',
            aClass = type || 'default';
        $.growl({
            title: aTitle,
            message: aMessage,
            duration: aTime,
            style: aClass,
            size: 'large'
        });
    }

    return {
        new: createAlert
    }
})()

// Notice when soldout
theme.noticeSoldout = (function() {
    var $soldoutWrapFormClass = $('.js-contact-soldout'),
        $textClass = $('.js-notify-text'),
        $soldoutValueId = $('#ContactProduct');

    function noticeSoldout(variant) {
        $soldoutWrapFormClass.find('.form-success').remove()
        if (variant.available) {
            $textClass.find('span').text('');
            $soldoutWrapFormClass.addClass('hide');
        } else {
            $textClass.find('span').text(': ' + variant.name);
            $soldoutWrapFormClass.removeClass('hide');
            $soldoutValueId.val(variant.name).attr('value', variant.name);
        }
    }
    return {
        init: noticeSoldout
    }
})()

// Sticky cart
theme.stickyCart = (function() {
    var $anchor = $('#js-anchor-sticky-cart'),
        $stCart = $('.sticky-cart-wr'),
        $close = $('#js-sticky-close'),
        disableStCart = localStorage.getItem('localDisableStCart') || '';
    if (disableStCart !== '') {
        $stCart.addClass('disable');
    }
    $close.on('click', function() {
        var isDisable = disableStCart !== '';
        if (isDisable) {
            localStorage.setItem('localDisableStCart', '');
        } else {
            localStorage.setItem('localDisableStCart', 'true');
        }
        $stCart.toggleClass('disable');
    })
    if ($anchor.length) {
        $(window).on('scroll', function() {
            var hT = $anchor.offset().top,
                hH = $anchor.outerHeight(),
                wH = $(window).height(),
                wS = $(this).scrollTop();
            if (wS > (hT + hH - wH)) {
                $stCart.addClass('active');
            } else {
                $stCart.removeClass('active');
            }
        });
    }

})()

//Fix reload safari
window.addEventListener("pageshow", function(evt) {
    if (evt.persisted) {
        setTimeout(function() {
            window.location.reload();
        }, 10);
    }
}, false);

// Back to top
theme.backToTop = (function() {
    var backtotopClass = $('.js-back-to-top');
    $(window).scroll(function() {
        if ($(this).scrollTop() > 300) {
            backtotopClass.fadeIn('slow');
        } else {
            backtotopClass.fadeOut('slow');
        }
    });
    backtotopClass.on('click', function() {
        $('body,html').animate({ scrollTop: 0 }, 800);
    });
})()


// Tooltip
theme.tooltip = (function() {
    var selector = '[data-toggle="tooltip"],[data-tooltip="true"]';

    function loadTooltip() {
        $(selector).tooltip(); //Bootstrap 4
    };
    $(document).on('click', selector, function() {
        $(this).tooltip('hide');
    });
    loadTooltip();
    return {
        load: loadTooltip
    }
})()

//Collections style 2
theme.Bgcollection = (function() {
    // init Isotope
    function Bgcollection(container) {
        var $container = this.$container = $(container);
        var sectionId = $container.attr('data-section-id');
        var wrapper = this.wrapper = '.bgcollection-wrapper';
        var slider = this.slider = '#Bgcollection-' + sectionId;
        var $slider = $(slider, wrapper);
        $(".colgrid__bg--full[data-index='1']").addClass('active');
        $('.colgrid .colgrid__box').each(function() {
            var index = $(this).attr("data-index");
            $(this).hover(
                function() {
                    $(".colgrid__bg--full[data-index='" + index + "']").addClass('active');
                },
                function() {
                    $(".colgrid__bg--full[data-index='" + index + "']").removeClass('active');
                }
            );
        });
    }

    return Bgcollection;
})();


//Sidebar
theme.sidebar = (function() {
    var togglebutton = '.js-toggle-filter',
        $sidebar = $('.js-sidebar');
    $(document).on('click', togglebutton, function() {
        $sidebar.toggleClass('active');
        $(this).toggleClass('active');
    })
})()

// Ajax filter in collection page
theme.ajaxFilter = (function() {
    var ajaxContent = '#js-product-ajax',
        ajaxSortBy = '#js-sortby',
        ajaxFillter = '#js-fillter',
        ajaxCollectionTitle = '.js-collection-title',
        pageTitle = $(document).find("title").text(),
        jsLoading = '#js-loading';

    var apollo = {
        init: function() {
            this.initFilter();
        },
        showLoading: function() {
            $(jsLoading).show();
        },
        hideLoading: function() {
            $('body,html').animate({
                scrollTop: $('#MainContent').offset().top - 150
            }, 600);
            setTimeout(function() {
                $(jsLoading).hide(); //delay 500ms for better UX
            }, 500);

        },
        initFilter: function() {
            apollo.filterParams();
            apollo.filterSortby();
            apollo.sidebarMapTagEvents();
            apollo.filterMapSorting();
            apollo.filterMapPaging();
        },
        filterParams: function() {
            Shopify.queryParams = {};
            if (location.search.length) {
                for (var aKeyValue, i = 0, aCouples = location.search.substr(1).split('&'); i < aCouples.length; i++) {
                    aKeyValue = aCouples[i].split('=');
                    if (aKeyValue.length > 1) {
                        Shopify.queryParams[decodeURIComponent(aKeyValue[0])] = decodeURIComponent(aKeyValue[1]);
                    }
                }
            }
        },
        filterSortby: function() {
            if (Shopify.queryParams.sort_by) {
                var sortby = Shopify.queryParams.sort_by;
                $(ajaxSortBy).val(sortby);
            }
        },
        filterCreateUrl: function(baseLink) {
            var newQuery = $.param(Shopify.queryParams).replace(/%2B/g, '+');
            if (baseLink) {
                if (newQuery != "") {
                    return baseLink + "?" + newQuery;
                } else {
                    return baseLink;
                }
            }
            return location.pathname + "?" + newQuery;
        },
        filterMapData: function(data) {
            // 1. update product grid
            $(ajaxContent).html($(ajaxContent, data.responseText).html());
            // 2. update left filter
            $(ajaxFillter).html($(ajaxFillter, data.responseText).html());
            // 3. update collection title
            $(ajaxCollectionTitle).html($(ajaxCollectionTitle, data.responseText).html());
        },
        filterAjaxClick: function(baseLink) {
            delete Shopify.queryParams.page;
            var newurl = apollo.filterCreateUrl(baseLink);
            History.pushState({
                param: Shopify.queryParams
            }, pageTitle, newurl);
            apollo.filterGetContent(newurl);
        },
        filterGetContent: function(newurl) {
            $.ajax({
                type: 'GET',
                url: newurl,
                data: {},
                beforeSend: function() {
                    apollo.showLoading();
                },
                complete: function(data) {
                    apollo.filterMapData(data);
                    theme.wishlist.load();
                    theme.compare.load();
                    theme.countdown.load();
                    theme.priceRange.load();
                    theme.tooltip.load();
                    theme.collectionView.triggerView();
                    theme.swatchCard2.load();
                    theme.infiniteScroll.load();
                    apollo.hideLoading();
                },
                error: function(xhr, text) {
                    apollo.hideLoading();
                    alert($.parseJSON(xhr.responseText).description);
                }
            });
        },
        sidebarMapTagEvents: function() {
            $(document).on('click', '.advanced-filter a', function(event) {
                event.preventDefault();
                $('.tooltip').removeClass('show');
                var currentTags = [];
                if (Shopify.queryParams.constraint) {
                    currentTags = Shopify.queryParams.constraint.split('+');
                }
                if (!$(this).parent().hasClass("active-filter")) {
                    var otherTag = $(this).parents('.catalog_filter_ul').find("li.active-filter");
                    if (otherTag.length > 0) {
                        var tagName = otherTag.data("handle");
                        if (tagName) {
                            var tagPos = currentTags.indexOf(tagName);
                            if (tagPos >= 0) {
                                currentTags.splice(tagPos, 1);
                            }
                        }
                    }
                }
                var dataHandle = $(this).parent().data("handle");
                if (dataHandle) {
                    var tagPos = currentTags.indexOf(dataHandle);
                    if (tagPos >= 0) {
                        currentTags.splice(tagPos, 1);
                    } else {
                        currentTags.push(dataHandle);
                    }
                }
                if (currentTags.length) {
                    Shopify.queryParams.constraint = currentTags.join('+');
                } else {
                    delete Shopify.queryParams.constraint;
                }
                apollo.filterAjaxClick();
            });
            $(document).on('click', '.advanced-filter .icon', function() {
                $(this).parent('.advanced-filter').find('a').trigger("click");
            });
        },
        filterMapSorting: function() {
            $(document).on('change', ajaxSortBy, function() {
                Shopify.queryParams.sort_by = $(this).val();
                apollo.filterAjaxClick();
            })
        },
        filterMapPaging: function() {
            $(document).on('click', '.js-pagination a', function() {
                event.preventDefault();
                var linkPage = $(this).attr("href").match(/page=\d+/g);
                if (linkPage) {
                    Shopify.queryParams.page = parseInt(linkPage[0].match(/\d+/g));
                    if (Shopify.queryParams.page) {
                        var newurl = apollo.filterCreateUrl();
                        History.pushState({
                            param: Shopify.queryParams
                        }, pageTitle, newurl);
                        apollo.filterGetContent(newurl);
                    }
                }
            });
        }
    }

    if ($(".template-collection")) {
        History.Adapter.bind(window, 'statechange', function() {
            var State = History.getState();
            apollo.filterParams();
        });
    }
    apollo.init();

})();
$(theme.init);
/**
 * Currency Helpers
 * -----------------------------------------------------------------------------
 * A collection of useful functions that help with currency formatting
 *
 * Current contents
 * - formatMoney - Takes an amount in cents and returns it as a formatted dollar value.
 *
 * Alternatives
 * - Accounting.js - http://openexchangerates.github.io/accounting.js/
 *
 */

theme.Currency = (function() {
    var moneyFormat = '${{amount}}'; // eslint-disable-line camelcase

    function formatMoney(cents, format) {
        if (typeof cents === 'string') {
            cents = cents.replace('.', '');
        }
        var value = '';
        var placeholderRegex = /\{\{\s*(\w+)\s*\}\}/;
        var formatString = format || moneyFormat;

        function formatWithDelimiters(number, precision, thousands, decimal) {
            thousands = thousands || ',';
            decimal = decimal || '.';

            if (isNaN(number) || number === null) {
                return 0;
            }

            number = (number / 100.0).toFixed(precision);

            var parts = number.split('.');
            var dollarsAmount = parts[0].replace(
                /(\d)(?=(\d\d\d)+(?!\d))/g,
                '$1' + thousands
            );
            var centsAmount = parts[1] ? decimal + parts[1] : '';

            return dollarsAmount + centsAmount;
        }

        switch (formatString.match(placeholderRegex)[1]) {
            case 'amount':
                value = formatWithDelimiters(cents, 2);
                break;
            case 'amount_no_decimals':
                value = formatWithDelimiters(cents, 0);
                break;
            case 'amount_with_comma_separator':
                value = formatWithDelimiters(cents, 2, '.', ',');
                break;
            case 'amount_no_decimals_with_comma_separator':
                value = formatWithDelimiters(cents, 0, '.', ',');
                break;
            case 'amount_no_decimals_with_space_separator':
                value = formatWithDelimiters(cents, 0, ' ');
                break;
            case 'amount_with_apostrophe_separator':
                value = formatWithDelimiters(cents, 2, "'");
                break;
        }
        return formatString.replace(placeholderRegex, value);
    }

    return {
        formatMoney: formatMoney
    };
})();

/**
 * Image Helper Functions
 * -----------------------------------------------------------------------------
 * A collection of functions that help with basic image operations.
 *
 */

theme.Images = (function() {
    /**
     * Preloads an image in memory and uses the browsers cache to store it until needed.
     *
     * @param {Array} images - A list of image urls
     * @param {String} size - A shopify image size attribute
     */

    function preload(images, size) {
        if (typeof images === 'string') {
            images = [images];
        }

        for (var i = 0; i < images.length; i++) {
            var image = images[i];
            this.loadImage(this.getSizedImageUrl(image, size));
        }
    }

    /**
     * Loads and caches an image in the browsers cache.
     * @param {string} path - An image url
     */
    function loadImage(path) {
        new Image().src = path;
    }

    /**
     * Swaps the src of an image for another OR returns the imageURL to the callback function
     * @param image
     * @param element
     * @param callback
     */
    function switchImage(image, element, callback) {
        var size = this.imageSize(element.src);
        var imageUrl = this.getSizedImageUrl(image.src, size);

        if (callback) {
            callback(imageUrl, image, element); // eslint-disable-line callback-return
        } else {
            element.src = imageUrl;
        }
    }

    /**
     * +++ Useful
     * Find the Shopify image attribute size
     *
     * @param {string} src
     * @returns {null}
     */
    function imageSize(src) {
        src = src || '';

        var match = src.match(
            /.+_((?:pico|icon|thumb|small|compact|medium|large|grande)|\d{1,4}x\d{0,4}|x\d{1,4})[_\\.@]/
        );

        if (match === null) {
            return null;
        } else {
            return match[1];
        }
    }

    /**
     * +++ Useful
     * Adds a Shopify size attribute to a URL
     *
     * @param src
     * @param size
     * @returns {*}
     */
    function getSizedImageUrl(src, size) {
        if (size === null) {
            return src;
        }

        if (size === 'master') {
            return this.removeProtocol(src);
        }

        var match = src.match(
            /\.(jpg|jpeg|gif|png|bmp|bitmap|tiff|tif)(\?v=\d+)?$/i
        );

        if (match !== null) {
            var prefix = src.split(match[0]);
            var suffix = match[0];

            return this.removeProtocol(prefix[0] + '_' + size + suffix);
        }

        return null;
    }

    function removeProtocol(path) {
        return path.replace(/http(s)?:/, '');
    }

    return {
        preload: preload,
        loadImage: loadImage,
        switchImage: switchImage,
        imageSize: imageSize,
        getSizedImageUrl: getSizedImageUrl,
        removeProtocol: removeProtocol
    };
})();

/**
 * Variant Selection scripts
 * ------------------------------------------------------------------------------
 *
 * Handles change events from the variant inputs in any `cart/add` forms that may
 * exist.  Also updates the master select and triggers updates when the variants
 * price or image changes.
 *
 * @namespace variants
 */

slate.Variants = (function() {
    /**
     * Variant constructor
     *
     * @param {object} options - Settings from `product.js`
     */
    function Variants(options) {
        this.$container = options.$container;
        this.product = options.product;
        this.singleOptionSelector = options.singleOptionSelector;
        this.originalSelectorId = options.originalSelectorId;
        this.enableHistoryState = options.enableHistoryState;
        this.currentVariant = this._getVariantFromOptions();

        $(this.singleOptionSelector, this.$container).on(
            'change',
            this._onSelectChange.bind(this)
        );
    }

    Variants.prototype = _.assignIn({}, Variants.prototype, {
        /**
         * Get the currently selected options from add-to-cart form. Works with all
         * form input elements.
         *
         * @return {array} options - Values of currently selected variants
         */
        _getCurrentOptions: function() {
            var currentOptions = _.map(
                $(this.singleOptionSelector, this.$container),
                function(element) {
                    var $element = $(element);
                    var type = $element.attr('type');
                    var currentOption = {};

                    if (type === 'radio' || type === 'checkbox') {
                        if ($element[0].checked) {
                            currentOption.value = $element.val();
                            currentOption.index = $element.data('index');

                            return currentOption;
                        } else {
                            return false;
                        }
                    } else {
                        currentOption.value = $element.val();
                        currentOption.index = $element.data('index');

                        return currentOption;
                    }
                }
            );

            // remove any unchecked input values if using radio buttons or checkboxes
            currentOptions = _.compact(currentOptions);

            return currentOptions;
        },

        /**
         * Find variant based on selected values.
         *
         * @param  {array} selectedValues - Values of variant inputs
         * @return {object || undefined} found - Variant object from product.variants
         */
        _getVariantFromOptions: function() {
            var selectedValues = this._getCurrentOptions();
            var variants = this.product.variants;

            var found = _.find(variants, function(variant) {
                return selectedValues.every(function(values) {
                    return _.isEqual(variant[values.index], values.value);
                });
            });

            return found;
        },

        /**
         * Event handler for when a variant input changes.
         */
        _onSelectChange: function() {
            var variant = this._getVariantFromOptions();

            this.$container.trigger({
                type: 'variantChange',
                variant: variant
            });

            if (!variant) {
                return;
            }

            this._updateMasterSelect(variant);
            this._updateImages(variant);
            this._updatePrice(variant);
            this._updateSKU(variant);
            this.currentVariant = variant;

            if (this.enableHistoryState) {
                this._updateHistoryState(variant);
            }
        },

        /**
         * Trigger event when variant image changes
         *
         * @param  {object} variant - Currently selected variant
         * @return {event}  variantImageChange
         */
        _updateImages: function(variant) {
            var variantImage = variant.featured_image || {};
            var currentVariantImage = this.currentVariant.featured_image || {};

            if (!variant.featured_image ||
                variantImage.src === currentVariantImage.src
            ) {
                return;
            }

            this.$container.trigger({
                type: 'variantImageChange',
                variant: variant
            });
        },

        /**
         * Trigger event when variant price changes.
         *
         * @param  {object} variant - Currently selected variant
         * @return {event} variantPriceChange
         */
        _updatePrice: function(variant) {
            if (
                variant.price === this.currentVariant.price &&
                variant.compare_at_price === this.currentVariant.compare_at_price
            ) {
                return;
            }

            this.$container.trigger({
                type: 'variantPriceChange',
                variant: variant
            });
        },

        /**
         * Trigger event when variant sku changes.
         *
         * @param  {object} variant - Currently selected variant
         * @return {event} variantSKUChange
         */
        _updateSKU: function(variant) {
            if (variant.sku === this.currentVariant.sku) {
                return;
            }

            this.$container.trigger({
                type: 'variantSKUChange',
                variant: variant
            });
        },

        /**
         * Update history state for product deeplinking
         *
         * @param  {variant} variant - Currently selected variant
         * @return {k}         [description]
         */
        _updateHistoryState: function(variant) {
            if (!history.replaceState || !variant) {
                return;
            }

            var newurl =
                window.location.protocol +
                '//' +
                window.location.host +
                window.location.pathname +
                '?variant=' +
                variant.id;
            window.history.replaceState({ path: newurl }, '', newurl);
        },

        /**
         * Update hidden master select of variant change
         *
         * @param  {variant} variant - Currently selected variant
         */
        _updateMasterSelect: function(variant) {
            $(this.originalSelectorId, this.$container).val(variant.id);
        }
    });

    return Variants;
})();


/*================ MODULES ================*/
window.Drawers = (function() {
    var Drawer = function(id, position, options) {
        var defaults = {
            close: '.js-drawer-close',
            open: '.js-drawer-open-' + position,
            openClass: 'js-drawer-open',
            dirOpenClass: 'js-drawer-open-' + position
        };

        this.nodes = {
            $parent: $('body, html'),
            $page: $('.page-element'),
            $moved: $('.is-moved-by-drawer')
        };

        this.config = $.extend(defaults, options);
        this.position = position;

        this.$drawer = $('#' + id);
        this.$open = $(this.config.open);

        if (!this.$drawer.length) {
            return false;
        }

        this.drawerIsOpen = false;
        this.init();
    };

    Drawer.prototype.init = function() {
        this.$open.attr('aria-expanded', 'false');
        this.$open.on('click', $.proxy(this.open, this));
        this.$drawer.find(this.config.close).on('click', $.proxy(this.close, this));
    };

    Drawer.prototype.open = function(evt) {
        // Keep track if drawer was opened from a click, or called by another function
        var externalCall = false;

        // don't open an opened drawer
        if (this.drawerIsOpen) {
            return;
        }

        this.$open.addClass(this.config.openClass);

        // Prevent following href if link is clicked
        if (evt) {
            evt.preventDefault();
        } else {
            externalCall = true;
        }

        // Without this, the drawer opens, the click event bubbles up to $nodes.page
        // which closes the drawer.
        if (evt && evt.stopPropagation) {
            evt.stopPropagation();
            // save the source of the click, we'll focus to this on close
            this.$activeSource = $(evt.currentTarget);
        }

        if (this.drawerIsOpen && !externalCall) {
            return this.close();
        }

        // Add is-transitioning class to moved elements on open so drawer can have
        // transition for close animation
        this.nodes.$moved.addClass('is-transitioning');
        this.$drawer.prepareTransition();

        this.nodes.$parent.addClass(
            this.config.openClass + ' ' + this.config.dirOpenClass
        );
        this.drawerIsOpen = true;

        // Set focus on drawer
        slate.a11y.trapFocus({
            $container: this.$drawer,
            namespace: 'drawer_focus'
        });

        // Run function when draw opens if set
        if (
            this.config.onDrawerOpen &&
            typeof this.config.onDrawerOpen === 'function'
        ) {
            if (!externalCall) {
                this.config.onDrawerOpen();
            }
        }

        if (this.$activeSource && this.$activeSource.attr('aria-expanded')) {
            this.$activeSource.attr('aria-expanded', 'true');
        }

        this.bindEvents();
    };

    Drawer.prototype.close = function() {
        // don't close a closed drawer
        if (!this.drawerIsOpen) {
            return;
        }

        this.$open.removeClass(this.config.openClass);

        // deselect any focused form elements
        $(document.activeElement).trigger('blur');

        // Ensure closing transition is applied to moved elements, like the nav
        this.nodes.$moved.prepareTransition({ disableExisting: true });
        this.$drawer.prepareTransition({ disableExisting: true });

        this.nodes.$parent.removeClass(
            this.config.dirOpenClass + ' ' + this.config.openClass
        );

        this.drawerIsOpen = false;

        // Remove focus on drawer
        slate.a11y.removeTrapFocus({
            $container: this.$drawer,
            namespace: 'drawer_focus'
        });

        if (this.$activeSource && this.$activeSource.attr('aria-expanded')) {
            this.$activeSource.attr('aria-expanded', 'false');
        }

        this.unbindEvents();
    };

    Drawer.prototype.bindEvents = function() {
        // Lock scrolling on mobile
        this.nodes.$page.on('touchmove.drawer', function() {
            return false;
        });

        // Clicking out of drawer closes it
        this.nodes.$page.on(
            'click.drawer',
            $.proxy(function() {
                this.close();
                return false;
            }, this)
        );

        // Pressing escape closes drawer
        this.nodes.$parent.on(
            'keyup.drawer',
            $.proxy(function(evt) {
                if (evt.keyCode === 27) {
                    this.close();
                }
            }, this)
        );
    };

    Drawer.prototype.unbindEvents = function() {
        this.nodes.$page.off('.drawer');
        this.nodes.$parent.off('.drawer');
    };

    return Drawer;
})();

window.Modals = (function() {
    var Modal = function(id, name, options) {
        var defaults = {
            close: '.js-modal-close',
            open: '.js-modal-open-' + name,
            openClass: 'modal--is-active'
        };

        this.$modal = $('#' + id);

        if (!this.$modal.length) {
            return false;
        }

        this.nodes = {
            $body: $('body')
        };

        this.config = $.extend(defaults, options);

        this.modalIsOpen = false;
        this.$focusOnOpen = this.config.focusOnOpen ?
            $(this.config.focusOnOpen) :
            this.$modal;
        this.init();
    };

    Modal.prototype.init = function() {
        var $openBtn = $(this.config.open);

        // Add aria controls
        $openBtn.attr('aria-expanded', 'false');

        $(this.config.open).on('click', $.proxy(this.open, this));
        this.$modal.find(this.config.close).on('click', $.proxy(this.close, this));
    };

    Modal.prototype.open = function(evt) {
        // Keep track if modal was opened from a click, or called by another function
        var externalCall = false;

        // don't open an opened modal
        if (this.modalIsOpen) {
            return;
        }

        // Prevent following href if link is clicked
        if (evt) {
            evt.preventDefault();
        } else {
            externalCall = true;
        }

        // Without this, the modal opens, the click event bubbles up to $nodes.page
        // which closes the modal.
        if (evt && evt.stopPropagation) {
            evt.stopPropagation();
            // save the source of the click, we'll focus to this on close
            this.$activeSource = $(evt.currentTarget);
        }

        if (this.modalIsOpen && !externalCall) {
            return this.close();
        }

        this.$modal.prepareTransition().addClass(this.config.openClass);
        this.nodes.$body.addClass(this.config.openClass);

        this.modalIsOpen = true;

        // Set focus on modal
        slate.a11y.trapFocus({
            $container: this.$modal,
            namespace: 'modal_focus',
            $elementToFocus: this.$focusOnOpen
        });

        if (this.$activeSource && this.$activeSource.attr('aria-expanded')) {
            this.$activeSource.attr('aria-expanded', 'true');
        }

        this.bindEvents();
    };

    Modal.prototype.close = function() {
        // don't close a closed modal
        if (!this.modalIsOpen) {
            return;
        }

        // deselect any focused form elements
        $(document.activeElement).trigger('blur');

        this.$modal.prepareTransition().removeClass(this.config.openClass);
        this.nodes.$body.removeClass(this.config.openClass);

        this.modalIsOpen = false;

        // Remove focus on modal
        slate.a11y.removeTrapFocus({
            $container: this.$modal,
            namespace: 'modal_focus'
        });

        if (this.$activeSource && this.$activeSource.attr('aria-expanded')) {
            this.$activeSource.attr('aria-expanded', 'false').focus();
        }

        this.unbindEvents();
    };

    Modal.prototype.bindEvents = function() {
        // Pressing escape closes modal
        this.nodes.$body.on(
            'keyup.modal',
            $.proxy(function(evt) {
                if (evt.keyCode === 27) {
                    this.close();
                }
            }, this)
        );
    };

    Modal.prototype.unbindEvents = function() {
        this.nodes.$body.off('.modal');
    };

    return Modal;
})();

window.QtySelector = (function() {
    var QtySelector = function($el) {
        this.cache = {
            $body: $('body'),
            $subtotal: $('#CartSubtotal'),
            $discountTotal: $('#cartDiscountTotal'),
            $cartTable: $('.cart-table'),
            $cartTemplate: $('#CartProducts')
        };

        this.settings = {
            loadingClass: 'js-qty--is-loading',
            isCartTemplate: this.cache.$body.hasClass('template-cart'),
            // On the cart template, minimum is 0. Elsewhere min is 1
            minQty: this.cache.$body.hasClass('template-cart') ? 0 : 1
        };

        this.$el = $el;
        this.qtyUpdateTimeout;
        this.createInputs();
        this.bindEvents();
    };

    QtySelector.prototype.createInputs = function() {
        var $el = this.$el;

        var data = {
            value: $el.val(),
            key: $el.attr('id'),
            name: $el.attr('name'),
            line: $el.attr('data-line')
        };
        var source = $('#QuantityTemplate').html();
        var template = Handlebars.compile(source);

        this.$wrapper = $(template(data)).insertBefore($el);

        // Remove original number input
        $el.remove();
    };

    QtySelector.prototype.validateAvailability = function(line, quantity) {
        var product = theme.cartObject.items[line - 1]; // 0-based index in API
        var handle = product.handle; // needed for the ajax request
        var id = product.id; // needed to find right variant from ajax results

        var params = {
            type: 'GET',
            url: '/products/' + handle + '.js',
            dataType: 'json',
            success: $.proxy(function(cartProduct) {
                this.validateAvailabilityCallback(line, quantity, id, cartProduct);
            }, this)
        };

        $.ajax(params);
    };

    QtySelector.prototype.validateAvailabilityCallback = function(
        line,
        quantity,
        id,
        product
    ) {
        var quantityIsAvailable = true;

        // This returns all variants of a product.
        // Loop through them to get our desired one.
        for (var i = 0; i < product.variants.length; i++) {
            var variant = product.variants[i];
            if (variant.id === id) {
                break;
            }
        }

        // If the variant tracks inventory and does not sell when sold out
        // we can compare the requested with available quantity
        if (
            variant.inventory_management !== null &&
            variant.inventory_policy === 'deny'
        ) {
            if (variant.inventory_quantity < quantity) {

                // Set quantity to max amount available
                this.$wrapper.find('.js-qty__input').val(variant.inventory_quantity);

                quantityIsAvailable = false;
                this.$wrapper.removeClass(this.settings.loadingClass);
            }
        }

        if (quantityIsAvailable) {
            this.updateItemQuantity(line, quantity);
        }
    };

    QtySelector.prototype.validateQty = function(qty) {
        if (parseFloat(qty) === parseInt(qty, 10) && !isNaN(qty)) {
            // We have a valid number!
        } else {
            // Not a number. Default to 1.
            qty = 1;
        }
        return parseInt(qty, 10);
    };

    QtySelector.prototype.adjustQty = function(evt) {
        var $el = $(evt.currentTarget);
        var $input = $el.siblings('.js-qty__input');
        var qty = this.validateQty($input.val());
        var line = $input.attr('data-line');

        if ($el.hasClass('js-qty__adjust--minus')) {
            qty -= 1;
            if (qty <= this.settings.minQty) {
                qty = this.settings.minQty;
            }
        } else {
            qty += 1;
        }

        if (this.settings.isCartTemplate) {
            $el.parent().addClass(this.settings.loadingClass);
            this.updateCartItemPrice(line, qty);
        } else {
            $input.val(qty);
        }
    };

    QtySelector.prototype.bindEvents = function() {
        this.$wrapper
            .find('.js-qty__adjust')
            .on('click', $.proxy(this.adjustQty, this));

        // Select input text on click
        this.$wrapper.on('click', '.js-qty__input', function() {
            this.setSelectionRange(0, this.value.length);
        });

        // If the quantity changes on the cart template, update the price
        if (this.settings.isCartTemplate) {
            this.$wrapper.on(
                'change',
                '.js-qty__input',
                $.proxy(function(evt) {
                    var $input = $(evt.currentTarget);
                    var line = $input.attr('data-line');
                    var qty = this.validateQty($input.val());
                    $input.parent().addClass(this.settings.loadingClass);
                    this.updateCartItemPrice(line, qty);
                }, this)
            );
        }
    };

    QtySelector.prototype.updateCartItemPrice = function(line, qty) {
        // Update cart after short timeout so user doesn't create simultaneous ajax calls
        clearTimeout(this.qtyUpdateTimeout);
        this.qtyUpdateTimeout = setTimeout(
            $.proxy(function() {
                this.validateAvailability(line, qty);
            }, this),
            200
        );
    };

    QtySelector.prototype.updateItemQuantity = function(line, quantity) {
        var params = {
            type: 'POST',
            url: '/cart/change.js',
            data: 'quantity=' + quantity + '&line=' + line,
            dataType: 'json',
            success: $.proxy(function(cart) {
                this.updateCartItemCallback(cart);
            }, this)
        };

        $.ajax(params);
    };

    QtySelector.prototype.updateCartItemCallback = function(cart) {
        // Reload the page to show the empty cart if no items
        if (cart.item_count === 0) {
            location.reload();
            return;
        }

        // Update cart object
        theme.cartObject = cart;

        // Handlebars.js cart layout
        var data = {};
        var items = [];
        var item = {};
        var source = $('#CartProductTemplate').html();
        var template = Handlebars.compile(source);
        var prodImg;

        // Add each item to our handlebars.js data
        $.each(cart.items, function(index, cartItem) {
            /* Hack to get product image thumbnail
             *   - If image is not null
             *     - Remove file extension, add 240x240, and re-add extension
             *     - Create server relative link
             *   - A hard-coded url of no-image
             */

            if (cartItem.image === null) {
                prodImg =
                    '//cdn.shopify.com/s/assets/admin/no-image-medium-cc9732cb976dd349a0df1d39816fbcc7.gif';
            } else {
                prodImg = cartItem.image
                    .replace(/(\.[^.]*)$/, '_240x240$1')
                    .replace('http:', '');
            }

            if (cartItem.properties !== null) {
                $.each(cartItem.properties, function(key, value) {
                    if (key.charAt(0) === '_' || !value) {
                        delete cartItem.properties[key];
                    }
                });
            }

            // Create item's data object and add to 'items' array
            item = {
                key: cartItem.key,
                line: index + 1, // Shopify uses a 1+ index in the API
                url: cartItem.url,
                img: prodImg,
                name: cartItem.product_title,
                variation: cartItem.variant_title,
                properties: cartItem.properties,
                itemQty: cartItem.quantity,
                price: theme.Currency.formatMoney(cartItem.price, theme.moneyFormat),
                vendor: cartItem.vendor,
                linePrice: theme.Currency.formatMoney(
                    cartItem.line_price,
                    theme.moneyFormat
                ),
                originalLinePrice: theme.Currency.formatMoney(
                    cartItem.original_line_price,
                    theme.moneyFormat
                ),
                discounts: cartItem.discounts,
                discountsApplied: cartItem.line_price === cartItem.original_line_price ? false : true
            };

            items.push(item);
            theme.updateCurrencies();
        });

        // Gather all cart data and add to DOM
        data = {
            items: items
        };
        this.cache.$cartTemplate.empty().append(template(data));

        // Create new quantity selectors
        this.cache.$cartTable.find('input[type="number"]').each(function(i, el) {
            new QtySelector($(el));
        });

        // Update the cart subtotal
        this.cache.$subtotal.html(
            theme.Currency.formatMoney(cart.total_price, theme.moneyFormat)
        );

        // Update the cart total discounts
        if (cart.total_discount > 0) {
            this.cache.$discountTotal.html(
                theme.strings.totalCartDiscount.replace(
                    '[savings]',
                    theme.Currency.formatMoney(cart.total_discount, theme.moneyFormat)
                )
            );
        } else {
            this.cache.$discountTotal.empty();
        }

        theme.miniCart.updateElements();
        theme.updateCurrencies();
        // Set focus on cart table
        slate.a11y.pageLinkFocus(this.cache.$cartTable);
    };

    return QtySelector;
})();

/*
  Allow product to be added to cart via ajax with
  custom success and error responses.
*/
window.AjaxCart = (function() {
    var styleCart = $('.js-mini-cart').attr("data-cartmini");
    var cart = function($form) {
        this.cache = {
            $cartIconIndicator: $('.site-header__cart-indicator')
        };

        this.$form = $form;
        this.eventListeners();

        this.showNotice = false;
        if (this.$form.length) {
            this.showNotice = this.$form.hasClass('js-form--notice') ? true : false;
        }
    };

    cart.prototype.eventListeners = function() {
        if (this.$form.length) {
            this.$form.on('submit', $.proxy(this.addItemFromForm, this));
        }
    };

    cart.prototype.addItemFromForm = function(evt) {
        evt.preventDefault();

        var params = {
            type: 'POST',
            url: '/cart/add.js',
            data: this.$form.serialize(),
            dataType: 'json',
            success: $.proxy(function(lineItem) {
                //this.success(lineItem);
                window.location.href = '/cart';
            }, this),
            error: $.proxy(function(XMLHttpRequest, textStatus) {
                this.error(XMLHttpRequest, textStatus);
            }, this)
        };
        $.ajax(params);
    };

    cart.prototype.success = function(item) {
        theme.miniCart.updateElements();
        theme.miniCart.generateCart();
        if (styleCart != 'false') {
            if (this.showNotice) {
                var htmlVariant = item.variant_title !== null ? '<i>(' + item.variant_title + ')</i>' : '';
                var htmlAlert = '<div class="media mt-2 alert--cart"><a class="mr-3" href="/cart"><img class="lazyload" data-src="' + item.image + '"></a><div class="media-body align-self-center"><p class="m-0 font-weight-bold">' + item.product_title + ' x ' + item.quantity + '</p>' + htmlVariant + '<div><div>';
                theme.alert.new(theme.strings.addToCartSuccess, htmlAlert, 3000, 'notice');
            } else {
                theme.crosssell.showPopup(item);
            }
        }
    };

    // Error handling reference from Shopify.onError in api.jquery.js
    cart.prototype.error = function(XMLHttpRequest) {
        var data = JSON.parse(XMLHttpRequest.responseText);

        if (data.message) {
            theme.alert.new('', data.description, 3000, 'warning');
        }
    };

    return cart;
})();

/*================ TEMPLATES ================*/
theme.customerTemplates = (function() {
    function initEventListeners() {
        // Show reset password form
        $('#RecoverPassword').on('click', function(evt) {
            evt.preventDefault();
            toggleRecoverPasswordForm();
        });

        // Hide reset password form
        $('#HideRecoverPasswordLink').on('click', function(evt) {
            evt.preventDefault();
            toggleRecoverPasswordForm();
        });
    }

    /**
     *
     *  Show/Hide recover password form
     *
     */
    function toggleRecoverPasswordForm() {
        $('#RecoverPasswordForm').toggleClass('hide');
        $('#CustomerLoginForm').toggleClass('hide');
    }

    /**
     *
     *  Show reset password success message
     *
     */
    function resetPasswordSuccess() {
        // check if reset password form was successfully submited
        if (!$('.reset-password-success').length) {
            return;
        }

        // show success message
        $('#ResetSuccess').removeClass('hide');
    }

    /**
     *
     *  Show/hide customer address forms
     *
     */
    function customerAddressForm() {
        var $newAddressForm = $('#AddressNewForm');

        if (!$newAddressForm.length) {
            return;
        }

        // Initialize observers on address selectors, defined in shopify_common.js
        if (Shopify) {
            // eslint-disable-next-line no-new
            new Shopify.CountryProvinceSelector(
                'AddressCountryNew',
                'AddressProvinceNew', {
                    hideElement: 'AddressProvinceContainerNew'
                }
            );
        }

        // Initialize each edit form's country/province selector
        $('.address-country-option').each(function() {
            var formId = $(this).data('form-id');
            var countrySelector = 'AddressCountry_' + formId;
            var provinceSelector = 'AddressProvince_' + formId;
            var containerSelector = 'AddressProvinceContainer_' + formId;

            // eslint-disable-next-line no-new
            new Shopify.CountryProvinceSelector(countrySelector, provinceSelector, {
                hideElement: containerSelector
            });
        });

        // Toggle new/edit address forms
        $('.address-new-toggle').on('click', function() {
            $newAddressForm.toggleClass('hide');
        });

        $('.address-edit-toggle').on('click', function() {
            var formId = $(this).data('form-id');
            $('#EditAddress_' + formId).toggleClass('hide');
        });

        $('.address-delete').on('click', function() {
            var $el = $(this);
            var formId = $el.data('form-id');
            var confirmMessage = $el.data('confirm-message');

            // eslint-disable-next-line no-alert
            if (
                confirm(
                    confirmMessage || 'Are you sure you wish to delete this address?'
                )
            ) {
                Shopify.postLink('/account/addresses/' + formId, {
                    parameters: { _method: 'delete' }
                });
            }
        });
    }

    /**
     *
     *  Check URL for reset password hash
     *
     */
    function checkUrlHash() {
        var hash = window.location.hash;

        // Allow deep linking to recover password form
        if (hash === '#recover') {
            toggleRecoverPasswordForm();
        }
    }

    return {
        init: function() {
            checkUrlHash();
            initEventListeners();
            resetPasswordSuccess();
            customerAddressForm();
        }
    };
})();

/*================ SECTIONS ================*/
theme.HeaderSection = (function() {
    function Header() {
        theme.NavDrawer = new window.Drawers('NavDrawer', 'left');
    }

    return Header;
})();

theme.Product = (function() {
    var defaults = {
        smallBreakpoint: 750,
        productThumbIndex: 0,
        productThumbMax: 0,
        ajaxCart: false,
        stockSetting: false
    };

    function Product(container) {
        var $container = (this.$container = $(container));
        var sectionId = $container.attr('data-section-id');

        this.selectors = {
            originalSelectorId: '#ProductSelect-' + sectionId,
            modal: 'ProductModal',
            productZoomImage: '#ProductZoomImg',
            addToCart: '#AddToCart-' + sectionId,
            productPrice: '#ProductPrice-' + sectionId,
            comparePrice: '#ComparePrice-' + sectionId,
            addToCartText: '#AddToCartText-' + sectionId,
            SKU: '.js-variant-sku',
            productImageContainers: '.product__photo-container-' + sectionId,
            productImageWrappers: '.product__photo-wrapper-' + sectionId,
            productThumbContainers: '.product-single__thumbnail-item-' + sectionId,
            productThumbsWrapper: '.product-single__thumbnails-' + sectionId,
            productThumbs: '.product-single__thumbnail-' + sectionId,
            saleTag: '#ProductSaleTag-' + sectionId,
            productStock: '#ProductStock-' + sectionId,
            singleOptionSelector: '.single-option-selector-' + sectionId,
            shopifyPaymentButton: '.shopify-payment-button',
            availability: '.product-single__availability',
            hurrify: '.js-hurrify'
        };

        this.settings = $.extend({}, defaults, {
            sectionId: sectionId,
            ajaxCart: $container.data('ajax'),
            stockSetting: $container.data('stock'),
            enableHistoryState: $container.data('enable-history-state') || false,
            namespace: '.product-' + sectionId
        });

        // Stop parsing if we don't have the product json script tag
        if (!$('#ProductJson-' + sectionId).html()) {
            return;
        }

        this.productSingleObject = JSON.parse(
            $('#ProductJson-' + sectionId).html()
        );
        this.addVariantInfo();

        this.init();
    }

    Product.prototype = _.assignIn({}, Product.prototype, {
        init: function() {
            this._stringOverrides();
            this._initVariants();
            this._productZoomImage();
            this._productThumbSwitch();
            this._productThumbnailSlider();
            this._initQtySelector();

            if (this.settings.ajaxCart) {
                theme.AjaxCart = new window.AjaxCart(
                    $('#AddToCartForm-' + this.settings.sectionId)
                );
            }
        },

        _stringOverrides: function() {
            window.productStrings = window.productStrings || {};
            $.extend(theme.strings, window.productStrings);
        },

        addVariantInfo: function() {
            if (!this.productSingleObject || !this.settings.stockSetting) {
                return;
            }

            var variantInfo = JSON.parse(
                $('#VariantJson-' + this.settings.sectionId).html()
            );

            for (var i = 0; i < variantInfo.length; i++) {
                $.extend(this.productSingleObject.variants[i], variantInfo[i]);
            }
        },

        _initVariants: function() {
            var options = {
                $container: this.$container,
                enableHistoryState: this.settings.enableHistoryState,
                product: this.productSingleObject,
                singleOptionSelector: this.selectors.singleOptionSelector,
                originalSelectorId: this.selectors.originalSelectorId
            };

            // eslint-disable-next-line no-new
            this.variants = new slate.Variants(options);

            this.$container.on(
                'variantChange' + this.settings.namespace,
                this._updateAddToCartBtn.bind(this)
            );
            this.$container.on(
                'variantChange' + this.settings.namespace,
                this._updateStickyCart.bind(this)
            );
            this.$container.on(
                'variantPriceChange' + this.settings.namespace,
                this._updatePrice.bind(this)
            );
            this.$container.on(
                'variantSKUChange' + this.settings.namespace,
                this._updateSKU.bind(this)
            );
            this.$container.on(
                'variantImageChange' + this.settings.namespace,
                this._updateImages.bind(this)
            );
        },

        _updateStock: function(variant) {
            if (!this.settings.stockSetting) return;

            var $stock = $(this.selectors.productStock),
                $hurrify = $(this.selectors.hurrify);

            // If we don't track variant inventory, hide stock
            if (!variant || !variant.inventory_management) {
                $stock.addClass('hide');
                $hurrify.addClass('hide');
                return;
            }

            if (variant.inventory_quantity < 10 && variant.inventory_quantity > 0) {
                $stock
                    .html(
                        theme.strings.stockAvailable.replace(
                            '1',
                            variant.inventory_quantity
                        )
                    )
                    .removeClass('hide');
                $hurrify.removeClass('hide').find('.progress-bar').css('width', variant.inventory_quantity * 10 + '%');
                return;
            }

            if (variant.inventory_quantity <= 0 && variant.incoming) {
                $stock
                    .html(
                        theme.strings.willNotShipUntil.replace(
                            '[date]',
                            variant.next_incoming_date
                        )
                    )
                    .removeClass('hide');
                $hurrify.addClass('hide');
                return;
            }

            // If there's more than 10 available, hide stock
            $stock.addClass('hide');
            $hurrify.addClass('hide');
        },

        _updateIncomingInfo: function(variant) {
            if (!this.settings.stockSetting) return;

            var $stock = $(this.selectors.productStock);

            if (variant.incoming) {
                $stock
                    .html(
                        theme.strings.willBeInStockAfter.replace(
                            '[date]',
                            variant.next_incoming_date
                        )
                    )
                    .removeClass('hide');
                return;
            }

            // If there is no stock incoming, hide stock
            $stock.addClass('hide');
        },

        _updateAddToCartBtn: function(evt) {
            var variant = evt.variant;

            var cache = {
                $addToCart: $(this.selectors.addToCart),
                $addToCartText: $(this.selectors.addToCartText)
            };

            if (variant) {
                // Select a valid variant if available
                theme.noticeSoldout.init(variant);
                if (variant.available) {
                    // We have a valid product variant, so enable the submit button
                    cache.$addToCart.removeClass('btn--sold-out').prop('disabled', false);
                    cache.$addToCartText.html(theme.strings.addToCart);
                    $(this.selectors.shopifyPaymentButton, this.$container).show();
                    // Show how many items are left, if below 10
                    this._updateStock(variant);
                    //update availability - available
                    $(this.selectors.availability).find('span').text(theme.strings.available);
                } else {
                    // Variant is sold out, disable the submit button
                    cache.$addToCart.prop('disabled', true).addClass('btn--sold-out');
                    cache.$addToCartText.html(theme.strings.soldOut);
                    $(this.selectors.shopifyPaymentButton, this.$container).hide();
                    // Update when stock will be available
                    this._updateIncomingInfo(variant);
                    //update availability - soldout
                    $(this.selectors.availability).find('span').text(theme.strings.soldOut);
                }
            } else {
                cache.$addToCart.prop('disabled', true).removeClass('btn--sold-out');
                cache.$addToCartText.html(theme.strings.unavailable);
                //update availability - unavailable
                $(this.selectors.availability).find('span').text(theme.strings.unavailable);
                $(this.selectors.shopifyPaymentButton, this.$container).hide();
                // Hide stock display
                this._updateStock();
            }
        },

        _updatePrice: function(evt) {
            var variant = evt.variant;

            if (variant) {
                $(this.selectors.productPrice).html(
                    theme.Currency.formatMoney(variant.price, theme.moneyFormat)
                );

                // Update and show the product's compare price if necessary
                if (variant.compare_at_price > variant.price) {
                    $(this.selectors.comparePrice)
                        .html(
                            theme.Currency.formatMoney(
                                variant.compare_at_price,
                                theme.moneyFormat
                            )
                        )
                        .removeClass('hide');
                    $(this.selectors.saleTag).removeClass('hide');
                } else {
                    $(this.selectors.comparePrice).addClass('hide');
                    $(this.selectors.saleTag).addClass('hide');
                }

                theme.updateCurrencies();
            } else {
                $(this.selectors.comparePrice).addClass('hide');
            }
        },

        _updateSKU: function(evt) {
            var variant = evt.variant;

            if (variant) {
                $(this.selectors.SKU).html(variant.sku);
            }
        },

        _updateImages: function(evt) {
            var variant = evt.variant;

            if (variant && variant.featured_image) {
                var imageId = variant.featured_image.id;
                this.switchProductImage(imageId);
                this.setActiveThumbnail(imageId);
            }
        },
        _updateStickyCart: function(evt) {
            var variant = evt.variant,
                $stickyPrice = $('#js-sticky-price'),
                $stickyTitle = $('#js-sticky-title'),
                $stickyImage = $('#js-sticky-img'),
                $stickyButton = $('#js-sticky-btn');
            if (variant) {
                //update title
                $stickyTitle.html(' - ' + variant.title);
                //update price
                $stickyPrice.html(theme.Currency.formatMoney(variant.price, theme.moneyFormat));
                //update selectbox
                for (var i = 1; i <= 3; i++) {
                    var option = 'option' + i,
                        $selecBox = '#js-sticky-option-' + i;
                    if (variant[option] !== null) {
                        var valueOption = variant[option];
                        $($selecBox).val(valueOption);
                    }
                }
                //update button cart
                if (variant.available) {
                    $stickyButton.prop('disabled', false).removeClass('btn--sold-out');
                    $stickyButton.html(theme.strings.addToCart);
                } else {
                    $stickyButton.prop('disabled', true).addClass('btn--sold-out');
                    $stickyButton.html(theme.strings.soldOut);
                }
                //update image
                if (variant.featured_image) {
                    $stickyImage.attr('src', theme.Images.getSizedImageUrl(variant.featured_image.src, '200x'));
                }
            } else {
                //update title
                $stickyTitle.html(' - ' + theme.strings.unavailable);
                //update button cart
                $stickyButton.prop('disabled', true).removeClass('btn--sold-out');
                $stickyButton.html(theme.strings.unavailable);
            }
        },

        switchProductImage: function(imageId) {
            var $imageToShow = $(
                this.selectors.productImageContainers +
                "[data-image-id='" +
                imageId +
                "']",
                this.$container
            );
            var $imagesToHide = $(
                this.selectors.productImageContainers +
                ":not([data-image-id='" +
                imageId +
                "'])",
                this.$container
            );
            $imagesToHide.addClass('hide');
            $imageToShow.removeClass('hide');
            //Scroll to active
            topMenuHeight = $('.site-header').outerHeight();
            if (this.settings.sectionId === 'product-template-8') {
                $([document.documentElement, document.body]).animate({
                    scrollTop: $imageToShow.offset().top - topMenuHeight
                }, 500);
            }
        },

        setActiveThumbnail: function(imageId) {
            var $thumbnailToShow = $(
                this.selectors.productThumbContainers +
                "[data-image-id='" +
                imageId +
                "']",
                this.$container
            );
            var $thumbnailsToHide = $(
                this.selectors.productThumbContainers +
                ":not([data-image-id='" +
                imageId +
                "'])",
                this.$container
            );
            $thumbnailsToHide.removeClass('is-active');
            $thumbnailToShow.addClass('is-active');
            $thumbnailToShow.trigger('click');
            var $thumbnails = $(this.selectors.productThumbsWrapper, this.$container);

            // If there is a slick carousel, get the slide index, and position it into view with animation.
            if ($thumbnails.hasClass('slick-initialized')) {
                // eslint-disable-next-line shopify/jquery-dollar-sign-reference
                var currentActiveSlideIndex = $thumbnails.slick('slickCurrentSlide');
                var newActiveSlideIndex = parseInt(
                    $thumbnailToShow.attr('data-slick-index')
                );
                if (currentActiveSlideIndex !== newActiveSlideIndex) {
                    $thumbnails.slick('slickGoTo', newActiveSlideIndex, false);

                }
            }
        },

        _productZoomImage: function() {
            // The zoom image is only used on the product template, so return early
            // even if a featured product section is present.
            if (!$('.product-single ' + this.selectors.productImageContainers).length) {
                return;
            }

            var self = this;

            $(this.selectors.productImageWrappers).on(
                'click' + this.settings.namespace,
                function(evt) {
                    evt.preventDefault();
                    // Empty src before loadig new image to avoid awkward image swap
                    $(self.selectors.productZoomImage)
                        .attr('src', '')
                        .attr('src', $(this).attr('href'));
                }
            );

            this.ProductModal = new window.Modals(
                this.selectors.modal,
                'product-modal'
            );

            // Close modal if clicked, but not if the image is clicked
            this.ProductModal.$modal.on('click' + this.settings.namespace, function(
                evt
            ) {
                if (evt.target.nodeName !== 'IMG') {
                    self.ProductModal.close();
                }
            });
        },

        _productThumbSwitch: function() {
            if (!$(this.selectors.productThumbs).length) {
                return;
            }

            var self = this;

            $(this.selectors.productThumbs).on(
                'click' + this.settings.namespace,
                function(evt) {
                    evt.preventDefault();
                    var imageId = $(this)
                        .parent()
                        .data('image-id');
                    self.setActiveThumbnail(imageId);
                    self.switchProductImage(imageId);
                }
            );
            //trigger hover thumb
            // $(this.selectors.productThumbs).on('click',function(){
            //   $(this).trigger('click');
            // });
        },

        /*
          Thumbnail slider
         */
        _productThumbnailSlider: function() {
            var $productThumbsWrapper = $(this.selectors.productThumbsWrapper);
            var $productThumbs = $(this.selectors.productThumbs);
            if (!$productThumbs.length) {
                return;
            }

            if ($productThumbs.length > 1) {
                $productThumbsWrapper.on(
                    'init' + this.settings.namespace,
                    this._productSwipeInit.bind(this)
                );

                if (this.settings.sectionId === 'product-template-3' || this.settings.sectionId === 'product-template-4') {
                    $productThumbsWrapper.slick({
                        accessibility: false,
                        arrows: true,
                        dots: false,
                        infinite: false,
                        autoplay: false,
                        slidesToShow: 5,
                        slidesToScroll: 5,
                        vertical: true,
                        verticalSwiping: true,
                        responsive: [{
                            breakpoint: 992,
                            settings: {
                                vertical: false,
                                verticalSwiping: false,
                                slidesToShow: 4,
                                slidesToScroll: 4,
                                dots: false,
                            }
                        }]
                    }).css('opacity', '1');
                } else if (this.settings.sectionId === 'product-template-5') {
                    $productThumbsWrapper.slick({
                        accessibility: false,
                        arrows: true,
                        dots: false,
                        infinite: true,
                        autoplay: false,
                        slidesToShow: 2,
                        slidesToScroll: 1,
                        responsive: [{
                            breakpoint: 992,
                            settings: {
                                slidesToShow: 4,
                                slidesToScroll: 4,
                                dots: false,
                            }
                        }]
                    }).css('opacity', '1');
                } else if (this.settings.sectionId === 'product-template-7') {
                    $productThumbsWrapper.slick({
                        accessibility: false,
                        arrows: true,
                        dots: true,
                        infinite: true,
                        autoplay: false,
                        slidesToShow: 1,
                        slidesToScroll: 1,
                        responsive: [{
                            breakpoint: 992,
                            settings: {
                                slidesToShow: 1,
                                slidesToScroll: 1,
                                dots: false,
                                arrows: true,
                            }
                        }]
                    }).css('opacity', '1');
                } else if (this.settings.sectionId === 'product-template-8') {
                    var lastId,
                        topMenu = $(".product-single__thumbnails"),
                        topMenuHeight = $('.site-header').outerHeight() + 20,
                        // All list items
                        menuItems = topMenu.find(".product-single__thumbnail");


                    if ($(window).width() > 767) {
                        menuItems.click(function(e) {
                            var findid = $(this).attr('href');
                            offsetTop = $(findid).offset().top - topMenuHeight + 1;
                            $('html, body').stop().animate({
                                scrollTop: offsetTop
                            }, 200);
                            return false;
                        });
                        // Anchors corresponding to menu items
                        scrollItems = menuItems.map(function() {
                            var item = $($(this).attr('href'));
                            if (item.length) { return item; }
                        });

                        $(window).scroll(function() {
                            // Get container scroll position
                            var fromTop = $(this).scrollTop() + topMenuHeight;
                            // Get id of current scroll item
                            var cur = scrollItems.map(function() {
                                if ($(this).offset().top < fromTop)
                                    return this;
                            });
                            // Get the id of the current element
                            cur = cur[cur.length - 1];
                            var id = cur && cur.length ? cur[0].id : "";

                            if (lastId !== id) {
                                lastId = id;
                                // Set/remove active class
                                menuItems
                                    .parent().removeClass("is-active")
                                    .end().filter("[href='#" + id + "']").parent().addClass("is-active");
                            }
                        });
                    } else {
                        menuItems.click(function(e) {
                            var findid = $(this).attr('href');
                            offsetTop = $(findid).offset().top;
                            $('html, body').stop().animate({
                                scrollTop: offsetTop
                            });
                            return false;
                        });
                    }

                    $productThumbsWrapper.slick({
                        accessibility: false,
                        arrows: true,
                        dots: false,
                        infinite: false,
                        autoplay: false,
                        slidesToShow: 5,
                        slidesToScroll: 1,
                        vertical: true,
                        verticalSwiping: true,
                        responsive: [{
                            breakpoint: 992,
                            settings: {
                                vertical: false,
                                verticalSwiping: false,
                                slidesToShow: 4,
                                slidesToScroll: 4,
                                dots: true,
                            }
                        }]
                    }).css('opacity', '1');
                } else {
                    $productThumbsWrapper.slick({
                        accessibility: false,
                        arrows: true,
                        dots: false,
                        infinite: false,
                        autoplay: false,
                        slidesToShow: 4,
                        slidesToScroll: 4
                    }).css('opacity', '1');
                }

                // Show highlighted thumbnail by repositioning slider
                $productThumbsWrapper.slick(
                    'slickGoTo',
                    $productThumbsWrapper.find('.is-active').attr('data-slick-index'),
                    true
                );
            }
        },

        _productSwipeInit: function(evt, obj) {
            // Slider is initialized. Setup custom swipe events
            this.settings.productThumbIndex = obj.currentSlide;
            this.settings.productThumbMax = obj.slideCount - 1; // we need the 0-based index

            var self = this;

            $(this.selectors.productImageWrappers).on(
                'swipeleft swiperight',
                function(event) {
                    if (event.type === 'swipeleft') {
                        self._goToNextThumbnail();
                    }

                    if (event.type === 'swiperight') {
                        self._goToPrevThumbnail();
                    }

                    // Trigger click on newly requested thumbnail
                    $(
                            '.product-single__thumbnail-item[data-slick-index="' +
                            self.settings.productThumbIndex +
                            '"]'
                        )
                        .find('.product-single__thumbnail')
                        .trigger('click');

                }
            );
        },
        _goToNextThumbnail: function() {
            this.settings.productThumbIndex++;

            if (this.settings.productThumbIndex > this.settings.productThumbMax) {
                this.settings.productThumbIndex = 0;
            }

            $(this.selectors.productThumbsWrapper).slick(
                'slickGoTo',
                this.settings.productThumbIndex,
                true
            );
        },

        _goToPrevThumbnail: function() {
            this.settings.productThumbIndex--;

            if (this.settings.productThumbIndex < 0) {
                this.settings.productThumbIndex = this.settings.productThumbMax;
            }

            $(this.selectors.productThumbsWrapper).slick(
                'slickGoTo',
                this.settings.productThumbIndex,
                true
            );
        },

        _initQtySelector: function() {
            this.$container.find('.product-form__quantity').each(function(i, el) {
                // eslint-disable-next-line no-new
                new QtySelector($(el));
            });
        },

        onUnload: function() {
            $(this.selectors.productImageWrappers).off(this.settings.namespace);
            $(this.selectors.productThumbs).off(this.settings.namespace);
            $(this.selectors.productThumbs).slick('unslick');
            if (this.ProductModal) {
                this.ProductModal.$modal.off(this.settings.namespace);
            }
        }
    });

    return Product;
})();

theme.Slideshow = (function() {
    this.$slideshow = null;
    var classes = {
        slideshow: 'slideshow',
        slickActiveMobile: 'slick-active-mobile',
        controlsHover: 'slideshow__controls--hover',
        isPaused: 'is-paused'
    };

    var selectors = {
        section: '.shopify-section',
        wrapper: '#SlideshowWrapper-',
        slides: '.slideshow__slide',
        textWrapperMobile: '.slideshow__text-wrap--mobile',
        textContentMobile: '.slideshow__text-content--mobile',
        controls: '.slideshow__controls',
        dots: '.slick-dots',
        arrowLeft: '.slideshow__arrow-left',
        arrowRight: '.slideshow__arrow-right'
    };

    function slideshow(el, sectionId) {
        var $slideshow = (this.$slideshow = $(el));
        this.adaptHeight = this.$slideshow.data('adapt-height');
        this.$wrapper = this.$slideshow.closest(selectors.wrapper + sectionId);
        this.$section = this.$wrapper.closest(selectors.section);
        this.$controls = this.$wrapper.find(selectors.controls);
        this.$textWrapperMobile = this.$section.find(selectors.textWrapperMobile);
        this.autorotate = this.$slideshow.data('autorotate');
        var autoplaySpeed = this.$slideshow.data('speed');
        var loadSlideA11yString = this.$slideshow.data('slide-nav-a11y');

        this.settings = {
            rtl: theme.rtl,
            accessibility: true,
            arrows: true,
            dots: true,
            fade: (theme.rtl ? false : true),
            draggable: true,
            touchThreshold: 20,
            autoplay: this.autorotate,
            autoplaySpeed: autoplaySpeed
        };

        this.$slideshow.on('beforeChange', beforeChange.bind(this));
        this.$slideshow.on('init', slideshowA11ySetup.bind(this));

        // Add class to style mobile dots & show the correct text content for the
        // first slide on mobile when the slideshow initialises
        this.$slideshow.on(
            'init',
            function() {
                this.$mobileDots
                    .find('li:first-of-type')
                    .addClass(classes.slickActiveMobile);
                this.showMobileText(0);
            }.bind(this)
        );

        if (this.adaptHeight) {
            this.setSlideshowHeight();
            $(window).resize($.debounce(50, this.setSlideshowHeight.bind(this)));
        }

        this.$slideshow.slick(this.settings);

        // This can't be called when the slick 'init' event fires due to how slick
        // adds a11y features.
        slideshowPostInitA11ySetup.bind(this)();
    }

    function slideshowA11ySetup(event, obj) {
        var $slider = obj.$slider;
        var $list = obj.$list;
        this.$dots = this.$section.find(selectors.dots);
        this.$mobileDots = this.$dots.eq(1);

        // Remove default Slick aria-live attr until slider is focused
        $list.removeAttr('aria-live');

        //     this.$wrapper.on('keyup', keyboardNavigation.bind(this));
        //     this.$controls.on('keyup', keyboardNavigation.bind(this));
        //     this.$textWrapperMobile.on('keyup', keyboardNavigation.bind(this));

        // When an element in the slider is focused
        // pause slideshow and set aria-live.
        this.$wrapper
            .on(
                'focusin',
                function(evt) {
                    if (!this.$wrapper.has(evt.target).length) {
                        return;
                    }

                    $list.attr('aria-live', 'polite');
                    if (this.autorotate) {
                        $slider.slick('slickPause');
                    }
                }.bind(this)
            )
            .on(
                'focusout',
                function(evt) {
                    if (!this.$wrapper.has(evt.target).length) {
                        return;
                    }

                    $list.removeAttr('aria-live');
                }.bind(this)
            );

        // Add arrow key support when focused
        if (this.$dots) {
            this.$dots
                .find('a')
                .each(function() {
                    var $dot = $(this);
                    $dot.on('click keyup', function(evt) {
                        if (
                            evt.type === 'keyup' &&
                            evt.which !== slate.utils.keyboardKeys.ENTER
                        )
                            return;

                        evt.preventDefault();

                        var slideNumber = $(evt.target).data('slide-number');

                        $slider.attr('tabindex', -1).slick('slickGoTo', slideNumber);

                        if (evt.type === 'keyup') {
                            $slider.focus();
                        }
                    });
                })
                .eq(0)
                .attr('aria-current', 'true');
        }

        this.$controls
            .on('focusin', highlightControls.bind(this))
            .on('focusout', unhighlightControls.bind(this));
    }

    function slideshowPostInitA11ySetup() {
        var $slides = this.$slideshow.find(selectors.slides);

        $slides.removeAttr('role').removeAttr('aria-labelledby');
        this.$dots
            .removeAttr('role')
            .find('li')
            .removeAttr('role')
            .removeAttr('aria-selected')
            .each(function() {
                var $dot = $(this);
                var ariaControls = $dot.attr('aria-controls');
                $dot
                    .removeAttr('aria-controls')
                    .find('a')
                    .attr('aria-controls', ariaControls);
            });
    }

    function beforeChange(event, slick, currentSlide, nextSlide) {
        var $dotLinks = this.$dots.find('a');
        var $mobileDotLinks = this.$mobileDots.find('li');

        $dotLinks
            .removeAttr('aria-current')
            .eq(nextSlide)
            .attr('aria-current', 'true');

        $mobileDotLinks
            .removeClass(classes.slickActiveMobile)
            .eq(nextSlide)
            .addClass(classes.slickActiveMobile);
        this.showMobileText(nextSlide);
    }

    //   function keyboardNavigation() {
    //     if (event.keyCode === slate.utils.keyboardKeys.LEFTARROW) {
    //       this.$slideshow.slick('slickPrev');
    //     }
    //     if (event.keyCode === slate.utils.keyboardKeys.RIGHTARROW) {
    //       this.$slideshow.slick('slickNext');
    //     }
    //   }

    function highlightControls() {
        this.$controls.addClass(classes.controlsHover);
    }

    function unhighlightControls() {
        this.$controls.removeClass(classes.controlsHover);
    }

    slideshow.prototype.setSlideshowHeight = function() {
        var minAspectRatio = this.$slideshow.data('min-aspect-ratio');
        this.$slideshow.height($(document).width() / minAspectRatio);
    };

    slideshow.prototype.showMobileText = function(slideIndex) {
        var $allTextContent = this.$textWrapperMobile.find(
            selectors.textContentMobile
        );
        var currentTextContentSelector =
            selectors.textContentMobile + '-' + slideIndex;
        var $currentTextContent = this.$textWrapperMobile.find(
            currentTextContentSelector
        );
        if (!$currentTextContent.length &&
            this.$slideshow.find(selectors.slides).length === 1
        ) {
            this.$textWrapperMobile.hide();
        } else {
            this.$textWrapperMobile.show();
        }
        $allTextContent.hide();
        $currentTextContent.show();
    };

    function getSlideshowId($el) {
        return '#Slideshow-' + $el.data('id');
    }

    return slideshow;
})();

theme.slideshows = {};

theme.SlideshowSection = (function() {
    function SlideshowSection(container) {
        var $container = (this.$container = $(container));
        var sectionId = $container.attr('data-section-id');
        var slideshow = (this.slideshow = '#Slideshow-' + sectionId);

        theme.slideshows[slideshow] = new theme.Slideshow(slideshow, sectionId);
    }

    return SlideshowSection;
})();

theme.SlideshowSection.prototype = _.assignIn({},
    theme.SlideshowSection.prototype, {
        onUnload: function() {
            delete theme.slideshows[this.slideshow];
        },

        onBlockSelect: function(evt) {
            var $slideshow = $(this.slideshow);
            var adaptHeight = $slideshow.data('adapt-height');

            if (adaptHeight) {
                theme.slideshows[this.slideshow].setSlideshowHeight();
            }

            // Ignore the cloned version
            var $slide = $(
                '.slideshow__slide--' + evt.detail.blockId + ':not(.slick-cloned)'
            );
            var slideIndex = $slide.data('slick-index');

            // Go to selected slide, pause auto-rotate
            $slideshow.slick('slickGoTo', slideIndex).slick('slickPause');
        },

        onBlockDeselect: function() {
            // Resume auto-rotate
            $(this.slideshow).slick('slickPlay');
        }
    }
);

theme.slideshows = {};

theme.Cart = (function() {
    var selectors = {
        cartNote: '#CartSpecialInstructions',
        cartQtyInput: '.cart__quantity',
        cartNoCookiesClass: 'cart--no-cookies'
    };

    function Cart(container) {
        var $container = (this.$container = $(container));
        var sectionId = $container.attr('data-section-id');

        theme.cartObject = JSON.parse($('#CartJson-' + sectionId).html());

        this.init($container);
    }

    Cart.prototype = _.assignIn({}, Cart.prototype, {
        init: function($container) {
            this._initQtySelector();
            this._initCartNote();

            if (!this._cookiesEnabled()) {
                $container.addClass(selectors.cartNoCookiesClass);
            }
        },

        _initQtySelector: function() {
            $(selectors.cartQtyInput).each(function(i, el) {
                // eslint-disable-next-line no-new
                new QtySelector($(el));
            });
        },

        _initCartNote: function() {
            if (!$(selectors.cartNote).length) {
                return;
            }

            var $el = $(selectors.cartNote);
            var noteText;
            var params;
            var noteOffset = $el[0].offsetHeight - $el[0].clientHeight;

            // Auto grow the cart note if text fills it up
            $el.on('keyup input', function() {
                $(this)
                    .css('height', 'auto')
                    .css('height', $el[0].scrollHeight + noteOffset);
            });

            // Save the cart note via ajax. A safeguard in case
            // a user decides to leave the page before clicking 'Update Cart'
            $el.on(
                'change',
                $.proxy(function() {
                    noteText = $el.val();
                    params = {
                        type: 'POST',
                        url: '/cart/update.js',
                        data: 'note=' + this._attributeToString(noteText),
                        dataType: 'json'
                    };
                    $.ajax(params);
                }, this)
            );
        },

        _attributeToString: function(attr) {
            if (typeof attr !== 'string') {
                attr = String(attr);
                if (attr === 'undefined') {
                    attr = '';
                }
            }
            return $.trim(attr);
        },

        _cookiesEnabled: function() {
            var cookieEnabled = navigator.cookieEnabled;

            if (!cookieEnabled) {
                document.cookie = 'testcookie';
                cookieEnabled = document.cookie.indexOf('testcookie') !== -1;
            }
            return cookieEnabled;
        }
    });

    return Cart;
})();

// Instagrams
theme.Instagrams = (function() {
    function Instagrams(container) {
        this.$container = $(container).on('init', this._a11y.bind(this));
        //console.log(this.$container);
        this.settings = {
            style: this.$container.data('style'),
            accesstoken: this.$container.data('accesstoken'),
            userid: this.$container.data('userid'),
            limit: this.$container.data('limit'),
            resolution: this.$container.data('resolution'),
            target: this.$container.attr('id'),
            rows: this.$container.data('rows'),

            slidesToShow: this.$container.data('slidestoshow') || 1,
            infinite: this.$container.data('infinite') || false,
            arrows: this.$container.data('arrows') || false,
            draggable: this.$container.data('draggable') || false,
            dots: this.$container.data('dots') || false,
        }
        this.settings.slidesToShow1200 = (this.settings.slidesToShow - 1) > 1 ? (this.settings.slidesToShow - 1) : 1;
        this.settings.slidesToShow992 = (this.settings.slidesToShow - 2) > 1 ? (this.settings.slidesToShow - 2) : 1;
        this.settings.slidesToShow768 = (this.settings.slidesToShow - 3) > 1 ? (this.settings.slidesToShow - 3) : 1;
        this.settings.slidesToShow480 = 2;

        var _self = this;
        var $instagramSelector = $('#' + this.settings.target);
        if (this.settings.style === 'grid') {
            var afterInstagram = function() {} // blank function
        } else if (this.settings.style === 'carousel') {
            var afterInstagram = function() {
                $instagramSelector.slick({
                    slidesToShow: _self.settings.slidesToShow,
                    slidesToScroll: _self.settings.slidesToShow,
                    arrows: _self.settings.arrows,
                    dots: _self.settings.dots,
                    draggable: _self.settings.draggable,
                    infinite: _self.settings.infinite,
                    rows: _self.settings.rows,
                    responsive: [{
                            breakpoint: 1200,
                            settings: {
                                slidesToShow: _self.settings.slidesToShow1200,
                                slidesToScroll: _self.settings.slidesToShow1200,
                            }
                        },
                        {
                            breakpoint: 992,
                            settings: {
                                slidesToShow: _self.settings.slidesToShow992,
                                slidesToScroll: _self.settings.slidesToShow992,
                            }
                        },
                        {
                            breakpoint: 768,
                            settings: {
                                slidesToShow: _self.settings.slidesToShow768,
                                slidesToScroll: _self.settings.slidesToShow768,
                            }
                        },
                        {
                            breakpoint: 480,
                            settings: {
                                slidesToShow: _self.settings.slidesToShow480,
                                slidesToScroll: _self.settings.slidesToShow480,
                            }
                        }
                    ]
                })
            }
        }

        var feed = new Instafeed({
            get: 'user',
            target: this.settings.target,
            userId: this.settings.userid,
            accessToken: this.settings.accesstoken,
            limit: this.settings.limit,
            resolution: this.settings.resolution,
            template: '<div class="col hv-image-brightness"><a class="instagram-item" href="{{link}}" target="_blank" id="{{id}}"><img alt="instagram image" class="transition lazyload" data-src="{{image}}" /></a></div>',
            after: afterInstagram
        });

        feed.run();
    }

    Instagrams.prototype = _.assignIn({}, Instagrams.prototype, {
        _a11y: function(event, obj) {
            var $list = obj.$list;
            var $wrapper = this.$container.parent();

            // Remove default Slick aria-live attr until slider is focused
            $list.removeAttr('aria-live');

            // When an element in the slider is focused set aria-live
            $wrapper.on('focusin', function(evt) {
                if ($wrapper.has(evt.target).length) {
                    $list.attr('aria-live', 'polite');
                }
            });

            // Remove aria-live
            $wrapper.on('focusout', function(evt) {
                if ($wrapper.has(evt.target).length) {
                    $list.removeAttr('aria-live');
                }
            });
        }
    });

    return Instagrams;
})();

// Slick carousel
theme.slickCarousel = (function() {
    function Carousels(container) {
        this.$container = $(container).on('init', this._a11y.bind(this));
        this.settings = {
            rows: this.$container.data('rows') || 1,
            slidesToShow: this.$container.data('slidestoshow') || 1,
            slidesToScroll: this.$container.data('slidestoscroll') || 1,
            infinite: this.$container.data('infinite') || false,
            arrows: this.$container.data('arrows') || false,
            dots: this.$container.data('dots') || false,
            autoplay: this.$container.data('autoplay') || false,
            draggable: this.$container.data('draggable') || false,
            accessibility: this.$container.data('accessibility') || true,
        }
        this.settings.slidesToShow1200 = (this.settings.slidesToShow - 1) > 1 ? (this.settings.slidesToShow - 1) : 1;
        this.settings.slidesToShow992 = (this.settings.slidesToShow - 2) > 1 ? (this.settings.slidesToShow - 2) : 1;
        this.settings.slidesToShow768 = (this.settings.slidesToShow - 3) > 1 ? (this.settings.slidesToShow - 3) : 1;
        this.settings.slidesToShow480 = (this.settings.slidesToShow - 4) > 1 ? (this.settings.slidesToShow - 4) : 1;
        this.settings.slidesToScroll1200 = (this.settings.slidesToScroll - 1) > 1 ? (this.settings.slidesToScroll - 1) : 1;
        this.settings.slidesToScroll992 = (this.settings.slidesToScroll - 2) > 1 ? (this.settings.slidesToScroll - 2) : 1;
        this.settings.slidesToScroll768 = (this.settings.slidesToScroll - 3) > 1 ? (this.settings.slidesToScroll - 3) : 1;
        this.settings.slidesToScroll480 = (this.settings.slidesToScroll - 4) > 1 ? (this.settings.slidesToScroll - 4) : 1;
        this.$container.slick({
            rtl: theme.rtl,
            rows: this.settings.rows,
            slidesToShow: this.settings.slidesToShow,
            slidesToScroll: this.settings.slidesToScroll,
            arrows: this.settings.arrows,
            dots: this.settings.dots,
            autoplay: this.settings.autoplay,
            accessibility: this.settings.accessibility,
            draggable: this.settings.draggable,
            infinite: this.settings.infinite,
            adaptiveHeight: true,
            responsive: [{
                    breakpoint: 1200,
                    settings: {
                        slidesToShow: this.settings.slidesToShow1200,
                        slidesToScroll: this.settings.slidesToScroll1200
                    }
                },
                {
                    breakpoint: 992,
                    settings: {
                        slidesToShow: this.settings.slidesToShow992,
                        slidesToScroll: this.settings.slidesToScroll992
                    }
                },
                {
                    breakpoint: 768,
                    settings: {
                        slidesToShow: this.settings.slidesToShow768,
                        slidesToScroll: this.settings.slidesToScroll768
                    }
                },
                {
                    breakpoint: 480,
                    settings: {
                        slidesToShow: 1,
                        slidesToScroll: this.settings.slidesToScroll480
                    }
                }
            ]
        })
    }

    Carousels.prototype = _.assignIn({}, Carousels.prototype, {
        _a11y: function(event, obj) {
            var $list = obj.$list;
            var $wrapper = this.$container.parent();

            // Remove default Slick aria-live attr until slider is focused
            $list.removeAttr('aria-live');

            // When an element in the slider is focused set aria-live
            $wrapper.on('focusin', function(evt) {
                if ($wrapper.has(evt.target).length) {
                    $list.attr('aria-live', 'polite');
                }
            });

            // Remove aria-live
            $wrapper.on('focusout', function(evt) {
                if ($wrapper.has(evt.target).length) {
                    $list.removeAttr('aria-live');
                }
            });
        },

        _goToSlide: function(slideIndex) {
            this.$container.slick('slickGoTo', slideIndex);
        },

        onUnload: function() {
            delete this.$container;
        },

        onBlockSelect: function(evt) {
            // Ignore the cloned version
            var $slide = $(
                '.carousel__slide-wrapper--' + evt.detail.blockId + ':not(.slick-cloned)'
            );
            var slideIndex = $slide.data('slick-index');

            // Go to selected slide, pause autoplay
            this._goToSlide(slideIndex);

        }
    });

    return Carousels;
})()

// Productlists
theme.Productlists = (function() {
    function Productlists(container) {
        this.$container = $(container).on('init', this._a11y.bind(this));
        this.settings = {
            slidesToShow: this.$container.data('slidestoshow') || 1,
            rows: this.$container.data('rows') || 1,
            arrows: this.$container.data('arrows') || false,
            dots: this.$container.data('dots') || false,
            draggable: this.$container.data('draggable') || false,
            infinite: this.$container.data('infinite') || false,
        }
        this.settings.slidesToShow1200 = (this.settings.slidesToShow - 1) > 1 ? (this.settings.slidesToShow - 1) : 1;
        this.settings.slidesToShow992 = (this.settings.slidesToShow - 2) > 1 ? (this.settings.slidesToShow - 2) : 1;
        this.settings.slidesToShow768 = (this.settings.slidesToShow - 3) > 1 ? (this.settings.slidesToShow - 3) : 1;
        this.settings.slidesToShow480 = 2;
        this.$container.slick({
            rtl: theme.rtl,
            accessibility: true,
            slidesToShow: this.settings.slidesToShow,
            slidesToScroll: this.settings.slidesToShow,
            rows: this.settings.rows,
            arrows: this.settings.arrows,
            dots: this.settings.dots,
            infinite: this.settings.infinite,
            draggable: this.settings.draggable,
            responsive: [{
                    breakpoint: 1200,
                    settings: {
                        slidesToShow: this.settings.slidesToShow1200,
                        slidesToScroll: this.settings.slidesToShow1200
                    }
                },
                {
                    breakpoint: 992,
                    settings: {
                        slidesToShow: this.settings.slidesToShow992,
                        slidesToScroll: this.settings.slidesToShow992
                    }
                },
                {
                    breakpoint: 768,
                    settings: {
                        slidesToShow: this.settings.slidesToShow768,
                        slidesToScroll: this.settings.slidesToShow768
                    }
                },
                {
                    breakpoint: 480,
                    settings: {
                        slidesToShow: this.settings.slidesToShow480,
                        slidesToScroll: this.settings.slidesToShow480
                    }
                }
            ]
        }).css('opacity', '1');
    }

    Productlists.prototype = _.assignIn({}, Productlists.prototype, {
        _a11y: function(event, obj) {
            var $list = obj.$list;
            var $wrapper = this.$container.parent();

            // Remove default Slick aria-live attr until slider is focused
            $list.removeAttr('aria-live');

            // When an element in the slider is focused set aria-live
            $wrapper.on('focusin', function(evt) {
                if ($wrapper.has(evt.target).length) {
                    $list.attr('aria-live', 'polite');
                }
            });

            // Remove aria-live
            $wrapper.on('focusout', function(evt) {
                if ($wrapper.has(evt.target).length) {
                    $list.removeAttr('aria-live');
                }
            });
        },

        _goToSlide: function(slideIndex) {
            this.$container.slick('slickGoTo', slideIndex);
        },

        onUnload: function() {
            delete this.$container;
        }
    });

    return Productlists;
})();

// Producttabs
theme.Producttabs = (function() {
    function Producttabs(container) {
        var _self = this; // avoid conflict
        this.$container = $(container).on('init', this._a11y.bind(this));
        this.slickWrap = '.prdtab-content';
        this.settings = {
            slidesToShow: this.$container.data('slidestoshow') || 1,
            arrows: this.$container.data('arrows') || false,
            rows: this.$container.data('rows') || 1,
            dots: this.$container.data('dots') || false,
            draggable: this.$container.data('draggable') || false,
            infinite: this.$container.data('infinite') || false,
        }
        this.settings.slidesToShow1200 = (this.settings.slidesToShow - 1) > 1 ? (this.settings.slidesToShow - 1) : 1;
        this.settings.slidesToShow992 = (this.settings.slidesToShow - 2) > 1 ? (this.settings.slidesToShow - 2) : 1;
        this.settings.slidesToShow768 = (this.settings.slidesToShow - 3) > 1 ? (this.settings.slidesToShow - 3) : 1;
        this.settings.slidesToShow480 = 2;

        this._initSlick();
        this.$container.find('a[data-toggle="tab"]').on("shown.bs.tab", function(e) {
            _self._unSlick();
            _self._initSlick();
            theme.tooltip.load();
        })
    }

    Producttabs.prototype = _.assignIn({}, Producttabs.prototype, {
        _a11y: function(event, obj) {
            var $list = obj.$list;
            var $wrapper = this.$container.parent();

            // Remove default Slick aria-live attr until slider is focused
            $list.removeAttr('aria-live');

            // When an element in the slider is focused set aria-live
            $wrapper.on('focusin', function(evt) {
                if ($wrapper.has(evt.target).length) {
                    $list.attr('aria-live', 'polite');
                }
            });

            // Remove aria-live
            $wrapper.on('focusout', function(evt) {
                if ($wrapper.has(evt.target).length) {
                    $list.removeAttr('aria-live');
                }
            });
        },

        _getSliderSettings: function() {
            return {
                rtl: theme.rtl,
                accessibility: true,
                slidesToShow: this.settings.slidesToShow,
                slidesToScroll: this.settings.slidesToShow,
                arrows: this.settings.arrows,
                rows: this.settings.rows,
                dots: this.settings.dots,
                infinite: this.settings.infinite,
                draggable: this.settings.draggable,
                responsive: [{
                        breakpoint: 1200,
                        settings: {
                            slidesToShow: this.settings.slidesToShow1200,
                            slidesToScroll: this.settings.slidesToShow1200
                        }
                    },
                    {
                        breakpoint: 992,
                        settings: {
                            slidesToShow: this.settings.slidesToShow992,
                            slidesToScroll: this.settings.slidesToShow992
                        }
                    },
                    {
                        breakpoint: 768,
                        settings: {
                            slidesToShow: this.settings.slidesToShow768,
                            slidesToScroll: this.settings.slidesToShow768
                        }
                    },
                    {
                        breakpoint: 480,
                        settings: {
                            slidesToShow: this.settings.slidesToShow480,
                            slidesToScroll: this.settings.slidesToShow480
                        }
                    }
                ]
            }
        },

        _initSlick: function() {
            this.$container.find(this.slickWrap).slick(this._getSliderSettings()).css('opacity', '1');
        },

        _unSlick: function() {
            this.$container.find(this.slickWrap).slick('unslick');
        },

        onUnload: function() {
            delete this.$container;
        },

        onSelect: function() {
            this._unSlick();
            this._initSlick();
        },

        onBlockSelect: function(evt) {
            var navItem = $('.nav-link-' + evt.detail.blockId);
            navItem.tab('show');
            this._unSlick();
            this._initSlick();
        }
    });

    return Producttabs;
})();

theme.Video = (function() {
    var promiseYoutubeAPI;
    var promiseVimeoAPI;

    var youtube = {
        promiseAPI: function() {
            if (!promiseYoutubeAPI) {
                var tag = document.createElement('script');

                tag.src = 'https://www.youtube.com/iframe_api';
                var firstScriptTag = document.getElementsByTagName('script')[0];
                firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

                promiseYoutubeAPI = $.Deferred(function(defer) {
                    window.onYouTubeIframeAPIReady = defer.resolve;

                    setTimeout(function() {
                        defer.reject('Request for YouTube API timed out after 30 seconds.');
                    }, 30000);
                });
            }

            return promiseYoutubeAPI;
        },
        promisePlayer: function(id, options) {
            return this.promiseAPI().then(function() {
                return $.Deferred(function(defer) {
                    if (typeof window.YT === 'undefined') {
                        defer.reject(
                            "We're sorry, something went wrong. The YouTube API has not loaded correctly."
                        );
                    }

                    /* eslint-disable no-undef */
                    var player = new YT.Player(id, options); // global YT variable injected by YouTube API

                    player.addEventListener('onReady', function() {
                        defer.resolve(player);
                    });

                    setTimeout(function() {
                        defer.reject(
                            'Request for YouTube player has timed out after 30 seconds.'
                        );
                    }, 30000);
                });
            });
        }
    };

    var vimeo = {
        promiseAPI: function() {
            if (!promiseVimeoAPI) {
                promiseVimeoAPI = $.Deferred(function(defer) {
                    var tag = document.createElement('script');
                    tag.src = 'https://player.vimeo.com/api/player.js';
                    tag.onload = tag.onreadystatechange = function() {
                        if (!this.readyState || this.readyState === 'complete') {
                            defer.resolve();
                        }
                    };

                    var firstScriptTag = document.getElementsByTagName('script')[0];
                    firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

                    setTimeout(function() {
                        defer.reject('Request for Vimeo API timed out after 30 seconds.');
                    }, 30000);
                });
            }

            return promiseVimeoAPI;
        },

        promisePlayer: function(id, options) {
            return this.promiseAPI().then(function() {
                return $.Deferred(function(defer) {
                    if (typeof window.Vimeo === 'undefined') {
                        defer.reject(
                            "We're sorry, something went wrong. The Vimeo API has not loaded correctly."
                        );
                    }

                    var player = new window.Vimeo.Player(id, options);

                    setTimeout(function() {
                        defer.reject(
                            'Request for Vimeo player has timed out after 30 seconds.'
                        );
                    }, 30000);

                    player.ready().then(function() {
                        defer.resolve(player);
                    });
                });
            });
        }
    };

    var selectors = {
        loadPlayerButton: '.video-section__load-player-button',
        closePlayerButton: '.video-section__player-close',
        playerContainer: '.video-section__player',
        cover: '.video-section__cover',
        errorMessage: '.video-section__error',
        bodyOverlay: '.video-section__body-overlay',
        body: 'body'
    };
    var classes = {
        playerLoading: 'video-section--loading',
        playerLoaded: 'video-section--loaded',
        playerError: 'video-section--error',
        videoPlaying: 'video-playing'
    };

    function Video(container) {
        this.$container = $(container);
        var sectionId = this.$container.attr('data-section-id');
        this.namespace = '.' + sectionId;
        this.onLoad();
    }

    Video.prototype = _.assignIn({}, Video.prototype, {
        onLoad: function() {
            this.$container
                .on('click', selectors.loadPlayerButton, this._loadPlayer.bind(this))
                .on('click', selectors.closePlayerButton, this._closePlayer.bind(this))
                .on('click', selectors.bodyOverlay, this._closePlayer.bind(this));
        },

        _loadPlayer: function() {
            var $container = this.$container;
            var $playerContainer = $(selectors.playerContainer, $container);
            var playerType = this.$container.attr('data-video-type');

            var promiseVideoPlayer;

            if (playerType === 'youtube') {
                promiseVideoPlayer = this._loadYoutubePlayer($playerContainer[0]);
            } else if (playerType === 'vimeo') {
                promiseVideoPlayer = this._loadVimeoPlayer($playerContainer[0]);
            }

            return promiseVideoPlayer
                .then(this._onPlayerLoadReady.bind(this))
                .fail(this._onPlayerLoadError.bind(this));
        },

        _loadYoutubePlayer: function(container) {
            return youtube
                .promisePlayer(container, {
                    videoId: this.$container.attr('data-video-id'),
                    ratio: 16 / 9,
                    playerVars: {
                        modestbranding: 1,
                        autoplay: 1,
                        showinfo: 0,
                        rel: 0
                    }
                })
                .then(
                    function(player) {
                        this.player = player;
                    }.bind(this)
                );
        },

        _loadVimeoPlayer: function(container) {
            return vimeo
                .promisePlayer(container, {
                    id: this.$container.attr('data-video-id')
                })
                .then(
                    function(player) {
                        this.player = player;
                        this.player.play();
                    }.bind(this)
                );
        },

        _onPlayerLoadReady: function() {
            $(selectors.closePlayerButton, this.$container)
                .show()
                .focus();
            $(selectors.cover, this.$container).addClass(classes.playerLoaded);
            this.$container.addClass(classes.playerLoaded);

            this._setScrollPositionValues();

            $(selectors.body).addClass(classes.videoPlaying);

            $(document).on('keyup' + this.namespace, this._closeOnEscape.bind(this));
            $(window).on(
                'resize' + this.namespace,
                this._setScrollPositionValues.bind(this)
            );
            slate.a11y.trapFocus({
                $container: this.$container,
                namespace: this.namespace
            });
        },

        _onPlayerLoadError: function(err) {
            this.$container.addClass(classes.playerError);
            $(selectors.errorMessage, this.$container).text(err);
        },

        _closeOnEscape: function(evt) {
            if (evt.keyCode !== 27) {
                return;
            }

            this._closePlayer();
            $(selectors.loadPlayerButton, this.$container).focus();
        },

        _onScroll: function() {
            var scrollTop = $(window).scrollTop();

            if (
                scrollTop > this.videoTop + 0.25 * this.videoHeight ||
                scrollTop + this.windowHeight <
                this.videoBottom - 0.25 * this.videoHeight
            ) {
                // Debounce DOM edits to the next frame with requestAnimationFrame
                requestAnimationFrame(this._closePlayer.bind(this));
            }
        },

        _setScrollPositionValues: function() {
            this.videoHeight = this.$container.outerHeight(true);
            this.videoTop = this.$container.offset().top;
            this.videoBottom = this.videoTop + this.videoHeight;
            this.windowHeight = $(window).innerHeight();
        },

        _closePlayer: function() {
            $(selectors.body).removeClass(classes.videoPlaying);
            $(selectors.cover, this.$container).removeClass(classes.playerLoaded);
            this.$container.removeClass(classes.playerLoaded);
            $(selectors.closePlayerButton, this.$container).hide();

            slate.a11y.removeTrapFocus({
                $container: this.$container,
                namespace: this.namespace
            });

            if (typeof this.player.destroy === 'function') {
                this.player.destroy();
            } else if (typeof this.player.unload === 'function') {
                this.player.unload();
            }

            $(document).off(this.namespace);
            $(window).off(this.namespace);
        }
    });

    return Video;
})();

theme.CollectionsList = (function() {
    function CollectionsList(container) {
        var $container = (this.$container = $(container));
        var stretchImage = $container.is('[data-stretch-image]');

        // Early return if 'secondary image layout' is enabled
        if (stretchImage) return;

        var namespace = (this.namespace = '.' + $container.attr('data-section-id'));
        var self = this;

        self._collectionListFix();
        $(window).on(
            'resize' + namespace,
            $.debounce(250, function() {
                self._collectionListFix();
            })
        );
    }

    CollectionsList.prototype = _.assignIn({}, CollectionsList.prototype, {
        onUnload: function() {
            $(window).off(this.namespace);
        },

        _collectionListFix: function() {
            var numberRows = this.$container.find('.grid').data('number-rows');
            var $featureCards = this.$container.find('.featured-card');

            // We can exit if 'Use secondary image layout' is enabled
            if ($featureCards.is('[data-stretch-image]')) return;

            // Go through each of the rows
            for (var i = 0; i < numberRows; i++) {
                var maxWrapperHeight = 0;
                var maxHeaderHeight = 0;
                var $currentRow = $featureCards.filter(
                    "[data-row-number='" + (i + 1) + "']"
                );
                var $cardHeaders = $currentRow.find('.featured-card__header');

                // Find the max heights for each row
                $currentRow.each(function() {
                    var $cardTitle = $(this).find('.featured-card__title');
                    var $cardAction = $(this).find('.featured-card__action');
                    var $cardImageWrapper = $(this).find('.featured-card__image-wrapper');
                    var headerHeight =
                        $cardTitle.outerHeight() + $cardAction.outerHeight() + 65;
                    var wrapperHeight = $cardImageWrapper.outerHeight();
                    if (headerHeight > maxHeaderHeight) {
                        maxHeaderHeight = headerHeight;
                    }
                    if (wrapperHeight > maxWrapperHeight) {
                        maxWrapperHeight = wrapperHeight;
                    }
                });

                // Set the heights of the headers and cards for this row with padding
                $cardHeaders.outerHeight(maxHeaderHeight);
                $currentRow.height(maxWrapperHeight + maxHeaderHeight + 40);
            }
        }
    });

    return CollectionsList;
})();

theme.ParrallaxImage = (function() {
    function ParrallaxImage(container) {
        this.container = container;
        this.sectionId = $(container).attr('data-section-id');
        this.namespace = 'parallax-' + this.sectionId;
        var images = document.getElementsByClassName('thumbnail' + this.sectionId);
        new simpleParallax(images, {
            scale: 1.5,
            delay: .6,
        });
    }

    ParrallaxImage.prototype = $.extend({}, ParrallaxImage.prototype, {
        onUnload: function(evt) {
            var instance = new simpleParallax(images);
            instance.destroy();
            delete theme.ParrallaxImage[this.namespace];
        }
    });

    return ParrallaxImage;
})();

theme.init = function() {
    theme.customerTemplates.init();
    slate.rte.wrapTable();
    slate.rte.iframeReset();

    // Common a11y fixes
    slate.a11y.pageLinkFocus($(window.location.hash));

    $('.in-page-link').on('click', function(evt) {
        slate.a11y.pageLinkFocus($(evt.currentTarget.hash));
    });

    $('a[href="#"]').on('click', function(evt) {
        evt.preventDefault();
    });


    //scroll animation
    AOS.init({
        startEvent: 'DOMContentLoaded',
        offset: 30, // offset (in px) from the original trigger point
        delay: 0, // values from 0 to 3000, with step 50ms
        duration: 1000,
        once: true
    });
    window.addEventListener('load', function() {
        AOS.refresh();
    });


    // Sections
    var sections = new theme.Sections();
    sections.register('header', theme.HeaderSection);
    sections.register('product', theme.Product);
    sections.register('slideshow-section', theme.SlideshowSection);
    sections.register('cart', theme.Cart);
    sections.register('instagrams', theme.Instagrams);
    sections.register('masonries', theme.Masonry);
    sections.register('productlist', theme.Productlists);
    sections.register('producttab', theme.Producttabs);
    sections.register('slickCarousels', theme.slickCarousel);
    sections.register('video', theme.Video);
    sections.register('collections-list', theme.CollectionsList);
    sections.register('parallax-image', theme.ParrallaxImage);
    sections.register('bgcollection', theme.Bgcollection);

    // Standalone modules
    $(window).on('load', theme.articleImages);
    theme.passwordModalInit();
};

theme.articleImages = function() {
    var $indentedRteImages = $('.rte--indented-images');
    if (!$indentedRteImages.length) {
        return;
    }

    $indentedRteImages.find('img').each(function(i, el) {
        var $el = $(el);
        var attr = $el.attr('style');

        // Check if undefined or float: none
        if (!attr || attr === 'float: none;') {
            // Add class to parent paragraph tag if image is wider than container
            if ($el.width() >= $indentedRteImages.width()) {
                $el.parent('p').addClass('rte__image-indent');
            }
        }
    });
};

theme.passwordModalInit = function() {
    var $loginModal = $('#LoginModal');
    if (!$loginModal.length) {
        return;
    }

    // Initialize modal
    theme.PasswordModal = new window.Modals('LoginModal', 'login-modal', {
        focusOnOpen: '#Password'
    });

    // Open modal if errors exist
    if ($loginModal.find('.errors').length) {
        theme.PasswordModal.open();
    }
};

// CSS var ponyfill
theme.cssVar = (function() {
    cssVars();
})()

// Ajax search https://gist.github.com/awojtczyk/53d74c8af5f893841f33979b0cdcd6fe
theme.ajaxSearch = (function() {
    var $inputSearch = '.js-ajaxsearch',
        $resultsList = '.search-results',
        $input = $($inputSearch).find('input[name="q"]'),
        $currentAjaxRequest,
        $displayProducts = 6;

    $($inputSearch).css('position', 'relative').each(function() {
        $input.attr('autocomplete', 'off').bind('keyup change', function() {
            var term = $(this).val(),
                form = $(this).closest('form'),
                searchURL = '/search?type=product&q=*' + term + '*';
            if (term.length > 2 && term !== $(this).attr('data-old-term')) {
                $(this).attr('data-old-term', term);
                if ($currentAjaxRequest !== undefined) $currentAjaxRequest.abort();
                $currentAjaxRequest = $.getJSON(searchURL + '&view=json', function(data) {
                    $($resultsList).empty();

                    if (data.results_count === 0) {
                        $($resultsList).html('<p class="text-center">' + theme.strings.ajaxSearchNoResult + '</p>')
                    } else {
                        $.each(data.results, function(index, item) {
                            if (index < $displayProducts) {
                                var itemPrice = theme.Currency.formatMoney(item.price, theme.moneyFormat);
                                var link = $('<a class="d-inline-flex ' + index + '"></a>')
                                    .attr('href', item.url)
                                    .append('<span class="image"><img src="' + item.thumbnail + '" /></span>')
                                    .append('<div class="meta"><p class="title">' + item.title + '</p>' + itemPrice + '</div>')
                                    .wrap('<div class="ajax-search-item"></div>');
                                $($resultsList).append(link.parent());
                                theme.updateCurrencies();
                            }
                        });
                        if (data.results_count > $displayProducts) {
                            $($resultsList).append('<a class="btn btn--full" href="' + searchURL + '">' + theme.strings.ajaxSearchViewAll + ' (' + data.results_count + ')</a>');
                        }
                    }
                    $($resultsList).addClass('active').fadeIn(200);
                });
            }
        });
    });

    //escape when click somethings
    $(document).click(function(event) {
        var target = event.target;
        if (!$(target).is($inputSearch) && !$(target).parents().is($inputSearch)) {
            $($resultsList).slideUp(300);
        }
    });
})();

// Quickview https://github.com/kellyvaughn/quickview-for-shopify/blob/master/quickview.js.liquid
theme.quickview = (function() {
    var product_handle = '',
        quickviewButtonClass = '.js-btn-quickview',
        quickviewId = '#jsQuickview',
        quickviewOption = '#jsQuickview select',
        quickviewThumb = '#qv-product-images',
        quickviewAddCartButton = '.qv-add-button',
        quickviewPrice = '.qv-product-price',
        quickviewComparePrice = '.qv-product-compare-price';

    // 1. Show quickview
    $(document).on('click', quickviewButtonClass, function() {
        var quickviewAvaible = $(this).attr("data-pavailable");
        product_handle = $(this).data('handle');
        //ResetQuickview
        $(quickviewId).removeClass().addClass('modal fade');
        $(quickviewThumb).removeClass().empty();
        $('.qv-product-options').empty();

        //Pushdata
        $(quickviewId).addClass(product_handle).data('handle', product_handle);
        jQuery.getJSON('/products/' + product_handle + '.js', function(product) {
            var title = product.title;
            var type = product.type;
            var vendor = product.vendor;
            var price = 0;
            var compare_price = 0;
            var desc = product.description.slice(0, 90);
            var images = product.images;
            var variants = product.variants;
            var options = product.options;
            var url = '/products/' + product_handle;
            $('.qv-product-title').text(title);
            $('.qv-product-type').text(type);
            $('.qv-product-description').html(desc);
            $('.qv-view-product').attr('href', url);
            $('.qv-view-type').text(type);
            $('.qv-view-vendor').text(vendor)
            if (quickviewAvaible == 'true') {
                $(quickviewAddCartButton).prop('disabled', false).html(theme.strings.addToCart);
            } else {
                $(quickviewAddCartButton).prop('disabled', true).html(theme.strings.soldOut);
            }
            $(product.variants).each(function(i, variants) {
                if (variants.sku != null) {
                    $('.qv-sku').addClass("show").removeClass("hide");
                    $('.qv-view-sku').text(product.variants[0].sku);
                } else {
                    $('.qv-sku').addClass("hide").removeClass("show");
                }

            });
            var imageCount = $(images).length;
            $(images).each(function(i, image) {
                image_embed = '<div><img src="' + image + '"></div>';
                image_embed = image_embed.replace('.jpg', '_800x.jpg').replace('.png', '_800x.png');
                $(quickviewThumb).append(image_embed);
            });
            $(quickviewThumb).slick({
                rtl: theme.rtl,
                'dots': true,
                'arrows': true,
                'respondTo': 'min',
                'useTransform': true
            }).css('opacity', '1');

            if (product.variants[0].option1 !== "Default Title") {
                $(options).each(function(i, option) {
                    var name = option.name;
                    var opt = name.replace(/ /g, '-').toLowerCase();
                    var selectClass = '.option.' + opt;
                    $('.qv-product-options').append('<div class="option-selection ' + opt + '"><span class="option text-uppercase font-weight-bold text-body">' + option.name + '</span><select class="option-' + i + ' option ' + opt + '"></select></div>');
                    $(option.values).each(function(i, value) {
                        $('.option.' + opt).append($('<option>', {
                            value: value,
                            text: value
                        }));
                    });
                });
            }
            $(product.variants).each(function(i, v) {
                if (v.inventory_quantity == 0) {
                    return true
                } else {
                    price = theme.Currency.formatMoney(v.price, theme.moneyFormat);
                    compare_price = theme.Currency.formatMoney(v.compare_at_price, theme.moneyFormat);
                    $(quickviewPrice).html(price);
                    if (v.compare_at_price !== null) {
                        $(quickviewComparePrice).html(compare_price).show();
                    } else {
                        $(quickviewComparePrice).hide();
                    }
                    theme.updateCurrencies();
                    $('select.option-0').val(v.option1);
                    $('select.option-1').val(v.option2);
                    $('select.option-2').val(v.option3);
                    return false
                }
            });
        });
        //addCartQuickview
    });
    // 2. Add to cart
    $(document).on('click', quickviewAddCartButton, function() {
        product_handle = $(quickviewId).data('handle');
        var qty = $('.qv-quantity').val(),
            selectedOptions = '',
            var_id = '';

        function processCart() {
            jQuery.post('/cart/add.js', {
                    quantity: qty,
                    id: var_id
                }, null, "json").done(function(item) {
                    var htmlVariant = item.variant_title !== null ? '<i>(' + item.variant_title + ')</i>' : '';
                    var styleCart = $('.js-mini-cart').attr("data-cartmini");
                    if (styleCart != 'true') {
                        var htmlAlert = '<div class="media mt-2 alert--cart"><a class="mr-3" href="/cart"><img class="lazyload" data-src="' + item.image + '"></a><div class="media-body align-self-center"><p class="m-0 font-weight-bold">' + item.product_title + ' x ' + item.quantity + '</p>' + htmlVariant + '<div><div>';
                        theme.alert.new(theme.strings.addToCartSuccess, htmlAlert, 3000, 'notice');
                    }
                    theme.miniCart.updateElements();
                    theme.miniCart.generateCart();
                })
                .fail(function($xhr) {
                    var data = $xhr.responseJSON;
                    theme.alert.new('', data.description, 3000, 'warning');
                });
        }
        $(quickviewOption).each(function(i) {
            if (selectedOptions == '') {
                selectedOptions = $(this).val();
            } else {
                selectedOptions = selectedOptions + ' / ' + $(this).val();
            }
        });
        jQuery.getJSON('/products/' + product_handle + '.js', function(product) {
            if (product.variants.length === 1) {
                var_id = product.variants[0].id;
            } else {
                $(product.variants).each(function(i, v) {
                    if (v.title == selectedOptions) {
                        var_id = v.id;
                    }
                });
            }
            processCart();
        });
    });
    // 3. Select variants
    $(document).on('change', quickviewOption, function() {
        var selectedOptions = '';
        $(quickviewOption).each(function(i) {
            if (selectedOptions == '') {
                selectedOptions = $(this).val();
            } else {
                selectedOptions = selectedOptions + ' / ' + $(this).val();
            }
        });
        jQuery.getJSON('/products/' + product_handle + '.js', function(product) {
            $(product.variants).each(function(i, v) {
                if (v.title == selectedOptions) {
                    if (v.featured_image !== null) {
                        var iSlick = v.featured_image.position - 1;
                        $(quickviewThumb).slick('slickGoTo', iSlick);
                    }
                    var price = theme.Currency.formatMoney(v.price, theme.moneyFormat);
                    var compare_price = theme.Currency.formatMoney(v.compare_at_price, theme.moneyFormat);
                    $(quickviewPrice).html(price);
                    $(quickviewComparePrice).html(compare_price);
                    if (v.sku != null) {
                        $('.qv-sku').addClass("show").removeClass("hide");
                        $('.qv-view-sku').text(v.sku);
                    } else {
                        $('.qv-sku').addClass("hide").removeClass("show");
                    }
                    if (v.compare_at_price !== null) {
                        $(quickviewComparePrice).html(compare_price).show();
                    } else {
                        $(quickviewComparePrice).hide();
                    }
                    theme.updateCurrencies();
                    if (v.inventory_management === null) {
                        $(quickviewAddCartButton).prop('disabled', false).val(theme.strings.addToCart);
                    } else {
                        if (v.inventory_quantity < 1) {
                            $(quickviewAddCartButton).prop('disabled', true).val(theme.strings.soldOut);
                        } else {
                            $(quickviewAddCartButton).prop('disabled', false).val(theme.strings.addToCart);
                        }
                    }
                }
            });
        });
    });
})()

//Button add to cart (in grid item)
theme.addCartButton = (function() {
    var buttonClass = '.js-grid-cart';
    $(document).on('click', buttonClass, function() {
        var $this = $(this);
        var id = $this.data('id');
        $this.addClass('is-loading');
        Shopify.addItem(id, 1, function(item) {
            location.href = "/cart";
            var htmlVariant = item.variant_title !== null ? '<i>(' + item.variant_title + ')</i>' : '';
            var styleCart = $('.js-mini-cart').attr("data-cartmini");
            if (styleCart != 'true') {
                var htmlAlert = '<div class="media mt-2 alert--cart"><a class="mr-3" href="/cart"><img class="lazyload" data-src="' + item.image + '"></a><div class="media-body align-self-center"><p class="m-0 font-weight-bold">' + item.product_title + ' x ' + item.quantity + '</p>' + htmlVariant + '<div><div>';
            }
            theme.miniCart.updateElements();
            theme.miniCart.generateCart();
            setTimeout(function() {
                styleCart != 'true' ? theme.alert.new(theme.strings.addToCartSuccess, htmlAlert, 3000, 'notice') : '';
                $this.removeClass('is-loading');
            }, 1000);
        });
    })
})()

// Button add to cart (in grid item)
//theme.addCartButton = (function(){
//  var buttonClass = '.js-grid-cart';
//  $(document).on('click',buttonClass,function(){
//    var $this = $(this);
//    var id = $this.data('id');
//    $this.addClass('is-loading');
//    Shopify.addItem(id,1,function(item){
//      var htmlVariant = item.variant_title !== null ? '<i>('+item.variant_title+')</i>' : '';
//      var styleCart = $('.js-mini-cart').attr("data-cartmini");
//        if(styleCart != 'true'){
//          var htmlAlert = '<div class="media mt-2 alert--cart"><a class="mr-3" href="/cart"><img class="lazyload" data-src="'+item.image+'"></a><div class="media-body align-self-center"><p class="m-0 font-weight-bold">'+item.product_title+' x '+ item.quantity +'</p>'+htmlVariant+'<div><div>';
//        }
//      theme.miniCart.updateElements();
//      theme.miniCart.generateCart();
//      setTimeout(function() {
//        styleCart != 'true' ? theme.alert.new(theme.strings.addToCartSuccess,htmlAlert,3000,'notice'): '';
//        $this.removeClass('is-loading');
//      }, 1000);
//    });
// })
//})()

// Multi currencies 
if (theme.enableCurrencies) {
    // Can be 'money_format' or 'money_with_currency_format'
    Currency.format = 'money_format';
    var shopCurrency = Shopify.currency.active;
    var cookieCurrency = Currency.cookie.read();
    // Fix for customer account pages 
    jQuery('span.money span.money').each(function() {
        jQuery(this).parent('span.money').removeClass('money');
    });
    // Add precalculated shop currency to data attribute 
    jQuery('span.money').each(function() {
        jQuery(this).attr('data-currency-' + Shopify.currency.active, jQuery(this).html());
    });
    // Select all your currencies buttons.
    var buttons = jQuery('#currencies a'),
        currentCurrencies = jQuery('.pre-currencies');
    // When the page loads.
    if (cookieCurrency == null || cookieCurrency == shopCurrency) {
        Currency.currentCurrency = shopCurrency;
    } else {
        Currency.currentCurrency = cookieCurrency;
        Currency.convertAll(shopCurrency, cookieCurrency);
        buttons.removeClass('selected');
        jQuery('#currencies a[data-currency=' + cookieCurrency + ']').addClass('selected');
        var htmlCurrently = jQuery('#currencies a[data-currency=' + cookieCurrency + ']').html();
        currentCurrencies.html(htmlCurrently);
    }
    buttons.click(function() {
        buttons.removeClass('selected');
        jQuery(this).addClass('selected');
        var newCurrency = jQuery(this).attr('data-currency');
        var htmlCurrently = jQuery(this).html();
        currentCurrencies.html(htmlCurrently);
        Currency.convertAll(Currency.currentCurrency, newCurrency);
    });
    // For product options.
    var original_selectCallback = window.selectCallback;
    var selectCallback = function(variant, selector) {
        original_selectCallback(variant, selector);
        Currency.convertAll(shopCurrency, jQuery('#currencies a.selected').attr('data-currency'));
    };
}
theme.updateCurrencies = function() {
    Currency.convertAll(shopCurrency, jQuery('#currencies a.selected').attr('data-currency'));
}

// MiniCart
theme.miniCart = (function() {
    var miniCart = '.js-mini-cart',
        styleCart = $(miniCart).attr("data-cartmini"),
        cartToggle = '.js-toggle-cart',
        cartCount = '.js-cart-count',
        cartContent = '.js-mini-cart-content',
        cartTotal = '.js-cart-total',
        $btnCheckout = $('.js-cart-btn-checkout'),
        numberDisplayed = 5,
        // emptyCartHTML = '<div class="alert">' + theme.strings.cartEmpty + '</div>';

        // function updateElements() {
        //     Shopify.getCart(function(cart) {

        //         if (cart.item_count === 0) {
        //             $(cartContent).html(emptyCartHTML);
        //             $btnCheckout.addClass('disabled');
        //             styleCart === 'true' ? $(miniCart).removeClass('active') : null;

        //         } else {
        //             $btnCheckout.removeClass('disabled');
        //             styleCart === 'true' ? $(miniCart).addClass('active') : null;
        //         }
        //         $(cartCount).text(cart.item_count);
        //         $(cartTotal).html(theme.Currency.formatMoney(cart.total_price, theme.moneyFormat));
        //         theme.freeShipping.load(cart);
        //         theme.updateCurrencies();
        //     })
        // }

        // function generateCart() {

        //     Shopify.getCart(function(cart) {

        //         var htmlCart = cart.item_count === 0 ? emptyCartHTML : '',
        //             itemCount = cart.items.length,
        //             forLoop = itemCount < numberDisplayed ? itemCount : numberDisplayed;
        //         //styleCart === 'true' ? cart.items.length ? $(miniCart).addClass('active'): $(miniCart).removeClass('active') :null;

        //         // add list items
        //         for (var i = 0; i < forLoop; i++) {
        //             var product = cart.items[i],
        //                 productPrice = theme.Currency.formatMoney(product.price, theme.moneyFormat);
        //             htmlCart += '<div class="mini-cart-item">';
        //             htmlCart += '	<a class="mini-cart-image" href="' + product.url + '">';
        //             htmlCart += '		<img src="' + product.image + '"/>';
        //             htmlCart += '	</a>';
        //             htmlCart += '	<div class="mini-cart-meta">';
        //             htmlCart += '		<p ><a href="' + product.url + '">' + product.title + '</a></p>';
        //             htmlCart += '		<span> ' + productPrice + '</span><b> x ' + product.quantity + '</b>';
        //             htmlCart += '	</div>';
        //             htmlCart += '	<button class="btn js-remove-mini-cart" data-id="' + product.id + '">&times;</button>';
        //             htmlCart += '</div>';
        //         }
        //         if (itemCount > numberDisplayed) {
        //             htmlCart += '<a class="js-btn-viewmore" href="/cart">' + theme.strings.cartMore + '(' + (itemCount - numberDisplayed) + ')</a>'
        //         }
        //         // add total price and cart button / checkout button
        //         $(cartContent).html(htmlCart);
        //         $(cartTotal).html(theme.Currency.formatMoney(cart.total_price, theme.moneyFormat));
        //         theme.updateCurrencies();
        //     })
        // }
        // 2. Button remove items
        // $(document).on('click', '.js-remove-mini-cart', function() {
        //     var itemId = $(this).data('id');
        //     var isOuterMiniCart = $(this).closest(miniCart).length === 0 ? true : false; // check element from mini cart or not

        //     // hide items
        //     $(this).parent().fadeOut();

        //     //remove from cart
        //     Shopify.changeItem(itemId, 0, updateElements);
        //     Shopify.getCart(function(cart) {
        //         if (cart.items.length > numberDisplayed || isOuterMiniCart) {
        //             generateCart();
        //         }
        //     });
        // });

        //Keep popup when click cart / UX
        // $(document).on('click', cartToggle, function() {
        //     $(this).parent(miniCart).toggleClass('active');
        // });
        // $(document).on('click', '.overlaycart', function() {
        //     $(this).parent(miniCart).removeClass('active');
        // });

        // // gen minicart when load page
        // generateCart();
        // return {
        //     updateElements: updateElements,
        //     generateCart: generateCart
        // }
})()

// Free shipping
theme.freeShipping = (function() {
    var $freeShippingClass = $('.js-free-shipping'),
        $freeShippingTextClass = $('.js-free-shipping-text'),
        $free_fisrt = $freeShippingClass.attr('data-start'),
        $free_end = $freeShippingClass.attr('data-end')
    minOrderValue = parseInt($freeShippingClass.data('value')) || 0,
        $percentClass = $('.js-free-shipping .progress-bar');

    function generate(cart) {
        var priceCart = cart.total_price;
        if (priceCart >= minOrderValue) {
            $percentClass.css('width', '100%').removeClass('progress-bar-striped bg-primary');
            $freeShippingTextClass.text(theme.strings.freeShipping)
        } else {
            let percent = priceCart / minOrderValue * 100;
            let left = Shopify.formatMoney((minOrderValue - priceCart), theme.moneyFormat);
            $percentClass.css('width', percent + '%').addClass('progress-bar-striped primary');
            $freeShippingTextClass.html($free_fisrt + ' ' + left + ' ' + $free_end);
            theme.updateCurrencies();
        }
    }

    Shopify.getCart(function(cart) {
        generate(cart);
    });

    return {
        load: generate
    }
})()

// Shipping time - https://github.com/phstc/jquery-dateFormat
theme.shippingTime = (function() {
    var $shippingTime = $('.js-shipping-time'),
        shippingTime = $shippingTime.data('time') || '',
        now = new Date(),
        restHour = 23 - now.getHours(),
        restMinute = 59 - now.getMinutes();
    if (shippingTime !== '') {
        var nextTime = new Date(now.getTime() + shippingTime * 86400000),
            formatTime = $.format.date(nextTime, "ddd, dd MMMM yyyy"),
            htmlShipping = 'Order in the next <b>' + restHour + '</b> hours <b>' + restMinute + '</b> minutes to get it by <b>' + formatTime + '</b>. ';
        $shippingTime.html(htmlShipping);
    }
})()

// Infinite scroll - https://github.com/Elkfox/Ajaxinate/blob/master/dist/ajaxinate.min.js
theme.infiniteScroll = (function() {
    function initInfiniteScroll() {
        if ($('.AjaxinateLoop').length === 0) {
            return;
        } else {
            var endlessScroll = new Ajaxinate({
                loadingText: '<div class="text-center"><div class="' + theme.loadingClass + '" role="status"></div></div>',
                callback: function() {
                    theme.wishlist.load();
                    theme.compare.load();
                    theme.countdown.load();
                    theme.priceRange.load();
                    theme.tooltip.load();
                    theme.collectionView.triggerView();
                    theme.swatchCard2.load();
                }
            });
        }
    }

    // Infinite scroll in other page (blog, list-collection)
    function initOtherPages() {
        var otherPages = new Ajaxinate({
            loadingText: '<div class="text-center"><div class="' + theme.loadingClass + '" role="status"></div></div>',
            container: '.js-pagination-content',
            pagination: '.js-pagination'
        });
    }

    document.addEventListener("DOMContentLoaded", function() {
        initInfiniteScroll();
        initOtherPages();
    });

    return {
        load: initInfiniteScroll
    }
})()

// Scroll to fixed
theme.scrollToFixed = (function() {
    var window_width = $(window).width();

    if (window_width < 768) {
        $(".js-stick-parent").trigger("sticky_kit:detach");
    } else {
        make_sticky();
    }
    $(window).resize(function() {

        window_width = $(window).width();

        if (window_width < 768) {
            $(".js-stick-parent").trigger("sticky_kit:detach");
        } else {
            make_sticky();
        }
    });

    function make_sticky() {
        $('.js-stick-parent').stick_in_parent();
    }

})()


theme.headersidebar = (function() {
    $('#dismiss, .overlaysidebar').on('click', function() {
        // hide sidebar
        $('#sidebar').removeClass('active');
        // hide overlay
        $('.overlaysidebar').removeClass('active');
    });

    $('#sidebarCollapse').on('click', function() {
        // open sidebar
        $('#sidebar').addClass('active');
        // fade in the overlay
        $('.overlaysidebar').addClass('active');
        $('.collapse.in').toggleClass('in');
        $('a[aria-expanded=true]').attr('aria-expanded', 'false');
    });
})()

// Wishlist
theme.wishlist = (function() {
    var wishlistButtonClass = '.js-btn-wishlist',
        wishlistRemoveButtonClass = '.js-remove-wishlist',
        $wishlistCount = $('.js-wishlist-count'),
        $wishlistContainer = $('.js-wishlist-content'),
        wishlistObject = JSON.parse(localStorage.getItem('localWishlist')) || [],
        wishlistPageUrl = $('.js-wishlist-link').attr('href'),
        loadNoResult = function() {
            $wishlistContainer.html('<div class="col text-center"><div class="alert alert-warning d-inline-block">' + theme.strings.wishlistNoResult + '</div></div>');
        };

    function updateWishlist(self) {
        var productHandle = $(self).data('handle'),
            allSimilarProduct = $(wishlistButtonClass + '[data-handle="' + productHandle + '"]');
        var isAdded = $.inArray(productHandle, wishlistObject) !== -1 ? true : false;
        if (isAdded) {
            // go to wishlist page
            window.location.href = wishlistPageUrl;
        } else {
            wishlistObject.push(productHandle);
            allSimilarProduct.fadeOut('slow').fadeIn('fast').html(theme.strings.wishlistIconAdded + theme.strings.wishlistTextAdded);
            //change tooltip
            allSimilarProduct.attr('data-original-title', theme.strings.wishlistTextAdded);
            $('.tooltip-inner').text(theme.strings.wishlistTextAdded);
        }
        localStorage.setItem('localWishlist', JSON.stringify(wishlistObject));
        $wishlistCount.text(wishlistObject.length);
    };

    function loadWishlist() {
        $wishlistContainer.html('');
        //page wishlist
        if (wishlistObject.length > 0) {
            for (var i = 0; i < wishlistObject.length; i++) {
                var productHandle = wishlistObject[i];
                Shopify.getProduct(productHandle, function(product) {
                    var htmlProduct = '';
                    var productPrice = product.price_varies ? 'from ' + theme.Currency.formatMoney(product.price_min, theme.moneyFormat) : theme.Currency.formatMoney(product.price, theme.moneyFormat);
                    var productComparePrice = product.compare_at_price_min !== 0 ? theme.Currency.formatMoney(product.compare_at_price_min, theme.moneyFormat) : '';
                    htmlProduct += '<div class="js-wishlist-item col-md-4 col-sm-6 col-xs-6 col-12 mb-4">';
                    htmlProduct += '<div class="js-wishlist-itembox">';
                    htmlProduct += '<div class=" d-flex flex-row p-4">';
                    htmlProduct += '	<a class="d-inline-block mr-4 " href="' + product.url + '">';
                    htmlProduct += '		<img src="' + product.featured_image + '"/>';
                    htmlProduct += '	</a>';
                    htmlProduct += '	<div><a href="' + product.url + '" class="title-prouct d-block h4 text-body" >' + product.title + '</a>';
                    htmlProduct += '	<span> ' + productPrice + '</span>';
                    htmlProduct += '	 <s>' + productComparePrice + '</s></div>';
                    htmlProduct += '<button class="btn js-remove-wishlist" data-handle="' + product.handle + '">' + theme.strings.wishlistRemove + '</button>';
                    htmlProduct += '</div>';
                    htmlProduct += '</div>';
                    htmlProduct += '</div>';
                    $wishlistContainer.append(htmlProduct);
                    theme.updateCurrencies();
                });
            }
        } else {
            loadNoResult();
        }

        //count items
        $wishlistCount.text(wishlistObject.length);

        //button text
        $(wishlistButtonClass).each(function() {
            var productHandle = $(this).data('handle');
            var iconWishlist = $.inArray(productHandle, wishlistObject) !== -1 ? theme.strings.wishlistIconAdded : theme.strings.wishlistIcon;
            var textWishlist = $.inArray(productHandle, wishlistObject) !== -1 ? theme.strings.wishlistTextAdded : theme.strings.wishlistText;
            $(this).html(iconWishlist + textWishlist).attr('title', textWishlist);
        });
    }

    $(document).on('click', wishlistButtonClass, function(event) {
        event.preventDefault();
        updateWishlist(this);
    });
    $(document).on('click', wishlistRemoveButtonClass, function() {
        var productHandle = $(this).data('handle'),
            allSimilarProduct = $(wishlistButtonClass + '[data-handle="' + productHandle + '"]');

        //update button
        allSimilarProduct.html(theme.strings.wishlistIcon + theme.strings.wishlistText);
        //update tooltip
        allSimilarProduct.attr('data-original-title', theme.strings.wishlistText);
        $('.tooltip-inner').text(theme.strings.wishlistText);
        //update Object
        wishlistObject.splice(wishlistObject.indexOf(productHandle), 1);
        localStorage.setItem('localWishlist', JSON.stringify(wishlistObject));
        // Remove element
        $(this).closest('.js-wishlist-item').fadeOut(); // or .remove()
        //count
        $wishlistCount.text(wishlistObject.length);
        if (wishlistObject.length === 0) {
            loadNoResult();
        }
    });

    loadWishlist();
    $(document).on('shopify:section:load', loadWishlist);
    return {
        load: loadWishlist
    }
})()

// Compare
theme.compare = (function() {
    var compareButtonClass = '.js-btn-compare',
        compareRemoveButtonClass = '.js-remove-compare',
        $compareCount = $('.js-compare-count'),
        $compareContainer = $('.js-compare-content'),
        compareObject = JSON.parse(localStorage.getItem('localCompare')) || [],
        alertClass = 'notice';

    function updateCompare(self) {
        var productHandle = $(self).data('handle'),
            alertText = '';
        var isAdded = $.inArray(productHandle, compareObject) !== -1 ? true : false;
        if (isAdded) {
            compareObject.splice(compareObject.indexOf(productHandle), 1);
            alertText = theme.strings.compareNotifyRemoved;
            alertClass = 'notice';
        } else {
            if (compareObject.length === 4) {
                alertText = theme.strings.compareNotifyMaximum;
                alertClass = 'error';
            } else {
                alertClass = 'notice';
                compareObject.push(productHandle);
                alertText = theme.strings.compareNotifyAdded;
            }
        }
        localStorage.setItem('localCompare', JSON.stringify(compareObject));
        theme.alert.new(theme.strings.compareText, alertText, 2000, alertClass);
        $compareCount.text(compareObject.length);
    };

    function loadCompare() {
        var compareGrid;
        $compareContainer.html('');
        //popup compare
        if (compareObject.length > 0) {
            compareGrid = compareObject.length === 1 ? 'col-md-6 col-sm-6' : 'col';
            for (var i = 0; i < compareObject.length; i++) {
                var productHandle = compareObject[i];
                Shopify.getProduct(productHandle, function(product) {
                    var htmlProduct = '',
                        productPrice = product.price_varies ? 'from ' + theme.Currency.formatMoney(product.price_min, theme.moneyFormat) : theme.Currency.formatMoney(product.price, theme.moneyFormat),
                        productComparePrice = product.compare_at_price_min !== 0 ? theme.Currency.formatMoney(product.compare_at_price_min, theme.moneyFormat) : '',
                        productAvailable = product.available ? theme.strings.available : theme.strings.unavailable,
                        productAvailableClass = product.available ? 'alert-success' : 'alert-danger',
                        productTypeHTML = product.type !== "" ? '<a href="/collections/types?q=' + product.type + '">' + product.type + '</a>' : '<span>' + theme.strings.none + '</span>',
                        productVendorHTML = product.vendor !== "" ? '<a href="/collections/vendors?q=' + product.vendor + '">' + product.vendor + '</a>' : '<span>' + theme.strings.none + '</span>';
                    htmlProduct += '<div class="compare-item ' + compareGrid + ' col-xs-6">';
                    htmlProduct += '	<a href="' + product.url + '">';
                    htmlProduct += '		<img src="' + Shopify.resizeImage(product.featured_image, 'x300') + '"/>';
                    htmlProduct += '	</a>';
                    htmlProduct += '	<hr /><h5 >' + product.title + '</h5>';
                    htmlProduct += '	<hr /><s>' + productComparePrice + '</s>';
                    htmlProduct += '	<span> ' + productPrice + '</span>';
                    htmlProduct += '	<hr /><span class=' + productAvailableClass + '> ' + productAvailable + '</span>';
                    htmlProduct += '	<hr />' + productTypeHTML;
                    htmlProduct += '	<hr />' + productVendorHTML;
                    htmlProduct += '  <hr /><button class="btn js-remove-compare btn-theme gradient-theme" data-handle="' + product.handle + '">' + theme.strings.compareRemove + '</button>';
                    htmlProduct += '</div>';
                    $compareContainer.append(htmlProduct);
                    theme.updateCurrencies();
                });
            }
        } else {
            $compareContainer.html('<div class="alert alert-warning d-inline-block">' + theme.strings.compareNoResult + '</div>');
        }

        //button text
        $(compareButtonClass).each(function() {
            var productHandle = $(this).data('handle');
            var status = $.inArray(productHandle, compareObject) !== -1 ? 'added' : '';
            $(this).removeClass('added').addClass(status);
        });

        //count items
        $compareCount.text(compareObject.length);
    }
    $(document).on('click', compareButtonClass, function(event) {
        event.preventDefault();
        updateCompare(this);
        loadCompare();
    });
    $(document).on('click', compareRemoveButtonClass, function() {
        var productHandle = $(this).data('handle');
        compareObject.splice(compareObject.indexOf(productHandle), 1);
        localStorage.setItem('localCompare', JSON.stringify(compareObject));
        loadCompare();
    });

    loadCompare();
    $(document).on('shopify:section:load', loadCompare);
    return {
        load: loadCompare
    }
})()

// Popup newsletter
theme.popupNewletter = (function() {
    var $popupNewsletter = $('#jsPopupNewsletter'),
        $newsletterForm = $('#jsPopupNewsletter form'),
        date = new Date(),
        minutes = theme.timePopupNewsletter;
    minutesdelay = $popupNewsletter.attr('data-delay');
    if ($popupNewsletter.length === 1) {
        date.setTime(date.getTime() + (minutes * 60 * 1000));
        var setCookies = function() {
            $.cookie('cookiesNewsletter', 'disabled', { expires: date, path: '/' });
        };
        if ($.cookie('cookiesNewsletter') !== "disabled") {
            $(window).on('load', function() {
                setTimeout(function() {
                    $popupNewsletter.modal('show');
                }, minutesdelay * 1000);
            });
            $popupNewsletter.on('hidden.bs.modal', setCookies);
            $newsletterForm.submit(setCookies);
        }
    }
})()

// Cookie policy
theme.cookie = (function() {
    var $policy = $('.js-cookie-policy'),
        $closeButton = $('.js-btn-ok'),
        isOk = localStorage.getItem('localCookie') || '';
    if (isOk === '') {
        $policy.fadeIn('slow');
    }
    $closeButton.on('click', function() {
        localStorage.setItem('localCookie', 'accept');
        $policy.fadeOut('slow');
    })
})()

// Announcement Bar
theme.announcement = (function() {
    var $bar = $('.js-announcement-bar'),
        $closeButton = $('.js-ab-close'),
        isClosed = localStorage.getItem('localAnnouncement') || '';
    if (isClosed === '') {
        $bar.fadeIn();
        $bar.closest('.body-theme').addClass('body-announcement-bar');
    }
    $closeButton.on('click', function() {
        localStorage.setItem('localAnnouncement', 'closed');
        $bar.slideUp();
        $bar.closest('.body-theme').removeClass('body-announcement-bar');
    })
})()

// Open external link in new tab
theme.exLink = (function() {
    var links = document.links;
    for (let i = 0, linksLength = links.length; i < linksLength; i++) {
        if (links[i].hostname !== window.location.hostname && $(links[i]).attr('href') !== 'javascript:void(0)') {
            links[i].target = '_blank';
        }
    }
})()

// Deal- countdown
theme.countdown = (function() {
    function initCountdown() {
        $(".js-countdown").each(function() {
            var endTime = $(this).data('time'),
                htmlLayout = "<ul class='list--inline'><li class='gradient-theme-vertical'><span class='countdown-time'>%%D%%</span><span class='countdown-text'>Days</span></li><li class='gradient-theme-vertical'><span class='countdown-time'>%%H%%</span><span class='countdown-text'>Hours</span></li><li class='gradient-theme-vertical'><span class='countdown-time'>%%M%%</span><span class='countdown-text'>Mins</span></li><li class='gradient-theme-vertical'><span class='countdown-time'>%%S%%</span><span class='countdown-text'>Secs</span></li></ul>";
            $(this).lofCountDown({
                TargetDate: endTime,
                DisplayFormat: htmlLayout,
                FinishMessage: '<span class="alert alert-warning d-inline-block">' + theme.strings.countdownEndText + '</span>'
            });
        });
    }
    initCountdown();
    return {
        load: initCountdown
    }
})()

// Price range - Collection page
theme.priceRange = (function() {
    function initPriceRange() {
        var min = 0,
            max = 0,
            slideRange = '#js-slider-range',
            productCard = '.js-product-card',
            slideRangeWrap = '.slider-range-wr',
            rangeMin = '.js-range-min',
            rangeMax = '.js-range-max',
            enablePriceRange = $('#js-slider-range').length === 1 ? true : false;

        if (enablePriceRange) {
            $(productCard).each(function() {
                if (eval($(this).data('price')) > max) max = eval($(this).data('price'));
                if (min == 0) min = eval($(this).data('price'));
                else if (eval($(this).data('price')) < min) min = eval($(this).data('price'));
            });

            if (min === max) {
                $(slideRangeWrap).fadeOut();
            } else {
                $(slideRangeWrap).fadeIn();
            }

            $(slideRange).slider({
                range: true,
                min: min,
                max: max,
                values: [min, max],
                slide: function(event, ui) {
                    var price1 = (Shopify.formatMoney(ui.values[0], theme.moneyFormat));
                    var price2 = (Shopify.formatMoney(ui.values[1], theme.moneyFormat));
                    $(rangeMin).html(price1);
                    $(rangeMax).html(price2);
                    theme.updateCurrencies();

                    // Show/Hide product when dragging
                    $(productCard).each(function() {
                        if (eval($(this).data('price')) >= ui.values[0] && eval($(this).data('price')) <= ui.values[1]) {
                            $(this).parent().fadeIn();
                        } else {
                            $(this).parent().fadeOut();
                        }
                    });
                }
            });

            var price1 = (Shopify.formatMoney(min, theme.moneyFormat));
            var price2 = (Shopify.formatMoney(max, theme.moneyFormat));
            $(rangeMin).html(price1);
            $(rangeMax).html(price2);
            theme.updateCurrencies();

        }
    }
    initPriceRange();
    return {
        load: initPriceRange
    }
})()

// Collection view - Collection page
theme.collectionView = (function() {
    var btnView = '.js-btn-view',
        btnViewActive = '.js-btn-view.active';

    $(document).on('click', btnView, function() {
        var value = $(this).data('col'),
            $gridItemCol = $('.js-col');

        $(btnView).removeClass('active');
        $(this).addClass('active');

        $gridItemCol.removeClass().addClass('js-col col-sm-6 col-12');
        if (value === 3) {
            $gridItemCol.addClass('col-lg-4');
        } else if (value === 4) {
            $gridItemCol.addClass('col-lg-3');
        } else if (value === 5) {
            $gridItemCol.addClass('col-lg-2-4');
        } else if (value === 6) {
            $gridItemCol.addClass('col-lg-2');
        };
    })

    function triggerCollectionView() {
        $(btnViewActive).trigger('click');
    }

    return {
        triggerView: triggerCollectionView
    }
})()

// Swath variant in card item
theme.swatchCard = (function() {
    $(document).on('click', '.js-swatch-card-item', function() { //click or mouseover
        $(".js-swatch-card-item").removeClass("active");
        $(this).addClass("active");
        var newImage = $(this).data('image');
        var id = $(this).data('id');
        var gridItem = $(this).closest('.js-product-card');
        gridItem.find('.product-card__image').find('img').attr('srcset', newImage);
        gridItem.find('.js-grid-cart').data('id', id).attr('data-id', id);
    });
})()

theme.swatchCard2 = (function() {
    function initVariant(id) {
        var productJson = JSON.parse($('.customJson-' + id).html());
        var $selectorForm = $('.customform-' + id);
        var $button = $('.js-customform-addtocart-' + id);
        var $buttontext = $button.find('span');
        var $wrapObject = $selectorForm.closest('.js-product-card');
        var options = {
            $container: $selectorForm,
            enableHistoryState: false,
            product: productJson,
            singleOptionSelector: '.single-option-selector-' + id,
            originalSelectorId: '#ProductSelect-' + id
        };
        var variants = new slate.Variants(options);
        var AjaxCart = new window.AjaxCart($selectorForm);
        var _updateButton = function(evt) {
            var variant = evt.variant;
            if (variant === undefined) {
                $button.prop('disabled', true).removeClass('btn--sold-out');
                $buttontext.html(theme.strings.unavailable);
            } else {
                if (variant.available) {
                    $button.removeClass('btn--sold-out').prop('disabled', false);
                    $buttontext.html(theme.strings.addToCart);
                } else {
                    $button.prop('disabled', true).addClass('btn--sold-out');
                    $buttontext.html(theme.strings.soldOut);
                }
            }
        }
        var _updateImage = function(evt) {
            var variant = evt.variant;
            var $mainImage = $wrapObject.find('.product-card__image').find('img');
            if (variant !== undefined && variant.featured_image !== null) {
                var variantImage = variant.featured_image;
                $mainImage.attr('srcset', variantImage.src);
            }
        }
        var _updatePrice = function(evt) {
            var $price = $wrapObject.find('.product-card__price');
            var variant = evt.variant;
            if (variant !== undefined) {
                var htmlComparePrice = variant.compare_at_price !== null ? '<s class="product-card__regular-price"><span class="money">' + variant.compare_at_price + '</span></s>' : '';
                var htmlPrice = '<span class="money">' + variant.price + '</span>' + htmlComparePrice;
                $price.html(htmlPrice);
                theme.updateCurrencies();
            }
        }
        variants.$container.on(
            'variantChange', _updateButton
        );
        variants.$container.on(
            'variantChange', _updateImage
        );
        variants.$container.on(
            'variantChange', _updatePrice
        );
    }

    function initForm() {
        $('.js-customform').each(function() {
            var id = $(this).data('id');
            initVariant(id);
        })
    }

    initForm();
    return {
        load: initForm
    }
})()

// Loading
theme.loading = (function() {
    var $loading = $('#js-loading'),
        hasLoading = $('#js-loading').length === 0 ? false : true;
    if (hasLoading) {
        $(window).load(function() {
            $loading.fadeOut();
        });
    }
})()

theme.effectLeavingPage = (function() {
    window.onbeforeunload = function() {
        $('body').css('opacity', '0');
    }
})()

// Isotope
theme.isotope = (function() {
    var enableIsotope = $('.enable-isotope').length === 1 ? true : false,
        $grid = $('.js-grid'),
        filter = '.js-filter-isotope';

    function initIsotope() {
        if (enableIsotope) {
            $grid.isotope({
                itemSelector: '.grid-item',
                percentPosition: true
            })
            $(document).on('click', filter, function() {
                var filterValue = $(this).data('filter') === '*' ? $(this).data('filter') : '.' + $(this).data('filter');
                $(filter).removeClass('active');
                $(this).addClass('active');
                $grid.isotope({
                    filter: filterValue
                });
            });
            $(window).scroll(function() {
                $grid.isotope('layout');
            });
            $(window).load(function() {
                $grid.isotope('layout');
                $(filter).first().trigger('click');
            });
        }
    }
    initIsotope();
})()

//aos



// theme.Wow = (function(){
//   new WOW().init();
// })()




// Masonry
theme.Masonry = (function() {
    function Masonry(container) {
        this.$container = $(container).on('init', this._a11y.bind(this));
        var $masonry = this.$container;
        $masonry.isotope({
            itemSelector: '.grid-item',
            percentPosition: true,
            masonry: {
                columnWidth: '.grid-sizer'
            }
        });
        $(window).load(function() {
            $masonry.isotope('layout').css('opacity', '1');
        });
        $(window).scroll(function() {
            $masonry.isotope('layout').css('opacity', '1');
        });
    }

    Masonry.prototype = _.assignIn({}, Masonry.prototype, {
        _a11y: function(event, obj) {
            var $list = obj.$list;
            var $wrapper = this.$container.parent();

            // Remove default Slick aria-live attr until slider is focused
            $list.removeAttr('aria-live');

            // When an element in the slider is focused set aria-live
            $wrapper.on('focusin', function(evt) {
                if ($wrapper.has(evt.target).length) {
                    $list.attr('aria-live', 'polite');
                }
            });

            // Remove aria-live
            $wrapper.on('focusout', function(evt) {
                if ($wrapper.has(evt.target).length) {
                    $list.removeAttr('aria-live');
                }
            });
        }
    });

    return Masonry;
})();



// Cross-selling
theme.crosssell = (function() {
    var crosssellClass = '.js-crosssell',
        handles = $(crosssellClass).data('handles') || '',
        arrayHandle = handles.split(','),
        $blockCrosssell = $('.block-cross-sell'),
        variantSelectClass = '.js-cross-select',
        crossImageClass = '.cross-item-image',
        crossPriceClass = '.cross-item-money';

    function generateCrosssell() {
        for (var i = 0; i < arrayHandle.length; i++) {
            var productHandle = arrayHandle[i];
            Shopify.getProduct(productHandle, function(product) {
                var htmlCross = '',
                    htmlOption = '',
                    firstAvailableVariant = '',
                    variantCount = product.variants.length;

                // generate select box and check first avaiable variant
                for (var j = 0; j < variantCount; j++) {
                    var variant = product.variants[j],
                        variantImage = variant.featured_image === null ? product.featured_image : variant.featured_image.src,
                        disabled = variant.available ? '' : 'disabled';
                    htmlOption += '<option ' + disabled + ' data-id="' + variant.id + '" data-price="' + variant.price + '" data-image="' + variantImage + '">' + variant.title + '</option>';
                    if (firstAvailableVariant === '' && variant.available) {
                        firstAvailableVariant = variant
                    }
                }
                var productPrice = theme.Currency.formatMoney(firstAvailableVariant.price, theme.moneyFormat),
                    productImage = firstAvailableVariant.featured_image === null ? product.featured_image : firstAvailableVariant.featured_image.src,
                    selectHide = variantCount === 1 ? 'hide' : '';

                // generate HTML
                htmlCross += '<div class="col cross-item ' + product.handle + '">';
                htmlCross += '	<a class="cross-item-image" href="' + product.url + '" title="' + product.title + '"><img src="' + productImage + '" />' + theme.strings.cartIcon + '</a>';
                htmlCross += '	<a target="_blank" href="' + product.url + '" title="' + product.title + '" class="cross-item-title">' + product.title + '</a>';
                htmlCross += '	<span class="cross-item-money">' + productPrice + '</span>';
                htmlCross += '	<select class="js-cross-select ' + selectHide + '" data-image="' + productImage + '" data-price="' + firstAvailableVariant.price + '" data-item="' + firstAvailableVariant.id + '">' + htmlOption + '</select>';
                htmlCross += '</div>';
                $(crosssellClass).append(htmlCross);
                theme.updateCurrencies();
            });
        }
    }

    function showPopupCrosssell(lineItem) {
        //generate lineitem;
        var htmlLineItem = '';
        htmlLineItem += '<span class="alert alert-success d-inline-block mb-2">' + theme.strings.addToCartSuccess + '</span>';
        htmlLineItem += '<div><img src="' + lineItem.image + '" alt="Added Product"></div>';
        htmlLineItem += '<h4 class="cross-item-title">' + lineItem.title + '</h4>';
        htmlLineItem += '<div class="mb-2">' + theme.strings.cartQuantity + ': ' + lineItem.quantity + '</div>';
        $('.js-cross-added').hide().html(htmlLineItem).fadeIn();

        // show popup
        var $popupCrosssell = $('#jsCrosssell');
        $popupCrosssell.modal('show');
    }

    if (handles !== '') {
        $(document).on('click', crossImageClass, function(event) {
            event.preventDefault();
            var parent = $(this).closest('.cross-item'),
                itemId = parent.find(variantSelectClass).attr('data-item');
            Shopify.addItem(itemId, 1, function(lineItem) {
                theme.miniCart.updateElements();
                theme.miniCart.generateCart();
                showPopupCrosssell(lineItem);
            });
        });
        $(document).on('change', variantSelectClass, function() {
            var selectVariant = $(this).children(':selected'),
                selectVariantId = selectVariant.data('id'),
                parent = $(this).parent(),
                newPrice = theme.Currency.formatMoney(selectVariant.data('price'), theme.moneyFormat);

            if (selectVariant.data('image') !== '') {
                parent.find(crossImageClass).find('img').attr('src', selectVariant.data('image'));
            }
            $(this).attr('data-item', selectVariantId);
            parent.find(crossPriceClass).html(newPrice);
            theme.updateCurrencies();
        });
        $(document).on('shopify:section:load', generateCrosssell);
        generateCrosssell();
        $blockCrosssell.removeClass('hide');
    }
    return {
        showPopup: showPopupCrosssell
    }
})()

// Upsell
theme.upsell = (function() {
    var popupUpsell = '#jsUpsell',
        $button = $('#jsUpsell .btn'),
        productUpsellId = $('#jsUpsell').data('id') || '',
        buttonAcceptClass = 'js-btn-accept',
        delayTime = $('#jsUpsell').data('delay') || 3000,
        isUpsell = $(popupUpsell).length === 1 ? true : false;
    if (isUpsell) {
        $(document).ready(function() {
            setTimeout(function() {
                $(popupUpsell).modal('show');
            }, delayTime);
        });
        $button.on('click', function() {
            if ($(this).hasClass(buttonAcceptClass)) {
                Shopify.addItem(productUpsellId, 1, function(item) {
                    theme.miniCart.updateElements();
                    theme.miniCart.generateCart();
                    var htmlVariant = item.variant_title !== null ? '<i>(' + item.variant_title + ')</i>' : '';
                    var htmlAlert = '<div class="media mt-2 alert--cart"><a class="mr-3" href="/cart"><img class="lazyload" data-src="' + item.image + '"></a><div class="media-body align-self-center"><p class="m-0 font-weight-bold">' + item.product_title + ' x ' + item.quantity + '</p>' + htmlVariant + '<div><div>';
                    theme.alert.new(theme.strings.addToCartSuccess, htmlAlert, 3000, 'notice');
                })
            }
            $(popupUpsell).modal('hide');
        })
    }
})()

// Coupon
theme.coupon = (function() {
    var popupCoupon = '#jsCoupon',
        $button = $('#jsCoupon .js-btn-coupon'),
        delayTime = $('#jsCoupon').data('delay') || 3000,
        isCoupon = $(popupCoupon).length === 1 ? true : false,
        isCopied = localStorage.getItem('localCoupon') || '';
    if (isCoupon && isCopied === '') {
        $(document).ready(function() {
            setTimeout(function() {
                $(popupCoupon).modal('show');
            }, delayTime);
        });
        $button.on('click', function() {
            var copyText = document.getElementById("coupon_code");
            copyText.select();
            document.execCommand("Copy");
            $(popupCoupon).modal('hide');
            theme.alert.new('Coupon code', 'Successfully copied, now you can paste code at checkout', 4000);
            localStorage.setItem('localCoupon', 'copied');
        })
    }
})()

// Overwrite Shopify.onError in Shopify API
Shopify.onError = function(t, r) {
    var e = eval("(" + t.responseText + ")");
    var mess = e.message ? e.message + "(" + e.status + "): " + e.description : "Error : " + Shopify.fullMessagesFromErrors(e).join("; ") + "."
    theme.alert.new('Alert', mess, 3000, 'warning');
}

// Megamenu width
theme.fixWidthMegamenu = (function() {
    var $megamenuClass = $('.site-nav__item-mega'),
        megaDropdownClass = '.meganav';
    $megamenuClass.each(function() {
        var widthMenu = $(this).data('width') || 0;
        if (widthMenu !== 0) {
            $(this).find(megaDropdownClass).css({ 'width': widthMenu + 'px', 'margin-left': '-' + widthMenu / 2 + 'px' });
        }
    });
})()

// Product video
theme.productVideo = (function() {
    var playButtonClass = '.js-play-button';
    $(document).on('click', playButtonClass, function() {
        let videoSelector = $(this).next(),
            videoObject = videoSelector.get(0);
        $(this).toggleClass('active');
        videoSelector.toggleClass('active');
        videoObject.paused ? videoObject.play() : videoObject.pause();
    })
})()

// Fake-viewers
theme.fakeViewer = (function() {
    var $fakeViewClass = $('.js-fake-view'),
        minValue = $fakeViewClass.data('min'),
        maxValue = $fakeViewClass.data('max'),
        duration = $fakeViewClass.data('duration');

    function randomInRange(start, end) {
        var value = Math.floor(Math.random() * (end - start + 1) + start);
        $fakeViewClass.text(value);
    }

    if (minValue !== undefined && maxValue !== undefined) {
        randomInRange(minValue, maxValue);
        setInterval(function() {
            randomInRange(minValue, maxValue);
        }, duration);
    }

})();

// Product-suggest
theme.productSuggest = (function() {
    var $productSuggestClass = $('.product-notification'),
        $closeButtonClass = $('.close-notifi'),
        duration = $productSuggestClass.data('time') || 0,
        productSuggestCookie = 'cookieSuggest';

    function SomeonePurchased() {
        if ($.cookie(productSuggestCookie) == 'closed') {
            $productSuggestClass.remove();
        }
        $closeButtonClass.on('click', function() {
            $productSuggestClass.remove();
            $.cookie(productSuggestCookie, 'closed', { expires: 1, path: '/' });
        });

        function toggleSomething() {
            if ($productSuggestClass.hasClass('active')) {
                $productSuggestClass.removeClass('active')
            } else {
                var arrayProducts = $('.data-product'),
                    randomProduct = Math.floor(Math.random() * arrayProducts.length),
                    Object = $(arrayProducts[randomProduct]);

                $productSuggestClass.addClass('active');
                $productSuggestClass.find('.product-image').attr('href', Object.data('url')).find('img').attr('src', Object.data('image'));
                $productSuggestClass.find('.product-name').text(Object.data('title')).attr('href', Object.data('url'));
                $productSuggestClass.find('.time-ago').text(Object.data('time'));
                $productSuggestClass.find('.from-ago').text(Object.data('local'));
            }
        }

        if (duration !== 0) {
            setInterval(toggleSomething, duration);
        }
    }
    SomeonePurchased();
})()


// Stickyheader
theme.stickyHeader = (function() {
    var stickHeaderClass = '.site-header--sticky';
    if ($(stickHeaderClass).length !== 0) {
        $(window).scroll(function() {
            if (window.pageYOffset >= 20) {
                $(stickHeaderClass).addClass('active');
            } else {
                $(stickHeaderClass).removeClass('active');
            }
        });
    }
})()

theme.PhotoSwipe = (function() {
    var initPhotoSwipeFromDOM = function(gallerySelector) {

        // parse slide data (url, title, size ...) from DOM elements 
        // (children of gallerySelector)
        var parseThumbnailElements = function(el) {
            var thumbElements = el.childNodes,
                numNodes = thumbElements.length,
                items = [],
                figureEl,
                linkEl,
                size,
                item;

            for (var i = 0; i < numNodes; i++) {

                figureEl = thumbElements[i]; // <figure> element

                // include only element nodes 
                if (figureEl.nodeType !== 1) {
                    continue;
                }

                linkEl = figureEl.children[0]; // <a> element

                size = linkEl.getAttribute('data-size').split('x');

                // create slide object
                item = {
                    src: linkEl.getAttribute('href'),
                    w: parseInt(size[0], 10),
                    h: parseInt(size[1], 10)
                };



                if (figureEl.children.length > 1) {
                    // <figcaption> content
                    item.title = figureEl.children[1].innerHTML;
                }

                if (linkEl.children.length > 0) {
                    // <img> thumbnail element, retrieving thumbnail url
                    item.msrc = linkEl.children[0].getAttribute('src');
                }

                item.el = figureEl; // save link to element for getThumbBoundsFn
                items.push(item);
            }

            return items;
        };

        // find nearest parent element
        var closest = function closest(el, fn) {
            return el && (fn(el) ? el : closest(el.parentNode, fn));
        };

        // triggers when user clicks on thumbnail
        var onThumbnailsClick = function(e) {
            e = e || window.event;
            e.preventDefault ? e.preventDefault() : e.returnValue = false;

            var eTarget = e.target || e.srcElement;

            // find root element of slide
            var clickedListItem = closest(eTarget, function(el) {
                return (el.tagName && el.tagName.toUpperCase() === 'FIGURE');
            });

            if (!clickedListItem) {
                return;
            }

            // find index of clicked item by looping through all child nodes
            // alternatively, you may define index via data- attribute
            var clickedGallery = clickedListItem.parentNode,
                childNodes = clickedListItem.parentNode.childNodes,
                numChildNodes = childNodes.length,
                nodeIndex = 0,
                index;

            for (var i = 0; i < numChildNodes; i++) {
                if (childNodes[i].nodeType !== 1) {
                    continue;
                }

                if (childNodes[i] === clickedListItem) {
                    index = nodeIndex;
                    break;
                }
                nodeIndex++;
            }



            if (index >= 0) {
                // open PhotoSwipe if valid index found
                openPhotoSwipe(index, clickedGallery);
            }
            return false;
        };

        // parse picture index and gallery index from URL (#&pid=1&gid=2)
        var photoswipeParseHash = function() {
            var hash = window.location.hash.substring(1),
                params = {};

            if (hash.length < 5) {
                return params;
            }

            var vars = hash.split('&');
            for (var i = 0; i < vars.length; i++) {
                if (!vars[i]) {
                    continue;
                }
                var pair = vars[i].split('=');
                if (pair.length < 2) {
                    continue;
                }
                params[pair[0]] = pair[1];
            }

            if (params.gid) {
                params.gid = parseInt(params.gid, 10);
            }

            return params;
        };

        var openPhotoSwipe = function(index, galleryElement, disableAnimation, fromURL) {
            var pswpElement = document.querySelectorAll('.pswp')[0],
                gallery,
                options,
                items;

            items = parseThumbnailElements(galleryElement);

            // define options (if needed)
            options = {
                maxSpreadZoom: 1,
                bgOpacity: 0.7,
                zoomEl: true,
                history: false,
                zoomEl: false,
                pinchToClose: false,
                closeOnScroll: false,
                // define gallery index (for URL)
                galleryUID: galleryElement.getAttribute('data-pswp-uid'),

            };

            // PhotoSwipe opened from URL
            if (fromURL) {
                if (options.galleryPIDs) {
                    // parse real index when custom PIDs are used 
                    // http://photoswipe.com/documentation/faq.html#custom-pid-in-url
                    for (var j = 0; j < items.length; j++) {
                        if (items[j].pid == index) {
                            options.index = j;
                            break;
                        }
                    }
                } else {
                    // in URL indexes start from 1
                    options.index = parseInt(index, 10) - 1;
                }
            } else {
                options.index = parseInt(index, 10);
            }

            // exit if index not found
            if (isNaN(options.index)) {
                return;
            }

            if (disableAnimation) {
                options.showAnimationDuration = 0;
            }

            // Pass data to PhotoSwipe and initialize it
            gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, items, options);
            gallery.init();
        };

        // loop through all gallery elements and bind events
        var galleryElements = document.querySelectorAll(gallerySelector);

        for (var i = 0, l = galleryElements.length; i < l; i++) {
            galleryElements[i].setAttribute('data-pswp-uid', i + 1);
            galleryElements[i].onclick = onThumbnailsClick;
        }

        // Parse URL and open gallery if it contains #&pid=3&gid=1
        var hashData = photoswipeParseHash();
        if (hashData.pid && hashData.gid) {
            openPhotoSwipe(hashData.pid, galleryElements[hashData.gid - 1], true, true);
        }
    };

    // execute above function
    initPhotoSwipeFromDOM('.my-gallery');
})()

theme.ZoomImage = (function() {
    $(window).resize(function() {
        var width = $(window).width();
        if (width > 767) {
            ZoomImage();
        }
    });
    $(window).width(function() {
        var width = $(window).width();
        if (width > 767) {
            ZoomImage();
        }
    });

    function ZoomImage() {
        $(".zoom_image").each(function(arg, el) {
            var image = $(el).find("img");
            $(el).zoom({
                on: 'mouseover',
                url: image.attr("src").replace("small", "big")
            });
        });
    }
})()

theme.activeAccordion = (function() {
    $('.collapse').on('shown.bs.collapse', function() {
        $(this).prev().addClass('active-acc');
    });
    $('.collapse').on('hidden.bs.collapse', function() {
        $(this).prev().removeClass('active-acc');
    });
})()


// Anchor scroll
theme.anchorScroll = (function() {
    $(document).on('click', 'a[href^="#"]', function(event) {
        event.preventDefault();
        var disableAnchor = $(this).hasClass('disabled-anchor');
        if (!disableAnchor) {
            $('html, body').animate({
                scrollTop: $($.attr(this, 'href')).offset().top
            }, 500);
        }
    });
})()

// Product-recently-viewed
theme.productRecentlyViewed = (function() {
    var $viewedElement = $('.js-recently-view'),
        $viewButton = $('.js-recently-view-button'),
        $content = $('.js-recently-view-content'),
        productHandle = $viewedElement.data('handle') || '',
        limit = $viewButton.data('limit') || 0,
        arrayProduct = JSON.parse(localStorage.getItem('localRecentlyViewed')) || [],
        lastProduct = arrayProduct[arrayProduct.length - 1] || '',
        isAdded = $.inArray(productHandle, arrayProduct) !== -1 ? true : false;

    function processViewed() {
        if (productHandle !== '') {
            //process last product
            if (lastProduct === productHandle && arrayProduct.length > 1) {
                lastProduct = arrayProduct[arrayProduct.length - 2]
            }

            //move current product to last of array
            if (isAdded) {
                arrayProduct.splice(arrayProduct.indexOf(productHandle), 1);
            }
            arrayProduct.push(productHandle);
            //remove first item if limit
            if (arrayProduct.length > limit) {
                arrayProduct.shift()
            }
            localStorage.setItem('localRecentlyViewed', JSON.stringify(arrayProduct));
        }
    }

    function generatorProduct() {
        $content.html('');
        if (arrayProduct.length > 0) {
            //array
            for (var i = 0; i < arrayProduct.length; i++) {
                var productHandle = arrayProduct[i];
                Shopify.getProduct(productHandle, function(product) {
                    var htmlProduct = '';
                    var productPrice = product.price_varies ? 'from ' + theme.Currency.formatMoney(product.price_min, theme.moneyFormat) : theme.Currency.formatMoney(product.price, theme.moneyFormat);
                    var productComparePrice = product.compare_at_price_min !== 0 ? theme.Currency.formatMoney(product.compare_at_price_min, theme.moneyFormat) : '';
                    htmlProduct += '<div class="col-12 col-lg-4 js-viewed-item mb-4">';
                    htmlProduct += '	<div class="border p-3 rounded media d-flex ">';
                    htmlProduct += '	<a class="mr-3 col-4 p-0" href="' + product.url + '">';
                    htmlProduct += '		<img src="' + product.featured_image + '"/>';
                    htmlProduct += '	</a>';
                    htmlProduct += '	<div class="media-body text-left">';
                    htmlProduct += '		<h4 class="mb-2 mt-2"><a href="' + product.url + '">' + product.title + '</a></h5>';
                    htmlProduct += '	<span> ' + productPrice + '</span>';
                    htmlProduct += '	<s>' + productComparePrice + '</s>';
                    htmlProduct += '	</div>';
                    htmlProduct += '	</div>';
                    htmlProduct += '</div>';
                    $content.append(htmlProduct);
                    theme.updateCurrencies();
                });
            }

            //last product
            Shopify.getProduct(lastProduct, function(product) {
                $viewButton.css('background-image', 'url(' + product.featured_image + ')').addClass('active');
            })
        }
    }

    processViewed();
    generatorProduct();

})()

// Notice when soldout
theme.alert = (function() {
    function createAlert(title, mess, time, type) {
        var aTitle = title || '',
            aTime = time || 2000,
            aMessage = mess || '',
            aClass = type || 'default';
        $.growl({
            title: aTitle,
            message: aMessage,
            duration: aTime,
            style: aClass,
            size: 'large'
        });
    }

    return {
        new: createAlert
    }
})()

// Notice when soldout
theme.noticeSoldout = (function() {
    var $soldoutWrapFormClass = $('.js-contact-soldout'),
        $textClass = $('.js-notify-text'),
        $soldoutValueId = $('#ContactProduct');

    function noticeSoldout(variant) {
        $soldoutWrapFormClass.find('.form-success').remove()
        if (variant.available) {
            $textClass.find('span').text('');
            $soldoutWrapFormClass.addClass('hide');
        } else {
            $textClass.find('span').text(': ' + variant.name);
            $soldoutWrapFormClass.removeClass('hide');
            $soldoutValueId.val(variant.name).attr('value', variant.name);
        }
    }
    return {
        init: noticeSoldout
    }
})()

// Sticky cart
theme.stickyCart = (function() {
    var $anchor = $('#js-anchor-sticky-cart'),
        $stCart = $('.sticky-cart-wr'),
        $close = $('#js-sticky-close'),
        disableStCart = localStorage.getItem('localDisableStCart') || '';
    if (disableStCart !== '') {
        $stCart.addClass('disable');
    }
    $close.on('click', function() {
        var isDisable = disableStCart !== '';
        if (isDisable) {
            localStorage.setItem('localDisableStCart', '');
        } else {
            localStorage.setItem('localDisableStCart', 'true');
        }
        $stCart.toggleClass('disable');
    })
    if ($anchor.length) {
        $(window).on('scroll', function() {
            var hT = $anchor.offset().top,
                hH = $anchor.outerHeight(),
                wH = $(window).height(),
                wS = $(this).scrollTop();
            if (wS > (hT + hH - wH)) {
                $stCart.addClass('active');
            } else {
                $stCart.removeClass('active');
            }
        });
    }

})()

//Fix reload safari
window.addEventListener("pageshow", function(evt) {
    if (evt.persisted) {
        setTimeout(function() {
            window.location.reload();
        }, 10);
    }
}, false);

// Back to top
theme.backToTop = (function() {
    var backtotopClass = $('.js-back-to-top');
    $(window).scroll(function() {
        if ($(this).scrollTop() > 300) {
            backtotopClass.fadeIn('slow');
        } else {
            backtotopClass.fadeOut('slow');
        }
    });
    backtotopClass.on('click', function() {
        $('body,html').animate({ scrollTop: 0 }, 800);
    });
})()


// Tooltip
theme.tooltip = (function() {
    var selector = '[data-toggle="tooltip"],[data-tooltip="true"]';

    function loadTooltip() {
        $(selector).tooltip(); //Bootstrap 4
    };
    $(document).on('click', selector, function() {
        $(this).tooltip('hide');
    });
    loadTooltip();
    return {
        load: loadTooltip
    }
})()

//Collections style 2
theme.Bgcollection = (function() {
    // init Isotope
    function Bgcollection(container) {
        var $container = this.$container = $(container);
        var sectionId = $container.attr('data-section-id');
        var wrapper = this.wrapper = '.bgcollection-wrapper';
        var slider = this.slider = '#Bgcollection-' + sectionId;
        var $slider = $(slider, wrapper);
        $(".colgrid__bg--full[data-index='1']").addClass('active');
        $('.colgrid .colgrid__box').each(function() {
            var index = $(this).attr("data-index");
            $(this).hover(
                function() {
                    $(".colgrid__bg--full[data-index='" + index + "']").addClass('active');
                },
                function() {
                    $(".colgrid__bg--full[data-index='" + index + "']").removeClass('active');
                }
            );
        });
    }

    return Bgcollection;
})();


//Sidebar
theme.sidebar = (function() {
    var togglebutton = '.js-toggle-filter',
        $sidebar = $('.js-sidebar');
    $(document).on('click', togglebutton, function() {
        $sidebar.toggleClass('active');
        $(this).toggleClass('active');
    })
})()

// Ajax filter in collection page
theme.ajaxFilter = (function() {
    var ajaxContent = '#js-product-ajax',
        ajaxSortBy = '#js-sortby',
        ajaxFillter = '#js-fillter',
        ajaxCollectionTitle = '.js-collection-title',
        pageTitle = $(document).find("title").text(),
        jsLoading = '#js-loading';

    var apollo = {
        init: function() {
            this.initFilter();
        },
        showLoading: function() {
            $(jsLoading).show();
        },
        hideLoading: function() {
            $('body,html').animate({
                scrollTop: $('#MainContent').offset().top - 150
            }, 600);
            setTimeout(function() {
                $(jsLoading).hide(); //delay 500ms for better UX
            }, 500);

        },
        initFilter: function() {
            apollo.filterParams();
            apollo.filterSortby();
            apollo.sidebarMapTagEvents();
            apollo.filterMapSorting();
            apollo.filterMapPaging();
        },
        filterParams: function() {
            Shopify.queryParams = {};
            if (location.search.length) {
                for (var aKeyValue, i = 0, aCouples = location.search.substr(1).split('&'); i < aCouples.length; i++) {
                    aKeyValue = aCouples[i].split('=');
                    if (aKeyValue.length > 1) {
                        Shopify.queryParams[decodeURIComponent(aKeyValue[0])] = decodeURIComponent(aKeyValue[1]);
                    }
                }
            }
        },
        filterSortby: function() {
            if (Shopify.queryParams.sort_by) {
                var sortby = Shopify.queryParams.sort_by;
                $(ajaxSortBy).val(sortby);
            }
        },
        filterCreateUrl: function(baseLink) {
            var newQuery = $.param(Shopify.queryParams).replace(/%2B/g, '+');
            if (baseLink) {
                if (newQuery != "") {
                    return baseLink + "?" + newQuery;
                } else {
                    return baseLink;
                }
            }
            return location.pathname + "?" + newQuery;
        },
        filterMapData: function(data) {
            // 1. update product grid
            $(ajaxContent).html($(ajaxContent, data.responseText).html());
            // 2. update left filter
            $(ajaxFillter).html($(ajaxFillter, data.responseText).html());
            // 3. update collection title
            $(ajaxCollectionTitle).html($(ajaxCollectionTitle, data.responseText).html());
        },
        filterAjaxClick: function(baseLink) {
            delete Shopify.queryParams.page;
            var newurl = apollo.filterCreateUrl(baseLink);
            History.pushState({
                param: Shopify.queryParams
            }, pageTitle, newurl);
            apollo.filterGetContent(newurl);
        },
        filterGetContent: function(newurl) {
            $.ajax({
                type: 'GET',
                url: newurl,
                data: {},
                beforeSend: function() {
                    apollo.showLoading();
                },
                complete: function(data) {
                    apollo.filterMapData(data);
                    theme.wishlist.load();
                    theme.compare.load();
                    theme.countdown.load();
                    theme.priceRange.load();
                    theme.tooltip.load();
                    theme.collectionView.triggerView();
                    theme.swatchCard2.load();
                    theme.infiniteScroll.load();
                    apollo.hideLoading();
                },
                error: function(xhr, text) {
                    apollo.hideLoading();
                    alert($.parseJSON(xhr.responseText).description);
                }
            });
        },
        sidebarMapTagEvents: function() {
            $(document).on('click', '.advanced-filter a', function(event) {
                event.preventDefault();
                $('.tooltip').removeClass('show');
                var currentTags = [];
                if (Shopify.queryParams.constraint) {
                    currentTags = Shopify.queryParams.constraint.split('+');
                }
                if (!$(this).parent().hasClass("active-filter")) {
                    var otherTag = $(this).parents('.catalog_filter_ul').find("li.active-filter");
                    if (otherTag.length > 0) {
                        var tagName = otherTag.data("handle");
                        if (tagName) {
                            var tagPos = currentTags.indexOf(tagName);
                            if (tagPos >= 0) {
                                currentTags.splice(tagPos, 1);
                            }
                        }
                    }
                }
                var dataHandle = $(this).parent().data("handle");
                if (dataHandle) {
                    var tagPos = currentTags.indexOf(dataHandle);
                    if (tagPos >= 0) {
                        currentTags.splice(tagPos, 1);
                    } else {
                        currentTags.push(dataHandle);
                    }
                }
                if (currentTags.length) {
                    Shopify.queryParams.constraint = currentTags.join('+');
                } else {
                    delete Shopify.queryParams.constraint;
                }
                apollo.filterAjaxClick();
            });
            $(document).on('click', '.advanced-filter .icon', function() {
                $(this).parent('.advanced-filter').find('a').trigger("click");
            });
        },
        filterMapSorting: function() {
            $(document).on('change', ajaxSortBy, function() {
                Shopify.queryParams.sort_by = $(this).val();
                apollo.filterAjaxClick();
            })
        },
        filterMapPaging: function() {
            $(document).on('click', '.js-pagination a', function() {
                event.preventDefault();
                var linkPage = $(this).attr("href").match(/page=\d+/g);
                if (linkPage) {
                    Shopify.queryParams.page = parseInt(linkPage[0].match(/\d+/g));
                    if (Shopify.queryParams.page) {
                        var newurl = apollo.filterCreateUrl();
                        History.pushState({
                            param: Shopify.queryParams
                        }, pageTitle, newurl);
                        apollo.filterGetContent(newurl);
                    }
                }
            });
        }
    }

    if ($(".template-collection")) {
        History.Adapter.bind(window, 'statechange', function() {
            var State = History.getState();
            apollo.filterParams();
        });
    }
    apollo.init();

})();
$(theme.init);r image = images[i];
            this.loadImage(this.getSizedImageUrl(image, size));
        }
    }

    /**
     * Loads and caches an image in the browsers cache.
     * @param {string} path - An image url
     */
    function loadImage(path) {
        new Image().src = path;
    }

    /**
     * Swaps the src of an image for another OR returns the imageURL to the callback function
     * @param image
     * @param element
     * @param callback
     */
    function switchImage(image, element, callback) {
        var size = this.imageSize(element.src);
        var imageUrl = this.getSizedImageUrl(image.src, size);

        if (callback) {
            callback(imageUrl, image, element); // eslint-disable-line callback-return
        } else {
            element.src = imageUrl;
        }
    }

    /**
     * +++ Useful
     * Find the Shopify image attribute size
     *
     * @param {string} src
     * @returns {null}
     */
    function imageSize(src) {
        src = src || '';

        var match = src.match(
            /.+_((?:pico|icon|thumb|small|compact|medium|large|grande)|\d{1,4}x\d{0,4}|x\d{1,4})[_\\.@]/
        );

        if (match === null) {
            return null;
        } else {
            return match[1];
        }
    }

    /**
     * +++ Useful
     * Adds a Shopify size attribute to a URL
     *
     * @param src
     * @param size
     * @returns {*}
     */
    function getSizedImageUrl(src, size) {
        if (size === null) {
            return src;
        }

        if (size === 'master') {
            return this.removeProtocol(src);
        }

        var match = src.match(
            /\.(jpg|jpeg|gif|png|bmp|bitmap|tiff|tif)(\?v=\d+)?$/i
        );

        if (match !== null) {
            var prefix = src.split(match[0]);
            var suffix = match[0];

            return this.removeProtocol(prefix[0] + '_' + size + suffix);
        }

        return null;
    }

    function removeProtocol(path) {
        return path.replace(/http(s)?:/, '');
    }

    return {
        preload: preload,
        loadImage: loadImage,
        switchImage: switchImage,
        imageSize: imageSize,
        getSizedImageUrl: getSizedImageUrl,
        removeProtocol: removeProtocol
    };
})();

/**
 * Variant Selection scripts
 * ------------------------------------------------------------------------------
 *
 * Handles change events from the variant inputs in any `cart/add` forms that may
 * exist.  Also updates the master select and triggers updates when the variants
 * price or image changes.
 *
 * @namespace variants
 */

slate.Variants = (function() {
    /**
     * Variant constructor
     *
     * @param {object} options - Settings from `product.js`
     */
    function Variants(options) {
        this.$container = options.$container;
        this.product = options.product;
        this.singleOptionSelector = options.singleOptionSelector;
        this.originalSelectorId = options.originalSelectorId;
        this.enableHistoryState = options.enableHistoryState;
        this.currentVariant = this._getVariantFromOptions();

        $(this.singleOptionSelector, this.$container).on(
            'change',
            this._onSelectChange.bind(this)
        );
    }

    Variants.prototype = _.assignIn({}, Variants.prototype, {
        /**
         * Get the currently selected options from add-to-cart form. Works with all
         * form input elements.
         *
         * @return {array} options - Values of currently selected variants
         */
        _getCurrentOptions: function() {
            var currentOptions = _.map(
                $(this.singleOptionSelector, this.$container),
                function(element) {
                    var $element = $(element);
                    var type = $element.attr('type');
                    var currentOption = {};

                    if (type === 'radio' || type === 'checkbox') {
                        if ($element[0].checked) {
                            currentOption.value = $element.val();
                            currentOption.index = $element.data('index');

                            return currentOption;
                        } else {
                            return false;
                        }
                    } else {
                        currentOption.value = $element.val();
                        currentOption.index = $element.data('index');

                        return currentOption;
                    }
                }
            );

            // remove any unchecked input values if using radio buttons or checkboxes
            currentOptions = _.compact(currentOptions);

            return currentOptions;
        },

        /**
         * Find variant based on selected values.
         *
         * @param  {array} selectedValues - Values of variant inputs
         * @return {object || undefined} found - Variant object from product.variants
         */
        _getVariantFromOptions: function() {
            var selectedValues = this._getCurrentOptions();
            var variants = this.product.variants;

            var found = _.find(variants, function(variant) {
                return selectedValues.every(function(values) {
                    return _.isEqual(variant[values.index], values.value);
                });
            });

            return found;
        },

        /**
         * Event handler for when a variant input changes.
         */
        _onSelectChange: function() {
            var variant = this._getVariantFromOptions();

            this.$container.trigger({
                type: 'variantChange',
                variant: variant
            });

            if (!variant) {
                return;
            }

            this._updateMasterSelect(variant);
            this._updateImages(variant);
            this._updatePrice(variant);
            this._updateSKU(variant);
            this.currentVariant = variant;

            if (this.enableHistoryState) {
                this._updateHistoryState(variant);
            }
        },

        /**
         * Trigger event when variant image changes
         *
         * @param  {object} variant - Currently selected variant
         * @return {event}  variantImageChange
         */
        _updateImages: function(variant) {
            var variantImage = variant.featured_image || {};
            var currentVariantImage = this.currentVariant.featured_image || {};

            if (!variant.featured_image ||
                variantImage.src === currentVariantImage.src
            ) {
                return;
            }

            this.$container.trigger({
                type: 'variantImageChange',
                variant: variant
            });
        },

        /**
         * Trigger event when variant price changes.
         *
         * @param  {object} variant - Currently selected variant
         * @return {event} variantPriceChange
         */
        _updatePrice: function(variant) {
            if (
                variant.price === this.currentVariant.price &&
                variant.compare_at_price === this.currentVariant.compare_at_price
            ) {
                return;
            }

            this.$container.trigger({
                type: 'variantPriceChange',
                variant: variant
            });
        },

        /**
         * Trigger event when variant sku changes.
         *
         * @param  {object} variant - Currently selected variant
         * @return {event} variantSKUChange
         */
        _updateSKU: function(variant) {
            if (variant.sku === this.currentVariant.sku) {
                return;
            }

            this.$container.trigger({
                type: 'variantSKUChange',
                variant: variant
            });
        },

        /**
         * Update history state for product deeplinking
         *
         * @param  {variant} variant - Currently selected variant
         * @return {k}         [description]
         */
        _updateHistoryState: function(variant) {
            if (!history.replaceState || !variant) {
                return;
            }

            var newurl =
                window.location.protocol +
                '//' +
                window.location.host +
                window.location.pathname +
                '?variant=' +
                variant.id;
            window.history.replaceState({ path: newurl }, '', newurl);
        },

        /**
         * Update hidden master select of variant change
         *
         * @param  {variant} variant - Currently selected variant
         */
        _updateMasterSelect: function(variant) {
            $(this.originalSelectorId, this.$container).val(variant.id);
        }
    });

    return Variants;
})();


/*================ MODULES ================*/
window.Drawers = (function() {
    var Drawer = function(id, position, options) {
        var defaults = {
            close: '.js-drawer-close',
            open: '.js-drawer-open-' + position,
            openClass: 'js-drawer-open',
            dirOpenClass: 'js-drawer-open-' + position
        };

        this.nodes = {
            $parent: $('body, html'),
            $page: $('.page-element'),
            $moved: $('.is-moved-by-drawer')
        };

        this.config = $.extend(defaults, options);
        this.position = position;

        this.$drawer = $('#' + id);
        this.$open = $(this.config.open);

        if (!this.$drawer.length) {
            return false;
        }

        this.drawerIsOpen = false;
        this.init();
    };

    Drawer.prototype.init = function() {
        this.$open.attr('aria-expanded', 'false');
        this.$open.on('click', $.proxy(this.open, this));
        this.$drawer.find(this.config.close).on('click', $.proxy(this.close, this));
    };

    Drawer.prototype.open = function(evt) {
        // Keep track if drawer was opened from a click, or called by another function
        var externalCall = false;

        // don't open an opened drawer
        if (this.drawerIsOpen) {
            return;
        }

        this.$open.addClass(this.config.openClass);

        // Prevent following href if link is clicked
        if (evt) {
            evt.preventDefault();
        } else {
            externalCall = true;
        }

        // Without this, the drawer opens, the click event bubbles up to $nodes.page
        // which closes the drawer.
        if (evt && evt.stopPropagation) {
            evt.stopPropagation();
            // save the source of the click, we'll focus to this on close
            this.$activeSource = $(evt.currentTarget);
        }

        if (this.drawerIsOpen && !externalCall) {
            return this.close();
        }

        // Add is-transitioning class to moved elements on open so drawer can have
        // transition for close animation
        this.nodes.$moved.addClass('is-transitioning');
        this.$drawer.prepareTransition();

        this.nodes.$parent.addClass(
            this.config.openClass + ' ' + this.config.dirOpenClass
        );
        this.drawerIsOpen = true;

        // Set focus on drawer
        slate.a11y.trapFocus({
            $container: this.$drawer,
            namespace: 'drawer_focus'
        });

        // Run function when draw opens if set
        if (
            this.config.onDrawerOpen &&
            typeof this.config.onDrawerOpen === 'function'
        ) {
            if (!externalCall) {
                this.config.onDrawerOpen();
            }
        }

        if (this.$activeSource && this.$activeSource.attr('aria-expanded')) {
            this.$activeSource.attr('aria-expanded', 'true');
        }

        this.bindEvents();
    };

    Drawer.prototype.close = function() {
        // don't close a closed drawer
        if (!this.drawerIsOpen) {
            return;
        }

        this.$open.removeClass(this.config.openClass);

        // deselect any focused form elements
        $(document.activeElement).trigger('blur');

        // Ensure closing transition is applied to moved elements, like the nav
        this.nodes.$moved.prepareTransition({ disableExisting: true });
        this.$drawer.prepareTransition({ disableExisting: true });

        this.nodes.$parent.removeClass(
            this.config.dirOpenClass + ' ' + this.config.openClass
        );

        this.drawerIsOpen = false;

        // Remove focus on drawer
        slate.a11y.removeTrapFocus({
            $container: this.$drawer,
            namespace: 'drawer_focus'
        });

        if (this.$activeSource && this.$activeSource.attr('aria-expanded')) {
            this.$activeSource.attr('aria-expanded', 'false');
        }

        this.unbindEvents();
    };

    Drawer.prototype.bindEvents = function() {
        // Lock scrolling on mobile
        this.nodes.$page.on('touchmove.drawer', function() {
            return false;
        });

        // Clicking out of drawer closes it
        this.nodes.$page.on(
            'click.drawer',
            $.proxy(function() {
                this.close();
                return false;
            }, this)
        );

        // Pressing escape closes drawer
        this.nodes.$parent.on(
            'keyup.drawer',
            $.proxy(function(evt) {
                if (evt.keyCode === 27) {
                    this.close();
                }
            }, this)
        );
    };

    Drawer.prototype.unbindEvents = function() {
        this.nodes.$page.off('.drawer');
        this.nodes.$parent.off('.drawer');
    };

    return Drawer;
})();

window.Modals = (function() {
    var Modal = function(id, name, options) {
        var defaults = {
            close: '.js-modal-close',
            open: '.js-modal-open-' + name,
            openClass: 'modal--is-active'
        };

        this.$modal = $('#' + id);

        if (!this.$modal.length) {
            return false;
        }

        this.nodes = {
            $body: $('body')
        };

        this.config = $.extend(defaults, options);

        this.modalIsOpen = false;
        this.$focusOnOpen = this.config.focusOnOpen ?
            $(this.config.focusOnOpen) :
            this.$modal;
        this.init();
    };

    Modal.prototype.init = function() {
        var $openBtn = $(this.config.open);

        // Add aria controls
        $openBtn.attr('aria-expanded', 'false');

        $(this.config.open).on('click', $.proxy(this.open, this));
        this.$modal.find(this.config.close).on('click', $.proxy(this.close, this));
    };

    Modal.prototype.open = function(evt) {
        // Keep track if modal was opened from a click, or called by another function
        var externalCall = false;

        // don't open an opened modal
        if (this.modalIsOpen) {
            return;
        }

        // Prevent following href if link is clicked
        if (evt) {
            evt.preventDefault();
        } else {
            externalCall = true;
        }

        // Without this, the modal opens, the click event bubbles up to $nodes.page
        // which closes the modal.
        if (evt && evt.stopPropagation) {
            evt.stopPropagation();
            // save the source of the click, we'll focus to this on close
            this.$activeSource = $(evt.currentTarget);
        }

        if (this.modalIsOpen && !externalCall) {
            return this.close();
        }

        this.$modal.prepareTransition().addClass(this.config.openClass);
        this.nodes.$body.addClass(this.config.openClass);

        this.modalIsOpen = true;

        // Set focus on modal
        slate.a11y.trapFocus({
            $container: this.$modal,
            namespace: 'modal_focus',
            $elementToFocus: this.$focusOnOpen
        });

        if (this.$activeSource && this.$activeSource.attr('aria-expanded')) {
            this.$activeSource.attr('aria-expanded', 'true');
        }

        this.bindEvents();
    };

    Modal.prototype.close = function() {
        // don't close a closed modal
        if (!this.modalIsOpen) {
            return;
        }

        // deselect any focused form elements
        $(document.activeElement).trigger('blur');

        this.$modal.prepareTransition().removeClass(this.config.openClass);
        this.nodes.$body.removeClass(this.config.openClass);

        this.modalIsOpen = false;

        // Remove focus on modal
        slate.a11y.removeTrapFocus({
            $container: this.$modal,
            namespace: 'modal_focus'
        });

        if (this.$activeSource && this.$activeSource.attr('aria-expanded')) {
            this.$activeSource.attr('aria-expanded', 'false').focus();
        }

        this.unbindEvents();
    };

    Modal.prototype.bindEvents = function() {
        // Pressing escape closes modal
        this.nodes.$body.on(
            'keyup.modal',
            $.proxy(function(evt) {
                if (evt.keyCode === 27) {
                    this.close();
                }
            }, this)
        );
    };

    Modal.prototype.unbindEvents = function() {
        this.nodes.$body.off('.modal');
    };

    return Modal;
})();

window.QtySelector = (function() {
    var QtySelector = function($el) {
        this.cache = {
            $body: $('body'),
            $subtotal: $('#CartSubtotal'),
            $discountTotal: $('#cartDiscountTotal'),
            $cartTable: $('.cart-table'),
            $cartTemplate: $('#CartProducts')
        };

        this.settings = {
            loadingClass: 'js-qty--is-loading',
            isCartTemplate: this.cache.$body.hasClass('template-cart'),
            // On the cart template, minimum is 0. Elsewhere min is 1
            minQty: this.cache.$body.hasClass('template-cart') ? 0 : 1
        };

        this.$el = $el;
        this.qtyUpdateTimeout;
        this.createInputs();
        this.bindEvents();
    };

    QtySelector.prototype.createInputs = function() {
        var $el = this.$el;

        var data = {
            value: $el.val(),
            key: $el.attr('id'),
            name: $el.attr('name'),
            line: $el.attr('data-line')
        };
        var source = $('#QuantityTemplate').html();
        var template = Handlebars.compile(source);

        this.$wrapper = $(template(data)).insertBefore($el);

        // Remove original number input
        $el.remove();
    };

    QtySelector.prototype.validateAvailability = function(line, quantity) {
        var product = theme.cartObject.items[line - 1]; // 0-based index in API
        var handle = product.handle; // needed for the ajax request
        var id = product.id; // needed to find right variant from ajax results

        var params = {
            type: 'GET',
            url: '/products/' + handle + '.js',
            dataType: 'json',
            success: $.proxy(function(cartProduct) {
                this.validateAvailabilityCallback(line, quantity, id, cartProduct);
            }, this)
        };

        $.ajax(params);
    };

    QtySelector.prototype.validateAvailabilityCallback = function(
        line,
        quantity,
        id,
        product
    ) {
        var quantityIsAvailable = true;

        // This returns all variants of a product.
        // Loop through them to get our desired one.
        for (var i = 0; i < product.variants.length; i++) {
            var variant = product.variants[i];
            if (variant.id === id) {
                break;
            }
        }

        // If the variant tracks inventory and does not sell when sold out
        // we can compare the requested with available quantity
        if (
            variant.inventory_management !== null &&
            variant.inventory_policy === 'deny'
        ) {
            if (variant.inventory_quantity < quantity) {

                // Set quantity to max amount available
                this.$wrapper.find('.js-qty__input').val(variant.inventory_quantity);

                quantityIsAvailable = false;
                this.$wrapper.removeClass(this.settings.loadingClass);
            }
        }

        if (quantityIsAvailable) {
            this.updateItemQuantity(line, quantity);
        }
    };

    QtySelector.prototype.validateQty = function(qty) {
        if (parseFloat(qty) === parseInt(qty, 10) && !isNaN(qty)) {
            // We have a valid number!
        } else {
            // Not a number. Default to 1.
            qty = 1;
        }
        return parseInt(qty, 10);
    };

    QtySelector.prototype.adjustQty = function(evt) {
        var $el = $(evt.currentTarget);
        var $input = $el.siblings('.js-qty__input');
        var qty = this.validateQty($input.val());
        var line = $input.attr('data-line');

        if ($el.hasClass('js-qty__adjust--minus')) {
            qty -= 1;
            if (qty <= this.settings.minQty) {
                qty = this.settings.minQty;
            }
        } else {
            qty += 1;
        }

        if (this.settings.isCartTemplate) {
            $el.parent().addClass(this.settings.loadingClass);
            this.updateCartItemPrice(line, qty);
        } else {
            $input.val(qty);
        }
    };

    QtySelector.prototype.bindEvents = function() {
        this.$wrapper
            .find('.js-qty__adjust')
            .on('click', $.proxy(this.adjustQty, this));

        // Select input text on click
        this.$wrapper.on('click', '.js-qty__input', function() {
            this.setSelectionRange(0, this.value.length);
        });

        // If the quantity changes on the cart template, update the price
        if (this.settings.isCartTemplate) {
            this.$wrapper.on(
                'change',
                '.js-qty__input',
                $.proxy(function(evt) {
                    var $input = $(evt.currentTarget);
                    var line = $input.attr('data-line');
                    var qty = this.validateQty($input.val());
                    $input.parent().addClass(this.settings.loadingClass);
                    this.updateCartItemPrice(line, qty);
                }, this)
            );
        }
    };

    QtySelector.prototype.updateCartItemPrice = function(line, qty) {
        // Update cart after short timeout so user doesn't create simultaneous ajax calls
        clearTimeout(this.qtyUpdateTimeout);
        this.qtyUpdateTimeout = setTimeout(
            $.proxy(function() {
                this.validateAvailability(line, qty);
            }, this),
            200
        );
    };

    QtySelector.prototype.updateItemQuantity = function(line, quantity) {
        var params = {
            type: 'POST',
            url: '/cart/change.js',
            data: 'quantity=' + quantity + '&line=' + line,
            dataType: 'json',
            success: $.proxy(function(cart) {
                this.updateCartItemCallback(cart);
            }, this)
        };

        $.ajax(params);
    };

    QtySelector.prototype.updateCartItemCallback = function(cart) {
        // Reload the page to show the empty cart if no items
        if (cart.item_count === 0) {
            location.reload();
            return;
        }

        // Update cart object
        theme.cartObject = cart;

        // Handlebars.js cart layout
        var data = {};
        var items = [];
        var item = {};
        var source = $('#CartProductTemplate').html();
        var template = Handlebars.compile(source);
        var prodImg;

        // Add each item to our handlebars.js data
        $.each(cart.items, function(index, cartItem) {
            /* Hack to get product image thumbnail
             *   - If image is not null
             *     - Remove file extension, add 240x240, and re-add extension
             *     - Create server relative link
             *   - A hard-coded url of no-image
             */

            if (cartItem.image === null) {
                prodImg =
                    '//cdn.shopify.com/s/assets/admin/no-image-medium-cc9732cb976dd349a0df1d39816fbcc7.gif';
            } else {
                prodImg = cartItem.image
                    .replace(/(\.[^.]*)$/, '_240x240$1')
                    .replace('http:', '');
            }

            if (cartItem.properties !== null) {
                $.each(cartItem.properties, function(key, value) {
                    if (key.charAt(0) === '_' || !value) {
                        delete cartItem.properties[key];
                    }
                });
            }

            // Create item's data object and add to 'items' array
            item = {
                key: cartItem.key,
                line: index + 1, // Shopify uses a 1+ index in the API
                url: cartItem.url,
                img: prodImg,
                name: cartItem.product_title,
                variation: cartItem.variant_title,
                properties: cartItem.properties,
                itemQty: cartItem.quantity,
                price: theme.Currency.formatMoney(cartItem.price, theme.moneyFormat),
                vendor: cartItem.vendor,
                linePrice: theme.Currency.formatMoney(
                    cartItem.line_price,
                    theme.moneyFormat
                ),
                originalLinePrice: theme.Currency.formatMoney(
                    cartItem.original_line_price,
                    theme.moneyFormat
                ),
                discounts: cartItem.discounts,
                discountsApplied: cartItem.line_price === cartItem.original_line_price ? false : true
            };

            items.push(item);
            theme.updateCurrencies();
        });

        // Gather all cart data and add to DOM
        data = {
            items: items
        };
        this.cache.$cartTemplate.empty().append(template(data));

        // Create new quantity selectors
        this.cache.$cartTable.find('input[type="number"]').each(function(i, el) {
            new QtySelector($(el));
        });

        // Update the cart subtotal
        this.cache.$subtotal.html(
            theme.Currency.formatMoney(cart.total_price, theme.moneyFormat)
        );

        // Update the cart total discounts
        if (cart.total_discount > 0) {
            this.cache.$discountTotal.html(
                theme.strings.totalCartDiscount.replace(
                    '[savings]',
                    theme.Currency.formatMoney(cart.total_discount, theme.moneyFormat)
                )
            );
        } else {
            this.cache.$discountTotal.empty();
        }

        theme.miniCart.updateElements();
        theme.updateCurrencies();
        // Set focus on cart table
        slate.a11y.pageLinkFocus(this.cache.$cartTable);
    };

    return QtySelector;
})();

/*
  Allow product to be added to cart via ajax with
  custom success and error responses.
*/
window.AjaxCart = (function() {
    var styleCart = $('.js-mini-cart').attr("data-cartmini");
    var cart = function($form) {
        this.cache = {
            $cartIconIndicator: $('.site-header__cart-indicator')
        };

        this.$form = $form;
        this.eventListeners();

        this.showNotice = false;
        if (this.$form.length) {
            this.showNotice = this.$form.hasClass('js-form--notice') ? true : false;
        }
    };

    cart.prototype.eventListeners = function() {
        if (this.$form.length) {
            this.$form.on('submit', $.proxy(this.addItemFromForm, this));
        }
    };

    cart.prototype.addItemFromForm = function(evt) {
        evt.preventDefault();

        var params = {
            type: 'POST',
            url: '/cart/add.js',
            data: this.$form.serialize(),
            dataType: 'json',
            success: $.proxy(function(lineItem) {
                //this.success(lineItem);
                window.location.href = '/cart';
            }, this),
            error: $.proxy(function(XMLHttpRequest, textStatus) {
                this.error(XMLHttpRequest, textStatus);
            }, this)
        };
        $.ajax(params);
    };

    cart.prototype.success = function(item) {
        theme.miniCart.updateElements();
        theme.miniCart.generateCart();
        if (styleCart != 'false') {
            if (this.showNotice) {
                var htmlVariant = item.variant_title !== null ? '<i>(' + item.variant_title + ')</i>' : '';
                var htmlAlert = '<div class="media mt-2 alert--cart"><a class="mr-3" href="/cart"><img class="lazyload" data-src="' + item.image + '"></a><div class="media-body align-self-center"><p class="m-0 font-weight-bold">' + item.product_title + ' x ' + item.quantity + '</p>' + htmlVariant + '<div><div>';
                theme.alert.new(theme.strings.addToCartSuccess, htmlAlert, 3000, 'notice');
            } else {
                theme.crosssell.showPopup(item);
            }
        }
    };

    // Error handling reference from Shopify.onError in api.jquery.js
    cart.prototype.error = function(XMLHttpRequest) {
        var data = JSON.parse(XMLHttpRequest.responseText);

        if (data.message) {
            theme.alert.new('', data.description, 3000, 'warning');
        }
    };

    return cart;
})();

/*================ TEMPLATES ================*/
theme.customerTemplates = (function() {
    function initEventListeners() {
        // Show reset password form
        $('#RecoverPassword').on('click', function(evt) {
            evt.preventDefault();
            toggleRecoverPasswordForm();
        });

        // Hide reset password form
        $('#HideRecoverPasswordLink').on('click', function(evt) {
            evt.preventDefault();
            toggleRecoverPasswordForm();
        });
    }

    /**
     *
     *  Show/Hide recover password form
     *
     */
    function toggleRecoverPasswordForm() {
        $('#RecoverPasswordForm').toggleClass('hide');
        $('#CustomerLoginForm').toggleClass('hide');
    }

    /**
     *
     *  Show reset password success message
     *
     */
    function resetPasswordSuccess() {
        // check if reset password form was successfully submited
        if (!$('.reset-password-success').length) {
            return;
        }

        // show success message
        $('#ResetSuccess').removeClass('hide');
    }

    /**
     *
     *  Show/hide customer address forms
     *
     */
    function customerAddressForm() {
        var $newAddressForm = $('#AddressNewForm');

        if (!$newAddressForm.length) {
            return;
        }

        // Initialize observers on address selectors, defined in shopify_common.js
        if (Shopify) {
            // eslint-disable-next-line no-new
            new Shopify.CountryProvinceSelector(
                'AddressCountryNew',
                'AddressProvinceNew', {
                    hideElement: 'AddressProvinceContainerNew'
                }
            );
        }

        // Initialize each edit form's country/province selector
        $('.address-country-option').each(function() {
            var formId = $(this).data('form-id');
            var countrySelector = 'AddressCountry_' + formId;
            var provinceSelector = 'AddressProvince_' + formId;
            var containerSelector = 'AddressProvinceContainer_' + formId;

            // eslint-disable-next-line no-new
            new Shopify.CountryProvinceSelector(countrySelector, provinceSelector, {
                hideElement: containerSelector
            });
        });

        // Toggle new/edit address forms
        $('.address-new-toggle').on('click', function() {
            $newAddressForm.toggleClass('hide');
        });

        $('.address-edit-toggle').on('click', function() {
            var formId = $(this).data('form-id');
            $('#EditAddress_' + formId).toggleClass('hide');
        });

        $('.address-delete').on('click', function() {
            var $el = $(this);
            var formId = $el.data('form-id');
            var confirmMessage = $el.data('confirm-message');

            // eslint-disable-next-line no-alert
            if (
                confirm(
                    confirmMessage || 'Are you sure you wish to delete this address?'
                )
            ) {
                Shopify.postLink('/account/addresses/' + formId, {
                    parameters: { _method: 'delete' }
                });
            }
        });
    }

    /**
     *
     *  Check URL for reset password hash
     *
     */
    function checkUrlHash() {
        var hash = window.location.hash;

        // Allow deep linking to recover password form
        if (hash === '#recover') {
            toggleRecoverPasswordForm();
        }
    }

    return {
        init: function() {
            checkUrlHash();
            initEventListeners();
            resetPasswordSuccess();
            customerAddressForm();
        }
    };
})();

/*================ SECTIONS ================*/
theme.HeaderSection = (function() {
    function Header() {
        theme.NavDrawer = new window.Drawers('NavDrawer', 'left');
    }

    return Header;
})();

theme.Product = (function() {
    var defaults = {
        smallBreakpoint: 750,
        productThumbIndex: 0,
        productThumbMax: 0,
        ajaxCart: false,
        stockSetting: false
    };

    function Product(container) {
        var $container = (this.$container = $(container));
        var sectionId = $container.attr('data-section-id');

        this.selectors = {
            originalSelectorId: '#ProductSelect-' + sectionId,
            modal: 'ProductModal',
            productZoomImage: '#ProductZoomImg',
            addToCart: '#AddToCart-' + sectionId,
            productPrice: '#ProductPrice-' + sectionId,
            comparePrice: '#ComparePrice-' + sectionId,
            addToCartText: '#AddToCartText-' + sectionId,
            SKU: '.js-variant-sku',
            productImageContainers: '.product__photo-container-' + sectionId,
            productImageWrappers: '.product__photo-wrapper-' + sectionId,
            productThumbContainers: '.product-single__thumbnail-item-' + sectionId,
            productThumbsWrapper: '.product-single__thumbnails-' + sectionId,
            productThumbs: '.product-single__thumbnail-' + sectionId,
            saleTag: '#ProductSaleTag-' + sectionId,
            productStock: '#ProductStock-' + sectionId,
            singleOptionSelector: '.single-option-selector-' + sectionId,
            shopifyPaymentButton: '.shopify-payment-button',
            availability: '.product-single__availability',
            hurrify: '.js-hurrify'
        };

        this.settings = $.extend({}, defaults, {
            sectionId: sectionId,
            ajaxCart: $container.data('ajax'),
            stockSetting: $container.data('stock'),
            enableHistoryState: $container.data('enable-history-state') || false,
            namespace: '.product-' + sectionId
        });

        // Stop parsing if we don't have the product json script tag
        if (!$('#ProductJson-' + sectionId).html()) {
            return;
        }

        this.productSingleObject = JSON.parse(
            $('#ProductJson-' + sectionId).html()
        );
        this.addVariantInfo();

        this.init();
    }

    Product.prototype = _.assignIn({}, Product.prototype, {
        init: function() {
            this._stringOverrides();
            this._initVariants();
            this._productZoomImage();
            this._productThumbSwitch();
            this._productThumbnailSlider();
            this._initQtySelector();

            if (this.settings.ajaxCart) {
                theme.AjaxCart = new window.AjaxCart(
                    $('#AddToCartForm-' + this.settings.sectionId)
                );
            }
        },

        _stringOverrides: function() {
            window.productStrings = window.productStrings || {};
            $.extend(theme.strings, window.productStrings);
        },

        addVariantInfo: function() {
            if (!this.productSingleObject || !this.settings.stockSetting) {
                return;
            }

            var variantInfo = JSON.parse(
                $('#VariantJson-' + this.settings.sectionId).html()
            );

            for (var i = 0; i < variantInfo.length; i++) {
                $.extend(this.productSingleObject.variants[i], variantInfo[i]);
            }
        },

        _initVariants: function() {
            var options = {
                $container: this.$container,
                enableHistoryState: this.settings.enableHistoryState,
                product: this.productSingleObject,
                singleOptionSelector: this.selectors.singleOptionSelector,
                originalSelectorId: this.selectors.originalSelectorId
            };

            // eslint-disable-next-line no-new
            this.variants = new slate.Variants(options);

            this.$container.on(
                'variantChange' + this.settings.namespace,
                this._updateAddToCartBtn.bind(this)
            );
            this.$container.on(
                'variantChange' + this.settings.namespace,
                this._updateStickyCart.bind(this)
            );
            this.$container.on(
                'variantPriceChange' + this.settings.namespace,
                this._updatePrice.bind(this)
            );
            this.$container.on(
                'variantSKUChange' + this.settings.namespace,
                this._updateSKU.bind(this)
            );
            this.$container.on(
                'variantImageChange' + this.settings.namespace,
                this._updateImages.bind(this)
            );
        },

        _updateStock: function(variant) {
            if (!this.settings.stockSetting) return;

            var $stock = $(this.selectors.productStock),
                $hurrify = $(this.selectors.hurrify);

            // If we don't track variant inventory, hide stock
            if (!variant || !variant.inventory_management) {
                $stock.addClass('hide');
                $hurrify.addClass('hide');
                return;
            }

            if (variant.inventory_quantity < 10 && variant.inventory_quantity > 0) {
                $stock
                    .html(
                        theme.strings.stockAvailable.replace(
                            '1',
                            variant.inventory_quantity
                        )
                    )
                    .removeClass('hide');
                $hurrify.removeClass('hide').find('.progress-bar').css('width', variant.inventory_quantity * 10 + '%');
                return;
            }

            if (variant.inventory_quantity <= 0 && variant.incoming) {
                $stock
                    .html(
                        theme.strings.willNotShipUntil.replace(
                            '[date]',
                            variant.next_incoming_date
                        )
                    )
                    .removeClass('hide');
                $hurrify.addClass('hide');
                return;
            }

            // If there's more than 10 available, hide stock
            $stock.addClass('hide');
            $hurrify.addClass('hide');
        },

        _updateIncomingInfo: function(variant) {
            if (!this.settings.stockSetting) return;

            var $stock = $(this.selectors.productStock);

            if (variant.incoming) {
                $stock
                    .html(
                        theme.strings.willBeInStockAfter.replace(
                            '[date]',
                            variant.next_incoming_date
                        )
                    )
                    .removeClass('hide');
                return;
            }

            // If there is no stock incoming, hide stock
            $stock.addClass('hide');
        },

        _updateAddToCartBtn: function(evt) {
            var variant = evt.variant;

            var cache = {
                $addToCart: $(this.selectors.addToCart),
                $addToCartText: $(this.selectors.addToCartText)
            };

            if (variant) {
                // Select a valid variant if available
                theme.noticeSoldout.init(variant);
                if (variant.available) {
                    // We have a valid product variant, so enable the submit button
                    cache.$addToCart.removeClass('btn--sold-out').prop('disabled', false);
                    cache.$addToCartText.html(theme.strings.addToCart);
                    $(this.selectors.shopifyPaymentButton, this.$container).show();
                    // Show how many items are left, if below 10
                    this._updateStock(variant);
                    //update availability - available
                    $(this.selectors.availability).find('span').text(theme.strings.available);
                } else {
                    // Variant is sold out, disable the submit button
                    cache.$addToCart.prop('disabled', true).addClass('btn--sold-out');
                    cache.$addToCartText.html(theme.strings.soldOut);
                    $(this.selectors.shopifyPaymentButton, this.$container).hide();
                    // Update when stock will be available
                    this._updateIncomingInfo(variant);
                    //update availability - soldout
                    $(this.selectors.availability).find('span').text(theme.strings.soldOut);
                }
            } else {
                cache.$addToCart.prop('disabled', true).removeClass('btn--sold-out');
                cache.$addToCartText.html(theme.strings.unavailable);
                //update availability - unavailable
                $(this.selectors.availability).find('span').text(theme.strings.unavailable);
                $(this.selectors.shopifyPaymentButton, this.$container).hide();
                // Hide stock display
                this._updateStock();
            }
        },

        _updatePrice: function(evt) {
            var variant = evt.variant;

            if (variant) {
                $(this.selectors.productPrice).html(
                    theme.Currency.formatMoney(variant.price, theme.moneyFormat)
                );

                // Update and show the product's compare price if necessary
                if (variant.compare_at_price > variant.price) {
                    $(this.selectors.comparePrice)
                        .html(
                            theme.Currency.formatMoney(
                                variant.compare_at_price,
                                theme.moneyFormat
                            )
                        )
                        .removeClass('hide');
                    $(this.selectors.saleTag).removeClass('hide');
                } else {
                    $(this.selectors.comparePrice).addClass('hide');
                    $(this.selectors.saleTag).addClass('hide');
                }

                theme.updateCurrencies();
            } else {
                $(this.selectors.comparePrice).addClass('hide');
            }
        },

        _updateSKU: function(evt) {
            var variant = evt.variant;

            if (variant) {
                $(this.selectors.SKU).html(variant.sku);
            }
        },

        _updateImages: function(evt) {
            var variant = evt.variant;

            if (variant && variant.featured_image) {
                var imageId = variant.featured_image.id;
                this.switchProductImage(imageId);
                this.setActiveThumbnail(imageId);
            }
        },
        _updateStickyCart: function(evt) {
            var variant = evt.variant,
                $stickyPrice = $('#js-sticky-price'),
                $stickyTitle = $('#js-sticky-title'),
                $stickyImage = $('#js-sticky-img'),
                $stickyButton = $('#js-sticky-btn');
            if (variant) {
                //update title
                $stickyTitle.html(' - ' + variant.title);
                //update price
                $stickyPrice.html(theme.Currency.formatMoney(variant.price, theme.moneyFormat));
                //update selectbox
                for (var i = 1; i <= 3; i++) {
                    var option = 'option' + i,
                        $selecBox = '#js-sticky-option-' + i;
                    if (variant[option] !== null) {
                        var valueOption = variant[option];
                        $($selecBox).val(valueOption);
                    }
                }
                //update button cart
                if (variant.available) {
                    $stickyButton.prop('disabled', false).removeClass('btn--sold-out');
                    $stickyButton.html(theme.strings.addToCart);
                } else {
                    $stickyButton.prop('disabled', true).addClass('btn--sold-out');
                    $stickyButton.html(theme.strings.soldOut);
                }
                //update image
                if (variant.featured_image) {
                    $stickyImage.attr('src', theme.Images.getSizedImageUrl(variant.featured_image.src, '200x'));
                }
            } else {
                //update title
                $stickyTitle.html(' - ' + theme.strings.unavailable);
                //update button cart
                $stickyButton.prop('disabled', true).removeClass('btn--sold-out');
                $stickyButton.html(theme.strings.unavailable);
            }
        },

        switchProductImage: function(imageId) {
            var $imageToShow = $(
                this.selectors.productImageContainers +
                "[data-image-id='" +
                imageId +
                "']",
                this.$container
            );
            var $imagesToHide = $(
                this.selectors.productImageContainers +
                ":not([data-image-id='" +
                imageId +
                "'])",
                this.$container
            );
            $imagesToHide.addClass('hide');
            $imageToShow.removeClass('hide');
            //Scroll to active
            topMenuHeight = $('.site-header').outerHeight();
            if (this.settings.sectionId === 'product-template-8') {
                $([document.documentElement, document.body]).animate({
                    scrollTop: $imageToShow.offset().top - topMenuHeight
                }, 500);
            }
        },

        setActiveThumbnail: function(imageId) {
            var $thumbnailToShow = $(
                this.selectors.productThumbContainers +
                "[data-image-id='" +
                imageId +
                "']",
                this.$container
            );
            var $thumbnailsToHide = $(
                this.selectors.productThumbContainers +
                ":not([data-image-id='" +
                imageId +
                "'])",
                this.$container
            );
            $thumbnailsToHide.removeClass('is-active');
            $thumbnailToShow.addClass('is-active');
            $thumbnailToShow.trigger('click');
            var $thumbnails = $(this.selectors.productThumbsWrapper, this.$container);

            // If there is a slick carousel, get the slide index, and position it into view with animation.
            if ($thumbnails.hasClass('slick-initialized')) {
                // eslint-disable-next-line shopify/jquery-dollar-sign-reference
                var currentActiveSlideIndex = $thumbnails.slick('slickCurrentSlide');
                var newActiveSlideIndex = parseInt(
                    $thumbnailToShow.attr('data-slick-index')
                );
                if (currentActiveSlideIndex !== newActiveSlideIndex) {
                    $thumbnails.slick('slickGoTo', newActiveSlideIndex, false);

                }
            }
        },

        _productZoomImage: function() {
            // The zoom image is only used on the product template, so return early
            // even if a featured product section is present.
            if (!$('.product-single ' + this.selectors.productImageContainers).length) {
                return;
            }

            var self = this;

            $(this.selectors.productImageWrappers).on(
                'click' + this.settings.namespace,
                function(evt) {
                    evt.preventDefault();
                    // Empty src before loadig new image to avoid awkward image swap
                    $(self.selectors.productZoomImage)
                        .attr('src', '')
                        .attr('src', $(this).attr('href'));
                }
            );

            this.ProductModal = new window.Modals(
                this.selectors.modal,
                'product-modal'
            );

            // Close modal if clicked, but not if the image is clicked
            this.ProductModal.$modal.on('click' + this.settings.namespace, function(
                evt
            ) {
                if (evt.target.nodeName !== 'IMG') {
                    self.ProductModal.close();
                }
            });
        },

        _productThumbSwitch: function() {
            if (!$(this.selectors.productThumbs).length) {
                return;
            }

            var self = this;

            $(this.selectors.productThumbs).on(
                'click' + this.settings.namespace,
                function(evt) {
                    evt.preventDefault();
                    var imageId = $(this)
                        .parent()
                        .data('image-id');
                    self.setActiveThumbnail(imageId);
                    self.switchProductImage(imageId);
                }
            );
            //trigger hover thumb
            // $(this.selectors.productThumbs).on('click',function(){
            //   $(this).trigger('click');
            // });
        },

        /*
          Thumbnail slider
         */
        _productThumbnailSlider: function() {
            var $productThumbsWrapper = $(this.selectors.productThumbsWrapper);
            var $productThumbs = $(this.selectors.productThumbs);
            if (!$productThumbs.length) {
                return;
            }

            if ($productThumbs.length > 1) {
                $productThumbsWrapper.on(
                    'init' + this.settings.namespace,
                    this._productSwipeInit.bind(this)
                );

                if (this.settings.sectionId === 'product-template-3' || this.settings.sectionId === 'product-template-4') {
                    $productThumbsWrapper.slick({
                        accessibility: false,
                        arrows: true,
                        dots: false,
                        infinite: false,
                        autoplay: false,
                        slidesToShow: 5,
                        slidesToScroll: 5,
                        vertical: true,
                        verticalSwiping: true,
                        responsive: [{
                            breakpoint: 992,
                            settings: {
                                vertical: false,
                                verticalSwiping: false,
                                slidesToShow: 4,
                                slidesToScroll: 4,
                                dots: false,
                            }
                        }]
                    }).css('opacity', '1');
                } else if (this.settings.sectionId === 'product-template-5') {
                    $productThumbsWrapper.slick({
                        accessibility: false,
                        arrows: true,
                        dots: false,
                        infinite: true,
                        autoplay: false,
                        slidesToShow: 2,
                        slidesToScroll: 1,
                        responsive: [{
                            breakpoint: 992,
                            settings: {
                                slidesToShow: 4,
                                slidesToScroll: 4,
                                dots: false,
                            }
                        }]
                    }).css('opacity', '1');
                } else if (this.settings.sectionId === 'product-template-7') {
                    $productThumbsWrapper.slick({
                        accessibility: false,
                        arrows: true,
                        dots: true,
                        infinite: true,
                        autoplay: false,
                        slidesToShow: 1,
                        slidesToScroll: 1,
                        responsive: [{
                            breakpoint: 992,
                            settings: {
                                slidesToShow: 1,
                                slidesToScroll: 1,
                                dots: false,
                                arrows: true,
                            }
                        }]
                    }).css('opacity', '1');
                } else if (this.settings.sectionId === 'product-template-8') {
                    var lastId,
                        topMenu = $(".product-single__thumbnails"),
                        topMenuHeight = $('.site-header').outerHeight() + 20,
                        // All list items
                        menuItems = topMenu.find(".product-single__thumbnail");


                    if ($(window).width() > 767) {
                        menuItems.click(function(e) {
                            var findid = $(this).attr('href');
                            offsetTop = $(findid).offset().top - topMenuHeight + 1;
                            $('html, body').stop().animate({
                                scrollTop: offsetTop
                            }, 200);
                            return false;
                        });
                        // Anchors corresponding to menu items
                        scrollItems = menuItems.map(function() {
                            var item = $($(this).attr('href'));
                            if (item.length) { return item; }
                        });

                        $(window).scroll(function() {
                            // Get container scroll position
                            var fromTop = $(this).scrollTop() + topMenuHeight;
                            // Get id of current scroll item
                            var cur = scrollItems.map(function() {
                                if ($(this).offset().top < fromTop)
                                    return this;
                            });
                            // Get the id of the current element
                            cur = cur[cur.length - 1];
                            var id = cur && cur.length ? cur[0].id : "";

                            if (lastId !== id) {
                                lastId = id;
                                // Set/remove active class
                                menuItems
                                    .parent().removeClass("is-active")
                                    .end().filter("[href='#" + id + "']").parent().addClass("is-active");
                            }
                        });
                    } else {
                        menuItems.click(function(e) {
                            var findid = $(this).attr('href');
                            offsetTop = $(findid).offset().top;
                            $('html, body').stop().animate({
                                scrollTop: offsetTop
                            });
                            return false;
                        });
                    }

                    $productThumbsWrapper.slick({
                        accessibility: false,
                        arrows: true,
                        dots: false,
                        infinite: false,
                        autoplay: false,
                        slidesToShow: 5,
                        slidesToScroll: 1,
                        vertical: true,
                        verticalSwiping: true,
                        responsive: [{
                            breakpoint: 992,
                            settings: {
                                vertical: false,
                                verticalSwiping: false,
                                slidesToShow: 4,
                                slidesToScroll: 4,
                                dots: true,
                            }
                        }]
                    }).css('opacity', '1');
                } else {
                    $productThumbsWrapper.slick({
                        accessibility: false,
                        arrows: true,
                        dots: false,
                        infinite: false,
                        autoplay: false,
                        slidesToShow: 4,
                        slidesToScroll: 4
                    }).css('opacity', '1');
                }

                // Show highlighted thumbnail by repositioning slider
                $productThumbsWrapper.slick(
                    'slickGoTo',
                    $productThumbsWrapper.find('.is-active').attr('data-slick-index'),
                    true
                );
            }
        },

        _productSwipeInit: function(evt, obj) {
            // Slider is initialized. Setup custom swipe events
            this.settings.productThumbIndex = obj.currentSlide;
            this.settings.productThumbMax = obj.slideCount - 1; // we need the 0-based index

            var self = this;

            $(this.selectors.productImageWrappers).on(
                'swipeleft swiperight',
                function(event) {
                    if (event.type === 'swipeleft') {
                        self._goToNextThumbnail();
                    }

                    if (event.type === 'swiperight') {
                        self._goToPrevThumbnail();
                    }

                    // Trigger click on newly requested thumbnail
                    $(
                            '.product-single__thumbnail-item[data-slick-index="' +
                            self.settings.productThumbIndex +
                            '"]'
                        )
                        .find('.product-single__thumbnail')
                        .trigger('click');

                }
            );
        },
        _goToNextThumbnail: function() {
            this.settings.productThumbIndex++;

            if (this.settings.productThumbIndex > this.settings.productThumbMax) {
                this.settings.productThumbIndex = 0;
            }

            $(this.selectors.productThumbsWrapper).slick(
                'slickGoTo',
                this.settings.productThumbIndex,
                true
            );
        },

        _goToPrevThumbnail: function() {
            this.settings.productThumbIndex--;

            if (this.settings.productThumbIndex < 0) {
                this.settings.productThumbIndex = this.settings.productThumbMax;
            }

            $(this.selectors.productThumbsWrapper).slick(
                'slickGoTo',
                this.settings.productThumbIndex,
                true
            );
        },

        _initQtySelector: function() {
            this.$container.find('.product-form__quantity').each(function(i, el) {
                // eslint-disable-next-line no-new
                new QtySelector($(el));
            });
        },

        onUnload: function() {
            $(this.selectors.productImageWrappers).off(this.settings.namespace);
            $(this.selectors.productThumbs).off(this.settings.namespace);
            $(this.selectors.productThumbs).slick('unslick');
            if (this.ProductModal) {
                this.ProductModal.$modal.off(this.settings.namespace);
            }
        }
    });

    return Product;
})();

theme.Slideshow = (function() {
    this.$slideshow = null;
    var classes = {
        slideshow: 'slideshow',
        slickActiveMobile: 'slick-active-mobile',
        controlsHover: 'slideshow__controls--hover',
        isPaused: 'is-paused'
    };

    var selectors = {
        section: '.shopify-section',
        wrapper: '#SlideshowWrapper-',
        slides: '.slideshow__slide',
        textWrapperMobile: '.slideshow__text-wrap--mobile',
        textContentMobile: '.slideshow__text-content--mobile',
        controls: '.slideshow__controls',
        dots: '.slick-dots',
        arrowLeft: '.slideshow__arrow-left',
        arrowRight: '.slideshow__arrow-right'
    };

    function slideshow(el, sectionId) {
        var $slideshow = (this.$slideshow = $(el));
        this.adaptHeight = this.$slideshow.data('adapt-height');
        this.$wrapper = this.$slideshow.closest(selectors.wrapper + sectionId);
        this.$section = this.$wrapper.closest(selectors.section);
        this.$controls = this.$wrapper.find(selectors.controls);
        this.$textWrapperMobile = this.$section.find(selectors.textWrapperMobile);
        this.autorotate = this.$slideshow.data('autorotate');
        var autoplaySpeed = this.$slideshow.data('speed');
        var loadSlideA11yString = this.$slideshow.data('slide-nav-a11y');

        this.settings = {
            rtl: theme.rtl,
            accessibility: true,
            arrows: true,
            dots: true,
            fade: (theme.rtl ? false : true),
            draggable: true,
            touchThreshold: 20,
            autoplay: this.autorotate,
            autoplaySpeed: autoplaySpeed
        };

        this.$slideshow.on('beforeChange', beforeChange.bind(this));
        this.$slideshow.on('init', slideshowA11ySetup.bind(this));

        // Add class to style mobile dots & show the correct text content for the
        // first slide on mobile when the slideshow initialises
        this.$slideshow.on(
            'init',
            function() {
                this.$mobileDots
                    .find('li:first-of-type')
                    .addClass(classes.slickActiveMobile);
                this.showMobileText(0);
            }.bind(this)
        );

        if (this.adaptHeight) {
            this.setSlideshowHeight();
            $(window).resize($.debounce(50, this.setSlideshowHeight.bind(this)));
        }

        this.$slideshow.slick(this.settings);

        // This can't be called when the slick 'init' event fires due to how slick
        // adds a11y features.
        slideshowPostInitA11ySetup.bind(this)();
    }

    function slideshowA11ySetup(event, obj) {
        var $slider = obj.$slider;
        var $list = obj.$list;
        this.$dots = this.$section.find(selectors.dots);
        this.$mobileDots = this.$dots.eq(1);

        // Remove default Slick aria-live attr until slider is focused
        $list.removeAttr('aria-live');

        //     this.$wrapper.on('keyup', keyboardNavigation.bind(this));
        //     this.$controls.on('keyup', keyboardNavigation.bind(this));
        //     this.$textWrapperMobile.on('keyup', keyboardNavigation.bind(this));

        // When an element in the slider is focused
        // pause slideshow and set aria-live.
        this.$wrapper
            .on(
                'focusin',
                function(evt) {
                    if (!this.$wrapper.has(evt.target).length) {
                        return;
                    }

                    $list.attr('aria-live', 'polite');
                    if (this.autorotate) {
                        $slider.slick('slickPause');
                    }
                }.bind(this)
            )
            .on(
                'focusout',
                function(evt) {
                    if (!this.$wrapper.has(evt.target).length) {
                        return;
                    }

                    $list.removeAttr('aria-live');
                }.bind(this)
            );

        // Add arrow key support when focused
        if (this.$dots) {
            this.$dots
                .find('a')
                .each(function() {
                    var $dot = $(this);
                    $dot.on('click keyup', function(evt) {
                        if (
                            evt.type === 'keyup' &&
                            evt.which !== slate.utils.keyboardKeys.ENTER
                        )
                            return;

                        evt.preventDefault();

                        var slideNumber = $(evt.target).data('slide-number');

                        $slider.attr('tabindex', -1).slick('slickGoTo', slideNumber);

                        if (evt.type === 'keyup') {
                            $slider.focus();
                        }
                    });
                })
                .eq(0)
                .attr('aria-current', 'true');
        }

        this.$controls
            .on('focusin', highlightControls.bind(this))
            .on('focusout', unhighlightControls.bind(this));
    }

    function slideshowPostInitA11ySetup() {
        var $slides = this.$slideshow.find(selectors.slides);

        $slides.removeAttr('role').removeAttr('aria-labelledby');
        this.$dots
            .removeAttr('role')
            .find('li')
            .removeAttr('role')
            .removeAttr('aria-selected')
            .each(function() {
                var $dot = $(this);
                var ariaControls = $dot.attr('aria-controls');
                $dot
                    .removeAttr('aria-controls')
                    .find('a')
                    .attr('aria-controls', ariaControls);
            });
    }

    function beforeChange(event, slick, currentSlide, nextSlide) {
        var $dotLinks = this.$dots.find('a');
        var $mobileDotLinks = this.$mobileDots.find('li');

        $dotLinks
            .removeAttr('aria-current')
            .eq(nextSlide)
            .attr('aria-current', 'true');

        $mobileDotLinks
            .removeClass(classes.slickActiveMobile)
            .eq(nextSlide)
            .addClass(classes.slickActiveMobile);
        this.showMobileText(nextSlide);
    }

    //   function keyboardNavigation() {
    //     if (event.keyCode === slate.utils.keyboardKeys.LEFTARROW) {
    //       this.$slideshow.slick('slickPrev');
    //     }
    //     if (event.keyCode === slate.utils.keyboardKeys.RIGHTARROW) {
    //       this.$slideshow.slick('slickNext');
    //     }
    //   }

    function highlightControls() {
        this.$controls.addClass(classes.controlsHover);
    }

    function unhighlightControls() {
        this.$controls.removeClass(classes.controlsHover);
    }

    slideshow.prototype.setSlideshowHeight = function() {
        var minAspectRatio = this.$slideshow.data('min-aspect-ratio');
        this.$slideshow.height($(document).width() / minAspectRatio);
    };

    slideshow.prototype.showMobileText = function(slideIndex) {
        var $allTextContent = this.$textWrapperMobile.find(
            selectors.textContentMobile
        );
        var currentTextContentSelector =
            selectors.textContentMobile + '-' + slideIndex;
        var $currentTextContent = this.$textWrapperMobile.find(
            currentTextContentSelector
        );
        if (!$currentTextContent.length &&
            this.$slideshow.find(selectors.slides).length === 1
        ) {
            this.$textWrapperMobile.hide();
        } else {
            this.$textWrapperMobile.show();
        }
        $allTextContent.hide();
        $currentTextContent.show();
    };

    function getSlideshowId($el) {
        return '#Slideshow-' + $el.data('id');
    }

    return slideshow;
})();

theme.slideshows = {};

theme.SlideshowSection = (function() {
    function SlideshowSection(container) {
        var $container = (this.$container = $(container));
        var sectionId = $container.attr('data-section-id');
        var slideshow = (this.slideshow = '#Slideshow-' + sectionId);

        theme.slideshows[slideshow] = new theme.Slideshow(slideshow, sectionId);
    }

    return SlideshowSection;
})();

theme.SlideshowSection.prototype = _.assignIn({},
    theme.SlideshowSection.prototype, {
        onUnload: function() {
            delete theme.slideshows[this.slideshow];
        },

        onBlockSelect: function(evt) {
            var $slideshow = $(this.slideshow);
            var adaptHeight = $slideshow.data('adapt-height');

            if (adaptHeight) {
                theme.slideshows[this.slideshow].setSlideshowHeight();
            }

            // Ignore the cloned version
            var $slide = $(
                '.slideshow__slide--' + evt.detail.blockId + ':not(.slick-cloned)'
            );
            var slideIndex = $slide.data('slick-index');

            // Go to selected slide, pause auto-rotate
            $slideshow.slick('slickGoTo', slideIndex).slick('slickPause');
        },

        onBlockDeselect: function() {
            // Resume auto-rotate
            $(this.slideshow).slick('slickPlay');
        }
    }
);

theme.slideshows = {};

theme.Cart = (function() {
    var selectors = {
        cartNote: '#CartSpecialInstructions',
        cartQtyInput: '.cart__quantity',
        cartNoCookiesClass: 'cart--no-cookies'
    };

    function Cart(container) {
        var $container = (this.$container = $(container));
        var sectionId = $container.attr('data-section-id');

        theme.cartObject = JSON.parse($('#CartJson-' + sectionId).html());

        this.init($container);
    }

    Cart.prototype = _.assignIn({}, Cart.prototype, {
        init: function($container) {
            this._initQtySelector();
            this._initCartNote();

            if (!this._cookiesEnabled()) {
                $container.addClass(selectors.cartNoCookiesClass);
            }
        },

        _initQtySelector: function() {
            $(selectors.cartQtyInput).each(function(i, el) {
                // eslint-disable-next-line no-new
                new QtySelector($(el));
            });
        },

        _initCartNote: function() {
            if (!$(selectors.cartNote).length) {
                return;
            }

            var $el = $(selectors.cartNote);
            var noteText;
            var params;
            var noteOffset = $el[0].offsetHeight - $el[0].clientHeight;

            // Auto grow the cart note if text fills it up
            $el.on('keyup input', function() {
                $(this)
                    .css('height', 'auto')
                    .css('height', $el[0].scrollHeight + noteOffset);
            });

            // Save the cart note via ajax. A safeguard in case
            // a user decides to leave the page before clicking 'Update Cart'
            $el.on(
                'change',
                $.proxy(function() {
                    noteText = $el.val();
                    params = {
                        type: 'POST',
                        url: '/cart/update.js',
                        data: 'note=' + this._attributeToString(noteText),
                        dataType: 'json'
                    };
                    $.ajax(params);
                }, this)
            );
        },

        _attributeToString: function(attr) {
            if (typeof attr !== 'string') {
                attr = String(attr);
                if (attr === 'undefined') {
                    attr = '';
                }
            }
            return $.trim(attr);
        },

        _cookiesEnabled: function() {
            var cookieEnabled = navigator.cookieEnabled;

            if (!cookieEnabled) {
                document.cookie = 'testcookie';
                cookieEnabled = document.cookie.indexOf('testcookie') !== -1;
            }
            return cookieEnabled;
        }
    });

    return Cart;
})();

// Instagrams
theme.Instagrams = (function() {
    function Instagrams(container) {
        this.$container = $(container).on('init', this._a11y.bind(this));
        //console.log(this.$container);
        this.settings = {
            style: this.$container.data('style'),
            accesstoken: this.$container.data('accesstoken'),
            userid: this.$container.data('userid'),
            limit: this.$container.data('limit'),
            resolution: this.$container.data('resolution'),
            target: this.$container.attr('id'),
            rows: this.$container.data('rows'),

            slidesToShow: this.$container.data('slidestoshow') || 1,
            infinite: this.$container.data('infinite') || false,
            arrows: this.$container.data('arrows') || false,
            draggable: this.$container.data('draggable') || false,
            dots: this.$container.data('dots') || false,
        }
        this.settings.slidesToShow1200 = (this.settings.slidesToShow - 1) > 1 ? (this.settings.slidesToShow - 1) : 1;
        this.settings.slidesToShow992 = (this.settings.slidesToShow - 2) > 1 ? (this.settings.slidesToShow - 2) : 1;
        this.settings.slidesToShow768 = (this.settings.slidesToShow - 3) > 1 ? (this.settings.slidesToShow - 3) : 1;
        this.settings.slidesToShow480 = 2;

        var _self = this;
        var $instagramSelector = $('#' + this.settings.target);
        if (this.settings.style === 'grid') {
            var afterInstagram = function() {} // blank function
        } else if (this.settings.style === 'carousel') {
            var afterInstagram = function() {
                $instagramSelector.slick({
                    slidesToShow: _self.settings.slidesToShow,
                    slidesToScroll: _self.settings.slidesToShow,
                    arrows: _self.settings.arrows,
                    dots: _self.settings.dots,
                    draggable: _self.settings.draggable,
                    infinite: _self.settings.infinite,
                    rows: _self.settings.rows,
                    responsive: [{
                            breakpoint: 1200,
                            settings: {
                                slidesToShow: _self.settings.slidesToShow1200,
                                slidesToScroll: _self.settings.slidesToShow1200,
                            }
                        },
                        {
                            breakpoint: 992,
                            settings: {
                                slidesToShow: _self.settings.slidesToShow992,
                                slidesToScroll: _self.settings.slidesToShow992,
                            }
                        },
                        {
                            breakpoint: 768,
                            settings: {
                                slidesToShow: _self.settings.slidesToShow768,
                                slidesToScroll: _self.settings.slidesToShow768,
                            }
                        },
                        {
                            breakpoint: 480,
                            settings: {
                                slidesToShow: _self.settings.slidesToShow480,
                                slidesToScroll: _self.settings.slidesToShow480,
                            }
                        }
                    ]
                })
            }
        }

        var feed = new Instafeed({
            get: 'user',
            target: this.settings.target,
            userId: this.settings.userid,
            accessToken: this.settings.accesstoken,
            limit: this.settings.limit,
            resolution: this.settings.resolution,
            template: '<div class="col hv-image-brightness"><a class="instagram-item" href="{{link}}" target="_blank" id="{{id}}"><img alt="instagram image" class="transition lazyload" data-src="{{image}}" /></a></div>',
            after: afterInstagram
        });

        feed.run();
    }

    Instagrams.prototype = _.assignIn({}, Instagrams.prototype, {
        _a11y: function(event, obj) {
            var $list = obj.$list;
            var $wrapper = this.$container.parent();

            // Remove default Slick aria-live attr until slider is focused
            $list.removeAttr('aria-live');

            // When an element in the slider is focused set aria-live
            $wrapper.on('focusin', function(evt) {
                if ($wrapper.has(evt.target).length) {
                    $list.attr('aria-live', 'polite');
                }
            });

            // Remove aria-live
            $wrapper.on('focusout', function(evt) {
                if ($wrapper.has(evt.target).length) {
                    $list.removeAttr('aria-live');
                }
            });
        }
    });

    return Instagrams;
})();

// Slick carousel
theme.slickCarousel = (function() {
    function Carousels(container) {
        this.$container = $(container).on('init', this._a11y.bind(this));
        this.settings = {
            rows: this.$container.data('rows') || 1,
            slidesToShow: this.$container.data('slidestoshow') || 1,
            slidesToScroll: this.$container.data('slidestoscroll') || 1,
            infinite: this.$container.data('infinite') || false,
            arrows: this.$container.data('arrows') || false,
            dots: this.$container.data('dots') || false,
            autoplay: this.$container.data('autoplay') || false,
            draggable: this.$container.data('draggable') || false,
            accessibility: this.$container.data('accessibility') || true,
        }
        this.settings.slidesToShow1200 = (this.settings.slidesToShow - 1) > 1 ? (this.settings.slidesToShow - 1) : 1;
        this.settings.slidesToShow992 = (this.settings.slidesToShow - 2) > 1 ? (this.settings.slidesToShow - 2) : 1;
        this.settings.slidesToShow768 = (this.settings.slidesToShow - 3) > 1 ? (this.settings.slidesToShow - 3) : 1;
        this.settings.slidesToShow480 = (this.settings.slidesToShow - 4) > 1 ? (this.settings.slidesToShow - 4) : 1;
        this.settings.slidesToScroll1200 = (this.settings.slidesToScroll - 1) > 1 ? (this.settings.slidesToScroll - 1) : 1;
        this.settings.slidesToScroll992 = (this.settings.slidesToScroll - 2) > 1 ? (this.settings.slidesToScroll - 2) : 1;
        this.settings.slidesToScroll768 = (this.settings.slidesToScroll - 3) > 1 ? (this.settings.slidesToScroll - 3) : 1;
        this.settings.slidesToScroll480 = (this.settings.slidesToScroll - 4) > 1 ? (this.settings.slidesToScroll - 4) : 1;
        this.$container.slick({
            rtl: theme.rtl,
            rows: this.settings.rows,
            slidesToShow: this.settings.slidesToShow,
            slidesToScroll: this.settings.slidesToScroll,
            arrows: this.settings.arrows,
            dots: this.settings.dots,
            autoplay: this.settings.autoplay,
            accessibility: this.settings.accessibility,
            draggable: this.settings.draggable,
            infinite: this.settings.infinite,
            adaptiveHeight: true,
            responsive: [{
                    breakpoint: 1200,
                    settings: {
                        slidesToShow: this.settings.slidesToShow1200,
                        slidesToScroll: this.settings.slidesToScroll1200
                    }
                },
                {
                    breakpoint: 992,
                    settings: {
                        slidesToShow: this.settings.slidesToShow992,
                        slidesToScroll: this.settings.slidesToScroll992
                    }
                },
                {
                    breakpoint: 768,
                    settings: {
                        slidesToShow: this.settings.slidesToShow768,
                        slidesToScroll: this.settings.slidesToScroll768
                    }
                },
                {
                    breakpoint: 480,
                    settings: {
                        slidesToShow: 1,
                        slidesToScroll: this.settings.slidesToScroll480
                    }
                }
            ]
        })
    }

    Carousels.prototype = _.assignIn({}, Carousels.prototype, {
        _a11y: function(event, obj) {
            var $list = obj.$list;
            var $wrapper = this.$container.parent();

            // Remove default Slick aria-live attr until slider is focused
            $list.removeAttr('aria-live');

            // When an element in the slider is focused set aria-live
            $wrapper.on('focusin', function(evt) {
                if ($wrapper.has(evt.target).length) {
                    $list.attr('aria-live', 'polite');
                }
            });

            // Remove aria-live
            $wrapper.on('focusout', function(evt) {
                if ($wrapper.has(evt.target).length) {
                    $list.removeAttr('aria-live');
                }
            });
        },

        _goToSlide: function(slideIndex) {
            this.$container.slick('slickGoTo', slideIndex);
        },

        onUnload: function() {
            delete this.$container;
        },

        onBlockSelect: function(evt) {
            // Ignore the cloned version
            var $slide = $(
                '.carousel__slide-wrapper--' + evt.detail.blockId + ':not(.slick-cloned)'
            );
            var slideIndex = $slide.data('slick-index');

            // Go to selected slide, pause autoplay
            this._goToSlide(slideIndex);

        }
    });

    return Carousels;
})()

// Productlists
theme.Productlists = (function() {
    function Productlists(container) {
        this.$container = $(container).on('init', this._a11y.bind(this));
        this.settings = {
            slidesToShow: this.$container.data('slidestoshow') || 1,
            rows: this.$container.data('rows') || 1,
            arrows: this.$container.data('arrows') || false,
            dots: this.$container.data('dots') || false,
            draggable: this.$container.data('draggable') || false,
            infinite: this.$container.data('infinite') || false,
        }
        this.settings.slidesToShow1200 = (this.settings.slidesToShow - 1) > 1 ? (this.settings.slidesToShow - 1) : 1;
        this.settings.slidesToShow992 = (this.settings.slidesToShow - 2) > 1 ? (this.settings.slidesToShow - 2) : 1;
        this.settings.slidesToShow768 = (this.settings.slidesToShow - 3) > 1 ? (this.settings.slidesToShow - 3) : 1;
        this.settings.slidesToShow480 = 2;
        this.$container.slick({
            rtl: theme.rtl,
            accessibility: true,
            slidesToShow: this.settings.slidesToShow,
            slidesToScroll: this.settings.slidesToShow,
            rows: this.settings.rows,
            arrows: this.settings.arrows,
            dots: this.settings.dots,
            infinite: this.settings.infinite,
            draggable: this.settings.draggable,
            responsive: [{
                    breakpoint: 1200,
                    settings: {
                        slidesToShow: this.settings.slidesToShow1200,
                        slidesToScroll: this.settings.slidesToShow1200
                    }
                },
                {
                    breakpoint: 992,
                    settings: {
                        slidesToShow: this.settings.slidesToShow992,
                        slidesToScroll: this.settings.slidesToShow992
                    }
                },
                {
                    breakpoint: 768,
                    settings: {
                        slidesToShow: this.settings.slidesToShow768,
                        slidesToScroll: this.settings.slidesToShow768
                    }
                },
                {
                    breakpoint: 480,
                    settings: {
                        slidesToShow: this.settings.slidesToShow480,
                        slidesToScroll: this.settings.slidesToShow480
                    }
                }
            ]
        }).css('opacity', '1');
    }

    Productlists.prototype = _.assignIn({}, Productlists.prototype, {
        _a11y: function(event, obj) {
            var $list = obj.$list;
            var $wrapper = this.$container.parent();

            // Remove default Slick aria-live attr until slider is focused
            $list.removeAttr('aria-live');

            // When an element in the slider is focused set aria-live
            $wrapper.on('focusin', function(evt) {
                if ($wrapper.has(evt.target).length) {
                    $list.attr('aria-live', 'polite');
                }
            });

            // Remove aria-live
            $wrapper.on('focusout', function(evt) {
                if ($wrapper.has(evt.target).length) {
                    $list.removeAttr('aria-live');
                }
            });
        },

        _goToSlide: function(slideIndex) {
            this.$container.slick('slickGoTo', slideIndex);
        },

        onUnload: function() {
            delete this.$container;
        }
    });

    return Productlists;
})();

// Producttabs
theme.Producttabs = (function() {
    function Producttabs(container) {
        var _self = this; // avoid conflict
        this.$container = $(container).on('init', this._a11y.bind(this));
        this.slickWrap = '.prdtab-content';
        this.settings = {
            slidesToShow: this.$container.data('slidestoshow') || 1,
            arrows: this.$container.data('arrows') || false,
            rows: this.$container.data('rows') || 1,
            dots: this.$container.data('dots') || false,
            draggable: this.$container.data('draggable') || false,
            infinite: this.$container.data('infinite') || false,
        }
        this.settings.slidesToShow1200 = (this.settings.slidesToShow - 1) > 1 ? (this.settings.slidesToShow - 1) : 1;
        this.settings.slidesToShow992 = (this.settings.slidesToShow - 2) > 1 ? (this.settings.slidesToShow - 2) : 1;
        this.settings.slidesToShow768 = (this.settings.slidesToShow - 3) > 1 ? (this.settings.slidesToShow - 3) : 1;
        this.settings.slidesToShow480 = 2;

        this._initSlick();
        this.$container.find('a[data-toggle="tab"]').on("shown.bs.tab", function(e) {
            _self._unSlick();
            _self._initSlick();
            theme.tooltip.load();
        })
    }

    Producttabs.prototype = _.assignIn({}, Producttabs.prototype, {
        _a11y: function(event, obj) {
            var $list = obj.$list;
            var $wrapper = this.$container.parent();

            // Remove default Slick aria-live attr until slider is focused
            $list.removeAttr('aria-live');

            // When an element in the slider is focused set aria-live
            $wrapper.on('focusin', function(evt) {
                if ($wrapper.has(evt.target).length) {
                    $list.attr('aria-live', 'polite');
                }
            });

            // Remove aria-live
            $wrapper.on('focusout', function(evt) {
                if ($wrapper.has(evt.target).length) {
                    $list.removeAttr('aria-live');
                }
            });
        },

        _getSliderSettings: function() {
            return {
                rtl: theme.rtl,
                accessibility: true,
                slidesToShow: this.settings.slidesToShow,
                slidesToScroll: this.settings.slidesToShow,
                arrows: this.settings.arrows,
                rows: this.settings.rows,
                dots: this.settings.dots,
                infinite: this.settings.infinite,
                draggable: this.settings.draggable,
                responsive: [{
                        breakpoint: 1200,
                        settings: {
                            slidesToShow: this.settings.slidesToShow1200,
                            slidesToScroll: this.settings.slidesToShow1200
                        }
                    },
                    {
                        breakpoint: 992,
                        settings: {
                            slidesToShow: this.settings.slidesToShow992,
                            slidesToScroll: this.settings.slidesToShow992
                        }
                    },
                    {
                        breakpoint: 768,
                        settings: {
                            slidesToShow: this.settings.slidesToShow768,
                            slidesToScroll: this.settings.slidesToShow768
                        }
                    },
                    {
                        breakpoint: 480,
                        settings: {
                            slidesToShow: this.settings.slidesToShow480,
                            slidesToScroll: this.settings.slidesToShow480
                        }
                    }
                ]
            }
        },

        _initSlick: function() {
            this.$container.find(this.slickWrap).slick(this._getSliderSettings()).css('opacity', '1');
        },

        _unSlick: function() {
            this.$container.find(this.slickWrap).slick('unslick');
        },

        onUnload: function() {
            delete this.$container;
        },

        onSelect: function() {
            this._unSlick();
            this._initSlick();
        },

        onBlockSelect: function(evt) {
            var navItem = $('.nav-link-' + evt.detail.blockId);
            navItem.tab('show');
            this._unSlick();
            this._initSlick();
        }
    });

    return Producttabs;
})();

theme.Video = (function() {
    var promiseYoutubeAPI;
    var promiseVimeoAPI;

    var youtube = {
        promiseAPI: function() {
            if (!promiseYoutubeAPI) {
                var tag = document.createElement('script');

                tag.src = 'https://www.youtube.com/iframe_api';
                var firstScriptTag = document.getElementsByTagName('script')[0];
                firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

                promiseYoutubeAPI = $.Deferred(function(defer) {
                    window.onYouTubeIframeAPIReady = defer.resolve;

                    setTimeout(function() {
                        defer.reject('Request for YouTube API timed out after 30 seconds.');
                    }, 30000);
                });
            }

            return promiseYoutubeAPI;
        },
        promisePlayer: function(id, options) {
            return this.promiseAPI().then(function() {
                return $.Deferred(function(defer) {
                    if (typeof window.YT === 'undefined') {
                        defer.reject(
                            "We're sorry, something went wrong. The YouTube API has not loaded correctly."
                        );
                    }

                    /* eslint-disable no-undef */
                    var player = new YT.Player(id, options); // global YT variable injected by YouTube API

                    player.addEventListener('onReady', function() {
                        defer.resolve(player);
                    });

                    setTimeout(function() {
                        defer.reject(
                            'Request for YouTube player has timed out after 30 seconds.'
                        );
                    }, 30000);
                });
            });
        }
    };

    var vimeo = {
        promiseAPI: function() {
            if (!promiseVimeoAPI) {
                promiseVimeoAPI = $.Deferred(function(defer) {
                    var tag = document.createElement('script');
                    tag.src = 'https://player.vimeo.com/api/player.js';
                    tag.onload = tag.onreadystatechange = function() {
                        if (!this.readyState || this.readyState === 'complete') {
                            defer.resolve();
                        }
                    };

                    var firstScriptTag = document.getElementsByTagName('script')[0];
                    firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

                    setTimeout(function() {
                        defer.reject('Request for Vimeo API timed out after 30 seconds.');
                    }, 30000);
                });
            }

            return promiseVimeoAPI;
        },

        promisePlayer: function(id, options) {
            return this.promiseAPI().then(function() {
                return $.Deferred(function(defer) {
                    if (typeof window.Vimeo === 'undefined') {
                        defer.reject(
                            "We're sorry, something went wrong. The Vimeo API has not loaded correctly."
                        );
                    }

                    var player = new window.Vimeo.Player(id, options);

                    setTimeout(function() {
                        defer.reject(
                            'Request for Vimeo player has timed out after 30 seconds.'
                        );
                    }, 30000);

                    player.ready().then(function() {
                        defer.resolve(player);
                    });
                });
            });
        }
    };

    var selectors = {
        loadPlayerButton: '.video-section__load-player-button',
        closePlayerButton: '.video-section__player-close',
        playerContainer: '.video-section__player',
        cover: '.video-section__cover',
        errorMessage: '.video-section__error',
        bodyOverlay: '.video-section__body-overlay',
        body: 'body'
    };
    var classes = {
        playerLoading: 'video-section--loading',
        playerLoaded: 'video-section--loaded',
        playerError: 'video-section--error',
        videoPlaying: 'video-playing'
    };

    function Video(container) {
        this.$container = $(container);
        var sectionId = this.$container.attr('data-section-id');
        this.namespace = '.' + sectionId;
        this.onLoad();
    }

    Video.prototype = _.assignIn({}, Video.prototype, {
        onLoad: function() {
            this.$container
                .on('click', selectors.loadPlayerButton, this._loadPlayer.bind(this))
                .on('click', selectors.closePlayerButton, this._closePlayer.bind(this))
                .on('click', selectors.bodyOverlay, this._closePlayer.bind(this));
        },

        _loadPlayer: function() {
            var $container = this.$container;
            var $playerContainer = $(selectors.playerContainer, $container);
            var playerType = this.$container.attr('data-video-type');

            var promiseVideoPlayer;

            if (playerType === 'youtube') {
                promiseVideoPlayer = this._loadYoutubePlayer($playerContainer[0]);
            } else if (playerType === 'vimeo') {
                promiseVideoPlayer = this._loadVimeoPlayer($playerContainer[0]);
            }

            return promiseVideoPlayer
                .then(this._onPlayerLoadReady.bind(this))
                .fail(this._onPlayerLoadError.bind(this));
        },

        _loadYoutubePlayer: function(container) {
            return youtube
                .promisePlayer(container, {
                    videoId: this.$container.attr('data-video-id'),
                    ratio: 16 / 9,
                    playerVars: {
                        modestbranding: 1,
                        autoplay: 1,
                        showinfo: 0,
                        rel: 0
                    }
                })
                .then(
                    function(player) {
                        this.player = player;
                    }.bind(this)
                );
        },

        _loadVimeoPlayer: function(container) {
            return vimeo
                .promisePlayer(container, {
                    id: this.$container.attr('data-video-id')
                })
                .then(
                    function(player) {
                        this.player = player;
                        this.player.play();
                    }.bind(this)
                );
        },

        _onPlayerLoadReady: function() {
            $(selectors.closePlayerButton, this.$container)
                .show()
                .focus();
            $(selectors.cover, this.$container).addClass(classes.playerLoaded);
            this.$container.addClass(classes.playerLoaded);

            this._setScrollPositionValues();

            $(selectors.body).addClass(classes.videoPlaying);

            $(document).on('keyup' + this.namespace, this._closeOnEscape.bind(this));
            $(window).on(
                'resize' + this.namespace,
                this._setScrollPositionValues.bind(this)
            );
            slate.a11y.trapFocus({
                $container: this.$container,
                namespace: this.namespace
            });
        },

        _onPlayerLoadError: function(err) {
            this.$container.addClass(classes.playerError);
            $(selectors.errorMessage, this.$container).text(err);
        },

        _closeOnEscape: function(evt) {
            if (evt.keyCode !== 27) {
                return;
            }

            this._closePlayer();
            $(selectors.loadPlayerButton, this.$container).focus();
        },

        _onScroll: function() {
            var scrollTop = $(window).scrollTop();

            if (
                scrollTop > this.videoTop + 0.25 * this.videoHeight ||
                scrollTop + this.windowHeight <
                this.videoBottom - 0.25 * this.videoHeight
            ) {
                // Debounce DOM edits to the next frame with requestAnimationFrame
                requestAnimationFrame(this._closePlayer.bind(this));
            }
        },

        _setScrollPositionValues: function() {
            this.videoHeight = this.$container.outerHeight(true);
            this.videoTop = this.$container.offset().top;
            this.videoBottom = this.videoTop + this.videoHeight;
            this.windowHeight = $(window).innerHeight();
        },

        _closePlayer: function() {
            $(selectors.body).removeClass(classes.videoPlaying);
            $(selectors.cover, this.$container).removeClass(classes.playerLoaded);
            this.$container.removeClass(classes.playerLoaded);
            $(selectors.closePlayerButton, this.$container).hide();

            slate.a11y.removeTrapFocus({
                $container: this.$container,
                namespace: this.namespace
            });

            if (typeof this.player.destroy === 'function') {
                this.player.destroy();
            } else if (typeof this.player.unload === 'function') {
                this.player.unload();
            }

            $(document).off(this.namespace);
            $(window).off(this.namespace);
        }
    });

    return Video;
})();

theme.CollectionsList = (function() {
    function CollectionsList(container) {
        var $container = (this.$container = $(container));
        var stretchImage = $container.is('[data-stretch-image]');

        // Early return if 'secondary image layout' is enabled
        if (stretchImage) return;

        var namespace = (this.namespace = '.' + $container.attr('data-section-id'));
        var self = this;

        self._collectionListFix();
        $(window).on(
            'resize' + namespace,
            $.debounce(250, function() {
                self._collectionListFix();
            })
        );
    }

    CollectionsList.prototype = _.assignIn({}, CollectionsList.prototype, {
        onUnload: function() {
            $(window).off(this.namespace);
        },

        _collectionListFix: function() {
            var numberRows = this.$container.find('.grid').data('number-rows');
            var $featureCards = this.$container.find('.featured-card');

            // We can exit if 'Use secondary image layout' is enabled
            if ($featureCards.is('[data-stretch-image]')) return;

            // Go through each of the rows
            for (var i = 0; i < numberRows; i++) {
                var maxWrapperHeight = 0;
                var maxHeaderHeight = 0;
                var $currentRow = $featureCards.filter(
                    "[data-row-number='" + (i + 1) + "']"
                );
                var $cardHeaders = $currentRow.find('.featured-card__header');

                // Find the max heights for each row
                $currentRow.each(function() {
                    var $cardTitle = $(this).find('.featured-card__title');
                    var $cardAction = $(this).find('.featured-card__action');
                    var $cardImageWrapper = $(this).find('.featured-card__image-wrapper');
                    var headerHeight =
                        $cardTitle.outerHeight() + $cardAction.outerHeight() + 65;
                    var wrapperHeight = $cardImageWrapper.outerHeight();
                    if (headerHeight > maxHeaderHeight) {
                        maxHeaderHeight = headerHeight;
                    }
                    if (wrapperHeight > maxWrapperHeight) {
                        maxWrapperHeight = wrapperHeight;
                    }
                });

                // Set the heights of the headers and cards for this row with padding
                $cardHeaders.outerHeight(maxHeaderHeight);
                $currentRow.height(maxWrapperHeight + maxHeaderHeight + 40);
            }
        }
    });

    return CollectionsList;
})();

theme.ParrallaxImage = (function() {
    function ParrallaxImage(container) {
        this.container = container;
        this.sectionId = $(container).attr('data-section-id');
        this.namespace = 'parallax-' + this.sectionId;
        var images = document.getElementsByClassName('thumbnail' + this.sectionId);
        new simpleParallax(images, {
            scale: 1.5,
            delay: .6,
        });
    }

    ParrallaxImage.prototype = $.extend({}, ParrallaxImage.prototype, {
        onUnload: function(evt) {
            var instance = new simpleParallax(images);
            instance.destroy();
            delete theme.ParrallaxImage[this.namespace];
        }
    });

    return ParrallaxImage;
})();

theme.init = function() {
    theme.customerTemplates.init();
    slate.rte.wrapTable();
    slate.rte.iframeReset();

    // Common a11y fixes
    slate.a11y.pageLinkFocus($(window.location.hash));

    $('.in-page-link').on('click', function(evt) {
        slate.a11y.pageLinkFocus($(evt.currentTarget.hash));
    });

    $('a[href="#"]').on('click', function(evt) {
        evt.preventDefault();
    });


    //scroll animation
    AOS.init({
        startEvent: 'DOMContentLoaded',
        offset: 30, // offset (in px) from the original trigger point
        delay: 0, // values from 0 to 3000, with step 50ms
        duration: 1000,
        once: true
    });
    window.addEventListener('load', function() {
        AOS.refresh();
    });


    // Sections
    var sections = new theme.Sections();
    sections.register('header', theme.HeaderSection);
    sections.register('product', theme.Product);
    sections.register('slideshow-section', theme.SlideshowSection);
    sections.register('cart', theme.Cart);
    sections.register('instagrams', theme.Instagrams);
    sections.register('masonries', theme.Masonry);
    sections.register('productlist', theme.Productlists);
    sections.register('producttab', theme.Producttabs);
    sections.register('slickCarousels', theme.slickCarousel);
    sections.register('video', theme.Video);
    sections.register('collections-list', theme.CollectionsList);
    sections.register('parallax-image', theme.ParrallaxImage);
    sections.register('bgcollection', theme.Bgcollection);

    // Standalone modules
    $(window).on('load', theme.articleImages);
    theme.passwordModalInit();
};

theme.articleImages = function() {
    var $indentedRteImages = $('.rte--indented-images');
    if (!$indentedRteImages.length) {
        return;
    }

    $indentedRteImages.find('img').each(function(i, el) {
        var $el = $(el);
        var attr = $el.attr('style');

        // Check if undefined or float: none
        if (!attr || attr === 'float: none;') {
            // Add class to parent paragraph tag if image is wider than container
            if ($el.width() >= $indentedRteImages.width()) {
                $el.parent('p').addClass('rte__image-indent');
            }
        }
    });
};

theme.passwordModalInit = function() {
    var $loginModal = $('#LoginModal');
    if (!$loginModal.length) {
        return;
    }

    // Initialize modal
    theme.PasswordModal = new window.Modals('LoginModal', 'login-modal', {
        focusOnOpen: '#Password'
    });

    // Open modal if errors exist
    if ($loginModal.find('.errors').length) {
        theme.PasswordModal.open();
    }
};

// CSS var ponyfill
theme.cssVar = (function() {
    cssVars();
})()

// Ajax search https://gist.github.com/awojtczyk/53d74c8af5f893841f33979b0cdcd6fe
theme.ajaxSearch = (function() {
    var $inputSearch = '.js-ajaxsearch',
        $resultsList = '.search-results',
        $input = $($inputSearch).find('input[name="q"]'),
        $currentAjaxRequest,
        $displayProducts = 6;

    $($inputSearch).css('position', 'relative').each(function() {
        $input.attr('autocomplete', 'off').bind('keyup change', function() {
            var term = $(this).val(),
                form = $(this).closest('form'),
                searchURL = '/search?type=product&q=*' + term + '*';
            if (term.length > 2 && term !== $(this).attr('data-old-term')) {
                $(this).attr('data-old-term', term);
                if ($currentAjaxRequest !== undefined) $currentAjaxRequest.abort();
                $currentAjaxRequest = $.getJSON(searchURL + '&view=json', function(data) {
                    $($resultsList).empty();

                    if (data.results_count === 0) {
                        $($resultsList).html('<p class="text-center">' + theme.strings.ajaxSearchNoResult + '</p>')
                    } else {
                        $.each(data.results, function(index, item) {
                            if (index < $displayProducts) {
                                var itemPrice = theme.Currency.formatMoney(item.price, theme.moneyFormat);
                                var link = $('<a class="d-inline-flex ' + index + '"></a>')
                                    .attr('href', item.url)
                                    .append('<span class="image"><img src="' + item.thumbnail + '" /></span>')
                                    .append('<div class="meta"><p class="title">' + item.title + '</p>' + itemPrice + '</div>')
                                    .wrap('<div class="ajax-search-item"></div>');
                                $($resultsList).append(link.parent());
                                theme.updateCurrencies();
                            }
                        });
                        if (data.results_count > $displayProducts) {
                            $($resultsList).append('<a class="btn btn--full" href="' + searchURL + '">' + theme.strings.ajaxSearchViewAll + ' (' + data.results_count + ')</a>');
                        }
                    }
                    $($resultsList).addClass('active').fadeIn(200);
                });
            }
        });
    });

    //escape when click somethings
    $(document).click(function(event) {
        var target = event.target;
        if (!$(target).is($inputSearch) && !$(target).parents().is($inputSearch)) {
            $($resultsList).slideUp(300);
        }
    });
})();

// Quickview https://github.com/kellyvaughn/quickview-for-shopify/blob/master/quickview.js.liquid
theme.quickview = (function() {
    var product_handle = '',
        quickviewButtonClass = '.js-btn-quickview',
        quickviewId = '#jsQuickview',
        quickviewOption = '#jsQuickview select',
        quickviewThumb = '#qv-product-images',
        quickviewAddCartButton = '.qv-add-button',
        quickviewPrice = '.qv-product-price',
        quickviewComparePrice = '.qv-product-compare-price';

    // 1. Show quickview
    $(document).on('click', quickviewButtonClass, function() {
        var quickviewAvaible = $(this).attr("data-pavailable");
        product_handle = $(this).data('handle');
        //ResetQuickview
        $(quickviewId).removeClass().addClass('modal fade');
        $(quickviewThumb).removeClass().empty();
        $('.qv-product-options').empty();

        //Pushdata
        $(quickviewId).addClass(product_handle).data('handle', product_handle);
        jQuery.getJSON('/products/' + product_handle + '.js', function(product) {
            var title = product.title;
            var type = product.type;
            var vendor = product.vendor;
            var price = 0;
            var compare_price = 0;
            var desc = product.description.slice(0, 90);
            var images = product.images;
            var variants = product.variants;
            var options = product.options;
            var url = '/products/' + product_handle;
            $('.qv-product-title').text(title);
            $('.qv-product-type').text(type);
            $('.qv-product-description').html(desc);
            $('.qv-view-product').attr('href', url);
            $('.qv-view-type').text(type);
            $('.qv-view-vendor').text(vendor)
            if (quickviewAvaible == 'true') {
                $(quickviewAddCartButton).prop('disabled', false).html(theme.strings.addToCart);
            } else {
                $(quickviewAddCartButton).prop('disabled', true).html(theme.strings.soldOut);
            }
            $(product.variants).each(function(i, variants) {
                if (variants.sku != null) {
                    $('.qv-sku').addClass("show").removeClass("hide");
                    $('.qv-view-sku').text(product.variants[0].sku);
                } else {
                    $('.qv-sku').addClass("hide").removeClass("show");
                }

            });
            var imageCount = $(images).length;
            $(images).each(function(i, image) {
                image_embed = '<div><img src="' + image + '"></div>';
                image_embed = image_embed.replace('.jpg', '_800x.jpg').replace('.png', '_800x.png');
                $(quickviewThumb).append(image_embed);
            });
            $(quickviewThumb).slick({
                rtl: theme.rtl,
                'dots': true,
                'arrows': true,
                'respondTo': 'min',
                'useTransform': true
            }).css('opacity', '1');

            if (product.variants[0].option1 !== "Default Title") {
                $(options).each(function(i, option) {
                    var name = option.name;
                    var opt = name.replace(/ /g, '-').toLowerCase();
                    var selectClass = '.option.' + opt;
                    $('.qv-product-options').append('<div class="option-selection ' + opt + '"><span class="option text-uppercase font-weight-bold text-body">' + option.name + '</span><select class="option-' + i + ' option ' + opt + '"></select></div>');
                    $(option.values).each(function(i, value) {
                        $('.option.' + opt).append($('<option>', {
                            value: value,
                            text: value
                        }));
                    });
                });
            }
            $(product.variants).each(function(i, v) {
                if (v.inventory_quantity == 0) {
                    return true
                } else {
                    price = theme.Currency.formatMoney(v.price, theme.moneyFormat);
                    compare_price = theme.Currency.formatMoney(v.compare_at_price, theme.moneyFormat);
                    $(quickviewPrice).html(price);
                    if (v.compare_at_price !== null) {
                        $(quickviewComparePrice).html(compare_price).show();
                    } else {
                        $(quickviewComparePrice).hide();
                    }
                    theme.updateCurrencies();
                    $('select.option-0').val(v.option1);
                    $('select.option-1').val(v.option2);
                    $('select.option-2').val(v.option3);
                    return false
                }
            });
        });
        //addCartQuickview
    });
    // 2. Add to cart
    $(document).on('click', quickviewAddCartButton, function() {
        product_handle = $(quickviewId).data('handle');
        var qty = $('.qv-quantity').val(),
            selectedOptions = '',
            var_id = '';

        function processCart() {
            jQuery.post('/cart/add.js', {
                    quantity: qty,
                    id: var_id
                }, null, "json").done(function(item) {
                    var htmlVariant = item.variant_title !== null ? '<i>(' + item.variant_title + ')</i>' : '';
                    var styleCart = $('.js-mini-cart').attr("data-cartmini");
                    if (styleCart != 'true') {
                        var htmlAlert = '<div class="media mt-2 alert--cart"><a class="mr-3" href="/cart"><img class="lazyload" data-src="' + item.image + '"></a><div class="media-body align-self-center"><p class="m-0 font-weight-bold">' + item.product_title + ' x ' + item.quantity + '</p>' + htmlVariant + '<div><div>';
                        theme.alert.new(theme.strings.addToCartSuccess, htmlAlert, 3000, 'notice');
                    }
                    theme.miniCart.updateElements();
                    theme.miniCart.generateCart();
                })
                .fail(function($xhr) {
                    var data = $xhr.responseJSON;
                    theme.alert.new('', data.description, 3000, 'warning');
                });
        }
        $(quickviewOption).each(function(i) {
            if (selectedOptions == '') {
                selectedOptions = $(this).val();
            } else {
                selectedOptions = selectedOptions + ' / ' + $(this).val();
            }
        });
        jQuery.getJSON('/products/' + product_handle + '.js', function(product) {
            if (product.variants.length === 1) {
                var_id = product.variants[0].id;
            } else {
                $(product.variants).each(function(i, v) {
                    if (v.title == selectedOptions) {
                        var_id = v.id;
                    }
                });
            }
            processCart();
        });
    });
    // 3. Select variants
    $(document).on('change', quickviewOption, function() {
        var selectedOptions = '';
        $(quickviewOption).each(function(i) {
            if (selectedOptions == '') {
                selectedOptions = $(this).val();
            } else {
                selectedOptions = selectedOptions + ' / ' + $(this).val();
            }
        });
        jQuery.getJSON('/products/' + product_handle + '.js', function(product) {
            $(product.variants).each(function(i, v) {
                if (v.title == selectedOptions) {
                    if (v.featured_image !== null) {
                        var iSlick = v.featured_image.position - 1;
                        $(quickviewThumb).slick('slickGoTo', iSlick);
                    }
                    var price = theme.Currency.formatMoney(v.price, theme.moneyFormat);
                    var compare_price = theme.Currency.formatMoney(v.compare_at_price, theme.moneyFormat);
                    $(quickviewPrice).html(price);
                    $(quickviewComparePrice).html(compare_price);
                    if (v.sku != null) {
                        $('.qv-sku').addClass("show").removeClass("hide");
                        $('.qv-view-sku').text(v.sku);
                    } else {
                        $('.qv-sku').addClass("hide").removeClass("show");
                    }
                    if (v.compare_at_price !== null) {
                        $(quickviewComparePrice).html(compare_price).show();
                    } else {
                        $(quickviewComparePrice).hide();
                    }
                    theme.updateCurrencies();
                    if (v.inventory_management === null) {
                        $(quickviewAddCartButton).prop('disabled', false).val(theme.strings.addToCart);
                    } else {
                        if (v.inventory_quantity < 1) {
                            $(quickviewAddCartButton).prop('disabled', true).val(theme.strings.soldOut);
                        } else {
                            $(quickviewAddCartButton).prop('disabled', false).val(theme.strings.addToCart);
                        }
                    }
                }
            });
        });
    });
})()

//Button add to cart (in grid item)
theme.addCartButton = (function() {
    var buttonClass = '.js-grid-cart';
    $(document).on('click', buttonClass, function() {
        var $this = $(this);
        var id = $this.data('id');
        $this.addClass('is-loading');
        Shopify.addItem(id, 1, function(item) {
            location.href = "/cart";
            var htmlVariant = item.variant_title !== null ? '<i>(' + item.variant_title + ')</i>' : '';
            var styleCart = $('.js-mini-cart').attr("data-cartmini");
            if (styleCart != 'true') {
                var htmlAlert = '<div class="media mt-2 alert--cart"><a class="mr-3" href="/cart"><img class="lazyload" data-src="' + item.image + '"></a><div class="media-body align-self-center"><p class="m-0 font-weight-bold">' + item.product_title + ' x ' + item.quantity + '</p>' + htmlVariant + '<div><div>';
            }
            theme.miniCart.updateElements();
            theme.miniCart.generateCart();
            setTimeout(function() {
                styleCart != 'true' ? theme.alert.new(theme.strings.addToCartSuccess, htmlAlert, 3000, 'notice') : '';
                $this.removeClass('is-loading');
            }, 1000);
        });
    })
})()

// Button add to cart (in grid item)
//theme.addCartButton = (function(){
//  var buttonClass = '.js-grid-cart';
//  $(document).on('click',buttonClass,function(){
//    var $this = $(this);
//    var id = $this.data('id');
//    $this.addClass('is-loading');
//    Shopify.addItem(id,1,function(item){
//      var htmlVariant = item.variant_title !== null ? '<i>('+item.variant_title+')</i>' : '';
//      var styleCart = $('.js-mini-cart').attr("data-cartmini");
//        if(styleCart != 'true'){
//          var htmlAlert = '<div class="media mt-2 alert--cart"><a class="mr-3" href="/cart"><img class="lazyload" data-src="'+item.image+'"></a><div class="media-body align-self-center"><p class="m-0 font-weight-bold">'+item.product_title+' x '+ item.quantity +'</p>'+htmlVariant+'<div><div>';
//        }
//      theme.miniCart.updateElements();
//      theme.miniCart.generateCart();
//      setTimeout(function() {
//        styleCart != 'true' ? theme.alert.new(theme.strings.addToCartSuccess,htmlAlert,3000,'notice'): '';
//        $this.removeClass('is-loading');
//      }, 1000);
//    });
// })
//})()

// Multi currencies 
if (theme.enableCurrencies) {
    // Can be 'money_format' or 'money_with_currency_format'
    Currency.format = 'money_format';
    var shopCurrency = Shopify.currency.active;
    var cookieCurrency = Currency.cookie.read();
    // Fix for customer account pages 
    jQuery('span.money span.money').each(function() {
        jQuery(this).parent('span.money').removeClass('money');
    });
    // Add precalculated shop currency to data attribute 
    jQuery('span.money').each(function() {
        jQuery(this).attr('data-currency-' + Shopify.currency.active, jQuery(this).html());
    });
    // Select all your currencies buttons.
    var buttons = jQuery('#currencies a'),
        currentCurrencies = jQuery('.pre-currencies');
    // When the page loads.
    if (cookieCurrency == null || cookieCurrency == shopCurrency) {
        Currency.currentCurrency = shopCurrency;
    } else {
        Currency.currentCurrency = cookieCurrency;
        Currency.convertAll(shopCurrency, cookieCurrency);
        buttons.removeClass('selected');
        jQuery('#currencies a[data-currency=' + cookieCurrency + ']').addClass('selected');
        var htmlCurrently = jQuery('#currencies a[data-currency=' + cookieCurrency + ']').html();
        currentCurrencies.html(htmlCurrently);
    }
    buttons.click(function() {
        buttons.removeClass('selected');
        jQuery(this).addClass('selected');
        var newCurrency = jQuery(this).attr('data-currency');
        var htmlCurrently = jQuery(this).html();
        currentCurrencies.html(htmlCurrently);
        Currency.convertAll(Currency.currentCurrency, newCurrency);
    });
    // For product options.
    var original_selectCallback = window.selectCallback;
    var selectCallback = function(variant, selector) {
        original_selectCallback(variant, selector);
        Currency.convertAll(shopCurrency, jQuery('#currencies a.selected').attr('data-currency'));
    };
}
theme.updateCurrencies = function() {
    Currency.convertAll(shopCurrency, jQuery('#currencies a.selected').attr('data-currency'));
}

// MiniCart
theme.miniCart = (function() {
    var miniCart = '.js-mini-cart',
        styleCart = $(miniCart).attr("data-cartmini"),
        cartToggle = '.js-toggle-cart',
        cartCount = '.js-cart-count',
        cartContent = '.js-mini-cart-content',
        cartTotal = '.js-cart-total',
        $btnCheckout = $('.js-cart-btn-checkout'),
        numberDisplayed = 5,
        // emptyCartHTML = '<div class="alert">' + theme.strings.cartEmpty + '</div>';

        // function updateElements() {
        //     Shopify.getCart(function(cart) {

        //         if (cart.item_count === 0) {
        //             $(cartContent).html(emptyCartHTML);
        //             $btnCheckout.addClass('disabled');
        //             styleCart === 'true' ? $(miniCart).removeClass('active') : null;

        //         } else {
        //             $btnCheckout.removeClass('disabled');
        //             styleCart === 'true' ? $(miniCart).addClass('active') : null;
        //         }
        //         $(cartCount).text(cart.item_count);
        //         $(cartTotal).html(theme.Currency.formatMoney(cart.total_price, theme.moneyFormat));
        //         theme.freeShipping.load(cart);
        //         theme.updateCurrencies();
        //     })
        // }

        // function generateCart() {

        //     Shopify.getCart(function(cart) {

        //         var htmlCart = cart.item_count === 0 ? emptyCartHTML : '',
        //             itemCount = cart.items.length,
        //             forLoop = itemCount < numberDisplayed ? itemCount : numberDisplayed;
        //         //styleCart === 'true' ? cart.items.length ? $(miniCart).addClass('active'): $(miniCart).removeClass('active') :null;

        //         // add list items
        //         for (var i = 0; i < forLoop; i++) {
        //             var product = cart.items[i],
        //                 productPrice = theme.Currency.formatMoney(product.price, theme.moneyFormat);
        //             htmlCart += '<div class="mini-cart-item">';
        //             htmlCart += '	<a class="mini-cart-image" href="' + product.url + '">';
        //             htmlCart += '		<img src="' + product.image + '"/>';
        //             htmlCart += '	</a>';
        //             htmlCart += '	<div class="mini-cart-meta">';
        //             htmlCart += '		<p ><a href="' + product.url + '">' + product.title + '</a></p>';
        //             htmlCart += '		<span> ' + productPrice + '</span><b> x ' + product.quantity + '</b>';
        //             htmlCart += '	</div>';
        //             htmlCart += '	<button class="btn js-remove-mini-cart" data-id="' + product.id + '">&times;</button>';
        //             htmlCart += '</div>';
        //         }
        //         if (itemCount > numberDisplayed) {
        //             htmlCart += '<a class="js-btn-viewmore" href="/cart">' + theme.strings.cartMore + '(' + (itemCount - numberDisplayed) + ')</a>'
        //         }
        //         // add total price and cart button / checkout button
        //         $(cartContent).html(htmlCart);
        //         $(cartTotal).html(theme.Currency.formatMoney(cart.total_price, theme.moneyFormat));
        //         theme.updateCurrencies();
        //     })
        // }
        // 2. Button remove items
        // $(document).on('click', '.js-remove-mini-cart', function() {
        //     var itemId = $(this).data('id');
        //     var isOuterMiniCart = $(this).closest(miniCart).length === 0 ? true : false; // check element from mini cart or not

        //     // hide items
        //     $(this).parent().fadeOut();

        //     //remove from cart
        //     Shopify.changeItem(itemId, 0, updateElements);
        //     Shopify.getCart(function(cart) {
        //         if (cart.items.length > numberDisplayed || isOuterMiniCart) {
        //             generateCart();
        //         }
        //     });
        // });

        //Keep popup when click cart / UX
        $(document).on('click', cartToggle, function() {
            $(this).parent(miniCart).toggleClass('active');
        });
    $(document).on('click', '.overlaycart', function() {
        $(this).parent(miniCart).removeClass('active');
    });

    // gen minicart when load page
    generateCart();
    return {
        updateElements: updateElements,
        generateCart: generateCart
    }
})()

// Free shipping
theme.freeShipping = (function() {
    var $freeShippingClass = $('.js-free-shipping'),
        $freeShippingTextClass = $('.js-free-shipping-text'),
        $free_fisrt = $freeShippingClass.attr('data-start'),
        $free_end = $freeShippingClass.attr('data-end')
    minOrderValue = parseInt($freeShippingClass.data('value')) || 0,
        $percentClass = $('.js-free-shipping .progress-bar');

    function generate(cart) {
        var priceCart = cart.total_price;
        if (priceCart >= minOrderValue) {
            $percentClass.css('width', '100%').removeClass('progress-bar-striped bg-primary');
            $freeShippingTextClass.text(theme.strings.freeShipping)
        } else {
            let percent = priceCart / minOrderValue * 100;
            let left = Shopify.formatMoney((minOrderValue - priceCart), theme.moneyFormat);
            $percentClass.css('width', percent + '%').addClass('progress-bar-striped primary');
            $freeShippingTextClass.html($free_fisrt + ' ' + left + ' ' + $free_end);
            theme.updateCurrencies();
        }
    }

    Shopify.getCart(function(cart) {
        generate(cart);
    });

    return {
        load: generate
    }
})()

// Shipping time - https://github.com/phstc/jquery-dateFormat
theme.shippingTime = (function() {
    var $shippingTime = $('.js-shipping-time'),
        shippingTime = $shippingTime.data('time') || '',
        now = new Date(),
        restHour = 23 - now.getHours(),
        restMinute = 59 - now.getMinutes();
    if (shippingTime !== '') {
        var nextTime = new Date(now.getTime() + shippingTime * 86400000),
            formatTime = $.format.date(nextTime, "ddd, dd MMMM yyyy"),
            htmlShipping = 'Order in the next <b>' + restHour + '</b> hours <b>' + restMinute + '</b> minutes to get it by <b>' + formatTime + '</b>. ';
        $shippingTime.html(htmlShipping);
    }
})()

// Infinite scroll - https://github.com/Elkfox/Ajaxinate/blob/master/dist/ajaxinate.min.js
theme.infiniteScroll = (function() {
    function initInfiniteScroll() {
        if ($('.AjaxinateLoop').length === 0) {
            return;
        } else {
            var endlessScroll = new Ajaxinate({
                loadingText: '<div class="text-center"><div class="' + theme.loadingClass + '" role="status"></div></div>',
                callback: function() {
                    theme.wishlist.load();
                    theme.compare.load();
                    theme.countdown.load();
                    theme.priceRange.load();
                    theme.tooltip.load();
                    theme.collectionView.triggerView();
                    theme.swatchCard2.load();
                }
            });
        }
    }

    // Infinite scroll in other page (blog, list-collection)
    function initOtherPages() {
        var otherPages = new Ajaxinate({
            loadingText: '<div class="text-center"><div class="' + theme.loadingClass + '" role="status"></div></div>',
            container: '.js-pagination-content',
            pagination: '.js-pagination'
        });
    }

    document.addEventListener("DOMContentLoaded", function() {
        initInfiniteScroll();
        initOtherPages();
    });

    return {
        load: initInfiniteScroll
    }
})()

// Scroll to fixed
theme.scrollToFixed = (function() {
    var window_width = $(window).width();

    if (window_width < 768) {
        $(".js-stick-parent").trigger("sticky_kit:detach");
    } else {
        make_sticky();
    }
    $(window).resize(function() {

        window_width = $(window).width();

        if (window_width < 768) {
            $(".js-stick-parent").trigger("sticky_kit:detach");
        } else {
            make_sticky();
        }
    });

    function make_sticky() {
        $('.js-stick-parent').stick_in_parent();
    }

})()


theme.headersidebar = (function() {
    $('#dismiss, .overlaysidebar').on('click', function() {
        // hide sidebar
        $('#sidebar').removeClass('active');
        // hide overlay
        $('.overlaysidebar').removeClass('active');
    });

    $('#sidebarCollapse').on('click', function() {
        // open sidebar
        $('#sidebar').addClass('active');
        // fade in the overlay
        $('.overlaysidebar').addClass('active');
        $('.collapse.in').toggleClass('in');
        $('a[aria-expanded=true]').attr('aria-expanded', 'false');
    });
})()

// Wishlist
theme.wishlist = (function() {
    var wishlistButtonClass = '.js-btn-wishlist',
        wishlistRemoveButtonClass = '.js-remove-wishlist',
        $wishlistCount = $('.js-wishlist-count'),
        $wishlistContainer = $('.js-wishlist-content'),
        wishlistObject = JSON.parse(localStorage.getItem('localWishlist')) || [],
        wishlistPageUrl = $('.js-wishlist-link').attr('href'),
        loadNoResult = function() {
            $wishlistContainer.html('<div class="col text-center"><div class="alert alert-warning d-inline-block">' + theme.strings.wishlistNoResult + '</div></div>');
        };

    function updateWishlist(self) {
        var productHandle = $(self).data('handle'),
            allSimilarProduct = $(wishlistButtonClass + '[data-handle="' + productHandle + '"]');
        var isAdded = $.inArray(productHandle, wishlistObject) !== -1 ? true : false;
        if (isAdded) {
            // go to wishlist page
            window.location.href = wishlistPageUrl;
        } else {
            wishlistObject.push(productHandle);
            allSimilarProduct.fadeOut('slow').fadeIn('fast').html(theme.strings.wishlistIconAdded + theme.strings.wishlistTextAdded);
            //change tooltip
            allSimilarProduct.attr('data-original-title', theme.strings.wishlistTextAdded);
            $('.tooltip-inner').text(theme.strings.wishlistTextAdded);
        }
        localStorage.setItem('localWishlist', JSON.stringify(wishlistObject));
        $wishlistCount.text(wishlistObject.length);
    };

    function loadWishlist() {
        $wishlistContainer.html('');
        //page wishlist
        if (wishlistObject.length > 0) {
            for (var i = 0; i < wishlistObject.length; i++) {
                var productHandle = wishlistObject[i];
                Shopify.getProduct(productHandle, function(product) {
                    var htmlProduct = '';
                    var productPrice = product.price_varies ? 'from ' + theme.Currency.formatMoney(product.price_min, theme.moneyFormat) : theme.Currency.formatMoney(product.price, theme.moneyFormat);
                    var productComparePrice = product.compare_at_price_min !== 0 ? theme.Currency.formatMoney(product.compare_at_price_min, theme.moneyFormat) : '';
                    htmlProduct += '<div class="js-wishlist-item col-md-4 col-sm-6 col-xs-6 col-12 mb-4">';
                    htmlProduct += '<div class="js-wishlist-itembox">';
                    htmlProduct += '<div class=" d-flex flex-row p-4">';
                    htmlProduct += '	<a class="d-inline-block mr-4 " href="' + product.url + '">';
                    htmlProduct += '		<img src="' + product.featured_image + '"/>';
                    htmlProduct += '	</a>';
                    htmlProduct += '	<div><a href="' + product.url + '" class="title-prouct d-block h4 text-body" >' + product.title + '</a>';
                    htmlProduct += '	<span> ' + productPrice + '</span>';
                    htmlProduct += '	 <s>' + productComparePrice + '</s></div>';
                    htmlProduct += '<button class="btn js-remove-wishlist" data-handle="' + product.handle + '">' + theme.strings.wishlistRemove + '</button>';
                    htmlProduct += '</div>';
                    htmlProduct += '</div>';
                    htmlProduct += '</div>';
                    $wishlistContainer.append(htmlProduct);
                    theme.updateCurrencies();
                });
            }
        } else {
            loadNoResult();
        }

        //count items
        $wishlistCount.text(wishlistObject.length);

        //button text
        $(wishlistButtonClass).each(function() {
            var productHandle = $(this).data('handle');
            var iconWishlist = $.inArray(productHandle, wishlistObject) !== -1 ? theme.strings.wishlistIconAdded : theme.strings.wishlistIcon;
            var textWishlist = $.inArray(productHandle, wishlistObject) !== -1 ? theme.strings.wishlistTextAdded : theme.strings.wishlistText;
            $(this).html(iconWishlist + textWishlist).attr('title', textWishlist);
        });
    }

    $(document).on('click', wishlistButtonClass, function(event) {
        event.preventDefault();
        updateWishlist(this);
    });
    $(document).on('click', wishlistRemoveButtonClass, function() {
        var productHandle = $(this).data('handle'),
            allSimilarProduct = $(wishlistButtonClass + '[data-handle="' + productHandle + '"]');

        //update button
        allSimilarProduct.html(theme.strings.wishlistIcon + theme.strings.wishlistText);
        //update tooltip
        allSimilarProduct.attr('data-original-title', theme.strings.wishlistText);
        $('.tooltip-inner').text(theme.strings.wishlistText);
        //update Object
        wishlistObject.splice(wishlistObject.indexOf(productHandle), 1);
        localStorage.setItem('localWishlist', JSON.stringify(wishlistObject));
        // Remove element
        $(this).closest('.js-wishlist-item').fadeOut(); // or .remove()
        //count
        $wishlistCount.text(wishlistObject.length);
        if (wishlistObject.length === 0) {
            loadNoResult();
        }
    });

    loadWishlist();
    $(document).on('shopify:section:load', loadWishlist);
    return {
        load: loadWishlist
    }
})()

// Compare
theme.compare = (function() {
    var compareButtonClass = '.js-btn-compare',
        compareRemoveButtonClass = '.js-remove-compare',
        $compareCount = $('.js-compare-count'),
        $compareContainer = $('.js-compare-content'),
        compareObject = JSON.parse(localStorage.getItem('localCompare')) || [],
        alertClass = 'notice';

    function updateCompare(self) {
        var productHandle = $(self).data('handle'),
            alertText = '';
        var isAdded = $.inArray(productHandle, compareObject) !== -1 ? true : false;
        if (isAdded) {
            compareObject.splice(compareObject.indexOf(productHandle), 1);
            alertText = theme.strings.compareNotifyRemoved;
            alertClass = 'notice';
        } else {
            if (compareObject.length === 4) {
                alertText = theme.strings.compareNotifyMaximum;
                alertClass = 'error';
            } else {
                alertClass = 'notice';
                compareObject.push(productHandle);
                alertText = theme.strings.compareNotifyAdded;
            }
        }
        localStorage.setItem('localCompare', JSON.stringify(compareObject));
        theme.alert.new(theme.strings.compareText, alertText, 2000, alertClass);
        $compareCount.text(compareObject.length);
    };

    function loadCompare() {
        var compareGrid;
        $compareContainer.html('');
        //popup compare
        if (compareObject.length > 0) {
            compareGrid = compareObject.length === 1 ? 'col-md-6 col-sm-6' : 'col';
            for (var i = 0; i < compareObject.length; i++) {
                var productHandle = compareObject[i];
                Shopify.getProduct(productHandle, function(product) {
                    var htmlProduct = '',
                        productPrice = product.price_varies ? 'from ' + theme.Currency.formatMoney(product.price_min, theme.moneyFormat) : theme.Currency.formatMoney(product.price, theme.moneyFormat),
                        productComparePrice = product.compare_at_price_min !== 0 ? theme.Currency.formatMoney(product.compare_at_price_min, theme.moneyFormat) : '',
                        productAvailable = product.available ? theme.strings.available : theme.strings.unavailable,
                        productAvailableClass = product.available ? 'alert-success' : 'alert-danger',
                        productTypeHTML = product.type !== "" ? '<a href="/collections/types?q=' + product.type + '">' + product.type + '</a>' : '<span>' + theme.strings.none + '</span>',
                        productVendorHTML = product.vendor !== "" ? '<a href="/collections/vendors?q=' + product.vendor + '">' + product.vendor + '</a>' : '<span>' + theme.strings.none + '</span>';
                    htmlProduct += '<div class="compare-item ' + compareGrid + ' col-xs-6">';
                    htmlProduct += '	<a href="' + product.url + '">';
                    htmlProduct += '		<img src="' + Shopify.resizeImage(product.featured_image, 'x300') + '"/>';
                    htmlProduct += '	</a>';
                    htmlProduct += '	<hr /><h5 >' + product.title + '</h5>';
                    htmlProduct += '	<hr /><s>' + productComparePrice + '</s>';
                    htmlProduct += '	<span> ' + productPrice + '</span>';
                    htmlProduct += '	<hr /><span class=' + productAvailableClass + '> ' + productAvailable + '</span>';
                    htmlProduct += '	<hr />' + productTypeHTML;
                    htmlProduct += '	<hr />' + productVendorHTML;
                    htmlProduct += '  <hr /><button class="btn js-remove-compare btn-theme gradient-theme" data-handle="' + product.handle + '">' + theme.strings.compareRemove + '</button>';
                    htmlProduct += '</div>';
                    $compareContainer.append(htmlProduct);
                    theme.updateCurrencies();
                });
            }
        } else {
            $compareContainer.html('<div class="alert alert-warning d-inline-block">' + theme.strings.compareNoResult + '</div>');
        }

        //button text
        $(compareButtonClass).each(function() {
            var productHandle = $(this).data('handle');
            var status = $.inArray(productHandle, compareObject) !== -1 ? 'added' : '';
            $(this).removeClass('added').addClass(status);
        });

        //count items
        $compareCount.text(compareObject.length);
    }
    $(document).on('click', compareButtonClass, function(event) {
        event.preventDefault();
        updateCompare(this);
        loadCompare();
    });
    $(document).on('click', compareRemoveButtonClass, function() {
        var productHandle = $(this).data('handle');
        compareObject.splice(compareObject.indexOf(productHandle), 1);
        localStorage.setItem('localCompare', JSON.stringify(compareObject));
        loadCompare();
    });

    loadCompare();
    $(document).on('shopify:section:load', loadCompare);
    return {
        load: loadCompare
    }
})()

// Popup newsletter
theme.popupNewletter = (function() {
    var $popupNewsletter = $('#jsPopupNewsletter'),
        $newsletterForm = $('#jsPopupNewsletter form'),
        date = new Date(),
        minutes = theme.timePopupNewsletter;
    minutesdelay = $popupNewsletter.attr('data-delay');
    if ($popupNewsletter.length === 1) {
        date.setTime(date.getTime() + (minutes * 60 * 1000));
        var setCookies = function() {
            $.cookie('cookiesNewsletter', 'disabled', { expires: date, path: '/' });
        };
        if ($.cookie('cookiesNewsletter') !== "disabled") {
            $(window).on('load', function() {
                setTimeout(function() {
                    $popupNewsletter.modal('show');
                }, minutesdelay * 1000);
            });
            $popupNewsletter.on('hidden.bs.modal', setCookies);
            $newsletterForm.submit(setCookies);
        }
    }
})()

// Cookie policy
theme.cookie = (function() {
    var $policy = $('.js-cookie-policy'),
        $closeButton = $('.js-btn-ok'),
        isOk = localStorage.getItem('localCookie') || '';
    if (isOk === '') {
        $policy.fadeIn('slow');
    }
    $closeButton.on('click', function() {
        localStorage.setItem('localCookie', 'accept');
        $policy.fadeOut('slow');
    })
})()

// Announcement Bar
theme.announcement = (function() {
    var $bar = $('.js-announcement-bar'),
        $closeButton = $('.js-ab-close'),
        isClosed = localStorage.getItem('localAnnouncement') || '';
    if (isClosed === '') {
        $bar.fadeIn();
        $bar.closest('.body-theme').addClass('body-announcement-bar');
    }
    $closeButton.on('click', function() {
        localStorage.setItem('localAnnouncement', 'closed');
        $bar.slideUp();
        $bar.closest('.body-theme').removeClass('body-announcement-bar');
    })
})()

// Open external link in new tab
theme.exLink = (function() {
    var links = document.links;
    for (let i = 0, linksLength = links.length; i < linksLength; i++) {
        if (links[i].hostname !== window.location.hostname && $(links[i]).attr('href') !== 'javascript:void(0)') {
            links[i].target = '_blank';
        }
    }
})()

// Deal- countdown
theme.countdown = (function() {
    function initCountdown() {
        $(".js-countdown").each(function() {
            var endTime = $(this).data('time'),
                htmlLayout = "<ul class='list--inline'><li class='gradient-theme-vertical'><span class='countdown-time'>%%D%%</span><span class='countdown-text'>Days</span></li><li class='gradient-theme-vertical'><span class='countdown-time'>%%H%%</span><span class='countdown-text'>Hours</span></li><li class='gradient-theme-vertical'><span class='countdown-time'>%%M%%</span><span class='countdown-text'>Mins</span></li><li class='gradient-theme-vertical'><span class='countdown-time'>%%S%%</span><span class='countdown-text'>Secs</span></li></ul>";
            $(this).lofCountDown({
                TargetDate: endTime,
                DisplayFormat: htmlLayout,
                FinishMessage: '<span class="alert alert-warning d-inline-block">' + theme.strings.countdownEndText + '</span>'
            });
        });
    }
    initCountdown();
    return {
        load: initCountdown
    }
})()

// Price range - Collection page
theme.priceRange = (function() {
    function initPriceRange() {
        var min = 0,
            max = 0,
            slideRange = '#js-slider-range',
            productCard = '.js-product-card',
            slideRangeWrap = '.slider-range-wr',
            rangeMin = '.js-range-min',
            rangeMax = '.js-range-max',
            enablePriceRange = $('#js-slider-range').length === 1 ? true : false;

        if (enablePriceRange) {
            $(productCard).each(function() {
                if (eval($(this).data('price')) > max) max = eval($(this).data('price'));
                if (min == 0) min = eval($(this).data('price'));
                else if (eval($(this).data('price')) < min) min = eval($(this).data('price'));
            });

            if (min === max) {
                $(slideRangeWrap).fadeOut();
            } else {
                $(slideRangeWrap).fadeIn();
            }

            $(slideRange).slider({
                range: true,
                min: min,
                max: max,
                values: [min, max],
                slide: function(event, ui) {
                    var price1 = (Shopify.formatMoney(ui.values[0], theme.moneyFormat));
                    var price2 = (Shopify.formatMoney(ui.values[1], theme.moneyFormat));
                    $(rangeMin).html(price1);
                    $(rangeMax).html(price2);
                    theme.updateCurrencies();

                    // Show/Hide product when dragging
                    $(productCard).each(function() {
                        if (eval($(this).data('price')) >= ui.values[0] && eval($(this).data('price')) <= ui.values[1]) {
                            $(this).parent().fadeIn();
                        } else {
                            $(this).parent().fadeOut();
                        }
                    });
                }
            });

            var price1 = (Shopify.formatMoney(min, theme.moneyFormat));
            var price2 = (Shopify.formatMoney(max, theme.moneyFormat));
            $(rangeMin).html(price1);
            $(rangeMax).html(price2);
            theme.updateCurrencies();

        }
    }
    initPriceRange();
    return {
        load: initPriceRange
    }
})()

// Collection view - Collection page
theme.collectionView = (function() {
    var btnView = '.js-btn-view',
        btnViewActive = '.js-btn-view.active';

    $(document).on('click', btnView, function() {
        var value = $(this).data('col'),
            $gridItemCol = $('.js-col');

        $(btnView).removeClass('active');
        $(this).addClass('active');

        $gridItemCol.removeClass().addClass('js-col col-sm-6 col-12');
        if (value === 3) {
            $gridItemCol.addClass('col-lg-4');
        } else if (value === 4) {
            $gridItemCol.addClass('col-lg-3');
        } else if (value === 5) {
            $gridItemCol.addClass('col-lg-2-4');
        } else if (value === 6) {
            $gridItemCol.addClass('col-lg-2');
        };
    })

    function triggerCollectionView() {
        $(btnViewActive).trigger('click');
    }

    return {
        triggerView: triggerCollectionView
    }
})()

// Swath variant in card item
theme.swatchCard = (function() {
    $(document).on('click', '.js-swatch-card-item', function() { //click or mouseover
        $(".js-swatch-card-item").removeClass("active");
        $(this).addClass("active");
        var newImage = $(this).data('image');
        var id = $(this).data('id');
        var gridItem = $(this).closest('.js-product-card');
        gridItem.find('.product-card__image').find('img').attr('srcset', newImage);
        gridItem.find('.js-grid-cart').data('id', id).attr('data-id', id);
    });
})()

theme.swatchCard2 = (function() {
    function initVariant(id) {
        var productJson = JSON.parse($('.customJson-' + id).html());
        var $selectorForm = $('.customform-' + id);
        var $button = $('.js-customform-addtocart-' + id);
        var $buttontext = $button.find('span');
        var $wrapObject = $selectorForm.closest('.js-product-card');
        var options = {
            $container: $selectorForm,
            enableHistoryState: false,
            product: productJson,
            singleOptionSelector: '.single-option-selector-' + id,
            originalSelectorId: '#ProductSelect-' + id
        };
        var variants = new slate.Variants(options);
        var AjaxCart = new window.AjaxCart($selectorForm);
        var _updateButton = function(evt) {
            var variant = evt.variant;
            if (variant === undefined) {
                $button.prop('disabled', true).removeClass('btn--sold-out');
                $buttontext.html(theme.strings.unavailable);
            } else {
                if (variant.available) {
                    $button.removeClass('btn--sold-out').prop('disabled', false);
                    $buttontext.html(theme.strings.addToCart);
                } else {
                    $button.prop('disabled', true).addClass('btn--sold-out');
                    $buttontext.html(theme.strings.soldOut);
                }
            }
        }
        var _updateImage = function(evt) {
            var variant = evt.variant;
            var $mainImage = $wrapObject.find('.product-card__image').find('img');
            if (variant !== undefined && variant.featured_image !== null) {
                var variantImage = variant.featured_image;
                $mainImage.attr('srcset', variantImage.src);
            }
        }
        var _updatePrice = function(evt) {
            var $price = $wrapObject.find('.product-card__price');
            var variant = evt.variant;
            if (variant !== undefined) {
                var htmlComparePrice = variant.compare_at_price !== null ? '<s class="product-card__regular-price"><span class="money">' + variant.compare_at_price + '</span></s>' : '';
                var htmlPrice = '<span class="money">' + variant.price + '</span>' + htmlComparePrice;
                $price.html(htmlPrice);
                theme.updateCurrencies();
            }
        }
        variants.$container.on(
            'variantChange', _updateButton
        );
        variants.$container.on(
            'variantChange', _updateImage
        );
        variants.$container.on(
            'variantChange', _updatePrice
        );
    }

    function initForm() {
        $('.js-customform').each(function() {
            var id = $(this).data('id');
            initVariant(id);
        })
    }

    initForm();
    return {
        load: initForm
    }
})()

// Loading
theme.loading = (function() {
    var $loading = $('#js-loading'),
        hasLoading = $('#js-loading').length === 0 ? false : true;
    if (hasLoading) {
        $(window).load(function() {
            $loading.fadeOut();
        });
    }
})()

theme.effectLeavingPage = (function() {
    window.onbeforeunload = function() {
        $('body').css('opacity', '0');
    }
})()

// Isotope
theme.isotope = (function() {
    var enableIsotope = $('.enable-isotope').length === 1 ? true : false,
        $grid = $('.js-grid'),
        filter = '.js-filter-isotope';

    function initIsotope() {
        if (enableIsotope) {
            $grid.isotope({
                itemSelector: '.grid-item',
                percentPosition: true
            })
            $(document).on('click', filter, function() {
                var filterValue = $(this).data('filter') === '*' ? $(this).data('filter') : '.' + $(this).data('filter');
                $(filter).removeClass('active');
                $(this).addClass('active');
                $grid.isotope({
                    filter: filterValue
                });
            });
            $(window).scroll(function() {
                $grid.isotope('layout');
            });
            $(window).load(function() {
                $grid.isotope('layout');
                $(filter).first().trigger('click');
            });
        }
    }
    initIsotope();
})()

//aos



// theme.Wow = (function(){
//   new WOW().init();
// })()




// Masonry
theme.Masonry = (function() {
    function Masonry(container) {
        this.$container = $(container).on('init', this._a11y.bind(this));
        var $masonry = this.$container;
        $masonry.isotope({
            itemSelector: '.grid-item',
            percentPosition: true,
            masonry: {
                columnWidth: '.grid-sizer'
            }
        });
        $(window).load(function() {
            $masonry.isotope('layout').css('opacity', '1');
        });
        $(window).scroll(function() {
            $masonry.isotope('layout').css('opacity', '1');
        });
    }

    Masonry.prototype = _.assignIn({}, Masonry.prototype, {
        _a11y: function(event, obj) {
            var $list = obj.$list;
            var $wrapper = this.$container.parent();

            // Remove default Slick aria-live attr until slider is focused
            $list.removeAttr('aria-live');

            // When an element in the slider is focused set aria-live
            $wrapper.on('focusin', function(evt) {
                if ($wrapper.has(evt.target).length) {
                    $list.attr('aria-live', 'polite');
                }
            });

            // Remove aria-live
            $wrapper.on('focusout', function(evt) {
                if ($wrapper.has(evt.target).length) {
                    $list.removeAttr('aria-live');
                }
            });
        }
    });

    return Masonry;
})();



// Cross-selling
theme.crosssell = (function() {
    var crosssellClass = '.js-crosssell',
        handles = $(crosssellClass).data('handles') || '',
        arrayHandle = handles.split(','),
        $blockCrosssell = $('.block-cross-sell'),
        variantSelectClass = '.js-cross-select',
        crossImageClass = '.cross-item-image',
        crossPriceClass = '.cross-item-money';

    function generateCrosssell() {
        for (var i = 0; i < arrayHandle.length; i++) {
            var productHandle = arrayHandle[i];
            Shopify.getProduct(productHandle, function(product) {
                var htmlCross = '',
                    htmlOption = '',
                    firstAvailableVariant = '',
                    variantCount = product.variants.length;

                // generate select box and check first avaiable variant
                for (var j = 0; j < variantCount; j++) {
                    var variant = product.variants[j],
                        variantImage = variant.featured_image === null ? product.featured_image : variant.featured_image.src,
                        disabled = variant.available ? '' : 'disabled';
                    htmlOption += '<option ' + disabled + ' data-id="' + variant.id + '" data-price="' + variant.price + '" data-image="' + variantImage + '">' + variant.title + '</option>';
                    if (firstAvailableVariant === '' && variant.available) {
                        firstAvailableVariant = variant
                    }
                }
                var productPrice = theme.Currency.formatMoney(firstAvailableVariant.price, theme.moneyFormat),
                    productImage = firstAvailableVariant.featured_image === null ? product.featured_image : firstAvailableVariant.featured_image.src,
                    selectHide = variantCount === 1 ? 'hide' : '';

                // generate HTML
                htmlCross += '<div class="col cross-item ' + product.handle + '">';
                htmlCross += '	<a class="cross-item-image" href="' + product.url + '" title="' + product.title + '"><img src="' + productImage + '" />' + theme.strings.cartIcon + '</a>';
                htmlCross += '	<a target="_blank" href="' + product.url + '" title="' + product.title + '" class="cross-item-title">' + product.title + '</a>';
                htmlCross += '	<span class="cross-item-money">' + productPrice + '</span>';
                htmlCross += '	<select class="js-cross-select ' + selectHide + '" data-image="' + productImage + '" data-price="' + firstAvailableVariant.price + '" data-item="' + firstAvailableVariant.id + '">' + htmlOption + '</select>';
                htmlCross += '</div>';
                $(crosssellClass).append(htmlCross);
                theme.updateCurrencies();
            });
        }
    }

    function showPopupCrosssell(lineItem) {
        //generate lineitem;
        var htmlLineItem = '';
        htmlLineItem += '<span class="alert alert-success d-inline-block mb-2">' + theme.strings.addToCartSuccess + '</span>';
        htmlLineItem += '<div><img src="' + lineItem.image + '" alt="Added Product"></div>';
        htmlLineItem += '<h4 class="cross-item-title">' + lineItem.title + '</h4>';
        htmlLineItem += '<div class="mb-2">' + theme.strings.cartQuantity + ': ' + lineItem.quantity + '</div>';
        $('.js-cross-added').hide().html(htmlLineItem).fadeIn();

        // show popup
        var $popupCrosssell = $('#jsCrosssell');
        $popupCrosssell.modal('show');
    }

    if (handles !== '') {
        $(document).on('click', crossImageClass, function(event) {
            event.preventDefault();
            var parent = $(this).closest('.cross-item'),
                itemId = parent.find(variantSelectClass).attr('data-item');
            Shopify.addItem(itemId, 1, function(lineItem) {
                theme.miniCart.updateElements();
                theme.miniCart.generateCart();
                showPopupCrosssell(lineItem);
            });
        });
        $(document).on('change', variantSelectClass, function() {
            var selectVariant = $(this).children(':selected'),
                selectVariantId = selectVariant.data('id'),
                parent = $(this).parent(),
                newPrice = theme.Currency.formatMoney(selectVariant.data('price'), theme.moneyFormat);

            if (selectVariant.data('image') !== '') {
                parent.find(crossImageClass).find('img').attr('src', selectVariant.data('image'));
            }
            $(this).attr('data-item', selectVariantId);
            parent.find(crossPriceClass).html(newPrice);
            theme.updateCurrencies();
        });
        $(document).on('shopify:section:load', generateCrosssell);
        generateCrosssell();
        $blockCrosssell.removeClass('hide');
    }
    return {
        showPopup: showPopupCrosssell
    }
})()

// Upsell
theme.upsell = (function() {
    var popupUpsell = '#jsUpsell',
        $button = $('#jsUpsell .btn'),
        productUpsellId = $('#jsUpsell').data('id') || '',
        buttonAcceptClass = 'js-btn-accept',
        delayTime = $('#jsUpsell').data('delay') || 3000,
        isUpsell = $(popupUpsell).length === 1 ? true : false;
    if (isUpsell) {
        $(document).ready(function() {
            setTimeout(function() {
                $(popupUpsell).modal('show');
            }, delayTime);
        });
        $button.on('click', function() {
            if ($(this).hasClass(buttonAcceptClass)) {
                Shopify.addItem(productUpsellId, 1, function(item) {
                    theme.miniCart.updateElements();
                    theme.miniCart.generateCart();
                    var htmlVariant = item.variant_title !== null ? '<i>(' + item.variant_title + ')</i>' : '';
                    var htmlAlert = '<div class="media mt-2 alert--cart"><a class="mr-3" href="/cart"><img class="lazyload" data-src="' + item.image + '"></a><div class="media-body align-self-center"><p class="m-0 font-weight-bold">' + item.product_title + ' x ' + item.quantity + '</p>' + htmlVariant + '<div><div>';
                    theme.alert.new(theme.strings.addToCartSuccess, htmlAlert, 3000, 'notice');
                })
            }
            $(popupUpsell).modal('hide');
        })
    }
})()

// Coupon
theme.coupon = (function() {
    var popupCoupon = '#jsCoupon',
        $button = $('#jsCoupon .js-btn-coupon'),
        delayTime = $('#jsCoupon').data('delay') || 3000,
        isCoupon = $(popupCoupon).length === 1 ? true : false,
        isCopied = localStorage.getItem('localCoupon') || '';
    if (isCoupon && isCopied === '') {
        $(document).ready(function() {
            setTimeout(function() {
                $(popupCoupon).modal('show');
            }, delayTime);
        });
        $button.on('click', function() {
            var copyText = document.getElementById("coupon_code");
            copyText.select();
            document.execCommand("Copy");
            $(popupCoupon).modal('hide');
            theme.alert.new('Coupon code', 'Successfully copied, now you can paste code at checkout', 4000);
            localStorage.setItem('localCoupon', 'copied');
        })
    }
})()

// Overwrite Shopify.onError in Shopify API
Shopify.onError = function(t, r) {
    var e = eval("(" + t.responseText + ")");
    var mess = e.message ? e.message + "(" + e.status + "): " + e.description : "Error : " + Shopify.fullMessagesFromErrors(e).join("; ") + "."
    theme.alert.new('Alert', mess, 3000, 'warning');
}

// Megamenu width
theme.fixWidthMegamenu = (function() {
    var $megamenuClass = $('.site-nav__item-mega'),
        megaDropdownClass = '.meganav';
    $megamenuClass.each(function() {
        var widthMenu = $(this).data('width') || 0;
        if (widthMenu !== 0) {
            $(this).find(megaDropdownClass).css({ 'width': widthMenu + 'px', 'margin-left': '-' + widthMenu / 2 + 'px' });
        }
    });
})()

// Product video
theme.productVideo = (function() {
    var playButtonClass = '.js-play-button';
    $(document).on('click', playButtonClass, function() {
        let videoSelector = $(this).next(),
            videoObject = videoSelector.get(0);
        $(this).toggleClass('active');
        videoSelector.toggleClass('active');
        videoObject.paused ? videoObject.play() : videoObject.pause();
    })
})()

// Fake-viewers
theme.fakeViewer = (function() {
    var $fakeViewClass = $('.js-fake-view'),
        minValue = $fakeViewClass.data('min'),
        maxValue = $fakeViewClass.data('max'),
        duration = $fakeViewClass.data('duration');

    function randomInRange(start, end) {
        var value = Math.floor(Math.random() * (end - start + 1) + start);
        $fakeViewClass.text(value);
    }

    if (minValue !== undefined && maxValue !== undefined) {
        randomInRange(minValue, maxValue);
        setInterval(function() {
            randomInRange(minValue, maxValue);
        }, duration);
    }

})();

// Product-suggest
theme.productSuggest = (function() {
    var $productSuggestClass = $('.product-notification'),
        $closeButtonClass = $('.close-notifi'),
        duration = $productSuggestClass.data('time') || 0,
        productSuggestCookie = 'cookieSuggest';

    function SomeonePurchased() {
        if ($.cookie(productSuggestCookie) == 'closed') {
            $productSuggestClass.remove();
        }
        $closeButtonClass.on('click', function() {
            $productSuggestClass.remove();
            $.cookie(productSuggestCookie, 'closed', { expires: 1, path: '/' });
        });

        function toggleSomething() {
            if ($productSuggestClass.hasClass('active')) {
                $productSuggestClass.removeClass('active')
            } else {
                var arrayProducts = $('.data-product'),
                    randomProduct = Math.floor(Math.random() * arrayProducts.length),
                    Object = $(arrayProducts[randomProduct]);

                $productSuggestClass.addClass('active');
                $productSuggestClass.find('.product-image').attr('href', Object.data('url')).find('img').attr('src', Object.data('image'));
                $productSuggestClass.find('.product-name').text(Object.data('title')).attr('href', Object.data('url'));
                $productSuggestClass.find('.time-ago').text(Object.data('time'));
                $productSuggestClass.find('.from-ago').text(Object.data('local'));
            }
        }

        if (duration !== 0) {
            setInterval(toggleSomething, duration);
        }
    }
    SomeonePurchased();
})()


// Stickyheader
theme.stickyHeader = (function() {
    var stickHeaderClass = '.site-header--sticky';
    if ($(stickHeaderClass).length !== 0) {
        $(window).scroll(function() {
            if (window.pageYOffset >= 20) {
                $(stickHeaderClass).addClass('active');
            } else {
                $(stickHeaderClass).removeClass('active');
            }
        });
    }
})()

theme.PhotoSwipe = (function() {
    var initPhotoSwipeFromDOM = function(gallerySelector) {

        // parse slide data (url, title, size ...) from DOM elements 
        // (children of gallerySelector)
        var parseThumbnailElements = function(el) {
            var thumbElements = el.childNodes,
                numNodes = thumbElements.length,
                items = [],
                figureEl,
                linkEl,
                size,
                item;

            for (var i = 0; i < numNodes; i++) {

                figureEl = thumbElements[i]; // <figure> element

                // include only element nodes 
                if (figureEl.nodeType !== 1) {
                    continue;
                }

                linkEl = figureEl.children[0]; // <a> element

                size = linkEl.getAttribute('data-size').split('x');

                // create slide object
                item = {
                    src: linkEl.getAttribute('href'),
                    w: parseInt(size[0], 10),
                    h: parseInt(size[1], 10)
                };



                if (figureEl.children.length > 1) {
                    // <figcaption> content
                    item.title = figureEl.children[1].innerHTML;
                }

                if (linkEl.children.length > 0) {
                    // <img> thumbnail element, retrieving thumbnail url
                    item.msrc = linkEl.children[0].getAttribute('src');
                }

                item.el = figureEl; // save link to element for getThumbBoundsFn
                items.push(item);
            }

            return items;
        };

        // find nearest parent element
        var closest = function closest(el, fn) {
            return el && (fn(el) ? el : closest(el.parentNode, fn));
        };

        // triggers when user clicks on thumbnail
        var onThumbnailsClick = function(e) {
            e = e || window.event;
            e.preventDefault ? e.preventDefault() : e.returnValue = false;

            var eTarget = e.target || e.srcElement;

            // find root element of slide
            var clickedListItem = closest(eTarget, function(el) {
                return (el.tagName && el.tagName.toUpperCase() === 'FIGURE');
            });

            if (!clickedListItem) {
                return;
            }

            // find index of clicked item by looping through all child nodes
            // alternatively, you may define index via data- attribute
            var clickedGallery = clickedListItem.parentNode,
                childNodes = clickedListItem.parentNode.childNodes,
                numChildNodes = childNodes.length,
                nodeIndex = 0,
                index;

            for (var i = 0; i < numChildNodes; i++) {
                if (childNodes[i].nodeType !== 1) {
                    continue;
                }

                if (childNodes[i] === clickedListItem) {
                    index = nodeIndex;
                    break;
                }
                nodeIndex++;
            }



            if (index >= 0) {
                // open PhotoSwipe if valid index found
                openPhotoSwipe(index, clickedGallery);
            }
            return false;
        };

        // parse picture index and gallery index from URL (#&pid=1&gid=2)
        var photoswipeParseHash = function() {
            var hash = window.location.hash.substring(1),
                params = {};

            if (hash.length < 5) {
                return params;
            }

            var vars = hash.split('&');
            for (var i = 0; i < vars.length; i++) {
                if (!vars[i]) {
                    continue;
                }
                var pair = vars[i].split('=');
                if (pair.length < 2) {
                    continue;
                }
                params[pair[0]] = pair[1];
            }

            if (params.gid) {
                params.gid = parseInt(params.gid, 10);
            }

            return params;
        };

        var openPhotoSwipe = function(index, galleryElement, disableAnimation, fromURL) {
            var pswpElement = document.querySelectorAll('.pswp')[0],
                gallery,
                options,
                items;

            items = parseThumbnailElements(galleryElement);

            // define options (if needed)
            options = {
                maxSpreadZoom: 1,
                bgOpacity: 0.7,
                zoomEl: true,
                history: false,
                zoomEl: false,
                pinchToClose: false,
                closeOnScroll: false,
                // define gallery index (for URL)
                galleryUID: galleryElement.getAttribute('data-pswp-uid'),

            };

            // PhotoSwipe opened from URL
            if (fromURL) {
                if (options.galleryPIDs) {
                    // parse real index when custom PIDs are used 
                    // http://photoswipe.com/documentation/faq.html#custom-pid-in-url
                    for (var j = 0; j < items.length; j++) {
                        if (items[j].pid == index) {
                            options.index = j;
                            break;
                        }
                    }
                } else {
                    // in URL indexes start from 1
                    options.index = parseInt(index, 10) - 1;
                }
            } else {
                options.index = parseInt(index, 10);
            }

            // exit if index not found
            if (isNaN(options.index)) {
                return;
            }

            if (disableAnimation) {
                options.showAnimationDuration = 0;
            }

            // Pass data to PhotoSwipe and initialize it
            gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, items, options);
            gallery.init();
        };

        // loop through all gallery elements and bind events
        var galleryElements = document.querySelectorAll(gallerySelector);

        for (var i = 0, l = galleryElements.length; i < l; i++) {
            galleryElements[i].setAttribute('data-pswp-uid', i + 1);
            galleryElements[i].onclick = onThumbnailsClick;
        }

        // Parse URL and open gallery if it contains #&pid=3&gid=1
        var hashData = photoswipeParseHash();
        if (hashData.pid && hashData.gid) {
            openPhotoSwipe(hashData.pid, galleryElements[hashData.gid - 1], true, true);
        }
    };

    // execute above function
    initPhotoSwipeFromDOM('.my-gallery');
})()

theme.ZoomImage = (function() {
    $(window).resize(function() {
        var width = $(window).width();
        if (width > 767) {
            ZoomImage();
        }
    });
    $(window).width(function() {
        var width = $(window).width();
        if (width > 767) {
            ZoomImage();
        }
    });

    function ZoomImage() {
        $(".zoom_image").each(function(arg, el) {
            var image = $(el).find("img");
            $(el).zoom({
                on: 'mouseover',
                url: image.attr("src").replace("small", "big")
            });
        });
    }
})()

theme.activeAccordion = (function() {
    $('.collapse').on('shown.bs.collapse', function() {
        $(this).prev().addClass('active-acc');
    });
    $('.collapse').on('hidden.bs.collapse', function() {
        $(this).prev().removeClass('active-acc');
    });
})()


// Anchor scroll
theme.anchorScroll = (function() {
    $(document).on('click', 'a[href^="#"]', function(event) {
        event.preventDefault();
        var disableAnchor = $(this).hasClass('disabled-anchor');
        if (!disableAnchor) {
            $('html, body').animate({
                scrollTop: $($.attr(this, 'href')).offset().top
            }, 500);
        }
    });
})()

// Product-recently-viewed
theme.productRecentlyViewed = (function() {
    var $viewedElement = $('.js-recently-view'),
        $viewButton = $('.js-recently-view-button'),
        $content = $('.js-recently-view-content'),
        productHandle = $viewedElement.data('handle') || '',
        limit = $viewButton.data('limit') || 0,
        arrayProduct = JSON.parse(localStorage.getItem('localRecentlyViewed')) || [],
        lastProduct = arrayProduct[arrayProduct.length - 1] || '',
        isAdded = $.inArray(productHandle, arrayProduct) !== -1 ? true : false;

    function processViewed() {
        if (productHandle !== '') {
            //process last product
            if (lastProduct === productHandle && arrayProduct.length > 1) {
                lastProduct = arrayProduct[arrayProduct.length - 2]
            }

            //move current product to last of array
            if (isAdded) {
                arrayProduct.splice(arrayProduct.indexOf(productHandle), 1);
            }
            arrayProduct.push(productHandle);
            //remove first item if limit
            if (arrayProduct.length > limit) {
                arrayProduct.shift()
            }
            localStorage.setItem('localRecentlyViewed', JSON.stringify(arrayProduct));
        }
    }

    function generatorProduct() {
        $content.html('');
        if (arrayProduct.length > 0) {
            //array
            for (var i = 0; i < arrayProduct.length; i++) {
                var productHandle = arrayProduct[i];
                Shopify.getProduct(productHandle, function(product) {
                    var htmlProduct = '';
                    var productPrice = product.price_varies ? 'from ' + theme.Currency.formatMoney(product.price_min, theme.moneyFormat) : theme.Currency.formatMoney(product.price, theme.moneyFormat);
                    var productComparePrice = product.compare_at_price_min !== 0 ? theme.Currency.formatMoney(product.compare_at_price_min, theme.moneyFormat) : '';
                    htmlProduct += '<div class="col-12 col-lg-4 js-viewed-item mb-4">';
                    htmlProduct += '	<div class="border p-3 rounded media d-flex ">';
                    htmlProduct += '	<a class="mr-3 col-4 p-0" href="' + product.url + '">';
                    htmlProduct += '		<img src="' + product.featured_image + '"/>';
                    htmlProduct += '	</a>';
                    htmlProduct += '	<div class="media-body text-left">';
                    htmlProduct += '		<h4 class="mb-2 mt-2"><a href="' + product.url + '">' + product.title + '</a></h5>';
                    htmlProduct += '	<span> ' + productPrice + '</span>';
                    htmlProduct += '	<s>' + productComparePrice + '</s>';
                    htmlProduct += '	</div>';
                    htmlProduct += '	</div>';
                    htmlProduct += '</div>';
                    $content.append(htmlProduct);
                    theme.updateCurrencies();
                });
            }

            //last product
            Shopify.getProduct(lastProduct, function(product) {
                $viewButton.css('background-image', 'url(' + product.featured_image + ')').addClass('active');
            })
        }
    }

    processViewed();
    generatorProduct();

})()

// Notice when soldout
theme.alert = (function() {
    function createAlert(title, mess, time, type) {
        var aTitle = title || '',
            aTime = time || 2000,
            aMessage = mess || '',
            aClass = type || 'default';
        $.growl({
            title: aTitle,
            message: aMessage,
            duration: aTime,
            style: aClass,
            size: 'large'
        });
    }

    return {
        new: createAlert
    }
})()

// Notice when soldout
theme.noticeSoldout = (function() {
    var $soldoutWrapFormClass = $('.js-contact-soldout'),
        $textClass = $('.js-notify-text'),
        $soldoutValueId = $('#ContactProduct');

    function noticeSoldout(variant) {
        $soldoutWrapFormClass.find('.form-success').remove()
        if (variant.available) {
            $textClass.find('span').text('');
            $soldoutWrapFormClass.addClass('hide');
        } else {
            $textClass.find('span').text(': ' + variant.name);
            $soldoutWrapFormClass.removeClass('hide');
            $soldoutValueId.val(variant.name).attr('value', variant.name);
        }
    }
    return {
        init: noticeSoldout
    }
})()

// Sticky cart
theme.stickyCart = (function() {
    var $anchor = $('#js-anchor-sticky-cart'),
        $stCart = $('.sticky-cart-wr'),
        $close = $('#js-sticky-close'),
        disableStCart = localStorage.getItem('localDisableStCart') || '';
    if (disableStCart !== '') {
        $stCart.addClass('disable');
    }
    $close.on('click', function() {
        var isDisable = disableStCart !== '';
        if (isDisable) {
            localStorage.setItem('localDisableStCart', '');
        } else {
            localStorage.setItem('localDisableStCart', 'true');
        }
        $stCart.toggleClass('disable');
    })
    if ($anchor.length) {
        $(window).on('scroll', function() {
            var hT = $anchor.offset().top,
                hH = $anchor.outerHeight(),
                wH = $(window).height(),
                wS = $(this).scrollTop();
            if (wS > (hT + hH - wH)) {
                $stCart.addClass('active');
            } else {
                $stCart.removeClass('active');
            }
        });
    }

})()

//Fix reload safari
window.addEventListener("pageshow", function(evt) {
    if (evt.persisted) {
        setTimeout(function() {
            window.location.reload();
        }, 10);
    }
}, false);

// Back to top
theme.backToTop = (function() {
    var backtotopClass = $('.js-back-to-top');
    $(window).scroll(function() {
        if ($(this).scrollTop() > 300) {
            backtotopClass.fadeIn('slow');
        } else {
            backtotopClass.fadeOut('slow');
        }
    });
    backtotopClass.on('click', function() {
        $('body,html').animate({ scrollTop: 0 }, 800);
    });
})()


// Tooltip
theme.tooltip = (function() {
    var selector = '[data-toggle="tooltip"],[data-tooltip="true"]';

    function loadTooltip() {
        $(selector).tooltip(); //Bootstrap 4
    };
    $(document).on('click', selector, function() {
        $(this).tooltip('hide');
    });
    loadTooltip();
    return {
        load: loadTooltip
    }
})()

//Collections style 2
theme.Bgcollection = (function() {
    // init Isotope
    function Bgcollection(container) {
        var $container = this.$container = $(container);
        var sectionId = $container.attr('data-section-id');
        var wrapper = this.wrapper = '.bgcollection-wrapper';
        var slider = this.slider = '#Bgcollection-' + sectionId;
        var $slider = $(slider, wrapper);
        $(".colgrid__bg--full[data-index='1']").addClass('active');
        $('.colgrid .colgrid__box').each(function() {
            var index = $(this).attr("data-index");
            $(this).hover(
                function() {
                    $(".colgrid__bg--full[data-index='" + index + "']").addClass('active');
                },
                function() {
                    $(".colgrid__bg--full[data-index='" + index + "']").removeClass('active');
                }
            );
        });
    }

    return Bgcollection;
})();


//Sidebar
theme.sidebar = (function() {
    var togglebutton = '.js-toggle-filter',
        $sidebar = $('.js-sidebar');
    $(document).on('click', togglebutton, function() {
        $sidebar.toggleClass('active');
        $(this).toggleClass('active');
    })
})()

// Ajax filter in collection page
theme.ajaxFilter = (function() {
    var ajaxContent = '#js-product-ajax',
        ajaxSortBy = '#js-sortby',
        ajaxFillter = '#js-fillter',
        ajaxCollectionTitle = '.js-collection-title',
        pageTitle = $(document).find("title").text(),
        jsLoading = '#js-loading';

    var apollo = {
        init: function() {
            this.initFilter();
        },
        showLoading: function() {
            $(jsLoading).show();
        },
        hideLoading: function() {
            $('body,html').animate({
                scrollTop: $('#MainContent').offset().top - 150
            }, 600);
            setTimeout(function() {
                $(jsLoading).hide(); //delay 500ms for better UX
            }, 500);

        },
        initFilter: function() {
            apollo.filterParams();
            apollo.filterSortby();
            apollo.sidebarMapTagEvents();
            apollo.filterMapSorting();
            apollo.filterMapPaging();
        },
        filterParams: function() {
            Shopify.queryParams = {};
            if (location.search.length) {
                for (var aKeyValue, i = 0, aCouples = location.search.substr(1).split('&'); i < aCouples.length; i++) {
                    aKeyValue = aCouples[i].split('=');
                    if (aKeyValue.length > 1) {
                        Shopify.queryParams[decodeURIComponent(aKeyValue[0])] = decodeURIComponent(aKeyValue[1]);
                    }
                }
            }
        },
        filterSortby: function() {
            if (Shopify.queryParams.sort_by) {
                var sortby = Shopify.queryParams.sort_by;
                $(ajaxSortBy).val(sortby);
            }
        },
        filterCreateUrl: function(baseLink) {
            var newQuery = $.param(Shopify.queryParams).replace(/%2B/g, '+');
            if (baseLink) {
                if (newQuery != "") {
                    return baseLink + "?" + newQuery;
                } else {
                    return baseLink;
                }
            }
            return location.pathname + "?" + newQuery;
        },
        filterMapData: function(data) {
            // 1. update product grid
            $(ajaxContent).html($(ajaxContent, data.responseText).html());
            // 2. update left filter
            $(ajaxFillter).html($(ajaxFillter, data.responseText).html());
            // 3. update collection title
            $(ajaxCollectionTitle).html($(ajaxCollectionTitle, data.responseText).html());
        },
        filterAjaxClick: function(baseLink) {
            delete Shopify.queryParams.page;
            var newurl = apollo.filterCreateUrl(baseLink);
            History.pushState({
                param: Shopify.queryParams
            }, pageTitle, newurl);
            apollo.filterGetContent(newurl);
        },
        filterGetContent: function(newurl) {
            $.ajax({
                type: 'GET',
                url: newurl,
                data: {},
                beforeSend: function() {
                    apollo.showLoading();
                },
                complete: function(data) {
                    apollo.filterMapData(data);
                    theme.wishlist.load();
                    theme.compare.load();
                    theme.countdown.load();
                    theme.priceRange.load();
                    theme.tooltip.load();
                    theme.collectionView.triggerView();
                    theme.swatchCard2.load();
                    theme.infiniteScroll.load();
                    apollo.hideLoading();
                },
                error: function(xhr, text) {
                    apollo.hideLoading();
                    alert($.parseJSON(xhr.responseText).description);
                }
            });
        },
        sidebarMapTagEvents: function() {
            $(document).on('click', '.advanced-filter a', function(event) {
                event.preventDefault();
                $('.tooltip').removeClass('show');
                var currentTags = [];
                if (Shopify.queryParams.constraint) {
                    currentTags = Shopify.queryParams.constraint.split('+');
                }
                if (!$(this).parent().hasClass("active-filter")) {
                    var otherTag = $(this).parents('.catalog_filter_ul').find("li.active-filter");
                    if (otherTag.length > 0) {
                        var tagName = otherTag.data("handle");
                        if (tagName) {
                            var tagPos = currentTags.indexOf(tagName);
                            if (tagPos >= 0) {
                                currentTags.splice(tagPos, 1);
                            }
                        }
                    }
                }
                var dataHandle = $(this).parent().data("handle");
                if (dataHandle) {
                    var tagPos = currentTags.indexOf(dataHandle);
                    if (tagPos >= 0) {
                        currentTags.splice(tagPos, 1);
                    } else {
                        currentTags.push(dataHandle);
                    }
                }
                if (currentTags.length) {
                    Shopify.queryParams.constraint = currentTags.join('+');
                } else {
                    delete Shopify.queryParams.constraint;
                }
                apollo.filterAjaxClick();
            });
            $(document).on('click', '.advanced-filter .icon', function() {
                $(this).parent('.advanced-filter').find('a').trigger("click");
            });
        },
        filterMapSorting: function() {
            $(document).on('change', ajaxSortBy, function() {
                Shopify.queryParams.sort_by = $(this).val();
                apollo.filterAjaxClick();
            })
        },
        filterMapPaging: function() {
            $(document).on('click', '.js-pagination a', function() {
                event.preventDefault();
                var linkPage = $(this).attr("href").match(/page=\d+/g);
                if (linkPage) {
                    Shopify.queryParams.page = parseInt(linkPage[0].match(/\d+/g));
                    if (Shopify.queryParams.page) {
                        var newurl = apollo.filterCreateUrl();
                        History.pushState({
                            param: Shopify.queryParams
                        }, pageTitle, newurl);
                        apollo.filterGetContent(newurl);
                    }
                }
            });
        }
    }

    if ($(".template-collection")) {
        History.Adapter.bind(window, 'statechange', function() {
            var State = History.getState();
            apollo.filterParams();
        });
    }
    apollo.init();

})();
$(theme.init);r image = images[i];
            this.loadImage(this.getSizedImageUrl(image, size));
        }
    }

    /**
     * Loads and caches an image in the browsers cache.
     * @param {string} path - An image url
     */
    function loadImage(path) {
        new Image().src = path;
    }

    /**
     * Swaps the src of an image for another OR returns the imageURL to the callback function
     * @param image
     * @param element
     * @param callback
     */
    function switchImage(image, element, callback) {
        var size = this.imageSize(element.src);
        var imageUrl = this.getSizedImageUrl(image.src, size);

        if (callback) {
            callback(imageUrl, image, element); // eslint-disable-line callback-return
        } else {
            element.src = imageUrl;
        }
    }

    /**
     * +++ Useful
     * Find the Shopify image attribute size
     *
     * @param {string} src
     * @returns {null}
     */
    function imageSize(src) {
        src = src || '';

        var match = src.match(
            /.+_((?:pico|icon|thumb|small|compact|medium|large|grande)|\d{1,4}x\d{0,4}|x\d{1,4})[_\\.@]/
        );

        if (match === null) {
            return null;
        } else {
            return match[1];
        }
    }

    /**
     * +++ Useful
     * Adds a Shopify size attribute to a URL
     *
     * @param src
     * @param size
     * @returns {*}
     */
    function getSizedImageUrl(src, size) {
        if (size === null) {
            return src;
        }

        if (size === 'master') {
            return this.removeProtocol(src);
        }

        var match = src.match(
            /\.(jpg|jpeg|gif|png|bmp|bitmap|tiff|tif)(\?v=\d+)?$/i
        );

        if (match !== null) {
            var prefix = src.split(match[0]);
            var suffix = match[0];

            return this.removeProtocol(prefix[0] + '_' + size + suffix);
        }

        return null;
    }

    function removeProtocol(path) {
        return path.replace(/http(s)?:/, '');
    }

    return {
        preload: preload,
        loadImage: loadImage,
        switchImage: switchImage,
        imageSize: imageSize,
        getSizedImageUrl: getSizedImageUrl,
        removeProtocol: removeProtocol
    };
})();

/**
 * Variant Selection scripts
 * ------------------------------------------------------------------------------
 *
 * Handles change events from the variant inputs in any `cart/add` forms that may
 * exist.  Also updates the master select and triggers updates when the variants
 * price or image changes.
 *
 * @namespace variants
 */

slate.Variants = (function() {
    /**
     * Variant constructor
     *
     * @param {object} options - Settings from `product.js`
     */
    function Variants(options) {
        this.$container = options.$container;
        this.product = options.product;
        this.singleOptionSelector = options.singleOptionSelector;
        this.originalSelectorId = options.originalSelectorId;
        this.enableHistoryState = options.enableHistoryState;
        this.currentVariant = this._getVariantFromOptions();

        $(this.singleOptionSelector, this.$container).on(
            'change',
            this._onSelectChange.bind(this)
        );
    }

    Variants.prototype = _.assignIn({}, Variants.prototype, {
        /**
         * Get the currently selected options from add-to-cart form. Works with all
         * form input elements.
         *
         * @return {array} options - Values of currently selected variants
         */
        _getCurrentOptions: function() {
            var currentOptions = _.map(
                $(this.singleOptionSelector, this.$container),
                function(element) {
                    var $element = $(element);
                    var type = $element.attr('type');
                    var currentOption = {};

                    if (type === 'radio' || type === 'checkbox') {
                        if ($element[0].checked) {
                            currentOption.value = $element.val();
                            currentOption.index = $element.data('index');

                            return currentOption;
                        } else {
                            return false;
                        }
                    } else {
                        currentOption.value = $element.val();
                        currentOption.index = $element.data('index');

                        return currentOption;
                    }
                }
            );

            // remove any unchecked input values if using radio buttons or checkboxes
            currentOptions = _.compact(currentOptions);

            return currentOptions;
        },

        /**
         * Find variant based on selected values.
         *
         * @param  {array} selectedValues - Values of variant inputs
         * @return {object || undefined} found - Variant object from product.variants
         */
        _getVariantFromOptions: function() {
            var selectedValues = this._getCurrentOptions();
            var variants = this.product.variants;

            var found = _.find(variants, function(variant) {
                return selectedValues.every(function(values) {
                    return _.isEqual(variant[values.index], values.value);
                });
            });

            return found;
        },

        /**
         * Event handler for when a variant input changes.
         */
        _onSelectChange: function() {
            var variant = this._getVariantFromOptions();

            this.$container.trigger({
                type: 'variantChange',
                variant: variant
            });

            if (!variant) {
                return;
            }

            this._updateMasterSelect(variant);
            this._updateImages(variant);
            this._updatePrice(variant);
            this._updateSKU(variant);
            this.currentVariant = variant;

            if (this.enableHistoryState) {
                this._updateHistoryState(variant);
            }
        },

        /**
         * Trigger event when variant image changes
         *
         * @param  {object} variant - Currently selected variant
         * @return {event}  variantImageChange
         */
        _updateImages: function(variant) {
            var variantImage = variant.featured_image || {};
            var currentVariantImage = this.currentVariant.featured_image || {};

            if (!variant.featured_image ||
                variantImage.src === currentVariantImage.src
            ) {
                return;
            }

            this.$container.trigger({
                type: 'variantImageChange',
                variant: variant
            });
        },

        /**
         * Trigger event when variant price changes.
         *
         * @param  {object} variant - Currently selected variant
         * @return {event} variantPriceChange
         */
        _updatePrice: function(variant) {
            if (
                variant.price === this.currentVariant.price &&
                variant.compare_at_price === this.currentVariant.compare_at_price
            ) {
                return;
            }

            this.$container.trigger({
                type: 'variantPriceChange',
                variant: variant
            });
        },

        /**
         * Trigger event when variant sku changes.
         *
         * @param  {object} variant - Currently selected variant
         * @return {event} variantSKUChange
         */
        _updateSKU: function(variant) {
            if (variant.sku === this.currentVariant.sku) {
                return;
            }

            this.$container.trigger({
                type: 'variantSKUChange',
                variant: variant
            });
        },

        /**
         * Update history state for product deeplinking
         *
         * @param  {variant} variant - Currently selected variant
         * @return {k}         [description]
         */
        _updateHistoryState: function(variant) {
            if (!history.replaceState || !variant) {
                return;
            }

            var newurl =
                window.location.protocol +
                '//' +
                window.location.host +
                window.location.pathname +
                '?variant=' +
                variant.id;
            window.history.replaceState({ path: newurl }, '', newurl);
        },

        /**
         * Update hidden master select of variant change
         *
         * @param  {variant} variant - Currently selected variant
         */
        _updateMasterSelect: function(variant) {
            $(this.originalSelectorId, this.$container).val(variant.id);
        }
    });

    return Variants;
})();


/*================ MODULES ================*/
window.Drawers = (function() {
    var Drawer = function(id, position, options) {
        var defaults = {
            close: '.js-drawer-close',
            open: '.js-drawer-open-' + position,
            openClass: 'js-drawer-open',
            dirOpenClass: 'js-drawer-open-' + position
        };

        this.nodes = {
            $parent: $('body, html'),
            $page: $('.page-element'),
            $moved: $('.is-moved-by-drawer')
        };

        this.config = $.extend(defaults, options);
        this.position = position;

        this.$drawer = $('#' + id);
        this.$open = $(this.config.open);

        if (!this.$drawer.length) {
            return false;
        }

        this.drawerIsOpen = false;
        this.init();
    };

    Drawer.prototype.init = function() {
        this.$open.attr('aria-expanded', 'false');
        this.$open.on('click', $.proxy(this.open, this));
        this.$drawer.find(this.config.close).on('click', $.proxy(this.close, this));
    };

    Drawer.prototype.open = function(evt) {
        // Keep track if drawer was opened from a click, or called by another function
        var externalCall = false;

        // don't open an opened drawer
        if (this.drawerIsOpen) {
            return;
        }

        this.$open.addClass(this.config.openClass);

        // Prevent following href if link is clicked
        if (evt) {
            evt.preventDefault();
        } else {
            externalCall = true;
        }

        // Without this, the drawer opens, the click event bubbles up to $nodes.page
        // which closes the drawer.
        if (evt && evt.stopPropagation) {
            evt.stopPropagation();
            // save the source of the click, we'll focus to this on close
            this.$activeSource = $(evt.currentTarget);
        }

        if (this.drawerIsOpen && !externalCall) {
            return this.close();
        }

        // Add is-transitioning class to moved elements on open so drawer can have
        // transition for close animation
        this.nodes.$moved.addClass('is-transitioning');
        this.$drawer.prepareTransition();

        this.nodes.$parent.addClass(
            this.config.openClass + ' ' + this.config.dirOpenClass
        );
        this.drawerIsOpen = true;

        // Set focus on drawer
        slate.a11y.trapFocus({
            $container: this.$drawer,
            namespace: 'drawer_focus'
        });

        // Run function when draw opens if set
        if (
            this.config.onDrawerOpen &&
            typeof this.config.onDrawerOpen === 'function'
        ) {
            if (!externalCall) {
                this.config.onDrawerOpen();
            }
        }

        if (this.$activeSource && this.$activeSource.attr('aria-expanded')) {
            this.$activeSource.attr('aria-expanded', 'true');
        }

        this.bindEvents();
    };

    Drawer.prototype.close = function() {
        // don't close a closed drawer
        if (!this.drawerIsOpen) {
            return;
        }

        this.$open.removeClass(this.config.openClass);

        // deselect any focused form elements
        $(document.activeElement).trigger('blur');

        // Ensure closing transition is applied to moved elements, like the nav
        this.nodes.$moved.prepareTransition({ disableExisting: true });
        this.$drawer.prepareTransition({ disableExisting: true });

        this.nodes.$parent.removeClass(
            this.config.dirOpenClass + ' ' + this.config.openClass
        );

        this.drawerIsOpen = false;

        // Remove focus on drawer
        slate.a11y.removeTrapFocus({
            $container: this.$drawer,
            namespace: 'drawer_focus'
        });

        if (this.$activeSource && this.$activeSource.attr('aria-expanded')) {
            this.$activeSource.attr('aria-expanded', 'false');
        }

        this.unbindEvents();
    };

    Drawer.prototype.bindEvents = function() {
        // Lock scrolling on mobile
        this.nodes.$page.on('touchmove.drawer', function() {
            return false;
        });

        // Clicking out of drawer closes it
        this.nodes.$page.on(
            'click.drawer',
            $.proxy(function() {
                this.close();
                return false;
            }, this)
        );

        // Pressing escape closes drawer
        this.nodes.$parent.on(
            'keyup.drawer',
            $.proxy(function(evt) {
                if (evt.keyCode === 27) {
                    this.close();
                }
            }, this)
        );
    };

    Drawer.prototype.unbindEvents = function() {
        this.nodes.$page.off('.drawer');
        this.nodes.$parent.off('.drawer');
    };

    return Drawer;
})();

window.Modals = (function() {
    var Modal = function(id, name, options) {
        var defaults = {
            close: '.js-modal-close',
            open: '.js-modal-open-' + name,
            openClass: 'modal--is-active'
        };

        this.$modal = $('#' + id);

        if (!this.$modal.length) {
            return false;
        }

        this.nodes = {
            $body: $('body')
        };

        this.config = $.extend(defaults, options);

        this.modalIsOpen = false;
        this.$focusOnOpen = this.config.focusOnOpen ?
            $(this.config.focusOnOpen) :
            this.$modal;
        this.init();
    };

    Modal.prototype.init = function() {
        var $openBtn = $(this.config.open);

        // Add aria controls
        $openBtn.attr('aria-expanded', 'false');

        $(this.config.open).on('click', $.proxy(this.open, this));
        this.$modal.find(this.config.close).on('click', $.proxy(this.close, this));
    };

    Modal.prototype.open = function(evt) {
        // Keep track if modal was opened from a click, or called by another function
        var externalCall = false;

        // don't open an opened modal
        if (this.modalIsOpen) {
            return;
        }

        // Prevent following href if link is clicked
        if (evt) {
            evt.preventDefault();
        } else {
            externalCall = true;
        }

        // Without this, the modal opens, the click event bubbles up to $nodes.page
        // which closes the modal.
        if (evt && evt.stopPropagation) {
            evt.stopPropagation();
            // save the source of the click, we'll focus to this on close
            this.$activeSource = $(evt.currentTarget);
        }

        if (this.modalIsOpen && !externalCall) {
            return this.close();
        }

        this.$modal.prepareTransition().addClass(this.config.openClass);
        this.nodes.$body.addClass(this.config.openClass);

        this.modalIsOpen = true;

        // Set focus on modal
        slate.a11y.trapFocus({
            $container: this.$modal,
            namespace: 'modal_focus',
            $elementToFocus: this.$focusOnOpen
        });

        if (this.$activeSource && this.$activeSource.attr('aria-expanded')) {
            this.$activeSource.attr('aria-expanded', 'true');
        }

        this.bindEvents();
    };

    Modal.prototype.close = function() {
        // don't close a closed modal
        if (!this.modalIsOpen) {
            return;
        }

        // deselect any focused form elements
        $(document.activeElement).trigger('blur');

        this.$modal.prepareTransition().removeClass(this.config.openClass);
        this.nodes.$body.removeClass(this.config.openClass);

        this.modalIsOpen = false;

        // Remove focus on modal
        slate.a11y.removeTrapFocus({
            $container: this.$modal,
            namespace: 'modal_focus'
        });

        if (this.$activeSource && this.$activeSource.attr('aria-expanded')) {
            this.$activeSource.attr('aria-expanded', 'false').focus();
        }

        this.unbindEvents();
    };

    Modal.prototype.bindEvents = function() {
        // Pressing escape closes modal
        this.nodes.$body.on(
            'keyup.modal',
            $.proxy(function(evt) {
                if (evt.keyCode === 27) {
                    this.close();
                }
            }, this)
        );
    };

    Modal.prototype.unbindEvents = function() {
        this.nodes.$body.off('.modal');
    };

    return Modal;
})();

window.QtySelector = (function() {
    var QtySelector = function($el) {
        this.cache = {
            $body: $('body'),
            $subtotal: $('#CartSubtotal'),
            $discountTotal: $('#cartDiscountTotal'),
            $cartTable: $('.cart-table'),
            $cartTemplate: $('#CartProducts')
        };

        this.settings = {
            loadingClass: 'js-qty--is-loading',
            isCartTemplate: this.cache.$body.hasClass('template-cart'),
            // On the cart template, minimum is 0. Elsewhere min is 1
            minQty: this.cache.$body.hasClass('template-cart') ? 0 : 1
        };

        this.$el = $el;
        this.qtyUpdateTimeout;
        this.createInputs();
        this.bindEvents();
    };

    QtySelector.prototype.createInputs = function() {
        var $el = this.$el;

        var data = {
            value: $el.val(),
            key: $el.attr('id'),
            name: $el.attr('name'),
            line: $el.attr('data-line')
        };
        var source = $('#QuantityTemplate').html();
        var template = Handlebars.compile(source);

        this.$wrapper = $(template(data)).insertBefore($el);

        // Remove original number input
        $el.remove();
    };

    QtySelector.prototype.validateAvailability = function(line, quantity) {
        var product = theme.cartObject.items[line - 1]; // 0-based index in API
        var handle = product.handle; // needed for the ajax request
        var id = product.id; // needed to find right variant from ajax results

        var params = {
            type: 'GET',
            url: '/products/' + handle + '.js',
            dataType: 'json',
            success: $.proxy(function(cartProduct) {
                this.validateAvailabilityCallback(line, quantity, id, cartProduct);
            }, this)
        };

        $.ajax(params);
    };

    QtySelector.prototype.validateAvailabilityCallback = function(
        line,
        quantity,
        id,
        product
    ) {
        var quantityIsAvailable = true;

        // This returns all variants of a product.
        // Loop through them to get our desired one.
        for (var i = 0; i < product.variants.length; i++) {
            var variant = product.variants[i];
            if (variant.id === id) {
                break;
            }
        }

        // If the variant tracks inventory and does not sell when sold out
        // we can compare the requested with available quantity
        if (
            variant.inventory_management !== null &&
            variant.inventory_policy === 'deny'
        ) {
            if (variant.inventory_quantity < quantity) {

                // Set quantity to max amount available
                this.$wrapper.find('.js-qty__input').val(variant.inventory_quantity);

                quantityIsAvailable = false;
                this.$wrapper.removeClass(this.settings.loadingClass);
            }
        }

        if (quantityIsAvailable) {
            this.updateItemQuantity(line, quantity);
        }
    };

    QtySelector.prototype.validateQty = function(qty) {
        if (parseFloat(qty) === parseInt(qty, 10) && !isNaN(qty)) {
            // We have a valid number!
        } else {
            // Not a number. Default to 1.
            qty = 1;
        }
        return parseInt(qty, 10);
    };

    QtySelector.prototype.adjustQty = function(evt) {
        var $el = $(evt.currentTarget);
        var $input = $el.siblings('.js-qty__input');
        var qty = this.validateQty($input.val());
        var line = $input.attr('data-line');

        if ($el.hasClass('js-qty__adjust--minus')) {
            qty -= 1;
            if (qty <= this.settings.minQty) {
                qty = this.settings.minQty;
            }
        } else {
            qty += 1;
        }

        if (this.settings.isCartTemplate) {
            $el.parent().addClass(this.settings.loadingClass);
            this.updateCartItemPrice(line, qty);
        } else {
            $input.val(qty);
        }
    };

    QtySelector.prototype.bindEvents = function() {
        this.$wrapper
            .find('.js-qty__adjust')
            .on('click', $.proxy(this.adjustQty, this));

        // Select input text on click
        this.$wrapper.on('click', '.js-qty__input', function() {
            this.setSelectionRange(0, this.value.length);
        });

        // If the quantity changes on the cart template, update the price
        if (this.settings.isCartTemplate) {
            this.$wrapper.on(
                'change',
                '.js-qty__input',
                $.proxy(function(evt) {
                    var $input = $(evt.currentTarget);
                    var line = $input.attr('data-line');
                    var qty = this.validateQty($input.val());
                    $input.parent().addClass(this.settings.loadingClass);
                    this.updateCartItemPrice(line, qty);
                }, this)
            );
        }
    };

    QtySelector.prototype.updateCartItemPrice = function(line, qty) {
        // Update cart after short timeout so user doesn't create simultaneous ajax calls
        clearTimeout(this.qtyUpdateTimeout);
        this.qtyUpdateTimeout = setTimeout(
            $.proxy(function() {
                this.validateAvailability(line, qty);
            }, this),
            200
        );
    };

    QtySelector.prototype.updateItemQuantity = function(line, quantity) {
        var params = {
            type: 'POST',
            url: '/cart/change.js',
            data: 'quantity=' + quantity + '&line=' + line,
            dataType: 'json',
            success: $.proxy(function(cart) {
                this.updateCartItemCallback(cart);
            }, this)
        };

        $.ajax(params);
    };

    QtySelector.prototype.updateCartItemCallback = function(cart) {
        // Reload the page to show the empty cart if no items
        if (cart.item_count === 0) {
            location.reload();
            return;
        }

        // Update cart object
        theme.cartObject = cart;

        // Handlebars.js cart layout
        var data = {};
        var items = [];
        var item = {};
        var source = $('#CartProductTemplate').html();
        var template = Handlebars.compile(source);
        var prodImg;

        // Add each item to our handlebars.js data
        $.each(cart.items, function(index, cartItem) {
            /* Hack to get product image thumbnail
             *   - If image is not null
             *     - Remove file extension, add 240x240, and re-add extension
             *     - Create server relative link
             *   - A hard-coded url of no-image
             */

            if (cartItem.image === null) {
                prodImg =
                    '//cdn.shopify.com/s/assets/admin/no-image-medium-cc9732cb976dd349a0df1d39816fbcc7.gif';
            } else {
                prodImg = cartItem.image
                    .replace(/(\.[^.]*)$/, '_240x240$1')
                    .replace('http:', '');
            }

            if (cartItem.properties !== null) {
                $.each(cartItem.properties, function(key, value) {
                    if (key.charAt(0) === '_' || !value) {
                        delete cartItem.properties[key];
                    }
                });
            }

            // Create item's data object and add to 'items' array
            item = {
                key: cartItem.key,
                line: index + 1, // Shopify uses a 1+ index in the API
                url: cartItem.url,
                img: prodImg,
                name: cartItem.product_title,
                variation: cartItem.variant_title,
                properties: cartItem.properties,
                itemQty: cartItem.quantity,
                price: theme.Currency.formatMoney(cartItem.price, theme.moneyFormat),
                vendor: cartItem.vendor,
                linePrice: theme.Currency.formatMoney(
                    cartItem.line_price,
                    theme.moneyFormat
                ),
                originalLinePrice: theme.Currency.formatMoney(
                    cartItem.original_line_price,
                    theme.moneyFormat
                ),
                discounts: cartItem.discounts,
                discountsApplied: cartItem.line_price === cartItem.original_line_price ? false : true
            };

            items.push(item);
            theme.updateCurrencies();
        });

        // Gather all cart data and add to DOM
        data = {
            items: items
        };
        this.cache.$cartTemplate.empty().append(template(data));

        // Create new quantity selectors
        this.cache.$cartTable.find('input[type="number"]').each(function(i, el) {
            new QtySelector($(el));
        });

        // Update the cart subtotal
        this.cache.$subtotal.html(
            theme.Currency.formatMoney(cart.total_price, theme.moneyFormat)
        );

        // Update the cart total discounts
        if (cart.total_discount > 0) {
            this.cache.$discountTotal.html(
                theme.strings.totalCartDiscount.replace(
                    '[savings]',
                    theme.Currency.formatMoney(cart.total_discount, theme.moneyFormat)
                )
            );
        } else {
            this.cache.$discountTotal.empty();
        }

        theme.miniCart.updateElements();
        theme.updateCurrencies();
        // Set focus on cart table
        slate.a11y.pageLinkFocus(this.cache.$cartTable);
    };

    return QtySelector;
})();

/*
  Allow product to be added to cart via ajax with
  custom success and error responses.
*/
window.AjaxCart = (function() {
    var styleCart = $('.js-mini-cart').attr("data-cartmini");
    var cart = function($form) {
        this.cache = {
            $cartIconIndicator: $('.site-header__cart-indicator')
        };

        this.$form = $form;
        this.eventListeners();

        this.showNotice = false;
        if (this.$form.length) {
            this.showNotice = this.$form.hasClass('js-form--notice') ? true : false;
        }
    };

    cart.prototype.eventListeners = function() {
        if (this.$form.length) {
            this.$form.on('submit', $.proxy(this.addItemFromForm, this));
        }
    };

    cart.prototype.addItemFromForm = function(evt) {
        evt.preventDefault();

        var params = {
            type: 'POST',
            url: '/cart/add.js',
            data: this.$form.serialize(),
            dataType: 'json',
            success: $.proxy(function(lineItem) {
                //this.success(lineItem);
                window.location.href = '/cart';
            }, this),
            error: $.proxy(function(XMLHttpRequest, textStatus) {
                this.error(XMLHttpRequest, textStatus);
            }, this)
        };
        $.ajax(params);
    };

    cart.prototype.success = function(item) {
        theme.miniCart.updateElements();
        theme.miniCart.generateCart();
        if (styleCart != 'false') {
            if (this.showNotice) {
                var htmlVariant = item.variant_title !== null ? '<i>(' + item.variant_title + ')</i>' : '';
                var htmlAlert = '<div class="media mt-2 alert--cart"><a class="mr-3" href="/cart"><img class="lazyload" data-src="' + item.image + '"></a><div class="media-body align-self-center"><p class="m-0 font-weight-bold">' + item.product_title + ' x ' + item.quantity + '</p>' + htmlVariant + '<div><div>';
                theme.alert.new(theme.strings.addToCartSuccess, htmlAlert, 3000, 'notice');
            } else {
                theme.crosssell.showPopup(item);
            }
        }
    };

    // Error handling reference from Shopify.onError in api.jquery.js
    cart.prototype.error = function(XMLHttpRequest) {
        var data = JSON.parse(XMLHttpRequest.responseText);

        if (data.message) {
            theme.alert.new('', data.description, 3000, 'warning');
        }
    };

    return cart;
})();

/*================ TEMPLATES ================*/
theme.customerTemplates = (function() {
    function initEventListeners() {
        // Show reset password form
        $('#RecoverPassword').on('click', function(evt) {
            evt.preventDefault();
            toggleRecoverPasswordForm();
        });

        // Hide reset password form
        $('#HideRecoverPasswordLink').on('click', function(evt) {
            evt.preventDefault();
            toggleRecoverPasswordForm();
        });
    }

    /**
     *
     *  Show/Hide recover password form
     *
     */
    function toggleRecoverPasswordForm() {
        $('#RecoverPasswordForm').toggleClass('hide');
        $('#CustomerLoginForm').toggleClass('hide');
    }

    /**
     *
     *  Show reset password success message
     *
     */
    function resetPasswordSuccess() {
        // check if reset password form was successfully submited
        if (!$('.reset-password-success').length) {
            return;
        }

        // show success message
        $('#ResetSuccess').removeClass('hide');
    }

    /**
     *
     *  Show/hide customer address forms
     *
     */
    function customerAddressForm() {
        var $newAddressForm = $('#AddressNewForm');

        if (!$newAddressForm.length) {
            return;
        }

        // Initialize observers on address selectors, defined in shopify_common.js
        if (Shopify) {
            // eslint-disable-next-line no-new
            new Shopify.CountryProvinceSelector(
                'AddressCountryNew',
                'AddressProvinceNew', {
                    hideElement: 'AddressProvinceContainerNew'
                }
            );
        }

        // Initialize each edit form's country/province selector
        $('.address-country-option').each(function() {
            var formId = $(this).data('form-id');
            var countrySelector = 'AddressCountry_' + formId;
            var provinceSelector = 'AddressProvince_' + formId;
            var containerSelector = 'AddressProvinceContainer_' + formId;

            // eslint-disable-next-line no-new
            new Shopify.CountryProvinceSelector(countrySelector, provinceSelector, {
                hideElement: containerSelector
            });
        });

        // Toggle new/edit address forms
        $('.address-new-toggle').on('click', function() {
            $newAddressForm.toggleClass('hide');
        });

        $('.address-edit-toggle').on('click', function() {
            var formId = $(this).data('form-id');
            $('#EditAddress_' + formId).toggleClass('hide');
        });

        $('.address-delete').on('click', function() {
            var $el = $(this);
            var formId = $el.data('form-id');
            var confirmMessage = $el.data('confirm-message');

            // eslint-disable-next-line no-alert
            if (
                confirm(
                    confirmMessage || 'Are you sure you wish to delete this address?'
                )
            ) {
                Shopify.postLink('/account/addresses/' + formId, {
                    parameters: { _method: 'delete' }
                });
            }
        });
    }

    /**
     *
     *  Check URL for reset password hash
     *
     */
    function checkUrlHash() {
        var hash = window.location.hash;

        // Allow deep linking to recover password form
        if (hash === '#recover') {
            toggleRecoverPasswordForm();
        }
    }

    return {
        init: function() {
            checkUrlHash();
            initEventListeners();
            resetPasswordSuccess();
            customerAddressForm();
        }
    };
})();

/*================ SECTIONS ================*/
theme.HeaderSection = (function() {
    function Header() {
        theme.NavDrawer = new window.Drawers('NavDrawer', 'left');
    }

    return Header;
})();

theme.Product = (function() {
    var defaults = {
        smallBreakpoint: 750,
        productThumbIndex: 0,
        productThumbMax: 0,
        ajaxCart: false,
        stockSetting: false
    };

    function Product(container) {
        var $container = (this.$container = $(container));
        var sectionId = $container.attr('data-section-id');

        this.selectors = {
            originalSelectorId: '#ProductSelect-' + sectionId,
            modal: 'ProductModal',
            productZoomImage: '#ProductZoomImg',
            addToCart: '#AddToCart-' + sectionId,
            productPrice: '#ProductPrice-' + sectionId,
            comparePrice: '#ComparePrice-' + sectionId,
            addToCartText: '#AddToCartText-' + sectionId,
            SKU: '.js-variant-sku',
            productImageContainers: '.product__photo-container-' + sectionId,
            productImageWrappers: '.product__photo-wrapper-' + sectionId,
            productThumbContainers: '.product-single__thumbnail-item-' + sectionId,
            productThumbsWrapper: '.product-single__thumbnails-' + sectionId,
            productThumbs: '.product-single__thumbnail-' + sectionId,
            saleTag: '#ProductSaleTag-' + sectionId,
            productStock: '#ProductStock-' + sectionId,
            singleOptionSelector: '.single-option-selector-' + sectionId,
            shopifyPaymentButton: '.shopify-payment-button',
            availability: '.product-single__availability',
            hurrify: '.js-hurrify'
        };

        this.settings = $.extend({}, defaults, {
            sectionId: sectionId,
            ajaxCart: $container.data('ajax'),
            stockSetting: $container.data('stock'),
            enableHistoryState: $container.data('enable-history-state') || false,
            namespace: '.product-' + sectionId
        });

        // Stop parsing if we don't have the product json script tag
        if (!$('#ProductJson-' + sectionId).html()) {
            return;
        }

        this.productSingleObject = JSON.parse(
            $('#ProductJson-' + sectionId).html()
        );
        this.addVariantInfo();

        this.init();
    }

    Product.prototype = _.assignIn({}, Product.prototype, {
        init: function() {
            this._stringOverrides();
            this._initVariants();
            this._productZoomImage();
            this._productThumbSwitch();
            this._productThumbnailSlider();
            this._initQtySelector();

            if (this.settings.ajaxCart) {
                theme.AjaxCart = new window.AjaxCart(
                    $('#AddToCartForm-' + this.settings.sectionId)
                );
            }
        },

        _stringOverrides: function() {
            window.productStrings = window.productStrings || {};
            $.extend(theme.strings, window.productStrings);
        },

        addVariantInfo: function() {
            if (!this.productSingleObject || !this.settings.stockSetting) {
                return;
            }

            var variantInfo = JSON.parse(
                $('#VariantJson-' + this.settings.sectionId).html()
            );

            for (var i = 0; i < variantInfo.length; i++) {
                $.extend(this.productSingleObject.variants[i], variantInfo[i]);
            }
        },

        _initVariants: function() {
            var options = {
                $container: this.$container,
                enableHistoryState: this.settings.enableHistoryState,
                product: this.productSingleObject,
                singleOptionSelector: this.selectors.singleOptionSelector,
                originalSelectorId: this.selectors.originalSelectorId
            };

            // eslint-disable-next-line no-new
            this.variants = new slate.Variants(options);

            this.$container.on(
                'variantChange' + this.settings.namespace,
                this._updateAddToCartBtn.bind(this)
            );
            this.$container.on(
                'variantChange' + this.settings.namespace,
                this._updateStickyCart.bind(this)
            );
            this.$container.on(
                'variantPriceChange' + this.settings.namespace,
                this._updatePrice.bind(this)
            );
            this.$container.on(
                'variantSKUChange' + this.settings.namespace,
                this._updateSKU.bind(this)
            );
            this.$container.on(
                'variantImageChange' + this.settings.namespace,
                this._updateImages.bind(this)
            );
        },

        _updateStock: function(variant) {
            if (!this.settings.stockSetting) return;

            var $stock = $(this.selectors.productStock),
                $hurrify = $(this.selectors.hurrify);

            // If we don't track variant inventory, hide stock
            if (!variant || !variant.inventory_management) {
                $stock.addClass('hide');
                $hurrify.addClass('hide');
                return;
            }

            if (variant.inventory_quantity < 10 && variant.inventory_quantity > 0) {
                $stock
                    .html(
                        theme.strings.stockAvailable.replace(
                            '1',
                            variant.inventory_quantity
                        )
                    )
                    .removeClass('hide');
                $hurrify.removeClass('hide').find('.progress-bar').css('width', variant.inventory_quantity * 10 + '%');
                return;
            }

            if (variant.inventory_quantity <= 0 && variant.incoming) {
                $stock
                    .html(
                        theme.strings.willNotShipUntil.replace(
                            '[date]',
                            variant.next_incoming_date
                        )
                    )
                    .removeClass('hide');
                $hurrify.addClass('hide');
                return;
            }

            // If there's more than 10 available, hide stock
            $stock.addClass('hide');
            $hurrify.addClass('hide');
        },

        _updateIncomingInfo: function(variant) {
            if (!this.settings.stockSetting) return;

            var $stock = $(this.selectors.productStock);

            if (variant.incoming) {
                $stock
                    .html(
                        theme.strings.willBeInStockAfter.replace(
                            '[date]',
                            variant.next_incoming_date
                        )
                    )
                    .removeClass('hide');
                return;
            }

            // If there is no stock incoming, hide stock
            $stock.addClass('hide');
        },

        _updateAddToCartBtn: function(evt) {
            var variant = evt.variant;

            var cache = {
                $addToCart: $(this.selectors.addToCart),
                $addToCartText: $(this.selectors.addToCartText)
            };

            if (variant) {
                // Select a valid variant if available
                theme.noticeSoldout.init(variant);
                if (variant.available) {
                    // We have a valid product variant, so enable the submit button
                    cache.$addToCart.removeClass('btn--sold-out').prop('disabled', false);
                    cache.$addToCartText.html(theme.strings.addToCart);
                    $(this.selectors.shopifyPaymentButton, this.$container).show();
                    // Show how many items are left, if below 10
                    this._updateStock(variant);
                    //update availability - available
                    $(this.selectors.availability).find('span').text(theme.strings.available);
                } else {
                    // Variant is sold out, disable the submit button
                    cache.$addToCart.prop('disabled', true).addClass('btn--sold-out');
                    cache.$addToCartText.html(theme.strings.soldOut);
                    $(this.selectors.shopifyPaymentButton, this.$container).hide();
                    // Update when stock will be available
                    this._updateIncomingInfo(variant);
                    //update availability - soldout
                    $(this.selectors.availability).find('span').text(theme.strings.soldOut);
                }
            } else {
                cache.$addToCart.prop('disabled', true).removeClass('btn--sold-out');
                cache.$addToCartText.html(theme.strings.unavailable);
                //update availability - unavailable
                $(this.selectors.availability).find('span').text(theme.strings.unavailable);
                $(this.selectors.shopifyPaymentButton, this.$container).hide();
                // Hide stock display
                this._updateStock();
            }
        },

        _updatePrice: function(evt) {
            var variant = evt.variant;

            if (variant) {
                $(this.selectors.productPrice).html(
                    theme.Currency.formatMoney(variant.price, theme.moneyFormat)
                );

                // Update and show the product's compare price if necessary
                if (variant.compare_at_price > variant.price) {
                    $(this.selectors.comparePrice)
                        .html(
                            theme.Currency.formatMoney(
                                variant.compare_at_price,
                                theme.moneyFormat
                            )
                        )
                        .removeClass('hide');
                    $(this.selectors.saleTag).removeClass('hide');
                } else {
                    $(this.selectors.comparePrice).addClass('hide');
                    $(this.selectors.saleTag).addClass('hide');
                }

                theme.updateCurrencies();
            } else {
                $(this.selectors.comparePrice).addClass('hide');
            }
        },

        _updateSKU: function(evt) {
            var variant = evt.variant;

            if (variant) {
                $(this.selectors.SKU).html(variant.sku);
            }
        },

        _updateImages: function(evt) {
            var variant = evt.variant;

            if (variant && variant.featured_image) {
                var imageId = variant.featured_image.id;
                this.switchProductImage(imageId);
                this.setActiveThumbnail(imageId);
            }
        },
        _updateStickyCart: function(evt) {
            var variant = evt.variant,
                $stickyPrice = $('#js-sticky-price'),
                $stickyTitle = $('#js-sticky-title'),
                $stickyImage = $('#js-sticky-img'),
                $stickyButton = $('#js-sticky-btn');
            if (variant) {
                //update title
                $stickyTitle.html(' - ' + variant.title);
                //update price
                $stickyPrice.html(theme.Currency.formatMoney(variant.price, theme.moneyFormat));
                //update selectbox
                for (var i = 1; i <= 3; i++) {
                    var option = 'option' + i,
                        $selecBox = '#js-sticky-option-' + i;
                    if (variant[option] !== null) {
                        var valueOption = variant[option];
                        $($selecBox).val(valueOption);
                    }
                }
                //update button cart
                if (variant.available) {
                    $stickyButton.prop('disabled', false).removeClass('btn--sold-out');
                    $stickyButton.html(theme.strings.addToCart);
                } else {
                    $stickyButton.prop('disabled', true).addClass('btn--sold-out');
                    $stickyButton.html(theme.strings.soldOut);
                }
                //update image
                if (variant.featured_image) {
                    $stickyImage.attr('src', theme.Images.getSizedImageUrl(variant.featured_image.src, '200x'));
                }
            } else {
                //update title
                $stickyTitle.html(' - ' + theme.strings.unavailable);
                //update button cart
                $stickyButton.prop('disabled', true).removeClass('btn--sold-out');
                $stickyButton.html(theme.strings.unavailable);
            }
        },

        switchProductImage: function(imageId) {
            var $imageToShow = $(
                this.selectors.productImageContainers +
                "[data-image-id='" +
                imageId +
                "']",
                this.$container
            );
            var $imagesToHide = $(
                this.selectors.productImageContainers +
                ":not([data-image-id='" +
                imageId +
                "'])",
                this.$container
            );
            $imagesToHide.addClass('hide');
            $imageToShow.removeClass('hide');
            //Scroll to active
            topMenuHeight = $('.site-header').outerHeight();
            if (this.settings.sectionId === 'product-template-8') {
                $([document.documentElement, document.body]).animate({
                    scrollTop: $imageToShow.offset().top - topMenuHeight
                }, 500);
            }
        },

        setActiveThumbnail: function(imageId) {
            var $thumbnailToShow = $(
                this.selectors.productThumbContainers +
                "[data-image-id='" +
                imageId +
                "']",
                this.$container
            );
            var $thumbnailsToHide = $(
                this.selectors.productThumbContainers +
                ":not([data-image-id='" +
                imageId +
                "'])",
                this.$container
            );
            $thumbnailsToHide.removeClass('is-active');
            $thumbnailToShow.addClass('is-active');
            $thumbnailToShow.trigger('click');
            var $thumbnails = $(this.selectors.productThumbsWrapper, this.$container);

            // If there is a slick carousel, get the slide index, and position it into view with animation.
            if ($thumbnails.hasClass('slick-initialized')) {
                // eslint-disable-next-line shopify/jquery-dollar-sign-reference
                var currentActiveSlideIndex = $thumbnails.slick('slickCurrentSlide');
                var newActiveSlideIndex = parseInt(
                    $thumbnailToShow.attr('data-slick-index')
                );
                if (currentActiveSlideIndex !== newActiveSlideIndex) {
                    $thumbnails.slick('slickGoTo', newActiveSlideIndex, false);

                }
            }
        },

        _productZoomImage: function() {
            // The zoom image is only used on the product template, so return early
            // even if a featured product section is present.
            if (!$('.product-single ' + this.selectors.productImageContainers).length) {
                return;
            }

            var self = this;

            $(this.selectors.productImageWrappers).on(
                'click' + this.settings.namespace,
                function(evt) {
                    evt.preventDefault();
                    // Empty src before loadig new image to avoid awkward image swap
                    $(self.selectors.productZoomImage)
                        .attr('src', '')
                        .attr('src', $(this).attr('href'));
                }
            );

            this.ProductModal = new window.Modals(
                this.selectors.modal,
                'product-modal'
            );

            // Close modal if clicked, but not if the image is clicked
            this.ProductModal.$modal.on('click' + this.settings.namespace, function(
                evt
            ) {
                if (evt.target.nodeName !== 'IMG') {
                    self.ProductModal.close();
                }
            });
        },

        _productThumbSwitch: function() {
            if (!$(this.selectors.productThumbs).length) {
                return;
            }

            var self = this;

            $(this.selectors.productThumbs).on(
                'click' + this.settings.namespace,
                function(evt) {
                    evt.preventDefault();
                    var imageId = $(this)
                        .parent()
                        .data('image-id');
                    self.setActiveThumbnail(imageId);
                    self.switchProductImage(imageId);
                }
            );
            //trigger hover thumb
            // $(this.selectors.productThumbs).on('click',function(){
            //   $(this).trigger('click');
            // });
        },

        /*
          Thumbnail slider
         */
        _productThumbnailSlider: function() {
            var $productThumbsWrapper = $(this.selectors.productThumbsWrapper);
            var $productThumbs = $(this.selectors.productThumbs);
            if (!$productThumbs.length) {
                return;
            }

            if ($productThumbs.length > 1) {
                $productThumbsWrapper.on(
                    'init' + this.settings.namespace,
                    this._productSwipeInit.bind(this)
                );

                if (this.settings.sectionId === 'product-template-3' || this.settings.sectionId === 'product-template-4') {
                    $productThumbsWrapper.slick({
                        accessibility: false,
                        arrows: true,
                        dots: false,
                        infinite: false,
                        autoplay: false,
                        slidesToShow: 5,
                        slidesToScroll: 5,
                        vertical: true,
                        verticalSwiping: true,
                        responsive: [{
                            breakpoint: 992,
                            settings: {
                                vertical: false,
                                verticalSwiping: false,
                                slidesToShow: 4,
                                slidesToScroll: 4,
                                dots: false,
                            }
                        }]
                    }).css('opacity', '1');
                } else if (this.settings.sectionId === 'product-template-5') {
                    $productThumbsWrapper.slick({
                        accessibility: false,
                        arrows: true,
                        dots: false,
                        infinite: true,
                        autoplay: false,
                        slidesToShow: 2,
                        slidesToScroll: 1,
                        responsive: [{
                            breakpoint: 992,
                            settings: {
                                slidesToShow: 4,
                                slidesToScroll: 4,
                                dots: false,
                            }
                        }]
                    }).css('opacity', '1');
                } else if (this.settings.sectionId === 'product-template-7') {
                    $productThumbsWrapper.slick({
                        accessibility: false,
                        arrows: true,
                        dots: true,
                        infinite: true,
                        autoplay: false,
                        slidesToShow: 1,
                        slidesToScroll: 1,
                        responsive: [{
                            breakpoint: 992,
                            settings: {
                                slidesToShow: 1,
                                slidesToScroll: 1,
                                dots: false,
                                arrows: true,
                            }
                        }]
                    }).css('opacity', '1');
                } else if (this.settings.sectionId === 'product-template-8') {
                    var lastId,
                        topMenu = $(".product-single__thumbnails"),
                        topMenuHeight = $('.site-header').outerHeight() + 20,
                        // All list items
                        menuItems = topMenu.find(".product-single__thumbnail");


                    if ($(window).width() > 767) {
                        menuItems.click(function(e) {
                            var findid = $(this).attr('href');
                            offsetTop = $(findid).offset().top - topMenuHeight + 1;
                            $('html, body').stop().animate({
                                scrollTop: offsetTop
                            }, 200);
                            return false;
                        });
                        // Anchors corresponding to menu items
                        scrollItems = menuItems.map(function() {
                            var item = $($(this).attr('href'));
                            if (item.length) { return item; }
                        });

                        $(window).scroll(function() {
                            // Get container scroll position
                            var fromTop = $(this).scrollTop() + topMenuHeight;
                            // Get id of current scroll item
                            var cur = scrollItems.map(function() {
                                if ($(this).offset().top < fromTop)
                                    return this;
                            });
                            // Get the id of the current element
                            cur = cur[cur.length - 1];
                            var id = cur && cur.length ? cur[0].id : "";

                            if (lastId !== id) {
                                lastId = id;
                                // Set/remove active class
                                menuItems
                                    .parent().removeClass("is-active")
                                    .end().filter("[href='#" + id + "']").parent().addClass("is-active");
                            }
                        });
                    } else {
                        menuItems.click(function(e) {
                            var findid = $(this).attr('href');
                            offsetTop = $(findid).offset().top;
                            $('html, body').stop().animate({
                                scrollTop: offsetTop
                            });
                            return false;
                        });
                    }

                    $productThumbsWrapper.slick({
                        accessibility: false,
                        arrows: true,
                        dots: false,
                        infinite: false,
                        autoplay: false,
                        slidesToShow: 5,
                        slidesToScroll: 1,
                        vertical: true,
                        verticalSwiping: true,
                        responsive: [{
                            breakpoint: 992,
                            settings: {
                                vertical: false,
                                verticalSwiping: false,
                                slidesToShow: 4,
                                slidesToScroll: 4,
                                dots: true,
                            }
                        }]
                    }).css('opacity', '1');
                } else {
                    $productThumbsWrapper.slick({
                        accessibility: false,
                        arrows: true,
                        dots: false,
                        infinite: false,
                        autoplay: false,
                        slidesToShow: 4,
                        slidesToScroll: 4
                    }).css('opacity', '1');
                }

                // Show highlighted thumbnail by repositioning slider
                $productThumbsWrapper.slick(
                    'slickGoTo',
                    $productThumbsWrapper.find('.is-active').attr('data-slick-index'),
                    true
                );
            }
        },

        _productSwipeInit: function(evt, obj) {
            // Slider is initialized. Setup custom swipe events
            this.settings.productThumbIndex = obj.currentSlide;
            this.settings.productThumbMax = obj.slideCount - 1; // we need the 0-based index

            var self = this;

            $(this.selectors.productImageWrappers).on(
                'swipeleft swiperight',
                function(event) {
                    if (event.type === 'swipeleft') {
                        self._goToNextThumbnail();
                    }

                    if (event.type === 'swiperight') {
                        self._goToPrevThumbnail();
                    }

                    // Trigger click on newly requested thumbnail
                    $(
                            '.product-single__thumbnail-item[data-slick-index="' +
                            self.settings.productThumbIndex +
                            '"]'
                        )
                        .find('.product-single__thumbnail')
                        .trigger('click');

                }
            );
        },
        _goToNextThumbnail: function() {
            this.settings.productThumbIndex++;

            if (this.settings.productThumbIndex > this.settings.productThumbMax) {
                this.settings.productThumbIndex = 0;
            }

            $(this.selectors.productThumbsWrapper).slick(
                'slickGoTo',
                this.settings.productThumbIndex,
                true
            );
        },

        _goToPrevThumbnail: function() {
            this.settings.productThumbIndex--;

            if (this.settings.productThumbIndex < 0) {
                this.settings.productThumbIndex = this.settings.productThumbMax;
            }

            $(this.selectors.productThumbsWrapper).slick(
                'slickGoTo',
                this.settings.productThumbIndex,
                true
            );
        },

        _initQtySelector: function() {
            this.$container.find('.product-form__quantity').each(function(i, el) {
                // eslint-disable-next-line no-new
                new QtySelector($(el));
            });
        },

        onUnload: function() {
            $(this.selectors.productImageWrappers).off(this.settings.namespace);
            $(this.selectors.productThumbs).off(this.settings.namespace);
            $(this.selectors.productThumbs).slick('unslick');
            if (this.ProductModal) {
                this.ProductModal.$modal.off(this.settings.namespace);
            }
        }
    });

    return Product;
})();

theme.Slideshow = (function() {
    this.$slideshow = null;
    var classes = {
        slideshow: 'slideshow',
        slickActiveMobile: 'slick-active-mobile',
        controlsHover: 'slideshow__controls--hover',
        isPaused: 'is-paused'
    };

    var selectors = {
        section: '.shopify-section',
        wrapper: '#SlideshowWrapper-',
        slides: '.slideshow__slide',
        textWrapperMobile: '.slideshow__text-wrap--mobile',
        textContentMobile: '.slideshow__text-content--mobile',
        controls: '.slideshow__controls',
        dots: '.slick-dots',
        arrowLeft: '.slideshow__arrow-left',
        arrowRight: '.slideshow__arrow-right'
    };

    function slideshow(el, sectionId) {
        var $slideshow = (this.$slideshow = $(el));
        this.adaptHeight = this.$slideshow.data('adapt-height');
        this.$wrapper = this.$slideshow.closest(selectors.wrapper + sectionId);
        this.$section = this.$wrapper.closest(selectors.section);
        this.$controls = this.$wrapper.find(selectors.controls);
        this.$textWrapperMobile = this.$section.find(selectors.textWrapperMobile);
        this.autorotate = this.$slideshow.data('autorotate');
        var autoplaySpeed = this.$slideshow.data('speed');
        var loadSlideA11yString = this.$slideshow.data('slide-nav-a11y');

        this.settings = {
            rtl: theme.rtl,
            accessibility: true,
            arrows: true,
            dots: true,
            fade: (theme.rtl ? false : true),
            draggable: true,
            touchThreshold: 20,
            autoplay: this.autorotate,
            autoplaySpeed: autoplaySpeed
        };

        this.$slideshow.on('beforeChange', beforeChange.bind(this));
        this.$slideshow.on('init', slideshowA11ySetup.bind(this));

        // Add class to style mobile dots & show the correct text content for the
        // first slide on mobile when the slideshow initialises
        this.$slideshow.on(
            'init',
            function() {
                this.$mobileDots
                    .find('li:first-of-type')
                    .addClass(classes.slickActiveMobile);
                this.showMobileText(0);
            }.bind(this)
        );

        if (this.adaptHeight) {
            this.setSlideshowHeight();
            $(window).resize($.debounce(50, this.setSlideshowHeight.bind(this)));
        }

        this.$slideshow.slick(this.settings);

        // This can't be called when the slick 'init' event fires due to how slick
        // adds a11y features.
        slideshowPostInitA11ySetup.bind(this)();
    }

    function slideshowA11ySetup(event, obj) {
        var $slider = obj.$slider;
        var $list = obj.$list;
        this.$dots = this.$section.find(selectors.dots);
        this.$mobileDots = this.$dots.eq(1);

        // Remove default Slick aria-live attr until slider is focused
        $list.removeAttr('aria-live');

        //     this.$wrapper.on('keyup', keyboardNavigation.bind(this));
        //     this.$controls.on('keyup', keyboardNavigation.bind(this));
        //     this.$textWrapperMobile.on('keyup', keyboardNavigation.bind(this));

        // When an element in the slider is focused
        // pause slideshow and set aria-live.
        this.$wrapper
            .on(
                'focusin',
                function(evt) {
                    if (!this.$wrapper.has(evt.target).length) {
                        return;
                    }

                    $list.attr('aria-live', 'polite');
                    if (this.autorotate) {
                        $slider.slick('slickPause');
                    }
                }.bind(this)
            )
            .on(
                'focusout',
                function(evt) {
                    if (!this.$wrapper.has(evt.target).length) {
                        return;
                    }

                    $list.removeAttr('aria-live');
                }.bind(this)
            );

        // Add arrow key support when focused
        if (this.$dots) {
            this.$dots
                .find('a')
                .each(function() {
                    var $dot = $(this);
                    $dot.on('click keyup', function(evt) {
                        if (
                            evt.type === 'keyup' &&
                            evt.which !== slate.utils.keyboardKeys.ENTER
                        )
                            return;

                        evt.preventDefault();

                        var slideNumber = $(evt.target).data('slide-number');

                        $slider.attr('tabindex', -1).slick('slickGoTo', slideNumber);

                        if (evt.type === 'keyup') {
                            $slider.focus();
                        }
                    });
                })
                .eq(0)
                .attr('aria-current', 'true');
        }

        this.$controls
            .on('focusin', highlightControls.bind(this))
            .on('focusout', unhighlightControls.bind(this));
    }

    function slideshowPostInitA11ySetup() {
        var $slides = this.$slideshow.find(selectors.slides);

        $slides.removeAttr('role').removeAttr('aria-labelledby');
        this.$dots
            .removeAttr('role')
            .find('li')
            .removeAttr('role')
            .removeAttr('aria-selected')
            .each(function() {
                var $dot = $(this);
                var ariaControls = $dot.attr('aria-controls');
                $dot
                    .removeAttr('aria-controls')
                    .find('a')
                    .attr('aria-controls', ariaControls);
            });
    }

    function beforeChange(event, slick, currentSlide, nextSlide) {
        var $dotLinks = this.$dots.find('a');
        var $mobileDotLinks = this.$mobileDots.find('li');

        $dotLinks
            .removeAttr('aria-current')
            .eq(nextSlide)
            .attr('aria-current', 'true');

        $mobileDotLinks
            .removeClass(classes.slickActiveMobile)
            .eq(nextSlide)
            .addClass(classes.slickActiveMobile);
        this.showMobileText(nextSlide);
    }

    //   function keyboardNavigation() {
    //     if (event.keyCode === slate.utils.keyboardKeys.LEFTARROW) {
    //       this.$slideshow.slick('slickPrev');
    //     }
    //     if (event.keyCode === slate.utils.keyboardKeys.RIGHTARROW) {
    //       this.$slideshow.slick('slickNext');
    //     }
    //   }

    function highlightControls() {
        this.$controls.addClass(classes.controlsHover);
    }

    function unhighlightControls() {
        this.$controls.removeClass(classes.controlsHover);
    }

    slideshow.prototype.setSlideshowHeight = function() {
        var minAspectRatio = this.$slideshow.data('min-aspect-ratio');
        this.$slideshow.height($(document).width() / minAspectRatio);
    };

    slideshow.prototype.showMobileText = function(slideIndex) {
        var $allTextContent = this.$textWrapperMobile.find(
            selectors.textContentMobile
        );
        var currentTextContentSelector =
            selectors.textContentMobile + '-' + slideIndex;
        var $currentTextContent = this.$textWrapperMobile.find(
            currentTextContentSelector
        );
        if (!$currentTextContent.length &&
            this.$slideshow.find(selectors.slides).length === 1
        ) {
            this.$textWrapperMobile.hide();
        } else {
            this.$textWrapperMobile.show();
        }
        $allTextContent.hide();
        $currentTextContent.show();
    };

    function getSlideshowId($el) {
        return '#Slideshow-' + $el.data('id');
    }

    return slideshow;
})();

theme.slideshows = {};

theme.SlideshowSection = (function() {
    function SlideshowSection(container) {
        var $container = (this.$container = $(container));
        var sectionId = $container.attr('data-section-id');
        var slideshow = (this.slideshow = '#Slideshow-' + sectionId);

        theme.slideshows[slideshow] = new theme.Slideshow(slideshow, sectionId);
    }

    return SlideshowSection;
})();

theme.SlideshowSection.prototype = _.assignIn({},
    theme.SlideshowSection.prototype, {
        onUnload: function() {
            delete theme.slideshows[this.slideshow];
        },

        onBlockSelect: function(evt) {
            var $slideshow = $(this.slideshow);
            var adaptHeight = $slideshow.data('adapt-height');

            if (adaptHeight) {
                theme.slideshows[this.slideshow].setSlideshowHeight();
            }

            // Ignore the cloned version
            var $slide = $(
                '.slideshow__slide--' + evt.detail.blockId + ':not(.slick-cloned)'
            );
            var slideIndex = $slide.data('slick-index');

            // Go to selected slide, pause auto-rotate
            $slideshow.slick('slickGoTo', slideIndex).slick('slickPause');
        },

        onBlockDeselect: function() {
            // Resume auto-rotate
            $(this.slideshow).slick('slickPlay');
        }
    }
);

theme.slideshows = {};

theme.Cart = (function() {
    var selectors = {
        cartNote: '#CartSpecialInstructions',
        cartQtyInput: '.cart__quantity',
        cartNoCookiesClass: 'cart--no-cookies'
    };

    function Cart(container) {
        var $container = (this.$container = $(container));
        var sectionId = $container.attr('data-section-id');

        theme.cartObject = JSON.parse($('#CartJson-' + sectionId).html());

        this.init($container);
    }

    Cart.prototype = _.assignIn({}, Cart.prototype, {
        init: function($container) {
            this._initQtySelector();
            this._initCartNote();

            if (!this._cookiesEnabled()) {
                $container.addClass(selectors.cartNoCookiesClass);
            }
        },

        _initQtySelector: function() {
            $(selectors.cartQtyInput).each(function(i, el) {
                // eslint-disable-next-line no-new
                new QtySelector($(el));
            });
        },

        _initCartNote: function() {
            if (!$(selectors.cartNote).length) {
                return;
            }

            var $el = $(selectors.cartNote);
            var noteText;
            var params;
            var noteOffset = $el[0].offsetHeight - $el[0].clientHeight;

            // Auto grow the cart note if text fills it up
            $el.on('keyup input', function() {
                $(this)
                    .css('height', 'auto')
                    .css('height', $el[0].scrollHeight + noteOffset);
            });

            // Save the cart note via ajax. A safeguard in case
            // a user decides to leave the page before clicking 'Update Cart'
            $el.on(
                'change',
                $.proxy(function() {
                    noteText = $el.val();
                    params = {
                        type: 'POST',
                        url: '/cart/update.js',
                        data: 'note=' + this._attributeToString(noteText),
                        dataType: 'json'
                    };
                    $.ajax(params);
                }, this)
            );
        },

        _attributeToString: function(attr) {
            if (typeof attr !== 'string') {
                attr = String(attr);
                if (attr === 'undefined') {
                    attr = '';
                }
            }
            return $.trim(attr);
        },

        _cookiesEnabled: function() {
            var cookieEnabled = navigator.cookieEnabled;

            if (!cookieEnabled) {
                document.cookie = 'testcookie';
                cookieEnabled = document.cookie.indexOf('testcookie') !== -1;
            }
            return cookieEnabled;
        }
    });

    return Cart;
})();

// Instagrams
theme.Instagrams = (function() {
    function Instagrams(container) {
        this.$container = $(container).on('init', this._a11y.bind(this));
        //console.log(this.$container);
        this.settings = {
            style: this.$container.data('style'),
            accesstoken: this.$container.data('accesstoken'),
            userid: this.$container.data('userid'),
            limit: this.$container.data('limit'),
            resolution: this.$container.data('resolution'),
            target: this.$container.attr('id'),
            rows: this.$container.data('rows'),

            slidesToShow: this.$container.data('slidestoshow') || 1,
            infinite: this.$container.data('infinite') || false,
            arrows: this.$container.data('arrows') || false,
            draggable: this.$container.data('draggable') || false,
            dots: this.$container.data('dots') || false,
        }
        this.settings.slidesToShow1200 = (this.settings.slidesToShow - 1) > 1 ? (this.settings.slidesToShow - 1) : 1;
        this.settings.slidesToShow992 = (this.settings.slidesToShow - 2) > 1 ? (this.settings.slidesToShow - 2) : 1;
        this.settings.slidesToShow768 = (this.settings.slidesToShow - 3) > 1 ? (this.settings.slidesToShow - 3) : 1;
        this.settings.slidesToShow480 = 2;

        var _self = this;
        var $instagramSelector = $('#' + this.settings.target);
        if (this.settings.style === 'grid') {
            var afterInstagram = function() {} // blank function
        } else if (this.settings.style === 'carousel') {
            var afterInstagram = function() {
                $instagramSelector.slick({
                    slidesToShow: _self.settings.slidesToShow,
                    slidesToScroll: _self.settings.slidesToShow,
                    arrows: _self.settings.arrows,
                    dots: _self.settings.dots,
                    draggable: _self.settings.draggable,
                    infinite: _self.settings.infinite,
                    rows: _self.settings.rows,
                    responsive: [{
                            breakpoint: 1200,
                            settings: {
                                slidesToShow: _self.settings.slidesToShow1200,
                                slidesToScroll: _self.settings.slidesToShow1200,
                            }
                        },
                        {
                            breakpoint: 992,
                            settings: {
                                slidesToShow: _self.settings.slidesToShow992,
                                slidesToScroll: _self.settings.slidesToShow992,
                            }
                        },
                        {
                            breakpoint: 768,
                            settings: {
                                slidesToShow: _self.settings.slidesToShow768,
                                slidesToScroll: _self.settings.slidesToShow768,
                            }
                        },
                        {
                            breakpoint: 480,
                            settings: {
                                slidesToShow: _self.settings.slidesToShow480,
                                slidesToScroll: _self.settings.slidesToShow480,
                            }
                        }
                    ]
                })
            }
        }

        var feed = new Instafeed({
            get: 'user',
            target: this.settings.target,
            userId: this.settings.userid,
            accessToken: this.settings.accesstoken,
            limit: this.settings.limit,
            resolution: this.settings.resolution,
            template: '<div class="col hv-image-brightness"><a class="instagram-item" href="{{link}}" target="_blank" id="{{id}}"><img alt="instagram image" class="transition lazyload" data-src="{{image}}" /></a></div>',
            after: afterInstagram
        });

        feed.run();
    }

    Instagrams.prototype = _.assignIn({}, Instagrams.prototype, {
        _a11y: function(event, obj) {
            var $list = obj.$list;
            var $wrapper = this.$container.parent();

            // Remove default Slick aria-live attr until slider is focused
            $list.removeAttr('aria-live');

            // When an element in the slider is focused set aria-live
            $wrapper.on('focusin', function(evt) {
                if ($wrapper.has(evt.target).length) {
                    $list.attr('aria-live', 'polite');
                }
            });

            // Remove aria-live
            $wrapper.on('focusout', function(evt) {
                if ($wrapper.has(evt.target).length) {
                    $list.removeAttr('aria-live');
                }
            });
        }
    });

    return Instagrams;
})();

// Slick carousel
theme.slickCarousel = (function() {
    function Carousels(container) {
        this.$container = $(container).on('init', this._a11y.bind(this));
        this.settings = {
            rows: this.$container.data('rows') || 1,
            slidesToShow: this.$container.data('slidestoshow') || 1,
            slidesToScroll: this.$container.data('slidestoscroll') || 1,
            infinite: this.$container.data('infinite') || false,
            arrows: this.$container.data('arrows') || false,
            dots: this.$container.data('dots') || false,
            autoplay: this.$container.data('autoplay') || false,
            draggable: this.$container.data('draggable') || false,
            accessibility: this.$container.data('accessibility') || true,
        }
        this.settings.slidesToShow1200 = (this.settings.slidesToShow - 1) > 1 ? (this.settings.slidesToShow - 1) : 1;
        this.settings.slidesToShow992 = (this.settings.slidesToShow - 2) > 1 ? (this.settings.slidesToShow - 2) : 1;
        this.settings.slidesToShow768 = (this.settings.slidesToShow - 3) > 1 ? (this.settings.slidesToShow - 3) : 1;
        this.settings.slidesToShow480 = (this.settings.slidesToShow - 4) > 1 ? (this.settings.slidesToShow - 4) : 1;
        this.settings.slidesToScroll1200 = (this.settings.slidesToScroll - 1) > 1 ? (this.settings.slidesToScroll - 1) : 1;
        this.settings.slidesToScroll992 = (this.settings.slidesToScroll - 2) > 1 ? (this.settings.slidesToScroll - 2) : 1;
        this.settings.slidesToScroll768 = (this.settings.slidesToScroll - 3) > 1 ? (this.settings.slidesToScroll - 3) : 1;
        this.settings.slidesToScroll480 = (this.settings.slidesToScroll - 4) > 1 ? (this.settings.slidesToScroll - 4) : 1;
        this.$container.slick({
            rtl: theme.rtl,
            rows: this.settings.rows,
            slidesToShow: this.settings.slidesToShow,
            slidesToScroll: this.settings.slidesToScroll,
            arrows: this.settings.arrows,
            dots: this.settings.dots,
            autoplay: this.settings.autoplay,
            accessibility: this.settings.accessibility,
            draggable: this.settings.draggable,
            infinite: this.settings.infinite,
            adaptiveHeight: true,
            responsive: [{
                    breakpoint: 1200,
                    settings: {
                        slidesToShow: this.settings.slidesToShow1200,
                        slidesToScroll: this.settings.slidesToScroll1200
                    }
                },
                {
                    breakpoint: 992,
                    settings: {
                        slidesToShow: this.settings.slidesToShow992,
                        slidesToScroll: this.settings.slidesToScroll992
                    }
                },
                {
                    breakpoint: 768,
                    settings: {
                        slidesToShow: this.settings.slidesToShow768,
                        slidesToScroll: this.settings.slidesToScroll768
                    }
                },
                {
                    breakpoint: 480,
                    settings: {
                        slidesToShow: 1,
                        slidesToScroll: this.settings.slidesToScroll480
                    }
                }
            ]
        })
    }

    Carousels.prototype = _.assignIn({}, Carousels.prototype, {
        _a11y: function(event, obj) {
            var $list = obj.$list;
            var $wrapper = this.$container.parent();

            // Remove default Slick aria-live attr until slider is focused
            $list.removeAttr('aria-live');

            // When an element in the slider is focused set aria-live
            $wrapper.on('focusin', function(evt) {
                if ($wrapper.has(evt.target).length) {
                    $list.attr('aria-live', 'polite');
                }
            });

            // Remove aria-live
            $wrapper.on('focusout', function(evt) {
                if ($wrapper.has(evt.target).length) {
                    $list.removeAttr('aria-live');
                }
            });
        },

        _goToSlide: function(slideIndex) {
            this.$container.slick('slickGoTo', slideIndex);
        },

        onUnload: function() {
            delete this.$container;
        },

        onBlockSelect: function(evt) {
            // Ignore the cloned version
            var $slide = $(
                '.carousel__slide-wrapper--' + evt.detail.blockId + ':not(.slick-cloned)'
            );
            var slideIndex = $slide.data('slick-index');

            // Go to selected slide, pause autoplay
            this._goToSlide(slideIndex);

        }
    });

    return Carousels;
})()

// Productlists
theme.Productlists = (function() {
    function Productlists(container) {
        this.$container = $(container).on('init', this._a11y.bind(this));
        this.settings = {
            slidesToShow: this.$container.data('slidestoshow') || 1,
            rows: this.$container.data('rows') || 1,
            arrows: this.$container.data('arrows') || false,
            dots: this.$container.data('dots') || false,
            draggable: this.$container.data('draggable') || false,
            infinite: this.$container.data('infinite') || false,
        }
        this.settings.slidesToShow1200 = (this.settings.slidesToShow - 1) > 1 ? (this.settings.slidesToShow - 1) : 1;
        this.settings.slidesToShow992 = (this.settings.slidesToShow - 2) > 1 ? (this.settings.slidesToShow - 2) : 1;
        this.settings.slidesToShow768 = (this.settings.slidesToShow - 3) > 1 ? (this.settings.slidesToShow - 3) : 1;
        this.settings.slidesToShow480 = 2;
        this.$container.slick({
            rtl: theme.rtl,
            accessibility: true,
            slidesToShow: this.settings.slidesToShow,
            slidesToScroll: this.settings.slidesToShow,
            rows: this.settings.rows,
            arrows: this.settings.arrows,
            dots: this.settings.dots,
            infinite: this.settings.infinite,
            draggable: this.settings.draggable,
            responsive: [{
                    breakpoint: 1200,
                    settings: {
                        slidesToShow: this.settings.slidesToShow1200,
                        slidesToScroll: this.settings.slidesToShow1200
                    }
                },
                {
                    breakpoint: 992,
                    settings: {
                        slidesToShow: this.settings.slidesToShow992,
                        slidesToScroll: this.settings.slidesToShow992
                    }
                },
                {
                    breakpoint: 768,
                    settings: {
                        slidesToShow: this.settings.slidesToShow768,
                        slidesToScroll: this.settings.slidesToShow768
                    }
                },
                {
                    breakpoint: 480,
                    settings: {
                        slidesToShow: this.settings.slidesToShow480,
                        slidesToScroll: this.settings.slidesToShow480
                    }
                }
            ]
        }).css('opacity', '1');
    }

    Productlists.prototype = _.assignIn({}, Productlists.prototype, {
        _a11y: function(event, obj) {
            var $list = obj.$list;
            var $wrapper = this.$container.parent();

            // Remove default Slick aria-live attr until slider is focused
            $list.removeAttr('aria-live');

            // When an element in the slider is focused set aria-live
            $wrapper.on('focusin', function(evt) {
                if ($wrapper.has(evt.target).length) {
                    $list.attr('aria-live', 'polite');
                }
            });

            // Remove aria-live
            $wrapper.on('focusout', function(evt) {
                if ($wrapper.has(evt.target).length) {
                    $list.removeAttr('aria-live');
                }
            });
        },

        _goToSlide: function(slideIndex) {
            this.$container.slick('slickGoTo', slideIndex);
        },

        onUnload: function() {
            delete this.$container;
        }
    });

    return Productlists;
})();

// Producttabs
theme.Producttabs = (function() {
    function Producttabs(container) {
        var _self = this; // avoid conflict
        this.$container = $(container).on('init', this._a11y.bind(this));
        this.slickWrap = '.prdtab-content';
        this.settings = {
            slidesToShow: this.$container.data('slidestoshow') || 1,
            arrows: this.$container.data('arrows') || false,
            rows: this.$container.data('rows') || 1,
            dots: this.$container.data('dots') || false,
            draggable: this.$container.data('draggable') || false,
            infinite: this.$container.data('infinite') || false,
        }
        this.settings.slidesToShow1200 = (this.settings.slidesToShow - 1) > 1 ? (this.settings.slidesToShow - 1) : 1;
        this.settings.slidesToShow992 = (this.settings.slidesToShow - 2) > 1 ? (this.settings.slidesToShow - 2) : 1;
        this.settings.slidesToShow768 = (this.settings.slidesToShow - 3) > 1 ? (this.settings.slidesToShow - 3) : 1;
        this.settings.slidesToShow480 = 2;

        this._initSlick();
        this.$container.find('a[data-toggle="tab"]').on("shown.bs.tab", function(e) {
            _self._unSlick();
            _self._initSlick();
            theme.tooltip.load();
        })
    }

    Producttabs.prototype = _.assignIn({}, Producttabs.prototype, {
        _a11y: function(event, obj) {
            var $list = obj.$list;
            var $wrapper = this.$container.parent();

            // Remove default Slick aria-live attr until slider is focused
            $list.removeAttr('aria-live');

            // When an element in the slider is focused set aria-live
            $wrapper.on('focusin', function(evt) {
                if ($wrapper.has(evt.target).length) {
                    $list.attr('aria-live', 'polite');
                }
            });

            // Remove aria-live
            $wrapper.on('focusout', function(evt) {
                if ($wrapper.has(evt.target).length) {
                    $list.removeAttr('aria-live');
                }
            });
        },

        _getSliderSettings: function() {
            return {
                rtl: theme.rtl,
                accessibility: true,
                slidesToShow: this.settings.slidesToShow,
                slidesToScroll: this.settings.slidesToShow,
                arrows: this.settings.arrows,
                rows: this.settings.rows,
                dots: this.settings.dots,
                infinite: this.settings.infinite,
                draggable: this.settings.draggable,
                responsive: [{
                        breakpoint: 1200,
                        settings: {
                            slidesToShow: this.settings.slidesToShow1200,
                            slidesToScroll: this.settings.slidesToShow1200
                        }
                    },
                    {
                        breakpoint: 992,
                        settings: {
                            slidesToShow: this.settings.slidesToShow992,
                            slidesToScroll: this.settings.slidesToShow992
                        }
                    },
                    {
                        breakpoint: 768,
                        settings: {
                            slidesToShow: this.settings.slidesToShow768,
                            slidesToScroll: this.settings.slidesToShow768
                        }
                    },
                    {
                        breakpoint: 480,
                        settings: {
                            slidesToShow: this.settings.slidesToShow480,
                            slidesToScroll: this.settings.slidesToShow480
                        }
                    }
                ]
            }
        },

        _initSlick: function() {
            this.$container.find(this.slickWrap).slick(this._getSliderSettings()).css('opacity', '1');
        },

        _unSlick: function() {
            this.$container.find(this.slickWrap).slick('unslick');
        },

        onUnload: function() {
            delete this.$container;
        },

        onSelect: function() {
            this._unSlick();
            this._initSlick();
        },

        onBlockSelect: function(evt) {
            var navItem = $('.nav-link-' + evt.detail.blockId);
            navItem.tab('show');
            this._unSlick();
            this._initSlick();
        }
    });

    return Producttabs;
})();

theme.Video = (function() {
    var promiseYoutubeAPI;
    var promiseVimeoAPI;

    var youtube = {
        promiseAPI: function() {
            if (!promiseYoutubeAPI) {
                var tag = document.createElement('script');

                tag.src = 'https://www.youtube.com/iframe_api';
                var firstScriptTag = document.getElementsByTagName('script')[0];
                firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

                promiseYoutubeAPI = $.Deferred(function(defer) {
                    window.onYouTubeIframeAPIReady = defer.resolve;

                    setTimeout(function() {
                        defer.reject('Request for YouTube API timed out after 30 seconds.');
                    }, 30000);
                });
            }

            return promiseYoutubeAPI;
        },
        promisePlayer: function(id, options) {
            return this.promiseAPI().then(function() {
                return $.Deferred(function(defer) {
                    if (typeof window.YT === 'undefined') {
                        defer.reject(
                            "We're sorry, something went wrong. The YouTube API has not loaded correctly."
                        );
                    }

                    /* eslint-disable no-undef */
                    var player = new YT.Player(id, options); // global YT variable injected by YouTube API

                    player.addEventListener('onReady', function() {
                        defer.resolve(player);
                    });

                    setTimeout(function() {
                        defer.reject(
                            'Request for YouTube player has timed out after 30 seconds.'
                        );
                    }, 30000);
                });
            });
        }
    };

    var vimeo = {
        promiseAPI: function() {
            if (!promiseVimeoAPI) {
                promiseVimeoAPI = $.Deferred(function(defer) {
                    var tag = document.createElement('script');
                    tag.src = 'https://player.vimeo.com/api/player.js';
                    tag.onload = tag.onreadystatechange = function() {
                        if (!this.readyState || this.readyState === 'complete') {
                            defer.resolve();
                        }
                    };

                    var firstScriptTag = document.getElementsByTagName('script')[0];
                    firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

                    setTimeout(function() {
                        defer.reject('Request for Vimeo API timed out after 30 seconds.');
                    }, 30000);
                });
            }

            return promiseVimeoAPI;
        },

        promisePlayer: function(id, options) {
            return this.promiseAPI().then(function() {
                return $.Deferred(function(defer) {
                    if (typeof window.Vimeo === 'undefined') {
                        defer.reject(
                            "We're sorry, something went wrong. The Vimeo API has not loaded correctly."
                        );
                    }

                    var player = new window.Vimeo.Player(id, options);

                    setTimeout(function() {
                        defer.reject(
                            'Request for Vimeo player has timed out after 30 seconds.'
                        );
                    }, 30000);

                    player.ready().then(function() {
                        defer.resolve(player);
                    });
                });
            });
        }
    };

    var selectors = {
        loadPlayerButton: '.video-section__load-player-button',
        closePlayerButton: '.video-section__player-close',
        playerContainer: '.video-section__player',
        cover: '.video-section__cover',
        errorMessage: '.video-section__error',
        bodyOverlay: '.video-section__body-overlay',
        body: 'body'
    };
    var classes = {
        playerLoading: 'video-section--loading',
        playerLoaded: 'video-section--loaded',
        playerError: 'video-section--error',
        videoPlaying: 'video-playing'
    };

    function Video(container) {
        this.$container = $(container);
        var sectionId = this.$container.attr('data-section-id');
        this.namespace = '.' + sectionId;
        this.onLoad();
    }

    Video.prototype = _.assignIn({}, Video.prototype, {
        onLoad: function() {
            this.$container
                .on('click', selectors.loadPlayerButton, this._loadPlayer.bind(this))
                .on('click', selectors.closePlayerButton, this._closePlayer.bind(this))
                .on('click', selectors.bodyOverlay, this._closePlayer.bind(this));
        },

        _loadPlayer: function() {
            var $container = this.$container;
            var $playerContainer = $(selectors.playerContainer, $container);
            var playerType = this.$container.attr('data-video-type');

            var promiseVideoPlayer;

            if (playerType === 'youtube') {
                promiseVideoPlayer = this._loadYoutubePlayer($playerContainer[0]);
            } else if (playerType === 'vimeo') {
                promiseVideoPlayer = this._loadVimeoPlayer($playerContainer[0]);
            }

            return promiseVideoPlayer
                .then(this._onPlayerLoadReady.bind(this))
                .fail(this._onPlayerLoadError.bind(this));
        },

        _loadYoutubePlayer: function(container) {
            return youtube
                .promisePlayer(container, {
                    videoId: this.$container.attr('data-video-id'),
                    ratio: 16 / 9,
                    playerVars: {
                        modestbranding: 1,
                        autoplay: 1,
                        showinfo: 0,
                        rel: 0
                    }
                })
                .then(
                    function(player) {
                        this.player = player;
                    }.bind(this)
                );
        },

        _loadVimeoPlayer: function(container) {
            return vimeo
                .promisePlayer(container, {
                    id: this.$container.attr('data-video-id')
                })
                .then(
                    function(player) {
                        this.player = player;
                        this.player.play();
                    }.bind(this)
                );
        },

        _onPlayerLoadReady: function() {
            $(selectors.closePlayerButton, this.$container)
                .show()
                .focus();
            $(selectors.cover, this.$container).addClass(classes.playerLoaded);
            this.$container.addClass(classes.playerLoaded);

            this._setScrollPositionValues();

            $(selectors.body).addClass(classes.videoPlaying);

            $(document).on('keyup' + this.namespace, this._closeOnEscape.bind(this));
            $(window).on(
                'resize' + this.namespace,
                this._setScrollPositionValues.bind(this)
            );
            slate.a11y.trapFocus({
                $container: this.$container,
                namespace: this.namespace
            });
        },

        _onPlayerLoadError: function(err) {
            this.$container.addClass(classes.playerError);
            $(selectors.errorMessage, this.$container).text(err);
        },

        _closeOnEscape: function(evt) {
            if (evt.keyCode !== 27) {
                return;
            }

            this._closePlayer();
            $(selectors.loadPlayerButton, this.$container).focus();
        },

        _onScroll: function() {
            var scrollTop = $(window).scrollTop();

            if (
                scrollTop > this.videoTop + 0.25 * this.videoHeight ||
                scrollTop + this.windowHeight <
                this.videoBottom - 0.25 * this.videoHeight
            ) {
                // Debounce DOM edits to the next frame with requestAnimationFrame
                requestAnimationFrame(this._closePlayer.bind(this));
            }
        },

        _setScrollPositionValues: function() {
            this.videoHeight = this.$container.outerHeight(true);
            this.videoTop = this.$container.offset().top;
            this.videoBottom = this.videoTop + this.videoHeight;
            this.windowHeight = $(window).innerHeight();
        },

        _closePlayer: function() {
            $(selectors.body).removeClass(classes.videoPlaying);
            $(selectors.cover, this.$container).removeClass(classes.playerLoaded);
            this.$container.removeClass(classes.playerLoaded);
            $(selectors.closePlayerButton, this.$container).hide();

            slate.a11y.removeTrapFocus({
                $container: this.$container,
                namespace: this.namespace
            });

            if (typeof this.player.destroy === 'function') {
                this.player.destroy();
            } else if (typeof this.player.unload === 'function') {
                this.player.unload();
            }

            $(document).off(this.namespace);
            $(window).off(this.namespace);
        }
    });

    return Video;
})();

theme.CollectionsList = (function() {
    function CollectionsList(container) {
        var $container = (this.$container = $(container));
        var stretchImage = $container.is('[data-stretch-image]');

        // Early return if 'secondary image layout' is enabled
        if (stretchImage) return;

        var namespace = (this.namespace = '.' + $container.attr('data-section-id'));
        var self = this;

        self._collectionListFix();
        $(window).on(
            'resize' + namespace,
            $.debounce(250, function() {
                self._collectionListFix();
            })
        );
    }

    CollectionsList.prototype = _.assignIn({}, CollectionsList.prototype, {
        onUnload: function() {
            $(window).off(this.namespace);
        },

        _collectionListFix: function() {
            var numberRows = this.$container.find('.grid').data('number-rows');
            var $featureCards = this.$container.find('.featured-card');

            // We can exit if 'Use secondary image layout' is enabled
            if ($featureCards.is('[data-stretch-image]')) return;

            // Go through each of the rows
            for (var i = 0; i < numberRows; i++) {
                var maxWrapperHeight = 0;
                var maxHeaderHeight = 0;
                var $currentRow = $featureCards.filter(
                    "[data-row-number='" + (i + 1) + "']"
                );
                var $cardHeaders = $currentRow.find('.featured-card__header');

                // Find the max heights for each row
                $currentRow.each(function() {
                    var $cardTitle = $(this).find('.featured-card__title');
                    var $cardAction = $(this).find('.featured-card__action');
                    var $cardImageWrapper = $(this).find('.featured-card__image-wrapper');
                    var headerHeight =
                        $cardTitle.outerHeight() + $cardAction.outerHeight() + 65;
                    var wrapperHeight = $cardImageWrapper.outerHeight();
                    if (headerHeight > maxHeaderHeight) {
                        maxHeaderHeight = headerHeight;
                    }
                    if (wrapperHeight > maxWrapperHeight) {
                        maxWrapperHeight = wrapperHeight;
                    }
                });

                // Set the heights of the headers and cards for this row with padding
                $cardHeaders.outerHeight(maxHeaderHeight);
                $currentRow.height(maxWrapperHeight + maxHeaderHeight + 40);
            }
        }
    });

    return CollectionsList;
})();

theme.ParrallaxImage = (function() {
    function ParrallaxImage(container) {
        this.container = container;
        this.sectionId = $(container).attr('data-section-id');
        this.namespace = 'parallax-' + this.sectionId;
        var images = document.getElementsByClassName('thumbnail' + this.sectionId);
        new simpleParallax(images, {
            scale: 1.5,
            delay: .6,
        });
    }

    ParrallaxImage.prototype = $.extend({}, ParrallaxImage.prototype, {
        onUnload: function(evt) {
            var instance = new simpleParallax(images);
            instance.destroy();
            delete theme.ParrallaxImage[this.namespace];
        }
    });

    return ParrallaxImage;
})();

theme.init = function() {
    theme.customerTemplates.init();
    slate.rte.wrapTable();
    slate.rte.iframeReset();

    // Common a11y fixes
    slate.a11y.pageLinkFocus($(window.location.hash));

    $('.in-page-link').on('click', function(evt) {
        slate.a11y.pageLinkFocus($(evt.currentTarget.hash));
    });

    $('a[href="#"]').on('click', function(evt) {
        evt.preventDefault();
    });


    //scroll animation
    AOS.init({
        startEvent: 'DOMContentLoaded',
        offset: 30, // offset (in px) from the original trigger point
        delay: 0, // values from 0 to 3000, with step 50ms
        duration: 1000,
        once: true
    });
    window.addEventListener('load', function() {
        AOS.refresh();
    });


    // Sections
    var sections = new theme.Sections();
    sections.register('header', theme.HeaderSection);
    sections.register('product', theme.Product);
    sections.register('slideshow-section', theme.SlideshowSection);
    sections.register('cart', theme.Cart);
    sections.register('instagrams', theme.Instagrams);
    sections.register('masonries', theme.Masonry);
    sections.register('productlist', theme.Productlists);
    sections.register('producttab', theme.Producttabs);
    sections.register('slickCarousels', theme.slickCarousel);
    sections.register('video', theme.Video);
    sections.register('collections-list', theme.CollectionsList);
    sections.register('parallax-image', theme.ParrallaxImage);
    sections.register('bgcollection', theme.Bgcollection);

    // Standalone modules
    $(window).on('load', theme.articleImages);
    theme.passwordModalInit();
};

theme.articleImages = function() {
    var $indentedRteImages = $('.rte--indented-images');
    if (!$indentedRteImages.length) {
        return;
    }

    $indentedRteImages.find('img').each(function(i, el) {
        var $el = $(el);
        var attr = $el.attr('style');

        // Check if undefined or float: none
        if (!attr || attr === 'float: none;') {
            // Add class to parent paragraph tag if image is wider than container
            if ($el.width() >= $indentedRteImages.width()) {
                $el.parent('p').addClass('rte__image-indent');
            }
        }
    });
};

theme.passwordModalInit = function() {
    var $loginModal = $('#LoginModal');
    if (!$loginModal.length) {
        return;
    }

    // Initialize modal
    theme.PasswordModal = new window.Modals('LoginModal', 'login-modal', {
        focusOnOpen: '#Password'
    });

    // Open modal if errors exist
    if ($loginModal.find('.errors').length) {
        theme.PasswordModal.open();
    }
};

// CSS var ponyfill
theme.cssVar = (function() {
    cssVars();
})()

// Ajax search https://gist.github.com/awojtczyk/53d74c8af5f893841f33979b0cdcd6fe
theme.ajaxSearch = (function() {
    var $inputSearch = '.js-ajaxsearch',
        $resultsList = '.search-results',
        $input = $($inputSearch).find('input[name="q"]'),
        $currentAjaxRequest,
        $displayProducts = 6;

    $($inputSearch).css('position', 'relative').each(function() {
        $input.attr('autocomplete', 'off').bind('keyup change', function() {
            var term = $(this).val(),
                form = $(this).closest('form'),
                searchURL = '/search?type=product&q=*' + term + '*';
            if (term.length > 2 && term !== $(this).attr('data-old-term')) {
                $(this).attr('data-old-term', term);
                if ($currentAjaxRequest !== undefined) $currentAjaxRequest.abort();
                $currentAjaxRequest = $.getJSON(searchURL + '&view=json', function(data) {
                    $($resultsList).empty();

                    if (data.results_count === 0) {
                        $($resultsList).html('<p class="text-center">' + theme.strings.ajaxSearchNoResult + '</p>')
                    } else {
                        $.each(data.results, function(index, item) {
                            if (index < $displayProducts) {
                                var itemPrice = theme.Currency.formatMoney(item.price, theme.moneyFormat);
                                var link = $('<a class="d-inline-flex ' + index + '"></a>')
                                    .attr('href', item.url)
                                    .append('<span class="image"><img src="' + item.thumbnail + '" /></span>')
                                    .append('<div class="meta"><p class="title">' + item.title + '</p>' + itemPrice + '</div>')
                                    .wrap('<div class="ajax-search-item"></div>');
                                $($resultsList).append(link.parent());
                                theme.updateCurrencies();
                            }
                        });
                        if (data.results_count > $displayProducts) {
                            $($resultsList).append('<a class="btn btn--full" href="' + searchURL + '">' + theme.strings.ajaxSearchViewAll + ' (' + data.results_count + ')</a>');
                        }
                    }
                    $($resultsList).addClass('active').fadeIn(200);
                });
            }
        });
    });

    //escape when click somethings
    $(document).click(function(event) {
        var target = event.target;
        if (!$(target).is($inputSearch) && !$(target).parents().is($inputSearch)) {
            $($resultsList).slideUp(300);
        }
    });
})();

// Quickview https://github.com/kellyvaughn/quickview-for-shopify/blob/master/quickview.js.liquid
theme.quickview = (function() {
    var product_handle = '',
        quickviewButtonClass = '.js-btn-quickview',
        quickviewId = '#jsQuickview',
        quickviewOption = '#jsQuickview select',
        quickviewThumb = '#qv-product-images',
        quickviewAddCartButton = '.qv-add-button',
        quickviewPrice = '.qv-product-price',
        quickviewComparePrice = '.qv-product-compare-price';

    // 1. Show quickview
    $(document).on('click', quickviewButtonClass, function() {
        var quickviewAvaible = $(this).attr("data-pavailable");
        product_handle = $(this).data('handle');
        //ResetQuickview
        $(quickviewId).removeClass().addClass('modal fade');
        $(quickviewThumb).removeClass().empty();
        $('.qv-product-options').empty();

        //Pushdata
        $(quickviewId).addClass(product_handle).data('handle', product_handle);
        jQuery.getJSON('/products/' + product_handle + '.js', function(product) {
            var title = product.title;
            var type = product.type;
            var vendor = product.vendor;
            var price = 0;
            var compare_price = 0;
            var desc = product.description.slice(0, 90);
            var images = product.images;
            var variants = product.variants;
            var options = product.options;
            var url = '/products/' + product_handle;
            $('.qv-product-title').text(title);
            $('.qv-product-type').text(type);
            $('.qv-product-description').html(desc);
            $('.qv-view-product').attr('href', url);
            $('.qv-view-type').text(type);
            $('.qv-view-vendor').text(vendor)
            if (quickviewAvaible == 'true') {
                $(quickviewAddCartButton).prop('disabled', false).html(theme.strings.addToCart);
            } else {
                $(quickviewAddCartButton).prop('disabled', true).html(theme.strings.soldOut);
            }
            $(product.variants).each(function(i, variants) {
                if (variants.sku != null) {
                    $('.qv-sku').addClass("show").removeClass("hide");
                    $('.qv-view-sku').text(product.variants[0].sku);
                } else {
                    $('.qv-sku').addClass("hide").removeClass("show");
                }

            });
            var imageCount = $(images).length;
            $(images).each(function(i, image) {
                image_embed = '<div><img src="' + image + '"></div>';
                image_embed = image_embed.replace('.jpg', '_800x.jpg').replace('.png', '_800x.png');
                $(quickviewThumb).append(image_embed);
            });
            $(quickviewThumb).slick({
                rtl: theme.rtl,
                'dots': true,
                'arrows': true,
                'respondTo': 'min',
                'useTransform': true
            }).css('opacity', '1');

            if (product.variants[0].option1 !== "Default Title") {
                $(options).each(function(i, option) {
                    var name = option.name;
                    var opt = name.replace(/ /g, '-').toLowerCase();
                    var selectClass = '.option.' + opt;
                    $('.qv-product-options').append('<div class="option-selection ' + opt + '"><span class="option text-uppercase font-weight-bold text-body">' + option.name + '</span><select class="option-' + i + ' option ' + opt + '"></select></div>');
                    $(option.values).each(function(i, value) {
                        $('.option.' + opt).append($('<option>', {
                            value: value,
                            text: value
                        }));
                    });
                });
            }
            $(product.variants).each(function(i, v) {
                if (v.inventory_quantity == 0) {
                    return true
                } else {
                    price = theme.Currency.formatMoney(v.price, theme.moneyFormat);
                    compare_price = theme.Currency.formatMoney(v.compare_at_price, theme.moneyFormat);
                    $(quickviewPrice).html(price);
                    if (v.compare_at_price !== null) {
                        $(quickviewComparePrice).html(compare_price).show();
                    } else {
                        $(quickviewComparePrice).hide();
                    }
                    theme.updateCurrencies();
                    $('select.option-0').val(v.option1);
                    $('select.option-1').val(v.option2);
                    $('select.option-2').val(v.option3);
                    return false
                }
            });
        });
        //addCartQuickview
    });
    // 2. Add to cart
    $(document).on('click', quickviewAddCartButton, function() {
        product_handle = $(quickviewId).data('handle');
        var qty = $('.qv-quantity').val(),
            selectedOptions = '',
            var_id = '';

        function processCart() {
            jQuery.post('/cart/add.js', {
                    quantity: qty,
                    id: var_id
                }, null, "json").done(function(item) {
                    var htmlVariant = item.variant_title !== null ? '<i>(' + item.variant_title + ')</i>' : '';
                    var styleCart = $('.js-mini-cart').attr("data-cartmini");
                    if (styleCart != 'true') {
                        var htmlAlert = '<div class="media mt-2 alert--cart"><a class="mr-3" href="/cart"><img class="lazyload" data-src="' + item.image + '"></a><div class="media-body align-self-center"><p class="m-0 font-weight-bold">' + item.product_title + ' x ' + item.quantity + '</p>' + htmlVariant + '<div><div>';
                        theme.alert.new(theme.strings.addToCartSuccess, htmlAlert, 3000, 'notice');
                    }
                    theme.miniCart.updateElements();
                    theme.miniCart.generateCart();
                })
                .fail(function($xhr) {
                    var data = $xhr.responseJSON;
                    theme.alert.new('', data.description, 3000, 'warning');
                });
        }
        $(quickviewOption).each(function(i) {
            if (selectedOptions == '') {
                selectedOptions = $(this).val();
            } else {
                selectedOptions = selectedOptions + ' / ' + $(this).val();
            }
        });
        jQuery.getJSON('/products/' + product_handle + '.js', function(product) {
            if (product.variants.length === 1) {
                var_id = product.variants[0].id;
            } else {
                $(product.variants).each(function(i, v) {
                    if (v.title == selectedOptions) {
                        var_id = v.id;
                    }
                });
            }
            processCart();
        });
    });
    // 3. Select variants
    $(document).on('change', quickviewOption, function() {
        var selectedOptions = '';
        $(quickviewOption).each(function(i) {
            if (selectedOptions == '') {
                selectedOptions = $(this).val();
            } else {
                selectedOptions = selectedOptions + ' / ' + $(this).val();
            }
        });
        jQuery.getJSON('/products/' + product_handle + '.js', function(product) {
            $(product.variants).each(function(i, v) {
                if (v.title == selectedOptions) {
                    if (v.featured_image !== null) {
                        var iSlick = v.featured_image.position - 1;
                        $(quickviewThumb).slick('slickGoTo', iSlick);
                    }
                    var price = theme.Currency.formatMoney(v.price, theme.moneyFormat);
                    var compare_price = theme.Currency.formatMoney(v.compare_at_price, theme.moneyFormat);
                    $(quickviewPrice).html(price);
                    $(quickviewComparePrice).html(compare_price);
                    if (v.sku != null) {
                        $('.qv-sku').addClass("show").removeClass("hide");
                        $('.qv-view-sku').text(v.sku);
                    } else {
                        $('.qv-sku').addClass("hide").removeClass("show");
                    }
                    if (v.compare_at_price !== null) {
                        $(quickviewComparePrice).html(compare_price).show();
                    } else {
                        $(quickviewComparePrice).hide();
                    }
                    theme.updateCurrencies();
                    if (v.inventory_management === null) {
                        $(quickviewAddCartButton).prop('disabled', false).val(theme.strings.addToCart);
                    } else {
                        if (v.inventory_quantity < 1) {
                            $(quickviewAddCartButton).prop('disabled', true).val(theme.strings.soldOut);
                        } else {
                            $(quickviewAddCartButton).prop('disabled', false).val(theme.strings.addToCart);
                        }
                    }
                }
            });
        });
    });
})()

//Button add to cart (in grid item)
theme.addCartButton = (function() {
    var buttonClass = '.js-grid-cart';
    $(document).on('click', buttonClass, function() {
        var $this = $(this);
        var id = $this.data('id');
        $this.addClass('is-loading');
        Shopify.addItem(id, 1, function(item) {
            location.href = "/cart";
            var htmlVariant = item.variant_title !== null ? '<i>(' + item.variant_title + ')</i>' : '';
            var styleCart = $('.js-mini-cart').attr("data-cartmini");
            if (styleCart != 'true') {
                var htmlAlert = '<div class="media mt-2 alert--cart"><a class="mr-3" href="/cart"><img class="lazyload" data-src="' + item.image + '"></a><div class="media-body align-self-center"><p class="m-0 font-weight-bold">' + item.product_title + ' x ' + item.quantity + '</p>' + htmlVariant + '<div><div>';
            }
            theme.miniCart.updateElements();
            theme.miniCart.generateCart();
            setTimeout(function() {
                styleCart != 'true' ? theme.alert.new(theme.strings.addToCartSuccess, htmlAlert, 3000, 'notice') : '';
                $this.removeClass('is-loading');
            }, 1000);
        });
    })
})()

// Button add to cart (in grid item)
//theme.addCartButton = (function(){
//  var buttonClass = '.js-grid-cart';
//  $(document).on('click',buttonClass,function(){
//    var $this = $(this);
//    var id = $this.data('id');
//    $this.addClass('is-loading');
//    Shopify.addItem(id,1,function(item){
//      var htmlVariant = item.variant_title !== null ? '<i>('+item.variant_title+')</i>' : '';
//      var styleCart = $('.js-mini-cart').attr("data-cartmini");
//        if(styleCart != 'true'){
//          var htmlAlert = '<div class="media mt-2 alert--cart"><a class="mr-3" href="/cart"><img class="lazyload" data-src="'+item.image+'"></a><div class="media-body align-self-center"><p class="m-0 font-weight-bold">'+item.product_title+' x '+ item.quantity +'</p>'+htmlVariant+'<div><div>';
//        }
//      theme.miniCart.updateElements();
//      theme.miniCart.generateCart();
//      setTimeout(function() {
//        styleCart != 'true' ? theme.alert.new(theme.strings.addToCartSuccess,htmlAlert,3000,'notice'): '';
//        $this.removeClass('is-loading');
//      }, 1000);
//    });
// })
//})()

// Multi currencies 
if (theme.enableCurrencies) {
    // Can be 'money_format' or 'money_with_currency_format'
    Currency.format = 'money_format';
    var shopCurrency = Shopify.currency.active;
    var cookieCurrency = Currency.cookie.read();
    // Fix for customer account pages 
    jQuery('span.money span.money').each(function() {
        jQuery(this).parent('span.money').removeClass('money');
    });
    // Add precalculated shop currency to data attribute 
    jQuery('span.money').each(function() {
        jQuery(this).attr('data-currency-' + Shopify.currency.active, jQuery(this).html());
    });
    // Select all your currencies buttons.
    var buttons = jQuery('#currencies a'),
        currentCurrencies = jQuery('.pre-currencies');
    // When the page loads.
    if (cookieCurrency == null || cookieCurrency == shopCurrency) {
        Currency.currentCurrency = shopCurrency;
    } else {
        Currency.currentCurrency = cookieCurrency;
        Currency.convertAll(shopCurrency, cookieCurrency);
        buttons.removeClass('selected');
        jQuery('#currencies a[data-currency=' + cookieCurrency + ']').addClass('selected');
        var htmlCurrently = jQuery('#currencies a[data-currency=' + cookieCurrency + ']').html();
        currentCurrencies.html(htmlCurrently);
    }
    buttons.click(function() {
        buttons.removeClass('selected');
        jQuery(this).addClass('selected');
        var newCurrency = jQuery(this).attr('data-currency');
        var htmlCurrently = jQuery(this).html();
        currentCurrencies.html(htmlCurrently);
        Currency.convertAll(Currency.currentCurrency, newCurrency);
    });
    // For product options.
    var original_selectCallback = window.selectCallback;
    var selectCallback = function(variant, selector) {
        original_selectCallback(variant, selector);
        Currency.convertAll(shopCurrency, jQuery('#currencies a.selected').attr('data-currency'));
    };
}
theme.updateCurrencies = function() {
    Currency.convertAll(shopCurrency, jQuery('#currencies a.selected').attr('data-currency'));
}

// MiniCart
theme.miniCart = (function() {
    var miniCart = '.js-mini-cart',
        styleCart = $(miniCart).attr("data-cartmini"),
        cartToggle = '.js-toggle-cart',
        cartCount = '.js-cart-count',
        cartContent = '.js-mini-cart-content',
        cartTotal = '.js-cart-total',
        $btnCheckout = $('.js-cart-btn-checkout'),
        numberDisplayed = 5,
        // emptyCartHTML = '<div class="alert">' + theme.strings.cartEmpty + '</div>';

        // function updateElements() {
        //     Shopify.getCart(function(cart) {

        //         if (cart.item_count === 0) {
        //             $(cartContent).html(emptyCartHTML);
        //             $btnCheckout.addClass('disabled');
        //             styleCart === 'true' ? $(miniCart).removeClass('active') : null;

        //         } else {
        //             $btnCheckout.removeClass('disabled');
        //             styleCart === 'true' ? $(miniCart).addClass('active') : null;
        //         }
        //         $(cartCount).text(cart.item_count);
        //         $(cartTotal).html(theme.Currency.formatMoney(cart.total_price, theme.moneyFormat));
        //         theme.freeShipping.load(cart);
        //         theme.updateCurrencies();
        //     })
        // }

        // function generateCart() {

        //     Shopify.getCart(function(cart) {

        //         var htmlCart = cart.item_count === 0 ? emptyCartHTML : '',
        //             itemCount = cart.items.length,
        //             forLoop = itemCount < numberDisplayed ? itemCount : numberDisplayed;
        //         //styleCart === 'true' ? cart.items.length ? $(miniCart).addClass('active'): $(miniCart).removeClass('active') :null;

        //         // add list items
        //         for (var i = 0; i < forLoop; i++) {
        //             var product = cart.items[i],
        //                 productPrice = theme.Currency.formatMoney(product.price, theme.moneyFormat);
        //             htmlCart += '<div class="mini-cart-item">';
        //             htmlCart += '	<a class="mini-cart-image" href="' + product.url + '">';
        //             htmlCart += '		<img src="' + product.image + '"/>';
        //             htmlCart += '	</a>';
        //             htmlCart += '	<div class="mini-cart-meta">';
        //             htmlCart += '		<p ><a href="' + product.url + '">' + product.title + '</a></p>';
        //             htmlCart += '		<span> ' + productPrice + '</span><b> x ' + product.quantity + '</b>';
        //             htmlCart += '	</div>';
        //             htmlCart += '	<button class="btn js-remove-mini-cart" data-id="' + product.id + '">&times;</button>';
        //             htmlCart += '</div>';
        //         }
        //         if (itemCount > numberDisplayed) {
        //             htmlCart += '<a class="js-btn-viewmore" href="/cart">' + theme.strings.cartMore + '(' + (itemCount - numberDisplayed) + ')</a>'
        //         }
        //         // add total price and cart button / checkout button
        //         $(cartContent).html(htmlCart);
        //         $(cartTotal).html(theme.Currency.formatMoney(cart.total_price, theme.moneyFormat));
        //         theme.updateCurrencies();
        //     })
        // }
        // 2. Button remove items
        $(document).on('click', '.js-remove-mini-cart', function() {
            var itemId = $(this).data('id');
            var isOuterMiniCart = $(this).closest(miniCart).length === 0 ? true : false; // check element from mini cart or not

            // hide items
            $(this).parent().fadeOut();

            //remove from cart
            Shopify.changeItem(itemId, 0, updateElements);
            Shopify.getCart(function(cart) {
                if (cart.items.length > numberDisplayed || isOuterMiniCart) {
                    generateCart();
                }
            });
        });

    //Keep popup when click cart / UX
    $(document).on('click', cartToggle, function() {
        $(this).parent(miniCart).toggleClass('active');
    });
    $(document).on('click', '.overlaycart', function() {
        $(this).parent(miniCart).removeClass('active');
    });

    // gen minicart when load page
    generateCart();
    return {
        updateElements: updateElements,
        generateCart: generateCart
    }
})()

// Free shipping
theme.freeShipping = (function() {
    var $freeShippingClass = $('.js-free-shipping'),
        $freeShippingTextClass = $('.js-free-shipping-text'),
        $free_fisrt = $freeShippingClass.attr('data-start'),
        $free_end = $freeShippingClass.attr('data-end')
    minOrderValue = parseInt($freeShippingClass.data('value')) || 0,
        $percentClass = $('.js-free-shipping .progress-bar');

    function generate(cart) {
        var priceCart = cart.total_price;
        if (priceCart >= minOrderValue) {
            $percentClass.css('width', '100%').removeClass('progress-bar-striped bg-primary');
            $freeShippingTextClass.text(theme.strings.freeShipping)
        } else {
            let percent = priceCart / minOrderValue * 100;
            let left = Shopify.formatMoney((minOrderValue - priceCart), theme.moneyFormat);
            $percentClass.css('width', percent + '%').addClass('progress-bar-striped primary');
            $freeShippingTextClass.html($free_fisrt + ' ' + left + ' ' + $free_end);
            theme.updateCurrencies();
        }
    }

    Shopify.getCart(function(cart) {
        generate(cart);
    });

    return {
        load: generate
    }
})()

// Shipping time - https://github.com/phstc/jquery-dateFormat
theme.shippingTime = (function() {
    var $shippingTime = $('.js-shipping-time'),
        shippingTime = $shippingTime.data('time') || '',
        now = new Date(),
        restHour = 23 - now.getHours(),
        restMinute = 59 - now.getMinutes();
    if (shippingTime !== '') {
        var nextTime = new Date(now.getTime() + shippingTime * 86400000),
            formatTime = $.format.date(nextTime, "ddd, dd MMMM yyyy"),
            htmlShipping = 'Order in the next <b>' + restHour + '</b> hours <b>' + restMinute + '</b> minutes to get it by <b>' + formatTime + '</b>. ';
        $shippingTime.html(htmlShipping);
    }
})()

// Infinite scroll - https://github.com/Elkfox/Ajaxinate/blob/master/dist/ajaxinate.min.js
theme.infiniteScroll = (function() {
    function initInfiniteScroll() {
        if ($('.AjaxinateLoop').length === 0) {
            return;
        } else {
            var endlessScroll = new Ajaxinate({
                loadingText: '<div class="text-center"><div class="' + theme.loadingClass + '" role="status"></div></div>',
                callback: function() {
                    theme.wishlist.load();
                    theme.compare.load();
                    theme.countdown.load();
                    theme.priceRange.load();
                    theme.tooltip.load();
                    theme.collectionView.triggerView();
                    theme.swatchCard2.load();
                }
            });
        }
    }

    // Infinite scroll in other page (blog, list-collection)
    function initOtherPages() {
        var otherPages = new Ajaxinate({
            loadingText: '<div class="text-center"><div class="' + theme.loadingClass + '" role="status"></div></div>',
            container: '.js-pagination-content',
            pagination: '.js-pagination'
        });
    }

    document.addEventListener("DOMContentLoaded", function() {
        initInfiniteScroll();
        initOtherPages();
    });

    return {
        load: initInfiniteScroll
    }
})()

// Scroll to fixed
theme.scrollToFixed = (function() {
    var window_width = $(window).width();

    if (window_width < 768) {
        $(".js-stick-parent").trigger("sticky_kit:detach");
    } else {
        make_sticky();
    }
    $(window).resize(function() {

        window_width = $(window).width();

        if (window_width < 768) {
            $(".js-stick-parent").trigger("sticky_kit:detach");
        } else {
            make_sticky();
        }
    });

    function make_sticky() {
        $('.js-stick-parent').stick_in_parent();
    }

})()


theme.headersidebar = (function() {
    $('#dismiss, .overlaysidebar').on('click', function() {
        // hide sidebar
        $('#sidebar').removeClass('active');
        // hide overlay
        $('.overlaysidebar').removeClass('active');
    });

    $('#sidebarCollapse').on('click', function() {
        // open sidebar
        $('#sidebar').addClass('active');
        // fade in the overlay
        $('.overlaysidebar').addClass('active');
        $('.collapse.in').toggleClass('in');
        $('a[aria-expanded=true]').attr('aria-expanded', 'false');
    });
})()

// Wishlist
theme.wishlist = (function() {
    var wishlistButtonClass = '.js-btn-wishlist',
        wishlistRemoveButtonClass = '.js-remove-wishlist',
        $wishlistCount = $('.js-wishlist-count'),
        $wishlistContainer = $('.js-wishlist-content'),
        wishlistObject = JSON.parse(localStorage.getItem('localWishlist')) || [],
        wishlistPageUrl = $('.js-wishlist-link').attr('href'),
        loadNoResult = function() {
            $wishlistContainer.html('<div class="col text-center"><div class="alert alert-warning d-inline-block">' + theme.strings.wishlistNoResult + '</div></div>');
        };

    function updateWishlist(self) {
        var productHandle = $(self).data('handle'),
            allSimilarProduct = $(wishlistButtonClass + '[data-handle="' + productHandle + '"]');
        var isAdded = $.inArray(productHandle, wishlistObject) !== -1 ? true : false;
        if (isAdded) {
            // go to wishlist page
            window.location.href = wishlistPageUrl;
        } else {
            wishlistObject.push(productHandle);
            allSimilarProduct.fadeOut('slow').fadeIn('fast').html(theme.strings.wishlistIconAdded + theme.strings.wishlistTextAdded);
            //change tooltip
            allSimilarProduct.attr('data-original-title', theme.strings.wishlistTextAdded);
            $('.tooltip-inner').text(theme.strings.wishlistTextAdded);
        }
        localStorage.setItem('localWishlist', JSON.stringify(wishlistObject));
        $wishlistCount.text(wishlistObject.length);
    };

    function loadWishlist() {
        $wishlistContainer.html('');
        //page wishlist
        if (wishlistObject.length > 0) {
            for (var i = 0; i < wishlistObject.length; i++) {
                var productHandle = wishlistObject[i];
                Shopify.getProduct(productHandle, function(product) {
                    var htmlProduct = '';
                    var productPrice = product.price_varies ? 'from ' + theme.Currency.formatMoney(product.price_min, theme.moneyFormat) : theme.Currency.formatMoney(product.price, theme.moneyFormat);
                    var productComparePrice = product.compare_at_price_min !== 0 ? theme.Currency.formatMoney(product.compare_at_price_min, theme.moneyFormat) : '';
                    htmlProduct += '<div class="js-wishlist-item col-md-4 col-sm-6 col-xs-6 col-12 mb-4">';
                    htmlProduct += '<div class="js-wishlist-itembox">';
                    htmlProduct += '<div class=" d-flex flex-row p-4">';
                    htmlProduct += '	<a class="d-inline-block mr-4 " href="' + product.url + '">';
                    htmlProduct += '		<img src="' + product.featured_image + '"/>';
                    htmlProduct += '	</a>';
                    htmlProduct += '	<div><a href="' + product.url + '" class="title-prouct d-block h4 text-body" >' + product.title + '</a>';
                    htmlProduct += '	<span> ' + productPrice + '</span>';
                    htmlProduct += '	 <s>' + productComparePrice + '</s></div>';
                    htmlProduct += '<button class="btn js-remove-wishlist" data-handle="' + product.handle + '">' + theme.strings.wishlistRemove + '</button>';
                    htmlProduct += '</div>';
                    htmlProduct += '</div>';
                    htmlProduct += '</div>';
                    $wishlistContainer.append(htmlProduct);
                    theme.updateCurrencies();
                });
            }
        } else {
            loadNoResult();
        }

        //count items
        $wishlistCount.text(wishlistObject.length);

        //button text
        $(wishlistButtonClass).each(function() {
            var productHandle = $(this).data('handle');
            var iconWishlist = $.inArray(productHandle, wishlistObject) !== -1 ? theme.strings.wishlistIconAdded : theme.strings.wishlistIcon;
            var textWishlist = $.inArray(productHandle, wishlistObject) !== -1 ? theme.strings.wishlistTextAdded : theme.strings.wishlistText;
            $(this).html(iconWishlist + textWishlist).attr('title', textWishlist);
        });
    }

    $(document).on('click', wishlistButtonClass, function(event) {
        event.preventDefault();
        updateWishlist(this);
    });
    $(document).on('click', wishlistRemoveButtonClass, function() {
        var productHandle = $(this).data('handle'),
            allSimilarProduct = $(wishlistButtonClass + '[data-handle="' + productHandle + '"]');

        //update button
        allSimilarProduct.html(theme.strings.wishlistIcon + theme.strings.wishlistText);
        //update tooltip
        allSimilarProduct.attr('data-original-title', theme.strings.wishlistText);
        $('.tooltip-inner').text(theme.strings.wishlistText);
        //update Object
        wishlistObject.splice(wishlistObject.indexOf(productHandle), 1);
        localStorage.setItem('localWishlist', JSON.stringify(wishlistObject));
        // Remove element
        $(this).closest('.js-wishlist-item').fadeOut(); // or .remove()
        //count
        $wishlistCount.text(wishlistObject.length);
        if (wishlistObject.length === 0) {
            loadNoResult();
        }
    });

    loadWishlist();
    $(document).on('shopify:section:load', loadWishlist);
    return {
        load: loadWishlist
    }
})()

// Compare
theme.compare = (function() {
    var compareButtonClass = '.js-btn-compare',
        compareRemoveButtonClass = '.js-remove-compare',
        $compareCount = $('.js-compare-count'),
        $compareContainer = $('.js-compare-content'),
        compareObject = JSON.parse(localStorage.getItem('localCompare')) || [],
        alertClass = 'notice';

    function updateCompare(self) {
        var productHandle = $(self).data('handle'),
            alertText = '';
        var isAdded = $.inArray(productHandle, compareObject) !== -1 ? true : false;
        if (isAdded) {
            compareObject.splice(compareObject.indexOf(productHandle), 1);
            alertText = theme.strings.compareNotifyRemoved;
            alertClass = 'notice';
        } else {
            if (compareObject.length === 4) {
                alertText = theme.strings.compareNotifyMaximum;
                alertClass = 'error';
            } else {
                alertClass = 'notice';
                compareObject.push(productHandle);
                alertText = theme.strings.compareNotifyAdded;
            }
        }
        localStorage.setItem('localCompare', JSON.stringify(compareObject));
        theme.alert.new(theme.strings.compareText, alertText, 2000, alertClass);
        $compareCount.text(compareObject.length);
    };

    function loadCompare() {
        var compareGrid;
        $compareContainer.html('');
        //popup compare
        if (compareObject.length > 0) {
            compareGrid = compareObject.length === 1 ? 'col-md-6 col-sm-6' : 'col';
            for (var i = 0; i < compareObject.length; i++) {
                var productHandle = compareObject[i];
                Shopify.getProduct(productHandle, function(product) {
                    var htmlProduct = '',
                        productPrice = product.price_varies ? 'from ' + theme.Currency.formatMoney(product.price_min, theme.moneyFormat) : theme.Currency.formatMoney(product.price, theme.moneyFormat),
                        productComparePrice = product.compare_at_price_min !== 0 ? theme.Currency.formatMoney(product.compare_at_price_min, theme.moneyFormat) : '',
                        productAvailable = product.available ? theme.strings.available : theme.strings.unavailable,
                        productAvailableClass = product.available ? 'alert-success' : 'alert-danger',
                        productTypeHTML = product.type !== "" ? '<a href="/collections/types?q=' + product.type + '">' + product.type + '</a>' : '<span>' + theme.strings.none + '</span>',
                        productVendorHTML = product.vendor !== "" ? '<a href="/collections/vendors?q=' + product.vendor + '">' + product.vendor + '</a>' : '<span>' + theme.strings.none + '</span>';
                    htmlProduct += '<div class="compare-item ' + compareGrid + ' col-xs-6">';
                    htmlProduct += '	<a href="' + product.url + '">';
                    htmlProduct += '		<img src="' + Shopify.resizeImage(product.featured_image, 'x300') + '"/>';
                    htmlProduct += '	</a>';
                    htmlProduct += '	<hr /><h5 >' + product.title + '</h5>';
                    htmlProduct += '	<hr /><s>' + productComparePrice + '</s>';
                    htmlProduct += '	<span> ' + productPrice + '</span>';
                    htmlProduct += '	<hr /><span class=' + productAvailableClass + '> ' + productAvailable + '</span>';
                    htmlProduct += '	<hr />' + productTypeHTML;
                    htmlProduct += '	<hr />' + productVendorHTML;
                    htmlProduct += '  <hr /><button class="btn js-remove-compare btn-theme gradient-theme" data-handle="' + product.handle + '">' + theme.strings.compareRemove + '</button>';
                    htmlProduct += '</div>';
                    $compareContainer.append(htmlProduct);
                    theme.updateCurrencies();
                });
            }
        } else {
            $compareContainer.html('<div class="alert alert-warning d-inline-block">' + theme.strings.compareNoResult + '</div>');
        }

        //button text
        $(compareButtonClass).each(function() {
            var productHandle = $(this).data('handle');
            var status = $.inArray(productHandle, compareObject) !== -1 ? 'added' : '';
            $(this).removeClass('added').addClass(status);
        });

        //count items
        $compareCount.text(compareObject.length);
    }
    $(document).on('click', compareButtonClass, function(event) {
        event.preventDefault();
        updateCompare(this);
        loadCompare();
    });
    $(document).on('click', compareRemoveButtonClass, function() {
        var productHandle = $(this).data('handle');
        compareObject.splice(compareObject.indexOf(productHandle), 1);
        localStorage.setItem('localCompare', JSON.stringify(compareObject));
        loadCompare();
    });

    loadCompare();
    $(document).on('shopify:section:load', loadCompare);
    return {
        load: loadCompare
    }
})()

// Popup newsletter
theme.popupNewletter = (function() {
    var $popupNewsletter = $('#jsPopupNewsletter'),
        $newsletterForm = $('#jsPopupNewsletter form'),
        date = new Date(),
        minutes = theme.timePopupNewsletter;
    minutesdelay = $popupNewsletter.attr('data-delay');
    if ($popupNewsletter.length === 1) {
        date.setTime(date.getTime() + (minutes * 60 * 1000));
        var setCookies = function() {
            $.cookie('cookiesNewsletter', 'disabled', { expires: date, path: '/' });
        };
        if ($.cookie('cookiesNewsletter') !== "disabled") {
            $(window).on('load', function() {
                setTimeout(function() {
                    $popupNewsletter.modal('show');
                }, minutesdelay * 1000);
            });
            $popupNewsletter.on('hidden.bs.modal', setCookies);
            $newsletterForm.submit(setCookies);
        }
    }
})()

// Cookie policy
theme.cookie = (function() {
    var $policy = $('.js-cookie-policy'),
        $closeButton = $('.js-btn-ok'),
        isOk = localStorage.getItem('localCookie') || '';
    if (isOk === '') {
        $policy.fadeIn('slow');
    }
    $closeButton.on('click', function() {
        localStorage.setItem('localCookie', 'accept');
        $policy.fadeOut('slow');
    })
})()

// Announcement Bar
theme.announcement = (function() {
    var $bar = $('.js-announcement-bar'),
        $closeButton = $('.js-ab-close'),
        isClosed = localStorage.getItem('localAnnouncement') || '';
    if (isClosed === '') {
        $bar.fadeIn();
        $bar.closest('.body-theme').addClass('body-announcement-bar');
    }
    $closeButton.on('click', function() {
        localStorage.setItem('localAnnouncement', 'closed');
        $bar.slideUp();
        $bar.closest('.body-theme').removeClass('body-announcement-bar');
    })
})()

// Open external link in new tab
theme.exLink = (function() {
    var links = document.links;
    for (let i = 0, linksLength = links.length; i < linksLength; i++) {
        if (links[i].hostname !== window.location.hostname && $(links[i]).attr('href') !== 'javascript:void(0)') {
            links[i].target = '_blank';
        }
    }
})()

// Deal- countdown
theme.countdown = (function() {
    function initCountdown() {
        $(".js-countdown").each(function() {
            var endTime = $(this).data('time'),
                htmlLayout = "<ul class='list--inline'><li class='gradient-theme-vertical'><span class='countdown-time'>%%D%%</span><span class='countdown-text'>Days</span></li><li class='gradient-theme-vertical'><span class='countdown-time'>%%H%%</span><span class='countdown-text'>Hours</span></li><li class='gradient-theme-vertical'><span class='countdown-time'>%%M%%</span><span class='countdown-text'>Mins</span></li><li class='gradient-theme-vertical'><span class='countdown-time'>%%S%%</span><span class='countdown-text'>Secs</span></li></ul>";
            $(this).lofCountDown({
                TargetDate: endTime,
                DisplayFormat: htmlLayout,
                FinishMessage: '<span class="alert alert-warning d-inline-block">' + theme.strings.countdownEndText + '</span>'
            });
        });
    }
    initCountdown();
    return {
        load: initCountdown
    }
})()

// Price range - Collection page
theme.priceRange = (function() {
    function initPriceRange() {
        var min = 0,
            max = 0,
            slideRange = '#js-slider-range',
            productCard = '.js-product-card',
            slideRangeWrap = '.slider-range-wr',
            rangeMin = '.js-range-min',
            rangeMax = '.js-range-max',
            enablePriceRange = $('#js-slider-range').length === 1 ? true : false;

        if (enablePriceRange) {
            $(productCard).each(function() {
                if (eval($(this).data('price')) > max) max = eval($(this).data('price'));
                if (min == 0) min = eval($(this).data('price'));
                else if (eval($(this).data('price')) < min) min = eval($(this).data('price'));
            });

            if (min === max) {
                $(slideRangeWrap).fadeOut();
            } else {
                $(slideRangeWrap).fadeIn();
            }

            $(slideRange).slider({
                range: true,
                min: min,
                max: max,
                values: [min, max],
                slide: function(event, ui) {
                    var price1 = (Shopify.formatMoney(ui.values[0], theme.moneyFormat));
                    var price2 = (Shopify.formatMoney(ui.values[1], theme.moneyFormat));
                    $(rangeMin).html(price1);
                    $(rangeMax).html(price2);
                    theme.updateCurrencies();

                    // Show/Hide product when dragging
                    $(productCard).each(function() {
                        if (eval($(this).data('price')) >= ui.values[0] && eval($(this).data('price')) <= ui.values[1]) {
                            $(this).parent().fadeIn();
                        } else {
                            $(this).parent().fadeOut();
                        }
                    });
                }
            });

            var price1 = (Shopify.formatMoney(min, theme.moneyFormat));
            var price2 = (Shopify.formatMoney(max, theme.moneyFormat));
            $(rangeMin).html(price1);
            $(rangeMax).html(price2);
            theme.updateCurrencies();

        }
    }
    initPriceRange();
    return {
        load: initPriceRange
    }
})()

// Collection view - Collection page
theme.collectionView = (function() {
    var btnView = '.js-btn-view',
        btnViewActive = '.js-btn-view.active';

    $(document).on('click', btnView, function() {
        var value = $(this).data('col'),
            $gridItemCol = $('.js-col');

        $(btnView).removeClass('active');
        $(this).addClass('active');

        $gridItemCol.removeClass().addClass('js-col col-sm-6 col-12');
        if (value === 3) {
            $gridItemCol.addClass('col-lg-4');
        } else if (value === 4) {
            $gridItemCol.addClass('col-lg-3');
        } else if (value === 5) {
            $gridItemCol.addClass('col-lg-2-4');
        } else if (value === 6) {
            $gridItemCol.addClass('col-lg-2');
        };
    })

    function triggerCollectionView() {
        $(btnViewActive).trigger('click');
    }

    return {
        triggerView: triggerCollectionView
    }
})()

// Swath variant in card item
theme.swatchCard = (function() {
    $(document).on('click', '.js-swatch-card-item', function() { //click or mouseover
        $(".js-swatch-card-item").removeClass("active");
        $(this).addClass("active");
        var newImage = $(this).data('image');
        var id = $(this).data('id');
        var gridItem = $(this).closest('.js-product-card');
        gridItem.find('.product-card__image').find('img').attr('srcset', newImage);
        gridItem.find('.js-grid-cart').data('id', id).attr('data-id', id);
    });
})()

theme.swatchCard2 = (function() {
    function initVariant(id) {
        var productJson = JSON.parse($('.customJson-' + id).html());
        var $selectorForm = $('.customform-' + id);
        var $button = $('.js-customform-addtocart-' + id);
        var $buttontext = $button.find('span');
        var $wrapObject = $selectorForm.closest('.js-product-card');
        var options = {
            $container: $selectorForm,
            enableHistoryState: false,
            product: productJson,
            singleOptionSelector: '.single-option-selector-' + id,
            originalSelectorId: '#ProductSelect-' + id
        };
        var variants = new slate.Variants(options);
        var AjaxCart = new window.AjaxCart($selectorForm);
        var _updateButton = function(evt) {
            var variant = evt.variant;
            if (variant === undefined) {
                $button.prop('disabled', true).removeClass('btn--sold-out');
                $buttontext.html(theme.strings.unavailable);
            } else {
                if (variant.available) {
                    $button.removeClass('btn--sold-out').prop('disabled', false);
                    $buttontext.html(theme.strings.addToCart);
                } else {
                    $button.prop('disabled', true).addClass('btn--sold-out');
                    $buttontext.html(theme.strings.soldOut);
                }
            }
        }
        var _updateImage = function(evt) {
            var variant = evt.variant;
            var $mainImage = $wrapObject.find('.product-card__image').find('img');
            if (variant !== undefined && variant.featured_image !== null) {
                var variantImage = variant.featured_image;
                $mainImage.attr('srcset', variantImage.src);
            }
        }
        var _updatePrice = function(evt) {
            var $price = $wrapObject.find('.product-card__price');
            var variant = evt.variant;
            if (variant !== undefined) {
                var htmlComparePrice = variant.compare_at_price !== null ? '<s class="product-card__regular-price"><span class="money">' + variant.compare_at_price + '</span></s>' : '';
                var htmlPrice = '<span class="money">' + variant.price + '</span>' + htmlComparePrice;
                $price.html(htmlPrice);
                theme.updateCurrencies();
            }
        }
        variants.$container.on(
            'variantChange', _updateButton
        );
        variants.$container.on(
            'variantChange', _updateImage
        );
        variants.$container.on(
            'variantChange', _updatePrice
        );
    }

    function initForm() {
        $('.js-customform').each(function() {
            var id = $(this).data('id');
            initVariant(id);
        })
    }

    initForm();
    return {
        load: initForm
    }
})()

// Loading
theme.loading = (function() {
    var $loading = $('#js-loading'),
        hasLoading = $('#js-loading').length === 0 ? false : true;
    if (hasLoading) {
        $(window).load(function() {
            $loading.fadeOut();
        });
    }
})()

theme.effectLeavingPage = (function() {
    window.onbeforeunload = function() {
        $('body').css('opacity', '0');
    }
})()

// Isotope
theme.isotope = (function() {
    var enableIsotope = $('.enable-isotope').length === 1 ? true : false,
        $grid = $('.js-grid'),
        filter = '.js-filter-isotope';

    function initIsotope() {
        if (enableIsotope) {
            $grid.isotope({
                itemSelector: '.grid-item',
                percentPosition: true
            })
            $(document).on('click', filter, function() {
                var filterValue = $(this).data('filter') === '*' ? $(this).data('filter') : '.' + $(this).data('filter');
                $(filter).removeClass('active');
                $(this).addClass('active');
                $grid.isotope({
                    filter: filterValue
                });
            });
            $(window).scroll(function() {
                $grid.isotope('layout');
            });
            $(window).load(function() {
                $grid.isotope('layout');
                $(filter).first().trigger('click');
            });
        }
    }
    initIsotope();
})()

//aos



// theme.Wow = (function(){
//   new WOW().init();
// })()




// Masonry
theme.Masonry = (function() {
    function Masonry(container) {
        this.$container = $(container).on('init', this._a11y.bind(this));
        var $masonry = this.$container;
        $masonry.isotope({
            itemSelector: '.grid-item',
            percentPosition: true,
            masonry: {
                columnWidth: '.grid-sizer'
            }
        });
        $(window).load(function() {
            $masonry.isotope('layout').css('opacity', '1');
        });
        $(window).scroll(function() {
            $masonry.isotope('layout').css('opacity', '1');
        });
    }

    Masonry.prototype = _.assignIn({}, Masonry.prototype, {
        _a11y: function(event, obj) {
            var $list = obj.$list;
            var $wrapper = this.$container.parent();

            // Remove default Slick aria-live attr until slider is focused
            $list.removeAttr('aria-live');

            // When an element in the slider is focused set aria-live
            $wrapper.on('focusin', function(evt) {
                if ($wrapper.has(evt.target).length) {
                    $list.attr('aria-live', 'polite');
                }
            });

            // Remove aria-live
            $wrapper.on('focusout', function(evt) {
                if ($wrapper.has(evt.target).length) {
                    $list.removeAttr('aria-live');
                }
            });
        }
    });

    return Masonry;
})();



// Cross-selling
theme.crosssell = (function() {
    var crosssellClass = '.js-crosssell',
        handles = $(crosssellClass).data('handles') || '',
        arrayHandle = handles.split(','),
        $blockCrosssell = $('.block-cross-sell'),
        variantSelectClass = '.js-cross-select',
        crossImageClass = '.cross-item-image',
        crossPriceClass = '.cross-item-money';

    function generateCrosssell() {
        for (var i = 0; i < arrayHandle.length; i++) {
            var productHandle = arrayHandle[i];
            Shopify.getProduct(productHandle, function(product) {
                var htmlCross = '',
                    htmlOption = '',
                    firstAvailableVariant = '',
                    variantCount = product.variants.length;

                // generate select box and check first avaiable variant
                for (var j = 0; j < variantCount; j++) {
                    var variant = product.variants[j],
                        variantImage = variant.featured_image === null ? product.featured_image : variant.featured_image.src,
                        disabled = variant.available ? '' : 'disabled';
                    htmlOption += '<option ' + disabled + ' data-id="' + variant.id + '" data-price="' + variant.price + '" data-image="' + variantImage + '">' + variant.title + '</option>';
                    if (firstAvailableVariant === '' && variant.available) {
                        firstAvailableVariant = variant
                    }
                }
                var productPrice = theme.Currency.formatMoney(firstAvailableVariant.price, theme.moneyFormat),
                    productImage = firstAvailableVariant.featured_image === null ? product.featured_image : firstAvailableVariant.featured_image.src,
                    selectHide = variantCount === 1 ? 'hide' : '';

                // generate HTML
                htmlCross += '<div class="col cross-item ' + product.handle + '">';
                htmlCross += '	<a class="cross-item-image" href="' + product.url + '" title="' + product.title + '"><img src="' + productImage + '" />' + theme.strings.cartIcon + '</a>';
                htmlCross += '	<a target="_blank" href="' + product.url + '" title="' + product.title + '" class="cross-item-title">' + product.title + '</a>';
                htmlCross += '	<span class="cross-item-money">' + productPrice + '</span>';
                htmlCross += '	<select class="js-cross-select ' + selectHide + '" data-image="' + productImage + '" data-price="' + firstAvailableVariant.price + '" data-item="' + firstAvailableVariant.id + '">' + htmlOption + '</select>';
                htmlCross += '</div>';
                $(crosssellClass).append(htmlCross);
                theme.updateCurrencies();
            });
        }
    }

    function showPopupCrosssell(lineItem) {
        //generate lineitem;
        var htmlLineItem = '';
        htmlLineItem += '<span class="alert alert-success d-inline-block mb-2">' + theme.strings.addToCartSuccess + '</span>';
        htmlLineItem += '<div><img src="' + lineItem.image + '" alt="Added Product"></div>';
        htmlLineItem += '<h4 class="cross-item-title">' + lineItem.title + '</h4>';
        htmlLineItem += '<div class="mb-2">' + theme.strings.cartQuantity + ': ' + lineItem.quantity + '</div>';
        $('.js-cross-added').hide().html(htmlLineItem).fadeIn();

        // show popup
        var $popupCrosssell = $('#jsCrosssell');
        $popupCrosssell.modal('show');
    }

    if (handles !== '') {
        $(document).on('click', crossImageClass, function(event) {
            event.preventDefault();
            var parent = $(this).closest('.cross-item'),
                itemId = parent.find(variantSelectClass).attr('data-item');
            Shopify.addItem(itemId, 1, function(lineItem) {
                theme.miniCart.updateElements();
                theme.miniCart.generateCart();
                showPopupCrosssell(lineItem);
            });
        });
        $(document).on('change', variantSelectClass, function() {
            var selectVariant = $(this).children(':selected'),
                selectVariantId = selectVariant.data('id'),
                parent = $(this).parent(),
                newPrice = theme.Currency.formatMoney(selectVariant.data('price'), theme.moneyFormat);

            if (selectVariant.data('image') !== '') {
                parent.find(crossImageClass).find('img').attr('src', selectVariant.data('image'));
            }
            $(this).attr('data-item', selectVariantId);
            parent.find(crossPriceClass).html(newPrice);
            theme.updateCurrencies();
        });
        $(document).on('shopify:section:load', generateCrosssell);
        generateCrosssell();
        $blockCrosssell.removeClass('hide');
    }
    return {
        showPopup: showPopupCrosssell
    }
})()

// Upsell
theme.upsell = (function() {
    var popupUpsell = '#jsUpsell',
        $button = $('#jsUpsell .btn'),
        productUpsellId = $('#jsUpsell').data('id') || '',
        buttonAcceptClass = 'js-btn-accept',
        delayTime = $('#jsUpsell').data('delay') || 3000,
        isUpsell = $(popupUpsell).length === 1 ? true : false;
    if (isUpsell) {
        $(document).ready(function() {
            setTimeout(function() {
                $(popupUpsell).modal('show');
            }, delayTime);
        });
        $button.on('click', function() {
            if ($(this).hasClass(buttonAcceptClass)) {
                Shopify.addItem(productUpsellId, 1, function(item) {
                    theme.miniCart.updateElements();
                    theme.miniCart.generateCart();
                    var htmlVariant = item.variant_title !== null ? '<i>(' + item.variant_title + ')</i>' : '';
                    var htmlAlert = '<div class="media mt-2 alert--cart"><a class="mr-3" href="/cart"><img class="lazyload" data-src="' + item.image + '"></a><div class="media-body align-self-center"><p class="m-0 font-weight-bold">' + item.product_title + ' x ' + item.quantity + '</p>' + htmlVariant + '<div><div>';
                    theme.alert.new(theme.strings.addToCartSuccess, htmlAlert, 3000, 'notice');
                })
            }
            $(popupUpsell).modal('hide');
        })
    }
})()

// Coupon
theme.coupon = (function() {
    var popupCoupon = '#jsCoupon',
        $button = $('#jsCoupon .js-btn-coupon'),
        delayTime = $('#jsCoupon').data('delay') || 3000,
        isCoupon = $(popupCoupon).length === 1 ? true : false,
        isCopied = localStorage.getItem('localCoupon') || '';
    if (isCoupon && isCopied === '') {
        $(document).ready(function() {
            setTimeout(function() {
                $(popupCoupon).modal('show');
            }, delayTime);
        });
        $button.on('click', function() {
            var copyText = document.getElementById("coupon_code");
            copyText.select();
            document.execCommand("Copy");
            $(popupCoupon).modal('hide');
            theme.alert.new('Coupon code', 'Successfully copied, now you can paste code at checkout', 4000);
            localStorage.setItem('localCoupon', 'copied');
        })
    }
})()

// Overwrite Shopify.onError in Shopify API
Shopify.onError = function(t, r) {
    var e = eval("(" + t.responseText + ")");
    var mess = e.message ? e.message + "(" + e.status + "): " + e.description : "Error : " + Shopify.fullMessagesFromErrors(e).join("; ") + "."
    theme.alert.new('Alert', mess, 3000, 'warning');
}

// Megamenu width
theme.fixWidthMegamenu = (function() {
    var $megamenuClass = $('.site-nav__item-mega'),
        megaDropdownClass = '.meganav';
    $megamenuClass.each(function() {
        var widthMenu = $(this).data('width') || 0;
        if (widthMenu !== 0) {
            $(this).find(megaDropdownClass).css({ 'width': widthMenu + 'px', 'margin-left': '-' + widthMenu / 2 + 'px' });
        }
    });
})()

// Product video
theme.productVideo = (function() {
    var playButtonClass = '.js-play-button';
    $(document).on('click', playButtonClass, function() {
        let videoSelector = $(this).next(),
            videoObject = videoSelector.get(0);
        $(this).toggleClass('active');
        videoSelector.toggleClass('active');
        videoObject.paused ? videoObject.play() : videoObject.pause();
    })
})()

// Fake-viewers
theme.fakeViewer = (function() {
    var $fakeViewClass = $('.js-fake-view'),
        minValue = $fakeViewClass.data('min'),
        maxValue = $fakeViewClass.data('max'),
        duration = $fakeViewClass.data('duration');

    function randomInRange(start, end) {
        var value = Math.floor(Math.random() * (end - start + 1) + start);
        $fakeViewClass.text(value);
    }

    if (minValue !== undefined && maxValue !== undefined) {
        randomInRange(minValue, maxValue);
        setInterval(function() {
            randomInRange(minValue, maxValue);
        }, duration);
    }

})();

// Product-suggest
theme.productSuggest = (function() {
    var $productSuggestClass = $('.product-notification'),
        $closeButtonClass = $('.close-notifi'),
        duration = $productSuggestClass.data('time') || 0,
        productSuggestCookie = 'cookieSuggest';

    function SomeonePurchased() {
        if ($.cookie(productSuggestCookie) == 'closed') {
            $productSuggestClass.remove();
        }
        $closeButtonClass.on('click', function() {
            $productSuggestClass.remove();
            $.cookie(productSuggestCookie, 'closed', { expires: 1, path: '/' });
        });

        function toggleSomething() {
            if ($productSuggestClass.hasClass('active')) {
                $productSuggestClass.removeClass('active')
            } else {
                var arrayProducts = $('.data-product'),
                    randomProduct = Math.floor(Math.random() * arrayProducts.length),
                    Object = $(arrayProducts[randomProduct]);

                $productSuggestClass.addClass('active');
                $productSuggestClass.find('.product-image').attr('href', Object.data('url')).find('img').attr('src', Object.data('image'));
                $productSuggestClass.find('.product-name').text(Object.data('title')).attr('href', Object.data('url'));
                $productSuggestClass.find('.time-ago').text(Object.data('time'));
                $productSuggestClass.find('.from-ago').text(Object.data('local'));
            }
        }

        if (duration !== 0) {
            setInterval(toggleSomething, duration);
        }
    }
    SomeonePurchased();
})()


// Stickyheader
theme.stickyHeader = (function() {
    var stickHeaderClass = '.site-header--sticky';
    if ($(stickHeaderClass).length !== 0) {
        $(window).scroll(function() {
            if (window.pageYOffset >= 20) {
                $(stickHeaderClass).addClass('active');
            } else {
                $(stickHeaderClass).removeClass('active');
            }
        });
    }
})()

theme.PhotoSwipe = (function() {
    var initPhotoSwipeFromDOM = function(gallerySelector) {

        // parse slide data (url, title, size ...) from DOM elements 
        // (children of gallerySelector)
        var parseThumbnailElements = function(el) {
            var thumbElements = el.childNodes,
                numNodes = thumbElements.length,
                items = [],
                figureEl,
                linkEl,
                size,
                item;

            for (var i = 0; i < numNodes; i++) {

                figureEl = thumbElements[i]; // <figure> element

                // include only element nodes 
                if (figureEl.nodeType !== 1) {
                    continue;
                }

                linkEl = figureEl.children[0]; // <a> element

                size = linkEl.getAttribute('data-size').split('x');

                // create slide object
                item = {
                    src: linkEl.getAttribute('href'),
                    w: parseInt(size[0], 10),
                    h: parseInt(size[1], 10)
                };



                if (figureEl.children.length > 1) {
                    // <figcaption> content
                    item.title = figureEl.children[1].innerHTML;
                }

                if (linkEl.children.length > 0) {
                    // <img> thumbnail element, retrieving thumbnail url
                    item.msrc = linkEl.children[0].getAttribute('src');
                }

                item.el = figureEl; // save link to element for getThumbBoundsFn
                items.push(item);
            }

            return items;
        };

        // find nearest parent element
        var closest = function closest(el, fn) {
            return el && (fn(el) ? el : closest(el.parentNode, fn));
        };

        // triggers when user clicks on thumbnail
        var onThumbnailsClick = function(e) {
            e = e || window.event;
            e.preventDefault ? e.preventDefault() : e.returnValue = false;

            var eTarget = e.target || e.srcElement;

            // find root element of slide
            var clickedListItem = closest(eTarget, function(el) {
                return (el.tagName && el.tagName.toUpperCase() === 'FIGURE');
            });

            if (!clickedListItem) {
                return;
            }

            // find index of clicked item by looping through all child nodes
            // alternatively, you may define index via data- attribute
            var clickedGallery = clickedListItem.parentNode,
                childNodes = clickedListItem.parentNode.childNodes,
                numChildNodes = childNodes.length,
                nodeIndex = 0,
                index;

            for (var i = 0; i < numChildNodes; i++) {
                if (childNodes[i].nodeType !== 1) {
                    continue;
                }

                if (childNodes[i] === clickedListItem) {
                    index = nodeIndex;
                    break;
                }
                nodeIndex++;
            }



            if (index >= 0) {
                // open PhotoSwipe if valid index found
                openPhotoSwipe(index, clickedGallery);
            }
            return false;
        };

        // parse picture index and gallery index from URL (#&pid=1&gid=2)
        var photoswipeParseHash = function() {
            var hash = window.location.hash.substring(1),
                params = {};

            if (hash.length < 5) {
                return params;
            }

            var vars = hash.split('&');
            for (var i = 0; i < vars.length; i++) {
                if (!vars[i]) {
                    continue;
                }
                var pair = vars[i].split('=');
                if (pair.length < 2) {
                    continue;
                }
                params[pair[0]] = pair[1];
            }

            if (params.gid) {
                params.gid = parseInt(params.gid, 10);
            }

            return params;
        };

        var openPhotoSwipe = function(index, galleryElement, disableAnimation, fromURL) {
            var pswpElement = document.querySelectorAll('.pswp')[0],
                gallery,
                options,
                items;

            items = parseThumbnailElements(galleryElement);

            // define options (if needed)
            options = {
                maxSpreadZoom: 1,
                bgOpacity: 0.7,
                zoomEl: true,
                history: false,
                zoomEl: false,
                pinchToClose: false,
                closeOnScroll: false,
                // define gallery index (for URL)
                galleryUID: galleryElement.getAttribute('data-pswp-uid'),

            };

            // PhotoSwipe opened from URL
            if (fromURL) {
                if (options.galleryPIDs) {
                    // parse real index when custom PIDs are used 
                    // http://photoswipe.com/documentation/faq.html#custom-pid-in-url
                    for (var j = 0; j < items.length; j++) {
                        if (items[j].pid == index) {
                            options.index = j;
                            break;
                        }
                    }
                } else {
                    // in URL indexes start from 1
                    options.index = parseInt(index, 10) - 1;
                }
            } else {
                options.index = parseInt(index, 10);
            }

            // exit if index not found
            if (isNaN(options.index)) {
                return;
            }

            if (disableAnimation) {
                options.showAnimationDuration = 0;
            }

            // Pass data to PhotoSwipe and initialize it
            gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, items, options);
            gallery.init();
        };

        // loop through all gallery elements and bind events
        var galleryElements = document.querySelectorAll(gallerySelector);

        for (var i = 0, l = galleryElements.length; i < l; i++) {
            galleryElements[i].setAttribute('data-pswp-uid', i + 1);
            galleryElements[i].onclick = onThumbnailsClick;
        }

        // Parse URL and open gallery if it contains #&pid=3&gid=1
        var hashData = photoswipeParseHash();
        if (hashData.pid && hashData.gid) {
            openPhotoSwipe(hashData.pid, galleryElements[hashData.gid - 1], true, true);
        }
    };

    // execute above function
    initPhotoSwipeFromDOM('.my-gallery');
})()

theme.ZoomImage = (function() {
    $(window).resize(function() {
        var width = $(window).width();
        if (width > 767) {
            ZoomImage();
        }
    });
    $(window).width(function() {
        var width = $(window).width();
        if (width > 767) {
            ZoomImage();
        }
    });

    function ZoomImage() {
        $(".zoom_image").each(function(arg, el) {
            var image = $(el).find("img");
            $(el).zoom({
                on: 'mouseover',
                url: image.attr("src").replace("small", "big")
            });
        });
    }
})()

theme.activeAccordion = (function() {
    $('.collapse').on('shown.bs.collapse', function() {
        $(this).prev().addClass('active-acc');
    });
    $('.collapse').on('hidden.bs.collapse', function() {
        $(this).prev().removeClass('active-acc');
    });
})()


// Anchor scroll
theme.anchorScroll = (function() {
    $(document).on('click', 'a[href^="#"]', function(event) {
        event.preventDefault();
        var disableAnchor = $(this).hasClass('disabled-anchor');
        if (!disableAnchor) {
            $('html, body').animate({
                scrollTop: $($.attr(this, 'href')).offset().top
            }, 500);
        }
    });
})()

// Product-recently-viewed
theme.productRecentlyViewed = (function() {
    var $viewedElement = $('.js-recently-view'),
        $viewButton = $('.js-recently-view-button'),
        $content = $('.js-recently-view-content'),
        productHandle = $viewedElement.data('handle') || '',
        limit = $viewButton.data('limit') || 0,
        arrayProduct = JSON.parse(localStorage.getItem('localRecentlyViewed')) || [],
        lastProduct = arrayProduct[arrayProduct.length - 1] || '',
        isAdded = $.inArray(productHandle, arrayProduct) !== -1 ? true : false;

    function processViewed() {
        if (productHandle !== '') {
            //process last product
            if (lastProduct === productHandle && arrayProduct.length > 1) {
                lastProduct = arrayProduct[arrayProduct.length - 2]
            }

            //move current product to last of array
            if (isAdded) {
                arrayProduct.splice(arrayProduct.indexOf(productHandle), 1);
            }
            arrayProduct.push(productHandle);
            //remove first item if limit
            if (arrayProduct.length > limit) {
                arrayProduct.shift()
            }
            localStorage.setItem('localRecentlyViewed', JSON.stringify(arrayProduct));
        }
    }

    function generatorProduct() {
        $content.html('');
        if (arrayProduct.length > 0) {
            //array
            for (var i = 0; i < arrayProduct.length; i++) {
                var productHandle = arrayProduct[i];
                Shopify.getProduct(productHandle, function(product) {
                    var htmlProduct = '';
                    var productPrice = product.price_varies ? 'from ' + theme.Currency.formatMoney(product.price_min, theme.moneyFormat) : theme.Currency.formatMoney(product.price, theme.moneyFormat);
                    var productComparePrice = product.compare_at_price_min !== 0 ? theme.Currency.formatMoney(product.compare_at_price_min, theme.moneyFormat) : '';
                    htmlProduct += '<div class="col-12 col-lg-4 js-viewed-item mb-4">';
                    htmlProduct += '	<div class="border p-3 rounded media d-flex ">';
                    htmlProduct += '	<a class="mr-3 col-4 p-0" href="' + product.url + '">';
                    htmlProduct += '		<img src="' + product.featured_image + '"/>';
                    htmlProduct += '	</a>';
                    htmlProduct += '	<div class="media-body text-left">';
                    htmlProduct += '		<h4 class="mb-2 mt-2"><a href="' + product.url + '">' + product.title + '</a></h5>';
                    htmlProduct += '	<span> ' + productPrice + '</span>';
                    htmlProduct += '	<s>' + productComparePrice + '</s>';
                    htmlProduct += '	</div>';
                    htmlProduct += '	</div>';
                    htmlProduct += '</div>';
                    $content.append(htmlProduct);
                    theme.updateCurrencies();
                });
            }

            //last product
            Shopify.getProduct(lastProduct, function(product) {
                $viewButton.css('background-image', 'url(' + product.featured_image + ')').addClass('active');
            })
        }
    }

    processViewed();
    generatorProduct();

})()

// Notice when soldout
theme.alert = (function() {
    function createAlert(title, mess, time, type) {
        var aTitle = title || '',
            aTime = time || 2000,
            aMessage = mess || '',
            aClass = type || 'default';
        $.growl({
            title: aTitle,
            message: aMessage,
            duration: aTime,
            style: aClass,
            size: 'large'
        });
    }

    return {
        new: createAlert
    }
})()

// Notice when soldout
theme.noticeSoldout = (function() {
    var $soldoutWrapFormClass = $('.js-contact-soldout'),
        $textClass = $('.js-notify-text'),
        $soldoutValueId = $('#ContactProduct');

    function noticeSoldout(variant) {
        $soldoutWrapFormClass.find('.form-success').remove()
        if (variant.available) {
            $textClass.find('span').text('');
            $soldoutWrapFormClass.addClass('hide');
        } else {
            $textClass.find('span').text(': ' + variant.name);
            $soldoutWrapFormClass.removeClass('hide');
            $soldoutValueId.val(variant.name).attr('value', variant.name);
        }
    }
    return {
        init: noticeSoldout
    }
})()

// Sticky cart
theme.stickyCart = (function() {
    var $anchor = $('#js-anchor-sticky-cart'),
        $stCart = $('.sticky-cart-wr'),
        $close = $('#js-sticky-close'),
        disableStCart = localStorage.getItem('localDisableStCart') || '';
    if (disableStCart !== '') {
        $stCart.addClass('disable');
    }
    $close.on('click', function() {
        var isDisable = disableStCart !== '';
        if (isDisable) {
            localStorage.setItem('localDisableStCart', '');
        } else {
            localStorage.setItem('localDisableStCart', 'true');
        }
        $stCart.toggleClass('disable');
    })
    if ($anchor.length) {
        $(window).on('scroll', function() {
            var hT = $anchor.offset().top,
                hH = $anchor.outerHeight(),
                wH = $(window).height(),
                wS = $(this).scrollTop();
            if (wS > (hT + hH - wH)) {
                $stCart.addClass('active');
            } else {
                $stCart.removeClass('active');
            }
        });
    }

})()

//Fix reload safari
window.addEventListener("pageshow", function(evt) {
    if (evt.persisted) {
        setTimeout(function() {
            window.location.reload();
        }, 10);
    }
}, false);

// Back to top
theme.backToTop = (function() {
    var backtotopClass = $('.js-back-to-top');
    $(window).scroll(function() {
        if ($(this).scrollTop() > 300) {
            backtotopClass.fadeIn('slow');
        } else {
            backtotopClass.fadeOut('slow');
        }
    });
    backtotopClass.on('click', function() {
        $('body,html').animate({ scrollTop: 0 }, 800);
    });
})()


// Tooltip
theme.tooltip = (function() {
    var selector = '[data-toggle="tooltip"],[data-tooltip="true"]';

    function loadTooltip() {
        $(selector).tooltip(); //Bootstrap 4
    };
    $(document).on('click', selector, function() {
        $(this).tooltip('hide');
    });
    loadTooltip();
    return {
        load: loadTooltip
    }
})()

//Collections style 2
theme.Bgcollection = (function() {
    // init Isotope
    function Bgcollection(container) {
        var $container = this.$container = $(container);
        var sectionId = $container.attr('data-section-id');
        var wrapper = this.wrapper = '.bgcollection-wrapper';
        var slider = this.slider = '#Bgcollection-' + sectionId;
        var $slider = $(slider, wrapper);
        $(".colgrid__bg--full[data-index='1']").addClass('active');
        $('.colgrid .colgrid__box').each(function() {
            var index = $(this).attr("data-index");
            $(this).hover(
                function() {
                    $(".colgrid__bg--full[data-index='" + index + "']").addClass('active');
                },
                function() {
                    $(".colgrid__bg--full[data-index='" + index + "']").removeClass('active');
                }
            );
        });
    }

    return Bgcollection;
})();


//Sidebar
theme.sidebar = (function() {
    var togglebutton = '.js-toggle-filter',
        $sidebar = $('.js-sidebar');
    $(document).on('click', togglebutton, function() {
        $sidebar.toggleClass('active');
        $(this).toggleClass('active');
    })
})()

// Ajax filter in collection page
theme.ajaxFilter = (function() {
    var ajaxContent = '#js-product-ajax',
        ajaxSortBy = '#js-sortby',
        ajaxFillter = '#js-fillter',
        ajaxCollectionTitle = '.js-collection-title',
        pageTitle = $(document).find("title").text(),
        jsLoading = '#js-loading';

    var apollo = {
        init: function() {
            this.initFilter();
        },
        showLoading: function() {
            $(jsLoading).show();
        },
        hideLoading: function() {
            $('body,html').animate({
                scrollTop: $('#MainContent').offset().top - 150
            }, 600);
            setTimeout(function() {
                $(jsLoading).hide(); //delay 500ms for better UX
            }, 500);

        },
        initFilter: function() {
            apollo.filterParams();
            apollo.filterSortby();
            apollo.sidebarMapTagEvents();
            apollo.filterMapSorting();
            apollo.filterMapPaging();
        },
        filterParams: function() {
            Shopify.queryParams = {};
            if (location.search.length) {
                for (var aKeyValue, i = 0, aCouples = location.search.substr(1).split('&'); i < aCouples.length; i++) {
                    aKeyValue = aCouples[i].split('=');
                    if (aKeyValue.length > 1) {
                        Shopify.queryParams[decodeURIComponent(aKeyValue[0])] = decodeURIComponent(aKeyValue[1]);
                    }
                }
            }
        },
        filterSortby: function() {
            if (Shopify.queryParams.sort_by) {
                var sortby = Shopify.queryParams.sort_by;
                $(ajaxSortBy).val(sortby);
            }
        },
        filterCreateUrl: function(baseLink) {
            var newQuery = $.param(Shopify.queryParams).replace(/%2B/g, '+');
            if (baseLink) {
                if (newQuery != "") {
                    return baseLink + "?" + newQuery;
                } else {
                    return baseLink;
                }
            }
            return location.pathname + "?" + newQuery;
        },
        filterMapData: function(data) {
            // 1. update product grid
            $(ajaxContent).html($(ajaxContent, data.responseText).html());
            // 2. update left filter
            $(ajaxFillter).html($(ajaxFillter, data.responseText).html());
            // 3. update collection title
            $(ajaxCollectionTitle).html($(ajaxCollectionTitle, data.responseText).html());
        },
        filterAjaxClick: function(baseLink) {
            delete Shopify.queryParams.page;
            var newurl = apollo.filterCreateUrl(baseLink);
            History.pushState({
                param: Shopify.queryParams
            }, pageTitle, newurl);
            apollo.filterGetContent(newurl);
        },
        filterGetContent: function(newurl) {
            $.ajax({
                type: 'GET',
                url: newurl,
                data: {},
                beforeSend: function() {
                    apollo.showLoading();
                },
                complete: function(data) {
                    apollo.filterMapData(data);
                    theme.wishlist.load();
                    theme.compare.load();
                    theme.countdown.load();
                    theme.priceRange.load();
                    theme.tooltip.load();
                    theme.collectionView.triggerView();
                    theme.swatchCard2.load();
                    theme.infiniteScroll.load();
                    apollo.hideLoading();
                },
                error: function(xhr, text) {
                    apollo.hideLoading();
                    alert($.parseJSON(xhr.responseText).description);
                }
            });
        },
        sidebarMapTagEvents: function() {
            $(document).on('click', '.advanced-filter a', function(event) {
                event.preventDefault();
                $('.tooltip').removeClass('show');
                var currentTags = [];
                if (Shopify.queryParams.constraint) {
                    currentTags = Shopify.queryParams.constraint.split('+');
                }
                if (!$(this).parent().hasClass("active-filter")) {
                    var otherTag = $(this).parents('.catalog_filter_ul').find("li.active-filter");
                    if (otherTag.length > 0) {
                        var tagName = otherTag.data("handle");
                        if (tagName) {
                            var tagPos = currentTags.indexOf(tagName);
                            if (tagPos >= 0) {
                                currentTags.splice(tagPos, 1);
                            }
                        }
                    }
                }
                var dataHandle = $(this).parent().data("handle");
                if (dataHandle) {
                    var tagPos = currentTags.indexOf(dataHandle);
                    if (tagPos >= 0) {
                        currentTags.splice(tagPos, 1);
                    } else {
                        currentTags.push(dataHandle);
                    }
                }
                if (currentTags.length) {
                    Shopify.queryParams.constraint = currentTags.join('+');
                } else {
                    delete Shopify.queryParams.constraint;
                }
                apollo.filterAjaxClick();
            });
            $(document).on('click', '.advanced-filter .icon', function() {
                $(this).parent('.advanced-filter').find('a').trigger("click");
            });
        },
        filterMapSorting: function() {
            $(document).on('change', ajaxSortBy, function() {
                Shopify.queryParams.sort_by = $(this).val();
                apollo.filterAjaxClick();
            })
        },
        filterMapPaging: function() {
            $(document).on('click', '.js-pagination a', function() {
                event.preventDefault();
                var linkPage = $(this).attr("href").match(/page=\d+/g);
                if (linkPage) {
                    Shopify.queryParams.page = parseInt(linkPage[0].match(/\d+/g));
                    if (Shopify.queryParams.page) {
                        var newurl = apollo.filterCreateUrl();
                        History.pushState({
                            param: Shopify.queryParams
                        }, pageTitle, newurl);
                        apollo.filterGetContent(newurl);
                    }
                }
            });
        }
    }

    if ($(".template-collection")) {
        History.Adapter.bind(window, 'statechange', function() {
            var State = History.getState();
            apollo.filterParams();
        });
    }
    apollo.init();

})();
$(theme.init);r image = images[i];
            this.loadImage(this.getSizedImageUrl(image, size));
        }
    }

    /**
     * Loads and caches an image in the browsers cache.
     * @param {string} path - An image url
     */
    function loadImage(path) {
        new Image().src = path;
    }

    /**
     * Swaps the src of an image for another OR returns the imageURL to the callback function
     * @param image
     * @param element
     * @param callback
     */
    function switchImage(image, element, callback) {
        var size = this.imageSize(element.src);
        var imageUrl = this.getSizedImageUrl(image.src, size);

        if (callback) {
            callback(imageUrl, image, element); // eslint-disable-line callback-return
        } else {
            element.src = imageUrl;
        }
    }

    /**
     * +++ Useful
     * Find the Shopify image attribute size
     *
     * @param {string} src
     * @returns {null}
     */
    function imageSize(src) {
        src = src || '';

        var match = src.match(
            /.+_((?:pico|icon|thumb|small|compact|medium|large|grande)|\d{1,4}x\d{0,4}|x\d{1,4})[_\\.@]/
        );

        if (match === null) {
            return null;
        } else {
            return match[1];
        }
    }

    /**
     * +++ Useful
     * Adds a Shopify size attribute to a URL
     *
     * @param src
     * @param size
     * @returns {*}
     */
    function getSizedImageUrl(src, size) {
        if (size === null) {
            return src;
        }

        if (size === 'master') {
            return this.removeProtocol(src);
        }

        var match = src.match(
            /\.(jpg|jpeg|gif|png|bmp|bitmap|tiff|tif)(\?v=\d+)?$/i
        );

        if (match !== null) {
            var prefix = src.split(match[0]);
            var suffix = match[0];

            return this.removeProtocol(prefix[0] + '_' + size + suffix);
        }

        return null;
    }

    function removeProtocol(path) {
        return path.replace(/http(s)?:/, '');
    }

    return {
        preload: preload,
        loadImage: loadImage,
        switchImage: switchImage,
        imageSize: imageSize,
        getSizedImageUrl: getSizedImageUrl,
        removeProtocol: removeProtocol
    };
})();

/**
 * Variant Selection scripts
 * ------------------------------------------------------------------------------
 *
 * Handles change events from the variant inputs in any `cart/add` forms that may
 * exist.  Also updates the master select and triggers updates when the variants
 * price or image changes.
 *
 * @namespace variants
 */

slate.Variants = (function() {
    /**
     * Variant constructor
     *
     * @param {object} options - Settings from `product.js`
     */
    function Variants(options) {
        this.$container = options.$container;
        this.product = options.product;
        this.singleOptionSelector = options.singleOptionSelector;
        this.originalSelectorId = options.originalSelectorId;
        this.enableHistoryState = options.enableHistoryState;
        this.currentVariant = this._getVariantFromOptions();

        $(this.singleOptionSelector, this.$container).on(
            'change',
            this._onSelectChange.bind(this)
        );
    }

    Variants.prototype = _.assignIn({}, Variants.prototype, {
        /**
         * Get the currently selected options from add-to-cart form. Works with all
         * form input elements.
         *
         * @return {array} options - Values of currently selected variants
         */
        _getCurrentOptions: function() {
            var currentOptions = _.map(
                $(this.singleOptionSelector, this.$container),
                function(element) {
                    var $element = $(element);
                    var type = $element.attr('type');
                    var currentOption = {};

                    if (type === 'radio' || type === 'checkbox') {
                        if ($element[0].checked) {
                            currentOption.value = $element.val();
                            currentOption.index = $element.data('index');

                            return currentOption;
                        } else {
                            return false;
                        }
                    } else {
                        currentOption.value = $element.val();
                        currentOption.index = $element.data('index');

                        return currentOption;
                    }
                }
            );

            // remove any unchecked input values if using radio buttons or checkboxes
            currentOptions = _.compact(currentOptions);

            return currentOptions;
        },

        /**
         * Find variant based on selected values.
         *
         * @param  {array} selectedValues - Values of variant inputs
         * @return {object || undefined} found - Variant object from product.variants
         */
        _getVariantFromOptions: function() {
            var selectedValues = this._getCurrentOptions();
            var variants = this.product.variants;

            var found = _.find(variants, function(variant) {
                return selectedValues.every(function(values) {
                    return _.isEqual(variant[values.index], values.value);
                });
            });

            return found;
        },

        /**
         * Event handler for when a variant input changes.
         */
        _onSelectChange: function() {
            var variant = this._getVariantFromOptions();

            this.$container.trigger({
                type: 'variantChange',
                variant: variant
            });

            if (!variant) {
                return;
            }

            this._updateMasterSelect(variant);
            this._updateImages(variant);
            this._updatePrice(variant);
            this._updateSKU(variant);
            this.currentVariant = variant;

            if (this.enableHistoryState) {
                this._updateHistoryState(variant);
            }
        },

        /**
         * Trigger event when variant image changes
         *
         * @param  {object} variant - Currently selected variant
         * @return {event}  variantImageChange
         */
        _updateImages: function(variant) {
            var variantImage = variant.featured_image || {};
            var currentVariantImage = this.currentVariant.featured_image || {};

            if (!variant.featured_image ||
                variantImage.src === currentVariantImage.src
            ) {
                return;
            }

            this.$container.trigger({
                type: 'variantImageChange',
                variant: variant
            });
        },

        /**
         * Trigger event when variant price changes.
         *
         * @param  {object} variant - Currently selected variant
         * @return {event} variantPriceChange
         */
        _updatePrice: function(variant) {
            if (
                variant.price === this.currentVariant.price &&
                variant.compare_at_price === this.currentVariant.compare_at_price
            ) {
                return;
            }

            this.$container.trigger({
                type: 'variantPriceChange',
                variant: variant
            });
        },

        /**
         * Trigger event when variant sku changes.
         *
         * @param  {object} variant - Currently selected variant
         * @return {event} variantSKUChange
         */
        _updateSKU: function(variant) {
            if (variant.sku === this.currentVariant.sku) {
                return;
            }

            this.$container.trigger({
                type: 'variantSKUChange',
                variant: variant
            });
        },

        /**
         * Update history state for product deeplinking
         *
         * @param  {variant} variant - Currently selected variant
         * @return {k}         [description]
         */
        _updateHistoryState: function(variant) {
            if (!history.replaceState || !variant) {
                return;
            }

            var newurl =
                window.location.protocol +
                '//' +
                window.location.host +
                window.location.pathname +
                '?variant=' +
                variant.id;
            window.history.replaceState({ path: newurl }, '', newurl);
        },

        /**
         * Update hidden master select of variant change
         *
         * @param  {variant} variant - Currently selected variant
         */
        _updateMasterSelect: function(variant) {
            $(this.originalSelectorId, this.$container).val(variant.id);
        }
    });

    return Variants;
})();


/*================ MODULES ================*/
window.Drawers = (function() {
    var Drawer = function(id, position, options) {
        var defaults = {
            close: '.js-drawer-close',
            open: '.js-drawer-open-' + position,
            openClass: 'js-drawer-open',
            dirOpenClass: 'js-drawer-open-' + position
        };

        this.nodes = {
            $parent: $('body, html'),
            $page: $('.page-element'),
            $moved: $('.is-moved-by-drawer')
        };

        this.config = $.extend(defaults, options);
        this.position = position;

        this.$drawer = $('#' + id);
        this.$open = $(this.config.open);

        if (!this.$drawer.length) {
            return false;
        }

        this.drawerIsOpen = false;
        this.init();
    };

    Drawer.prototype.init = function() {
        this.$open.attr('aria-expanded', 'false');
        this.$open.on('click', $.proxy(this.open, this));
        this.$drawer.find(this.config.close).on('click', $.proxy(this.close, this));
    };

    Drawer.prototype.open = function(evt) {
        // Keep track if drawer was opened from a click, or called by another function
        var externalCall = false;

        // don't open an opened drawer
        if (this.drawerIsOpen) {
            return;
        }

        this.$open.addClass(this.config.openClass);

        // Prevent following href if link is clicked
        if (evt) {
            evt.preventDefault();
        } else {
            externalCall = true;
        }

        // Without this, the drawer opens, the click event bubbles up to $nodes.page
        // which closes the drawer.
        if (evt && evt.stopPropagation) {
            evt.stopPropagation();
            // save the source of the click, we'll focus to this on close
            this.$activeSource = $(evt.currentTarget);
        }

        if (this.drawerIsOpen && !externalCall) {
            return this.close();
        }

        // Add is-transitioning class to moved elements on open so drawer can have
        // transition for close animation
        this.nodes.$moved.addClass('is-transitioning');
        this.$drawer.prepareTransition();

        this.nodes.$parent.addClass(
            this.config.openClass + ' ' + this.config.dirOpenClass
        );
        this.drawerIsOpen = true;

        // Set focus on drawer
        slate.a11y.trapFocus({
            $container: this.$drawer,
            namespace: 'drawer_focus'
        });

        // Run function when draw opens if set
        if (
            this.config.onDrawerOpen &&
            typeof this.config.onDrawerOpen === 'function'
        ) {
            if (!externalCall) {
                this.config.onDrawerOpen();
            }
        }

        if (this.$activeSource && this.$activeSource.attr('aria-expanded')) {
            this.$activeSource.attr('aria-expanded', 'true');
        }

        this.bindEvents();
    };

    Drawer.prototype.close = function() {
        // don't close a closed drawer
        if (!this.drawerIsOpen) {
            return;
        }

        this.$open.removeClass(this.config.openClass);

        // deselect any focused form elements
        $(document.activeElement).trigger('blur');

        // Ensure closing transition is applied to moved elements, like the nav
        this.nodes.$moved.prepareTransition({ disableExisting: true });
        this.$drawer.prepareTransition({ disableExisting: true });

        this.nodes.$parent.removeClass(
            this.config.dirOpenClass + ' ' + this.config.openClass
        );

        this.drawerIsOpen = false;

        // Remove focus on drawer
        slate.a11y.removeTrapFocus({
            $container: this.$drawer,
            namespace: 'drawer_focus'
        });

        if (this.$activeSource && this.$activeSource.attr('aria-expanded')) {
            this.$activeSource.attr('aria-expanded', 'false');
        }

        this.unbindEvents();
    };

    Drawer.prototype.bindEvents = function() {
        // Lock scrolling on mobile
        this.nodes.$page.on('touchmove.drawer', function() {
            return false;
        });

        // Clicking out of drawer closes it
        this.nodes.$page.on(
            'click.drawer',
            $.proxy(function() {
                this.close();
                return false;
            }, this)
        );

        // Pressing escape closes drawer
        this.nodes.$parent.on(
            'keyup.drawer',
            $.proxy(function(evt) {
                if (evt.keyCode === 27) {
                    this.close();
                }
            }, this)
        );
    };

    Drawer.prototype.unbindEvents = function() {
        this.nodes.$page.off('.drawer');
        this.nodes.$parent.off('.drawer');
    };

    return Drawer;
})();

window.Modals = (function() {
    var Modal = function(id, name, options) {
        var defaults = {
            close: '.js-modal-close',
            open: '.js-modal-open-' + name,
            openClass: 'modal--is-active'
        };

        this.$modal = $('#' + id);

        if (!this.$modal.length) {
            return false;
        }

        this.nodes = {
            $body: $('body')
        };

        this.config = $.extend(defaults, options);

        this.modalIsOpen = false;
        this.$focusOnOpen = this.config.focusOnOpen ?
            $(this.config.focusOnOpen) :
            this.$modal;
        this.init();
    };

    Modal.prototype.init = function() {
        var $openBtn = $(this.config.open);

        // Add aria controls
        $openBtn.attr('aria-expanded', 'false');

        $(this.config.open).on('click', $.proxy(this.open, this));
        this.$modal.find(this.config.close).on('click', $.proxy(this.close, this));
    };

    Modal.prototype.open = function(evt) {
        // Keep track if modal was opened from a click, or called by another function
        var externalCall = false;

        // don't open an opened modal
        if (this.modalIsOpen) {
            return;
        }

        // Prevent following href if link is clicked
        if (evt) {
            evt.preventDefault();
        } else {
            externalCall = true;
        }

        // Without this, the modal opens, the click event bubbles up to $nodes.page
        // which closes the modal.
        if (evt && evt.stopPropagation) {
            evt.stopPropagation();
            // save the source of the click, we'll focus to this on close
            this.$activeSource = $(evt.currentTarget);
        }

        if (this.modalIsOpen && !externalCall) {
            return this.close();
        }

        this.$modal.prepareTransition().addClass(this.config.openClass);
        this.nodes.$body.addClass(this.config.openClass);

        this.modalIsOpen = true;

        // Set focus on modal
        slate.a11y.trapFocus({
            $container: this.$modal,
            namespace: 'modal_focus',
            $elementToFocus: this.$focusOnOpen
        });

        if (this.$activeSource && this.$activeSource.attr('aria-expanded')) {
            this.$activeSource.attr('aria-expanded', 'true');
        }

        this.bindEvents();
    };

    Modal.prototype.close = function() {
        // don't close a closed modal
        if (!this.modalIsOpen) {
            return;
        }

        // deselect any focused form elements
        $(document.activeElement).trigger('blur');

        this.$modal.prepareTransition().removeClass(this.config.openClass);
        this.nodes.$body.removeClass(this.config.openClass);

        this.modalIsOpen = false;

        // Remove focus on modal
        slate.a11y.removeTrapFocus({
            $container: this.$modal,
            namespace: 'modal_focus'
        });

        if (this.$activeSource && this.$activeSource.attr('aria-expanded')) {
            this.$activeSource.attr('aria-expanded', 'false').focus();
        }

        this.unbindEvents();
    };

    Modal.prototype.bindEvents = function() {
        // Pressing escape closes modal
        this.nodes.$body.on(
            'keyup.modal',
            $.proxy(function(evt) {
                if (evt.keyCode === 27) {
                    this.close();
                }
            }, this)
        );
    };

    Modal.prototype.unbindEvents = function() {
        this.nodes.$body.off('.modal');
    };

    return Modal;
})();

window.QtySelector = (function() {
    var QtySelector = function($el) {
        this.cache = {
            $body: $('body'),
            $subtotal: $('#CartSubtotal'),
            $discountTotal: $('#cartDiscountTotal'),
            $cartTable: $('.cart-table'),
            $cartTemplate: $('#CartProducts')
        };

        this.settings = {
            loadingClass: 'js-qty--is-loading',
            isCartTemplate: this.cache.$body.hasClass('template-cart'),
            // On the cart template, minimum is 0. Elsewhere min is 1
            minQty: this.cache.$body.hasClass('template-cart') ? 0 : 1
        };

        this.$el = $el;
        this.qtyUpdateTimeout;
        this.createInputs();
        this.bindEvents();
    };

    QtySelector.prototype.createInputs = function() {
        var $el = this.$el;

        var data = {
            value: $el.val(),
            key: $el.attr('id'),
            name: $el.attr('name'),
            line: $el.attr('data-line')
        };
        var source = $('#QuantityTemplate').html();
        var template = Handlebars.compile(source);

        this.$wrapper = $(template(data)).insertBefore($el);

        // Remove original number input
        $el.remove();
    };

    QtySelector.prototype.validateAvailability = function(line, quantity) {
        var product = theme.cartObject.items[line - 1]; // 0-based index in API
        var handle = product.handle; // needed for the ajax request
        var id = product.id; // needed to find right variant from ajax results

        var params = {
            type: 'GET',
            url: '/products/' + handle + '.js',
            dataType: 'json',
            success: $.proxy(function(cartProduct) {
                this.validateAvailabilityCallback(line, quantity, id, cartProduct);
            }, this)
        };

        $.ajax(params);
    };

    QtySelector.prototype.validateAvailabilityCallback = function(
        line,
        quantity,
        id,
        product
    ) {
        var quantityIsAvailable = true;

        // This returns all variants of a product.
        // Loop through them to get our desired one.
        for (var i = 0; i < product.variants.length; i++) {
            var variant = product.variants[i];
            if (variant.id === id) {
                break;
            }
        }

        // If the variant tracks inventory and does not sell when sold out
        // we can compare the requested with available quantity
        if (
            variant.inventory_management !== null &&
            variant.inventory_policy === 'deny'
        ) {
            if (variant.inventory_quantity < quantity) {

                // Set quantity to max amount available
                this.$wrapper.find('.js-qty__input').val(variant.inventory_quantity);

                quantityIsAvailable = false;
                this.$wrapper.removeClass(this.settings.loadingClass);
            }
        }

        if (quantityIsAvailable) {
            this.updateItemQuantity(line, quantity);
        }
    };

    QtySelector.prototype.validateQty = function(qty) {
        if (parseFloat(qty) === parseInt(qty, 10) && !isNaN(qty)) {
            // We have a valid number!
        } else {
            // Not a number. Default to 1.
            qty = 1;
        }
        return parseInt(qty, 10);
    };

    QtySelector.prototype.adjustQty = function(evt) {
        var $el = $(evt.currentTarget);
        var $input = $el.siblings('.js-qty__input');
        var qty = this.validateQty($input.val());
        var line = $input.attr('data-line');

        if ($el.hasClass('js-qty__adjust--minus')) {
            qty -= 1;
            if (qty <= this.settings.minQty) {
                qty = this.settings.minQty;
            }
        } else {
            qty += 1;
        }

        if (this.settings.isCartTemplate) {
            $el.parent().addClass(this.settings.loadingClass);
            this.updateCartItemPrice(line, qty);
        } else {
            $input.val(qty);
        }
    };

    QtySelector.prototype.bindEvents = function() {
        this.$wrapper
            .find('.js-qty__adjust')
            .on('click', $.proxy(this.adjustQty, this));

        // Select input text on click
        this.$wrapper.on('click', '.js-qty__input', function() {
            this.setSelectionRange(0, this.value.length);
        });

        // If the quantity changes on the cart template, update the price
        if (this.settings.isCartTemplate) {
            this.$wrapper.on(
                'change',
                '.js-qty__input',
                $.proxy(function(evt) {
                    var $input = $(evt.currentTarget);
                    var line = $input.attr('data-line');
                    var qty = this.validateQty($input.val());
                    $input.parent().addClass(this.settings.loadingClass);
                    this.updateCartItemPrice(line, qty);
                }, this)
            );
        }
    };

    QtySelector.prototype.updateCartItemPrice = function(line, qty) {
        // Update cart after short timeout so user doesn't create simultaneous ajax calls
        clearTimeout(this.qtyUpdateTimeout);
        this.qtyUpdateTimeout = setTimeout(
            $.proxy(function() {
                this.validateAvailability(line, qty);
            }, this),
            200
        );
    };

    QtySelector.prototype.updateItemQuantity = function(line, quantity) {
        var params = {
            type: 'POST',
            url: '/cart/change.js',
            data: 'quantity=' + quantity + '&line=' + line,
            dataType: 'json',
            success: $.proxy(function(cart) {
                this.updateCartItemCallback(cart);
            }, this)
        };

        $.ajax(params);
    };

    QtySelector.prototype.updateCartItemCallback = function(cart) {
        // Reload the page to show the empty cart if no items
        if (cart.item_count === 0) {
            location.reload();
            return;
        }

        // Update cart object
        theme.cartObject = cart;

        // Handlebars.js cart layout
        var data = {};
        var items = [];
        var item = {};
        var source = $('#CartProductTemplate').html();
        var template = Handlebars.compile(source);
        var prodImg;

        // Add each item to our handlebars.js data
        $.each(cart.items, function(index, cartItem) {
            /* Hack to get product image thumbnail
             *   - If image is not null
             *     - Remove file extension, add 240x240, and re-add extension
             *     - Create server relative link
             *   - A hard-coded url of no-image
             */

            if (cartItem.image === null) {
                prodImg =
                    '//cdn.shopify.com/s/assets/admin/no-image-medium-cc9732cb976dd349a0df1d39816fbcc7.gif';
            } else {
                prodImg = cartItem.image
                    .replace(/(\.[^.]*)$/, '_240x240$1')
                    .replace('http:', '');
            }

            if (cartItem.properties !== null) {
                $.each(cartItem.properties, function(key, value) {
                    if (key.charAt(0) === '_' || !value) {
                        delete cartItem.properties[key];
                    }
                });
            }

            // Create item's data object and add to 'items' array
            item = {
                key: cartItem.key,
                line: index + 1, // Shopify uses a 1+ index in the API
                url: cartItem.url,
                img: prodImg,
                name: cartItem.product_title,
                variation: cartItem.variant_title,
                properties: cartItem.properties,
                itemQty: cartItem.quantity,
                price: theme.Currency.formatMoney(cartItem.price, theme.moneyFormat),
                vendor: cartItem.vendor,
                linePrice: theme.Currency.formatMoney(
                    cartItem.line_price,
                    theme.moneyFormat
                ),
                originalLinePrice: theme.Currency.formatMoney(
                    cartItem.original_line_price,
                    theme.moneyFormat
                ),
                discounts: cartItem.discounts,
                discountsApplied: cartItem.line_price === cartItem.original_line_price ? false : true
            };

            items.push(item);
            theme.updateCurrencies();
        });

        // Gather all cart data and add to DOM
        data = {
            items: items
        };
        this.cache.$cartTemplate.empty().append(template(data));

        // Create new quantity selectors
        this.cache.$cartTable.find('input[type="number"]').each(function(i, el) {
            new QtySelector($(el));
        });

        // Update the cart subtotal
        this.cache.$subtotal.html(
            theme.Currency.formatMoney(cart.total_price, theme.moneyFormat)
        );

        // Update the cart total discounts
        if (cart.total_discount > 0) {
            this.cache.$discountTotal.html(
                theme.strings.totalCartDiscount.replace(
                    '[savings]',
                    theme.Currency.formatMoney(cart.total_discount, theme.moneyFormat)
                )
            );
        } else {
            this.cache.$discountTotal.empty();
        }

        theme.miniCart.updateElements();
        theme.updateCurrencies();
        // Set focus on cart table
        slate.a11y.pageLinkFocus(this.cache.$cartTable);
    };

    return QtySelector;
})();

/*
  Allow product to be added to cart via ajax with
  custom success and error responses.
*/
window.AjaxCart = (function() {
    var styleCart = $('.js-mini-cart').attr("data-cartmini");
    var cart = function($form) {
        this.cache = {
            $cartIconIndicator: $('.site-header__cart-indicator')
        };

        this.$form = $form;
        this.eventListeners();

        this.showNotice = false;
        if (this.$form.length) {
            this.showNotice = this.$form.hasClass('js-form--notice') ? true : false;
        }
    };

    cart.prototype.eventListeners = function() {
        if (this.$form.length) {
            this.$form.on('submit', $.proxy(this.addItemFromForm, this));
        }
    };

    cart.prototype.addItemFromForm = function(evt) {
        evt.preventDefault();

        var params = {
            type: 'POST',
            url: '/cart/add.js',
            data: this.$form.serialize(),
            dataType: 'json',
            success: $.proxy(function(lineItem) {
                //this.success(lineItem);
                window.location.href = '/cart';
            }, this),
            error: $.proxy(function(XMLHttpRequest, textStatus) {
                this.error(XMLHttpRequest, textStatus);
            }, this)
        };
        $.ajax(params);
    };

    cart.prototype.success = function(item) {
        theme.miniCart.updateElements();
        theme.miniCart.generateCart();
        if (styleCart != 'false') {
            if (this.showNotice) {
                var htmlVariant = item.variant_title !== null ? '<i>(' + item.variant_title + ')</i>' : '';
                var htmlAlert = '<div class="media mt-2 alert--cart"><a class="mr-3" href="/cart"><img class="lazyload" data-src="' + item.image + '"></a><div class="media-body align-self-center"><p class="m-0 font-weight-bold">' + item.product_title + ' x ' + item.quantity + '</p>' + htmlVariant + '<div><div>';
                theme.alert.new(theme.strings.addToCartSuccess, htmlAlert, 3000, 'notice');
            } else {
                theme.crosssell.showPopup(item);
            }
        }
    };

    // Error handling reference from Shopify.onError in api.jquery.js
    cart.prototype.error = function(XMLHttpRequest) {
        var data = JSON.parse(XMLHttpRequest.responseText);

        if (data.message) {
            theme.alert.new('', data.description, 3000, 'warning');
        }
    };

    return cart;
})();

/*================ TEMPLATES ================*/
theme.customerTemplates = (function() {
    function initEventListeners() {
        // Show reset password form
        $('#RecoverPassword').on('click', function(evt) {
            evt.preventDefault();
            toggleRecoverPasswordForm();
        });

        // Hide reset password form
        $('#HideRecoverPasswordLink').on('click', function(evt) {
            evt.preventDefault();
            toggleRecoverPasswordForm();
        });
    }

    /**
     *
     *  Show/Hide recover password form
     *
     */
    function toggleRecoverPasswordForm() {
        $('#RecoverPasswordForm').toggleClass('hide');
        $('#CustomerLoginForm').toggleClass('hide');
    }

    /**
     *
     *  Show reset password success message
     *
     */
    function resetPasswordSuccess() {
        // check if reset password form was successfully submited
        if (!$('.reset-password-success').length) {
            return;
        }

        // show success message
        $('#ResetSuccess').removeClass('hide');
    }

    /**
     *
     *  Show/hide customer address forms
     *
     */
    function customerAddressForm() {
        var $newAddressForm = $('#AddressNewForm');

        if (!$newAddressForm.length) {
            return;
        }

        // Initialize observers on address selectors, defined in shopify_common.js
        if (Shopify) {
            // eslint-disable-next-line no-new
            new Shopify.CountryProvinceSelector(
                'AddressCountryNew',
                'AddressProvinceNew', {
                    hideElement: 'AddressProvinceContainerNew'
                }
            );
        }

        // Initialize each edit form's country/province selector
        $('.address-country-option').each(function() {
            var formId = $(this).data('form-id');
            var countrySelector = 'AddressCountry_' + formId;
            var provinceSelector = 'AddressProvince_' + formId;
            var containerSelector = 'AddressProvinceContainer_' + formId;

            // eslint-disable-next-line no-new
            new Shopify.CountryProvinceSelector(countrySelector, provinceSelector, {
                hideElement: containerSelector
            });
        });

        // Toggle new/edit address forms
        $('.address-new-toggle').on('click', function() {
            $newAddressForm.toggleClass('hide');
        });

        $('.address-edit-toggle').on('click', function() {
            var formId = $(this).data('form-id');
            $('#EditAddress_' + formId).toggleClass('hide');
        });

        $('.address-delete').on('click', function() {
            var $el = $(this);
            var formId = $el.data('form-id');
            var confirmMessage = $el.data('confirm-message');

            // eslint-disable-next-line no-alert
            if (
                confirm(
                    confirmMessage || 'Are you sure you wish to delete this address?'
                )
            ) {
                Shopify.postLink('/account/addresses/' + formId, {
                    parameters: { _method: 'delete' }
                });
            }
        });
    }

    /**
     *
     *  Check URL for reset password hash
     *
     */
    function checkUrlHash() {
        var hash = window.location.hash;

        // Allow deep linking to recover password form
        if (hash === '#recover') {
            toggleRecoverPasswordForm();
        }
    }

    return {
        init: function() {
            checkUrlHash();
            initEventListeners();
            resetPasswordSuccess();
            customerAddressForm();
        }
    };
})();

/*================ SECTIONS ================*/
theme.HeaderSection = (function() {
    function Header() {
        theme.NavDrawer = new window.Drawers('NavDrawer', 'left');
    }

    return Header;
})();

theme.Product = (function() {
    var defaults = {
        smallBreakpoint: 750,
        productThumbIndex: 0,
        productThumbMax: 0,
        ajaxCart: false,
        stockSetting: false
    };

    function Product(container) {
        var $container = (this.$container = $(container));
        var sectionId = $container.attr('data-section-id');

        this.selectors = {
            originalSelectorId: '#ProductSelect-' + sectionId,
            modal: 'ProductModal',
            productZoomImage: '#ProductZoomImg',
            addToCart: '#AddToCart-' + sectionId,
            productPrice: '#ProductPrice-' + sectionId,
            comparePrice: '#ComparePrice-' + sectionId,
            addToCartText: '#AddToCartText-' + sectionId,
            SKU: '.js-variant-sku',
            productImageContainers: '.product__photo-container-' + sectionId,
            productImageWrappers: '.product__photo-wrapper-' + sectionId,
            productThumbContainers: '.product-single__thumbnail-item-' + sectionId,
            productThumbsWrapper: '.product-single__thumbnails-' + sectionId,
            productThumbs: '.product-single__thumbnail-' + sectionId,
            saleTag: '#ProductSaleTag-' + sectionId,
            productStock: '#ProductStock-' + sectionId,
            singleOptionSelector: '.single-option-selector-' + sectionId,
            shopifyPaymentButton: '.shopify-payment-button',
            availability: '.product-single__availability',
            hurrify: '.js-hurrify'
        };

        this.settings = $.extend({}, defaults, {
            sectionId: sectionId,
            ajaxCart: $container.data('ajax'),
            stockSetting: $container.data('stock'),
            enableHistoryState: $container.data('enable-history-state') || false,
            namespace: '.product-' + sectionId
        });

        // Stop parsing if we don't have the product json script tag
        if (!$('#ProductJson-' + sectionId).html()) {
            return;
        }

        this.productSingleObject = JSON.parse(
            $('#ProductJson-' + sectionId).html()
        );
        this.addVariantInfo();

        this.init();
    }

    Product.prototype = _.assignIn({}, Product.prototype, {
        init: function() {
            this._stringOverrides();
            this._initVariants();
            this._productZoomImage();
            this._productThumbSwitch();
            this._productThumbnailSlider();
            this._initQtySelector();

            if (this.settings.ajaxCart) {
                theme.AjaxCart = new window.AjaxCart(
                    $('#AddToCartForm-' + this.settings.sectionId)
                );
            }
        },

        _stringOverrides: function() {
            window.productStrings = window.productStrings || {};
            $.extend(theme.strings, window.productStrings);
        },

        addVariantInfo: function() {
            if (!this.productSingleObject || !this.settings.stockSetting) {
                return;
            }

            var variantInfo = JSON.parse(
                $('#VariantJson-' + this.settings.sectionId).html()
            );

            for (var i = 0; i < variantInfo.length; i++) {
                $.extend(this.productSingleObject.variants[i], variantInfo[i]);
            }
        },

        _initVariants: function() {
            var options = {
                $container: this.$container,
                enableHistoryState: this.settings.enableHistoryState,
                product: this.productSingleObject,
                singleOptionSelector: this.selectors.singleOptionSelector,
                originalSelectorId: this.selectors.originalSelectorId
            };

            // eslint-disable-next-line no-new
            this.variants = new slate.Variants(options);

            this.$container.on(
                'variantChange' + this.settings.namespace,
                this._updateAddToCartBtn.bind(this)
            );
            this.$container.on(
                'variantChange' + this.settings.namespace,
                this._updateStickyCart.bind(this)
            );
            this.$container.on(
                'variantPriceChange' + this.settings.namespace,
                this._updatePrice.bind(this)
            );
            this.$container.on(
                'variantSKUChange' + this.settings.namespace,
                this._updateSKU.bind(this)
            );
            this.$container.on(
                'variantImageChange' + this.settings.namespace,
                this._updateImages.bind(this)
            );
        },

        _updateStock: function(variant) {
            if (!this.settings.stockSetting) return;

            var $stock = $(this.selectors.productStock),
                $hurrify = $(this.selectors.hurrify);

            // If we don't track variant inventory, hide stock
            if (!variant || !variant.inventory_management) {
                $stock.addClass('hide');
                $hurrify.addClass('hide');
                return;
            }

            if (variant.inventory_quantity < 10 && variant.inventory_quantity > 0) {
                $stock
                    .html(
                        theme.strings.stockAvailable.replace(
                            '1',
                            variant.inventory_quantity
                        )
                    )
                    .removeClass('hide');
                $hurrify.removeClass('hide').find('.progress-bar').css('width', variant.inventory_quantity * 10 + '%');
                return;
            }

            if (variant.inventory_quantity <= 0 && variant.incoming) {
                $stock
                    .html(
                        theme.strings.willNotShipUntil.replace(
                            '[date]',
                            variant.next_incoming_date
                        )
                    )
                    .removeClass('hide');
                $hurrify.addClass('hide');
                return;
            }

            // If there's more than 10 available, hide stock
            $stock.addClass('hide');
            $hurrify.addClass('hide');
        },

        _updateIncomingInfo: function(variant) {
            if (!this.settings.stockSetting) return;

            var $stock = $(this.selectors.productStock);

            if (variant.incoming) {
                $stock
                    .html(
                        theme.strings.willBeInStockAfter.replace(
                            '[date]',
                            variant.next_incoming_date
                        )
                    )
                    .removeClass('hide');
                return;
            }

            // If there is no stock incoming, hide stock
            $stock.addClass('hide');
        },

        _updateAddToCartBtn: function(evt) {
            var variant = evt.variant;

            var cache = {
                $addToCart: $(this.selectors.addToCart),
                $addToCartText: $(this.selectors.addToCartText)
            };

            if (variant) {
                // Select a valid variant if available
                theme.noticeSoldout.init(variant);
                if (variant.available) {
                    // We have a valid product variant, so enable the submit button
                    cache.$addToCart.removeClass('btn--sold-out').prop('disabled', false);
                    cache.$addToCartText.html(theme.strings.addToCart);
                    $(this.selectors.shopifyPaymentButton, this.$container).show();
                    // Show how many items are left, if below 10
                    this._updateStock(variant);
                    //update availability - available
                    $(this.selectors.availability).find('span').text(theme.strings.available);
                } else {
                    // Variant is sold out, disable the submit button
                    cache.$addToCart.prop('disabled', true).addClass('btn--sold-out');
                    cache.$addToCartText.html(theme.strings.soldOut);
                    $(this.selectors.shopifyPaymentButton, this.$container).hide();
                    // Update when stock will be available
                    this._updateIncomingInfo(variant);
                    //update availability - soldout
                    $(this.selectors.availability).find('span').text(theme.strings.soldOut);
                }
            } else {
                cache.$addToCart.prop('disabled', true).removeClass('btn--sold-out');
                cache.$addToCartText.html(theme.strings.unavailable);
                //update availability - unavailable
                $(this.selectors.availability).find('span').text(theme.strings.unavailable);
                $(this.selectors.shopifyPaymentButton, this.$container).hide();
                // Hide stock display
                this._updateStock();
            }
        },

        _updatePrice: function(evt) {
            var variant = evt.variant;

            if (variant) {
                $(this.selectors.productPrice).html(
                    theme.Currency.formatMoney(variant.price, theme.moneyFormat)
                );

                // Update and show the product's compare price if necessary
                if (variant.compare_at_price > variant.price) {
                    $(this.selectors.comparePrice)
                        .html(
                            theme.Currency.formatMoney(
                                variant.compare_at_price,
                                theme.moneyFormat
                            )
                        )
                        .removeClass('hide');
                    $(this.selectors.saleTag).removeClass('hide');
                } else {
                    $(this.selectors.comparePrice).addClass('hide');
                    $(this.selectors.saleTag).addClass('hide');
                }

                theme.updateCurrencies();
            } else {
                $(this.selectors.comparePrice).addClass('hide');
            }
        },

        _updateSKU: function(evt) {
            var variant = evt.variant;

            if (variant) {
                $(this.selectors.SKU).html(variant.sku);
            }
        },

        _updateImages: function(evt) {
            var variant = evt.variant;

            if (variant && variant.featured_image) {
                var imageId = variant.featured_image.id;
                this.switchProductImage(imageId);
                this.setActiveThumbnail(imageId);
            }
        },
        _updateStickyCart: function(evt) {
            var variant = evt.variant,
                $stickyPrice = $('#js-sticky-price'),
                $stickyTitle = $('#js-sticky-title'),
                $stickyImage = $('#js-sticky-img'),
                $stickyButton = $('#js-sticky-btn');
            if (variant) {
                //update title
                $stickyTitle.html(' - ' + variant.title);
                //update price
                $stickyPrice.html(theme.Currency.formatMoney(variant.price, theme.moneyFormat));
                //update selectbox
                for (var i = 1; i <= 3; i++) {
                    var option = 'option' + i,
                        $selecBox = '#js-sticky-option-' + i;
                    if (variant[option] !== null) {
                        var valueOption = variant[option];
                        $($selecBox).val(valueOption);
                    }
                }
                //update button cart
                if (variant.available) {
                    $stickyButton.prop('disabled', false).removeClass('btn--sold-out');
                    $stickyButton.html(theme.strings.addToCart);
                } else {
                    $stickyButton.prop('disabled', true).addClass('btn--sold-out');
                    $stickyButton.html(theme.strings.soldOut);
                }
                //update image
                if (variant.featured_image) {
                    $stickyImage.attr('src', theme.Images.getSizedImageUrl(variant.featured_image.src, '200x'));
                }
            } else {
                //update title
                $stickyTitle.html(' - ' + theme.strings.unavailable);
                //update button cart
                $stickyButton.prop('disabled', true).removeClass('btn--sold-out');
                $stickyButton.html(theme.strings.unavailable);
            }
        },

        switchProductImage: function(imageId) {
            var $imageToShow = $(
                this.selectors.productImageContainers +
                "[data-image-id='" +
                imageId +
                "']",
                this.$container
            );
            var $imagesToHide = $(
                this.selectors.productImageContainers +
                ":not([data-image-id='" +
                imageId +
                "'])",
                this.$container
            );
            $imagesToHide.addClass('hide');
            $imageToShow.removeClass('hide');
            //Scroll to active
            topMenuHeight = $('.site-header').outerHeight();
            if (this.settings.sectionId === 'product-template-8') {
                $([document.documentElement, document.body]).animate({
                    scrollTop: $imageToShow.offset().top - topMenuHeight
                }, 500);
            }
        },

        setActiveThumbnail: function(imageId) {
            var $thumbnailToShow = $(
                this.selectors.productThumbContainers +
                "[data-image-id='" +
                imageId +
                "']",
                this.$container
            );
            var $thumbnailsToHide = $(
                this.selectors.productThumbContainers +
                ":not([data-image-id='" +
                imageId +
                "'])",
                this.$container
            );
            $thumbnailsToHide.removeClass('is-active');
            $thumbnailToShow.addClass('is-active');
            $thumbnailToShow.trigger('click');
            var $thumbnails = $(this.selectors.productThumbsWrapper, this.$container);

            // If there is a slick carousel, get the slide index, and position it into view with animation.
            if ($thumbnails.hasClass('slick-initialized')) {
                // eslint-disable-next-line shopify/jquery-dollar-sign-reference
                var currentActiveSlideIndex = $thumbnails.slick('slickCurrentSlide');
                var newActiveSlideIndex = parseInt(
                    $thumbnailToShow.attr('data-slick-index')
                );
                if (currentActiveSlideIndex !== newActiveSlideIndex) {
                    $thumbnails.slick('slickGoTo', newActiveSlideIndex, false);

                }
            }
        },

        _productZoomImage: function() {
            // The zoom image is only used on the product template, so return early
            // even if a featured product section is present.
            if (!$('.product-single ' + this.selectors.productImageContainers).length) {
                return;
            }

            var self = this;

            $(this.selectors.productImageWrappers).on(
                'click' + this.settings.namespace,
                function(evt) {
                    evt.preventDefault();
                    // Empty src before loadig new image to avoid awkward image swap
                    $(self.selectors.productZoomImage)
                        .attr('src', '')
                        .attr('src', $(this).attr('href'));
                }
            );

            this.ProductModal = new window.Modals(
                this.selectors.modal,
                'product-modal'
            );

            // Close modal if clicked, but not if the image is clicked
            this.ProductModal.$modal.on('click' + this.settings.namespace, function(
                evt
            ) {
                if (evt.target.nodeName !== 'IMG') {
                    self.ProductModal.close();
                }
            });
        },

        _productThumbSwitch: function() {
            if (!$(this.selectors.productThumbs).length) {
                return;
            }

            var self = this;

            $(this.selectors.productThumbs).on(
                'click' + this.settings.namespace,
                function(evt) {
                    evt.preventDefault();
                    var imageId = $(this)
                        .parent()
                        .data('image-id');
                    self.setActiveThumbnail(imageId);
                    self.switchProductImage(imageId);
                }
            );
            //trigger hover thumb
            // $(this.selectors.productThumbs).on('click',function(){
            //   $(this).trigger('click');
            // });
        },

        /*
          Thumbnail slider
         */
        _productThumbnailSlider: function() {
            var $productThumbsWrapper = $(this.selectors.productThumbsWrapper);
            var $productThumbs = $(this.selectors.productThumbs);
            if (!$productThumbs.length) {
                return;
            }

            if ($productThumbs.length > 1) {
                $productThumbsWrapper.on(
                    'init' + this.settings.namespace,
                    this._productSwipeInit.bind(this)
                );

                if (this.settings.sectionId === 'product-template-3' || this.settings.sectionId === 'product-template-4') {
                    $productThumbsWrapper.slick({
                        accessibility: false,
                        arrows: true,
                        dots: false,
                        infinite: false,
                        autoplay: false,
                        slidesToShow: 5,
                        slidesToScroll: 5,
                        vertical: true,
                        verticalSwiping: true,
                        responsive: [{
                            breakpoint: 992,
                            settings: {
                                vertical: false,
                                verticalSwiping: false,
                                slidesToShow: 4,
                                slidesToScroll: 4,
                                dots: false,
                            }
                        }]
                    }).css('opacity', '1');
                } else if (this.settings.sectionId === 'product-template-5') {
                    $productThumbsWrapper.slick({
                        accessibility: false,
                        arrows: true,
                        dots: false,
                        infinite: true,
                        autoplay: false,
                        slidesToShow: 2,
                        slidesToScroll: 1,
                        responsive: [{
                            breakpoint: 992,
                            settings: {
                                slidesToShow: 4,
                                slidesToScroll: 4,
                                dots: false,
                            }
                        }]
                    }).css('opacity', '1');
                } else if (this.settings.sectionId === 'product-template-7') {
                    $productThumbsWrapper.slick({
                        accessibility: false,
                        arrows: true,
                        dots: true,
                        infinite: true,
                        autoplay: false,
                        slidesToShow: 1,
                        slidesToScroll: 1,
                        responsive: [{
                            breakpoint: 992,
                            settings: {
                                slidesToShow: 1,
                                slidesToScroll: 1,
                                dots: false,
                                arrows: true,
                            }
                        }]
                    }).css('opacity', '1');
                } else if (this.settings.sectionId === 'product-template-8') {
                    var lastId,
                        topMenu = $(".product-single__thumbnails"),
                        topMenuHeight = $('.site-header').outerHeight() + 20,
                        // All list items
                        menuItems = topMenu.find(".product-single__thumbnail");


                    if ($(window).width() > 767) {
                        menuItems.click(function(e) {
                            var findid = $(this).attr('href');
                            offsetTop = $(findid).offset().top - topMenuHeight + 1;
                            $('html, body').stop().animate({
                                scrollTop: offsetTop
                            }, 200);
                            return false;
                        });
                        // Anchors corresponding to menu items
                        scrollItems = menuItems.map(function() {
                            var item = $($(this).attr('href'));
                            if (item.length) { return item; }
                        });

                        $(window).scroll(function() {
                            // Get container scroll position
                            var fromTop = $(this).scrollTop() + topMenuHeight;
                            // Get id of current scroll item
                            var cur = scrollItems.map(function() {
                                if ($(this).offset().top < fromTop)
                                    return this;
                            });
                            // Get the id of the current element
                            cur = cur[cur.length - 1];
                            var id = cur && cur.length ? cur[0].id : "";

                            if (lastId !== id) {
                                lastId = id;
                                // Set/remove active class
                                menuItems
                                    .parent().removeClass("is-active")
                                    .end().filter("[href='#" + id + "']").parent().addClass("is-active");
                            }
                        });
                    } else {
                        menuItems.click(function(e) {
                            var findid = $(this).attr('href');
                            offsetTop = $(findid).offset().top;
                            $('html, body').stop().animate({
                                scrollTop: offsetTop
                            });
                            return false;
                        });
                    }

                    $productThumbsWrapper.slick({
                        accessibility: false,
                        arrows: true,
                        dots: false,
                        infinite: false,
                        autoplay: false,
                        slidesToShow: 5,
                        slidesToScroll: 1,
                        vertical: true,
                        verticalSwiping: true,
                        responsive: [{
                            breakpoint: 992,
                            settings: {
                                vertical: false,
                                verticalSwiping: false,
                                slidesToShow: 4,
                                slidesToScroll: 4,
                                dots: true,
                            }
                        }]
                    }).css('opacity', '1');
                } else {
                    $productThumbsWrapper.slick({
                        accessibility: false,
                        arrows: true,
                        dots: false,
                        infinite: false,
                        autoplay: false,
                        slidesToShow: 4,
                        slidesToScroll: 4
                    }).css('opacity', '1');
                }

                // Show highlighted thumbnail by repositioning slider
                $productThumbsWrapper.slick(
                    'slickGoTo',
                    $productThumbsWrapper.find('.is-active').attr('data-slick-index'),
                    true
                );
            }
        },

        _productSwipeInit: function(evt, obj) {
            // Slider is initialized. Setup custom swipe events
            this.settings.productThumbIndex = obj.currentSlide;
            this.settings.productThumbMax = obj.slideCount - 1; // we need the 0-based index

            var self = this;

            $(this.selectors.productImageWrappers).on(
                'swipeleft swiperight',
                function(event) {
                    if (event.type === 'swipeleft') {
                        self._goToNextThumbnail();
                    }

                    if (event.type === 'swiperight') {
                        self._goToPrevThumbnail();
                    }

                    // Trigger click on newly requested thumbnail
                    $(
                            '.product-single__thumbnail-item[data-slick-index="' +
                            self.settings.productThumbIndex +
                            '"]'
                        )
                        .find('.product-single__thumbnail')
                        .trigger('click');

                }
            );
        },
        _goToNextThumbnail: function() {
            this.settings.productThumbIndex++;

            if (this.settings.productThumbIndex > this.settings.productThumbMax) {
                this.settings.productThumbIndex = 0;
            }

            $(this.selectors.productThumbsWrapper).slick(
                'slickGoTo',
                this.settings.productThumbIndex,
                true
            );
        },

        _goToPrevThumbnail: function() {
            this.settings.productThumbIndex--;

            if (this.settings.productThumbIndex < 0) {
                this.settings.productThumbIndex = this.settings.productThumbMax;
            }

            $(this.selectors.productThumbsWrapper).slick(
                'slickGoTo',
                this.settings.productThumbIndex,
                true
            );
        },

        _initQtySelector: function() {
            this.$container.find('.product-form__quantity').each(function(i, el) {
                // eslint-disable-next-line no-new
                new QtySelector($(el));
            });
        },

        onUnload: function() {
            $(this.selectors.productImageWrappers).off(this.settings.namespace);
            $(this.selectors.productThumbs).off(this.settings.namespace);
            $(this.selectors.productThumbs).slick('unslick');
            if (this.ProductModal) {
                this.ProductModal.$modal.off(this.settings.namespace);
            }
        }
    });

    return Product;
})();

theme.Slideshow = (function() {
    this.$slideshow = null;
    var classes = {
        slideshow: 'slideshow',
        slickActiveMobile: 'slick-active-mobile',
        controlsHover: 'slideshow__controls--hover',
        isPaused: 'is-paused'
    };

    var selectors = {
        section: '.shopify-section',
        wrapper: '#SlideshowWrapper-',
        slides: '.slideshow__slide',
        textWrapperMobile: '.slideshow__text-wrap--mobile',
        textContentMobile: '.slideshow__text-content--mobile',
        controls: '.slideshow__controls',
        dots: '.slick-dots',
        arrowLeft: '.slideshow__arrow-left',
        arrowRight: '.slideshow__arrow-right'
    };

    function slideshow(el, sectionId) {
        var $slideshow = (this.$slideshow = $(el));
        this.adaptHeight = this.$slideshow.data('adapt-height');
        this.$wrapper = this.$slideshow.closest(selectors.wrapper + sectionId);
        this.$section = this.$wrapper.closest(selectors.section);
        this.$controls = this.$wrapper.find(selectors.controls);
        this.$textWrapperMobile = this.$section.find(selectors.textWrapperMobile);
        this.autorotate = this.$slideshow.data('autorotate');
        var autoplaySpeed = this.$slideshow.data('speed');
        var loadSlideA11yString = this.$slideshow.data('slide-nav-a11y');

        this.settings = {
            rtl: theme.rtl,
            accessibility: true,
            arrows: true,
            dots: true,
            fade: (theme.rtl ? false : true),
            draggable: true,
            touchThreshold: 20,
            autoplay: this.autorotate,
            autoplaySpeed: autoplaySpeed
        };

        this.$slideshow.on('beforeChange', beforeChange.bind(this));
        this.$slideshow.on('init', slideshowA11ySetup.bind(this));

        // Add class to style mobile dots & show the correct text content for the
        // first slide on mobile when the slideshow initialises
        this.$slideshow.on(
            'init',
            function() {
                this.$mobileDots
                    .find('li:first-of-type')
                    .addClass(classes.slickActiveMobile);
                this.showMobileText(0);
            }.bind(this)
        );

        if (this.adaptHeight) {
            this.setSlideshowHeight();
            $(window).resize($.debounce(50, this.setSlideshowHeight.bind(this)));
        }

        this.$slideshow.slick(this.settings);

        // This can't be called when the slick 'init' event fires due to how slick
        // adds a11y features.
        slideshowPostInitA11ySetup.bind(this)();
    }

    function slideshowA11ySetup(event, obj) {
        var $slider = obj.$slider;
        var $list = obj.$list;
        this.$dots = this.$section.find(selectors.dots);
        this.$mobileDots = this.$dots.eq(1);

        // Remove default Slick aria-live attr until slider is focused
        $list.removeAttr('aria-live');

        //     this.$wrapper.on('keyup', keyboardNavigation.bind(this));
        //     this.$controls.on('keyup', keyboardNavigation.bind(this));
        //     this.$textWrapperMobile.on('keyup', keyboardNavigation.bind(this));

        // When an element in the slider is focused
        // pause slideshow and set aria-live.
        this.$wrapper
            .on(
                'focusin',
                function(evt) {
                    if (!this.$wrapper.has(evt.target).length) {
                        return;
                    }

                    $list.attr('aria-live', 'polite');
                    if (this.autorotate) {
                        $slider.slick('slickPause');
                    }
                }.bind(this)
            )
            .on(
                'focusout',
                function(evt) {
                    if (!this.$wrapper.has(evt.target).length) {
                        return;
                    }

                    $list.removeAttr('aria-live');
                }.bind(this)
            );

        // Add arrow key support when focused
        if (this.$dots) {
            this.$dots
                .find('a')
                .each(function() {
                    var $dot = $(this);
                    $dot.on('click keyup', function(evt) {
                        if (
                            evt.type === 'keyup' &&
                            evt.which !== slate.utils.keyboardKeys.ENTER
                        )
                            return;

                        evt.preventDefault();

                        var slideNumber = $(evt.target).data('slide-number');

                        $slider.attr('tabindex', -1).slick('slickGoTo', slideNumber);

                        if (evt.type === 'keyup') {
                            $slider.focus();
                        }
                    });
                })
                .eq(0)
                .attr('aria-current', 'true');
        }

        this.$controls
            .on('focusin', highlightControls.bind(this))
            .on('focusout', unhighlightControls.bind(this));
    }

    function slideshowPostInitA11ySetup() {
        var $slides = this.$slideshow.find(selectors.slides);

        $slides.removeAttr('role').removeAttr('aria-labelledby');
        this.$dots
            .removeAttr('role')
            .find('li')
            .removeAttr('role')
            .removeAttr('aria-selected')
            .each(function() {
                var $dot = $(this);
                var ariaControls = $dot.attr('aria-controls');
                $dot
                    .removeAttr('aria-controls')
                    .find('a')
                    .attr('aria-controls', ariaControls);
            });
    }

    function beforeChange(event, slick, currentSlide, nextSlide) {
        var $dotLinks = this.$dots.find('a');
        var $mobileDotLinks = this.$mobileDots.find('li');

        $dotLinks
            .removeAttr('aria-current')
            .eq(nextSlide)
            .attr('aria-current', 'true');

        $mobileDotLinks
            .removeClass(classes.slickActiveMobile)
            .eq(nextSlide)
            .addClass(classes.slickActiveMobile);
        this.showMobileText(nextSlide);
    }

    //   function keyboardNavigation() {
    //     if (event.keyCode === slate.utils.keyboardKeys.LEFTARROW) {
    //       this.$slideshow.slick('slickPrev');
    //     }
    //     if (event.keyCode === slate.utils.keyboardKeys.RIGHTARROW) {
    //       this.$slideshow.slick('slickNext');
    //     }
    //   }

    function highlightControls() {
        this.$controls.addClass(classes.controlsHover);
    }

    function unhighlightControls() {
        this.$controls.removeClass(classes.controlsHover);
    }

    slideshow.prototype.setSlideshowHeight = function() {
        var minAspectRatio = this.$slideshow.data('min-aspect-ratio');
        this.$slideshow.height($(document).width() / minAspectRatio);
    };

    slideshow.prototype.showMobileText = function(slideIndex) {
        var $allTextContent = this.$textWrapperMobile.find(
            selectors.textContentMobile
        );
        var currentTextContentSelector =
            selectors.textContentMobile + '-' + slideIndex;
        var $currentTextContent = this.$textWrapperMobile.find(
            currentTextContentSelector
        );
        if (!$currentTextContent.length &&
            this.$slideshow.find(selectors.slides).length === 1
        ) {
            this.$textWrapperMobile.hide();
        } else {
            this.$textWrapperMobile.show();
        }
        $allTextContent.hide();
        $currentTextContent.show();
    };

    function getSlideshowId($el) {
        return '#Slideshow-' + $el.data('id');
    }

    return slideshow;
})();

theme.slideshows = {};

theme.SlideshowSection = (function() {
    function SlideshowSection(container) {
        var $container = (this.$container = $(container));
        var sectionId = $container.attr('data-section-id');
        var slideshow = (this.slideshow = '#Slideshow-' + sectionId);

        theme.slideshows[slideshow] = new theme.Slideshow(slideshow, sectionId);
    }

    return SlideshowSection;
})();

theme.SlideshowSection.prototype = _.assignIn({},
    theme.SlideshowSection.prototype, {
        onUnload: function() {
            delete theme.slideshows[this.slideshow];
        },

        onBlockSelect: function(evt) {
            var $slideshow = $(this.slideshow);
            var adaptHeight = $slideshow.data('adapt-height');

            if (adaptHeight) {
                theme.slideshows[this.slideshow].setSlideshowHeight();
            }

            // Ignore the cloned version
            var $slide = $(
                '.slideshow__slide--' + evt.detail.blockId + ':not(.slick-cloned)'
            );
            var slideIndex = $slide.data('slick-index');

            // Go to selected slide, pause auto-rotate
            $slideshow.slick('slickGoTo', slideIndex).slick('slickPause');
        },

        onBlockDeselect: function() {
            // Resume auto-rotate
            $(this.slideshow).slick('slickPlay');
        }
    }
);

theme.slideshows = {};

theme.Cart = (function() {
    var selectors = {
        cartNote: '#CartSpecialInstructions',
        cartQtyInput: '.cart__quantity',
        cartNoCookiesClass: 'cart--no-cookies'
    };

    function Cart(container) {
        var $container = (this.$container = $(container));
        var sectionId = $container.attr('data-section-id');

        theme.cartObject = JSON.parse($('#CartJson-' + sectionId).html());

        this.init($container);
    }

    Cart.prototype = _.assignIn({}, Cart.prototype, {
        init: function($container) {
            this._initQtySelector();
            this._initCartNote();

            if (!this._cookiesEnabled()) {
                $container.addClass(selectors.cartNoCookiesClass);
            }
        },

        _initQtySelector: function() {
            $(selectors.cartQtyInput).each(function(i, el) {
                // eslint-disable-next-line no-new
                new QtySelector($(el));
            });
        },

        _initCartNote: function() {
            if (!$(selectors.cartNote).length) {
                return;
            }

            var $el = $(selectors.cartNote);
            var noteText;
            var params;
            var noteOffset = $el[0].offsetHeight - $el[0].clientHeight;

            // Auto grow the cart note if text fills it up
            $el.on('keyup input', function() {
                $(this)
                    .css('height', 'auto')
                    .css('height', $el[0].scrollHeight + noteOffset);
            });

            // Save the cart note via ajax. A safeguard in case
            // a user decides to leave the page before clicking 'Update Cart'
            $el.on(
                'change',
                $.proxy(function() {
                    noteText = $el.val();
                    params = {
                        type: 'POST',
                        url: '/cart/update.js',
                        data: 'note=' + this._attributeToString(noteText),
                        dataType: 'json'
                    };
                    $.ajax(params);
                }, this)
            );
        },

        _attributeToString: function(attr) {
            if (typeof attr !== 'string') {
                attr = String(attr);
                if (attr === 'undefined') {
                    attr = '';
                }
            }
            return $.trim(attr);
        },

        _cookiesEnabled: function() {
            var cookieEnabled = navigator.cookieEnabled;

            if (!cookieEnabled) {
                document.cookie = 'testcookie';
                cookieEnabled = document.cookie.indexOf('testcookie') !== -1;
            }
            return cookieEnabled;
        }
    });

    return Cart;
})();

// Instagrams
theme.Instagrams = (function() {
    function Instagrams(container) {
        this.$container = $(container).on('init', this._a11y.bind(this));
        //console.log(this.$container);
        this.settings = {
            style: this.$container.data('style'),
            accesstoken: this.$container.data('accesstoken'),
            userid: this.$container.data('userid'),
            limit: this.$container.data('limit'),
            resolution: this.$container.data('resolution'),
            target: this.$container.attr('id'),
            rows: this.$container.data('rows'),

            slidesToShow: this.$container.data('slidestoshow') || 1,
            infinite: this.$container.data('infinite') || false,
            arrows: this.$container.data('arrows') || false,
            draggable: this.$container.data('draggable') || false,
            dots: this.$container.data('dots') || false,
        }
        this.settings.slidesToShow1200 = (this.settings.slidesToShow - 1) > 1 ? (this.settings.slidesToShow - 1) : 1;
        this.settings.slidesToShow992 = (this.settings.slidesToShow - 2) > 1 ? (this.settings.slidesToShow - 2) : 1;
        this.settings.slidesToShow768 = (this.settings.slidesToShow - 3) > 1 ? (this.settings.slidesToShow - 3) : 1;
        this.settings.slidesToShow480 = 2;

        var _self = this;
        var $instagramSelector = $('#' + this.settings.target);
        if (this.settings.style === 'grid') {
            var afterInstagram = function() {} // blank function
        } else if (this.settings.style === 'carousel') {
            var afterInstagram = function() {
                $instagramSelector.slick({
                    slidesToShow: _self.settings.slidesToShow,
                    slidesToScroll: _self.settings.slidesToShow,
                    arrows: _self.settings.arrows,
                    dots: _self.settings.dots,
                    draggable: _self.settings.draggable,
                    infinite: _self.settings.infinite,
                    rows: _self.settings.rows,
                    responsive: [{
                            breakpoint: 1200,
                            settings: {
                                slidesToShow: _self.settings.slidesToShow1200,
                                slidesToScroll: _self.settings.slidesToShow1200,
                            }
                        },
                        {
                            breakpoint: 992,
                            settings: {
                                slidesToShow: _self.settings.slidesToShow992,
                                slidesToScroll: _self.settings.slidesToShow992,
                            }
                        },
                        {
                            breakpoint: 768,
                            settings: {
                                slidesToShow: _self.settings.slidesToShow768,
                                slidesToScroll: _self.settings.slidesToShow768,
                            }
                        },
                        {
                            breakpoint: 480,
                            settings: {
                                slidesToShow: _self.settings.slidesToShow480,
                                slidesToScroll: _self.settings.slidesToShow480,
                            }
                        }
                    ]
                })
            }
        }

        var feed = new Instafeed({
            get: 'user',
            target: this.settings.target,
            userId: this.settings.userid,
            accessToken: this.settings.accesstoken,
            limit: this.settings.limit,
            resolution: this.settings.resolution,
            template: '<div class="col hv-image-brightness"><a class="instagram-item" href="{{link}}" target="_blank" id="{{id}}"><img alt="instagram image" class="transition lazyload" data-src="{{image}}" /></a></div>',
            after: afterInstagram
        });

        feed.run();
    }

    Instagrams.prototype = _.assignIn({}, Instagrams.prototype, {
        _a11y: function(event, obj) {
            var $list = obj.$list;
            var $wrapper = this.$container.parent();

            // Remove default Slick aria-live attr until slider is focused
            $list.removeAttr('aria-live');

            // When an element in the slider is focused set aria-live
            $wrapper.on('focusin', function(evt) {
                if ($wrapper.has(evt.target).length) {
                    $list.attr('aria-live', 'polite');
                }
            });

            // Remove aria-live
            $wrapper.on('focusout', function(evt) {
                if ($wrapper.has(evt.target).length) {
                    $list.removeAttr('aria-live');
                }
            });
        }
    });

    return Instagrams;
})();

// Slick carousel
theme.slickCarousel = (function() {
    function Carousels(container) {
        this.$container = $(container).on('init', this._a11y.bind(this));
        this.settings = {
            rows: this.$container.data('rows') || 1,
            slidesToShow: this.$container.data('slidestoshow') || 1,
            slidesToScroll: this.$container.data('slidestoscroll') || 1,
            infinite: this.$container.data('infinite') || false,
            arrows: this.$container.data('arrows') || false,
            dots: this.$container.data('dots') || false,
            autoplay: this.$container.data('autoplay') || false,
            draggable: this.$container.data('draggable') || false,
            accessibility: this.$container.data('accessibility') || true,
        }
        this.settings.slidesToShow1200 = (this.settings.slidesToShow - 1) > 1 ? (this.settings.slidesToShow - 1) : 1;
        this.settings.slidesToShow992 = (this.settings.slidesToShow - 2) > 1 ? (this.settings.slidesToShow - 2) : 1;
        this.settings.slidesToShow768 = (this.settings.slidesToShow - 3) > 1 ? (this.settings.slidesToShow - 3) : 1;
        this.settings.slidesToShow480 = (this.settings.slidesToShow - 4) > 1 ? (this.settings.slidesToShow - 4) : 1;
        this.settings.slidesToScroll1200 = (this.settings.slidesToScroll - 1) > 1 ? (this.settings.slidesToScroll - 1) : 1;
        this.settings.slidesToScroll992 = (this.settings.slidesToScroll - 2) > 1 ? (this.settings.slidesToScroll - 2) : 1;
        this.settings.slidesToScroll768 = (this.settings.slidesToScroll - 3) > 1 ? (this.settings.slidesToScroll - 3) : 1;
        this.settings.slidesToScroll480 = (this.settings.slidesToScroll - 4) > 1 ? (this.settings.slidesToScroll - 4) : 1;
        this.$container.slick({
            rtl: theme.rtl,
            rows: this.settings.rows,
            slidesToShow: this.settings.slidesToShow,
            slidesToScroll: this.settings.slidesToScroll,
            arrows: this.settings.arrows,
            dots: this.settings.dots,
            autoplay: this.settings.autoplay,
            accessibility: this.settings.accessibility,
            draggable: this.settings.draggable,
            infinite: this.settings.infinite,
            adaptiveHeight: true,
            responsive: [{
                    breakpoint: 1200,
                    settings: {
                        slidesToShow: this.settings.slidesToShow1200,
                        slidesToScroll: this.settings.slidesToScroll1200
                    }
                },
                {
                    breakpoint: 992,
                    settings: {
                        slidesToShow: this.settings.slidesToShow992,
                        slidesToScroll: this.settings.slidesToScroll992
                    }
                },
                {
                    breakpoint: 768,
                    settings: {
                        slidesToShow: this.settings.slidesToShow768,
                        slidesToScroll: this.settings.slidesToScroll768
                    }
                },
                {
                    breakpoint: 480,
                    settings: {
                        slidesToShow: 1,
                        slidesToScroll: this.settings.slidesToScroll480
                    }
                }
            ]
        })
    }

    Carousels.prototype = _.assignIn({}, Carousels.prototype, {
        _a11y: function(event, obj) {
            var $list = obj.$list;
            var $wrapper = this.$container.parent();

            // Remove default Slick aria-live attr until slider is focused
            $list.removeAttr('aria-live');

            // When an element in the slider is focused set aria-live
            $wrapper.on('focusin', function(evt) {
                if ($wrapper.has(evt.target).length) {
                    $list.attr('aria-live', 'polite');
                }
            });

            // Remove aria-live
            $wrapper.on('focusout', function(evt) {
                if ($wrapper.has(evt.target).length) {
                    $list.removeAttr('aria-live');
                }
            });
        },

        _goToSlide: function(slideIndex) {
            this.$container.slick('slickGoTo', slideIndex);
        },

        onUnload: function() {
            delete this.$container;
        },

        onBlockSelect: function(evt) {
            // Ignore the cloned version
            var $slide = $(
                '.carousel__slide-wrapper--' + evt.detail.blockId + ':not(.slick-cloned)'
            );
            var slideIndex = $slide.data('slick-index');

            // Go to selected slide, pause autoplay
            this._goToSlide(slideIndex);

        }
    });

    return Carousels;
})()

// Productlists
theme.Productlists = (function() {
    function Productlists(container) {
        this.$container = $(container).on('init', this._a11y.bind(this));
        this.settings = {
            slidesToShow: this.$container.data('slidestoshow') || 1,
            rows: this.$container.data('rows') || 1,
            arrows: this.$container.data('arrows') || false,
            dots: this.$container.data('dots') || false,
            draggable: this.$container.data('draggable') || false,
            infinite: this.$container.data('infinite') || false,
        }
        this.settings.slidesToShow1200 = (this.settings.slidesToShow - 1) > 1 ? (this.settings.slidesToShow - 1) : 1;
        this.settings.slidesToShow992 = (this.settings.slidesToShow - 2) > 1 ? (this.settings.slidesToShow - 2) : 1;
        this.settings.slidesToShow768 = (this.settings.slidesToShow - 3) > 1 ? (this.settings.slidesToShow - 3) : 1;
        this.settings.slidesToShow480 = 2;
        this.$container.slick({
            rtl: theme.rtl,
            accessibility: true,
            slidesToShow: this.settings.slidesToShow,
            slidesToScroll: this.settings.slidesToShow,
            rows: this.settings.rows,
            arrows: this.settings.arrows,
            dots: this.settings.dots,
            infinite: this.settings.infinite,
            draggable: this.settings.draggable,
            responsive: [{
                    breakpoint: 1200,
                    settings: {
                        slidesToShow: this.settings.slidesToShow1200,
                        slidesToScroll: this.settings.slidesToShow1200
                    }
                },
                {
                    breakpoint: 992,
                    settings: {
                        slidesToShow: this.settings.slidesToShow992,
                        slidesToScroll: this.settings.slidesToShow992
                    }
                },
                {
                    breakpoint: 768,
                    settings: {
                        slidesToShow: this.settings.slidesToShow768,
                        slidesToScroll: this.settings.slidesToShow768
                    }
                },
                {
                    breakpoint: 480,
                    settings: {
                        slidesToShow: this.settings.slidesToShow480,
                        slidesToScroll: this.settings.slidesToShow480
                    }
                }
            ]
        }).css('opacity', '1');
    }

    Productlists.prototype = _.assignIn({}, Productlists.prototype, {
        _a11y: function(event, obj) {
            var $list = obj.$list;
            var $wrapper = this.$container.parent();

            // Remove default Slick aria-live attr until slider is focused
            $list.removeAttr('aria-live');

            // When an element in the slider is focused set aria-live
            $wrapper.on('focusin', function(evt) {
                if ($wrapper.has(evt.target).length) {
                    $list.attr('aria-live', 'polite');
                }
            });

            // Remove aria-live
            $wrapper.on('focusout', function(evt) {
                if ($wrapper.has(evt.target).length) {
                    $list.removeAttr('aria-live');
                }
            });
        },

        _goToSlide: function(slideIndex) {
            this.$container.slick('slickGoTo', slideIndex);
        },

        onUnload: function() {
            delete this.$container;
        }
    });

    return Productlists;
})();

// Producttabs
theme.Producttabs = (function() {
    function Producttabs(container) {
        var _self = this; // avoid conflict
        this.$container = $(container).on('init', this._a11y.bind(this));
        this.slickWrap = '.prdtab-content';
        this.settings = {
            slidesToShow: this.$container.data('slidestoshow') || 1,
            arrows: this.$container.data('arrows') || false,
            rows: this.$container.data('rows') || 1,
            dots: this.$container.data('dots') || false,
            draggable: this.$container.data('draggable') || false,
            infinite: this.$container.data('infinite') || false,
        }
        this.settings.slidesToShow1200 = (this.settings.slidesToShow - 1) > 1 ? (this.settings.slidesToShow - 1) : 1;
        this.settings.slidesToShow992 = (this.settings.slidesToShow - 2) > 1 ? (this.settings.slidesToShow - 2) : 1;
        this.settings.slidesToShow768 = (this.settings.slidesToShow - 3) > 1 ? (this.settings.slidesToShow - 3) : 1;
        this.settings.slidesToShow480 = 2;

        this._initSlick();
        this.$container.find('a[data-toggle="tab"]').on("shown.bs.tab", function(e) {
            _self._unSlick();
            _self._initSlick();
            theme.tooltip.load();
        })
    }

    Producttabs.prototype = _.assignIn({}, Producttabs.prototype, {
        _a11y: function(event, obj) {
            var $list = obj.$list;
            var $wrapper = this.$container.parent();

            // Remove default Slick aria-live attr until slider is focused
            $list.removeAttr('aria-live');

            // When an element in the slider is focused set aria-live
            $wrapper.on('focusin', function(evt) {
                if ($wrapper.has(evt.target).length) {
                    $list.attr('aria-live', 'polite');
                }
            });

            // Remove aria-live
            $wrapper.on('focusout', function(evt) {
                if ($wrapper.has(evt.target).length) {
                    $list.removeAttr('aria-live');
                }
            });
        },

        _getSliderSettings: function() {
            return {
                rtl: theme.rtl,
                accessibility: true,
                slidesToShow: this.settings.slidesToShow,
                slidesToScroll: this.settings.slidesToShow,
                arrows: this.settings.arrows,
                rows: this.settings.rows,
                dots: this.settings.dots,
                infinite: this.settings.infinite,
                draggable: this.settings.draggable,
                responsive: [{
                        breakpoint: 1200,
                        settings: {
                            slidesToShow: this.settings.slidesToShow1200,
                            slidesToScroll: this.settings.slidesToShow1200
                        }
                    },
                    {
                        breakpoint: 992,
                        settings: {
                            slidesToShow: this.settings.slidesToShow992,
                            slidesToScroll: this.settings.slidesToShow992
                        }
                    },
                    {
                        breakpoint: 768,
                        settings: {
                            slidesToShow: this.settings.slidesToShow768,
                            slidesToScroll: this.settings.slidesToShow768
                        }
                    },
                    {
                        breakpoint: 480,
                        settings: {
                            slidesToShow: this.settings.slidesToShow480,
                            slidesToScroll: this.settings.slidesToShow480
                        }
                    }
                ]
            }
        },

        _initSlick: function() {
            this.$container.find(this.slickWrap).slick(this._getSliderSettings()).css('opacity', '1');
        },

        _unSlick: function() {
            this.$container.find(this.slickWrap).slick('unslick');
        },

        onUnload: function() {
            delete this.$container;
        },

        onSelect: function() {
            this._unSlick();
            this._initSlick();
        },

        onBlockSelect: function(evt) {
            var navItem = $('.nav-link-' + evt.detail.blockId);
            navItem.tab('show');
            this._unSlick();
            this._initSlick();
        }
    });

    return Producttabs;
})();

theme.Video = (function() {
    var promiseYoutubeAPI;
    var promiseVimeoAPI;

    var youtube = {
        promiseAPI: function() {
            if (!promiseYoutubeAPI) {
                var tag = document.createElement('script');

                tag.src = 'https://www.youtube.com/iframe_api';
                var firstScriptTag = document.getElementsByTagName('script')[0];
                firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

                promiseYoutubeAPI = $.Deferred(function(defer) {
                    window.onYouTubeIframeAPIReady = defer.resolve;

                    setTimeout(function() {
                        defer.reject('Request for YouTube API timed out after 30 seconds.');
                    }, 30000);
                });
            }

            return promiseYoutubeAPI;
        },
        promisePlayer: function(id, options) {
            return this.promiseAPI().then(function() {
                return $.Deferred(function(defer) {
                    if (typeof window.YT === 'undefined') {
                        defer.reject(
                            "We're sorry, something went wrong. The YouTube API has not loaded correctly."
                        );
                    }

                    /* eslint-disable no-undef */
                    var player = new YT.Player(id, options); // global YT variable injected by YouTube API

                    player.addEventListener('onReady', function() {
                        defer.resolve(player);
                    });

                    setTimeout(function() {
                        defer.reject(
                            'Request for YouTube player has timed out after 30 seconds.'
                        );
                    }, 30000);
                });
            });
        }
    };

    var vimeo = {
        promiseAPI: function() {
            if (!promiseVimeoAPI) {
                promiseVimeoAPI = $.Deferred(function(defer) {
                    var tag = document.createElement('script');
                    tag.src = 'https://player.vimeo.com/api/player.js';
                    tag.onload = tag.onreadystatechange = function() {
                        if (!this.readyState || this.readyState === 'complete') {
                            defer.resolve();
                        }
                    };

                    var firstScriptTag = document.getElementsByTagName('script')[0];
                    firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

                    setTimeout(function() {
                        defer.reject('Request for Vimeo API timed out after 30 seconds.');
                    }, 30000);
                });
            }

            return promiseVimeoAPI;
        },

        promisePlayer: function(id, options) {
            return this.promiseAPI().then(function() {
                return $.Deferred(function(defer) {
                    if (typeof window.Vimeo === 'undefined') {
                        defer.reject(
                            "We're sorry, something went wrong. The Vimeo API has not loaded correctly."
                        );
                    }

                    var player = new window.Vimeo.Player(id, options);

                    setTimeout(function() {
                        defer.reject(
                            'Request for Vimeo player has timed out after 30 seconds.'
                        );
                    }, 30000);

                    player.ready().then(function() {
                        defer.resolve(player);
                    });
                });
            });
        }
    };

    var selectors = {
        loadPlayerButton: '.video-section__load-player-button',
        closePlayerButton: '.video-section__player-close',
        playerContainer: '.video-section__player',
        cover: '.video-section__cover',
        errorMessage: '.video-section__error',
        bodyOverlay: '.video-section__body-overlay',
        body: 'body'
    };
    var classes = {
        playerLoading: 'video-section--loading',
        playerLoaded: 'video-section--loaded',
        playerError: 'video-section--error',
        videoPlaying: 'video-playing'
    };

    function Video(container) {
        this.$container = $(container);
        var sectionId = this.$container.attr('data-section-id');
        this.namespace = '.' + sectionId;
        this.onLoad();
    }

    Video.prototype = _.assignIn({}, Video.prototype, {
        onLoad: function() {
            this.$container
                .on('click', selectors.loadPlayerButton, this._loadPlayer.bind(this))
                .on('click', selectors.closePlayerButton, this._closePlayer.bind(this))
                .on('click', selectors.bodyOverlay, this._closePlayer.bind(this));
        },

        _loadPlayer: function() {
            var $container = this.$container;
            var $playerContainer = $(selectors.playerContainer, $container);
            var playerType = this.$container.attr('data-video-type');

            var promiseVideoPlayer;

            if (playerType === 'youtube') {
                promiseVideoPlayer = this._loadYoutubePlayer($playerContainer[0]);
            } else if (playerType === 'vimeo') {
                promiseVideoPlayer = this._loadVimeoPlayer($playerContainer[0]);
            }

            return promiseVideoPlayer
                .then(this._onPlayerLoadReady.bind(this))
                .fail(this._onPlayerLoadError.bind(this));
        },

        _loadYoutubePlayer: function(container) {
            return youtube
                .promisePlayer(container, {
                    videoId: this.$container.attr('data-video-id'),
                    ratio: 16 / 9,
                    playerVars: {
                        modestbranding: 1,
                        autoplay: 1,
                        showinfo: 0,
                        rel: 0
                    }
                })
                .then(
                    function(player) {
                        this.player = player;
                    }.bind(this)
                );
        },

        _loadVimeoPlayer: function(container) {
            return vimeo
                .promisePlayer(container, {
                    id: this.$container.attr('data-video-id')
                })
                .then(
                    function(player) {
                        this.player = player;
                        this.player.play();
                    }.bind(this)
                );
        },

        _onPlayerLoadReady: function() {
            $(selectors.closePlayerButton, this.$container)
                .show()
                .focus();
            $(selectors.cover, this.$container).addClass(classes.playerLoaded);
            this.$container.addClass(classes.playerLoaded);

            this._setScrollPositionValues();

            $(selectors.body).addClass(classes.videoPlaying);

            $(document).on('keyup' + this.namespace, this._closeOnEscape.bind(this));
            $(window).on(
                'resize' + this.namespace,
                this._setScrollPositionValues.bind(this)
            );
            slate.a11y.trapFocus({
                $container: this.$container,
                namespace: this.namespace
            });
        },

        _onPlayerLoadError: function(err) {
            this.$container.addClass(classes.playerError);
            $(selectors.errorMessage, this.$container).text(err);
        },

        _closeOnEscape: function(evt) {
            if (evt.keyCode !== 27) {
                return;
            }

            this._closePlayer();
            $(selectors.loadPlayerButton, this.$container).focus();
        },

        _onScroll: function() {
            var scrollTop = $(window).scrollTop();

            if (
                scrollTop > this.videoTop + 0.25 * this.videoHeight ||
                scrollTop + this.windowHeight <
                this.videoBottom - 0.25 * this.videoHeight
            ) {
                // Debounce DOM edits to the next frame with requestAnimationFrame
                requestAnimationFrame(this._closePlayer.bind(this));
            }
        },

        _setScrollPositionValues: function() {
            this.videoHeight = this.$container.outerHeight(true);
            this.videoTop = this.$container.offset().top;
            this.videoBottom = this.videoTop + this.videoHeight;
            this.windowHeight = $(window).innerHeight();
        },

        _closePlayer: function() {
            $(selectors.body).removeClass(classes.videoPlaying);
            $(selectors.cover, this.$container).removeClass(classes.playerLoaded);
            this.$container.removeClass(classes.playerLoaded);
            $(selectors.closePlayerButton, this.$container).hide();

            slate.a11y.removeTrapFocus({
                $container: this.$container,
                namespace: this.namespace
            });

            if (typeof this.player.destroy === 'function') {
                this.player.destroy();
            } else if (typeof this.player.unload === 'function') {
                this.player.unload();
            }

            $(document).off(this.namespace);
            $(window).off(this.namespace);
        }
    });

    return Video;
})();

theme.CollectionsList = (function() {
    function CollectionsList(container) {
        var $container = (this.$container = $(container));
        var stretchImage = $container.is('[data-stretch-image]');

        // Early return if 'secondary image layout' is enabled
        if (stretchImage) return;

        var namespace = (this.namespace = '.' + $container.attr('data-section-id'));
        var self = this;

        self._collectionListFix();
        $(window).on(
            'resize' + namespace,
            $.debounce(250, function() {
                self._collectionListFix();
            })
        );
    }

    CollectionsList.prototype = _.assignIn({}, CollectionsList.prototype, {
        onUnload: function() {
            $(window).off(this.namespace);
        },

        _collectionListFix: function() {
            var numberRows = this.$container.find('.grid').data('number-rows');
            var $featureCards = this.$container.find('.featured-card');

            // We can exit if 'Use secondary image layout' is enabled
            if ($featureCards.is('[data-stretch-image]')) return;

            // Go through each of the rows
            for (var i = 0; i < numberRows; i++) {
                var maxWrapperHeight = 0;
                var maxHeaderHeight = 0;
                var $currentRow = $featureCards.filter(
                    "[data-row-number='" + (i + 1) + "']"
                );
                var $cardHeaders = $currentRow.find('.featured-card__header');

                // Find the max heights for each row
                $currentRow.each(function() {
                    var $cardTitle = $(this).find('.featured-card__title');
                    var $cardAction = $(this).find('.featured-card__action');
                    var $cardImageWrapper = $(this).find('.featured-card__image-wrapper');
                    var headerHeight =
                        $cardTitle.outerHeight() + $cardAction.outerHeight() + 65;
                    var wrapperHeight = $cardImageWrapper.outerHeight();
                    if (headerHeight > maxHeaderHeight) {
                        maxHeaderHeight = headerHeight;
                    }
                    if (wrapperHeight > maxWrapperHeight) {
                        maxWrapperHeight = wrapperHeight;
                    }
                });

                // Set the heights of the headers and cards for this row with padding
                $cardHeaders.outerHeight(maxHeaderHeight);
                $currentRow.height(maxWrapperHeight + maxHeaderHeight + 40);
            }
        }
    });

    return CollectionsList;
})();

theme.ParrallaxImage = (function() {
    function ParrallaxImage(container) {
        this.container = container;
        this.sectionId = $(container).attr('data-section-id');
        this.namespace = 'parallax-' + this.sectionId;
        var images = document.getElementsByClassName('thumbnail' + this.sectionId);
        new simpleParallax(images, {
            scale: 1.5,
            delay: .6,
        });
    }

    ParrallaxImage.prototype = $.extend({}, ParrallaxImage.prototype, {
        onUnload: function(evt) {
            var instance = new simpleParallax(images);
            instance.destroy();
            delete theme.ParrallaxImage[this.namespace];
        }
    });

    return ParrallaxImage;
})();

theme.init = function() {
    theme.customerTemplates.init();
    slate.rte.wrapTable();
    slate.rte.iframeReset();

    // Common a11y fixes
    slate.a11y.pageLinkFocus($(window.location.hash));

    $('.in-page-link').on('click', function(evt) {
        slate.a11y.pageLinkFocus($(evt.currentTarget.hash));
    });

    $('a[href="#"]').on('click', function(evt) {
        evt.preventDefault();
    });


    //scroll animation
    AOS.init({
        startEvent: 'DOMContentLoaded',
        offset: 30, // offset (in px) from the original trigger point
        delay: 0, // values from 0 to 3000, with step 50ms
        duration: 1000,
        once: true
    });
    window.addEventListener('load', function() {
        AOS.refresh();
    });


    // Sections
    var sections = new theme.Sections();
    sections.register('header', theme.HeaderSection);
    sections.register('product', theme.Product);
    sections.register('slideshow-section', theme.SlideshowSection);
    sections.register('cart', theme.Cart);
    sections.register('instagrams', theme.Instagrams);
    sections.register('masonries', theme.Masonry);
    sections.register('productlist', theme.Productlists);
    sections.register('producttab', theme.Producttabs);
    sections.register('slickCarousels', theme.slickCarousel);
    sections.register('video', theme.Video);
    sections.register('collections-list', theme.CollectionsList);
    sections.register('parallax-image', theme.ParrallaxImage);
    sections.register('bgcollection', theme.Bgcollection);

    // Standalone modules
    $(window).on('load', theme.articleImages);
    theme.passwordModalInit();
};

theme.articleImages = function() {
    var $indentedRteImages = $('.rte--indented-images');
    if (!$indentedRteImages.length) {
        return;
    }

    $indentedRteImages.find('img').each(function(i, el) {
        var $el = $(el);
        var attr = $el.attr('style');

        // Check if undefined or float: none
        if (!attr || attr === 'float: none;') {
            // Add class to parent paragraph tag if image is wider than container
            if ($el.width() >= $indentedRteImages.width()) {
                $el.parent('p').addClass('rte__image-indent');
            }
        }
    });
};

theme.passwordModalInit = function() {
    var $loginModal = $('#LoginModal');
    if (!$loginModal.length) {
        return;
    }

    // Initialize modal
    theme.PasswordModal = new window.Modals('LoginModal', 'login-modal', {
        focusOnOpen: '#Password'
    });

    // Open modal if errors exist
    if ($loginModal.find('.errors').length) {
        theme.PasswordModal.open();
    }
};

// CSS var ponyfill
theme.cssVar = (function() {
    cssVars();
})()

// Ajax search https://gist.github.com/awojtczyk/53d74c8af5f893841f33979b0cdcd6fe
theme.ajaxSearch = (function() {
    var $inputSearch = '.js-ajaxsearch',
        $resultsList = '.search-results',
        $input = $($inputSearch).find('input[name="q"]'),
        $currentAjaxRequest,
        $displayProducts = 6;

    $($inputSearch).css('position', 'relative').each(function() {
        $input.attr('autocomplete', 'off').bind('keyup change', function() {
            var term = $(this).val(),
                form = $(this).closest('form'),
                searchURL = '/search?type=product&q=*' + term + '*';
            if (term.length > 2 && term !== $(this).attr('data-old-term')) {
                $(this).attr('data-old-term', term);
                if ($currentAjaxRequest !== undefined) $currentAjaxRequest.abort();
                $currentAjaxRequest = $.getJSON(searchURL + '&view=json', function(data) {
                    $($resultsList).empty();

                    if (data.results_count === 0) {
                        $($resultsList).html('<p class="text-center">' + theme.strings.ajaxSearchNoResult + '</p>')
                    } else {
                        $.each(data.results, function(index, item) {
                            if (index < $displayProducts) {
                                var itemPrice = theme.Currency.formatMoney(item.price, theme.moneyFormat);
                                var link = $('<a class="d-inline-flex ' + index + '"></a>')
                                    .attr('href', item.url)
                                    .append('<span class="image"><img src="' + item.thumbnail + '" /></span>')
                                    .append('<div class="meta"><p class="title">' + item.title + '</p>' + itemPrice + '</div>')
                                    .wrap('<div class="ajax-search-item"></div>');
                                $($resultsList).append(link.parent());
                                theme.updateCurrencies();
                            }
                        });
                        if (data.results_count > $displayProducts) {
                            $($resultsList).append('<a class="btn btn--full" href="' + searchURL + '">' + theme.strings.ajaxSearchViewAll + ' (' + data.results_count + ')</a>');
                        }
                    }
                    $($resultsList).addClass('active').fadeIn(200);
                });
            }
        });
    });

    //escape when click somethings
    $(document).click(function(event) {
        var target = event.target;
        if (!$(target).is($inputSearch) && !$(target).parents().is($inputSearch)) {
            $($resultsList).slideUp(300);
        }
    });
})();

// Quickview https://github.com/kellyvaughn/quickview-for-shopify/blob/master/quickview.js.liquid
theme.quickview = (function() {
    var product_handle = '',
        quickviewButtonClass = '.js-btn-quickview',
        quickviewId = '#jsQuickview',
        quickviewOption = '#jsQuickview select',
        quickviewThumb = '#qv-product-images',
        quickviewAddCartButton = '.qv-add-button',
        quickviewPrice = '.qv-product-price',
        quickviewComparePrice = '.qv-product-compare-price';

    // 1. Show quickview
    $(document).on('click', quickviewButtonClass, function() {
        var quickviewAvaible = $(this).attr("data-pavailable");
        product_handle = $(this).data('handle');
        //ResetQuickview
        $(quickviewId).removeClass().addClass('modal fade');
        $(quickviewThumb).removeClass().empty();
        $('.qv-product-options').empty();

        //Pushdata
        $(quickviewId).addClass(product_handle).data('handle', product_handle);
        jQuery.getJSON('/products/' + product_handle + '.js', function(product) {
            var title = product.title;
            var type = product.type;
            var vendor = product.vendor;
            var price = 0;
            var compare_price = 0;
            var desc = product.description.slice(0, 90);
            var images = product.images;
            var variants = product.variants;
            var options = product.options;
            var url = '/products/' + product_handle;
            $('.qv-product-title').text(title);
            $('.qv-product-type').text(type);
            $('.qv-product-description').html(desc);
            $('.qv-view-product').attr('href', url);
            $('.qv-view-type').text(type);
            $('.qv-view-vendor').text(vendor)
            if (quickviewAvaible == 'true') {
                $(quickviewAddCartButton).prop('disabled', false).html(theme.strings.addToCart);
            } else {
                $(quickviewAddCartButton).prop('disabled', true).html(theme.strings.soldOut);
            }
            $(product.variants).each(function(i, variants) {
                if (variants.sku != null) {
                    $('.qv-sku').addClass("show").removeClass("hide");
                    $('.qv-view-sku').text(product.variants[0].sku);
                } else {
                    $('.qv-sku').addClass("hide").removeClass("show");
                }

            });
            var imageCount = $(images).length;
            $(images).each(function(i, image) {
                image_embed = '<div><img src="' + image + '"></div>';
                image_embed = image_embed.replace('.jpg', '_800x.jpg').replace('.png', '_800x.png');
                $(quickviewThumb).append(image_embed);
            });
            $(quickviewThumb).slick({
                rtl: theme.rtl,
                'dots': true,
                'arrows': true,
                'respondTo': 'min',
                'useTransform': true
            }).css('opacity', '1');

            if (product.variants[0].option1 !== "Default Title") {
                $(options).each(function(i, option) {
                    var name = option.name;
                    var opt = name.replace(/ /g, '-').toLowerCase();
                    var selectClass = '.option.' + opt;
                    $('.qv-product-options').append('<div class="option-selection ' + opt + '"><span class="option text-uppercase font-weight-bold text-body">' + option.name + '</span><select class="option-' + i + ' option ' + opt + '"></select></div>');
                    $(option.values).each(function(i, value) {
                        $('.option.' + opt).append($('<option>', {
                            value: value,
                            text: value
                        }));
                    });
                });
            }
            $(product.variants).each(function(i, v) {
                if (v.inventory_quantity == 0) {
                    return true
                } else {
                    price = theme.Currency.formatMoney(v.price, theme.moneyFormat);
                    compare_price = theme.Currency.formatMoney(v.compare_at_price, theme.moneyFormat);
                    $(quickviewPrice).html(price);
                    if (v.compare_at_price !== null) {
                        $(quickviewComparePrice).html(compare_price).show();
                    } else {
                        $(quickviewComparePrice).hide();
                    }
                    theme.updateCurrencies();
                    $('select.option-0').val(v.option1);
                    $('select.option-1').val(v.option2);
                    $('select.option-2').val(v.option3);
                    return false
                }
            });
        });
        //addCartQuickview
    });
    // 2. Add to cart
    $(document).on('click', quickviewAddCartButton, function() {
        product_handle = $(quickviewId).data('handle');
        var qty = $('.qv-quantity').val(),
            selectedOptions = '',
            var_id = '';

        function processCart() {
            jQuery.post('/cart/add.js', {
                    quantity: qty,
                    id: var_id
                }, null, "json").done(function(item) {
                    var htmlVariant = item.variant_title !== null ? '<i>(' + item.variant_title + ')</i>' : '';
                    var styleCart = $('.js-mini-cart').attr("data-cartmini");
                    if (styleCart != 'true') {
                        var htmlAlert = '<div class="media mt-2 alert--cart"><a class="mr-3" href="/cart"><img class="lazyload" data-src="' + item.image + '"></a><div class="media-body align-self-center"><p class="m-0 font-weight-bold">' + item.product_title + ' x ' + item.quantity + '</p>' + htmlVariant + '<div><div>';
                        theme.alert.new(theme.strings.addToCartSuccess, htmlAlert, 3000, 'notice');
                    }
                    theme.miniCart.updateElements();
                    theme.miniCart.generateCart();
                })
                .fail(function($xhr) {
                    var data = $xhr.responseJSON;
                    theme.alert.new('', data.description, 3000, 'warning');
                });
        }
        $(quickviewOption).each(function(i) {
            if (selectedOptions == '') {
                selectedOptions = $(this).val();
            } else {
                selectedOptions = selectedOptions + ' / ' + $(this).val();
            }
        });
        jQuery.getJSON('/products/' + product_handle + '.js', function(product) {
            if (product.variants.length === 1) {
                var_id = product.variants[0].id;
            } else {
                $(product.variants).each(function(i, v) {
                    if (v.title == selectedOptions) {
                        var_id = v.id;
                    }
                });
            }
            processCart();
        });
    });
    // 3. Select variants
    $(document).on('change', quickviewOption, function() {
        var selectedOptions = '';
        $(quickviewOption).each(function(i) {
            if (selectedOptions == '') {
                selectedOptions = $(this).val();
            } else {
                selectedOptions = selectedOptions + ' / ' + $(this).val();
            }
        });
        jQuery.getJSON('/products/' + product_handle + '.js', function(product) {
            $(product.variants).each(function(i, v) {
                if (v.title == selectedOptions) {
                    if (v.featured_image !== null) {
                        var iSlick = v.featured_image.position - 1;
                        $(quickviewThumb).slick('slickGoTo', iSlick);
                    }
                    var price = theme.Currency.formatMoney(v.price, theme.moneyFormat);
                    var compare_price = theme.Currency.formatMoney(v.compare_at_price, theme.moneyFormat);
                    $(quickviewPrice).html(price);
                    $(quickviewComparePrice).html(compare_price);
                    if (v.sku != null) {
                        $('.qv-sku').addClass("show").removeClass("hide");
                        $('.qv-view-sku').text(v.sku);
                    } else {
                        $('.qv-sku').addClass("hide").removeClass("show");
                    }
                    if (v.compare_at_price !== null) {
                        $(quickviewComparePrice).html(compare_price).show();
                    } else {
                        $(quickviewComparePrice).hide();
                    }
                    theme.updateCurrencies();
                    if (v.inventory_management === null) {
                        $(quickviewAddCartButton).prop('disabled', false).val(theme.strings.addToCart);
                    } else {
                        if (v.inventory_quantity < 1) {
                            $(quickviewAddCartButton).prop('disabled', true).val(theme.strings.soldOut);
                        } else {
                            $(quickviewAddCartButton).prop('disabled', false).val(theme.strings.addToCart);
                        }
                    }
                }
            });
        });
    });
})()

//Button add to cart (in grid item)
theme.addCartButton = (function() {
    var buttonClass = '.js-grid-cart';
    $(document).on('click', buttonClass, function() {
        var $this = $(this);
        var id = $this.data('id');
        $this.addClass('is-loading');
        Shopify.addItem(id, 1, function(item) {
            location.href = "/cart";
            var htmlVariant = item.variant_title !== null ? '<i>(' + item.variant_title + ')</i>' : '';
            var styleCart = $('.js-mini-cart').attr("data-cartmini");
            if (styleCart != 'true') {
                var htmlAlert = '<div class="media mt-2 alert--cart"><a class="mr-3" href="/cart"><img class="lazyload" data-src="' + item.image + '"></a><div class="media-body align-self-center"><p class="m-0 font-weight-bold">' + item.product_title + ' x ' + item.quantity + '</p>' + htmlVariant + '<div><div>';
            }
            theme.miniCart.updateElements();
            theme.miniCart.generateCart();
            setTimeout(function() {
                styleCart != 'true' ? theme.alert.new(theme.strings.addToCartSuccess, htmlAlert, 3000, 'notice') : '';
                $this.removeClass('is-loading');
            }, 1000);
        });
    })
})()

// Button add to cart (in grid item)
//theme.addCartButton = (function(){
//  var buttonClass = '.js-grid-cart';
//  $(document).on('click',buttonClass,function(){
//    var $this = $(this);
//    var id = $this.data('id');
//    $this.addClass('is-loading');
//    Shopify.addItem(id,1,function(item){
//      var htmlVariant = item.variant_title !== null ? '<i>('+item.variant_title+')</i>' : '';
//      var styleCart = $('.js-mini-cart').attr("data-cartmini");
//        if(styleCart != 'true'){
//          var htmlAlert = '<div class="media mt-2 alert--cart"><a class="mr-3" href="/cart"><img class="lazyload" data-src="'+item.image+'"></a><div class="media-body align-self-center"><p class="m-0 font-weight-bold">'+item.product_title+' x '+ item.quantity +'</p>'+htmlVariant+'<div><div>';
//        }
//      theme.miniCart.updateElements();
//      theme.miniCart.generateCart();
//      setTimeout(function() {
//        styleCart != 'true' ? theme.alert.new(theme.strings.addToCartSuccess,htmlAlert,3000,'notice'): '';
//        $this.removeClass('is-loading');
//      }, 1000);
//    });
// })
//})()

// Multi currencies 
if (theme.enableCurrencies) {
    // Can be 'money_format' or 'money_with_currency_format'
    Currency.format = 'money_format';
    var shopCurrency = Shopify.currency.active;
    var cookieCurrency = Currency.cookie.read();
    // Fix for customer account pages 
    jQuery('span.money span.money').each(function() {
        jQuery(this).parent('span.money').removeClass('money');
    });
    // Add precalculated shop currency to data attribute 
    jQuery('span.money').each(function() {
        jQuery(this).attr('data-currency-' + Shopify.currency.active, jQuery(this).html());
    });
    // Select all your currencies buttons.
    var buttons = jQuery('#currencies a'),
        currentCurrencies = jQuery('.pre-currencies');
    // When the page loads.
    if (cookieCurrency == null || cookieCurrency == shopCurrency) {
        Currency.currentCurrency = shopCurrency;
    } else {
        Currency.currentCurrency = cookieCurrency;
        Currency.convertAll(shopCurrency, cookieCurrency);
        buttons.removeClass('selected');
        jQuery('#currencies a[data-currency=' + cookieCurrency + ']').addClass('selected');
        var htmlCurrently = jQuery('#currencies a[data-currency=' + cookieCurrency + ']').html();
        currentCurrencies.html(htmlCurrently);
    }
    buttons.click(function() {
        buttons.removeClass('selected');
        jQuery(this).addClass('selected');
        var newCurrency = jQuery(this).attr('data-currency');
        var htmlCurrently = jQuery(this).html();
        currentCurrencies.html(htmlCurrently);
        Currency.convertAll(Currency.currentCurrency, newCurrency);
    });
    // For product options.
    var original_selectCallback = window.selectCallback;
    var selectCallback = function(variant, selector) {
        original_selectCallback(variant, selector);
        Currency.convertAll(shopCurrency, jQuery('#currencies a.selected').attr('data-currency'));
    };
}
theme.updateCurrencies = function() {
    Currency.convertAll(shopCurrency, jQuery('#currencies a.selected').attr('data-currency'));
}

// MiniCart
theme.miniCart = (function() {
    var miniCart = '.js-mini-cart',
        styleCart = $(miniCart).attr("data-cartmini"),
        cartToggle = '.js-toggle-cart',
        cartCount = '.js-cart-count',
        cartContent = '.js-mini-cart-content',
        cartTotal = '.js-cart-total',
        $btnCheckout = $('.js-cart-btn-checkout'),
        numberDisplayed = 5,
        // emptyCartHTML = '<div class="alert">' + theme.strings.cartEmpty + '</div>';

        // function updateElements() {
        //     Shopify.getCart(function(cart) {

        //         if (cart.item_count === 0) {
        //             $(cartContent).html(emptyCartHTML);
        //             $btnCheckout.addClass('disabled');
        //             styleCart === 'true' ? $(miniCart).removeClass('active') : null;

        //         } else {
        //             $btnCheckout.removeClass('disabled');
        //             styleCart === 'true' ? $(miniCart).addClass('active') : null;
        //         }
        //         $(cartCount).text(cart.item_count);
        //         $(cartTotal).html(theme.Currency.formatMoney(cart.total_price, theme.moneyFormat));
        //         theme.freeShipping.load(cart);
        //         theme.updateCurrencies();
        //     })
        // }

        function generateCart() {

            Shopify.getCart(function(cart) {

                var htmlCart = cart.item_count === 0 ? emptyCartHTML : '',
                    itemCount = cart.items.length,
                    forLoop = itemCount < numberDisplayed ? itemCount : numberDisplayed;
                //styleCart === 'true' ? cart.items.length ? $(miniCart).addClass('active'): $(miniCart).removeClass('active') :null;

                // add list items
                for (var i = 0; i < forLoop; i++) {
                    var product = cart.items[i],
                        productPrice = theme.Currency.formatMoney(product.price, theme.moneyFormat);
                    htmlCart += '<div class="mini-cart-item">';
                    htmlCart += '	<a class="mini-cart-image" href="' + product.url + '">';
                    htmlCart += '		<img src="' + product.image + '"/>';
                    htmlCart += '	</a>';
                    htmlCart += '	<div class="mini-cart-meta">';
                    htmlCart += '		<p ><a href="' + product.url + '">' + product.title + '</a></p>';
                    htmlCart += '		<span> ' + productPrice + '</span><b> x ' + product.quantity + '</b>';
                    htmlCart += '	</div>';
                    htmlCart += '	<button class="btn js-remove-mini-cart" data-id="' + product.id + '">&times;</button>';
                    htmlCart += '</div>';
                }
                if (itemCount > numberDisplayed) {
                    htmlCart += '<a class="js-btn-viewmore" href="/cart">' + theme.strings.cartMore + '(' + (itemCount - numberDisplayed) + ')</a>'
                }
                // add total price and cart button / checkout button
                $(cartContent).html(htmlCart);
                $(cartTotal).html(theme.Currency.formatMoney(cart.total_price, theme.moneyFormat));
                theme.updateCurrencies();
            })
        }
        // 2. Button remove items
    $(document).on('click', '.js-remove-mini-cart', function() {
        var itemId = $(this).data('id');
        var isOuterMiniCart = $(this).closest(miniCart).length === 0 ? true : false; // check element from mini cart or not

        // hide items
        $(this).parent().fadeOut();

        //remove from cart
        Shopify.changeItem(itemId, 0, updateElements);
        Shopify.getCart(function(cart) {
            if (cart.items.length > numberDisplayed || isOuterMiniCart) {
                generateCart();
            }
        });
    });

    //Keep popup when click cart / UX
    $(document).on('click', cartToggle, function() {
        $(this).parent(miniCart).toggleClass('active');
    });
    $(document).on('click', '.overlaycart', function() {
        $(this).parent(miniCart).removeClass('active');
    });

    // gen minicart when load page
    generateCart();
    return {
        updateElements: updateElements,
        generateCart: generateCart
    }
})()

// Free shipping
theme.freeShipping = (function() {
    var $freeShippingClass = $('.js-free-shipping'),
        $freeShippingTextClass = $('.js-free-shipping-text'),
        $free_fisrt = $freeShippingClass.attr('data-start'),
        $free_end = $freeShippingClass.attr('data-end')
    minOrderValue = parseInt($freeShippingClass.data('value')) || 0,
        $percentClass = $('.js-free-shipping .progress-bar');

    function generate(cart) {
        var priceCart = cart.total_price;
        if (priceCart >= minOrderValue) {
            $percentClass.css('width', '100%').removeClass('progress-bar-striped bg-primary');
            $freeShippingTextClass.text(theme.strings.freeShipping)
        } else {
            let percent = priceCart / minOrderValue * 100;
            let left = Shopify.formatMoney((minOrderValue - priceCart), theme.moneyFormat);
            $percentClass.css('width', percent + '%').addClass('progress-bar-striped primary');
            $freeShippingTextClass.html($free_fisrt + ' ' + left + ' ' + $free_end);
            theme.updateCurrencies();
        }
    }

    Shopify.getCart(function(cart) {
        generate(cart);
    });

    return {
        load: generate
    }
})()

// Shipping time - https://github.com/phstc/jquery-dateFormat
theme.shippingTime = (function() {
    var $shippingTime = $('.js-shipping-time'),
        shippingTime = $shippingTime.data('time') || '',
        now = new Date(),
        restHour = 23 - now.getHours(),
        restMinute = 59 - now.getMinutes();
    if (shippingTime !== '') {
        var nextTime = new Date(now.getTime() + shippingTime * 86400000),
            formatTime = $.format.date(nextTime, "ddd, dd MMMM yyyy"),
            htmlShipping = 'Order in the next <b>' + restHour + '</b> hours <b>' + restMinute + '</b> minutes to get it by <b>' + formatTime + '</b>. ';
        $shippingTime.html(htmlShipping);
    }
})()

// Infinite scroll - https://github.com/Elkfox/Ajaxinate/blob/master/dist/ajaxinate.min.js
theme.infiniteScroll = (function() {
    function initInfiniteScroll() {
        if ($('.AjaxinateLoop').length === 0) {
            return;
        } else {
            var endlessScroll = new Ajaxinate({
                loadingText: '<div class="text-center"><div class="' + theme.loadingClass + '" role="status"></div></div>',
                callback: function() {
                    theme.wishlist.load();
                    theme.compare.load();
                    theme.countdown.load();
                    theme.priceRange.load();
                    theme.tooltip.load();
                    theme.collectionView.triggerView();
                    theme.swatchCard2.load();
                }
            });
        }
    }

    // Infinite scroll in other page (blog, list-collection)
    function initOtherPages() {
        var otherPages = new Ajaxinate({
            loadingText: '<div class="text-center"><div class="' + theme.loadingClass + '" role="status"></div></div>',
            container: '.js-pagination-content',
            pagination: '.js-pagination'
        });
    }

    document.addEventListener("DOMContentLoaded", function() {
        initInfiniteScroll();
        initOtherPages();
    });

    return {
        load: initInfiniteScroll
    }
})()

// Scroll to fixed
theme.scrollToFixed = (function() {
    var window_width = $(window).width();

    if (window_width < 768) {
        $(".js-stick-parent").trigger("sticky_kit:detach");
    } else {
        make_sticky();
    }
    $(window).resize(function() {

        window_width = $(window).width();

        if (window_width < 768) {
            $(".js-stick-parent").trigger("sticky_kit:detach");
        } else {
            make_sticky();
        }
    });

    function make_sticky() {
        $('.js-stick-parent').stick_in_parent();
    }

})()


theme.headersidebar = (function() {
    $('#dismiss, .overlaysidebar').on('click', function() {
        // hide sidebar
        $('#sidebar').removeClass('active');
        // hide overlay
        $('.overlaysidebar').removeClass('active');
    });

    $('#sidebarCollapse').on('click', function() {
        // open sidebar
        $('#sidebar').addClass('active');
        // fade in the overlay
        $('.overlaysidebar').addClass('active');
        $('.collapse.in').toggleClass('in');
        $('a[aria-expanded=true]').attr('aria-expanded', 'false');
    });
})()

// Wishlist
theme.wishlist = (function() {
    var wishlistButtonClass = '.js-btn-wishlist',
        wishlistRemoveButtonClass = '.js-remove-wishlist',
        $wishlistCount = $('.js-wishlist-count'),
        $wishlistContainer = $('.js-wishlist-content'),
        wishlistObject = JSON.parse(localStorage.getItem('localWishlist')) || [],
        wishlistPageUrl = $('.js-wishlist-link').attr('href'),
        loadNoResult = function() {
            $wishlistContainer.html('<div class="col text-center"><div class="alert alert-warning d-inline-block">' + theme.strings.wishlistNoResult + '</div></div>');
        };

    function updateWishlist(self) {
        var productHandle = $(self).data('handle'),
            allSimilarProduct = $(wishlistButtonClass + '[data-handle="' + productHandle + '"]');
        var isAdded = $.inArray(productHandle, wishlistObject) !== -1 ? true : false;
        if (isAdded) {
            // go to wishlist page
            window.location.href = wishlistPageUrl;
        } else {
            wishlistObject.push(productHandle);
            allSimilarProduct.fadeOut('slow').fadeIn('fast').html(theme.strings.wishlistIconAdded + theme.strings.wishlistTextAdded);
            //change tooltip
            allSimilarProduct.attr('data-original-title', theme.strings.wishlistTextAdded);
            $('.tooltip-inner').text(theme.strings.wishlistTextAdded);
        }
        localStorage.setItem('localWishlist', JSON.stringify(wishlistObject));
        $wishlistCount.text(wishlistObject.length);
    };

    function loadWishlist() {
        $wishlistContainer.html('');
        //page wishlist
        if (wishlistObject.length > 0) {
            for (var i = 0; i < wishlistObject.length; i++) {
                var productHandle = wishlistObject[i];
                Shopify.getProduct(productHandle, function(product) {
                    var htmlProduct = '';
                    var productPrice = product.price_varies ? 'from ' + theme.Currency.formatMoney(product.price_min, theme.moneyFormat) : theme.Currency.formatMoney(product.price, theme.moneyFormat);
                    var productComparePrice = product.compare_at_price_min !== 0 ? theme.Currency.formatMoney(product.compare_at_price_min, theme.moneyFormat) : '';
                    htmlProduct += '<div class="js-wishlist-item col-md-4 col-sm-6 col-xs-6 col-12 mb-4">';
                    htmlProduct += '<div class="js-wishlist-itembox">';
                    htmlProduct += '<div class=" d-flex flex-row p-4">';
                    htmlProduct += '	<a class="d-inline-block mr-4 " href="' + product.url + '">';
                    htmlProduct += '		<img src="' + product.featured_image + '"/>';
                    htmlProduct += '	</a>';
                    htmlProduct += '	<div><a href="' + product.url + '" class="title-prouct d-block h4 text-body" >' + product.title + '</a>';
                    htmlProduct += '	<span> ' + productPrice + '</span>';
                    htmlProduct += '	 <s>' + productComparePrice + '</s></div>';
                    htmlProduct += '<button class="btn js-remove-wishlist" data-handle="' + product.handle + '">' + theme.strings.wishlistRemove + '</button>';
                    htmlProduct += '</div>';
                    htmlProduct += '</div>';
                    htmlProduct += '</div>';
                    $wishlistContainer.append(htmlProduct);
                    theme.updateCurrencies();
                });
            }
        } else {
            loadNoResult();
        }

        //count items
        $wishlistCount.text(wishlistObject.length);

        //button text
        $(wishlistButtonClass).each(function() {
            var productHandle = $(this).data('handle');
            var iconWishlist = $.inArray(productHandle, wishlistObject) !== -1 ? theme.strings.wishlistIconAdded : theme.strings.wishlistIcon;
            var textWishlist = $.inArray(productHandle, wishlistObject) !== -1 ? theme.strings.wishlistTextAdded : theme.strings.wishlistText;
            $(this).html(iconWishlist + textWishlist).attr('title', textWishlist);
        });
    }

    $(document).on('click', wishlistButtonClass, function(event) {
        event.preventDefault();
        updateWishlist(this);
    });
    $(document).on('click', wishlistRemoveButtonClass, function() {
        var productHandle = $(this).data('handle'),
            allSimilarProduct = $(wishlistButtonClass + '[data-handle="' + productHandle + '"]');

        //update button
        allSimilarProduct.html(theme.strings.wishlistIcon + theme.strings.wishlistText);
        //update tooltip
        allSimilarProduct.attr('data-original-title', theme.strings.wishlistText);
        $('.tooltip-inner').text(theme.strings.wishlistText);
        //update Object
        wishlistObject.splice(wishlistObject.indexOf(productHandle), 1);
        localStorage.setItem('localWishlist', JSON.stringify(wishlistObject));
        // Remove element
        $(this).closest('.js-wishlist-item').fadeOut(); // or .remove()
        //count
        $wishlistCount.text(wishlistObject.length);
        if (wishlistObject.length === 0) {
            loadNoResult();
        }
    });

    loadWishlist();
    $(document).on('shopify:section:load', loadWishlist);
    return {
        load: loadWishlist
    }
})()

// Compare
theme.compare = (function() {
    var compareButtonClass = '.js-btn-compare',
        compareRemoveButtonClass = '.js-remove-compare',
        $compareCount = $('.js-compare-count'),
        $compareContainer = $('.js-compare-content'),
        compareObject = JSON.parse(localStorage.getItem('localCompare')) || [],
        alertClass = 'notice';

    function updateCompare(self) {
        var productHandle = $(self).data('handle'),
            alertText = '';
        var isAdded = $.inArray(productHandle, compareObject) !== -1 ? true : false;
        if (isAdded) {
            compareObject.splice(compareObject.indexOf(productHandle), 1);
            alertText = theme.strings.compareNotifyRemoved;
            alertClass = 'notice';
        } else {
            if (compareObject.length === 4) {
                alertText = theme.strings.compareNotifyMaximum;
                alertClass = 'error';
            } else {
                alertClass = 'notice';
                compareObject.push(productHandle);
                alertText = theme.strings.compareNotifyAdded;
            }
        }
        localStorage.setItem('localCompare', JSON.stringify(compareObject));
        theme.alert.new(theme.strings.compareText, alertText, 2000, alertClass);
        $compareCount.text(compareObject.length);
    };

    function loadCompare() {
        var compareGrid;
        $compareContainer.html('');
        //popup compare
        if (compareObject.length > 0) {
            compareGrid = compareObject.length === 1 ? 'col-md-6 col-sm-6' : 'col';
            for (var i = 0; i < compareObject.length; i++) {
                var productHandle = compareObject[i];
                Shopify.getProduct(productHandle, function(product) {
                    var htmlProduct = '',
                        productPrice = product.price_varies ? 'from ' + theme.Currency.formatMoney(product.price_min, theme.moneyFormat) : theme.Currency.formatMoney(product.price, theme.moneyFormat),
                        productComparePrice = product.compare_at_price_min !== 0 ? theme.Currency.formatMoney(product.compare_at_price_min, theme.moneyFormat) : '',
                        productAvailable = product.available ? theme.strings.available : theme.strings.unavailable,
                        productAvailableClass = product.available ? 'alert-success' : 'alert-danger',
                        productTypeHTML = product.type !== "" ? '<a href="/collections/types?q=' + product.type + '">' + product.type + '</a>' : '<span>' + theme.strings.none + '</span>',
                        productVendorHTML = product.vendor !== "" ? '<a href="/collections/vendors?q=' + product.vendor + '">' + product.vendor + '</a>' : '<span>' + theme.strings.none + '</span>';
                    htmlProduct += '<div class="compare-item ' + compareGrid + ' col-xs-6">';
                    htmlProduct += '	<a href="' + product.url + '">';
                    htmlProduct += '		<img src="' + Shopify.resizeImage(product.featured_image, 'x300') + '"/>';
                    htmlProduct += '	</a>';
                    htmlProduct += '	<hr /><h5 >' + product.title + '</h5>';
                    htmlProduct += '	<hr /><s>' + productComparePrice + '</s>';
                    htmlProduct += '	<span> ' + productPrice + '</span>';
                    htmlProduct += '	<hr /><span class=' + productAvailableClass + '> ' + productAvailable + '</span>';
                    htmlProduct += '	<hr />' + productTypeHTML;
                    htmlProduct += '	<hr />' + productVendorHTML;
                    htmlProduct += '  <hr /><button class="btn js-remove-compare btn-theme gradient-theme" data-handle="' + product.handle + '">' + theme.strings.compareRemove + '</button>';
                    htmlProduct += '</div>';
                    $compareContainer.append(htmlProduct);
                    theme.updateCurrencies();
                });
            }
        } else {
            $compareContainer.html('<div class="alert alert-warning d-inline-block">' + theme.strings.compareNoResult + '</div>');
        }

        //button text
        $(compareButtonClass).each(function() {
            var productHandle = $(this).data('handle');
            var status = $.inArray(productHandle, compareObject) !== -1 ? 'added' : '';
            $(this).removeClass('added').addClass(status);
        });

        //count items
        $compareCount.text(compareObject.length);
    }
    $(document).on('click', compareButtonClass, function(event) {
        event.preventDefault();
        updateCompare(this);
        loadCompare();
    });
    $(document).on('click', compareRemoveButtonClass, function() {
        var productHandle = $(this).data('handle');
        compareObject.splice(compareObject.indexOf(productHandle), 1);
        localStorage.setItem('localCompare', JSON.stringify(compareObject));
        loadCompare();
    });

    loadCompare();
    $(document).on('shopify:section:load', loadCompare);
    return {
        load: loadCompare
    }
})()

// Popup newsletter
theme.popupNewletter = (function() {
    var $popupNewsletter = $('#jsPopupNewsletter'),
        $newsletterForm = $('#jsPopupNewsletter form'),
        date = new Date(),
        minutes = theme.timePopupNewsletter;
    minutesdelay = $popupNewsletter.attr('data-delay');
    if ($popupNewsletter.length === 1) {
        date.setTime(date.getTime() + (minutes * 60 * 1000));
        var setCookies = function() {
            $.cookie('cookiesNewsletter', 'disabled', { expires: date, path: '/' });
        };
        if ($.cookie('cookiesNewsletter') !== "disabled") {
            $(window).on('load', function() {
                setTimeout(function() {
                    $popupNewsletter.modal('show');
                }, minutesdelay * 1000);
            });
            $popupNewsletter.on('hidden.bs.modal', setCookies);
            $newsletterForm.submit(setCookies);
        }
    }
})()

// Cookie policy
theme.cookie = (function() {
    var $policy = $('.js-cookie-policy'),
        $closeButton = $('.js-btn-ok'),
        isOk = localStorage.getItem('localCookie') || '';
    if (isOk === '') {
        $policy.fadeIn('slow');
    }
    $closeButton.on('click', function() {
        localStorage.setItem('localCookie', 'accept');
        $policy.fadeOut('slow');
    })
})()

// Announcement Bar
theme.announcement = (function() {
    var $bar = $('.js-announcement-bar'),
        $closeButton = $('.js-ab-close'),
        isClosed = localStorage.getItem('localAnnouncement') || '';
    if (isClosed === '') {
        $bar.fadeIn();
        $bar.closest('.body-theme').addClass('body-announcement-bar');
    }
    $closeButton.on('click', function() {
        localStorage.setItem('localAnnouncement', 'closed');
        $bar.slideUp();
        $bar.closest('.body-theme').removeClass('body-announcement-bar');
    })
})()

// Open external link in new tab
theme.exLink = (function() {
    var links = document.links;
    for (let i = 0, linksLength = links.length; i < linksLength; i++) {
        if (links[i].hostname !== window.location.hostname && $(links[i]).attr('href') !== 'javascript:void(0)') {
            links[i].target = '_blank';
        }
    }
})()

// Deal- countdown
theme.countdown = (function() {
    function initCountdown() {
        $(".js-countdown").each(function() {
            var endTime = $(this).data('time'),
                htmlLayout = "<ul class='list--inline'><li class='gradient-theme-vertical'><span class='countdown-time'>%%D%%</span><span class='countdown-text'>Days</span></li><li class='gradient-theme-vertical'><span class='countdown-time'>%%H%%</span><span class='countdown-text'>Hours</span></li><li class='gradient-theme-vertical'><span class='countdown-time'>%%M%%</span><span class='countdown-text'>Mins</span></li><li class='gradient-theme-vertical'><span class='countdown-time'>%%S%%</span><span class='countdown-text'>Secs</span></li></ul>";
            $(this).lofCountDown({
                TargetDate: endTime,
                DisplayFormat: htmlLayout,
                FinishMessage: '<span class="alert alert-warning d-inline-block">' + theme.strings.countdownEndText + '</span>'
            });
        });
    }
    initCountdown();
    return {
        load: initCountdown
    }
})()

// Price range - Collection page
theme.priceRange = (function() {
    function initPriceRange() {
        var min = 0,
            max = 0,
            slideRange = '#js-slider-range',
            productCard = '.js-product-card',
            slideRangeWrap = '.slider-range-wr',
            rangeMin = '.js-range-min',
            rangeMax = '.js-range-max',
            enablePriceRange = $('#js-slider-range').length === 1 ? true : false;

        if (enablePriceRange) {
            $(productCard).each(function() {
                if (eval($(this).data('price')) > max) max = eval($(this).data('price'));
                if (min == 0) min = eval($(this).data('price'));
                else if (eval($(this).data('price')) < min) min = eval($(this).data('price'));
            });

            if (min === max) {
                $(slideRangeWrap).fadeOut();
            } else {
                $(slideRangeWrap).fadeIn();
            }

            $(slideRange).slider({
                range: true,
                min: min,
                max: max,
                values: [min, max],
                slide: function(event, ui) {
                    var price1 = (Shopify.formatMoney(ui.values[0], theme.moneyFormat));
                    var price2 = (Shopify.formatMoney(ui.values[1], theme.moneyFormat));
                    $(rangeMin).html(price1);
                    $(rangeMax).html(price2);
                    theme.updateCurrencies();

                    // Show/Hide product when dragging
                    $(productCard).each(function() {
                        if (eval($(this).data('price')) >= ui.values[0] && eval($(this).data('price')) <= ui.values[1]) {
                            $(this).parent().fadeIn();
                        } else {
                            $(this).parent().fadeOut();
                        }
                    });
                }
            });

            var price1 = (Shopify.formatMoney(min, theme.moneyFormat));
            var price2 = (Shopify.formatMoney(max, theme.moneyFormat));
            $(rangeMin).html(price1);
            $(rangeMax).html(price2);
            theme.updateCurrencies();

        }
    }
    initPriceRange();
    return {
        load: initPriceRange
    }
})()

// Collection view - Collection page
theme.collectionView = (function() {
    var btnView = '.js-btn-view',
        btnViewActive = '.js-btn-view.active';

    $(document).on('click', btnView, function() {
        var value = $(this).data('col'),
            $gridItemCol = $('.js-col');

        $(btnView).removeClass('active');
        $(this).addClass('active');

        $gridItemCol.removeClass().addClass('js-col col-sm-6 col-12');
        if (value === 3) {
            $gridItemCol.addClass('col-lg-4');
        } else if (value === 4) {
            $gridItemCol.addClass('col-lg-3');
        } else if (value === 5) {
            $gridItemCol.addClass('col-lg-2-4');
        } else if (value === 6) {
            $gridItemCol.addClass('col-lg-2');
        };
    })

    function triggerCollectionView() {
        $(btnViewActive).trigger('click');
    }

    return {
        triggerView: triggerCollectionView
    }
})()

// Swath variant in card item
theme.swatchCard = (function() {
    $(document).on('click', '.js-swatch-card-item', function() { //click or mouseover
        $(".js-swatch-card-item").removeClass("active");
        $(this).addClass("active");
        var newImage = $(this).data('image');
        var id = $(this).data('id');
        var gridItem = $(this).closest('.js-product-card');
        gridItem.find('.product-card__image').find('img').attr('srcset', newImage);
        gridItem.find('.js-grid-cart').data('id', id).attr('data-id', id);
    });
})()

theme.swatchCard2 = (function() {
    function initVariant(id) {
        var productJson = JSON.parse($('.customJson-' + id).html());
        var $selectorForm = $('.customform-' + id);
        var $button = $('.js-customform-addtocart-' + id);
        var $buttontext = $button.find('span');
        var $wrapObject = $selectorForm.closest('.js-product-card');
        var options = {
            $container: $selectorForm,
            enableHistoryState: false,
            product: productJson,
            singleOptionSelector: '.single-option-selector-' + id,
            originalSelectorId: '#ProductSelect-' + id
        };
        var variants = new slate.Variants(options);
        var AjaxCart = new window.AjaxCart($selectorForm);
        var _updateButton = function(evt) {
            var variant = evt.variant;
            if (variant === undefined) {
                $button.prop('disabled', true).removeClass('btn--sold-out');
                $buttontext.html(theme.strings.unavailable);
            } else {
                if (variant.available) {
                    $button.removeClass('btn--sold-out').prop('disabled', false);
                    $buttontext.html(theme.strings.addToCart);
                } else {
                    $button.prop('disabled', true).addClass('btn--sold-out');
                    $buttontext.html(theme.strings.soldOut);
                }
            }
        }
        var _updateImage = function(evt) {
            var variant = evt.variant;
            var $mainImage = $wrapObject.find('.product-card__image').find('img');
            if (variant !== undefined && variant.featured_image !== null) {
                var variantImage = variant.featured_image;
                $mainImage.attr('srcset', variantImage.src);
            }
        }
        var _updatePrice = function(evt) {
            var $price = $wrapObject.find('.product-card__price');
            var variant = evt.variant;
            if (variant !== undefined) {
                var htmlComparePrice = variant.compare_at_price !== null ? '<s class="product-card__regular-price"><span class="money">' + variant.compare_at_price + '</span></s>' : '';
                var htmlPrice = '<span class="money">' + variant.price + '</span>' + htmlComparePrice;
                $price.html(htmlPrice);
                theme.updateCurrencies();
            }
        }
        variants.$container.on(
            'variantChange', _updateButton
        );
        variants.$container.on(
            'variantChange', _updateImage
        );
        variants.$container.on(
            'variantChange', _updatePrice
        );
    }

    function initForm() {
        $('.js-customform').each(function() {
            var id = $(this).data('id');
            initVariant(id);
        })
    }

    initForm();
    return {
        load: initForm
    }
})()

// Loading
theme.loading = (function() {
    var $loading = $('#js-loading'),
        hasLoading = $('#js-loading').length === 0 ? false : true;
    if (hasLoading) {
        $(window).load(function() {
            $loading.fadeOut();
        });
    }
})()

theme.effectLeavingPage = (function() {
    window.onbeforeunload = function() {
        $('body').css('opacity', '0');
    }
})()

// Isotope
theme.isotope = (function() {
    var enableIsotope = $('.enable-isotope').length === 1 ? true : false,
        $grid = $('.js-grid'),
        filter = '.js-filter-isotope';

    function initIsotope() {
        if (enableIsotope) {
            $grid.isotope({
                itemSelector: '.grid-item',
                percentPosition: true
            })
            $(document).on('click', filter, function() {
                var filterValue = $(this).data('filter') === '*' ? $(this).data('filter') : '.' + $(this).data('filter');
                $(filter).removeClass('active');
                $(this).addClass('active');
                $grid.isotope({
                    filter: filterValue
                });
            });
            $(window).scroll(function() {
                $grid.isotope('layout');
            });
            $(window).load(function() {
                $grid.isotope('layout');
                $(filter).first().trigger('click');
            });
        }
    }
    initIsotope();
})()

//aos



// theme.Wow = (function(){
//   new WOW().init();
// })()




// Masonry
theme.Masonry = (function() {
    function Masonry(container) {
        this.$container = $(container).on('init', this._a11y.bind(this));
        var $masonry = this.$container;
        $masonry.isotope({
            itemSelector: '.grid-item',
            percentPosition: true,
            masonry: {
                columnWidth: '.grid-sizer'
            }
        });
        $(window).load(function() {
            $masonry.isotope('layout').css('opacity', '1');
        });
        $(window).scroll(function() {
            $masonry.isotope('layout').css('opacity', '1');
        });
    }

    Masonry.prototype = _.assignIn({}, Masonry.prototype, {
        _a11y: function(event, obj) {
            var $list = obj.$list;
            var $wrapper = this.$container.parent();

            // Remove default Slick aria-live attr until slider is focused
            $list.removeAttr('aria-live');

            // When an element in the slider is focused set aria-live
            $wrapper.on('focusin', function(evt) {
                if ($wrapper.has(evt.target).length) {
                    $list.attr('aria-live', 'polite');
                }
            });

            // Remove aria-live
            $wrapper.on('focusout', function(evt) {
                if ($wrapper.has(evt.target).length) {
                    $list.removeAttr('aria-live');
                }
            });
        }
    });

    return Masonry;
})();



// Cross-selling
theme.crosssell = (function() {
    var crosssellClass = '.js-crosssell',
        handles = $(crosssellClass).data('handles') || '',
        arrayHandle = handles.split(','),
        $blockCrosssell = $('.block-cross-sell'),
        variantSelectClass = '.js-cross-select',
        crossImageClass = '.cross-item-image',
        crossPriceClass = '.cross-item-money';

    function generateCrosssell() {
        for (var i = 0; i < arrayHandle.length; i++) {
            var productHandle = arrayHandle[i];
            Shopify.getProduct(productHandle, function(product) {
                var htmlCross = '',
                    htmlOption = '',
                    firstAvailableVariant = '',
                    variantCount = product.variants.length;

                // generate select box and check first avaiable variant
                for (var j = 0; j < variantCount; j++) {
                    var variant = product.variants[j],
                        variantImage = variant.featured_image === null ? product.featured_image : variant.featured_image.src,
                        disabled = variant.available ? '' : 'disabled';
                    htmlOption += '<option ' + disabled + ' data-id="' + variant.id + '" data-price="' + variant.price + '" data-image="' + variantImage + '">' + variant.title + '</option>';
                    if (firstAvailableVariant === '' && variant.available) {
                        firstAvailableVariant = variant
                    }
                }
                var productPrice = theme.Currency.formatMoney(firstAvailableVariant.price, theme.moneyFormat),
                    productImage = firstAvailableVariant.featured_image === null ? product.featured_image : firstAvailableVariant.featured_image.src,
                    selectHide = variantCount === 1 ? 'hide' : '';

                // generate HTML
                htmlCross += '<div class="col cross-item ' + product.handle + '">';
                htmlCross += '	<a class="cross-item-image" href="' + product.url + '" title="' + product.title + '"><img src="' + productImage + '" />' + theme.strings.cartIcon + '</a>';
                htmlCross += '	<a target="_blank" href="' + product.url + '" title="' + product.title + '" class="cross-item-title">' + product.title + '</a>';
                htmlCross += '	<span class="cross-item-money">' + productPrice + '</span>';
                htmlCross += '	<select class="js-cross-select ' + selectHide + '" data-image="' + productImage + '" data-price="' + firstAvailableVariant.price + '" data-item="' + firstAvailableVariant.id + '">' + htmlOption + '</select>';
                htmlCross += '</div>';
                $(crosssellClass).append(htmlCross);
                theme.updateCurrencies();
            });
        }
    }

    function showPopupCrosssell(lineItem) {
        //generate lineitem;
        var htmlLineItem = '';
        htmlLineItem += '<span class="alert alert-success d-inline-block mb-2">' + theme.strings.addToCartSuccess + '</span>';
        htmlLineItem += '<div><img src="' + lineItem.image + '" alt="Added Product"></div>';
        htmlLineItem += '<h4 class="cross-item-title">' + lineItem.title + '</h4>';
        htmlLineItem += '<div class="mb-2">' + theme.strings.cartQuantity + ': ' + lineItem.quantity + '</div>';
        $('.js-cross-added').hide().html(htmlLineItem).fadeIn();

        // show popup
        var $popupCrosssell = $('#jsCrosssell');
        $popupCrosssell.modal('show');
    }

    if (handles !== '') {
        $(document).on('click', crossImageClass, function(event) {
            event.preventDefault();
            var parent = $(this).closest('.cross-item'),
                itemId = parent.find(variantSelectClass).attr('data-item');
            Shopify.addItem(itemId, 1, function(lineItem) {
                theme.miniCart.updateElements();
                theme.miniCart.generateCart();
                showPopupCrosssell(lineItem);
            });
        });
        $(document).on('change', variantSelectClass, function() {
            var selectVariant = $(this).children(':selected'),
                selectVariantId = selectVariant.data('id'),
                parent = $(this).parent(),
                newPrice = theme.Currency.formatMoney(selectVariant.data('price'), theme.moneyFormat);

            if (selectVariant.data('image') !== '') {
                parent.find(crossImageClass).find('img').attr('src', selectVariant.data('image'));
            }
            $(this).attr('data-item', selectVariantId);
            parent.find(crossPriceClass).html(newPrice);
            theme.updateCurrencies();
        });
        $(document).on('shopify:section:load', generateCrosssell);
        generateCrosssell();
        $blockCrosssell.removeClass('hide');
    }
    return {
        showPopup: showPopupCrosssell
    }
})()

// Upsell
theme.upsell = (function() {
    var popupUpsell = '#jsUpsell',
        $button = $('#jsUpsell .btn'),
        productUpsellId = $('#jsUpsell').data('id') || '',
        buttonAcceptClass = 'js-btn-accept',
        delayTime = $('#jsUpsell').data('delay') || 3000,
        isUpsell = $(popupUpsell).length === 1 ? true : false;
    if (isUpsell) {
        $(document).ready(function() {
            setTimeout(function() {
                $(popupUpsell).modal('show');
            }, delayTime);
        });
        $button.on('click', function() {
            if ($(this).hasClass(buttonAcceptClass)) {
                Shopify.addItem(productUpsellId, 1, function(item) {
                    theme.miniCart.updateElements();
                    theme.miniCart.generateCart();
                    var htmlVariant = item.variant_title !== null ? '<i>(' + item.variant_title + ')</i>' : '';
                    var htmlAlert = '<div class="media mt-2 alert--cart"><a class="mr-3" href="/cart"><img class="lazyload" data-src="' + item.image + '"></a><div class="media-body align-self-center"><p class="m-0 font-weight-bold">' + item.product_title + ' x ' + item.quantity + '</p>' + htmlVariant + '<div><div>';
                    theme.alert.new(theme.strings.addToCartSuccess, htmlAlert, 3000, 'notice');
                })
            }
            $(popupUpsell).modal('hide');
        })
    }
})()

// Coupon
theme.coupon = (function() {
    var popupCoupon = '#jsCoupon',
        $button = $('#jsCoupon .js-btn-coupon'),
        delayTime = $('#jsCoupon').data('delay') || 3000,
        isCoupon = $(popupCoupon).length === 1 ? true : false,
        isCopied = localStorage.getItem('localCoupon') || '';
    if (isCoupon && isCopied === '') {
        $(document).ready(function() {
            setTimeout(function() {
                $(popupCoupon).modal('show');
            }, delayTime);
        });
        $button.on('click', function() {
            var copyText = document.getElementById("coupon_code");
            copyText.select();
            document.execCommand("Copy");
            $(popupCoupon).modal('hide');
            theme.alert.new('Coupon code', 'Successfully copied, now you can paste code at checkout', 4000);
            localStorage.setItem('localCoupon', 'copied');
        })
    }
})()

// Overwrite Shopify.onError in Shopify API
Shopify.onError = function(t, r) {
    var e = eval("(" + t.responseText + ")");
    var mess = e.message ? e.message + "(" + e.status + "): " + e.description : "Error : " + Shopify.fullMessagesFromErrors(e).join("; ") + "."
    theme.alert.new('Alert', mess, 3000, 'warning');
}

// Megamenu width
theme.fixWidthMegamenu = (function() {
    var $megamenuClass = $('.site-nav__item-mega'),
        megaDropdownClass = '.meganav';
    $megamenuClass.each(function() {
        var widthMenu = $(this).data('width') || 0;
        if (widthMenu !== 0) {
            $(this).find(megaDropdownClass).css({ 'width': widthMenu + 'px', 'margin-left': '-' + widthMenu / 2 + 'px' });
        }
    });
})()

// Product video
theme.productVideo = (function() {
    var playButtonClass = '.js-play-button';
    $(document).on('click', playButtonClass, function() {
        let videoSelector = $(this).next(),
            videoObject = videoSelector.get(0);
        $(this).toggleClass('active');
        videoSelector.toggleClass('active');
        videoObject.paused ? videoObject.play() : videoObject.pause();
    })
})()

// Fake-viewers
theme.fakeViewer = (function() {
    var $fakeViewClass = $('.js-fake-view'),
        minValue = $fakeViewClass.data('min'),
        maxValue = $fakeViewClass.data('max'),
        duration = $fakeViewClass.data('duration');

    function randomInRange(start, end) {
        var value = Math.floor(Math.random() * (end - start + 1) + start);
        $fakeViewClass.text(value);
    }

    if (minValue !== undefined && maxValue !== undefined) {
        randomInRange(minValue, maxValue);
        setInterval(function() {
            randomInRange(minValue, maxValue);
        }, duration);
    }

})();

// Product-suggest
theme.productSuggest = (function() {
    var $productSuggestClass = $('.product-notification'),
        $closeButtonClass = $('.close-notifi'),
        duration = $productSuggestClass.data('time') || 0,
        productSuggestCookie = 'cookieSuggest';

    function SomeonePurchased() {
        if ($.cookie(productSuggestCookie) == 'closed') {
            $productSuggestClass.remove();
        }
        $closeButtonClass.on('click', function() {
            $productSuggestClass.remove();
            $.cookie(productSuggestCookie, 'closed', { expires: 1, path: '/' });
        });

        function toggleSomething() {
            if ($productSuggestClass.hasClass('active')) {
                $productSuggestClass.removeClass('active')
            } else {
                var arrayProducts = $('.data-product'),
                    randomProduct = Math.floor(Math.random() * arrayProducts.length),
                    Object = $(arrayProducts[randomProduct]);

                $productSuggestClass.addClass('active');
                $productSuggestClass.find('.product-image').attr('href', Object.data('url')).find('img').attr('src', Object.data('image'));
                $productSuggestClass.find('.product-name').text(Object.data('title')).attr('href', Object.data('url'));
                $productSuggestClass.find('.time-ago').text(Object.data('time'));
                $productSuggestClass.find('.from-ago').text(Object.data('local'));
            }
        }

        if (duration !== 0) {
            setInterval(toggleSomething, duration);
        }
    }
    SomeonePurchased();
})()


// Stickyheader
theme.stickyHeader = (function() {
    var stickHeaderClass = '.site-header--sticky';
    if ($(stickHeaderClass).length !== 0) {
        $(window).scroll(function() {
            if (window.pageYOffset >= 20) {
                $(stickHeaderClass).addClass('active');
            } else {
                $(stickHeaderClass).removeClass('active');
            }
        });
    }
})()

theme.PhotoSwipe = (function() {
    var initPhotoSwipeFromDOM = function(gallerySelector) {

        // parse slide data (url, title, size ...) from DOM elements 
        // (children of gallerySelector)
        var parseThumbnailElements = function(el) {
            var thumbElements = el.childNodes,
                numNodes = thumbElements.length,
                items = [],
                figureEl,
                linkEl,
                size,
                item;

            for (var i = 0; i < numNodes; i++) {

                figureEl = thumbElements[i]; // <figure> element

                // include only element nodes 
                if (figureEl.nodeType !== 1) {
                    continue;
                }

                linkEl = figureEl.children[0]; // <a> element

                size = linkEl.getAttribute('data-size').split('x');

                // create slide object
                item = {
                    src: linkEl.getAttribute('href'),
                    w: parseInt(size[0], 10),
                    h: parseInt(size[1], 10)
                };



                if (figureEl.children.length > 1) {
                    // <figcaption> content
                    item.title = figureEl.children[1].innerHTML;
                }

                if (linkEl.children.length > 0) {
                    // <img> thumbnail element, retrieving thumbnail url
                    item.msrc = linkEl.children[0].getAttribute('src');
                }

                item.el = figureEl; // save link to element for getThumbBoundsFn
                items.push(item);
            }

            return items;
        };

        // find nearest parent element
        var closest = function closest(el, fn) {
            return el && (fn(el) ? el : closest(el.parentNode, fn));
        };

        // triggers when user clicks on thumbnail
        var onThumbnailsClick = function(e) {
            e = e || window.event;
            e.preventDefault ? e.preventDefault() : e.returnValue = false;

            var eTarget = e.target || e.srcElement;

            // find root element of slide
            var clickedListItem = closest(eTarget, function(el) {
                return (el.tagName && el.tagName.toUpperCase() === 'FIGURE');
            });

            if (!clickedListItem) {
                return;
            }

            // find index of clicked item by looping through all child nodes
            // alternatively, you may define index via data- attribute
            var clickedGallery = clickedListItem.parentNode,
                childNodes = clickedListItem.parentNode.childNodes,
                numChildNodes = childNodes.length,
                nodeIndex = 0,
                index;

            for (var i = 0; i < numChildNodes; i++) {
                if (childNodes[i].nodeType !== 1) {
                    continue;
                }

                if (childNodes[i] === clickedListItem) {
                    index = nodeIndex;
                    break;
                }
                nodeIndex++;
            }



            if (index >= 0) {
                // open PhotoSwipe if valid index found
                openPhotoSwipe(index, clickedGallery);
            }
            return false;
        };

        // parse picture index and gallery index from URL (#&pid=1&gid=2)
        var photoswipeParseHash = function() {
            var hash = window.location.hash.substring(1),
                params = {};

            if (hash.length < 5) {
                return params;
            }

            var vars = hash.split('&');
            for (var i = 0; i < vars.length; i++) {
                if (!vars[i]) {
                    continue;
                }
                var pair = vars[i].split('=');
                if (pair.length < 2) {
                    continue;
                }
                params[pair[0]] = pair[1];
            }

            if (params.gid) {
                params.gid = parseInt(params.gid, 10);
            }

            return params;
        };

        var openPhotoSwipe = function(index, galleryElement, disableAnimation, fromURL) {
            var pswpElement = document.querySelectorAll('.pswp')[0],
                gallery,
                options,
                items;

            items = parseThumbnailElements(galleryElement);

            // define options (if needed)
            options = {
                maxSpreadZoom: 1,
                bgOpacity: 0.7,
                zoomEl: true,
                history: false,
                zoomEl: false,
                pinchToClose: false,
                closeOnScroll: false,
                // define gallery index (for URL)
                galleryUID: galleryElement.getAttribute('data-pswp-uid'),

            };

            // PhotoSwipe opened from URL
            if (fromURL) {
                if (options.galleryPIDs) {
                    // parse real index when custom PIDs are used 
                    // http://photoswipe.com/documentation/faq.html#custom-pid-in-url
                    for (var j = 0; j < items.length; j++) {
                        if (items[j].pid == index) {
                            options.index = j;
                            break;
                        }
                    }
                } else {
                    // in URL indexes start from 1
                    options.index = parseInt(index, 10) - 1;
                }
            } else {
                options.index = parseInt(index, 10);
            }

            // exit if index not found
            if (isNaN(options.index)) {
                return;
            }

            if (disableAnimation) {
                options.showAnimationDuration = 0;
            }

            // Pass data to PhotoSwipe and initialize it
            gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, items, options);
            gallery.init();
        };

        // loop through all gallery elements and bind events
        var galleryElements = document.querySelectorAll(gallerySelector);

        for (var i = 0, l = galleryElements.length; i < l; i++) {
            galleryElements[i].setAttribute('data-pswp-uid', i + 1);
            galleryElements[i].onclick = onThumbnailsClick;
        }

        // Parse URL and open gallery if it contains #&pid=3&gid=1
        var hashData = photoswipeParseHash();
        if (hashData.pid && hashData.gid) {
            openPhotoSwipe(hashData.pid, galleryElements[hashData.gid - 1], true, true);
        }
    };

    // execute above function
    initPhotoSwipeFromDOM('.my-gallery');
})()

theme.ZoomImage = (function() {
    $(window).resize(function() {
        var width = $(window).width();
        if (width > 767) {
            ZoomImage();
        }
    });
    $(window).width(function() {
        var width = $(window).width();
        if (width > 767) {
            ZoomImage();
        }
    });

    function ZoomImage() {
        $(".zoom_image").each(function(arg, el) {
            var image = $(el).find("img");
            $(el).zoom({
                on: 'mouseover',
                url: image.attr("src").replace("small", "big")
            });
        });
    }
})()

theme.activeAccordion = (function() {
    $('.collapse').on('shown.bs.collapse', function() {
        $(this).prev().addClass('active-acc');
    });
    $('.collapse').on('hidden.bs.collapse', function() {
        $(this).prev().removeClass('active-acc');
    });
})()


// Anchor scroll
theme.anchorScroll = (function() {
    $(document).on('click', 'a[href^="#"]', function(event) {
        event.preventDefault();
        var disableAnchor = $(this).hasClass('disabled-anchor');
        if (!disableAnchor) {
            $('html, body').animate({
                scrollTop: $($.attr(this, 'href')).offset().top
            }, 500);
        }
    });
})()

// Product-recently-viewed
theme.productRecentlyViewed = (function() {
    var $viewedElement = $('.js-recently-view'),
        $viewButton = $('.js-recently-view-button'),
        $content = $('.js-recently-view-content'),
        productHandle = $viewedElement.data('handle') || '',
        limit = $viewButton.data('limit') || 0,
        arrayProduct = JSON.parse(localStorage.getItem('localRecentlyViewed')) || [],
        lastProduct = arrayProduct[arrayProduct.length - 1] || '',
        isAdded = $.inArray(productHandle, arrayProduct) !== -1 ? true : false;

    function processViewed() {
        if (productHandle !== '') {
            //process last product
            if (lastProduct === productHandle && arrayProduct.length > 1) {
                lastProduct = arrayProduct[arrayProduct.length - 2]
            }

            //move current product to last of array
            if (isAdded) {
                arrayProduct.splice(arrayProduct.indexOf(productHandle), 1);
            }
            arrayProduct.push(productHandle);
            //remove first item if limit
            if (arrayProduct.length > limit) {
                arrayProduct.shift()
            }
            localStorage.setItem('localRecentlyViewed', JSON.stringify(arrayProduct));
        }
    }

    function generatorProduct() {
        $content.html('');
        if (arrayProduct.length > 0) {
            //array
            for (var i = 0; i < arrayProduct.length; i++) {
                var productHandle = arrayProduct[i];
                Shopify.getProduct(productHandle, function(product) {
                    var htmlProduct = '';
                    var productPrice = product.price_varies ? 'from ' + theme.Currency.formatMoney(product.price_min, theme.moneyFormat) : theme.Currency.formatMoney(product.price, theme.moneyFormat);
                    var productComparePrice = product.compare_at_price_min !== 0 ? theme.Currency.formatMoney(product.compare_at_price_min, theme.moneyFormat) : '';
                    htmlProduct += '<div class="col-12 col-lg-4 js-viewed-item mb-4">';
                    htmlProduct += '	<div class="border p-3 rounded media d-flex ">';
                    htmlProduct += '	<a class="mr-3 col-4 p-0" href="' + product.url + '">';
                    htmlProduct += '		<img src="' + product.featured_image + '"/>';
                    htmlProduct += '	</a>';
                    htmlProduct += '	<div class="media-body text-left">';
                    htmlProduct += '		<h4 class="mb-2 mt-2"><a href="' + product.url + '">' + product.title + '</a></h5>';
                    htmlProduct += '	<span> ' + productPrice + '</span>';
                    htmlProduct += '	<s>' + productComparePrice + '</s>';
                    htmlProduct += '	</div>';
                    htmlProduct += '	</div>';
                    htmlProduct += '</div>';
                    $content.append(htmlProduct);
                    theme.updateCurrencies();
                });
            }

            //last product
            Shopify.getProduct(lastProduct, function(product) {
                $viewButton.css('background-image', 'url(' + product.featured_image + ')').addClass('active');
            })
        }
    }

    processViewed();
    generatorProduct();

})()

// Notice when soldout
theme.alert = (function() {
    function createAlert(title, mess, time, type) {
        var aTitle = title || '',
            aTime = time || 2000,
            aMessage = mess || '',
            aClass = type || 'default';
        $.growl({
            title: aTitle,
            message: aMessage,
            duration: aTime,
            style: aClass,
            size: 'large'
        });
    }

    return {
        new: createAlert
    }
})()

// Notice when soldout
theme.noticeSoldout = (function() {
    var $soldoutWrapFormClass = $('.js-contact-soldout'),
        $textClass = $('.js-notify-text'),
        $soldoutValueId = $('#ContactProduct');

    function noticeSoldout(variant) {
        $soldoutWrapFormClass.find('.form-success').remove()
        if (variant.available) {
            $textClass.find('span').text('');
            $soldoutWrapFormClass.addClass('hide');
        } else {
            $textClass.find('span').text(': ' + variant.name);
            $soldoutWrapFormClass.removeClass('hide');
            $soldoutValueId.val(variant.name).attr('value', variant.name);
        }
    }
    return {
        init: noticeSoldout
    }
})()

// Sticky cart
theme.stickyCart = (function() {
    var $anchor = $('#js-anchor-sticky-cart'),
        $stCart = $('.sticky-cart-wr'),
        $close = $('#js-sticky-close'),
        disableStCart = localStorage.getItem('localDisableStCart') || '';
    if (disableStCart !== '') {
        $stCart.addClass('disable');
    }
    $close.on('click', function() {
        var isDisable = disableStCart !== '';
        if (isDisable) {
            localStorage.setItem('localDisableStCart', '');
        } else {
            localStorage.setItem('localDisableStCart', 'true');
        }
        $stCart.toggleClass('disable');
    })
    if ($anchor.length) {
        $(window).on('scroll', function() {
            var hT = $anchor.offset().top,
                hH = $anchor.outerHeight(),
                wH = $(window).height(),
                wS = $(this).scrollTop();
            if (wS > (hT + hH - wH)) {
                $stCart.addClass('active');
            } else {
                $stCart.removeClass('active');
            }
        });
    }

})()

//Fix reload safari
window.addEventListener("pageshow", function(evt) {
    if (evt.persisted) {
        setTimeout(function() {
            window.location.reload();
        }, 10);
    }
}, false);

// Back to top
theme.backToTop = (function() {
    var backtotopClass = $('.js-back-to-top');
    $(window).scroll(function() {
        if ($(this).scrollTop() > 300) {
            backtotopClass.fadeIn('slow');
        } else {
            backtotopClass.fadeOut('slow');
        }
    });
    backtotopClass.on('click', function() {
        $('body,html').animate({ scrollTop: 0 }, 800);
    });
})()


// Tooltip
theme.tooltip = (function() {
    var selector = '[data-toggle="tooltip"],[data-tooltip="true"]';

    function loadTooltip() {
        $(selector).tooltip(); //Bootstrap 4
    };
    $(document).on('click', selector, function() {
        $(this).tooltip('hide');
    });
    loadTooltip();
    return {
        load: loadTooltip
    }
})()

//Collections style 2
theme.Bgcollection = (function() {
    // init Isotope
    function Bgcollection(container) {
        var $container = this.$container = $(container);
        var sectionId = $container.attr('data-section-id');
        var wrapper = this.wrapper = '.bgcollection-wrapper';
        var slider = this.slider = '#Bgcollection-' + sectionId;
        var $slider = $(slider, wrapper);
        $(".colgrid__bg--full[data-index='1']").addClass('active');
        $('.colgrid .colgrid__box').each(function() {
            var index = $(this).attr("data-index");
            $(this).hover(
                function() {
                    $(".colgrid__bg--full[data-index='" + index + "']").addClass('active');
                },
                function() {
                    $(".colgrid__bg--full[data-index='" + index + "']").removeClass('active');
                }
            );
        });
    }

    return Bgcollection;
})();


//Sidebar
theme.sidebar = (function() {
    var togglebutton = '.js-toggle-filter',
        $sidebar = $('.js-sidebar');
    $(document).on('click', togglebutton, function() {
        $sidebar.toggleClass('active');
        $(this).toggleClass('active');
    })
})()

// Ajax filter in collection page
theme.ajaxFilter = (function() {
    var ajaxContent = '#js-product-ajax',
        ajaxSortBy = '#js-sortby',
        ajaxFillter = '#js-fillter',
        ajaxCollectionTitle = '.js-collection-title',
        pageTitle = $(document).find("title").text(),
        jsLoading = '#js-loading';

    var apollo = {
        init: function() {
            this.initFilter();
        },
        showLoading: function() {
            $(jsLoading).show();
        },
        hideLoading: function() {
            $('body,html').animate({
                scrollTop: $('#MainContent').offset().top - 150
            }, 600);
            setTimeout(function() {
                $(jsLoading).hide(); //delay 500ms for better UX
            }, 500);

        },
        initFilter: function() {
            apollo.filterParams();
            apollo.filterSortby();
            apollo.sidebarMapTagEvents();
            apollo.filterMapSorting();
            apollo.filterMapPaging();
        },
        filterParams: function() {
            Shopify.queryParams = {};
            if (location.search.length) {
                for (var aKeyValue, i = 0, aCouples = location.search.substr(1).split('&'); i < aCouples.length; i++) {
                    aKeyValue = aCouples[i].split('=');
                    if (aKeyValue.length > 1) {
                        Shopify.queryParams[decodeURIComponent(aKeyValue[0])] = decodeURIComponent(aKeyValue[1]);
                    }
                }
            }
        },
        filterSortby: function() {
            if (Shopify.queryParams.sort_by) {
                var sortby = Shopify.queryParams.sort_by;
                $(ajaxSortBy).val(sortby);
            }
        },
        filterCreateUrl: function(baseLink) {
            var newQuery = $.param(Shopify.queryParams).replace(/%2B/g, '+');
            if (baseLink) {
                if (newQuery != "") {
                    return baseLink + "?" + newQuery;
                } else {
                    return baseLink;
                }
            }
            return location.pathname + "?" + newQuery;
        },
        filterMapData: function(data) {
            // 1. update product grid
            $(ajaxContent).html($(ajaxContent, data.responseText).html());
            // 2. update left filter
            $(ajaxFillter).html($(ajaxFillter, data.responseText).html());
            // 3. update collection title
            $(ajaxCollectionTitle).html($(ajaxCollectionTitle, data.responseText).html());
        },
        filterAjaxClick: function(baseLink) {
            delete Shopify.queryParams.page;
            var newurl = apollo.filterCreateUrl(baseLink);
            History.pushState({
                param: Shopify.queryParams
            }, pageTitle, newurl);
            apollo.filterGetContent(newurl);
        },
        filterGetContent: function(newurl) {
            $.ajax({
                type: 'GET',
                url: newurl,
                data: {},
                beforeSend: function() {
                    apollo.showLoading();
                },
                complete: function(data) {
                    apollo.filterMapData(data);
                    theme.wishlist.load();
                    theme.compare.load();
                    theme.countdown.load();
                    theme.priceRange.load();
                    theme.tooltip.load();
                    theme.collectionView.triggerView();
                    theme.swatchCard2.load();
                    theme.infiniteScroll.load();
                    apollo.hideLoading();
                },
                error: function(xhr, text) {
                    apollo.hideLoading();
                    alert($.parseJSON(xhr.responseText).description);
                }
            });
        },
        sidebarMapTagEvents: function() {
            $(document).on('click', '.advanced-filter a', function(event) {
                event.preventDefault();
                $('.tooltip').removeClass('show');
                var currentTags = [];
                if (Shopify.queryParams.constraint) {
                    currentTags = Shopify.queryParams.constraint.split('+');
                }
                if (!$(this).parent().hasClass("active-filter")) {
                    var otherTag = $(this).parents('.catalog_filter_ul').find("li.active-filter");
                    if (otherTag.length > 0) {
                        var tagName = otherTag.data("handle");
                        if (tagName) {
                            var tagPos = currentTags.indexOf(tagName);
                            if (tagPos >= 0) {
                                currentTags.splice(tagPos, 1);
                            }
                        }
                    }
                }
                var dataHandle = $(this).parent().data("handle");
                if (dataHandle) {
                    var tagPos = currentTags.indexOf(dataHandle);
                    if (tagPos >= 0) {
                        currentTags.splice(tagPos, 1);
                    } else {
                        currentTags.push(dataHandle);
                    }
                }
                if (currentTags.length) {
                    Shopify.queryParams.constraint = currentTags.join('+');
                } else {
                    delete Shopify.queryParams.constraint;
                }
                apollo.filterAjaxClick();
            });
            $(document).on('click', '.advanced-filter .icon', function() {
                $(this).parent('.advanced-filter').find('a').trigger("click");
            });
        },
        filterMapSorting: function() {
            $(document).on('change', ajaxSortBy, function() {
                Shopify.queryParams.sort_by = $(this).val();
                apollo.filterAjaxClick();
            })
        },
        filterMapPaging: function() {
            $(document).on('click', '.js-pagination a', function() {
                event.preventDefault();
                var linkPage = $(this).attr("href").match(/page=\d+/g);
                if (linkPage) {
                    Shopify.queryParams.page = parseInt(linkPage[0].match(/\d+/g));
                    if (Shopify.queryParams.page) {
                        var newurl = apollo.filterCreateUrl();
                        History.pushState({
                            param: Shopify.queryParams
                        }, pageTitle, newurl);
                        apollo.filterGetContent(newurl);
                    }
                }
            });
        }
    }

    if ($(".template-collection")) {
        History.Adapter.bind(window, 'statechange', function() {
            var State = History.getState();
            apollo.filterParams();
        });
    }
    apollo.init();

})();
$(theme.init);r image = images[i];
            this.loadImage(this.getSizedImageUrl(image, size));
        }
    }

    /**
     * Loads and caches an image in the browsers cache.
     * @param {string} path - An image url
     */
    function loadImage(path) {
        new Image().src = path;
    }

    /**
     * Swaps the src of an image for another OR returns the imageURL to the callback function
     * @param image
     * @param element
     * @param callback
     */
    function switchImage(image, element, callback) {
        var size = this.imageSize(element.src);
        var imageUrl = this.getSizedImageUrl(image.src, size);

        if (callback) {
            callback(imageUrl, image, element); // eslint-disable-line callback-return
        } else {
            element.src = imageUrl;
        }
    }

    /**
     * +++ Useful
     * Find the Shopify image attribute size
     *
     * @param {string} src
     * @returns {null}
     */
    function imageSize(src) {
        src = src || '';

        var match = src.match(
            /.+_((?:pico|icon|thumb|small|compact|medium|large|grande)|\d{1,4}x\d{0,4}|x\d{1,4})[_\\.@]/
        );

        if (match === null) {
            return null;
        } else {
            return match[1];
        }
    }

    /**
     * +++ Useful
     * Adds a Shopify size attribute to a URL
     *
     * @param src
     * @param size
     * @returns {*}
     */
    function getSizedImageUrl(src, size) {
        if (size === null) {
            return src;
        }

        if (size === 'master') {
            return this.removeProtocol(src);
        }

        var match = src.match(
            /\.(jpg|jpeg|gif|png|bmp|bitmap|tiff|tif)(\?v=\d+)?$/i
        );

        if (match !== null) {
            var prefix = src.split(match[0]);
            var suffix = match[0];

            return this.removeProtocol(prefix[0] + '_' + size + suffix);
        }

        return null;
    }

    function removeProtocol(path) {
        return path.replace(/http(s)?:/, '');
    }

    return {
        preload: preload,
        loadImage: loadImage,
        switchImage: switchImage,
        imageSize: imageSize,
        getSizedImageUrl: getSizedImageUrl,
        removeProtocol: removeProtocol
    };
})();

/**
 * Variant Selection scripts
 * ------------------------------------------------------------------------------
 *
 * Handles change events from the variant inputs in any `cart/add` forms that may
 * exist.  Also updates the master select and triggers updates when the variants
 * price or image changes.
 *
 * @namespace variants
 */

slate.Variants = (function() {
    /**
     * Variant constructor
     *
     * @param {object} options - Settings from `product.js`
     */
    function Variants(options) {
        this.$container = options.$container;
        this.product = options.product;
        this.singleOptionSelector = options.singleOptionSelector;
        this.originalSelectorId = options.originalSelectorId;
        this.enableHistoryState = options.enableHistoryState;
        this.currentVariant = this._getVariantFromOptions();

        $(this.singleOptionSelector, this.$container).on(
            'change',
            this._onSelectChange.bind(this)
        );
    }

    Variants.prototype = _.assignIn({}, Variants.prototype, {
        /**
         * Get the currently selected options from add-to-cart form. Works with all
         * form input elements.
         *
         * @return {array} options - Values of currently selected variants
         */
        _getCurrentOptions: function() {
            var currentOptions = _.map(
                $(this.singleOptionSelector, this.$container),
                function(element) {
                    var $element = $(element);
                    var type = $element.attr('type');
                    var currentOption = {};

                    if (type === 'radio' || type === 'checkbox') {
                        if ($element[0].checked) {
                            currentOption.value = $element.val();
                            currentOption.index = $element.data('index');

                            return currentOption;
                        } else {
                            return false;
                        }
                    } else {
                        currentOption.value = $element.val();
                        currentOption.index = $element.data('index');

                        return currentOption;
                    }
                }
            );

            // remove any unchecked input values if using radio buttons or checkboxes
            currentOptions = _.compact(currentOptions);

            return currentOptions;
        },

        /**
         * Find variant based on selected values.
         *
         * @param  {array} selectedValues - Values of variant inputs
         * @return {object || undefined} found - Variant object from product.variants
         */
        _getVariantFromOptions: function() {
            var selectedValues = this._getCurrentOptions();
            var variants = this.product.variants;

            var found = _.find(variants, function(variant) {
                return selectedValues.every(function(values) {
                    return _.isEqual(variant[values.index], values.value);
                });
            });

            return found;
        },

        /**
         * Event handler for when a variant input changes.
         */
        _onSelectChange: function() {
            var variant = this._getVariantFromOptions();

            this.$container.trigger({
                type: 'variantChange',
                variant: variant
            });

            if (!variant) {
                return;
            }

            this._updateMasterSelect(variant);
            this._updateImages(variant);
            this._updatePrice(variant);
            this._updateSKU(variant);
            this.currentVariant = variant;

            if (this.enableHistoryState) {
                this._updateHistoryState(variant);
            }
        },

        /**
         * Trigger event when variant image changes
         *
         * @param  {object} variant - Currently selected variant
         * @return {event}  variantImageChange
         */
        _updateImages: function(variant) {
            var variantImage = variant.featured_image || {};
            var currentVariantImage = this.currentVariant.featured_image || {};

            if (!variant.featured_image ||
                variantImage.src === currentVariantImage.src
            ) {
                return;
            }

            this.$container.trigger({
                type: 'variantImageChange',
                variant: variant
            });
        },

        /**
         * Trigger event when variant price changes.
         *
         * @param  {object} variant - Currently selected variant
         * @return {event} variantPriceChange
         */
        _updatePrice: function(variant) {
            if (
                variant.price === this.currentVariant.price &&
                variant.compare_at_price === this.currentVariant.compare_at_price
            ) {
                return;
            }

            this.$container.trigger({
                type: 'variantPriceChange',
                variant: variant
            });
        },

        /**
         * Trigger event when variant sku changes.
         *
         * @param  {object} variant - Currently selected variant
         * @return {event} variantSKUChange
         */
        _updateSKU: function(variant) {
            if (variant.sku === this.currentVariant.sku) {
                return;
            }

            this.$container.trigger({
                type: 'variantSKUChange',
                variant: variant
            });
        },

        /**
         * Update history state for product deeplinking
         *
         * @param  {variant} variant - Currently selected variant
         * @return {k}         [description]
         */
        _updateHistoryState: function(variant) {
            if (!history.replaceState || !variant) {
                return;
            }

            var newurl =
                window.location.protocol +
                '//' +
                window.location.host +
                window.location.pathname +
                '?variant=' +
                variant.id;
            window.history.replaceState({ path: newurl }, '', newurl);
        },

        /**
         * Update hidden master select of variant change
         *
         * @param  {variant} variant - Currently selected variant
         */
        _updateMasterSelect: function(variant) {
            $(this.originalSelectorId, this.$container).val(variant.id);
        }
    });

    return Variants;
})();


/*================ MODULES ================*/
window.Drawers = (function() {
    var Drawer = function(id, position, options) {
        var defaults = {
            close: '.js-drawer-close',
            open: '.js-drawer-open-' + position,
            openClass: 'js-drawer-open',
            dirOpenClass: 'js-drawer-open-' + position
        };

        this.nodes = {
            $parent: $('body, html'),
            $page: $('.page-element'),
            $moved: $('.is-moved-by-drawer')
        };

        this.config = $.extend(defaults, options);
        this.position = position;

        this.$drawer = $('#' + id);
        this.$open = $(this.config.open);

        if (!this.$drawer.length) {
            return false;
        }

        this.drawerIsOpen = false;
        this.init();
    };

    Drawer.prototype.init = function() {
        this.$open.attr('aria-expanded', 'false');
        this.$open.on('click', $.proxy(this.open, this));
        this.$drawer.find(this.config.close).on('click', $.proxy(this.close, this));
    };

    Drawer.prototype.open = function(evt) {
        // Keep track if drawer was opened from a click, or called by another function
        var externalCall = false;

        // don't open an opened drawer
        if (this.drawerIsOpen) {
            return;
        }

        this.$open.addClass(this.config.openClass);

        // Prevent following href if link is clicked
        if (evt) {
            evt.preventDefault();
        } else {
            externalCall = true;
        }

        // Without this, the drawer opens, the click event bubbles up to $nodes.page
        // which closes the drawer.
        if (evt && evt.stopPropagation) {
            evt.stopPropagation();
            // save the source of the click, we'll focus to this on close
            this.$activeSource = $(evt.currentTarget);
        }

        if (this.drawerIsOpen && !externalCall) {
            return this.close();
        }

        // Add is-transitioning class to moved elements on open so drawer can have
        // transition for close animation
        this.nodes.$moved.addClass('is-transitioning');
        this.$drawer.prepareTransition();

        this.nodes.$parent.addClass(
            this.config.openClass + ' ' + this.config.dirOpenClass
        );
        this.drawerIsOpen = true;

        // Set focus on drawer
        slate.a11y.trapFocus({
            $container: this.$drawer,
            namespace: 'drawer_focus'
        });

        // Run function when draw opens if set
        if (
            this.config.onDrawerOpen &&
            typeof this.config.onDrawerOpen === 'function'
        ) {
            if (!externalCall) {
                this.config.onDrawerOpen();
            }
        }

        if (this.$activeSource && this.$activeSource.attr('aria-expanded')) {
            this.$activeSource.attr('aria-expanded', 'true');
        }

        this.bindEvents();
    };

    Drawer.prototype.close = function() {
        // don't close a closed drawer
        if (!this.drawerIsOpen) {
            return;
        }

        this.$open.removeClass(this.config.openClass);

        // deselect any focused form elements
        $(document.activeElement).trigger('blur');

        // Ensure closing transition is applied to moved elements, like the nav
        this.nodes.$moved.prepareTransition({ disableExisting: true });
        this.$drawer.prepareTransition({ disableExisting: true });

        this.nodes.$parent.removeClass(
            this.config.dirOpenClass + ' ' + this.config.openClass
        );

        this.drawerIsOpen = false;

        // Remove focus on drawer
        slate.a11y.removeTrapFocus({
            $container: this.$drawer,
            namespace: 'drawer_focus'
        });

        if (this.$activeSource && this.$activeSource.attr('aria-expanded')) {
            this.$activeSource.attr('aria-expanded', 'false');
        }

        this.unbindEvents();
    };

    Drawer.prototype.bindEvents = function() {
        // Lock scrolling on mobile
        this.nodes.$page.on('touchmove.drawer', function() {
            return false;
        });

        // Clicking out of drawer closes it
        this.nodes.$page.on(
            'click.drawer',
            $.proxy(function() {
                this.close();
                return false;
            }, this)
        );

        // Pressing escape closes drawer
        this.nodes.$parent.on(
            'keyup.drawer',
            $.proxy(function(evt) {
                if (evt.keyCode === 27) {
                    this.close();
                }
            }, this)
        );
    };

    Drawer.prototype.unbindEvents = function() {
        this.nodes.$page.off('.drawer');
        this.nodes.$parent.off('.drawer');
    };

    return Drawer;
})();

window.Modals = (function() {
    var Modal = function(id, name, options) {
        var defaults = {
            close: '.js-modal-close',
            open: '.js-modal-open-' + name,
            openClass: 'modal--is-active'
        };

        this.$modal = $('#' + id);

        if (!this.$modal.length) {
            return false;
        }

        this.nodes = {
            $body: $('body')
        };

        this.config = $.extend(defaults, options);

        this.modalIsOpen = false;
        this.$focusOnOpen = this.config.focusOnOpen ?
            $(this.config.focusOnOpen) :
            this.$modal;
        this.init();
    };

    Modal.prototype.init = function() {
        var $openBtn = $(this.config.open);

        // Add aria controls
        $openBtn.attr('aria-expanded', 'false');

        $(this.config.open).on('click', $.proxy(this.open, this));
        this.$modal.find(this.config.close).on('click', $.proxy(this.close, this));
    };

    Modal.prototype.open = function(evt) {
        // Keep track if modal was opened from a click, or called by another function
        var externalCall = false;

        // don't open an opened modal
        if (this.modalIsOpen) {
            return;
        }

        // Prevent following href if link is clicked
        if (evt) {
            evt.preventDefault();
        } else {
            externalCall = true;
        }

        // Without this, the modal opens, the click event bubbles up to $nodes.page
        // which closes the modal.
        if (evt && evt.stopPropagation) {
            evt.stopPropagation();
            // save the source of the click, we'll focus to this on close
            this.$activeSource = $(evt.currentTarget);
        }

        if (this.modalIsOpen && !externalCall) {
            return this.close();
        }

        this.$modal.prepareTransition().addClass(this.config.openClass);
        this.nodes.$body.addClass(this.config.openClass);

        this.modalIsOpen = true;

        // Set focus on modal
        slate.a11y.trapFocus({
            $container: this.$modal,
            namespace: 'modal_focus',
            $elementToFocus: this.$focusOnOpen
        });

        if (this.$activeSource && this.$activeSource.attr('aria-expanded')) {
            this.$activeSource.attr('aria-expanded', 'true');
        }

        this.bindEvents();
    };

    Modal.prototype.close = function() {
        // don't close a closed modal
        if (!this.modalIsOpen) {
            return;
        }

        // deselect any focused form elements
        $(document.activeElement).trigger('blur');

        this.$modal.prepareTransition().removeClass(this.config.openClass);
        this.nodes.$body.removeClass(this.config.openClass);

        this.modalIsOpen = false;

        // Remove focus on modal
        slate.a11y.removeTrapFocus({
            $container: this.$modal,
            namespace: 'modal_focus'
        });

        if (this.$activeSource && this.$activeSource.attr('aria-expanded')) {
            this.$activeSource.attr('aria-expanded', 'false').focus();
        }

        this.unbindEvents();
    };

    Modal.prototype.bindEvents = function() {
        // Pressing escape closes modal
        this.nodes.$body.on(
            'keyup.modal',
            $.proxy(function(evt) {
                if (evt.keyCode === 27) {
                    this.close();
                }
            }, this)
        );
    };

    Modal.prototype.unbindEvents = function() {
        this.nodes.$body.off('.modal');
    };

    return Modal;
})();

window.QtySelector = (function() {
    var QtySelector = function($el) {
        this.cache = {
            $body: $('body'),
            $subtotal: $('#CartSubtotal'),
            $discountTotal: $('#cartDiscountTotal'),
            $cartTable: $('.cart-table'),
            $cartTemplate: $('#CartProducts')
        };

        this.settings = {
            loadingClass: 'js-qty--is-loading',
            isCartTemplate: this.cache.$body.hasClass('template-cart'),
            // On the cart template, minimum is 0. Elsewhere min is 1
            minQty: this.cache.$body.hasClass('template-cart') ? 0 : 1
        };

        this.$el = $el;
        this.qtyUpdateTimeout;
        this.createInputs();
        this.bindEvents();
    };

    QtySelector.prototype.createInputs = function() {
        var $el = this.$el;

        var data = {
            value: $el.val(),
            key: $el.attr('id'),
            name: $el.attr('name'),
            line: $el.attr('data-line')
        };
        var source = $('#QuantityTemplate').html();
        var template = Handlebars.compile(source);

        this.$wrapper = $(template(data)).insertBefore($el);

        // Remove original number input
        $el.remove();
    };

    QtySelector.prototype.validateAvailability = function(line, quantity) {
        var product = theme.cartObject.items[line - 1]; // 0-based index in API
        var handle = product.handle; // needed for the ajax request
        var id = product.id; // needed to find right variant from ajax results

        var params = {
            type: 'GET',
            url: '/products/' + handle + '.js',
            dataType: 'json',
            success: $.proxy(function(cartProduct) {
                this.validateAvailabilityCallback(line, quantity, id, cartProduct);
            }, this)
        };

        $.ajax(params);
    };

    QtySelector.prototype.validateAvailabilityCallback = function(
        line,
        quantity,
        id,
        product
    ) {
        var quantityIsAvailable = true;

        // This returns all variants of a product.
        // Loop through them to get our desired one.
        for (var i = 0; i < product.variants.length; i++) {
            var variant = product.variants[i];
            if (variant.id === id) {
                break;
            }
        }

        // If the variant tracks inventory and does not sell when sold out
        // we can compare the requested with available quantity
        if (
            variant.inventory_management !== null &&
            variant.inventory_policy === 'deny'
        ) {
            if (variant.inventory_quantity < quantity) {

                // Set quantity to max amount available
                this.$wrapper.find('.js-qty__input').val(variant.inventory_quantity);

                quantityIsAvailable = false;
                this.$wrapper.removeClass(this.settings.loadingClass);
            }
        }

        if (quantityIsAvailable) {
            this.updateItemQuantity(line, quantity);
        }
    };

    QtySelector.prototype.validateQty = function(qty) {
        if (parseFloat(qty) === parseInt(qty, 10) && !isNaN(qty)) {
            // We have a valid number!
        } else {
            // Not a number. Default to 1.
            qty = 1;
        }
        return parseInt(qty, 10);
    };

    QtySelector.prototype.adjustQty = function(evt) {
        var $el = $(evt.currentTarget);
        var $input = $el.siblings('.js-qty__input');
        var qty = this.validateQty($input.val());
        var line = $input.attr('data-line');

        if ($el.hasClass('js-qty__adjust--minus')) {
            qty -= 1;
            if (qty <= this.settings.minQty) {
                qty = this.settings.minQty;
            }
        } else {
            qty += 1;
        }

        if (this.settings.isCartTemplate) {
            $el.parent().addClass(this.settings.loadingClass);
            this.updateCartItemPrice(line, qty);
        } else {
            $input.val(qty);
        }
    };

    QtySelector.prototype.bindEvents = function() {
        this.$wrapper
            .find('.js-qty__adjust')
            .on('click', $.proxy(this.adjustQty, this));

        // Select input text on click
        this.$wrapper.on('click', '.js-qty__input', function() {
            this.setSelectionRange(0, this.value.length);
        });

        // If the quantity changes on the cart template, update the price
        if (this.settings.isCartTemplate) {
            this.$wrapper.on(
                'change',
                '.js-qty__input',
                $.proxy(function(evt) {
                    var $input = $(evt.currentTarget);
                    var line = $input.attr('data-line');
                    var qty = this.validateQty($input.val());
                    $input.parent().addClass(this.settings.loadingClass);
                    this.updateCartItemPrice(line, qty);
                }, this)
            );
        }
    };

    QtySelector.prototype.updateCartItemPrice = function(line, qty) {
        // Update cart after short timeout so user doesn't create simultaneous ajax calls
        clearTimeout(this.qtyUpdateTimeout);
        this.qtyUpdateTimeout = setTimeout(
            $.proxy(function() {
                this.validateAvailability(line, qty);
            }, this),
            200
        );
    };

    QtySelector.prototype.updateItemQuantity = function(line, quantity) {
        var params = {
            type: 'POST',
            url: '/cart/change.js',
            data: 'quantity=' + quantity + '&line=' + line,
            dataType: 'json',
            success: $.proxy(function(cart) {
                this.updateCartItemCallback(cart);
            }, this)
        };

        $.ajax(params);
    };

    QtySelector.prototype.updateCartItemCallback = function(cart) {
        // Reload the page to show the empty cart if no items
        if (cart.item_count === 0) {
            location.reload();
            return;
        }

        // Update cart object
        theme.cartObject = cart;

        // Handlebars.js cart layout
        var data = {};
        var items = [];
        var item = {};
        var source = $('#CartProductTemplate').html();
        var template = Handlebars.compile(source);
        var prodImg;

        // Add each item to our handlebars.js data
        $.each(cart.items, function(index, cartItem) {
            /* Hack to get product image thumbnail
             *   - If image is not null
             *     - Remove file extension, add 240x240, and re-add extension
             *     - Create server relative link
             *   - A hard-coded url of no-image
             */

            if (cartItem.image === null) {
                prodImg =
                    '//cdn.shopify.com/s/assets/admin/no-image-medium-cc9732cb976dd349a0df1d39816fbcc7.gif';
            } else {
                prodImg = cartItem.image
                    .replace(/(\.[^.]*)$/, '_240x240$1')
                    .replace('http:', '');
            }

            if (cartItem.properties !== null) {
                $.each(cartItem.properties, function(key, value) {
                    if (key.charAt(0) === '_' || !value) {
                        delete cartItem.properties[key];
                    }
                });
            }

            // Create item's data object and add to 'items' array
            item = {
                key: cartItem.key,
                line: index + 1, // Shopify uses a 1+ index in the API
                url: cartItem.url,
                img: prodImg,
                name: cartItem.product_title,
                variation: cartItem.variant_title,
                properties: cartItem.properties,
                itemQty: cartItem.quantity,
                price: theme.Currency.formatMoney(cartItem.price, theme.moneyFormat),
                vendor: cartItem.vendor,
                linePrice: theme.Currency.formatMoney(
                    cartItem.line_price,
                    theme.moneyFormat
                ),
                originalLinePrice: theme.Currency.formatMoney(
                    cartItem.original_line_price,
                    theme.moneyFormat
                ),
                discounts: cartItem.discounts,
                discountsApplied: cartItem.line_price === cartItem.original_line_price ? false : true
            };

            items.push(item);
            theme.updateCurrencies();
        });

        // Gather all cart data and add to DOM
        data = {
            items: items
        };
        this.cache.$cartTemplate.empty().append(template(data));

        // Create new quantity selectors
        this.cache.$cartTable.find('input[type="number"]').each(function(i, el) {
            new QtySelector($(el));
        });

        // Update the cart subtotal
        this.cache.$subtotal.html(
            theme.Currency.formatMoney(cart.total_price, theme.moneyFormat)
        );

        // Update the cart total discounts
        if (cart.total_discount > 0) {
            this.cache.$discountTotal.html(
                theme.strings.totalCartDiscount.replace(
                    '[savings]',
                    theme.Currency.formatMoney(cart.total_discount, theme.moneyFormat)
                )
            );
        } else {
            this.cache.$discountTotal.empty();
        }

        theme.miniCart.updateElements();
        theme.updateCurrencies();
        // Set focus on cart table
        slate.a11y.pageLinkFocus(this.cache.$cartTable);
    };

    return QtySelector;
})();

/*
  Allow product to be added to cart via ajax with
  custom success and error responses.
*/
window.AjaxCart = (function() {
    var styleCart = $('.js-mini-cart').attr("data-cartmini");
    var cart = function($form) {
        this.cache = {
            $cartIconIndicator: $('.site-header__cart-indicator')
        };

        this.$form = $form;
        this.eventListeners();

        this.showNotice = false;
        if (this.$form.length) {
            this.showNotice = this.$form.hasClass('js-form--notice') ? true : false;
        }
    };

    cart.prototype.eventListeners = function() {
        if (this.$form.length) {
            this.$form.on('submit', $.proxy(this.addItemFromForm, this));
        }
    };

    cart.prototype.addItemFromForm = function(evt) {
        evt.preventDefault();

        var params = {
            type: 'POST',
            url: '/cart/add.js',
            data: this.$form.serialize(),
            dataType: 'json',
            success: $.proxy(function(lineItem) {
                //this.success(lineItem);
                window.location.href = '/cart';
            }, this),
            error: $.proxy(function(XMLHttpRequest, textStatus) {
                this.error(XMLHttpRequest, textStatus);
            }, this)
        };
        $.ajax(params);
    };

    cart.prototype.success = function(item) {
        theme.miniCart.updateElements();
        theme.miniCart.generateCart();
        if (styleCart != 'false') {
            if (this.showNotice) {
                var htmlVariant = item.variant_title !== null ? '<i>(' + item.variant_title + ')</i>' : '';
                var htmlAlert = '<div class="media mt-2 alert--cart"><a class="mr-3" href="/cart"><img class="lazyload" data-src="' + item.image + '"></a><div class="media-body align-self-center"><p class="m-0 font-weight-bold">' + item.product_title + ' x ' + item.quantity + '</p>' + htmlVariant + '<div><div>';
                theme.alert.new(theme.strings.addToCartSuccess, htmlAlert, 3000, 'notice');
            } else {
                theme.crosssell.showPopup(item);
            }
        }
    };

    // Error handling reference from Shopify.onError in api.jquery.js
    cart.prototype.error = function(XMLHttpRequest) {
        var data = JSON.parse(XMLHttpRequest.responseText);

        if (data.message) {
            theme.alert.new('', data.description, 3000, 'warning');
        }
    };

    return cart;
})();

/*================ TEMPLATES ================*/
theme.customerTemplates = (function() {
    function initEventListeners() {
        // Show reset password form
        $('#RecoverPassword').on('click', function(evt) {
            evt.preventDefault();
            toggleRecoverPasswordForm();
        });

        // Hide reset password form
        $('#HideRecoverPasswordLink').on('click', function(evt) {
            evt.preventDefault();
            toggleRecoverPasswordForm();
        });
    }

    /**
     *
     *  Show/Hide recover password form
     *
     */
    function toggleRecoverPasswordForm() {
        $('#RecoverPasswordForm').toggleClass('hide');
        $('#CustomerLoginForm').toggleClass('hide');
    }

    /**
     *
     *  Show reset password success message
     *
     */
    function resetPasswordSuccess() {
        // check if reset password form was successfully submited
        if (!$('.reset-password-success').length) {
            return;
        }

        // show success message
        $('#ResetSuccess').removeClass('hide');
    }

    /**
     *
     *  Show/hide customer address forms
     *
     */
    function customerAddressForm() {
        var $newAddressForm = $('#AddressNewForm');

        if (!$newAddressForm.length) {
            return;
        }

        // Initialize observers on address selectors, defined in shopify_common.js
        if (Shopify) {
            // eslint-disable-next-line no-new
            new Shopify.CountryProvinceSelector(
                'AddressCountryNew',
                'AddressProvinceNew', {
                    hideElement: 'AddressProvinceContainerNew'
                }
            );
        }

        // Initialize each edit form's country/province selector
        $('.address-country-option').each(function() {
            var formId = $(this).data('form-id');
            var countrySelector = 'AddressCountry_' + formId;
            var provinceSelector = 'AddressProvince_' + formId;
            var containerSelector = 'AddressProvinceContainer_' + formId;

            // eslint-disable-next-line no-new
            new Shopify.CountryProvinceSelector(countrySelector, provinceSelector, {
                hideElement: containerSelector
            });
        });

        // Toggle new/edit address forms
        $('.address-new-toggle').on('click', function() {
            $newAddressForm.toggleClass('hide');
        });

        $('.address-edit-toggle').on('click', function() {
            var formId = $(this).data('form-id');
            $('#EditAddress_' + formId).toggleClass('hide');
        });

        $('.address-delete').on('click', function() {
            var $el = $(this);
            var formId = $el.data('form-id');
            var confirmMessage = $el.data('confirm-message');

            // eslint-disable-next-line no-alert
            if (
                confirm(
                    confirmMessage || 'Are you sure you wish to delete this address?'
                )
            ) {
                Shopify.postLink('/account/addresses/' + formId, {
                    parameters: { _method: 'delete' }
                });
            }
        });
    }

    /**
     *
     *  Check URL for reset password hash
     *
     */
    function checkUrlHash() {
        var hash = window.location.hash;

        // Allow deep linking to recover password form
        if (hash === '#recover') {
            toggleRecoverPasswordForm();
        }
    }

    return {
        init: function() {
            checkUrlHash();
            initEventListeners();
            resetPasswordSuccess();
            customerAddressForm();
        }
    };
})();

/*================ SECTIONS ================*/
theme.HeaderSection = (function() {
    function Header() {
        theme.NavDrawer = new window.Drawers('NavDrawer', 'left');
    }

    return Header;
})();

theme.Product = (function() {
    var defaults = {
        smallBreakpoint: 750,
        productThumbIndex: 0,
        productThumbMax: 0,
        ajaxCart: false,
        stockSetting: false
    };

    function Product(container) {
        var $container = (this.$container = $(container));
        var sectionId = $container.attr('data-section-id');

        this.selectors = {
            originalSelectorId: '#ProductSelect-' + sectionId,
            modal: 'ProductModal',
            productZoomImage: '#ProductZoomImg',
            addToCart: '#AddToCart-' + sectionId,
            productPrice: '#ProductPrice-' + sectionId,
            comparePrice: '#ComparePrice-' + sectionId,
            addToCartText: '#AddToCartText-' + sectionId,
            SKU: '.js-variant-sku',
            productImageContainers: '.product__photo-container-' + sectionId,
            productImageWrappers: '.product__photo-wrapper-' + sectionId,
            productThumbContainers: '.product-single__thumbnail-item-' + sectionId,
            productThumbsWrapper: '.product-single__thumbnails-' + sectionId,
            productThumbs: '.product-single__thumbnail-' + sectionId,
            saleTag: '#ProductSaleTag-' + sectionId,
            productStock: '#ProductStock-' + sectionId,
            singleOptionSelector: '.single-option-selector-' + sectionId,
            shopifyPaymentButton: '.shopify-payment-button',
            availability: '.product-single__availability',
            hurrify: '.js-hurrify'
        };

        this.settings = $.extend({}, defaults, {
            sectionId: sectionId,
            ajaxCart: $container.data('ajax'),
            stockSetting: $container.data('stock'),
            enableHistoryState: $container.data('enable-history-state') || false,
            namespace: '.product-' + sectionId
        });

        // Stop parsing if we don't have the product json script tag
        if (!$('#ProductJson-' + sectionId).html()) {
            return;
        }

        this.productSingleObject = JSON.parse(
            $('#ProductJson-' + sectionId).html()
        );
        this.addVariantInfo();

        this.init();
    }

    Product.prototype = _.assignIn({}, Product.prototype, {
        init: function() {
            this._stringOverrides();
            this._initVariants();
            this._productZoomImage();
            this._productThumbSwitch();
            this._productThumbnailSlider();
            this._initQtySelector();

            if (this.settings.ajaxCart) {
                theme.AjaxCart = new window.AjaxCart(
                    $('#AddToCartForm-' + this.settings.sectionId)
                );
            }
        },

        _stringOverrides: function() {
            window.productStrings = window.productStrings || {};
            $.extend(theme.strings, window.productStrings);
        },

        addVariantInfo: function() {
            if (!this.productSingleObject || !this.settings.stockSetting) {
                return;
            }

            var variantInfo = JSON.parse(
                $('#VariantJson-' + this.settings.sectionId).html()
            );

            for (var i = 0; i < variantInfo.length; i++) {
                $.extend(this.productSingleObject.variants[i], variantInfo[i]);
            }
        },

        _initVariants: function() {
            var options = {
                $container: this.$container,
                enableHistoryState: this.settings.enableHistoryState,
                product: this.productSingleObject,
                singleOptionSelector: this.selectors.singleOptionSelector,
                originalSelectorId: this.selectors.originalSelectorId
            };

            // eslint-disable-next-line no-new
            this.variants = new slate.Variants(options);

            this.$container.on(
                'variantChange' + this.settings.namespace,
                this._updateAddToCartBtn.bind(this)
            );
            this.$container.on(
                'variantChange' + this.settings.namespace,
                this._updateStickyCart.bind(this)
            );
            this.$container.on(
                'variantPriceChange' + this.settings.namespace,
                this._updatePrice.bind(this)
            );
            this.$container.on(
                'variantSKUChange' + this.settings.namespace,
                this._updateSKU.bind(this)
            );
            this.$container.on(
                'variantImageChange' + this.settings.namespace,
                this._updateImages.bind(this)
            );
        },

        _updateStock: function(variant) {
            if (!this.settings.stockSetting) return;

            var $stock = $(this.selectors.productStock),
                $hurrify = $(this.selectors.hurrify);

            // If we don't track variant inventory, hide stock
            if (!variant || !variant.inventory_management) {
                $stock.addClass('hide');
                $hurrify.addClass('hide');
                return;
            }

            if (variant.inventory_quantity < 10 && variant.inventory_quantity > 0) {
                $stock
                    .html(
                        theme.strings.stockAvailable.replace(
                            '1',
                            variant.inventory_quantity
                        )
                    )
                    .removeClass('hide');
                $hurrify.removeClass('hide').find('.progress-bar').css('width', variant.inventory_quantity * 10 + '%');
                return;
            }

            if (variant.inventory_quantity <= 0 && variant.incoming) {
                $stock
                    .html(
                        theme.strings.willNotShipUntil.replace(
                            '[date]',
                            variant.next_incoming_date
                        )
                    )
                    .removeClass('hide');
                $hurrify.addClass('hide');
                return;
            }

            // If there's more than 10 available, hide stock
            $stock.addClass('hide');
            $hurrify.addClass('hide');
        },

        _updateIncomingInfo: function(variant) {
            if (!this.settings.stockSetting) return;

            var $stock = $(this.selectors.productStock);

            if (variant.incoming) {
                $stock
                    .html(
                        theme.strings.willBeInStockAfter.replace(
                            '[date]',
                            variant.next_incoming_date
                        )
                    )
                    .removeClass('hide');
                return;
            }

            // If there is no stock incoming, hide stock
            $stock.addClass('hide');
        },

        _updateAddToCartBtn: function(evt) {
            var variant = evt.variant;

            var cache = {
                $addToCart: $(this.selectors.addToCart),
                $addToCartText: $(this.selectors.addToCartText)
            };

            if (variant) {
                // Select a valid variant if available
                theme.noticeSoldout.init(variant);
                if (variant.available) {
                    // We have a valid product variant, so enable the submit button
                    cache.$addToCart.removeClass('btn--sold-out').prop('disabled', false);
                    cache.$addToCartText.html(theme.strings.addToCart);
                    $(this.selectors.shopifyPaymentButton, this.$container).show();
                    // Show how many items are left, if below 10
                    this._updateStock(variant);
                    //update availability - available
                    $(this.selectors.availability).find('span').text(theme.strings.available);
                } else {
                    // Variant is sold out, disable the submit button
                    cache.$addToCart.prop('disabled', true).addClass('btn--sold-out');
                    cache.$addToCartText.html(theme.strings.soldOut);
                    $(this.selectors.shopifyPaymentButton, this.$container).hide();
                    // Update when stock will be available
                    this._updateIncomingInfo(variant);
                    //update availability - soldout
                    $(this.selectors.availability).find('span').text(theme.strings.soldOut);
                }
            } else {
                cache.$addToCart.prop('disabled', true).removeClass('btn--sold-out');
                cache.$addToCartText.html(theme.strings.unavailable);
                //update availability - unavailable
                $(this.selectors.availability).find('span').text(theme.strings.unavailable);
                $(this.selectors.shopifyPaymentButton, this.$container).hide();
                // Hide stock display
                this._updateStock();
            }
        },

        _updatePrice: function(evt) {
            var variant = evt.variant;

            if (variant) {
                $(this.selectors.productPrice).html(
                    theme.Currency.formatMoney(variant.price, theme.moneyFormat)
                );

                // Update and show the product's compare price if necessary
                if (variant.compare_at_price > variant.price) {
                    $(this.selectors.comparePrice)
                        .html(
                            theme.Currency.formatMoney(
                                variant.compare_at_price,
                                theme.moneyFormat
                            )
                        )
                        .removeClass('hide');
                    $(this.selectors.saleTag).removeClass('hide');
                } else {
                    $(this.selectors.comparePrice).addClass('hide');
                    $(this.selectors.saleTag).addClass('hide');
                }

                theme.updateCurrencies();
            } else {
                $(this.selectors.comparePrice).addClass('hide');
            }
        },

        _updateSKU: function(evt) {
            var variant = evt.variant;

            if (variant) {
                $(this.selectors.SKU).html(variant.sku);
            }
        },

        _updateImages: function(evt) {
            var variant = evt.variant;

            if (variant && variant.featured_image) {
                var imageId = variant.featured_image.id;
                this.switchProductImage(imageId);
                this.setActiveThumbnail(imageId);
            }
        },
        _updateStickyCart: function(evt) {
            var variant = evt.variant,
                $stickyPrice = $('#js-sticky-price'),
                $stickyTitle = $('#js-sticky-title'),
                $stickyImage = $('#js-sticky-img'),
                $stickyButton = $('#js-sticky-btn');
            if (variant) {
                //update title
                $stickyTitle.html(' - ' + variant.title);
                //update price
                $stickyPrice.html(theme.Currency.formatMoney(variant.price, theme.moneyFormat));
                //update selectbox
                for (var i = 1; i <= 3; i++) {
                    var option = 'option' + i,
                        $selecBox = '#js-sticky-option-' + i;
                    if (variant[option] !== null) {
                        var valueOption = variant[option];
                        $($selecBox).val(valueOption);
                    }
                }
                //update button cart
                if (variant.available) {
                    $stickyButton.prop('disabled', false).removeClass('btn--sold-out');
                    $stickyButton.html(theme.strings.addToCart);
                } else {
                    $stickyButton.prop('disabled', true).addClass('btn--sold-out');
                    $stickyButton.html(theme.strings.soldOut);
                }
                //update image
                if (variant.featured_image) {
                    $stickyImage.attr('src', theme.Images.getSizedImageUrl(variant.featured_image.src, '200x'));
                }
            } else {
                //update title
                $stickyTitle.html(' - ' + theme.strings.unavailable);
                //update button cart
                $stickyButton.prop('disabled', true).removeClass('btn--sold-out');
                $stickyButton.html(theme.strings.unavailable);
            }
        },

        switchProductImage: function(imageId) {
            var $imageToShow = $(
                this.selectors.productImageContainers +
                "[data-image-id='" +
                imageId +
                "']",
                this.$container
            );
            var $imagesToHide = $(
                this.selectors.productImageContainers +
                ":not([data-image-id='" +
                imageId +
                "'])",
                this.$container
            );
            $imagesToHide.addClass('hide');
            $imageToShow.removeClass('hide');
            //Scroll to active
            topMenuHeight = $('.site-header').outerHeight();
            if (this.settings.sectionId === 'product-template-8') {
                $([document.documentElement, document.body]).animate({
                    scrollTop: $imageToShow.offset().top - topMenuHeight
                }, 500);
            }
        },

        setActiveThumbnail: function(imageId) {
            var $thumbnailToShow = $(
                this.selectors.productThumbContainers +
                "[data-image-id='" +
                imageId +
                "']",
                this.$container
            );
            var $thumbnailsToHide = $(
                this.selectors.productThumbContainers +
                ":not([data-image-id='" +
                imageId +
                "'])",
                this.$container
            );
            $thumbnailsToHide.removeClass('is-active');
            $thumbnailToShow.addClass('is-active');
            $thumbnailToShow.trigger('click');
            var $thumbnails = $(this.selectors.productThumbsWrapper, this.$container);

            // If there is a slick carousel, get the slide index, and position it into view with animation.
            if ($thumbnails.hasClass('slick-initialized')) {
                // eslint-disable-next-line shopify/jquery-dollar-sign-reference
                var currentActiveSlideIndex = $thumbnails.slick('slickCurrentSlide');
                var newActiveSlideIndex = parseInt(
                    $thumbnailToShow.attr('data-slick-index')
                );
                if (currentActiveSlideIndex !== newActiveSlideIndex) {
                    $thumbnails.slick('slickGoTo', newActiveSlideIndex, false);

                }
            }
        },

        _productZoomImage: function() {
            // The zoom image is only used on the product template, so return early
            // even if a featured product section is present.
            if (!$('.product-single ' + this.selectors.productImageContainers).length) {
                return;
            }

            var self = this;

            $(this.selectors.productImageWrappers).on(
                'click' + this.settings.namespace,
                function(evt) {
                    evt.preventDefault();
                    // Empty src before loadig new image to avoid awkward image swap
                    $(self.selectors.productZoomImage)
                        .attr('src', '')
                        .attr('src', $(this).attr('href'));
                }
            );

            this.ProductModal = new window.Modals(
                this.selectors.modal,
                'product-modal'
            );

            // Close modal if clicked, but not if the image is clicked
            this.ProductModal.$modal.on('click' + this.settings.namespace, function(
                evt
            ) {
                if (evt.target.nodeName !== 'IMG') {
                    self.ProductModal.close();
                }
            });
        },

        _productThumbSwitch: function() {
            if (!$(this.selectors.productThumbs).length) {
                return;
            }

            var self = this;

            $(this.selectors.productThumbs).on(
                'click' + this.settings.namespace,
                function(evt) {
                    evt.preventDefault();
                    var imageId = $(this)
                        .parent()
                        .data('image-id');
                    self.setActiveThumbnail(imageId);
                    self.switchProductImage(imageId);
                }
            );
            //trigger hover thumb
            // $(this.selectors.productThumbs).on('click',function(){
            //   $(this).trigger('click');
            // });
        },

        /*
          Thumbnail slider
         */
        _productThumbnailSlider: function() {
            var $productThumbsWrapper = $(this.selectors.productThumbsWrapper);
            var $productThumbs = $(this.selectors.productThumbs);
            if (!$productThumbs.length) {
                return;
            }

            if ($productThumbs.length > 1) {
                $productThumbsWrapper.on(
                    'init' + this.settings.namespace,
                    this._productSwipeInit.bind(this)
                );

                if (this.settings.sectionId === 'product-template-3' || this.settings.sectionId === 'product-template-4') {
                    $productThumbsWrapper.slick({
                        accessibility: false,
                        arrows: true,
                        dots: false,
                        infinite: false,
                        autoplay: false,
                        slidesToShow: 5,
                        slidesToScroll: 5,
                        vertical: true,
                        verticalSwiping: true,
                        responsive: [{
                            breakpoint: 992,
                            settings: {
                                vertical: false,
                                verticalSwiping: false,
                                slidesToShow: 4,
                                slidesToScroll: 4,
                                dots: false,
                            }
                        }]
                    }).css('opacity', '1');
                } else if (this.settings.sectionId === 'product-template-5') {
                    $productThumbsWrapper.slick({
                        accessibility: false,
                        arrows: true,
                        dots: false,
                        infinite: true,
                        autoplay: false,
                        slidesToShow: 2,
                        slidesToScroll: 1,
                        responsive: [{
                            breakpoint: 992,
                            settings: {
                                slidesToShow: 4,
                                slidesToScroll: 4,
                                dots: false,
                            }
                        }]
                    }).css('opacity', '1');
                } else if (this.settings.sectionId === 'product-template-7') {
                    $productThumbsWrapper.slick({
                        accessibility: false,
                        arrows: true,
                        dots: true,
                        infinite: true,
                        autoplay: false,
                        slidesToShow: 1,
                        slidesToScroll: 1,
                        responsive: [{
                            breakpoint: 992,
                            settings: {
                                slidesToShow: 1,
                                slidesToScroll: 1,
                                dots: false,
                                arrows: true,
                            }
                        }]
                    }).css('opacity', '1');
                } else if (this.settings.sectionId === 'product-template-8') {
                    var lastId,
                        topMenu = $(".product-single__thumbnails"),
                        topMenuHeight = $('.site-header').outerHeight() + 20,
                        // All list items
                        menuItems = topMenu.find(".product-single__thumbnail");


                    if ($(window).width() > 767) {
                        menuItems.click(function(e) {
                            var findid = $(this).attr('href');
                            offsetTop = $(findid).offset().top - topMenuHeight + 1;
                            $('html, body').stop().animate({
                                scrollTop: offsetTop
                            }, 200);
                            return false;
                        });
                        // Anchors corresponding to menu items
                        scrollItems = menuItems.map(function() {
                            var item = $($(this).attr('href'));
                            if (item.length) { return item; }
                        });

                        $(window).scroll(function() {
                            // Get container scroll position
                            var fromTop = $(this).scrollTop() + topMenuHeight;
                            // Get id of current scroll item
                            var cur = scrollItems.map(function() {
                                if ($(this).offset().top < fromTop)
                                    return this;
                            });
                            // Get the id of the current element
                            cur = cur[cur.length - 1];
                            var id = cur && cur.length ? cur[0].id : "";

                            if (lastId !== id) {
                                lastId = id;
                                // Set/remove active class
                                menuItems
                                    .parent().removeClass("is-active")
                                    .end().filter("[href='#" + id + "']").parent().addClass("is-active");
                            }
                        });
                    } else {
                        menuItems.click(function(e) {
                            var findid = $(this).attr('href');
                            offsetTop = $(findid).offset().top;
                            $('html, body').stop().animate({
                                scrollTop: offsetTop
                            });
                            return false;
                        });
                    }

                    $productThumbsWrapper.slick({
                        accessibility: false,
                        arrows: true,
                        dots: false,
                        infinite: false,
                        autoplay: false,
                        slidesToShow: 5,
                        slidesToScroll: 1,
                        vertical: true,
                        verticalSwiping: true,
                        responsive: [{
                            breakpoint: 992,
                            settings: {
                                vertical: false,
                                verticalSwiping: false,
                                slidesToShow: 4,
                                slidesToScroll: 4,
                                dots: true,
                            }
                        }]
                    }).css('opacity', '1');
                } else {
                    $productThumbsWrapper.slick({
                        accessibility: false,
                        arrows: true,
                        dots: false,
                        infinite: false,
                        autoplay: false,
                        slidesToShow: 4,
                        slidesToScroll: 4
                    }).css('opacity', '1');
                }

                // Show highlighted thumbnail by repositioning slider
                $productThumbsWrapper.slick(
                    'slickGoTo',
                    $productThumbsWrapper.find('.is-active').attr('data-slick-index'),
                    true
                );
            }
        },

        _productSwipeInit: function(evt, obj) {
            // Slider is initialized. Setup custom swipe events
            this.settings.productThumbIndex = obj.currentSlide;
            this.settings.productThumbMax = obj.slideCount - 1; // we need the 0-based index

            var self = this;

            $(this.selectors.productImageWrappers).on(
                'swipeleft swiperight',
                function(event) {
                    if (event.type === 'swipeleft') {
                        self._goToNextThumbnail();
                    }

                    if (event.type === 'swiperight') {
                        self._goToPrevThumbnail();
                    }

                    // Trigger click on newly requested thumbnail
                    $(
                            '.product-single__thumbnail-item[data-slick-index="' +
                            self.settings.productThumbIndex +
                            '"]'
                        )
                        .find('.product-single__thumbnail')
                        .trigger('click');

                }
            );
        },
        _goToNextThumbnail: function() {
            this.settings.productThumbIndex++;

            if (this.settings.productThumbIndex > this.settings.productThumbMax) {
                this.settings.productThumbIndex = 0;
            }

            $(this.selectors.productThumbsWrapper).slick(
                'slickGoTo',
                this.settings.productThumbIndex,
                true
            );
        },

        _goToPrevThumbnail: function() {
            this.settings.productThumbIndex--;

            if (this.settings.productThumbIndex < 0) {
                this.settings.productThumbIndex = this.settings.productThumbMax;
            }

            $(this.selectors.productThumbsWrapper).slick(
                'slickGoTo',
                this.settings.productThumbIndex,
                true
            );
        },

        _initQtySelector: function() {
            this.$container.find('.product-form__quantity').each(function(i, el) {
                // eslint-disable-next-line no-new
                new QtySelector($(el));
            });
        },

        onUnload: function() {
            $(this.selectors.productImageWrappers).off(this.settings.namespace);
            $(this.selectors.productThumbs).off(this.settings.namespace);
            $(this.selectors.productThumbs).slick('unslick');
            if (this.ProductModal) {
                this.ProductModal.$modal.off(this.settings.namespace);
            }
        }
    });

    return Product;
})();

theme.Slideshow = (function() {
    this.$slideshow = null;
    var classes = {
        slideshow: 'slideshow',
        slickActiveMobile: 'slick-active-mobile',
        controlsHover: 'slideshow__controls--hover',
        isPaused: 'is-paused'
    };

    var selectors = {
        section: '.shopify-section',
        wrapper: '#SlideshowWrapper-',
        slides: '.slideshow__slide',
        textWrapperMobile: '.slideshow__text-wrap--mobile',
        textContentMobile: '.slideshow__text-content--mobile',
        controls: '.slideshow__controls',
        dots: '.slick-dots',
        arrowLeft: '.slideshow__arrow-left',
        arrowRight: '.slideshow__arrow-right'
    };

    function slideshow(el, sectionId) {
        var $slideshow = (this.$slideshow = $(el));
        this.adaptHeight = this.$slideshow.data('adapt-height');
        this.$wrapper = this.$slideshow.closest(selectors.wrapper + sectionId);
        this.$section = this.$wrapper.closest(selectors.section);
        this.$controls = this.$wrapper.find(selectors.controls);
        this.$textWrapperMobile = this.$section.find(selectors.textWrapperMobile);
        this.autorotate = this.$slideshow.data('autorotate');
        var autoplaySpeed = this.$slideshow.data('speed');
        var loadSlideA11yString = this.$slideshow.data('slide-nav-a11y');

        this.settings = {
            rtl: theme.rtl,
            accessibility: true,
            arrows: true,
            dots: true,
            fade: (theme.rtl ? false : true),
            draggable: true,
            touchThreshold: 20,
            autoplay: this.autorotate,
            autoplaySpeed: autoplaySpeed
        };

        this.$slideshow.on('beforeChange', beforeChange.bind(this));
        this.$slideshow.on('init', slideshowA11ySetup.bind(this));

        // Add class to style mobile dots & show the correct text content for the
        // first slide on mobile when the slideshow initialises
        this.$slideshow.on(
            'init',
            function() {
                this.$mobileDots
                    .find('li:first-of-type')
                    .addClass(classes.slickActiveMobile);
                this.showMobileText(0);
            }.bind(this)
        );

        if (this.adaptHeight) {
            this.setSlideshowHeight();
            $(window).resize($.debounce(50, this.setSlideshowHeight.bind(this)));
        }

        this.$slideshow.slick(this.settings);

        // This can't be called when the slick 'init' event fires due to how slick
        // adds a11y features.
        slideshowPostInitA11ySetup.bind(this)();
    }

    function slideshowA11ySetup(event, obj) {
        var $slider = obj.$slider;
        var $list = obj.$list;
        this.$dots = this.$section.find(selectors.dots);
        this.$mobileDots = this.$dots.eq(1);

        // Remove default Slick aria-live attr until slider is focused
        $list.removeAttr('aria-live');

        //     this.$wrapper.on('keyup', keyboardNavigation.bind(this));
        //     this.$controls.on('keyup', keyboardNavigation.bind(this));
        //     this.$textWrapperMobile.on('keyup', keyboardNavigation.bind(this));

        // When an element in the slider is focused
        // pause slideshow and set aria-live.
        this.$wrapper
            .on(
                'focusin',
                function(evt) {
                    if (!this.$wrapper.has(evt.target).length) {
                        return;
                    }

                    $list.attr('aria-live', 'polite');
                    if (this.autorotate) {
                        $slider.slick('slickPause');
                    }
                }.bind(this)
            )
            .on(
                'focusout',
                function(evt) {
                    if (!this.$wrapper.has(evt.target).length) {
                        return;
                    }

                    $list.removeAttr('aria-live');
                }.bind(this)
            );

        // Add arrow key support when focused
        if (this.$dots) {
            this.$dots
                .find('a')
                .each(function() {
                    var $dot = $(this);
                    $dot.on('click keyup', function(evt) {
                        if (
                            evt.type === 'keyup' &&
                            evt.which !== slate.utils.keyboardKeys.ENTER
                        )
                            return;

                        evt.preventDefault();

                        var slideNumber = $(evt.target).data('slide-number');

                        $slider.attr('tabindex', -1).slick('slickGoTo', slideNumber);

                        if (evt.type === 'keyup') {
                            $slider.focus();
                        }
                    });
                })
                .eq(0)
                .attr('aria-current', 'true');
        }

        this.$controls
            .on('focusin', highlightControls.bind(this))
            .on('focusout', unhighlightControls.bind(this));
    }

    function slideshowPostInitA11ySetup() {
        var $slides = this.$slideshow.find(selectors.slides);

        $slides.removeAttr('role').removeAttr('aria-labelledby');
        this.$dots
            .removeAttr('role')
            .find('li')
            .removeAttr('role')
            .removeAttr('aria-selected')
            .each(function() {
                var $dot = $(this);
                var ariaControls = $dot.attr('aria-controls');
                $dot
                    .removeAttr('aria-controls')
                    .find('a')
                    .attr('aria-controls', ariaControls);
            });
    }

    function beforeChange(event, slick, currentSlide, nextSlide) {
        var $dotLinks = this.$dots.find('a');
        var $mobileDotLinks = this.$mobileDots.find('li');

        $dotLinks
            .removeAttr('aria-current')
            .eq(nextSlide)
            .attr('aria-current', 'true');

        $mobileDotLinks
            .removeClass(classes.slickActiveMobile)
            .eq(nextSlide)
            .addClass(classes.slickActiveMobile);
        this.showMobileText(nextSlide);
    }

    //   function keyboardNavigation() {
    //     if (event.keyCode === slate.utils.keyboardKeys.LEFTARROW) {
    //       this.$slideshow.slick('slickPrev');
    //     }
    //     if (event.keyCode === slate.utils.keyboardKeys.RIGHTARROW) {
    //       this.$slideshow.slick('slickNext');
    //     }
    //   }

    function highlightControls() {
        this.$controls.addClass(classes.controlsHover);
    }

    function unhighlightControls() {
        this.$controls.removeClass(classes.controlsHover);
    }

    slideshow.prototype.setSlideshowHeight = function() {
        var minAspectRatio = this.$slideshow.data('min-aspect-ratio');
        this.$slideshow.height($(document).width() / minAspectRatio);
    };

    slideshow.prototype.showMobileText = function(slideIndex) {
        var $allTextContent = this.$textWrapperMobile.find(
            selectors.textContentMobile
        );
        var currentTextContentSelector =
            selectors.textContentMobile + '-' + slideIndex;
        var $currentTextContent = this.$textWrapperMobile.find(
            currentTextContentSelector
        );
        if (!$currentTextContent.length &&
            this.$slideshow.find(selectors.slides).length === 1
        ) {
            this.$textWrapperMobile.hide();
        } else {
            this.$textWrapperMobile.show();
        }
        $allTextContent.hide();
        $currentTextContent.show();
    };

    function getSlideshowId($el) {
        return '#Slideshow-' + $el.data('id');
    }

    return slideshow;
})();

theme.slideshows = {};

theme.SlideshowSection = (function() {
    function SlideshowSection(container) {
        var $container = (this.$container = $(container));
        var sectionId = $container.attr('data-section-id');
        var slideshow = (this.slideshow = '#Slideshow-' + sectionId);

        theme.slideshows[slideshow] = new theme.Slideshow(slideshow, sectionId);
    }

    return SlideshowSection;
})();

theme.SlideshowSection.prototype = _.assignIn({},
    theme.SlideshowSection.prototype, {
        onUnload: function() {
            delete theme.slideshows[this.slideshow];
        },

        onBlockSelect: function(evt) {
            var $slideshow = $(this.slideshow);
            var adaptHeight = $slideshow.data('adapt-height');

            if (adaptHeight) {
                theme.slideshows[this.slideshow].setSlideshowHeight();
            }

            // Ignore the cloned version
            var $slide = $(
                '.slideshow__slide--' + evt.detail.blockId + ':not(.slick-cloned)'
            );
            var slideIndex = $slide.data('slick-index');

            // Go to selected slide, pause auto-rotate
            $slideshow.slick('slickGoTo', slideIndex).slick('slickPause');
        },

        onBlockDeselect: function() {
            // Resume auto-rotate
            $(this.slideshow).slick('slickPlay');
        }
    }
);

theme.slideshows = {};

theme.Cart = (function() {
    var selectors = {
        cartNote: '#CartSpecialInstructions',
        cartQtyInput: '.cart__quantity',
        cartNoCookiesClass: 'cart--no-cookies'
    };

    function Cart(container) {
        var $container = (this.$container = $(container));
        var sectionId = $container.attr('data-section-id');

        theme.cartObject = JSON.parse($('#CartJson-' + sectionId).html());

        this.init($container);
    }

    Cart.prototype = _.assignIn({}, Cart.prototype, {
        init: function($container) {
            this._initQtySelector();
            this._initCartNote();

            if (!this._cookiesEnabled()) {
                $container.addClass(selectors.cartNoCookiesClass);
            }
        },

        _initQtySelector: function() {
            $(selectors.cartQtyInput).each(function(i, el) {
                // eslint-disable-next-line no-new
                new QtySelector($(el));
            });
        },

        _initCartNote: function() {
            if (!$(selectors.cartNote).length) {
                return;
            }

            var $el = $(selectors.cartNote);
            var noteText;
            var params;
            var noteOffset = $el[0].offsetHeight - $el[0].clientHeight;

            // Auto grow the cart note if text fills it up
            $el.on('keyup input', function() {
                $(this)
                    .css('height', 'auto')
                    .css('height', $el[0].scrollHeight + noteOffset);
            });

            // Save the cart note via ajax. A safeguard in case
            // a user decides to leave the page before clicking 'Update Cart'
            $el.on(
                'change',
                $.proxy(function() {
                    noteText = $el.val();
                    params = {
                        type: 'POST',
                        url: '/cart/update.js',
                        data: 'note=' + this._attributeToString(noteText),
                        dataType: 'json'
                    };
                    $.ajax(params);
                }, this)
            );
        },

        _attributeToString: function(attr) {
            if (typeof attr !== 'string') {
                attr = String(attr);
                if (attr === 'undefined') {
                    attr = '';
                }
            }
            return $.trim(attr);
        },

        _cookiesEnabled: function() {
            var cookieEnabled = navigator.cookieEnabled;

            if (!cookieEnabled) {
                document.cookie = 'testcookie';
                cookieEnabled = document.cookie.indexOf('testcookie') !== -1;
            }
            return cookieEnabled;
        }
    });

    return Cart;
})();

// Instagrams
theme.Instagrams = (function() {
    function Instagrams(container) {
        this.$container = $(container).on('init', this._a11y.bind(this));
        //console.log(this.$container);
        this.settings = {
            style: this.$container.data('style'),
            accesstoken: this.$container.data('accesstoken'),
            userid: this.$container.data('userid'),
            limit: this.$container.data('limit'),
            resolution: this.$container.data('resolution'),
            target: this.$container.attr('id'),
            rows: this.$container.data('rows'),

            slidesToShow: this.$container.data('slidestoshow') || 1,
            infinite: this.$container.data('infinite') || false,
            arrows: this.$container.data('arrows') || false,
            draggable: this.$container.data('draggable') || false,
            dots: this.$container.data('dots') || false,
        }
        this.settings.slidesToShow1200 = (this.settings.slidesToShow - 1) > 1 ? (this.settings.slidesToShow - 1) : 1;
        this.settings.slidesToShow992 = (this.settings.slidesToShow - 2) > 1 ? (this.settings.slidesToShow - 2) : 1;
        this.settings.slidesToShow768 = (this.settings.slidesToShow - 3) > 1 ? (this.settings.slidesToShow - 3) : 1;
        this.settings.slidesToShow480 = 2;

        var _self = this;
        var $instagramSelector = $('#' + this.settings.target);
        if (this.settings.style === 'grid') {
            var afterInstagram = function() {} // blank function
        } else if (this.settings.style === 'carousel') {
            var afterInstagram = function() {
                $instagramSelector.slick({
                    slidesToShow: _self.settings.slidesToShow,
                    slidesToScroll: _self.settings.slidesToShow,
                    arrows: _self.settings.arrows,
                    dots: _self.settings.dots,
                    draggable: _self.settings.draggable,
                    infinite: _self.settings.infinite,
                    rows: _self.settings.rows,
                    responsive: [{
                            breakpoint: 1200,
                            settings: {
                                slidesToShow: _self.settings.slidesToShow1200,
                                slidesToScroll: _self.settings.slidesToShow1200,
                            }
                        },
                        {
                            breakpoint: 992,
                            settings: {
                                slidesToShow: _self.settings.slidesToShow992,
                                slidesToScroll: _self.settings.slidesToShow992,
                            }
                        },
                        {
                            breakpoint: 768,
                            settings: {
                                slidesToShow: _self.settings.slidesToShow768,
                                slidesToScroll: _self.settings.slidesToShow768,
                            }
                        },
                        {
                            breakpoint: 480,
                            settings: {
                                slidesToShow: _self.settings.slidesToShow480,
                                slidesToScroll: _self.settings.slidesToShow480,
                            }
                        }
                    ]
                })
            }
        }

        var feed = new Instafeed({
            get: 'user',
            target: this.settings.target,
            userId: this.settings.userid,
            accessToken: this.settings.accesstoken,
            limit: this.settings.limit,
            resolution: this.settings.resolution,
            template: '<div class="col hv-image-brightness"><a class="instagram-item" href="{{link}}" target="_blank" id="{{id}}"><img alt="instagram image" class="transition lazyload" data-src="{{image}}" /></a></div>',
            after: afterInstagram
        });

        feed.run();
    }

    Instagrams.prototype = _.assignIn({}, Instagrams.prototype, {
        _a11y: function(event, obj) {
            var $list = obj.$list;
            var $wrapper = this.$container.parent();

            // Remove default Slick aria-live attr until slider is focused
            $list.removeAttr('aria-live');

            // When an element in the slider is focused set aria-live
            $wrapper.on('focusin', function(evt) {
                if ($wrapper.has(evt.target).length) {
                    $list.attr('aria-live', 'polite');
                }
            });

            // Remove aria-live
            $wrapper.on('focusout', function(evt) {
                if ($wrapper.has(evt.target).length) {
                    $list.removeAttr('aria-live');
                }
            });
        }
    });

    return Instagrams;
})();

// Slick carousel
theme.slickCarousel = (function() {
    function Carousels(container) {
        this.$container = $(container).on('init', this._a11y.bind(this));
        this.settings = {
            rows: this.$container.data('rows') || 1,
            slidesToShow: this.$container.data('slidestoshow') || 1,
            slidesToScroll: this.$container.data('slidestoscroll') || 1,
            infinite: this.$container.data('infinite') || false,
            arrows: this.$container.data('arrows') || false,
            dots: this.$container.data('dots') || false,
            autoplay: this.$container.data('autoplay') || false,
            draggable: this.$container.data('draggable') || false,
            accessibility: this.$container.data('accessibility') || true,
        }
        this.settings.slidesToShow1200 = (this.settings.slidesToShow - 1) > 1 ? (this.settings.slidesToShow - 1) : 1;
        this.settings.slidesToShow992 = (this.settings.slidesToShow - 2) > 1 ? (this.settings.slidesToShow - 2) : 1;
        this.settings.slidesToShow768 = (this.settings.slidesToShow - 3) > 1 ? (this.settings.slidesToShow - 3) : 1;
        this.settings.slidesToShow480 = (this.settings.slidesToShow - 4) > 1 ? (this.settings.slidesToShow - 4) : 1;
        this.settings.slidesToScroll1200 = (this.settings.slidesToScroll - 1) > 1 ? (this.settings.slidesToScroll - 1) : 1;
        this.settings.slidesToScroll992 = (this.settings.slidesToScroll - 2) > 1 ? (this.settings.slidesToScroll - 2) : 1;
        this.settings.slidesToScroll768 = (this.settings.slidesToScroll - 3) > 1 ? (this.settings.slidesToScroll - 3) : 1;
        this.settings.slidesToScroll480 = (this.settings.slidesToScroll - 4) > 1 ? (this.settings.slidesToScroll - 4) : 1;
        this.$container.slick({
            rtl: theme.rtl,
            rows: this.settings.rows,
            slidesToShow: this.settings.slidesToShow,
            slidesToScroll: this.settings.slidesToScroll,
            arrows: this.settings.arrows,
            dots: this.settings.dots,
            autoplay: this.settings.autoplay,
            accessibility: this.settings.accessibility,
            draggable: this.settings.draggable,
            infinite: this.settings.infinite,
            adaptiveHeight: true,
            responsive: [{
                    breakpoint: 1200,
                    settings: {
                        slidesToShow: this.settings.slidesToShow1200,
                        slidesToScroll: this.settings.slidesToScroll1200
                    }
                },
                {
                    breakpoint: 992,
                    settings: {
                        slidesToShow: this.settings.slidesToShow992,
                        slidesToScroll: this.settings.slidesToScroll992
                    }
                },
                {
                    breakpoint: 768,
                    settings: {
                        slidesToShow: this.settings.slidesToShow768,
                        slidesToScroll: this.settings.slidesToScroll768
                    }
                },
                {
                    breakpoint: 480,
                    settings: {
                        slidesToShow: 1,
                        slidesToScroll: this.settings.slidesToScroll480
                    }
                }
            ]
        })
    }

    Carousels.prototype = _.assignIn({}, Carousels.prototype, {
        _a11y: function(event, obj) {
            var $list = obj.$list;
            var $wrapper = this.$container.parent();

            // Remove default Slick aria-live attr until slider is focused
            $list.removeAttr('aria-live');

            // When an element in the slider is focused set aria-live
            $wrapper.on('focusin', function(evt) {
                if ($wrapper.has(evt.target).length) {
                    $list.attr('aria-live', 'polite');
                }
            });

            // Remove aria-live
            $wrapper.on('focusout', function(evt) {
                if ($wrapper.has(evt.target).length) {
                    $list.removeAttr('aria-live');
                }
            });
        },

        _goToSlide: function(slideIndex) {
            this.$container.slick('slickGoTo', slideIndex);
        },

        onUnload: function() {
            delete this.$container;
        },

        onBlockSelect: function(evt) {
            // Ignore the cloned version
            var $slide = $(
                '.carousel__slide-wrapper--' + evt.detail.blockId + ':not(.slick-cloned)'
            );
            var slideIndex = $slide.data('slick-index');

            // Go to selected slide, pause autoplay
            this._goToSlide(slideIndex);

        }
    });

    return Carousels;
})()

// Productlists
theme.Productlists = (function() {
    function Productlists(container) {
        this.$container = $(container).on('init', this._a11y.bind(this));
        this.settings = {
            slidesToShow: this.$container.data('slidestoshow') || 1,
            rows: this.$container.data('rows') || 1,
            arrows: this.$container.data('arrows') || false,
            dots: this.$container.data('dots') || false,
            draggable: this.$container.data('draggable') || false,
            infinite: this.$container.data('infinite') || false,
        }
        this.settings.slidesToShow1200 = (this.settings.slidesToShow - 1) > 1 ? (this.settings.slidesToShow - 1) : 1;
        this.settings.slidesToShow992 = (this.settings.slidesToShow - 2) > 1 ? (this.settings.slidesToShow - 2) : 1;
        this.settings.slidesToShow768 = (this.settings.slidesToShow - 3) > 1 ? (this.settings.slidesToShow - 3) : 1;
        this.settings.slidesToShow480 = 2;
        this.$container.slick({
            rtl: theme.rtl,
            accessibility: true,
            slidesToShow: this.settings.slidesToShow,
            slidesToScroll: this.settings.slidesToShow,
            rows: this.settings.rows,
            arrows: this.settings.arrows,
            dots: this.settings.dots,
            infinite: this.settings.infinite,
            draggable: this.settings.draggable,
            responsive: [{
                    breakpoint: 1200,
                    settings: {
                        slidesToShow: this.settings.slidesToShow1200,
                        slidesToScroll: this.settings.slidesToShow1200
                    }
                },
                {
                    breakpoint: 992,
                    settings: {
                        slidesToShow: this.settings.slidesToShow992,
                        slidesToScroll: this.settings.slidesToShow992
                    }
                },
                {
                    breakpoint: 768,
                    settings: {
                        slidesToShow: this.settings.slidesToShow768,
                        slidesToScroll: this.settings.slidesToShow768
                    }
                },
                {
                    breakpoint: 480,
                    settings: {
                        slidesToShow: this.settings.slidesToShow480,
                        slidesToScroll: this.settings.slidesToShow480
                    }
                }
            ]
        }).css('opacity', '1');
    }

    Productlists.prototype = _.assignIn({}, Productlists.prototype, {
        _a11y: function(event, obj) {
            var $list = obj.$list;
            var $wrapper = this.$container.parent();

            // Remove default Slick aria-live attr until slider is focused
            $list.removeAttr('aria-live');

            // When an element in the slider is focused set aria-live
            $wrapper.on('focusin', function(evt) {
                if ($wrapper.has(evt.target).length) {
                    $list.attr('aria-live', 'polite');
                }
            });

            // Remove aria-live
            $wrapper.on('focusout', function(evt) {
                if ($wrapper.has(evt.target).length) {
                    $list.removeAttr('aria-live');
                }
            });
        },

        _goToSlide: function(slideIndex) {
            this.$container.slick('slickGoTo', slideIndex);
        },

        onUnload: function() {
            delete this.$container;
        }
    });

    return Productlists;
})();

// Producttabs
theme.Producttabs = (function() {
    function Producttabs(container) {
        var _self = this; // avoid conflict
        this.$container = $(container).on('init', this._a11y.bind(this));
        this.slickWrap = '.prdtab-content';
        this.settings = {
            slidesToShow: this.$container.data('slidestoshow') || 1,
            arrows: this.$container.data('arrows') || false,
            rows: this.$container.data('rows') || 1,
            dots: this.$container.data('dots') || false,
            draggable: this.$container.data('draggable') || false,
            infinite: this.$container.data('infinite') || false,
        }
        this.settings.slidesToShow1200 = (this.settings.slidesToShow - 1) > 1 ? (this.settings.slidesToShow - 1) : 1;
        this.settings.slidesToShow992 = (this.settings.slidesToShow - 2) > 1 ? (this.settings.slidesToShow - 2) : 1;
        this.settings.slidesToShow768 = (this.settings.slidesToShow - 3) > 1 ? (this.settings.slidesToShow - 3) : 1;
        this.settings.slidesToShow480 = 2;

        this._initSlick();
        this.$container.find('a[data-toggle="tab"]').on("shown.bs.tab", function(e) {
            _self._unSlick();
            _self._initSlick();
            theme.tooltip.load();
        })
    }

    Producttabs.prototype = _.assignIn({}, Producttabs.prototype, {
        _a11y: function(event, obj) {
            var $list = obj.$list;
            var $wrapper = this.$container.parent();

            // Remove default Slick aria-live attr until slider is focused
            $list.removeAttr('aria-live');

            // When an element in the slider is focused set aria-live
            $wrapper.on('focusin', function(evt) {
                if ($wrapper.has(evt.target).length) {
                    $list.attr('aria-live', 'polite');
                }
            });

            // Remove aria-live
            $wrapper.on('focusout', function(evt) {
                if ($wrapper.has(evt.target).length) {
                    $list.removeAttr('aria-live');
                }
            });
        },

        _getSliderSettings: function() {
            return {
                rtl: theme.rtl,
                accessibility: true,
                slidesToShow: this.settings.slidesToShow,
                slidesToScroll: this.settings.slidesToShow,
                arrows: this.settings.arrows,
                rows: this.settings.rows,
                dots: this.settings.dots,
                infinite: this.settings.infinite,
                draggable: this.settings.draggable,
                responsive: [{
                        breakpoint: 1200,
                        settings: {
                            slidesToShow: this.settings.slidesToShow1200,
                            slidesToScroll: this.settings.slidesToShow1200
                        }
                    },
                    {
                        breakpoint: 992,
                        settings: {
                            slidesToShow: this.settings.slidesToShow992,
                            slidesToScroll: this.settings.slidesToShow992
                        }
                    },
                    {
                        breakpoint: 768,
                        settings: {
                            slidesToShow: this.settings.slidesToShow768,
                            slidesToScroll: this.settings.slidesToShow768
                        }
                    },
                    {
                        breakpoint: 480,
                        settings: {
                            slidesToShow: this.settings.slidesToShow480,
                            slidesToScroll: this.settings.slidesToShow480
                        }
                    }
                ]
            }
        },

        _initSlick: function() {
            this.$container.find(this.slickWrap).slick(this._getSliderSettings()).css('opacity', '1');
        },

        _unSlick: function() {
            this.$container.find(this.slickWrap).slick('unslick');
        },

        onUnload: function() {
            delete this.$container;
        },

        onSelect: function() {
            this._unSlick();
            this._initSlick();
        },

        onBlockSelect: function(evt) {
            var navItem = $('.nav-link-' + evt.detail.blockId);
            navItem.tab('show');
            this._unSlick();
            this._initSlick();
        }
    });

    return Producttabs;
})();

theme.Video = (function() {
    var promiseYoutubeAPI;
    var promiseVimeoAPI;

    var youtube = {
        promiseAPI: function() {
            if (!promiseYoutubeAPI) {
                var tag = document.createElement('script');

                tag.src = 'https://www.youtube.com/iframe_api';
                var firstScriptTag = document.getElementsByTagName('script')[0];
                firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

                promiseYoutubeAPI = $.Deferred(function(defer) {
                    window.onYouTubeIframeAPIReady = defer.resolve;

                    setTimeout(function() {
                        defer.reject('Request for YouTube API timed out after 30 seconds.');
                    }, 30000);
                });
            }

            return promiseYoutubeAPI;
        },
        promisePlayer: function(id, options) {
            return this.promiseAPI().then(function() {
                return $.Deferred(function(defer) {
                    if (typeof window.YT === 'undefined') {
                        defer.reject(
                            "We're sorry, something went wrong. The YouTube API has not loaded correctly."
                        );
                    }

                    /* eslint-disable no-undef */
                    var player = new YT.Player(id, options); // global YT variable injected by YouTube API

                    player.addEventListener('onReady', function() {
                        defer.resolve(player);
                    });

                    setTimeout(function() {
                        defer.reject(
                            'Request for YouTube player has timed out after 30 seconds.'
                        );
                    }, 30000);
                });
            });
        }
    };

    var vimeo = {
        promiseAPI: function() {
            if (!promiseVimeoAPI) {
                promiseVimeoAPI = $.Deferred(function(defer) {
                    var tag = document.createElement('script');
                    tag.src = 'https://player.vimeo.com/api/player.js';
                    tag.onload = tag.onreadystatechange = function() {
                        if (!this.readyState || this.readyState === 'complete') {
                            defer.resolve();
                        }
                    };

                    var firstScriptTag = document.getElementsByTagName('script')[0];
                    firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

                    setTimeout(function() {
                        defer.reject('Request for Vimeo API timed out after 30 seconds.');
                    }, 30000);
                });
            }

            return promiseVimeoAPI;
        },

        promisePlayer: function(id, options) {
            return this.promiseAPI().then(function() {
                return $.Deferred(function(defer) {
                    if (typeof window.Vimeo === 'undefined') {
                        defer.reject(
                            "We're sorry, something went wrong. The Vimeo API has not loaded correctly."
                        );
                    }

                    var player = new window.Vimeo.Player(id, options);

                    setTimeout(function() {
                        defer.reject(
                            'Request for Vimeo player has timed out after 30 seconds.'
                        );
                    }, 30000);

                    player.ready().then(function() {
                        defer.resolve(player);
                    });
                });
            });
        }
    };

    var selectors = {
        loadPlayerButton: '.video-section__load-player-button',
        closePlayerButton: '.video-section__player-close',
        playerContainer: '.video-section__player',
        cover: '.video-section__cover',
        errorMessage: '.video-section__error',
        bodyOverlay: '.video-section__body-overlay',
        body: 'body'
    };
    var classes = {
        playerLoading: 'video-section--loading',
        playerLoaded: 'video-section--loaded',
        playerError: 'video-section--error',
        videoPlaying: 'video-playing'
    };

    function Video(container) {
        this.$container = $(container);
        var sectionId = this.$container.attr('data-section-id');
        this.namespace = '.' + sectionId;
        this.onLoad();
    }

    Video.prototype = _.assignIn({}, Video.prototype, {
        onLoad: function() {
            this.$container
                .on('click', selectors.loadPlayerButton, this._loadPlayer.bind(this))
                .on('click', selectors.closePlayerButton, this._closePlayer.bind(this))
                .on('click', selectors.bodyOverlay, this._closePlayer.bind(this));
        },

        _loadPlayer: function() {
            var $container = this.$container;
            var $playerContainer = $(selectors.playerContainer, $container);
            var playerType = this.$container.attr('data-video-type');

            var promiseVideoPlayer;

            if (playerType === 'youtube') {
                promiseVideoPlayer = this._loadYoutubePlayer($playerContainer[0]);
            } else if (playerType === 'vimeo') {
                promiseVideoPlayer = this._loadVimeoPlayer($playerContainer[0]);
            }

            return promiseVideoPlayer
                .then(this._onPlayerLoadReady.bind(this))
                .fail(this._onPlayerLoadError.bind(this));
        },

        _loadYoutubePlayer: function(container) {
            return youtube
                .promisePlayer(container, {
                    videoId: this.$container.attr('data-video-id'),
                    ratio: 16 / 9,
                    playerVars: {
                        modestbranding: 1,
                        autoplay: 1,
                        showinfo: 0,
                        rel: 0
                    }
                })
                .then(
                    function(player) {
                        this.player = player;
                    }.bind(this)
                );
        },

        _loadVimeoPlayer: function(container) {
            return vimeo
                .promisePlayer(container, {
                    id: this.$container.attr('data-video-id')
                })
                .then(
                    function(player) {
                        this.player = player;
                        this.player.play();
                    }.bind(this)
                );
        },

        _onPlayerLoadReady: function() {
            $(selectors.closePlayerButton, this.$container)
                .show()
                .focus();
            $(selectors.cover, this.$container).addClass(classes.playerLoaded);
            this.$container.addClass(classes.playerLoaded);

            this._setScrollPositionValues();

            $(selectors.body).addClass(classes.videoPlaying);

            $(document).on('keyup' + this.namespace, this._closeOnEscape.bind(this));
            $(window).on(
                'resize' + this.namespace,
                this._setScrollPositionValues.bind(this)
            );
            slate.a11y.trapFocus({
                $container: this.$container,
                namespace: this.namespace
            });
        },

        _onPlayerLoadError: function(err) {
            this.$container.addClass(classes.playerError);
            $(selectors.errorMessage, this.$container).text(err);
        },

        _closeOnEscape: function(evt) {
            if (evt.keyCode !== 27) {
                return;
            }

            this._closePlayer();
            $(selectors.loadPlayerButton, this.$container).focus();
        },

        _onScroll: function() {
            var scrollTop = $(window).scrollTop();

            if (
                scrollTop > this.videoTop + 0.25 * this.videoHeight ||
                scrollTop + this.windowHeight <
                this.videoBottom - 0.25 * this.videoHeight
            ) {
                // Debounce DOM edits to the next frame with requestAnimationFrame
                requestAnimationFrame(this._closePlayer.bind(this));
            }
        },

        _setScrollPositionValues: function() {
            this.videoHeight = this.$container.outerHeight(true);
            this.videoTop = this.$container.offset().top;
            this.videoBottom = this.videoTop + this.videoHeight;
            this.windowHeight = $(window).innerHeight();
        },

        _closePlayer: function() {
            $(selectors.body).removeClass(classes.videoPlaying);
            $(selectors.cover, this.$container).removeClass(classes.playerLoaded);
            this.$container.removeClass(classes.playerLoaded);
            $(selectors.closePlayerButton, this.$container).hide();

            slate.a11y.removeTrapFocus({
                $container: this.$container,
                namespace: this.namespace
            });

            if (typeof this.player.destroy === 'function') {
                this.player.destroy();
            } else if (typeof this.player.unload === 'function') {
                this.player.unload();
            }

            $(document).off(this.namespace);
            $(window).off(this.namespace);
        }
    });

    return Video;
})();

theme.CollectionsList = (function() {
    function CollectionsList(container) {
        var $container = (this.$container = $(container));
        var stretchImage = $container.is('[data-stretch-image]');

        // Early return if 'secondary image layout' is enabled
        if (stretchImage) return;

        var namespace = (this.namespace = '.' + $container.attr('data-section-id'));
        var self = this;

        self._collectionListFix();
        $(window).on(
            'resize' + namespace,
            $.debounce(250, function() {
                self._collectionListFix();
            })
        );
    }

    CollectionsList.prototype = _.assignIn({}, CollectionsList.prototype, {
        onUnload: function() {
            $(window).off(this.namespace);
        },

        _collectionListFix: function() {
            var numberRows = this.$container.find('.grid').data('number-rows');
            var $featureCards = this.$container.find('.featured-card');

            // We can exit if 'Use secondary image layout' is enabled
            if ($featureCards.is('[data-stretch-image]')) return;

            // Go through each of the rows
            for (var i = 0; i < numberRows; i++) {
                var maxWrapperHeight = 0;
                var maxHeaderHeight = 0;
                var $currentRow = $featureCards.filter(
                    "[data-row-number='" + (i + 1) + "']"
                );
                var $cardHeaders = $currentRow.find('.featured-card__header');

                // Find the max heights for each row
                $currentRow.each(function() {
                    var $cardTitle = $(this).find('.featured-card__title');
                    var $cardAction = $(this).find('.featured-card__action');
                    var $cardImageWrapper = $(this).find('.featured-card__image-wrapper');
                    var headerHeight =
                        $cardTitle.outerHeight() + $cardAction.outerHeight() + 65;
                    var wrapperHeight = $cardImageWrapper.outerHeight();
                    if (headerHeight > maxHeaderHeight) {
                        maxHeaderHeight = headerHeight;
                    }
                    if (wrapperHeight > maxWrapperHeight) {
                        maxWrapperHeight = wrapperHeight;
                    }
                });

                // Set the heights of the headers and cards for this row with padding
                $cardHeaders.outerHeight(maxHeaderHeight);
                $currentRow.height(maxWrapperHeight + maxHeaderHeight + 40);
            }
        }
    });

    return CollectionsList;
})();

theme.ParrallaxImage = (function() {
    function ParrallaxImage(container) {
        this.container = container;
        this.sectionId = $(container).attr('data-section-id');
        this.namespace = 'parallax-' + this.sectionId;
        var images = document.getElementsByClassName('thumbnail' + this.sectionId);
        new simpleParallax(images, {
            scale: 1.5,
            delay: .6,
        });
    }

    ParrallaxImage.prototype = $.extend({}, ParrallaxImage.prototype, {
        onUnload: function(evt) {
            var instance = new simpleParallax(images);
            instance.destroy();
            delete theme.ParrallaxImage[this.namespace];
        }
    });

    return ParrallaxImage;
})();

theme.init = function() {
    theme.customerTemplates.init();
    slate.rte.wrapTable();
    slate.rte.iframeReset();

    // Common a11y fixes
    slate.a11y.pageLinkFocus($(window.location.hash));

    $('.in-page-link').on('click', function(evt) {
        slate.a11y.pageLinkFocus($(evt.currentTarget.hash));
    });

    $('a[href="#"]').on('click', function(evt) {
        evt.preventDefault();
    });


    //scroll animation
    AOS.init({
        startEvent: 'DOMContentLoaded',
        offset: 30, // offset (in px) from the original trigger point
        delay: 0, // values from 0 to 3000, with step 50ms
        duration: 1000,
        once: true
    });
    window.addEventListener('load', function() {
        AOS.refresh();
    });


    // Sections
    var sections = new theme.Sections();
    sections.register('header', theme.HeaderSection);
    sections.register('product', theme.Product);
    sections.register('slideshow-section', theme.SlideshowSection);
    sections.register('cart', theme.Cart);
    sections.register('instagrams', theme.Instagrams);
    sections.register('masonries', theme.Masonry);
    sections.register('productlist', theme.Productlists);
    sections.register('producttab', theme.Producttabs);
    sections.register('slickCarousels', theme.slickCarousel);
    sections.register('video', theme.Video);
    sections.register('collections-list', theme.CollectionsList);
    sections.register('parallax-image', theme.ParrallaxImage);
    sections.register('bgcollection', theme.Bgcollection);

    // Standalone modules
    $(window).on('load', theme.articleImages);
    theme.passwordModalInit();
};

theme.articleImages = function() {
    var $indentedRteImages = $('.rte--indented-images');
    if (!$indentedRteImages.length) {
        return;
    }

    $indentedRteImages.find('img').each(function(i, el) {
        var $el = $(el);
        var attr = $el.attr('style');

        // Check if undefined or float: none
        if (!attr || attr === 'float: none;') {
            // Add class to parent paragraph tag if image is wider than container
            if ($el.width() >= $indentedRteImages.width()) {
                $el.parent('p').addClass('rte__image-indent');
            }
        }
    });
};

theme.passwordModalInit = function() {
    var $loginModal = $('#LoginModal');
    if (!$loginModal.length) {
        return;
    }

    // Initialize modal
    theme.PasswordModal = new window.Modals('LoginModal', 'login-modal', {
        focusOnOpen: '#Password'
    });

    // Open modal if errors exist
    if ($loginModal.find('.errors').length) {
        theme.PasswordModal.open();
    }
};

// CSS var ponyfill
theme.cssVar = (function() {
    cssVars();
})()

// Ajax search https://gist.github.com/awojtczyk/53d74c8af5f893841f33979b0cdcd6fe
theme.ajaxSearch = (function() {
    var $inputSearch = '.js-ajaxsearch',
        $resultsList = '.search-results',
        $input = $($inputSearch).find('input[name="q"]'),
        $currentAjaxRequest,
        $displayProducts = 6;

    $($inputSearch).css('position', 'relative').each(function() {
        $input.attr('autocomplete', 'off').bind('keyup change', function() {
            var term = $(this).val(),
                form = $(this).closest('form'),
                searchURL = '/search?type=product&q=*' + term + '*';
            if (term.length > 2 && term !== $(this).attr('data-old-term')) {
                $(this).attr('data-old-term', term);
                if ($currentAjaxRequest !== undefined) $currentAjaxRequest.abort();
                $currentAjaxRequest = $.getJSON(searchURL + '&view=json', function(data) {
                    $($resultsList).empty();

                    if (data.results_count === 0) {
                        $($resultsList).html('<p class="text-center">' + theme.strings.ajaxSearchNoResult + '</p>')
                    } else {
                        $.each(data.results, function(index, item) {
                            if (index < $displayProducts) {
                                var itemPrice = theme.Currency.formatMoney(item.price, theme.moneyFormat);
                                var link = $('<a class="d-inline-flex ' + index + '"></a>')
                                    .attr('href', item.url)
                                    .append('<span class="image"><img src="' + item.thumbnail + '" /></span>')
                                    .append('<div class="meta"><p class="title">' + item.title + '</p>' + itemPrice + '</div>')
                                    .wrap('<div class="ajax-search-item"></div>');
                                $($resultsList).append(link.parent());
                                theme.updateCurrencies();
                            }
                        });
                        if (data.results_count > $displayProducts) {
                            $($resultsList).append('<a class="btn btn--full" href="' + searchURL + '">' + theme.strings.ajaxSearchViewAll + ' (' + data.results_count + ')</a>');
                        }
                    }
                    $($resultsList).addClass('active').fadeIn(200);
                });
            }
        });
    });

    //escape when click somethings
    $(document).click(function(event) {
        var target = event.target;
        if (!$(target).is($inputSearch) && !$(target).parents().is($inputSearch)) {
            $($resultsList).slideUp(300);
        }
    });
})();

// Quickview https://github.com/kellyvaughn/quickview-for-shopify/blob/master/quickview.js.liquid
theme.quickview = (function() {
    var product_handle = '',
        quickviewButtonClass = '.js-btn-quickview',
        quickviewId = '#jsQuickview',
        quickviewOption = '#jsQuickview select',
        quickviewThumb = '#qv-product-images',
        quickviewAddCartButton = '.qv-add-button',
        quickviewPrice = '.qv-product-price',
        quickviewComparePrice = '.qv-product-compare-price';

    // 1. Show quickview
    $(document).on('click', quickviewButtonClass, function() {
        var quickviewAvaible = $(this).attr("data-pavailable");
        product_handle = $(this).data('handle');
        //ResetQuickview
        $(quickviewId).removeClass().addClass('modal fade');
        $(quickviewThumb).removeClass().empty();
        $('.qv-product-options').empty();

        //Pushdata
        $(quickviewId).addClass(product_handle).data('handle', product_handle);
        jQuery.getJSON('/products/' + product_handle + '.js', function(product) {
            var title = product.title;
            var type = product.type;
            var vendor = product.vendor;
            var price = 0;
            var compare_price = 0;
            var desc = product.description.slice(0, 90);
            var images = product.images;
            var variants = product.variants;
            var options = product.options;
            var url = '/products/' + product_handle;
            $('.qv-product-title').text(title);
            $('.qv-product-type').text(type);
            $('.qv-product-description').html(desc);
            $('.qv-view-product').attr('href', url);
            $('.qv-view-type').text(type);
            $('.qv-view-vendor').text(vendor)
            if (quickviewAvaible == 'true') {
                $(quickviewAddCartButton).prop('disabled', false).html(theme.strings.addToCart);
            } else {
                $(quickviewAddCartButton).prop('disabled', true).html(theme.strings.soldOut);
            }
            $(product.variants).each(function(i, variants) {
                if (variants.sku != null) {
                    $('.qv-sku').addClass("show").removeClass("hide");
                    $('.qv-view-sku').text(product.variants[0].sku);
                } else {
                    $('.qv-sku').addClass("hide").removeClass("show");
                }

            });
            var imageCount = $(images).length;
            $(images).each(function(i, image) {
                image_embed = '<div><img src="' + image + '"></div>';
                image_embed = image_embed.replace('.jpg', '_800x.jpg').replace('.png', '_800x.png');
                $(quickviewThumb).append(image_embed);
            });
            $(quickviewThumb).slick({
                rtl: theme.rtl,
                'dots': true,
                'arrows': true,
                'respondTo': 'min',
                'useTransform': true
            }).css('opacity', '1');

            if (product.variants[0].option1 !== "Default Title") {
                $(options).each(function(i, option) {
                    var name = option.name;
                    var opt = name.replace(/ /g, '-').toLowerCase();
                    var selectClass = '.option.' + opt;
                    $('.qv-product-options').append('<div class="option-selection ' + opt + '"><span class="option text-uppercase font-weight-bold text-body">' + option.name + '</span><select class="option-' + i + ' option ' + opt + '"></select></div>');
                    $(option.values).each(function(i, value) {
                        $('.option.' + opt).append($('<option>', {
                            value: value,
                            text: value
                        }));
                    });
                });
            }
            $(product.variants).each(function(i, v) {
                if (v.inventory_quantity == 0) {
                    return true
                } else {
                    price = theme.Currency.formatMoney(v.price, theme.moneyFormat);
                    compare_price = theme.Currency.formatMoney(v.compare_at_price, theme.moneyFormat);
                    $(quickviewPrice).html(price);
                    if (v.compare_at_price !== null) {
                        $(quickviewComparePrice).html(compare_price).show();
                    } else {
                        $(quickviewComparePrice).hide();
                    }
                    theme.updateCurrencies();
                    $('select.option-0').val(v.option1);
                    $('select.option-1').val(v.option2);
                    $('select.option-2').val(v.option3);
                    return false
                }
            });
        });
        //addCartQuickview
    });
    // 2. Add to cart
    $(document).on('click', quickviewAddCartButton, function() {
        product_handle = $(quickviewId).data('handle');
        var qty = $('.qv-quantity').val(),
            selectedOptions = '',
            var_id = '';

        function processCart() {
            jQuery.post('/cart/add.js', {
                    quantity: qty,
                    id: var_id
                }, null, "json").done(function(item) {
                    var htmlVariant = item.variant_title !== null ? '<i>(' + item.variant_title + ')</i>' : '';
                    var styleCart = $('.js-mini-cart').attr("data-cartmini");
                    if (styleCart != 'true') {
                        var htmlAlert = '<div class="media mt-2 alert--cart"><a class="mr-3" href="/cart"><img class="lazyload" data-src="' + item.image + '"></a><div class="media-body align-self-center"><p class="m-0 font-weight-bold">' + item.product_title + ' x ' + item.quantity + '</p>' + htmlVariant + '<div><div>';
                        theme.alert.new(theme.strings.addToCartSuccess, htmlAlert, 3000, 'notice');
                    }
                    theme.miniCart.updateElements();
                    theme.miniCart.generateCart();
                })
                .fail(function($xhr) {
                    var data = $xhr.responseJSON;
                    theme.alert.new('', data.description, 3000, 'warning');
                });
        }
        $(quickviewOption).each(function(i) {
            if (selectedOptions == '') {
                selectedOptions = $(this).val();
            } else {
                selectedOptions = selectedOptions + ' / ' + $(this).val();
            }
        });
        jQuery.getJSON('/products/' + product_handle + '.js', function(product) {
            if (product.variants.length === 1) {
                var_id = product.variants[0].id;
            } else {
                $(product.variants).each(function(i, v) {
                    if (v.title == selectedOptions) {
                        var_id = v.id;
                    }
                });
            }
            processCart();
        });
    });
    // 3. Select variants
    $(document).on('change', quickviewOption, function() {
        var selectedOptions = '';
        $(quickviewOption).each(function(i) {
            if (selectedOptions == '') {
                selectedOptions = $(this).val();
            } else {
                selectedOptions = selectedOptions + ' / ' + $(this).val();
            }
        });
        jQuery.getJSON('/products/' + product_handle + '.js', function(product) {
            $(product.variants).each(function(i, v) {
                if (v.title == selectedOptions) {
                    if (v.featured_image !== null) {
                        var iSlick = v.featured_image.position - 1;
                        $(quickviewThumb).slick('slickGoTo', iSlick);
                    }
                    var price = theme.Currency.formatMoney(v.price, theme.moneyFormat);
                    var compare_price = theme.Currency.formatMoney(v.compare_at_price, theme.moneyFormat);
                    $(quickviewPrice).html(price);
                    $(quickviewComparePrice).html(compare_price);
                    if (v.sku != null) {
                        $('.qv-sku').addClass("show").removeClass("hide");
                        $('.qv-view-sku').text(v.sku);
                    } else {
                        $('.qv-sku').addClass("hide").removeClass("show");
                    }
                    if (v.compare_at_price !== null) {
                        $(quickviewComparePrice).html(compare_price).show();
                    } else {
                        $(quickviewComparePrice).hide();
                    }
                    theme.updateCurrencies();
                    if (v.inventory_management === null) {
                        $(quickviewAddCartButton).prop('disabled', false).val(theme.strings.addToCart);
                    } else {
                        if (v.inventory_quantity < 1) {
                            $(quickviewAddCartButton).prop('disabled', true).val(theme.strings.soldOut);
                        } else {
                            $(quickviewAddCartButton).prop('disabled', false).val(theme.strings.addToCart);
                        }
                    }
                }
            });
        });
    });
})()

//Button add to cart (in grid item)
theme.addCartButton = (function() {
    var buttonClass = '.js-grid-cart';
    $(document).on('click', buttonClass, function() {
        var $this = $(this);
        var id = $this.data('id');
        $this.addClass('is-loading');
        Shopify.addItem(id, 1, function(item) {
            location.href = "/cart";
            var htmlVariant = item.variant_title !== null ? '<i>(' + item.variant_title + ')</i>' : '';
            var styleCart = $('.js-mini-cart').attr("data-cartmini");
            if (styleCart != 'true') {
                var htmlAlert = '<div class="media mt-2 alert--cart"><a class="mr-3" href="/cart"><img class="lazyload" data-src="' + item.image + '"></a><div class="media-body align-self-center"><p class="m-0 font-weight-bold">' + item.product_title + ' x ' + item.quantity + '</p>' + htmlVariant + '<div><div>';
            }
            theme.miniCart.updateElements();
            theme.miniCart.generateCart();
            setTimeout(function() {
                styleCart != 'true' ? theme.alert.new(theme.strings.addToCartSuccess, htmlAlert, 3000, 'notice') : '';
                $this.removeClass('is-loading');
            }, 1000);
        });
    })
})()

// Button add to cart (in grid item)
//theme.addCartButton = (function(){
//  var buttonClass = '.js-grid-cart';
//  $(document).on('click',buttonClass,function(){
//    var $this = $(this);
//    var id = $this.data('id');
//    $this.addClass('is-loading');
//    Shopify.addItem(id,1,function(item){
//      var htmlVariant = item.variant_title !== null ? '<i>('+item.variant_title+')</i>' : '';
//      var styleCart = $('.js-mini-cart').attr("data-cartmini");
//        if(styleCart != 'true'){
//          var htmlAlert = '<div class="media mt-2 alert--cart"><a class="mr-3" href="/cart"><img class="lazyload" data-src="'+item.image+'"></a><div class="media-body align-self-center"><p class="m-0 font-weight-bold">'+item.product_title+' x '+ item.quantity +'</p>'+htmlVariant+'<div><div>';
//        }
//      theme.miniCart.updateElements();
//      theme.miniCart.generateCart();
//      setTimeout(function() {
//        styleCart != 'true' ? theme.alert.new(theme.strings.addToCartSuccess,htmlAlert,3000,'notice'): '';
//        $this.removeClass('is-loading');
//      }, 1000);
//    });
// })
//})()

// Multi currencies 
if (theme.enableCurrencies) {
    // Can be 'money_format' or 'money_with_currency_format'
    Currency.format = 'money_format';
    var shopCurrency = Shopify.currency.active;
    var cookieCurrency = Currency.cookie.read();
    // Fix for customer account pages 
    jQuery('span.money span.money').each(function() {
        jQuery(this).parent('span.money').removeClass('money');
    });
    // Add precalculated shop currency to data attribute 
    jQuery('span.money').each(function() {
        jQuery(this).attr('data-currency-' + Shopify.currency.active, jQuery(this).html());
    });
    // Select all your currencies buttons.
    var buttons = jQuery('#currencies a'),
        currentCurrencies = jQuery('.pre-currencies');
    // When the page loads.
    if (cookieCurrency == null || cookieCurrency == shopCurrency) {
        Currency.currentCurrency = shopCurrency;
    } else {
        Currency.currentCurrency = cookieCurrency;
        Currency.convertAll(shopCurrency, cookieCurrency);
        buttons.removeClass('selected');
        jQuery('#currencies a[data-currency=' + cookieCurrency + ']').addClass('selected');
        var htmlCurrently = jQuery('#currencies a[data-currency=' + cookieCurrency + ']').html();
        currentCurrencies.html(htmlCurrently);
    }
    buttons.click(function() {
        buttons.removeClass('selected');
        jQuery(this).addClass('selected');
        var newCurrency = jQuery(this).attr('data-currency');
        var htmlCurrently = jQuery(this).html();
        currentCurrencies.html(htmlCurrently);
        Currency.convertAll(Currency.currentCurrency, newCurrency);
    });
    // For product options.
    var original_selectCallback = window.selectCallback;
    var selectCallback = function(variant, selector) {
        original_selectCallback(variant, selector);
        Currency.convertAll(shopCurrency, jQuery('#currencies a.selected').attr('data-currency'));
    };
}
theme.updateCurrencies = function() {
    Currency.convertAll(shopCurrency, jQuery('#currencies a.selected').attr('data-currency'));
}

// MiniCart
theme.miniCart = (function() {
    var miniCart = '.js-mini-cart',
        styleCart = $(miniCart).attr("data-cartmini"),
        cartToggle = '.js-toggle-cart',
        cartCount = '.js-cart-count',
        cartContent = '.js-mini-cart-content',
        cartTotal = '.js-cart-total',
        $btnCheckout = $('.js-cart-btn-checkout'),
        numberDisplayed = 5,
        // emptyCartHTML = '<div class="alert">' + theme.strings.cartEmpty + '</div>';

        function updateElements() {
            Shopify.getCart(function(cart) {

                if (cart.item_count === 0) {
                    $(cartContent).html(emptyCartHTML);
                    $btnCheckout.addClass('disabled');
                    styleCart === 'true' ? $(miniCart).removeClass('active') : null;

                } else {
                    $btnCheckout.removeClass('disabled');
                    styleCart === 'true' ? $(miniCart).addClass('active') : null;
                }
                $(cartCount).text(cart.item_count);
                $(cartTotal).html(theme.Currency.formatMoney(cart.total_price, theme.moneyFormat));
                theme.freeShipping.load(cart);
                theme.updateCurrencies();
            })
        }

    function generateCart() {

        Shopify.getCart(function(cart) {

            var htmlCart = cart.item_count === 0 ? emptyCartHTML : '',
                itemCount = cart.items.length,
                forLoop = itemCount < numberDisplayed ? itemCount : numberDisplayed;
            //styleCart === 'true' ? cart.items.length ? $(miniCart).addClass('active'): $(miniCart).removeClass('active') :null;

            // add list items
            for (var i = 0; i < forLoop; i++) {
                var product = cart.items[i],
                    productPrice = theme.Currency.formatMoney(product.price, theme.moneyFormat);
                htmlCart += '<div class="mini-cart-item">';
                htmlCart += '	<a class="mini-cart-image" href="' + product.url + '">';
                htmlCart += '		<img src="' + product.image + '"/>';
                htmlCart += '	</a>';
                htmlCart += '	<div class="mini-cart-meta">';
                htmlCart += '		<p ><a href="' + product.url + '">' + product.title + '</a></p>';
                htmlCart += '		<span> ' + productPrice + '</span><b> x ' + product.quantity + '</b>';
                htmlCart += '	</div>';
                htmlCart += '	<button class="btn js-remove-mini-cart" data-id="' + product.id + '">&times;</button>';
                htmlCart += '</div>';
            }
            if (itemCount > numberDisplayed) {
                htmlCart += '<a class="js-btn-viewmore" href="/cart">' + theme.strings.cartMore + '(' + (itemCount - numberDisplayed) + ')</a>'
            }
            // add total price and cart button / checkout button
            $(cartContent).html(htmlCart);
            $(cartTotal).html(theme.Currency.formatMoney(cart.total_price, theme.moneyFormat));
            theme.updateCurrencies();
        })
    }
    // 2. Button remove items
    $(document).on('click', '.js-remove-mini-cart', function() {
        var itemId = $(this).data('id');
        var isOuterMiniCart = $(this).closest(miniCart).length === 0 ? true : false; // check element from mini cart or not

        // hide items
        $(this).parent().fadeOut();

        //remove from cart
        Shopify.changeItem(itemId, 0, updateElements);
        Shopify.getCart(function(cart) {
            if (cart.items.length > numberDisplayed || isOuterMiniCart) {
                generateCart();
            }
        });
    });

    //Keep popup when click cart / UX
    $(document).on('click', cartToggle, function() {
        $(this).parent(miniCart).toggleClass('active');
    });
    $(document).on('click', '.overlaycart', function() {
        $(this).parent(miniCart).removeClass('active');
    });

    // gen minicart when load page
    generateCart();
    return {
        updateElements: updateElements,
        generateCart: generateCart
    }
})()

// Free shipping
theme.freeShipping = (function() {
    var $freeShippingClass = $('.js-free-shipping'),
        $freeShippingTextClass = $('.js-free-shipping-text'),
        $free_fisrt = $freeShippingClass.attr('data-start'),
        $free_end = $freeShippingClass.attr('data-end')
    minOrderValue = parseInt($freeShippingClass.data('value')) || 0,
        $percentClass = $('.js-free-shipping .progress-bar');

    function generate(cart) {
        var priceCart = cart.total_price;
        if (priceCart >= minOrderValue) {
            $percentClass.css('width', '100%').removeClass('progress-bar-striped bg-primary');
            $freeShippingTextClass.text(theme.strings.freeShipping)
        } else {
            let percent = priceCart / minOrderValue * 100;
            let left = Shopify.formatMoney((minOrderValue - priceCart), theme.moneyFormat);
            $percentClass.css('width', percent + '%').addClass('progress-bar-striped primary');
            $freeShippingTextClass.html($free_fisrt + ' ' + left + ' ' + $free_end);
            theme.updateCurrencies();
        }
    }

    Shopify.getCart(function(cart) {
        generate(cart);
    });

    return {
        load: generate
    }
})()

// Shipping time - https://github.com/phstc/jquery-dateFormat
theme.shippingTime = (function() {
    var $shippingTime = $('.js-shipping-time'),
        shippingTime = $shippingTime.data('time') || '',
        now = new Date(),
        restHour = 23 - now.getHours(),
        restMinute = 59 - now.getMinutes();
    if (shippingTime !== '') {
        var nextTime = new Date(now.getTime() + shippingTime * 86400000),
            formatTime = $.format.date(nextTime, "ddd, dd MMMM yyyy"),
            htmlShipping = 'Order in the next <b>' + restHour + '</b> hours <b>' + restMinute + '</b> minutes to get it by <b>' + formatTime + '</b>. ';
        $shippingTime.html(htmlShipping);
    }
})()

// Infinite scroll - https://github.com/Elkfox/Ajaxinate/blob/master/dist/ajaxinate.min.js
theme.infiniteScroll = (function() {
    function initInfiniteScroll() {
        if ($('.AjaxinateLoop').length === 0) {
            return;
        } else {
            var endlessScroll = new Ajaxinate({
                loadingText: '<div class="text-center"><div class="' + theme.loadingClass + '" role="status"></div></div>',
                callback: function() {
                    theme.wishlist.load();
                    theme.compare.load();
                    theme.countdown.load();
                    theme.priceRange.load();
                    theme.tooltip.load();
                    theme.collectionView.triggerView();
                    theme.swatchCard2.load();
                }
            });
        }
    }

    // Infinite scroll in other page (blog, list-collection)
    function initOtherPages() {
        var otherPages = new Ajaxinate({
            loadingText: '<div class="text-center"><div class="' + theme.loadingClass + '" role="status"></div></div>',
            container: '.js-pagination-content',
            pagination: '.js-pagination'
        });
    }

    document.addEventListener("DOMContentLoaded", function() {
        initInfiniteScroll();
        initOtherPages();
    });

    return {
        load: initInfiniteScroll
    }
})()

// Scroll to fixed
theme.scrollToFixed = (function() {
    var window_width = $(window).width();

    if (window_width < 768) {
        $(".js-stick-parent").trigger("sticky_kit:detach");
    } else {
        make_sticky();
    }
    $(window).resize(function() {

        window_width = $(window).width();

        if (window_width < 768) {
            $(".js-stick-parent").trigger("sticky_kit:detach");
        } else {
            make_sticky();
        }
    });

    function make_sticky() {
        $('.js-stick-parent').stick_in_parent();
    }

})()


theme.headersidebar = (function() {
    $('#dismiss, .overlaysidebar').on('click', function() {
        // hide sidebar
        $('#sidebar').removeClass('active');
        // hide overlay
        $('.overlaysidebar').removeClass('active');
    });

    $('#sidebarCollapse').on('click', function() {
        // open sidebar
        $('#sidebar').addClass('active');
        // fade in the overlay
        $('.overlaysidebar').addClass('active');
        $('.collapse.in').toggleClass('in');
        $('a[aria-expanded=true]').attr('aria-expanded', 'false');
    });
})()

// Wishlist
theme.wishlist = (function() {
    var wishlistButtonClass = '.js-btn-wishlist',
        wishlistRemoveButtonClass = '.js-remove-wishlist',
        $wishlistCount = $('.js-wishlist-count'),
        $wishlistContainer = $('.js-wishlist-content'),
        wishlistObject = JSON.parse(localStorage.getItem('localWishlist')) || [],
        wishlistPageUrl = $('.js-wishlist-link').attr('href'),
        loadNoResult = function() {
            $wishlistContainer.html('<div class="col text-center"><div class="alert alert-warning d-inline-block">' + theme.strings.wishlistNoResult + '</div></div>');
        };

    function updateWishlist(self) {
        var productHandle = $(self).data('handle'),
            allSimilarProduct = $(wishlistButtonClass + '[data-handle="' + productHandle + '"]');
        var isAdded = $.inArray(productHandle, wishlistObject) !== -1 ? true : false;
        if (isAdded) {
            // go to wishlist page
            window.location.href = wishlistPageUrl;
        } else {
            wishlistObject.push(productHandle);
            allSimilarProduct.fadeOut('slow').fadeIn('fast').html(theme.strings.wishlistIconAdded + theme.strings.wishlistTextAdded);
            //change tooltip
            allSimilarProduct.attr('data-original-title', theme.strings.wishlistTextAdded);
            $('.tooltip-inner').text(theme.strings.wishlistTextAdded);
        }
        localStorage.setItem('localWishlist', JSON.stringify(wishlistObject));
        $wishlistCount.text(wishlistObject.length);
    };

    function loadWishlist() {
        $wishlistContainer.html('');
        //page wishlist
        if (wishlistObject.length > 0) {
            for (var i = 0; i < wishlistObject.length; i++) {
                var productHandle = wishlistObject[i];
                Shopify.getProduct(productHandle, function(product) {
                    var htmlProduct = '';
                    var productPrice = product.price_varies ? 'from ' + theme.Currency.formatMoney(product.price_min, theme.moneyFormat) : theme.Currency.formatMoney(product.price, theme.moneyFormat);
                    var productComparePrice = product.compare_at_price_min !== 0 ? theme.Currency.formatMoney(product.compare_at_price_min, theme.moneyFormat) : '';
                    htmlProduct += '<div class="js-wishlist-item col-md-4 col-sm-6 col-xs-6 col-12 mb-4">';
                    htmlProduct += '<div class="js-wishlist-itembox">';
                    htmlProduct += '<div class=" d-flex flex-row p-4">';
                    htmlProduct += '	<a class="d-inline-block mr-4 " href="' + product.url + '">';
                    htmlProduct += '		<img src="' + product.featured_image + '"/>';
                    htmlProduct += '	</a>';
                    htmlProduct += '	<div><a href="' + product.url + '" class="title-prouct d-block h4 text-body" >' + product.title + '</a>';
                    htmlProduct += '	<span> ' + productPrice + '</span>';
                    htmlProduct += '	 <s>' + productComparePrice + '</s></div>';
                    htmlProduct += '<button class="btn js-remove-wishlist" data-handle="' + product.handle + '">' + theme.strings.wishlistRemove + '</button>';
                    htmlProduct += '</div>';
                    htmlProduct += '</div>';
                    htmlProduct += '</div>';
                    $wishlistContainer.append(htmlProduct);
                    theme.updateCurrencies();
                });
            }
        } else {
            loadNoResult();
        }

        //count items
        $wishlistCount.text(wishlistObject.length);

        //button text
        $(wishlistButtonClass).each(function() {
            var productHandle = $(this).data('handle');
            var iconWishlist = $.inArray(productHandle, wishlistObject) !== -1 ? theme.strings.wishlistIconAdded : theme.strings.wishlistIcon;
            var textWishlist = $.inArray(productHandle, wishlistObject) !== -1 ? theme.strings.wishlistTextAdded : theme.strings.wishlistText;
            $(this).html(iconWishlist + textWishlist).attr('title', textWishlist);
        });
    }

    $(document).on('click', wishlistButtonClass, function(event) {
        event.preventDefault();
        updateWishlist(this);
    });
    $(document).on('click', wishlistRemoveButtonClass, function() {
        var productHandle = $(this).data('handle'),
            allSimilarProduct = $(wishlistButtonClass + '[data-handle="' + productHandle + '"]');

        //update button
        allSimilarProduct.html(theme.strings.wishlistIcon + theme.strings.wishlistText);
        //update tooltip
        allSimilarProduct.attr('data-original-title', theme.strings.wishlistText);
        $('.tooltip-inner').text(theme.strings.wishlistText);
        //update Object
        wishlistObject.splice(wishlistObject.indexOf(productHandle), 1);
        localStorage.setItem('localWishlist', JSON.stringify(wishlistObject));
        // Remove element
        $(this).closest('.js-wishlist-item').fadeOut(); // or .remove()
        //count
        $wishlistCount.text(wishlistObject.length);
        if (wishlistObject.length === 0) {
            loadNoResult();
        }
    });

    loadWishlist();
    $(document).on('shopify:section:load', loadWishlist);
    return {
        load: loadWishlist
    }
})()

// Compare
theme.compare = (function() {
    var compareButtonClass = '.js-btn-compare',
        compareRemoveButtonClass = '.js-remove-compare',
        $compareCount = $('.js-compare-count'),
        $compareContainer = $('.js-compare-content'),
        compareObject = JSON.parse(localStorage.getItem('localCompare')) || [],
        alertClass = 'notice';

    function updateCompare(self) {
        var productHandle = $(self).data('handle'),
            alertText = '';
        var isAdded = $.inArray(productHandle, compareObject) !== -1 ? true : false;
        if (isAdded) {
            compareObject.splice(compareObject.indexOf(productHandle), 1);
            alertText = theme.strings.compareNotifyRemoved;
            alertClass = 'notice';
        } else {
            if (compareObject.length === 4) {
                alertText = theme.strings.compareNotifyMaximum;
                alertClass = 'error';
            } else {
                alertClass = 'notice';
                compareObject.push(productHandle);
                alertText = theme.strings.compareNotifyAdded;
            }
        }
        localStorage.setItem('localCompare', JSON.stringify(compareObject));
        theme.alert.new(theme.strings.compareText, alertText, 2000, alertClass);
        $compareCount.text(compareObject.length);
    };

    function loadCompare() {
        var compareGrid;
        $compareContainer.html('');
        //popup compare
        if (compareObject.length > 0) {
            compareGrid = compareObject.length === 1 ? 'col-md-6 col-sm-6' : 'col';
            for (var i = 0; i < compareObject.length; i++) {
                var productHandle = compareObject[i];
                Shopify.getProduct(productHandle, function(product) {
                    var htmlProduct = '',
                        productPrice = product.price_varies ? 'from ' + theme.Currency.formatMoney(product.price_min, theme.moneyFormat) : theme.Currency.formatMoney(product.price, theme.moneyFormat),
                        productComparePrice = product.compare_at_price_min !== 0 ? theme.Currency.formatMoney(product.compare_at_price_min, theme.moneyFormat) : '',
                        productAvailable = product.available ? theme.strings.available : theme.strings.unavailable,
                        productAvailableClass = product.available ? 'alert-success' : 'alert-danger',
                        productTypeHTML = product.type !== "" ? '<a href="/collections/types?q=' + product.type + '">' + product.type + '</a>' : '<span>' + theme.strings.none + '</span>',
                        productVendorHTML = product.vendor !== "" ? '<a href="/collections/vendors?q=' + product.vendor + '">' + product.vendor + '</a>' : '<span>' + theme.strings.none + '</span>';
                    htmlProduct += '<div class="compare-item ' + compareGrid + ' col-xs-6">';
                    htmlProduct += '	<a href="' + product.url + '">';
                    htmlProduct += '		<img src="' + Shopify.resizeImage(product.featured_image, 'x300') + '"/>';
                    htmlProduct += '	</a>';
                    htmlProduct += '	<hr /><h5 >' + product.title + '</h5>';
                    htmlProduct += '	<hr /><s>' + productComparePrice + '</s>';
                    htmlProduct += '	<span> ' + productPrice + '</span>';
                    htmlProduct += '	<hr /><span class=' + productAvailableClass + '> ' + productAvailable + '</span>';
                    htmlProduct += '	<hr />' + productTypeHTML;
                    htmlProduct += '	<hr />' + productVendorHTML;
                    htmlProduct += '  <hr /><button class="btn js-remove-compare btn-theme gradient-theme" data-handle="' + product.handle + '">' + theme.strings.compareRemove + '</button>';
                    htmlProduct += '</div>';
                    $compareContainer.append(htmlProduct);
                    theme.updateCurrencies();
                });
            }
        } else {
            $compareContainer.html('<div class="alert alert-warning d-inline-block">' + theme.strings.compareNoResult + '</div>');
        }

        //button text
        $(compareButtonClass).each(function() {
            var productHandle = $(this).data('handle');
            var status = $.inArray(productHandle, compareObject) !== -1 ? 'added' : '';
            $(this).removeClass('added').addClass(status);
        });

        //count items
        $compareCount.text(compareObject.length);
    }
    $(document).on('click', compareButtonClass, function(event) {
        event.preventDefault();
        updateCompare(this);
        loadCompare();
    });
    $(document).on('click', compareRemoveButtonClass, function() {
        var productHandle = $(this).data('handle');
        compareObject.splice(compareObject.indexOf(productHandle), 1);
        localStorage.setItem('localCompare', JSON.stringify(compareObject));
        loadCompare();
    });

    loadCompare();
    $(document).on('shopify:section:load', loadCompare);
    return {
        load: loadCompare
    }
})()

// Popup newsletter
theme.popupNewletter = (function() {
    var $popupNewsletter = $('#jsPopupNewsletter'),
        $newsletterForm = $('#jsPopupNewsletter form'),
        date = new Date(),
        minutes = theme.timePopupNewsletter;
    minutesdelay = $popupNewsletter.attr('data-delay');
    if ($popupNewsletter.length === 1) {
        date.setTime(date.getTime() + (minutes * 60 * 1000));
        var setCookies = function() {
            $.cookie('cookiesNewsletter', 'disabled', { expires: date, path: '/' });
        };
        if ($.cookie('cookiesNewsletter') !== "disabled") {
            $(window).on('load', function() {
                setTimeout(function() {
                    $popupNewsletter.modal('show');
                }, minutesdelay * 1000);
            });
            $popupNewsletter.on('hidden.bs.modal', setCookies);
            $newsletterForm.submit(setCookies);
        }
    }
})()

// Cookie policy
theme.cookie = (function() {
    var $policy = $('.js-cookie-policy'),
        $closeButton = $('.js-btn-ok'),
        isOk = localStorage.getItem('localCookie') || '';
    if (isOk === '') {
        $policy.fadeIn('slow');
    }
    $closeButton.on('click', function() {
        localStorage.setItem('localCookie', 'accept');
        $policy.fadeOut('slow');
    })
})()

// Announcement Bar
theme.announcement = (function() {
    var $bar = $('.js-announcement-bar'),
        $closeButton = $('.js-ab-close'),
        isClosed = localStorage.getItem('localAnnouncement') || '';
    if (isClosed === '') {
        $bar.fadeIn();
        $bar.closest('.body-theme').addClass('body-announcement-bar');
    }
    $closeButton.on('click', function() {
        localStorage.setItem('localAnnouncement', 'closed');
        $bar.slideUp();
        $bar.closest('.body-theme').removeClass('body-announcement-bar');
    })
})()

// Open external link in new tab
theme.exLink = (function() {
    var links = document.links;
    for (let i = 0, linksLength = links.length; i < linksLength; i++) {
        if (links[i].hostname !== window.location.hostname && $(links[i]).attr('href') !== 'javascript:void(0)') {
            links[i].target = '_blank';
        }
    }
})()

// Deal- countdown
theme.countdown = (function() {
    function initCountdown() {
        $(".js-countdown").each(function() {
            var endTime = $(this).data('time'),
                htmlLayout = "<ul class='list--inline'><li class='gradient-theme-vertical'><span class='countdown-time'>%%D%%</span><span class='countdown-text'>Days</span></li><li class='gradient-theme-vertical'><span class='countdown-time'>%%H%%</span><span class='countdown-text'>Hours</span></li><li class='gradient-theme-vertical'><span class='countdown-time'>%%M%%</span><span class='countdown-text'>Mins</span></li><li class='gradient-theme-vertical'><span class='countdown-time'>%%S%%</span><span class='countdown-text'>Secs</span></li></ul>";
            $(this).lofCountDown({
                TargetDate: endTime,
                DisplayFormat: htmlLayout,
                FinishMessage: '<span class="alert alert-warning d-inline-block">' + theme.strings.countdownEndText + '</span>'
            });
        });
    }
    initCountdown();
    return {
        load: initCountdown
    }
})()

// Price range - Collection page
theme.priceRange = (function() {
    function initPriceRange() {
        var min = 0,
            max = 0,
            slideRange = '#js-slider-range',
            productCard = '.js-product-card',
            slideRangeWrap = '.slider-range-wr',
            rangeMin = '.js-range-min',
            rangeMax = '.js-range-max',
            enablePriceRange = $('#js-slider-range').length === 1 ? true : false;

        if (enablePriceRange) {
            $(productCard).each(function() {
                if (eval($(this).data('price')) > max) max = eval($(this).data('price'));
                if (min == 0) min = eval($(this).data('price'));
                else if (eval($(this).data('price')) < min) min = eval($(this).data('price'));
            });

            if (min === max) {
                $(slideRangeWrap).fadeOut();
            } else {
                $(slideRangeWrap).fadeIn();
            }

            $(slideRange).slider({
                range: true,
                min: min,
                max: max,
                values: [min, max],
                slide: function(event, ui) {
                    var price1 = (Shopify.formatMoney(ui.values[0], theme.moneyFormat));
                    var price2 = (Shopify.formatMoney(ui.values[1], theme.moneyFormat));
                    $(rangeMin).html(price1);
                    $(rangeMax).html(price2);
                    theme.updateCurrencies();

                    // Show/Hide product when dragging
                    $(productCard).each(function() {
                        if (eval($(this).data('price')) >= ui.values[0] && eval($(this).data('price')) <= ui.values[1]) {
                            $(this).parent().fadeIn();
                        } else {
                            $(this).parent().fadeOut();
                        }
                    });
                }
            });

            var price1 = (Shopify.formatMoney(min, theme.moneyFormat));
            var price2 = (Shopify.formatMoney(max, theme.moneyFormat));
            $(rangeMin).html(price1);
            $(rangeMax).html(price2);
            theme.updateCurrencies();

        }
    }
    initPriceRange();
    return {
        load: initPriceRange
    }
})()

// Collection view - Collection page
theme.collectionView = (function() {
    var btnView = '.js-btn-view',
        btnViewActive = '.js-btn-view.active';

    $(document).on('click', btnView, function() {
        var value = $(this).data('col'),
            $gridItemCol = $('.js-col');

        $(btnView).removeClass('active');
        $(this).addClass('active');

        $gridItemCol.removeClass().addClass('js-col col-sm-6 col-12');
        if (value === 3) {
            $gridItemCol.addClass('col-lg-4');
        } else if (value === 4) {
            $gridItemCol.addClass('col-lg-3');
        } else if (value === 5) {
            $gridItemCol.addClass('col-lg-2-4');
        } else if (value === 6) {
            $gridItemCol.addClass('col-lg-2');
        };
    })

    function triggerCollectionView() {
        $(btnViewActive).trigger('click');
    }

    return {
        triggerView: triggerCollectionView
    }
})()

// Swath variant in card item
theme.swatchCard = (function() {
    $(document).on('click', '.js-swatch-card-item', function() { //click or mouseover
        $(".js-swatch-card-item").removeClass("active");
        $(this).addClass("active");
        var newImage = $(this).data('image');
        var id = $(this).data('id');
        var gridItem = $(this).closest('.js-product-card');
        gridItem.find('.product-card__image').find('img').attr('srcset', newImage);
        gridItem.find('.js-grid-cart').data('id', id).attr('data-id', id);
    });
})()

theme.swatchCard2 = (function() {
    function initVariant(id) {
        var productJson = JSON.parse($('.customJson-' + id).html());
        var $selectorForm = $('.customform-' + id);
        var $button = $('.js-customform-addtocart-' + id);
        var $buttontext = $button.find('span');
        var $wrapObject = $selectorForm.closest('.js-product-card');
        var options = {
            $container: $selectorForm,
            enableHistoryState: false,
            product: productJson,
            singleOptionSelector: '.single-option-selector-' + id,
            originalSelectorId: '#ProductSelect-' + id
        };
        var variants = new slate.Variants(options);
        var AjaxCart = new window.AjaxCart($selectorForm);
        var _updateButton = function(evt) {
            var variant = evt.variant;
            if (variant === undefined) {
                $button.prop('disabled', true).removeClass('btn--sold-out');
                $buttontext.html(theme.strings.unavailable);
            } else {
                if (variant.available) {
                    $button.removeClass('btn--sold-out').prop('disabled', false);
                    $buttontext.html(theme.strings.addToCart);
                } else {
                    $button.prop('disabled', true).addClass('btn--sold-out');
                    $buttontext.html(theme.strings.soldOut);
                }
            }
        }
        var _updateImage = function(evt) {
            var variant = evt.variant;
            var $mainImage = $wrapObject.find('.product-card__image').find('img');
            if (variant !== undefined && variant.featured_image !== null) {
                var variantImage = variant.featured_image;
                $mainImage.attr('srcset', variantImage.src);
            }
        }
        var _updatePrice = function(evt) {
            var $price = $wrapObject.find('.product-card__price');
            var variant = evt.variant;
            if (variant !== undefined) {
                var htmlComparePrice = variant.compare_at_price !== null ? '<s class="product-card__regular-price"><span class="money">' + variant.compare_at_price + '</span></s>' : '';
                var htmlPrice = '<span class="money">' + variant.price + '</span>' + htmlComparePrice;
                $price.html(htmlPrice);
                theme.updateCurrencies();
            }
        }
        variants.$container.on(
            'variantChange', _updateButton
        );
        variants.$container.on(
            'variantChange', _updateImage
        );
        variants.$container.on(
            'variantChange', _updatePrice
        );
    }

    function initForm() {
        $('.js-customform').each(function() {
            var id = $(this).data('id');
            initVariant(id);
        })
    }

    initForm();
    return {
        load: initForm
    }
})()

// Loading
theme.loading = (function() {
    var $loading = $('#js-loading'),
        hasLoading = $('#js-loading').length === 0 ? false : true;
    if (hasLoading) {
        $(window).load(function() {
            $loading.fadeOut();
        });
    }
})()

theme.effectLeavingPage = (function() {
    window.onbeforeunload = function() {
        $('body').css('opacity', '0');
    }
})()

// Isotope
theme.isotope = (function() {
    var enableIsotope = $('.enable-isotope').length === 1 ? true : false,
        $grid = $('.js-grid'),
        filter = '.js-filter-isotope';

    function initIsotope() {
        if (enableIsotope) {
            $grid.isotope({
                itemSelector: '.grid-item',
                percentPosition: true
            })
            $(document).on('click', filter, function() {
                var filterValue = $(this).data('filter') === '*' ? $(this).data('filter') : '.' + $(this).data('filter');
                $(filter).removeClass('active');
                $(this).addClass('active');
                $grid.isotope({
                    filter: filterValue
                });
            });
            $(window).scroll(function() {
                $grid.isotope('layout');
            });
            $(window).load(function() {
                $grid.isotope('layout');
                $(filter).first().trigger('click');
            });
        }
    }
    initIsotope();
})()

//aos



// theme.Wow = (function(){
//   new WOW().init();
// })()




// Masonry
theme.Masonry = (function() {
    function Masonry(container) {
        this.$container = $(container).on('init', this._a11y.bind(this));
        var $masonry = this.$container;
        $masonry.isotope({
            itemSelector: '.grid-item',
            percentPosition: true,
            masonry: {
                columnWidth: '.grid-sizer'
            }
        });
        $(window).load(function() {
            $masonry.isotope('layout').css('opacity', '1');
        });
        $(window).scroll(function() {
            $masonry.isotope('layout').css('opacity', '1');
        });
    }

    Masonry.prototype = _.assignIn({}, Masonry.prototype, {
        _a11y: function(event, obj) {
            var $list = obj.$list;
            var $wrapper = this.$container.parent();

            // Remove default Slick aria-live attr until slider is focused
            $list.removeAttr('aria-live');

            // When an element in the slider is focused set aria-live
            $wrapper.on('focusin', function(evt) {
                if ($wrapper.has(evt.target).length) {
                    $list.attr('aria-live', 'polite');
                }
            });

            // Remove aria-live
            $wrapper.on('focusout', function(evt) {
                if ($wrapper.has(evt.target).length) {
                    $list.removeAttr('aria-live');
                }
            });
        }
    });

    return Masonry;
})();



// Cross-selling
theme.crosssell = (function() {
    var crosssellClass = '.js-crosssell',
        handles = $(crosssellClass).data('handles') || '',
        arrayHandle = handles.split(','),
        $blockCrosssell = $('.block-cross-sell'),
        variantSelectClass = '.js-cross-select',
        crossImageClass = '.cross-item-image',
        crossPriceClass = '.cross-item-money';

    function generateCrosssell() {
        for (var i = 0; i < arrayHandle.length; i++) {
            var productHandle = arrayHandle[i];
            Shopify.getProduct(productHandle, function(product) {
                var htmlCross = '',
                    htmlOption = '',
                    firstAvailableVariant = '',
                    variantCount = product.variants.length;

                // generate select box and check first avaiable variant
                for (var j = 0; j < variantCount; j++) {
                    var variant = product.variants[j],
                        variantImage = variant.featured_image === null ? product.featured_image : variant.featured_image.src,
                        disabled = variant.available ? '' : 'disabled';
                    htmlOption += '<option ' + disabled + ' data-id="' + variant.id + '" data-price="' + variant.price + '" data-image="' + variantImage + '">' + variant.title + '</option>';
                    if (firstAvailableVariant === '' && variant.available) {
                        firstAvailableVariant = variant
                    }
                }
                var productPrice = theme.Currency.formatMoney(firstAvailableVariant.price, theme.moneyFormat),
                    productImage = firstAvailableVariant.featured_image === null ? product.featured_image : firstAvailableVariant.featured_image.src,
                    selectHide = variantCount === 1 ? 'hide' : '';

                // generate HTML
                htmlCross += '<div class="col cross-item ' + product.handle + '">';
                htmlCross += '	<a class="cross-item-image" href="' + product.url + '" title="' + product.title + '"><img src="' + productImage + '" />' + theme.strings.cartIcon + '</a>';
                htmlCross += '	<a target="_blank" href="' + product.url + '" title="' + product.title + '" class="cross-item-title">' + product.title + '</a>';
                htmlCross += '	<span class="cross-item-money">' + productPrice + '</span>';
                htmlCross += '	<select class="js-cross-select ' + selectHide + '" data-image="' + productImage + '" data-price="' + firstAvailableVariant.price + '" data-item="' + firstAvailableVariant.id + '">' + htmlOption + '</select>';
                htmlCross += '</div>';
                $(crosssellClass).append(htmlCross);
                theme.updateCurrencies();
            });
        }
    }

    function showPopupCrosssell(lineItem) {
        //generate lineitem;
        var htmlLineItem = '';
        htmlLineItem += '<span class="alert alert-success d-inline-block mb-2">' + theme.strings.addToCartSuccess + '</span>';
        htmlLineItem += '<div><img src="' + lineItem.image + '" alt="Added Product"></div>';
        htmlLineItem += '<h4 class="cross-item-title">' + lineItem.title + '</h4>';
        htmlLineItem += '<div class="mb-2">' + theme.strings.cartQuantity + ': ' + lineItem.quantity + '</div>';
        $('.js-cross-added').hide().html(htmlLineItem).fadeIn();

        // show popup
        var $popupCrosssell = $('#jsCrosssell');
        $popupCrosssell.modal('show');
    }

    if (handles !== '') {
        $(document).on('click', crossImageClass, function(event) {
            event.preventDefault();
            var parent = $(this).closest('.cross-item'),
                itemId = parent.find(variantSelectClass).attr('data-item');
            Shopify.addItem(itemId, 1, function(lineItem) {
                theme.miniCart.updateElements();
                theme.miniCart.generateCart();
                showPopupCrosssell(lineItem);
            });
        });
        $(document).on('change', variantSelectClass, function() {
            var selectVariant = $(this).children(':selected'),
                selectVariantId = selectVariant.data('id'),
                parent = $(this).parent(),
                newPrice = theme.Currency.formatMoney(selectVariant.data('price'), theme.moneyFormat);

            if (selectVariant.data('image') !== '') {
                parent.find(crossImageClass).find('img').attr('src', selectVariant.data('image'));
            }
            $(this).attr('data-item', selectVariantId);
            parent.find(crossPriceClass).html(newPrice);
            theme.updateCurrencies();
        });
        $(document).on('shopify:section:load', generateCrosssell);
        generateCrosssell();
        $blockCrosssell.removeClass('hide');
    }
    return {
        showPopup: showPopupCrosssell
    }
})()

// Upsell
theme.upsell = (function() {
    var popupUpsell = '#jsUpsell',
        $button = $('#jsUpsell .btn'),
        productUpsellId = $('#jsUpsell').data('id') || '',
        buttonAcceptClass = 'js-btn-accept',
        delayTime = $('#jsUpsell').data('delay') || 3000,
        isUpsell = $(popupUpsell).length === 1 ? true : false;
    if (isUpsell) {
        $(document).ready(function() {
            setTimeout(function() {
                $(popupUpsell).modal('show');
            }, delayTime);
        });
        $button.on('click', function() {
            if ($(this).hasClass(buttonAcceptClass)) {
                Shopify.addItem(productUpsellId, 1, function(item) {
                    theme.miniCart.updateElements();
                    theme.miniCart.generateCart();
                    var htmlVariant = item.variant_title !== null ? '<i>(' + item.variant_title + ')</i>' : '';
                    var htmlAlert = '<div class="media mt-2 alert--cart"><a class="mr-3" href="/cart"><img class="lazyload" data-src="' + item.image + '"></a><div class="media-body align-self-center"><p class="m-0 font-weight-bold">' + item.product_title + ' x ' + item.quantity + '</p>' + htmlVariant + '<div><div>';
                    theme.alert.new(theme.strings.addToCartSuccess, htmlAlert, 3000, 'notice');
                })
            }
            $(popupUpsell).modal('hide');
        })
    }
})()

// Coupon
theme.coupon = (function() {
    var popupCoupon = '#jsCoupon',
        $button = $('#jsCoupon .js-btn-coupon'),
        delayTime = $('#jsCoupon').data('delay') || 3000,
        isCoupon = $(popupCoupon).length === 1 ? true : false,
        isCopied = localStorage.getItem('localCoupon') || '';
    if (isCoupon && isCopied === '') {
        $(document).ready(function() {
            setTimeout(function() {
                $(popupCoupon).modal('show');
            }, delayTime);
        });
        $button.on('click', function() {
            var copyText = document.getElementById("coupon_code");
            copyText.select();
            document.execCommand("Copy");
            $(popupCoupon).modal('hide');
            theme.alert.new('Coupon code', 'Successfully copied, now you can paste code at checkout', 4000);
            localStorage.setItem('localCoupon', 'copied');
        })
    }
})()

// Overwrite Shopify.onError in Shopify API
Shopify.onError = function(t, r) {
    var e = eval("(" + t.responseText + ")");
    var mess = e.message ? e.message + "(" + e.status + "): " + e.description : "Error : " + Shopify.fullMessagesFromErrors(e).join("; ") + "."
    theme.alert.new('Alert', mess, 3000, 'warning');
}

// Megamenu width
theme.fixWidthMegamenu = (function() {
    var $megamenuClass = $('.site-nav__item-mega'),
        megaDropdownClass = '.meganav';
    $megamenuClass.each(function() {
        var widthMenu = $(this).data('width') || 0;
        if (widthMenu !== 0) {
            $(this).find(megaDropdownClass).css({ 'width': widthMenu + 'px', 'margin-left': '-' + widthMenu / 2 + 'px' });
        }
    });
})()

// Product video
theme.productVideo = (function() {
    var playButtonClass = '.js-play-button';
    $(document).on('click', playButtonClass, function() {
        let videoSelector = $(this).next(),
            videoObject = videoSelector.get(0);
        $(this).toggleClass('active');
        videoSelector.toggleClass('active');
        videoObject.paused ? videoObject.play() : videoObject.pause();
    })
})()

// Fake-viewers
theme.fakeViewer = (function() {
    var $fakeViewClass = $('.js-fake-view'),
        minValue = $fakeViewClass.data('min'),
        maxValue = $fakeViewClass.data('max'),
        duration = $fakeViewClass.data('duration');

    function randomInRange(start, end) {
        var value = Math.floor(Math.random() * (end - start + 1) + start);
        $fakeViewClass.text(value);
    }

    if (minValue !== undefined && maxValue !== undefined) {
        randomInRange(minValue, maxValue);
        setInterval(function() {
            randomInRange(minValue, maxValue);
        }, duration);
    }

})();

// Product-suggest
theme.productSuggest = (function() {
    var $productSuggestClass = $('.product-notification'),
        $closeButtonClass = $('.close-notifi'),
        duration = $productSuggestClass.data('time') || 0,
        productSuggestCookie = 'cookieSuggest';

    function SomeonePurchased() {
        if ($.cookie(productSuggestCookie) == 'closed') {
            $productSuggestClass.remove();
        }
        $closeButtonClass.on('click', function() {
            $productSuggestClass.remove();
            $.cookie(productSuggestCookie, 'closed', { expires: 1, path: '/' });
        });

        function toggleSomething() {
            if ($productSuggestClass.hasClass('active')) {
                $productSuggestClass.removeClass('active')
            } else {
                var arrayProducts = $('.data-product'),
                    randomProduct = Math.floor(Math.random() * arrayProducts.length),
                    Object = $(arrayProducts[randomProduct]);

                $productSuggestClass.addClass('active');
                $productSuggestClass.find('.product-image').attr('href', Object.data('url')).find('img').attr('src', Object.data('image'));
                $productSuggestClass.find('.product-name').text(Object.data('title')).attr('href', Object.data('url'));
                $productSuggestClass.find('.time-ago').text(Object.data('time'));
                $productSuggestClass.find('.from-ago').text(Object.data('local'));
            }
        }

        if (duration !== 0) {
            setInterval(toggleSomething, duration);
        }
    }
    SomeonePurchased();
})()


// Stickyheader
theme.stickyHeader = (function() {
    var stickHeaderClass = '.site-header--sticky';
    if ($(stickHeaderClass).length !== 0) {
        $(window).scroll(function() {
            if (window.pageYOffset >= 20) {
                $(stickHeaderClass).addClass('active');
            } else {
                $(stickHeaderClass).removeClass('active');
            }
        });
    }
})()

theme.PhotoSwipe = (function() {
    var initPhotoSwipeFromDOM = function(gallerySelector) {

        // parse slide data (url, title, size ...) from DOM elements 
        // (children of gallerySelector)
        var parseThumbnailElements = function(el) {
            var thumbElements = el.childNodes,
                numNodes = thumbElements.length,
                items = [],
                figureEl,
                linkEl,
                size,
                item;

            for (var i = 0; i < numNodes; i++) {

                figureEl = thumbElements[i]; // <figure> element

                // include only element nodes 
                if (figureEl.nodeType !== 1) {
                    continue;
                }

                linkEl = figureEl.children[0]; // <a> element

                size = linkEl.getAttribute('data-size').split('x');

                // create slide object
                item = {
                    src: linkEl.getAttribute('href'),
                    w: parseInt(size[0], 10),
                    h: parseInt(size[1], 10)
                };



                if (figureEl.children.length > 1) {
                    // <figcaption> content
                    item.title = figureEl.children[1].innerHTML;
                }

                if (linkEl.children.length > 0) {
                    // <img> thumbnail element, retrieving thumbnail url
                    item.msrc = linkEl.children[0].getAttribute('src');
                }

                item.el = figureEl; // save link to element for getThumbBoundsFn
                items.push(item);
            }

            return items;
        };

        // find nearest parent element
        var closest = function closest(el, fn) {
            return el && (fn(el) ? el : closest(el.parentNode, fn));
        };

        // triggers when user clicks on thumbnail
        var onThumbnailsClick = function(e) {
            e = e || window.event;
            e.preventDefault ? e.preventDefault() : e.returnValue = false;

            var eTarget = e.target || e.srcElement;

            // find root element of slide
            var clickedListItem = closest(eTarget, function(el) {
                return (el.tagName && el.tagName.toUpperCase() === 'FIGURE');
            });

            if (!clickedListItem) {
                return;
            }

            // find index of clicked item by looping through all child nodes
            // alternatively, you may define index via data- attribute
            var clickedGallery = clickedListItem.parentNode,
                childNodes = clickedListItem.parentNode.childNodes,
                numChildNodes = childNodes.length,
                nodeIndex = 0,
                index;

            for (var i = 0; i < numChildNodes; i++) {
                if (childNodes[i].nodeType !== 1) {
                    continue;
                }

                if (childNodes[i] === clickedListItem) {
                    index = nodeIndex;
                    break;
                }
                nodeIndex++;
            }



            if (index >= 0) {
                // open PhotoSwipe if valid index found
                openPhotoSwipe(index, clickedGallery);
            }
            return false;
        };

        // parse picture index and gallery index from URL (#&pid=1&gid=2)
        var photoswipeParseHash = function() {
            var hash = window.location.hash.substring(1),
                params = {};

            if (hash.length < 5) {
                return params;
            }

            var vars = hash.split('&');
            for (var i = 0; i < vars.length; i++) {
                if (!vars[i]) {
                    continue;
                }
                var pair = vars[i].split('=');
                if (pair.length < 2) {
                    continue;
                }
                params[pair[0]] = pair[1];
            }

            if (params.gid) {
                params.gid = parseInt(params.gid, 10);
            }

            return params;
        };

        var openPhotoSwipe = function(index, galleryElement, disableAnimation, fromURL) {
            var pswpElement = document.querySelectorAll('.pswp')[0],
                gallery,
                options,
                items;

            items = parseThumbnailElements(galleryElement);

            // define options (if needed)
            options = {
                maxSpreadZoom: 1,
                bgOpacity: 0.7,
                zoomEl: true,
                history: false,
                zoomEl: false,
                pinchToClose: false,
                closeOnScroll: false,
                // define gallery index (for URL)
                galleryUID: galleryElement.getAttribute('data-pswp-uid'),

            };

            // PhotoSwipe opened from URL
            if (fromURL) {
                if (options.galleryPIDs) {
                    // parse real index when custom PIDs are used 
                    // http://photoswipe.com/documentation/faq.html#custom-pid-in-url
                    for (var j = 0; j < items.length; j++) {
                        if (items[j].pid == index) {
                            options.index = j;
                            break;
                        }
                    }
                } else {
                    // in URL indexes start from 1
                    options.index = parseInt(index, 10) - 1;
                }
            } else {
                options.index = parseInt(index, 10);
            }

            // exit if index not found
            if (isNaN(options.index)) {
                return;
            }

            if (disableAnimation) {
                options.showAnimationDuration = 0;
            }

            // Pass data to PhotoSwipe and initialize it
            gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, items, options);
            gallery.init();
        };

        // loop through all gallery elements and bind events
        var galleryElements = document.querySelectorAll(gallerySelector);

        for (var i = 0, l = galleryElements.length; i < l; i++) {
            galleryElements[i].setAttribute('data-pswp-uid', i + 1);
            galleryElements[i].onclick = onThumbnailsClick;
        }

        // Parse URL and open gallery if it contains #&pid=3&gid=1
        var hashData = photoswipeParseHash();
        if (hashData.pid && hashData.gid) {
            openPhotoSwipe(hashData.pid, galleryElements[hashData.gid - 1], true, true);
        }
    };

    // execute above function
    initPhotoSwipeFromDOM('.my-gallery');
})()

theme.ZoomImage = (function() {
    $(window).resize(function() {
        var width = $(window).width();
        if (width > 767) {
            ZoomImage();
        }
    });
    $(window).width(function() {
        var width = $(window).width();
        if (width > 767) {
            ZoomImage();
        }
    });

    function ZoomImage() {
        $(".zoom_image").each(function(arg, el) {
            var image = $(el).find("img");
            $(el).zoom({
                on: 'mouseover',
                url: image.attr("src").replace("small", "big")
            });
        });
    }
})()

theme.activeAccordion = (function() {
    $('.collapse').on('shown.bs.collapse', function() {
        $(this).prev().addClass('active-acc');
    });
    $('.collapse').on('hidden.bs.collapse', function() {
        $(this).prev().removeClass('active-acc');
    });
})()


// Anchor scroll
theme.anchorScroll = (function() {
    $(document).on('click', 'a[href^="#"]', function(event) {
        event.preventDefault();
        var disableAnchor = $(this).hasClass('disabled-anchor');
        if (!disableAnchor) {
            $('html, body').animate({
                scrollTop: $($.attr(this, 'href')).offset().top
            }, 500);
        }
    });
})()

// Product-recently-viewed
theme.productRecentlyViewed = (function() {
    var $viewedElement = $('.js-recently-view'),
        $viewButton = $('.js-recently-view-button'),
        $content = $('.js-recently-view-content'),
        productHandle = $viewedElement.data('handle') || '',
        limit = $viewButton.data('limit') || 0,
        arrayProduct = JSON.parse(localStorage.getItem('localRecentlyViewed')) || [],
        lastProduct = arrayProduct[arrayProduct.length - 1] || '',
        isAdded = $.inArray(productHandle, arrayProduct) !== -1 ? true : false;

    function processViewed() {
        if (productHandle !== '') {
            //process last product
            if (lastProduct === productHandle && arrayProduct.length > 1) {
                lastProduct = arrayProduct[arrayProduct.length - 2]
            }

            //move current product to last of array
            if (isAdded) {
                arrayProduct.splice(arrayProduct.indexOf(productHandle), 1);
            }
            arrayProduct.push(productHandle);
            //remove first item if limit
            if (arrayProduct.length > limit) {
                arrayProduct.shift()
            }
            localStorage.setItem('localRecentlyViewed', JSON.stringify(arrayProduct));
        }
    }

    function generatorProduct() {
        $content.html('');
        if (arrayProduct.length > 0) {
            //array
            for (var i = 0; i < arrayProduct.length; i++) {
                var productHandle = arrayProduct[i];
                Shopify.getProduct(productHandle, function(product) {
                    var htmlProduct = '';
                    var productPrice = product.price_varies ? 'from ' + theme.Currency.formatMoney(product.price_min, theme.moneyFormat) : theme.Currency.formatMoney(product.price, theme.moneyFormat);
                    var productComparePrice = product.compare_at_price_min !== 0 ? theme.Currency.formatMoney(product.compare_at_price_min, theme.moneyFormat) : '';
                    htmlProduct += '<div class="col-12 col-lg-4 js-viewed-item mb-4">';
                    htmlProduct += '	<div class="border p-3 rounded media d-flex ">';
                    htmlProduct += '	<a class="mr-3 col-4 p-0" href="' + product.url + '">';
                    htmlProduct += '		<img src="' + product.featured_image + '"/>';
                    htmlProduct += '	</a>';
                    htmlProduct += '	<div class="media-body text-left">';
                    htmlProduct += '		<h4 class="mb-2 mt-2"><a href="' + product.url + '">' + product.title + '</a></h5>';
                    htmlProduct += '	<span> ' + productPrice + '</span>';
                    htmlProduct += '	<s>' + productComparePrice + '</s>';
                    htmlProduct += '	</div>';
                    htmlProduct += '	</div>';
                    htmlProduct += '</div>';
                    $content.append(htmlProduct);
                    theme.updateCurrencies();
                });
            }

            //last product
            Shopify.getProduct(lastProduct, function(product) {
                $viewButton.css('background-image', 'url(' + product.featured_image + ')').addClass('active');
            })
        }
    }

    processViewed();
    generatorProduct();

})()

// Notice when soldout
theme.alert = (function() {
    function createAlert(title, mess, time, type) {
        var aTitle = title || '',
            aTime = time || 2000,
            aMessage = mess || '',
            aClass = type || 'default';
        $.growl({
            title: aTitle,
            message: aMessage,
            duration: aTime,
            style: aClass,
            size: 'large'
        });
    }

    return {
        new: createAlert
    }
})()

// Notice when soldout
theme.noticeSoldout = (function() {
    var $soldoutWrapFormClass = $('.js-contact-soldout'),
        $textClass = $('.js-notify-text'),
        $soldoutValueId = $('#ContactProduct');

    function noticeSoldout(variant) {
        $soldoutWrapFormClass.find('.form-success').remove()
        if (variant.available) {
            $textClass.find('span').text('');
            $soldoutWrapFormClass.addClass('hide');
        } else {
            $textClass.find('span').text(': ' + variant.name);
            $soldoutWrapFormClass.removeClass('hide');
            $soldoutValueId.val(variant.name).attr('value', variant.name);
        }
    }
    return {
        init: noticeSoldout
    }
})()

// Sticky cart
theme.stickyCart = (function() {
    var $anchor = $('#js-anchor-sticky-cart'),
        $stCart = $('.sticky-cart-wr'),
        $close = $('#js-sticky-close'),
        disableStCart = localStorage.getItem('localDisableStCart') || '';
    if (disableStCart !== '') {
        $stCart.addClass('disable');
    }
    $close.on('click', function() {
        var isDisable = disableStCart !== '';
        if (isDisable) {
            localStorage.setItem('localDisableStCart', '');
        } else {
            localStorage.setItem('localDisableStCart', 'true');
        }
        $stCart.toggleClass('disable');
    })
    if ($anchor.length) {
        $(window).on('scroll', function() {
            var hT = $anchor.offset().top,
                hH = $anchor.outerHeight(),
                wH = $(window).height(),
                wS = $(this).scrollTop();
            if (wS > (hT + hH - wH)) {
                $stCart.addClass('active');
            } else {
                $stCart.removeClass('active');
            }
        });
    }

})()

//Fix reload safari
window.addEventListener("pageshow", function(evt) {
    if (evt.persisted) {
        setTimeout(function() {
            window.location.reload();
        }, 10);
    }
}, false);

// Back to top
theme.backToTop = (function() {
    var backtotopClass = $('.js-back-to-top');
    $(window).scroll(function() {
        if ($(this).scrollTop() > 300) {
            backtotopClass.fadeIn('slow');
        } else {
            backtotopClass.fadeOut('slow');
        }
    });
    backtotopClass.on('click', function() {
        $('body,html').animate({ scrollTop: 0 }, 800);
    });
})()


// Tooltip
theme.tooltip = (function() {
    var selector = '[data-toggle="tooltip"],[data-tooltip="true"]';

    function loadTooltip() {
        $(selector).tooltip(); //Bootstrap 4
    };
    $(document).on('click', selector, function() {
        $(this).tooltip('hide');
    });
    loadTooltip();
    return {
        load: loadTooltip
    }
})()

//Collections style 2
theme.Bgcollection = (function() {
    // init Isotope
    function Bgcollection(container) {
        var $container = this.$container = $(container);
        var sectionId = $container.attr('data-section-id');
        var wrapper = this.wrapper = '.bgcollection-wrapper';
        var slider = this.slider = '#Bgcollection-' + sectionId;
        var $slider = $(slider, wrapper);
        $(".colgrid__bg--full[data-index='1']").addClass('active');
        $('.colgrid .colgrid__box').each(function() {
            var index = $(this).attr("data-index");
            $(this).hover(
                function() {
                    $(".colgrid__bg--full[data-index='" + index + "']").addClass('active');
                },
                function() {
                    $(".colgrid__bg--full[data-index='" + index + "']").removeClass('active');
                }
            );
        });
    }

    return Bgcollection;
})();


//Sidebar
theme.sidebar = (function() {
    var togglebutton = '.js-toggle-filter',
        $sidebar = $('.js-sidebar');
    $(document).on('click', togglebutton, function() {
        $sidebar.toggleClass('active');
        $(this).toggleClass('active');
    })
})()

// Ajax filter in collection page
theme.ajaxFilter = (function() {
    var ajaxContent = '#js-product-ajax',
        ajaxSortBy = '#js-sortby',
        ajaxFillter = '#js-fillter',
        ajaxCollectionTitle = '.js-collection-title',
        pageTitle = $(document).find("title").text(),
        jsLoading = '#js-loading';

    var apollo = {
        init: function() {
            this.initFilter();
        },
        showLoading: function() {
            $(jsLoading).show();
        },
        hideLoading: function() {
            $('body,html').animate({
                scrollTop: $('#MainContent').offset().top - 150
            }, 600);
            setTimeout(function() {
                $(jsLoading).hide(); //delay 500ms for better UX
            }, 500);

        },
        initFilter: function() {
            apollo.filterParams();
            apollo.filterSortby();
            apollo.sidebarMapTagEvents();
            apollo.filterMapSorting();
            apollo.filterMapPaging();
        },
        filterParams: function() {
            Shopify.queryParams = {};
            if (location.search.length) {
                for (var aKeyValue, i = 0, aCouples = location.search.substr(1).split('&'); i < aCouples.length; i++) {
                    aKeyValue = aCouples[i].split('=');
                    if (aKeyValue.length > 1) {
                        Shopify.queryParams[decodeURIComponent(aKeyValue[0])] = decodeURIComponent(aKeyValue[1]);
                    }
                }
            }
        },
        filterSortby: function() {
            if (Shopify.queryParams.sort_by) {
                var sortby = Shopify.queryParams.sort_by;
                $(ajaxSortBy).val(sortby);
            }
        },
        filterCreateUrl: function(baseLink) {
            var newQuery = $.param(Shopify.queryParams).replace(/%2B/g, '+');
            if (baseLink) {
                if (newQuery != "") {
                    return baseLink + "?" + newQuery;
                } else {
                    return baseLink;
                }
            }
            return location.pathname + "?" + newQuery;
        },
        filterMapData: function(data) {
            // 1. update product grid
            $(ajaxContent).html($(ajaxContent, data.responseText).html());
            // 2. update left filter
            $(ajaxFillter).html($(ajaxFillter, data.responseText).html());
            // 3. update collection title
            $(ajaxCollectionTitle).html($(ajaxCollectionTitle, data.responseText).html());
        },
        filterAjaxClick: function(baseLink) {
            delete Shopify.queryParams.page;
            var newurl = apollo.filterCreateUrl(baseLink);
            History.pushState({
                param: Shopify.queryParams
            }, pageTitle, newurl);
            apollo.filterGetContent(newurl);
        },
        filterGetContent: function(newurl) {
            $.ajax({
                type: 'GET',
                url: newurl,
                data: {},
                beforeSend: function() {
                    apollo.showLoading();
                },
                complete: function(data) {
                    apollo.filterMapData(data);
                    theme.wishlist.load();
                    theme.compare.load();
                    theme.countdown.load();
                    theme.priceRange.load();
                    theme.tooltip.load();
                    theme.collectionView.triggerView();
                    theme.swatchCard2.load();
                    theme.infiniteScroll.load();
                    apollo.hideLoading();
                },
                error: function(xhr, text) {
                    apollo.hideLoading();
                    alert($.parseJSON(xhr.responseText).description);
                }
            });
        },
        sidebarMapTagEvents: function() {
            $(document).on('click', '.advanced-filter a', function(event) {
                event.preventDefault();
                $('.tooltip').removeClass('show');
                var currentTags = [];
                if (Shopify.queryParams.constraint) {
                    currentTags = Shopify.queryParams.constraint.split('+');
                }
                if (!$(this).parent().hasClass("active-filter")) {
                    var otherTag = $(this).parents('.catalog_filter_ul').find("li.active-filter");
                    if (otherTag.length > 0) {
                        var tagName = otherTag.data("handle");
                        if (tagName) {
                            var tagPos = currentTags.indexOf(tagName);
                            if (tagPos >= 0) {
                                currentTags.splice(tagPos, 1);
                            }
                        }
                    }
                }
                var dataHandle = $(this).parent().data("handle");
                if (dataHandle) {
                    var tagPos = currentTags.indexOf(dataHandle);
                    if (tagPos >= 0) {
                        currentTags.splice(tagPos, 1);
                    } else {
                        currentTags.push(dataHandle);
                    }
                }
                if (currentTags.length) {
                    Shopify.queryParams.constraint = currentTags.join('+');
                } else {
                    delete Shopify.queryParams.constraint;
                }
                apollo.filterAjaxClick();
            });
            $(document).on('click', '.advanced-filter .icon', function() {
                $(this).parent('.advanced-filter').find('a').trigger("click");
            });
        },
        filterMapSorting: function() {
            $(document).on('change', ajaxSortBy, function() {
                Shopify.queryParams.sort_by = $(this).val();
                apollo.filterAjaxClick();
            })
        },
        filterMapPaging: function() {
            $(document).on('click', '.js-pagination a', function() {
                event.preventDefault();
                var linkPage = $(this).attr("href").match(/page=\d+/g);
                if (linkPage) {
                    Shopify.queryParams.page = parseInt(linkPage[0].match(/\d+/g));
                    if (Shopify.queryParams.page) {
                        var newurl = apollo.filterCreateUrl();
                        History.pushState({
                            param: Shopify.queryParams
                        }, pageTitle, newurl);
                        apollo.filterGetContent(newurl);
                    }
                }
            });
        }
    }

    if ($(".template-collection")) {
        History.Adapter.bind(window, 'statechange', function() {
            var State = History.getState();
            apollo.filterParams();
        });
    }
    apollo.init();

})();
$(theme.init);